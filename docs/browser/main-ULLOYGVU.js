import{d as u2}from"./chunk-ZP5BPBVR.js";import{_ as c2}from"./chunk-N6UF5KRC.js";import"./chunk-OQ43XKI2.js";import{a as St,b as Xn,d as a2,f as l2,g as kr}from"./chunk-ATDPNAVO.js";var IN=a2((uw,CN)=>{"use strict";(function(n,e){typeof uw=="object"&&typeof CN<"u"?e(uw):typeof define=="function"&&define.amd?define(["exports"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n.leaflet={}))})(uw,function(n){"use strict";var e="1.9.4";function t(d){var b,S,F,$;for(S=1,F=arguments.length;S<F;S++){$=arguments[S];for(b in $)d[b]=$[b]}return d}var o=Object.create||(function(){function d(){}return function(b){return d.prototype=b,new d}})();function a(d,b){var S=Array.prototype.slice;if(d.bind)return d.bind.apply(d,S.call(arguments,1));var F=S.call(arguments,2);return function(){return d.apply(b,F.length?F.concat(S.call(arguments)):arguments)}}var s=0;function f(d){return"_leaflet_id"in d||(d._leaflet_id=++s),d._leaflet_id}function v(d,b,S){var F,$,ie,we;return we=function(){F=!1,$&&(ie.apply(S,$),$=!1)},ie=function(){F?$=arguments:(d.apply(S,arguments),setTimeout(we,b),F=!0)},ie}function w(d,b,S){var F=b[1],$=b[0],ie=F-$;return d===F&&S?d:((d-$)%ie+ie)%ie+$}function D(){return!1}function A(d,b){if(b===!1)return d;var S=Math.pow(10,b===void 0?6:b);return Math.round(d*S)/S}function z(d){return d.trim?d.trim():d.replace(/^\s+|\s+$/g,"")}function H(d){return z(d).split(/\s+/)}function q(d,b){Object.prototype.hasOwnProperty.call(d,"options")||(d.options=d.options?o(d.options):{});for(var S in b)d.options[S]=b[S];return d.options}function W(d,b,S){var F=[];for(var $ in d)F.push(encodeURIComponent(S?$.toUpperCase():$)+"="+encodeURIComponent(d[$]));return(!b||b.indexOf("?")===-1?"?":"&")+F.join("&")}var me=/\{ *([\w_ -]+) *\}/g;function ce(d,b){return d.replace(me,function(S,F){var $=b[F];if($===void 0)throw new Error("No value provided for variable "+S);return typeof $=="function"&&($=$(b)),$})}var ue=Array.isArray||function(d){return Object.prototype.toString.call(d)==="[object Array]"};function Me(d,b){for(var S=0;S<d.length;S++)if(d[S]===b)return S;return-1}var Ue="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function Pe(d){return window["webkit"+d]||window["moz"+d]||window["ms"+d]}var ke=0;function Qe(d){var b=+new Date,S=Math.max(0,16-(b-ke));return ke=b+S,window.setTimeout(d,S)}var ot=window.requestAnimationFrame||Pe("RequestAnimationFrame")||Qe,st=window.cancelAnimationFrame||Pe("CancelAnimationFrame")||Pe("CancelRequestAnimationFrame")||function(d){window.clearTimeout(d)};function it(d,b,S){if(S&&ot===Qe)d.call(b);else return ot.call(window,a(d,b))}function pt(d){d&&st.call(window,d)}var Vt={__proto__:null,extend:t,create:o,bind:a,get lastId(){return s},stamp:f,throttle:v,wrapNum:w,falseFn:D,formatNum:A,trim:z,splitWords:H,setOptions:q,getParamString:W,template:ce,isArray:ue,indexOf:Me,emptyImageUrl:Ue,requestFn:ot,cancelFn:st,requestAnimFrame:it,cancelAnimFrame:pt};function Pt(){}Pt.extend=function(d){var b=function(){q(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},S=b.__super__=this.prototype,F=o(S);F.constructor=b,b.prototype=F;for(var $ in this)Object.prototype.hasOwnProperty.call(this,$)&&$!=="prototype"&&$!=="__super__"&&(b[$]=this[$]);return d.statics&&t(b,d.statics),d.includes&&(At(d.includes),t.apply(null,[F].concat(d.includes))),t(F,d),delete F.statics,delete F.includes,F.options&&(F.options=S.options?o(S.options):{},t(F.options,d.options)),F._initHooks=[],F.callInitHooks=function(){if(!this._initHooksCalled){S.callInitHooks&&S.callInitHooks.call(this),this._initHooksCalled=!0;for(var ie=0,we=F._initHooks.length;ie<we;ie++)F._initHooks[ie].call(this)}},b},Pt.include=function(d){var b=this.prototype.options;return t(this.prototype,d),d.options&&(this.prototype.options=b,this.mergeOptions(d.options)),this},Pt.mergeOptions=function(d){return t(this.prototype.options,d),this},Pt.addInitHook=function(d){var b=Array.prototype.slice.call(arguments,1),S=typeof d=="function"?d:function(){this[d].apply(this,b)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(S),this};function At(d){if(!(typeof L>"u"||!L||!L.Mixin)){d=ue(d)?d:[d];for(var b=0;b<d.length;b++)d[b]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var Gt={on:function(d,b,S){if(typeof d=="object")for(var F in d)this._on(F,d[F],b);else{d=H(d);for(var $=0,ie=d.length;$<ie;$++)this._on(d[$],b,S)}return this},off:function(d,b,S){if(!arguments.length)delete this._events;else if(typeof d=="object")for(var F in d)this._off(F,d[F],b);else{d=H(d);for(var $=arguments.length===1,ie=0,we=d.length;ie<we;ie++)$?this._off(d[ie]):this._off(d[ie],b,S)}return this},_on:function(d,b,S,F){if(typeof b!="function"){console.warn("wrong listener type: "+typeof b);return}if(this._listens(d,b,S)===!1){S===this&&(S=void 0);var $={fn:b,ctx:S};F&&($.once=!0),this._events=this._events||{},this._events[d]=this._events[d]||[],this._events[d].push($)}},_off:function(d,b,S){var F,$,ie;if(this._events&&(F=this._events[d],!!F)){if(arguments.length===1){if(this._firingCount)for($=0,ie=F.length;$<ie;$++)F[$].fn=D;delete this._events[d];return}if(typeof b!="function"){console.warn("wrong listener type: "+typeof b);return}var we=this._listens(d,b,S);if(we!==!1){var Fe=F[we];this._firingCount&&(Fe.fn=D,this._events[d]=F=F.slice()),F.splice(we,1)}}},fire:function(d,b,S){if(!this.listens(d,S))return this;var F=t({},b,{type:d,target:this,sourceTarget:b&&b.sourceTarget||this});if(this._events){var $=this._events[d];if($){this._firingCount=this._firingCount+1||1;for(var ie=0,we=$.length;ie<we;ie++){var Fe=$[ie],He=Fe.fn;Fe.once&&this.off(d,He,Fe.ctx),He.call(Fe.ctx||this,F)}this._firingCount--}}return S&&this._propagateEvent(F),this},listens:function(d,b,S,F){typeof d!="string"&&console.warn('"string" type argument expected');var $=b;typeof b!="function"&&(F=!!b,$=void 0,S=void 0);var ie=this._events&&this._events[d];if(ie&&ie.length&&this._listens(d,$,S)!==!1)return!0;if(F){for(var we in this._eventParents)if(this._eventParents[we].listens(d,b,S,F))return!0}return!1},_listens:function(d,b,S){if(!this._events)return!1;var F=this._events[d]||[];if(!b)return!!F.length;S===this&&(S=void 0);for(var $=0,ie=F.length;$<ie;$++)if(F[$].fn===b&&F[$].ctx===S)return $;return!1},once:function(d,b,S){if(typeof d=="object")for(var F in d)this._on(F,d[F],b,!0);else{d=H(d);for(var $=0,ie=d.length;$<ie;$++)this._on(d[$],b,S,!0)}return this},addEventParent:function(d){return this._eventParents=this._eventParents||{},this._eventParents[f(d)]=d,this},removeEventParent:function(d){return this._eventParents&&delete this._eventParents[f(d)],this},_propagateEvent:function(d){for(var b in this._eventParents)this._eventParents[b].fire(d.type,t({layer:d.target,propagatedFrom:d.target},d),!0)}};Gt.addEventListener=Gt.on,Gt.removeEventListener=Gt.clearAllEventListeners=Gt.off,Gt.addOneTimeEventListener=Gt.once,Gt.fireEvent=Gt.fire,Gt.hasEventListeners=Gt.listens;var yt=Pt.extend(Gt);function dt(d,b,S){this.x=S?Math.round(d):d,this.y=S?Math.round(b):b}var ft=Math.trunc||function(d){return d>0?Math.floor(d):Math.ceil(d)};dt.prototype={clone:function(){return new dt(this.x,this.y)},add:function(d){return this.clone()._add(rt(d))},_add:function(d){return this.x+=d.x,this.y+=d.y,this},subtract:function(d){return this.clone()._subtract(rt(d))},_subtract:function(d){return this.x-=d.x,this.y-=d.y,this},divideBy:function(d){return this.clone()._divideBy(d)},_divideBy:function(d){return this.x/=d,this.y/=d,this},multiplyBy:function(d){return this.clone()._multiplyBy(d)},_multiplyBy:function(d){return this.x*=d,this.y*=d,this},scaleBy:function(d){return new dt(this.x*d.x,this.y*d.y)},unscaleBy:function(d){return new dt(this.x/d.x,this.y/d.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=ft(this.x),this.y=ft(this.y),this},distanceTo:function(d){d=rt(d);var b=d.x-this.x,S=d.y-this.y;return Math.sqrt(b*b+S*S)},equals:function(d){return d=rt(d),d.x===this.x&&d.y===this.y},contains:function(d){return d=rt(d),Math.abs(d.x)<=Math.abs(this.x)&&Math.abs(d.y)<=Math.abs(this.y)},toString:function(){return"Point("+A(this.x)+", "+A(this.y)+")"}};function rt(d,b,S){return d instanceof dt?d:ue(d)?new dt(d[0],d[1]):d==null?d:typeof d=="object"&&"x"in d&&"y"in d?new dt(d.x,d.y):new dt(d,b,S)}function Dt(d,b){if(d)for(var S=b?[d,b]:d,F=0,$=S.length;F<$;F++)this.extend(S[F])}Dt.prototype={extend:function(d){var b,S;if(!d)return this;if(d instanceof dt||typeof d[0]=="number"||"x"in d)b=S=rt(d);else if(d=$t(d),b=d.min,S=d.max,!b||!S)return this;return!this.min&&!this.max?(this.min=b.clone(),this.max=S.clone()):(this.min.x=Math.min(b.x,this.min.x),this.max.x=Math.max(S.x,this.max.x),this.min.y=Math.min(b.y,this.min.y),this.max.y=Math.max(S.y,this.max.y)),this},getCenter:function(d){return rt((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,d)},getBottomLeft:function(){return rt(this.min.x,this.max.y)},getTopRight:function(){return rt(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(d){var b,S;return typeof d[0]=="number"||d instanceof dt?d=rt(d):d=$t(d),d instanceof Dt?(b=d.min,S=d.max):b=S=d,b.x>=this.min.x&&S.x<=this.max.x&&b.y>=this.min.y&&S.y<=this.max.y},intersects:function(d){d=$t(d);var b=this.min,S=this.max,F=d.min,$=d.max,ie=$.x>=b.x&&F.x<=S.x,we=$.y>=b.y&&F.y<=S.y;return ie&&we},overlaps:function(d){d=$t(d);var b=this.min,S=this.max,F=d.min,$=d.max,ie=$.x>b.x&&F.x<S.x,we=$.y>b.y&&F.y<S.y;return ie&&we},isValid:function(){return!!(this.min&&this.max)},pad:function(d){var b=this.min,S=this.max,F=Math.abs(b.x-S.x)*d,$=Math.abs(b.y-S.y)*d;return $t(rt(b.x-F,b.y-$),rt(S.x+F,S.y+$))},equals:function(d){return d?(d=$t(d),this.min.equals(d.getTopLeft())&&this.max.equals(d.getBottomRight())):!1}};function $t(d,b){return!d||d instanceof Dt?d:new Dt(d,b)}function Qt(d,b){if(d)for(var S=b?[d,b]:d,F=0,$=S.length;F<$;F++)this.extend(S[F])}Qt.prototype={extend:function(d){var b=this._southWest,S=this._northEast,F,$;if(d instanceof Zt)F=d,$=d;else if(d instanceof Qt){if(F=d._southWest,$=d._northEast,!F||!$)return this}else return d?this.extend(Rt(d)||et(d)):this;return!b&&!S?(this._southWest=new Zt(F.lat,F.lng),this._northEast=new Zt($.lat,$.lng)):(b.lat=Math.min(F.lat,b.lat),b.lng=Math.min(F.lng,b.lng),S.lat=Math.max($.lat,S.lat),S.lng=Math.max($.lng,S.lng)),this},pad:function(d){var b=this._southWest,S=this._northEast,F=Math.abs(b.lat-S.lat)*d,$=Math.abs(b.lng-S.lng)*d;return new Qt(new Zt(b.lat-F,b.lng-$),new Zt(S.lat+F,S.lng+$))},getCenter:function(){return new Zt((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Zt(this.getNorth(),this.getWest())},getSouthEast:function(){return new Zt(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(d){typeof d[0]=="number"||d instanceof Zt||"lat"in d?d=Rt(d):d=et(d);var b=this._southWest,S=this._northEast,F,$;return d instanceof Qt?(F=d.getSouthWest(),$=d.getNorthEast()):F=$=d,F.lat>=b.lat&&$.lat<=S.lat&&F.lng>=b.lng&&$.lng<=S.lng},intersects:function(d){d=et(d);var b=this._southWest,S=this._northEast,F=d.getSouthWest(),$=d.getNorthEast(),ie=$.lat>=b.lat&&F.lat<=S.lat,we=$.lng>=b.lng&&F.lng<=S.lng;return ie&&we},overlaps:function(d){d=et(d);var b=this._southWest,S=this._northEast,F=d.getSouthWest(),$=d.getNorthEast(),ie=$.lat>b.lat&&F.lat<S.lat,we=$.lng>b.lng&&F.lng<S.lng;return ie&&we},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(d,b){return d?(d=et(d),this._southWest.equals(d.getSouthWest(),b)&&this._northEast.equals(d.getNorthEast(),b)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function et(d,b){return d instanceof Qt?d:new Qt(d,b)}function Zt(d,b,S){if(isNaN(d)||isNaN(b))throw new Error("Invalid LatLng object: ("+d+", "+b+")");this.lat=+d,this.lng=+b,S!==void 0&&(this.alt=+S)}Zt.prototype={equals:function(d,b){if(!d)return!1;d=Rt(d);var S=Math.max(Math.abs(this.lat-d.lat),Math.abs(this.lng-d.lng));return S<=(b===void 0?1e-9:b)},toString:function(d){return"LatLng("+A(this.lat,d)+", "+A(this.lng,d)+")"},distanceTo:function(d){return kn.distance(this,Rt(d))},wrap:function(){return kn.wrapLatLng(this)},toBounds:function(d){var b=180*d/40075017,S=b/Math.cos(Math.PI/180*this.lat);return et([this.lat-b,this.lng-S],[this.lat+b,this.lng+S])},clone:function(){return new Zt(this.lat,this.lng,this.alt)}};function Rt(d,b,S){return d instanceof Zt?d:ue(d)&&typeof d[0]!="object"?d.length===3?new Zt(d[0],d[1],d[2]):d.length===2?new Zt(d[0],d[1]):null:d==null?d:typeof d=="object"&&"lat"in d?new Zt(d.lat,"lng"in d?d.lng:d.lon,d.alt):b===void 0?null:new Zt(d,b,S)}var Sn={latLngToPoint:function(d,b){var S=this.projection.project(d),F=this.scale(b);return this.transformation._transform(S,F)},pointToLatLng:function(d,b){var S=this.scale(b),F=this.transformation.untransform(d,S);return this.projection.unproject(F)},project:function(d){return this.projection.project(d)},unproject:function(d){return this.projection.unproject(d)},scale:function(d){return 256*Math.pow(2,d)},zoom:function(d){return Math.log(d/256)/Math.LN2},getProjectedBounds:function(d){if(this.infinite)return null;var b=this.projection.bounds,S=this.scale(d),F=this.transformation.transform(b.min,S),$=this.transformation.transform(b.max,S);return new Dt(F,$)},infinite:!1,wrapLatLng:function(d){var b=this.wrapLng?w(d.lng,this.wrapLng,!0):d.lng,S=this.wrapLat?w(d.lat,this.wrapLat,!0):d.lat,F=d.alt;return new Zt(S,b,F)},wrapLatLngBounds:function(d){var b=d.getCenter(),S=this.wrapLatLng(b),F=b.lat-S.lat,$=b.lng-S.lng;if(F===0&&$===0)return d;var ie=d.getSouthWest(),we=d.getNorthEast(),Fe=new Zt(ie.lat-F,ie.lng-$),He=new Zt(we.lat-F,we.lng-$);return new Qt(Fe,He)}},kn=t({},Sn,{wrapLng:[-180,180],R:6371e3,distance:function(d,b){var S=Math.PI/180,F=d.lat*S,$=b.lat*S,ie=Math.sin((b.lat-d.lat)*S/2),we=Math.sin((b.lng-d.lng)*S/2),Fe=ie*ie+Math.cos(F)*Math.cos($)*we*we,He=2*Math.atan2(Math.sqrt(Fe),Math.sqrt(1-Fe));return this.R*He}}),Ei=6378137,Zi={R:Ei,MAX_LATITUDE:85.0511287798,project:function(d){var b=Math.PI/180,S=this.MAX_LATITUDE,F=Math.max(Math.min(S,d.lat),-S),$=Math.sin(F*b);return new dt(this.R*d.lng*b,this.R*Math.log((1+$)/(1-$))/2)},unproject:function(d){var b=180/Math.PI;return new Zt((2*Math.atan(Math.exp(d.y/this.R))-Math.PI/2)*b,d.x*b/this.R)},bounds:(function(){var d=Ei*Math.PI;return new Dt([-d,-d],[d,d])})()};function Ti(d,b,S,F){if(ue(d)){this._a=d[0],this._b=d[1],this._c=d[2],this._d=d[3];return}this._a=d,this._b=b,this._c=S,this._d=F}Ti.prototype={transform:function(d,b){return this._transform(d.clone(),b)},_transform:function(d,b){return b=b||1,d.x=b*(this._a*d.x+this._b),d.y=b*(this._c*d.y+this._d),d},untransform:function(d,b){return b=b||1,new dt((d.x/b-this._b)/this._a,(d.y/b-this._d)/this._c)}};function ti(d,b,S,F){return new Ti(d,b,S,F)}var ss=t({},kn,{code:"EPSG:3857",projection:Zi,transformation:(function(){var d=.5/(Math.PI*Zi.R);return ti(d,.5,-d,.5)})()}),zi=t({},ss,{code:"EPSG:900913"});function ir(d){return document.createElementNS("http://www.w3.org/2000/svg",d)}function Qi(d,b){var S="",F,$,ie,we,Fe,He;for(F=0,ie=d.length;F<ie;F++){for(Fe=d[F],$=0,we=Fe.length;$<we;$++)He=Fe[$],S+=($?"L":"M")+He.x+" "+He.y;S+=b?De.svg?"z":"x":""}return S||"M0 0"}var bn=document.documentElement.style,Di="ActiveXObject"in window,Do=Di&&!document.addEventListener,ro="msLaunchUri"in navigator&&!("documentMode"in document),ur=Yt("webkit"),hr=Yt("android"),$r=Yt("android 2")||Yt("android 3"),Mo=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),$n=hr&&Yt("Google")&&Mo<537&&!("AudioNode"in window),oo=!!window.opera,xs=!ro&&Yt("chrome"),Zo=Yt("gecko")&&!ur&&!oo&&!Di,as=!xs&&Yt("safari"),Ie=Yt("phantom"),J="OTransition"in bn,Q=navigator.platform.indexOf("Win")===0,te=Di&&"transition"in bn,ge="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!$r,be="MozPerspective"in bn,Le=!window.L_DISABLE_3D&&(te||ge||be)&&!J&&!Ie,Ae=typeof orientation<"u"||Yt("mobile"),Se=Ae&&ur,Re=Ae&&ge,Xe=!window.PointerEvent&&window.MSPointerEvent,Ge=!!(window.PointerEvent||Xe),Ke="ontouchstart"in window||!!window.TouchEvent,Te=!window.L_NO_TOUCH&&(Ke||Ge),Ut=Ae&&oo,Wn=Ae&&Zo,Et=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,xt=(function(){var d=!1;try{var b=Object.defineProperty({},"passive",{get:function(){d=!0}});window.addEventListener("testPassiveEventSupport",D,b),window.removeEventListener("testPassiveEventSupport",D,b)}catch{}return d})(),qt=(function(){return!!document.createElement("canvas").getContext})(),Dn=!!(document.createElementNS&&ir("svg").createSVGRect),Mn=!!Dn&&(function(){var d=document.createElement("div");return d.innerHTML="<svg/>",(d.firstChild&&d.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),Hn=!Dn&&(function(){try{var d=document.createElement("div");d.innerHTML='<v:shape adj="1"/>';var b=d.firstChild;return b.style.behavior="url(#default#VML)",b&&typeof b.adj=="object"}catch{return!1}})(),ni=navigator.platform.indexOf("Mac")===0,Bn=navigator.platform.indexOf("Linux")===0;function Yt(d){return navigator.userAgent.toLowerCase().indexOf(d)>=0}var De={ie:Di,ielt9:Do,edge:ro,webkit:ur,android:hr,android23:$r,androidStock:$n,opera:oo,chrome:xs,gecko:Zo,safari:as,phantom:Ie,opera12:J,win:Q,ie3d:te,webkit3d:ge,gecko3d:be,any3d:Le,mobile:Ae,mobileWebkit:Se,mobileWebkit3d:Re,msPointer:Xe,pointer:Ge,touch:Te,touchNative:Ke,mobileOpera:Ut,mobileGecko:Wn,retina:Et,passiveEvents:xt,canvas:qt,svg:Dn,vml:Hn,inlineSvg:Mn,mac:ni,linux:Bn},Zn=De.msPointer?"MSPointerDown":"pointerdown",yr=De.msPointer?"MSPointerMove":"pointermove",La=De.msPointer?"MSPointerUp":"pointerup",Mi=De.msPointer?"MSPointerCancel":"pointercancel",ht={touchstart:Zn,touchmove:yr,touchend:La,touchcancel:Mi},en={touchstart:Jc,touchmove:Qs,touchend:Qs,touchcancel:Qs},tn={},so=!1;function ch(d,b,S){return b==="touchstart"&&uh(),en[b]?(S=en[b].bind(this,S),d.addEventListener(ht[b],S,!1),S):(console.warn("wrong event specified:",b),D)}function Js(d,b,S){if(!ht[b]){console.warn("wrong event specified:",b);return}d.removeEventListener(ht[b],S,!1)}function on(d){tn[d.pointerId]=d}function Kc(d){tn[d.pointerId]&&(tn[d.pointerId]=d)}function Yl(d){delete tn[d.pointerId]}function uh(){so||(document.addEventListener(Zn,on,!0),document.addEventListener(yr,Kc,!0),document.addEventListener(La,Yl,!0),document.addEventListener(Mi,Yl,!0),so=!0)}function Qs(d,b){if(b.pointerType!==(b.MSPOINTER_TYPE_MOUSE||"mouse")){b.touches=[];for(var S in tn)b.touches.push(tn[S]);b.changedTouches=[b],d(b)}}function Jc(d,b){b.MSPOINTER_TYPE_TOUCH&&b.pointerType===b.MSPOINTER_TYPE_TOUCH&&Pn(b),Qs(d,b)}function Kl(d){var b={},S,F;for(F in d)S=d[F],b[F]=S&&S.bind?S.bind(d):S;return d=b,b.type="dblclick",b.detail=2,b.isTrusted=!1,b._simulated=!0,b}var Qc=200;function Hr(d,b){d.addEventListener("dblclick",b);var S=0,F;function $(ie){if(ie.detail!==1){F=ie.detail;return}if(!(ie.pointerType==="mouse"||ie.sourceCapabilities&&!ie.sourceCapabilities.firesTouchEvents)){var we=cs(ie);if(!(we.some(function(He){return He instanceof HTMLLabelElement&&He.attributes.for})&&!we.some(function(He){return He instanceof HTMLInputElement||He instanceof HTMLSelectElement}))){var Fe=Date.now();Fe-S<=Qc?(F++,F===2&&b(Kl(ie))):F=1,S=Fe}}}return d.addEventListener("click",$),{dblclick:b,simDblclick:$}}function Kn(d,b){d.removeEventListener("dblclick",b.dblclick),d.removeEventListener("click",b.simDblclick)}var Jl=ec(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),bs=ec(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Ql=bs==="webkitTransition"||bs==="OTransition"?bs+"End":"transitionend";function Oa(d){return typeof d=="string"?document.getElementById(d):d}function Zr(d,b){var S=d.style[b]||d.currentStyle&&d.currentStyle[b];if((!S||S==="auto")&&document.defaultView){var F=document.defaultView.getComputedStyle(d,null);S=F?F[b]:null}return S==="auto"?null:S}function jn(d,b,S){var F=document.createElement(d);return F.className=b||"",S&&S.appendChild(F),F}function ii(d){var b=d.parentNode;b&&b.removeChild(d)}function sl(d){for(;d.firstChild;)d.removeChild(d.firstChild)}function ai(d){var b=d.parentNode;b&&b.lastChild!==d&&b.appendChild(d)}function al(d){var b=d.parentNode;b&&b.firstChild!==d&&b.insertBefore(d,b.firstChild)}function hh(d,b){if(d.classList!==void 0)return d.classList.contains(b);var S=eu(d);return S.length>0&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(S)}function cn(d,b){if(d.classList!==void 0)for(var S=H(b),F=0,$=S.length;F<$;F++)d.classList.add(S[F]);else if(!hh(d,b)){var ie=eu(d);dh(d,(ie?ie+" ":"")+b)}}function Bi(d,b){d.classList!==void 0?d.classList.remove(b):dh(d,z((" "+eu(d)+" ").replace(" "+b+" "," ")))}function dh(d,b){d.className.baseVal===void 0?d.className=b:d.className.baseVal=b}function eu(d){return d.correspondingElement&&(d=d.correspondingElement),d.className.baseVal===void 0?d.className:d.className.baseVal}function qr(d,b){"opacity"in d.style?d.style.opacity=b:"filter"in d.style&&Cd(d,b)}function Cd(d,b){var S=!1,F="DXImageTransform.Microsoft.Alpha";try{S=d.filters.item(F)}catch{if(b===1)return}b=Math.round(b*100),S?(S.Enabled=b!==100,S.Opacity=b):d.style.filter+=" progid:"+F+"(opacity="+b+")"}function ec(d){for(var b=document.documentElement.style,S=0;S<d.length;S++)if(d[S]in b)return d[S];return!1}function ea(d,b,S){var F=b||new dt(0,0);d.style[Jl]=(De.ie3d?"translate("+F.x+"px,"+F.y+"px)":"translate3d("+F.x+"px,"+F.y+"px,0)")+(S?" scale("+S+")":"")}function ji(d,b){d._leaflet_pos=b,De.any3d?ea(d,b):(d.style.left=b.x+"px",d.style.top=b.y+"px")}function ll(d){return d._leaflet_pos||new dt(0,0)}var ta,ka,fh;if("onselectstart"in document)ta=function(){Bt(window,"selectstart",Pn)},ka=function(){bt(window,"selectstart",Pn)};else{var ws=ec(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);ta=function(){if(ws){var d=document.documentElement.style;fh=d[ws],d[ws]="none"}},ka=function(){ws&&(document.documentElement.style[ws]=fh,fh=void 0)}}function tu(){Bt(window,"dragstart",Pn)}function cl(){bt(window,"dragstart",Pn)}var ls,Fa;function sn(d){for(;d.tabIndex===-1;)d=d.parentNode;d.style&&(tc(),ls=d,Fa=d.style.outlineStyle,d.style.outlineStyle="none",Bt(window,"keydown",tc))}function tc(){ls&&(ls.style.outlineStyle=Fa,ls=void 0,Fa=void 0,bt(window,"keydown",tc))}function hp(d){do d=d.parentNode;while((!d.offsetWidth||!d.offsetHeight)&&d!==document.body);return d}function nu(d){var b=d.getBoundingClientRect();return{x:b.width/d.offsetWidth||1,y:b.height/d.offsetHeight||1,boundingClientRect:b}}var ao={__proto__:null,TRANSFORM:Jl,TRANSITION:bs,TRANSITION_END:Ql,get:Oa,getStyle:Zr,create:jn,remove:ii,empty:sl,toFront:ai,toBack:al,hasClass:hh,addClass:cn,removeClass:Bi,setClass:dh,getClass:eu,setOpacity:qr,testProp:ec,setTransform:ea,setPosition:ji,getPosition:ll,get disableTextSelection(){return ta},get enableTextSelection(){return ka},disableImageDrag:tu,enableImageDrag:cl,preventOutline:sn,restoreOutline:tc,getSizedParentNode:hp,getScale:nu};function Bt(d,b,S,F){if(b&&typeof b=="object")for(var $ in b)vr(d,$,b[$],S);else{b=H(b);for(var ie=0,we=b.length;ie<we;ie++)vr(d,b[ie],S,F)}return this}var Vn="_leaflet_events";function bt(d,b,S,F){if(arguments.length===1)ri(d),delete d[Vn];else if(b&&typeof b=="object")for(var $ in b)Wr(d,$,b[$],S);else if(b=H(b),arguments.length===2)ri(d,function(Fe){return Me(b,Fe)!==-1});else for(var ie=0,we=b.length;ie<we;ie++)Wr(d,b[ie],S,F);return this}function ri(d,b){for(var S in d[Vn]){var F=S.split(/\d/)[0];(!b||b(F))&&Wr(d,F,null,null,S)}}var Es={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function vr(d,b,S,F){var $=b+f(S)+(F?"_"+f(F):"");if(d[Vn]&&d[Vn][$])return this;var ie=function(Fe){return S.call(F||d,Fe||window.event)},we=ie;!De.touchNative&&De.pointer&&b.indexOf("touch")===0?ie=ch(d,b,ie):De.touch&&b==="dblclick"?ie=Hr(d,ie):"addEventListener"in d?b==="touchstart"||b==="touchmove"||b==="wheel"||b==="mousewheel"?d.addEventListener(Es[b]||b,ie,De.passiveEvents?{passive:!1}:!1):b==="mouseenter"||b==="mouseleave"?(ie=function(Fe){Fe=Fe||window.event,us(d,Fe)&&we(Fe)},d.addEventListener(Es[b],ie,!1)):d.addEventListener(b,we,!1):d.attachEvent("on"+b,ie),d[Vn]=d[Vn]||{},d[Vn][$]=ie}function Wr(d,b,S,F,$){$=$||b+f(S)+(F?"_"+f(F):"");var ie=d[Vn]&&d[Vn][$];if(!ie)return this;!De.touchNative&&De.pointer&&b.indexOf("touch")===0?Js(d,b,ie):De.touch&&b==="dblclick"?Kn(d,ie):"removeEventListener"in d?d.removeEventListener(Es[b]||b,ie,!1):d.detachEvent("on"+b,ie),d[Vn][$]=null}function qi(d){return d.stopPropagation?d.stopPropagation():d.originalEvent?d.originalEvent._stopped=!0:d.cancelBubble=!0,this}function Na(d){return vr(d,"wheel",qi),this}function qo(d){return Bt(d,"mousedown touchstart dblclick contextmenu",qi),d._leaflet_disable_click=!0,this}function Pn(d){return d.preventDefault?d.preventDefault():d.returnValue=!1,this}function Po(d){return Pn(d),qi(d),this}function cs(d){if(d.composedPath)return d.composedPath();for(var b=[],S=d.target;S;)b.push(S),S=S.parentNode;return b}function iu(d,b){if(!b)return new dt(d.clientX,d.clientY);var S=nu(b),F=S.boundingClientRect;return new dt((d.clientX-F.left)/S.x-b.clientLeft,(d.clientY-F.top)/S.y-b.clientTop)}var lo=De.linux&&De.chrome?window.devicePixelRatio:De.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function za(d){return De.edge?d.wheelDeltaY/2:d.deltaY&&d.deltaMode===0?-d.deltaY/lo:d.deltaY&&d.deltaMode===1?-d.deltaY*20:d.deltaY&&d.deltaMode===2?-d.deltaY*60:d.deltaX||d.deltaZ?0:d.wheelDelta?(d.wheelDeltaY||d.wheelDelta)/2:d.detail&&Math.abs(d.detail)<32765?-d.detail*20:d.detail?d.detail/-32765*60:0}function us(d,b){var S=b.relatedTarget;if(!S)return!0;try{for(;S&&S!==d;)S=S.parentNode}catch{return!1}return S!==d}var dp={__proto__:null,on:Bt,off:bt,stopPropagation:qi,disableScrollPropagation:Na,disableClickPropagation:qo,preventDefault:Pn,stop:Po,getPropagationPath:cs,getMousePosition:iu,getWheelDelta:za,isExternalTarget:us,addListener:Bt,removeListener:bt},ph=yt.extend({run:function(d,b,S,F){this.stop(),this._el=d,this._inProgress=!0,this._duration=S||.25,this._easeOutPower=1/Math.max(F||.5,.2),this._startPos=ll(d),this._offset=b.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=it(this._animate,this),this._step()},_step:function(d){var b=+new Date-this._startTime,S=this._duration*1e3;b<S?this._runFrame(this._easeOut(b/S),d):(this._runFrame(1),this._complete())},_runFrame:function(d,b){var S=this._startPos.add(this._offset.multiplyBy(d));b&&S._round(),ji(this._el,S),this.fire("step")},_complete:function(){pt(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(d){return 1-Math.pow(1-d,this._easeOutPower)}}),yn=yt.extend({options:{crs:ss,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(d,b){b=q(this,b),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(d),this._initLayout(),this._onResize=a(this._onResize,this),this._initEvents(),b.maxBounds&&this.setMaxBounds(b.maxBounds),b.zoom!==void 0&&(this._zoom=this._limitZoom(b.zoom)),b.center&&b.zoom!==void 0&&this.setView(Rt(b.center),b.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=bs&&De.any3d&&!De.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Bt(this._proxy,Ql,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(d,b,S){if(b=b===void 0?this._zoom:this._limitZoom(b),d=this._limitCenter(Rt(d),b,this.options.maxBounds),S=S||{},this._stop(),this._loaded&&!S.reset&&S!==!0){S.animate!==void 0&&(S.zoom=t({animate:S.animate},S.zoom),S.pan=t({animate:S.animate,duration:S.duration},S.pan));var F=this._zoom!==b?this._tryAnimatedZoom&&this._tryAnimatedZoom(d,b,S.zoom):this._tryAnimatedPan(d,S.pan);if(F)return clearTimeout(this._sizeTimer),this}return this._resetView(d,b,S.pan&&S.pan.noMoveStart),this},setZoom:function(d,b){return this._loaded?this.setView(this.getCenter(),d,{zoom:b}):(this._zoom=d,this)},zoomIn:function(d,b){return d=d||(De.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+d,b)},zoomOut:function(d,b){return d=d||(De.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-d,b)},setZoomAround:function(d,b,S){var F=this.getZoomScale(b),$=this.getSize().divideBy(2),ie=d instanceof dt?d:this.latLngToContainerPoint(d),we=ie.subtract($).multiplyBy(1-1/F),Fe=this.containerPointToLatLng($.add(we));return this.setView(Fe,b,{zoom:S})},_getBoundsCenterZoom:function(d,b){b=b||{},d=d.getBounds?d.getBounds():et(d);var S=rt(b.paddingTopLeft||b.padding||[0,0]),F=rt(b.paddingBottomRight||b.padding||[0,0]),$=this.getBoundsZoom(d,!1,S.add(F));if($=typeof b.maxZoom=="number"?Math.min(b.maxZoom,$):$,$===1/0)return{center:d.getCenter(),zoom:$};var ie=F.subtract(S).divideBy(2),we=this.project(d.getSouthWest(),$),Fe=this.project(d.getNorthEast(),$),He=this.unproject(we.add(Fe).divideBy(2).add(ie),$);return{center:He,zoom:$}},fitBounds:function(d,b){if(d=et(d),!d.isValid())throw new Error("Bounds are not valid.");var S=this._getBoundsCenterZoom(d,b);return this.setView(S.center,S.zoom,b)},fitWorld:function(d){return this.fitBounds([[-90,-180],[90,180]],d)},panTo:function(d,b){return this.setView(d,this._zoom,{pan:b})},panBy:function(d,b){if(d=rt(d).round(),b=b||{},!d.x&&!d.y)return this.fire("moveend");if(b.animate!==!0&&!this.getSize().contains(d))return this._resetView(this.unproject(this.project(this.getCenter()).add(d)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new ph,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),b.noMoveStart||this.fire("movestart"),b.animate!==!1){cn(this._mapPane,"leaflet-pan-anim");var S=this._getMapPanePos().subtract(d).round();this._panAnim.run(this._mapPane,S,b.duration||.25,b.easeLinearity)}else this._rawPanBy(d),this.fire("move").fire("moveend");return this},flyTo:function(d,b,S){if(S=S||{},S.animate===!1||!De.any3d)return this.setView(d,b,S);this._stop();var F=this.project(this.getCenter()),$=this.project(d),ie=this.getSize(),we=this._zoom;d=Rt(d),b=b===void 0?we:b;var Fe=Math.max(ie.x,ie.y),He=Fe*this.getZoomScale(we,b),at=$.distanceTo(F)||1,It=1.42,Jt=It*It;function wn(Ai){var Ga=Ai?-1:1,Ih=Ai?He:Fe,$a=He*He-Fe*Fe+Ga*Jt*Jt*at*at,fu=2*Ih*Jt*at,ua=$a/fu,vl=Math.sqrt(ua*ua+1)-ua,Rp=vl<1e-9?-18:Math.log(vl);return Rp}function rr(Ai){return(Math.exp(Ai)-Math.exp(-Ai))/2}function Xi(Ai){return(Math.exp(Ai)+Math.exp(-Ai))/2}function Oo(Ai){return rr(Ai)/Xi(Ai)}var Xr=wn(0);function Ds(Ai){return Fe*(Xi(Xr)/Xi(Xr+It*Ai))}function Ch(Ai){return Fe*(Xi(Xr)*Oo(Xr+It*Ai)-rr(Xr))/Jt}function Pp(Ai){return 1-Math.pow(1-Ai,1.5)}var Ap=Date.now(),Pi=(wn(1)-Xr)/It,yl=S.duration?1e3*S.duration:1e3*Pi*.8;function uo(){var Ai=(Date.now()-Ap)/yl,Ga=Pp(Ai)*Pi;Ai<=1?(this._flyToFrame=it(uo,this),this._move(this.unproject(F.add($.subtract(F).multiplyBy(Ch(Ga)/at)),we),this.getScaleZoom(Fe/Ds(Ga),we),{flyTo:!0})):this._move(d,b)._moveEnd(!0)}return this._moveStart(!0,S.noMoveStart),uo.call(this),this},flyToBounds:function(d,b){var S=this._getBoundsCenterZoom(d,b);return this.flyTo(S.center,S.zoom,b)},setMaxBounds:function(d){return d=et(d),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),d.isValid()?(this.options.maxBounds=d,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(d){var b=this.options.minZoom;return this.options.minZoom=d,this._loaded&&b!==d&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(d):this},setMaxZoom:function(d){var b=this.options.maxZoom;return this.options.maxZoom=d,this._loaded&&b!==d&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(d):this},panInsideBounds:function(d,b){this._enforcingBounds=!0;var S=this.getCenter(),F=this._limitCenter(S,this._zoom,et(d));return S.equals(F)||this.panTo(F,b),this._enforcingBounds=!1,this},panInside:function(d,b){b=b||{};var S=rt(b.paddingTopLeft||b.padding||[0,0]),F=rt(b.paddingBottomRight||b.padding||[0,0]),$=this.project(this.getCenter()),ie=this.project(d),we=this.getPixelBounds(),Fe=$t([we.min.add(S),we.max.subtract(F)]),He=Fe.getSize();if(!Fe.contains(ie)){this._enforcingBounds=!0;var at=ie.subtract(Fe.getCenter()),It=Fe.extend(ie).getSize().subtract(He);$.x+=at.x<0?-It.x:It.x,$.y+=at.y<0?-It.y:It.y,this.panTo(this.unproject($),b),this._enforcingBounds=!1}return this},invalidateSize:function(d){if(!this._loaded)return this;d=t({animate:!1,pan:!0},d===!0?{animate:!0}:d);var b=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var S=this.getSize(),F=b.divideBy(2).round(),$=S.divideBy(2).round(),ie=F.subtract($);return!ie.x&&!ie.y?this:(d.animate&&d.pan?this.panBy(ie):(d.pan&&this._rawPanBy(ie),this.fire("move"),d.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(a(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:b,newSize:S}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(d){if(d=this._locateOptions=t({timeout:1e4,watch:!1},d),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var b=a(this._handleGeolocationResponse,this),S=a(this._handleGeolocationError,this);return d.watch?this._locationWatchId=navigator.geolocation.watchPosition(b,S,d):navigator.geolocation.getCurrentPosition(b,S,d),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(d){if(this._container._leaflet_id){var b=d.code,S=d.message||(b===1?"permission denied":b===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:b,message:"Geolocation error: "+S+"."})}},_handleGeolocationResponse:function(d){if(this._container._leaflet_id){var b=d.coords.latitude,S=d.coords.longitude,F=new Zt(b,S),$=F.toBounds(d.coords.accuracy*2),ie=this._locateOptions;if(ie.setView){var we=this.getBoundsZoom($);this.setView(F,ie.maxZoom?Math.min(we,ie.maxZoom):we)}var Fe={latlng:F,bounds:$,timestamp:d.timestamp};for(var He in d.coords)typeof d.coords[He]=="number"&&(Fe[He]=d.coords[He]);this.fire("locationfound",Fe)}},addHandler:function(d,b){if(!b)return this;var S=this[d]=new b(this);return this._handlers.push(S),this.options[d]&&S.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),ii(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(pt(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var d;for(d in this._layers)this._layers[d].remove();for(d in this._panes)ii(this._panes[d]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(d,b){var S="leaflet-pane"+(d?" leaflet-"+d.replace("Pane","")+"-pane":""),F=jn("div",S,b||this._mapPane);return d&&(this._panes[d]=F),F},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var d=this.getPixelBounds(),b=this.unproject(d.getBottomLeft()),S=this.unproject(d.getTopRight());return new Qt(b,S)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(d,b,S){d=et(d),S=rt(S||[0,0]);var F=this.getZoom()||0,$=this.getMinZoom(),ie=this.getMaxZoom(),we=d.getNorthWest(),Fe=d.getSouthEast(),He=this.getSize().subtract(S),at=$t(this.project(Fe,F),this.project(we,F)).getSize(),It=De.any3d?this.options.zoomSnap:1,Jt=He.x/at.x,wn=He.y/at.y,rr=b?Math.max(Jt,wn):Math.min(Jt,wn);return F=this.getScaleZoom(rr,F),It&&(F=Math.round(F/(It/100))*(It/100),F=b?Math.ceil(F/It)*It:Math.floor(F/It)*It),Math.max($,Math.min(ie,F))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new dt(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(d,b){var S=this._getTopLeftPoint(d,b);return new Dt(S,S.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(d){return this.options.crs.getProjectedBounds(d===void 0?this.getZoom():d)},getPane:function(d){return typeof d=="string"?this._panes[d]:d},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(d,b){var S=this.options.crs;return b=b===void 0?this._zoom:b,S.scale(d)/S.scale(b)},getScaleZoom:function(d,b){var S=this.options.crs;b=b===void 0?this._zoom:b;var F=S.zoom(d*S.scale(b));return isNaN(F)?1/0:F},project:function(d,b){return b=b===void 0?this._zoom:b,this.options.crs.latLngToPoint(Rt(d),b)},unproject:function(d,b){return b=b===void 0?this._zoom:b,this.options.crs.pointToLatLng(rt(d),b)},layerPointToLatLng:function(d){var b=rt(d).add(this.getPixelOrigin());return this.unproject(b)},latLngToLayerPoint:function(d){var b=this.project(Rt(d))._round();return b._subtract(this.getPixelOrigin())},wrapLatLng:function(d){return this.options.crs.wrapLatLng(Rt(d))},wrapLatLngBounds:function(d){return this.options.crs.wrapLatLngBounds(et(d))},distance:function(d,b){return this.options.crs.distance(Rt(d),Rt(b))},containerPointToLayerPoint:function(d){return rt(d).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(d){return rt(d).add(this._getMapPanePos())},containerPointToLatLng:function(d){var b=this.containerPointToLayerPoint(rt(d));return this.layerPointToLatLng(b)},latLngToContainerPoint:function(d){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Rt(d)))},mouseEventToContainerPoint:function(d){return iu(d,this._container)},mouseEventToLayerPoint:function(d){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(d))},mouseEventToLatLng:function(d){return this.layerPointToLatLng(this.mouseEventToLayerPoint(d))},_initContainer:function(d){var b=this._container=Oa(d);if(b){if(b._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Bt(b,"scroll",this._onScroll,this),this._containerId=f(b)},_initLayout:function(){var d=this._container;this._fadeAnimated=this.options.fadeAnimation&&De.any3d,cn(d,"leaflet-container"+(De.touch?" leaflet-touch":"")+(De.retina?" leaflet-retina":"")+(De.ielt9?" leaflet-oldie":"")+(De.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var b=Zr(d,"position");b!=="absolute"&&b!=="relative"&&b!=="fixed"&&b!=="sticky"&&(d.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var d=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),ji(this._mapPane,new dt(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(cn(d.markerPane,"leaflet-zoom-hide"),cn(d.shadowPane,"leaflet-zoom-hide"))},_resetView:function(d,b,S){ji(this._mapPane,new dt(0,0));var F=!this._loaded;this._loaded=!0,b=this._limitZoom(b),this.fire("viewprereset");var $=this._zoom!==b;this._moveStart($,S)._move(d,b)._moveEnd($),this.fire("viewreset"),F&&this.fire("load")},_moveStart:function(d,b){return d&&this.fire("zoomstart"),b||this.fire("movestart"),this},_move:function(d,b,S,F){b===void 0&&(b=this._zoom);var $=this._zoom!==b;return this._zoom=b,this._lastCenter=d,this._pixelOrigin=this._getNewPixelOrigin(d),F?S&&S.pinch&&this.fire("zoom",S):(($||S&&S.pinch)&&this.fire("zoom",S),this.fire("move",S)),this},_moveEnd:function(d){return d&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return pt(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(d){ji(this._mapPane,this._getMapPanePos().subtract(d))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(d){this._targets={},this._targets[f(this._container)]=this;var b=d?bt:Bt;b(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&b(window,"resize",this._onResize,this),De.any3d&&this.options.transform3DLimit&&(d?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){pt(this._resizeRequest),this._resizeRequest=it(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var d=this._getMapPanePos();Math.max(Math.abs(d.x),Math.abs(d.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(d,b){for(var S=[],F,$=b==="mouseout"||b==="mouseover",ie=d.target||d.srcElement,we=!1;ie;){if(F=this._targets[f(ie)],F&&(b==="click"||b==="preclick")&&this._draggableMoved(F)){we=!0;break}if(F&&F.listens(b,!0)&&($&&!us(ie,d)||(S.push(F),$))||ie===this._container)break;ie=ie.parentNode}return!S.length&&!we&&!$&&this.listens(b,!0)&&(S=[this]),S},_isClickDisabled:function(d){for(;d&&d!==this._container;){if(d._leaflet_disable_click)return!0;d=d.parentNode}},_handleDOMEvent:function(d){var b=d.target||d.srcElement;if(!(!this._loaded||b._leaflet_disable_events||d.type==="click"&&this._isClickDisabled(b))){var S=d.type;S==="mousedown"&&sn(b),this._fireDOMEvent(d,S)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(d,b,S){if(d.type==="click"){var F=t({},d);F.type="preclick",this._fireDOMEvent(F,F.type,S)}var $=this._findEventTargets(d,b);if(S){for(var ie=[],we=0;we<S.length;we++)S[we].listens(b,!0)&&ie.push(S[we]);$=ie.concat($)}if($.length){b==="contextmenu"&&Pn(d);var Fe=$[0],He={originalEvent:d};if(d.type!=="keypress"&&d.type!=="keydown"&&d.type!=="keyup"){var at=Fe.getLatLng&&(!Fe._radius||Fe._radius<=10);He.containerPoint=at?this.latLngToContainerPoint(Fe.getLatLng()):this.mouseEventToContainerPoint(d),He.layerPoint=this.containerPointToLayerPoint(He.containerPoint),He.latlng=at?Fe.getLatLng():this.layerPointToLatLng(He.layerPoint)}for(we=0;we<$.length;we++)if($[we].fire(b,He,!0),He.originalEvent._stopped||$[we].options.bubblingMouseEvents===!1&&Me(this._mouseEvents,b)!==-1)return}},_draggableMoved:function(d){return d=d.dragging&&d.dragging.enabled()?d:this,d.dragging&&d.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var d=0,b=this._handlers.length;d<b;d++)this._handlers[d].disable()},whenReady:function(d,b){return this._loaded?d.call(b||this,{target:this}):this.on("load",d,b),this},_getMapPanePos:function(){return ll(this._mapPane)||new dt(0,0)},_moved:function(){var d=this._getMapPanePos();return d&&!d.equals([0,0])},_getTopLeftPoint:function(d,b){var S=d&&b!==void 0?this._getNewPixelOrigin(d,b):this.getPixelOrigin();return S.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(d,b){var S=this.getSize()._divideBy(2);return this.project(d,b)._subtract(S)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(d,b,S){var F=this._getNewPixelOrigin(S,b);return this.project(d,b)._subtract(F)},_latLngBoundsToNewLayerBounds:function(d,b,S){var F=this._getNewPixelOrigin(S,b);return $t([this.project(d.getSouthWest(),b)._subtract(F),this.project(d.getNorthWest(),b)._subtract(F),this.project(d.getSouthEast(),b)._subtract(F),this.project(d.getNorthEast(),b)._subtract(F)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(d){return this.latLngToLayerPoint(d).subtract(this._getCenterLayerPoint())},_limitCenter:function(d,b,S){if(!S)return d;var F=this.project(d,b),$=this.getSize().divideBy(2),ie=new Dt(F.subtract($),F.add($)),we=this._getBoundsOffset(ie,S,b);return Math.abs(we.x)<=1&&Math.abs(we.y)<=1?d:this.unproject(F.add(we),b)},_limitOffset:function(d,b){if(!b)return d;var S=this.getPixelBounds(),F=new Dt(S.min.add(d),S.max.add(d));return d.add(this._getBoundsOffset(F,b))},_getBoundsOffset:function(d,b,S){var F=$t(this.project(b.getNorthEast(),S),this.project(b.getSouthWest(),S)),$=F.min.subtract(d.min),ie=F.max.subtract(d.max),we=this._rebound($.x,-ie.x),Fe=this._rebound($.y,-ie.y);return new dt(we,Fe)},_rebound:function(d,b){return d+b>0?Math.round(d-b)/2:Math.max(0,Math.ceil(d))-Math.max(0,Math.floor(b))},_limitZoom:function(d){var b=this.getMinZoom(),S=this.getMaxZoom(),F=De.any3d?this.options.zoomSnap:1;return F&&(d=Math.round(d/F)*F),Math.max(b,Math.min(S,d))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Bi(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(d,b){var S=this._getCenterOffset(d)._trunc();return(b&&b.animate)!==!0&&!this.getSize().contains(S)?!1:(this.panBy(S,b),!0)},_createAnimProxy:function(){var d=this._proxy=jn("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(d),this.on("zoomanim",function(b){var S=Jl,F=this._proxy.style[S];ea(this._proxy,this.project(b.center,b.zoom),this.getZoomScale(b.zoom,1)),F===this._proxy.style[S]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){ii(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var d=this.getCenter(),b=this.getZoom();ea(this._proxy,this.project(d,b),this.getZoomScale(b,1))},_catchTransitionEnd:function(d){this._animatingZoom&&d.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(d,b,S){if(this._animatingZoom)return!0;if(S=S||{},!this._zoomAnimated||S.animate===!1||this._nothingToAnimate()||Math.abs(b-this._zoom)>this.options.zoomAnimationThreshold)return!1;var F=this.getZoomScale(b),$=this._getCenterOffset(d)._divideBy(1-1/F);return S.animate!==!0&&!this.getSize().contains($)?!1:(it(function(){this._moveStart(!0,S.noMoveStart||!1)._animateZoom(d,b,!0)},this),!0)},_animateZoom:function(d,b,S,F){this._mapPane&&(S&&(this._animatingZoom=!0,this._animateToCenter=d,this._animateToZoom=b,cn(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:d,zoom:b,noUpdate:F}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(a(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Bi(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function li(d,b){return new yn(d,b)}var Ir=Pt.extend({options:{position:"topright"},initialize:function(d){q(this,d)},getPosition:function(){return this.options.position},setPosition:function(d){var b=this._map;return b&&b.removeControl(this),this.options.position=d,b&&b.addControl(this),this},getContainer:function(){return this._container},addTo:function(d){this.remove(),this._map=d;var b=this._container=this.onAdd(d),S=this.getPosition(),F=d._controlCorners[S];return cn(b,"leaflet-control"),S.indexOf("bottom")!==-1?F.insertBefore(b,F.firstChild):F.appendChild(b),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(ii(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(d){this._map&&d&&d.screenX>0&&d.screenY>0&&this._map.getContainer().focus()}}),mn=function(d){return new Ir(d)};yn.include({addControl:function(d){return d.addTo(this),this},removeControl:function(d){return d.remove(),this},_initControlPos:function(){var d=this._controlCorners={},b="leaflet-",S=this._controlContainer=jn("div",b+"control-container",this._container);function F($,ie){var we=b+$+" "+b+ie;d[$+ie]=jn("div",we,S)}F("top","left"),F("top","right"),F("bottom","left"),F("bottom","right")},_clearControlPos:function(){for(var d in this._controlCorners)ii(this._controlCorners[d]);ii(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var rn=Ir.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(d,b,S,F){return S<F?-1:F<S?1:0}},initialize:function(d,b,S){q(this,S),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var F in d)this._addLayer(d[F],F);for(F in b)this._addLayer(b[F],F,!0)},onAdd:function(d){this._initLayout(),this._update(),this._map=d,d.on("zoomend",this._checkDisabledLayers,this);for(var b=0;b<this._layers.length;b++)this._layers[b].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(d){return Ir.prototype.addTo.call(this,d),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var d=0;d<this._layers.length;d++)this._layers[d].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(d,b){return this._addLayer(d,b),this._map?this._update():this},addOverlay:function(d,b){return this._addLayer(d,b,!0),this._map?this._update():this},removeLayer:function(d){d.off("add remove",this._onLayerChange,this);var b=this._getLayer(f(d));return b&&this._layers.splice(this._layers.indexOf(b),1),this._map?this._update():this},expand:function(){cn(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var d=this._map.getSize().y-(this._container.offsetTop+50);return d<this._section.clientHeight?(cn(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=d+"px"):Bi(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Bi(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var d="leaflet-control-layers",b=this._container=jn("div",d),S=this.options.collapsed;b.setAttribute("aria-haspopup",!0),qo(b),Na(b);var F=this._section=jn("section",d+"-list");S&&(this._map.on("click",this.collapse,this),Bt(b,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var $=this._layersLink=jn("a",d+"-toggle",b);$.href="#",$.title="Layers",$.setAttribute("role","button"),Bt($,{keydown:function(ie){ie.keyCode===13&&this._expandSafely()},click:function(ie){Pn(ie),this._expandSafely()}},this),S||this.expand(),this._baseLayersList=jn("div",d+"-base",F),this._separator=jn("div",d+"-separator",F),this._overlaysList=jn("div",d+"-overlays",F),b.appendChild(F)},_getLayer:function(d){for(var b=0;b<this._layers.length;b++)if(this._layers[b]&&f(this._layers[b].layer)===d)return this._layers[b]},_addLayer:function(d,b,S){this._map&&d.on("add remove",this._onLayerChange,this),this._layers.push({layer:d,name:b,overlay:S}),this.options.sortLayers&&this._layers.sort(a(function(F,$){return this.options.sortFunction(F.layer,$.layer,F.name,$.name)},this)),this.options.autoZIndex&&d.setZIndex&&(this._lastZIndex++,d.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;sl(this._baseLayersList),sl(this._overlaysList),this._layerControlInputs=[];var d,b,S,F,$=0;for(S=0;S<this._layers.length;S++)F=this._layers[S],this._addItem(F),b=b||F.overlay,d=d||!F.overlay,$+=F.overlay?0:1;return this.options.hideSingleBase&&(d=d&&$>1,this._baseLayersList.style.display=d?"":"none"),this._separator.style.display=b&&d?"":"none",this},_onLayerChange:function(d){this._handlingClick||this._update();var b=this._getLayer(f(d.target)),S=b.overlay?d.type==="add"?"overlayadd":"overlayremove":d.type==="add"?"baselayerchange":null;S&&this._map.fire(S,b)},_createRadioElement:function(d,b){var S='<input type="radio" class="leaflet-control-layers-selector" name="'+d+'"'+(b?' checked="checked"':"")+"/>",F=document.createElement("div");return F.innerHTML=S,F.firstChild},_addItem:function(d){var b=document.createElement("label"),S=this._map.hasLayer(d.layer),F;d.overlay?(F=document.createElement("input"),F.type="checkbox",F.className="leaflet-control-layers-selector",F.defaultChecked=S):F=this._createRadioElement("leaflet-base-layers_"+f(this),S),this._layerControlInputs.push(F),F.layerId=f(d.layer),Bt(F,"click",this._onInputClick,this);var $=document.createElement("span");$.innerHTML=" "+d.name;var ie=document.createElement("span");b.appendChild(ie),ie.appendChild(F),ie.appendChild($);var we=d.overlay?this._overlaysList:this._baseLayersList;return we.appendChild(b),this._checkDisabledLayers(),b},_onInputClick:function(){if(!this._preventClick){var d=this._layerControlInputs,b,S,F=[],$=[];this._handlingClick=!0;for(var ie=d.length-1;ie>=0;ie--)b=d[ie],S=this._getLayer(b.layerId).layer,b.checked?F.push(S):b.checked||$.push(S);for(ie=0;ie<$.length;ie++)this._map.hasLayer($[ie])&&this._map.removeLayer($[ie]);for(ie=0;ie<F.length;ie++)this._map.hasLayer(F[ie])||this._map.addLayer(F[ie]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var d=this._layerControlInputs,b,S,F=this._map.getZoom(),$=d.length-1;$>=0;$--)b=d[$],S=this._getLayer(b.layerId).layer,b.disabled=S.options.minZoom!==void 0&&F<S.options.minZoom||S.options.maxZoom!==void 0&&F>S.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var d=this._section;this._preventClick=!0,Bt(d,"click",Pn),this.expand();var b=this;setTimeout(function(){bt(d,"click",Pn),b._preventClick=!1})}}),nc=function(d,b,S){return new rn(d,b,S)},An=Ir.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(d){var b="leaflet-control-zoom",S=jn("div",b+" leaflet-bar"),F=this.options;return this._zoomInButton=this._createButton(F.zoomInText,F.zoomInTitle,b+"-in",S,this._zoomIn),this._zoomOutButton=this._createButton(F.zoomOutText,F.zoomOutTitle,b+"-out",S,this._zoomOut),this._updateDisabled(),d.on("zoomend zoomlevelschange",this._updateDisabled,this),S},onRemove:function(d){d.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(d){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(d.shiftKey?3:1))},_zoomOut:function(d){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(d.shiftKey?3:1))},_createButton:function(d,b,S,F,$){var ie=jn("a",S,F);return ie.innerHTML=d,ie.href="#",ie.title=b,ie.setAttribute("role","button"),ie.setAttribute("aria-label",b),qo(ie),Bt(ie,"click",Po),Bt(ie,"click",$,this),Bt(ie,"click",this._refocusOnMap,this),ie},_updateDisabled:function(){var d=this._map,b="leaflet-disabled";Bi(this._zoomInButton,b),Bi(this._zoomOutButton,b),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||d._zoom===d.getMinZoom())&&(cn(this._zoomOutButton,b),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||d._zoom===d.getMaxZoom())&&(cn(this._zoomInButton,b),this._zoomInButton.setAttribute("aria-disabled","true"))}});yn.mergeOptions({zoomControl:!0}),yn.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new An,this.addControl(this.zoomControl))});var ru=function(d){return new An(d)},Ao=Ir.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(d){var b="leaflet-control-scale",S=jn("div",b),F=this.options;return this._addScales(F,b+"-line",S),d.on(F.updateWhenIdle?"moveend":"move",this._update,this),d.whenReady(this._update,this),S},onRemove:function(d){d.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(d,b,S){d.metric&&(this._mScale=jn("div",b,S)),d.imperial&&(this._iScale=jn("div",b,S))},_update:function(){var d=this._map,b=d.getSize().y/2,S=d.distance(d.containerPointToLatLng([0,b]),d.containerPointToLatLng([this.options.maxWidth,b]));this._updateScales(S)},_updateScales:function(d){this.options.metric&&d&&this._updateMetric(d),this.options.imperial&&d&&this._updateImperial(d)},_updateMetric:function(d){var b=this._getRoundNum(d),S=b<1e3?b+" m":b/1e3+" km";this._updateScale(this._mScale,S,b/d)},_updateImperial:function(d){var b=d*3.2808399,S,F,$;b>5280?(S=b/5280,F=this._getRoundNum(S),this._updateScale(this._iScale,F+" mi",F/S)):($=this._getRoundNum(b),this._updateScale(this._iScale,$+" ft",$/b))},_updateScale:function(d,b,S){d.style.width=Math.round(this.options.maxWidth*S)+"px",d.innerHTML=b},_getRoundNum:function(d){var b=Math.pow(10,(Math.floor(d)+"").length-1),S=d/b;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:1,b*S}}),ic=function(d){return new Ao(d)},Ba='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',mh=Ir.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(De.inlineSvg?Ba+" ":"")+"Leaflet</a>"},initialize:function(d){q(this,d),this._attributions={}},onAdd:function(d){d.attributionControl=this,this._container=jn("div","leaflet-control-attribution"),qo(this._container);for(var b in d._layers)d._layers[b].getAttribution&&this.addAttribution(d._layers[b].getAttribution());return this._update(),d.on("layeradd",this._addAttribution,this),this._container},onRemove:function(d){d.off("layeradd",this._addAttribution,this)},_addAttribution:function(d){d.layer.getAttribution&&(this.addAttribution(d.layer.getAttribution()),d.layer.once("remove",function(){this.removeAttribution(d.layer.getAttribution())},this))},setPrefix:function(d){return this.options.prefix=d,this._update(),this},addAttribution:function(d){return d?(this._attributions[d]||(this._attributions[d]=0),this._attributions[d]++,this._update(),this):this},removeAttribution:function(d){return d?(this._attributions[d]&&(this._attributions[d]--,this._update()),this):this},_update:function(){if(this._map){var d=[];for(var b in this._attributions)this._attributions[b]&&d.push(b);var S=[];this.options.prefix&&S.push(this.options.prefix),d.length&&S.push(d.join(", ")),this._container.innerHTML=S.join(' <span aria-hidden="true">|</span> ')}}});yn.mergeOptions({attributionControl:!0}),yn.addInitHook(function(){this.options.attributionControl&&new mh().addTo(this)});var ou=function(d){return new mh(d)};Ir.Layers=rn,Ir.Zoom=An,Ir.Scale=Ao,Ir.Attribution=mh,mn.layers=nc,mn.zoom=ru,mn.scale=ic,mn.attribution=ou;var Wo=Pt.extend({initialize:function(d){this._map=d},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Wo.addTo=function(d,b){return d.addHandler(b,this),this};var Jg={Events:Gt},Id=De.touch?"touchstart mousedown":"mousedown",Vi=yt.extend({options:{clickTolerance:3},initialize:function(d,b,S,F){q(this,F),this._element=d,this._dragStartTarget=b||d,this._preventOutline=S},enable:function(){this._enabled||(Bt(this._dragStartTarget,Id,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Vi._dragging===this&&this.finishDrag(!0),bt(this._dragStartTarget,Id,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(d){if(this._enabled&&(this._moved=!1,!hh(this._element,"leaflet-zoom-anim"))){if(d.touches&&d.touches.length!==1){Vi._dragging===this&&this.finishDrag();return}if(!(Vi._dragging||d.shiftKey||d.which!==1&&d.button!==1&&!d.touches)&&(Vi._dragging=this,this._preventOutline&&sn(this._element),tu(),ta(),!this._moving)){this.fire("down");var b=d.touches?d.touches[0]:d,S=hp(this._element);this._startPoint=new dt(b.clientX,b.clientY),this._startPos=ll(this._element),this._parentScale=nu(S);var F=d.type==="mousedown";Bt(document,F?"mousemove":"touchmove",this._onMove,this),Bt(document,F?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(d){if(this._enabled){if(d.touches&&d.touches.length>1){this._moved=!0;return}var b=d.touches&&d.touches.length===1?d.touches[0]:d,S=new dt(b.clientX,b.clientY)._subtract(this._startPoint);!S.x&&!S.y||Math.abs(S.x)+Math.abs(S.y)<this.options.clickTolerance||(S.x/=this._parentScale.x,S.y/=this._parentScale.y,Pn(d),this._moved||(this.fire("dragstart"),this._moved=!0,cn(document.body,"leaflet-dragging"),this._lastTarget=d.target||d.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),cn(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(S),this._moving=!0,this._lastEvent=d,this._updatePosition())}},_updatePosition:function(){var d={originalEvent:this._lastEvent};this.fire("predrag",d),ji(this._element,this._newPos),this.fire("drag",d)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(d){Bi(document.body,"leaflet-dragging"),this._lastTarget&&(Bi(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),bt(document,"mousemove touchmove",this._onMove,this),bt(document,"mouseup touchend touchcancel",this._onUp,this),cl(),ka();var b=this._moved&&this._moving;this._moving=!1,Vi._dragging=!1,b&&this.fire("dragend",{noInertia:d,distance:this._newPos.distanceTo(this._startPos)})}});function hs(d,b,S){var F,$=[1,4,2,8],ie,we,Fe,He,at,It,Jt,wn;for(ie=0,It=d.length;ie<It;ie++)d[ie]._code=ra(d[ie],b);for(Fe=0;Fe<4;Fe++){for(Jt=$[Fe],F=[],ie=0,It=d.length,we=It-1;ie<It;we=ie++)He=d[ie],at=d[we],He._code&Jt?at._code&Jt||(wn=ia(at,He,Jt,b,S),wn._code=ra(wn,b),F.push(wn)):(at._code&Jt&&(wn=ia(at,He,Jt,b,S),wn._code=ra(wn,b),F.push(wn)),F.push(He));d=F}return d}function mi(d,b){var S,F,$,ie,we,Fe,He,at,It;if(!d||d.length===0)throw new Error("latlngs not passed");xr(d)||(console.warn("latlngs are not flat! Only the first ring will be used"),d=d[0]);var Jt=Rt([0,0]),wn=et(d),rr=wn.getNorthWest().distanceTo(wn.getSouthWest())*wn.getNorthEast().distanceTo(wn.getNorthWest());rr<1700&&(Jt=na(d));var Xi=d.length,Oo=[];for(S=0;S<Xi;S++){var Xr=Rt(d[S]);Oo.push(b.project(Rt([Xr.lat-Jt.lat,Xr.lng-Jt.lng])))}for(Fe=He=at=0,S=0,F=Xi-1;S<Xi;F=S++)$=Oo[S],ie=Oo[F],we=$.y*ie.x-ie.y*$.x,He+=($.x+ie.x)*we,at+=($.y+ie.y)*we,Fe+=we*3;Fe===0?It=Oo[0]:It=[He/Fe,at/Fe];var Ds=b.unproject(rt(It));return Rt([Ds.lat+Jt.lat,Ds.lng+Jt.lng])}function na(d){for(var b=0,S=0,F=0,$=0;$<d.length;$++){var ie=Rt(d[$]);b+=ie.lat,S+=ie.lng,F++}return Rt([b/F,S/F])}var Sd={__proto__:null,clipPolygon:hs,polygonCenter:mi,centroid:na};function rc(d,b){if(!b||!d.length)return d.slice();var S=b*b;return d=Qg(d,S),d=Dd(d,S),d}function Ci(d,b,S){return Math.sqrt(Ts(d,b,S,!0))}function fp(d,b,S){return Ts(d,b,S)}function Dd(d,b){var S=d.length,F=typeof Uint8Array<"u"?Uint8Array:Array,$=new F(S);$[0]=$[S-1]=1,gh(d,$,b,0,S-1);var ie,we=[];for(ie=0;ie<S;ie++)$[ie]&&we.push(d[ie]);return we}function gh(d,b,S,F,$){var ie=0,we,Fe,He;for(Fe=F+1;Fe<=$-1;Fe++)He=Ts(d[Fe],d[F],d[$],!0),He>ie&&(we=Fe,ie=He);ie>S&&(b[we]=1,gh(d,b,S,F,we),gh(d,b,S,we,$))}function Qg(d,b){for(var S=[d[0]],F=1,$=0,ie=d.length;F<ie;F++)au(d[F],d[$])>b&&(S.push(d[F]),$=F);return $<ie-1&&S.push(d[ie-1]),S}var ul;function su(d,b,S,F,$){var ie=F?ul:ra(d,S),we=ra(b,S),Fe,He,at;for(ul=we;;){if(!(ie|we))return[d,b];if(ie&we)return!1;Fe=ie||we,He=ia(d,b,Fe,S,$),at=ra(He,S),Fe===ie?(d=He,ie=at):(b=He,we=at)}}function ia(d,b,S,F,$){var ie=b.x-d.x,we=b.y-d.y,Fe=F.min,He=F.max,at,It;return S&8?(at=d.x+ie*(He.y-d.y)/we,It=He.y):S&4?(at=d.x+ie*(Fe.y-d.y)/we,It=Fe.y):S&2?(at=He.x,It=d.y+we*(He.x-d.x)/ie):S&1&&(at=Fe.x,It=d.y+we*(Fe.x-d.x)/ie),new dt(at,It,$)}function ra(d,b){var S=0;return d.x<b.min.x?S|=1:d.x>b.max.x&&(S|=2),d.y<b.min.y?S|=4:d.y>b.max.y&&(S|=8),S}function au(d,b){var S=b.x-d.x,F=b.y-d.y;return S*S+F*F}function Ts(d,b,S,F){var $=b.x,ie=b.y,we=S.x-$,Fe=S.y-ie,He=we*we+Fe*Fe,at;return He>0&&(at=((d.x-$)*we+(d.y-ie)*Fe)/He,at>1?($=S.x,ie=S.y):at>0&&($+=we*at,ie+=Fe*at)),we=d.x-$,Fe=d.y-ie,F?we*we+Fe*Fe:new dt($,ie)}function xr(d){return!ue(d[0])||typeof d[0][0]!="object"&&typeof d[0][0]<"u"}function Wi(d){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),xr(d)}function Md(d,b){var S,F,$,ie,we,Fe,He,at;if(!d||d.length===0)throw new Error("latlngs not passed");xr(d)||(console.warn("latlngs are not flat! Only the first ring will be used"),d=d[0]);var It=Rt([0,0]),Jt=et(d),wn=Jt.getNorthWest().distanceTo(Jt.getSouthWest())*Jt.getNorthEast().distanceTo(Jt.getNorthWest());wn<1700&&(It=na(d));var rr=d.length,Xi=[];for(S=0;S<rr;S++){var Oo=Rt(d[S]);Xi.push(b.project(Rt([Oo.lat-It.lat,Oo.lng-It.lng])))}for(S=0,F=0;S<rr-1;S++)F+=Xi[S].distanceTo(Xi[S+1])/2;if(F===0)at=Xi[0];else for(S=0,ie=0;S<rr-1;S++)if(we=Xi[S],Fe=Xi[S+1],$=we.distanceTo(Fe),ie+=$,ie>F){He=(ie-F)/$,at=[Fe.x-He*(Fe.x-we.x),Fe.y-He*(Fe.y-we.y)];break}var Xr=b.unproject(rt(at));return Rt([Xr.lat+It.lat,Xr.lng+It.lng])}var oc={__proto__:null,simplify:rc,pointToSegmentDistance:Ci,closestPointOnSegment:fp,clipSegment:su,_getEdgeIntersection:ia,_getBitCode:ra,_sqClosestPointOnSegment:Ts,isFlat:xr,_flat:Wi,polylineCenter:Md},hl={project:function(d){return new dt(d.lng,d.lat)},unproject:function(d){return new Zt(d.y,d.x)},bounds:new Dt([-180,-90],[180,90])},oa={R:6378137,R_MINOR:6356752314245179e-9,bounds:new Dt([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(d){var b=Math.PI/180,S=this.R,F=d.lat*b,$=this.R_MINOR/S,ie=Math.sqrt(1-$*$),we=ie*Math.sin(F),Fe=Math.tan(Math.PI/4-F/2)/Math.pow((1-we)/(1+we),ie/2);return F=-S*Math.log(Math.max(Fe,1e-10)),new dt(d.lng*b*S,F)},unproject:function(d){for(var b=180/Math.PI,S=this.R,F=this.R_MINOR/S,$=Math.sqrt(1-F*F),ie=Math.exp(-d.y/S),we=Math.PI/2-2*Math.atan(ie),Fe=0,He=.1,at;Fe<15&&Math.abs(He)>1e-7;Fe++)at=$*Math.sin(we),at=Math.pow((1-at)/(1+at),$/2),He=Math.PI/2-2*Math.atan(ie*at)-we,we+=He;return new Zt(we*b,d.x*b/S)}},e_={__proto__:null,LonLat:hl,Mercator:oa,SphericalMercator:Zi},_h=t({},kn,{code:"EPSG:3395",projection:oa,transformation:(function(){var d=.5/(Math.PI*oa.R);return ti(d,.5,-d,.5)})()}),pp=t({},kn,{code:"EPSG:4326",projection:hl,transformation:ti(1/180,1,-1/180,.5)}),sc=t({},Sn,{projection:hl,transformation:ti(1,0,-1,0),scale:function(d){return Math.pow(2,d)},zoom:function(d){return Math.log(d)/Math.LN2},distance:function(d,b){var S=b.lng-d.lng,F=b.lat-d.lat;return Math.sqrt(S*S+F*F)},infinite:!0});Sn.Earth=kn,Sn.EPSG3395=_h,Sn.EPSG3857=ss,Sn.EPSG900913=zi,Sn.EPSG4326=pp,Sn.Simple=sc;var co=yt.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(d){return d.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(d){return d&&d.removeLayer(this),this},getPane:function(d){return this._map.getPane(d?this.options[d]||d:this.options.pane)},addInteractiveTarget:function(d){return this._map._targets[f(d)]=this,this},removeInteractiveTarget:function(d){return delete this._map._targets[f(d)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(d){var b=d.target;if(b.hasLayer(this)){if(this._map=b,this._zoomAnimated=b._zoomAnimated,this.getEvents){var S=this.getEvents();b.on(S,this),this.once("remove",function(){b.off(S,this)},this)}this.onAdd(b),this.fire("add"),b.fire("layeradd",{layer:this})}}});yn.include({addLayer:function(d){if(!d._layerAdd)throw new Error("The provided object is not a Layer.");var b=f(d);return this._layers[b]?this:(this._layers[b]=d,d._mapToAdd=this,d.beforeAdd&&d.beforeAdd(this),this.whenReady(d._layerAdd,d),this)},removeLayer:function(d){var b=f(d);return this._layers[b]?(this._loaded&&d.onRemove(this),delete this._layers[b],this._loaded&&(this.fire("layerremove",{layer:d}),d.fire("remove")),d._map=d._mapToAdd=null,this):this},hasLayer:function(d){return f(d)in this._layers},eachLayer:function(d,b){for(var S in this._layers)d.call(b,this._layers[S]);return this},_addLayers:function(d){d=d?ue(d)?d:[d]:[];for(var b=0,S=d.length;b<S;b++)this.addLayer(d[b])},_addZoomLimit:function(d){(!isNaN(d.options.maxZoom)||!isNaN(d.options.minZoom))&&(this._zoomBoundLayers[f(d)]=d,this._updateZoomLevels())},_removeZoomLimit:function(d){var b=f(d);this._zoomBoundLayers[b]&&(delete this._zoomBoundLayers[b],this._updateZoomLevels())},_updateZoomLevels:function(){var d=1/0,b=-1/0,S=this._getZoomSpan();for(var F in this._zoomBoundLayers){var $=this._zoomBoundLayers[F].options;d=$.minZoom===void 0?d:Math.min(d,$.minZoom),b=$.maxZoom===void 0?b:Math.max(b,$.maxZoom)}this._layersMaxZoom=b===-1/0?void 0:b,this._layersMinZoom=d===1/0?void 0:d,S!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var dl=co.extend({initialize:function(d,b){q(this,b),this._layers={};var S,F;if(d)for(S=0,F=d.length;S<F;S++)this.addLayer(d[S])},addLayer:function(d){var b=this.getLayerId(d);return this._layers[b]=d,this._map&&this._map.addLayer(d),this},removeLayer:function(d){var b=d in this._layers?d:this.getLayerId(d);return this._map&&this._layers[b]&&this._map.removeLayer(this._layers[b]),delete this._layers[b],this},hasLayer:function(d){var b=typeof d=="number"?d:this.getLayerId(d);return b in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(d){var b=Array.prototype.slice.call(arguments,1),S,F;for(S in this._layers)F=this._layers[S],F[d]&&F[d].apply(F,b);return this},onAdd:function(d){this.eachLayer(d.addLayer,d)},onRemove:function(d){this.eachLayer(d.removeLayer,d)},eachLayer:function(d,b){for(var S in this._layers)d.call(b,this._layers[S]);return this},getLayer:function(d){return this._layers[d]},getLayers:function(){var d=[];return this.eachLayer(d.push,d),d},setZIndex:function(d){return this.invoke("setZIndex",d)},getLayerId:function(d){return f(d)}}),mp=function(d,b){return new dl(d,b)},ds=dl.extend({addLayer:function(d){return this.hasLayer(d)?this:(d.addEventParent(this),dl.prototype.addLayer.call(this,d),this.fire("layeradd",{layer:d}))},removeLayer:function(d){return this.hasLayer(d)?(d in this._layers&&(d=this._layers[d]),d.removeEventParent(this),dl.prototype.removeLayer.call(this,d),this.fire("layerremove",{layer:d})):this},setStyle:function(d){return this.invoke("setStyle",d)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var d=new Qt;for(var b in this._layers){var S=this._layers[b];d.extend(S.getBounds?S.getBounds():S.getLatLng())}return d}}),Pd=function(d,b){return new ds(d,b)},ja=Pt.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(d){q(this,d)},createIcon:function(d){return this._createIcon("icon",d)},createShadow:function(d){return this._createIcon("shadow",d)},_createIcon:function(d,b){var S=this._getIconUrl(d);if(!S){if(d==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var F=this._createImg(S,b&&b.tagName==="IMG"?b:null);return this._setIconStyles(F,d),(this.options.crossOrigin||this.options.crossOrigin==="")&&(F.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),F},_setIconStyles:function(d,b){var S=this.options,F=S[b+"Size"];typeof F=="number"&&(F=[F,F]);var $=rt(F),ie=rt(b==="shadow"&&S.shadowAnchor||S.iconAnchor||$&&$.divideBy(2,!0));d.className="leaflet-marker-"+b+" "+(S.className||""),ie&&(d.style.marginLeft=-ie.x+"px",d.style.marginTop=-ie.y+"px"),$&&(d.style.width=$.x+"px",d.style.height=$.y+"px")},_createImg:function(d,b){return b=b||document.createElement("img"),b.src=d,b},_getIconUrl:function(d){return De.retina&&this.options[d+"RetinaUrl"]||this.options[d+"Url"]}});function gp(d){return new ja(d)}var ac=ja.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(d){return typeof ac.imagePath!="string"&&(ac.imagePath=this._detectIconPath()),(this.options.imagePath||ac.imagePath)+ja.prototype._getIconUrl.call(this,d)},_stripUrl:function(d){var b=function(S,F,$){var ie=F.exec(S);return ie&&ie[$]};return d=b(d,/^url\((['"])?(.+)\1\)$/,2),d&&b(d,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var d=jn("div","leaflet-default-icon-path",document.body),b=Zr(d,"background-image")||Zr(d,"backgroundImage");if(document.body.removeChild(d),b=this._stripUrl(b),b)return b;var S=document.querySelector('link[href$="leaflet.css"]');return S?S.href.substring(0,S.href.length-11-1):""}}),Ad=Wo.extend({initialize:function(d){this._marker=d},addHooks:function(){var d=this._marker._icon;this._draggable||(this._draggable=new Vi(d,d,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),cn(d,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Bi(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(d){var b=this._marker,S=b._map,F=this._marker.options.autoPanSpeed,$=this._marker.options.autoPanPadding,ie=ll(b._icon),we=S.getPixelBounds(),Fe=S.getPixelOrigin(),He=$t(we.min._subtract(Fe).add($),we.max._subtract(Fe).subtract($));if(!He.contains(ie)){var at=rt((Math.max(He.max.x,ie.x)-He.max.x)/(we.max.x-He.max.x)-(Math.min(He.min.x,ie.x)-He.min.x)/(we.min.x-He.min.x),(Math.max(He.max.y,ie.y)-He.max.y)/(we.max.y-He.max.y)-(Math.min(He.min.y,ie.y)-He.min.y)/(we.min.y-He.min.y)).multiplyBy(F);S.panBy(at,{animate:!1}),this._draggable._newPos._add(at),this._draggable._startPos._add(at),ji(b._icon,this._draggable._newPos),this._onDrag(d),this._panRequest=it(this._adjustPan.bind(this,d))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(d){this._marker.options.autoPan&&(pt(this._panRequest),this._panRequest=it(this._adjustPan.bind(this,d)))},_onDrag:function(d){var b=this._marker,S=b._shadow,F=ll(b._icon),$=b._map.layerPointToLatLng(F);S&&ji(S,F),b._latlng=$,d.latlng=$,d.oldLatLng=this._oldLatLng,b.fire("move",d).fire("drag",d)},_onDragEnd:function(d){pt(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",d)}}),Cs=co.extend({options:{icon:new ac,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(d,b){q(this,b),this._latlng=Rt(d)},onAdd:function(d){this._zoomAnimated=this._zoomAnimated&&d.options.markerZoomAnimation,this._zoomAnimated&&d.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(d){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&d.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(d){var b=this._latlng;return this._latlng=Rt(d),this.update(),this.fire("move",{oldLatLng:b,latlng:this._latlng})},setZIndexOffset:function(d){return this.options.zIndexOffset=d,this.update()},getIcon:function(){return this.options.icon},setIcon:function(d){return this.options.icon=d,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var d=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(d)}return this},_initIcon:function(){var d=this.options,b="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),S=d.icon.createIcon(this._icon),F=!1;S!==this._icon&&(this._icon&&this._removeIcon(),F=!0,d.title&&(S.title=d.title),S.tagName==="IMG"&&(S.alt=d.alt||"")),cn(S,b),d.keyboard&&(S.tabIndex="0",S.setAttribute("role","button")),this._icon=S,d.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Bt(S,"focus",this._panOnFocus,this);var $=d.icon.createShadow(this._shadow),ie=!1;$!==this._shadow&&(this._removeShadow(),ie=!0),$&&(cn($,b),$.alt=""),this._shadow=$,d.opacity<1&&this._updateOpacity(),F&&this.getPane().appendChild(this._icon),this._initInteraction(),$&&ie&&this.getPane(d.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&bt(this._icon,"focus",this._panOnFocus,this),ii(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&ii(this._shadow),this._shadow=null},_setPos:function(d){this._icon&&ji(this._icon,d),this._shadow&&ji(this._shadow,d),this._zIndex=d.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(d){this._icon&&(this._icon.style.zIndex=this._zIndex+d)},_animateZoom:function(d){var b=this._map._latLngToNewLayerPoint(this._latlng,d.zoom,d.center).round();this._setPos(b)},_initInteraction:function(){if(this.options.interactive&&(cn(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Ad)){var d=this.options.draggable;this.dragging&&(d=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Ad(this),d&&this.dragging.enable()}},setOpacity:function(d){return this.options.opacity=d,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var d=this.options.opacity;this._icon&&qr(this._icon,d),this._shadow&&qr(this._shadow,d)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var d=this._map;if(d){var b=this.options.icon.options,S=b.iconSize?rt(b.iconSize):rt(0,0),F=b.iconAnchor?rt(b.iconAnchor):rt(0,0);d.panInside(this._latlng,{paddingTopLeft:F,paddingBottomRight:S.subtract(F)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function _p(d,b){return new Cs(d,b)}var Is=co.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(d){this._renderer=d.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(d){return q(this,d),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&d&&Object.prototype.hasOwnProperty.call(d,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),sa=Is.extend({options:{fill:!0,radius:10},initialize:function(d,b){q(this,b),this._latlng=Rt(d),this._radius=this.options.radius},setLatLng:function(d){var b=this._latlng;return this._latlng=Rt(d),this.redraw(),this.fire("move",{oldLatLng:b,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(d){return this.options.radius=this._radius=d,this.redraw()},getRadius:function(){return this._radius},setStyle:function(d){var b=d&&d.radius||this._radius;return Is.prototype.setStyle.call(this,d),this.setRadius(b),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var d=this._radius,b=this._radiusY||d,S=this._clickTolerance(),F=[d+S,b+S];this._pxBounds=new Dt(this._point.subtract(F),this._point.add(F))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(d){return d.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function yp(d,b){return new sa(d,b)}var lc=sa.extend({initialize:function(d,b,S){if(typeof b=="number"&&(b=t({},S,{radius:b})),q(this,b),this._latlng=Rt(d),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(d){return this._mRadius=d,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var d=[this._radius,this._radiusY||this._radius];return new Qt(this._map.layerPointToLatLng(this._point.subtract(d)),this._map.layerPointToLatLng(this._point.add(d)))},setStyle:Is.prototype.setStyle,_project:function(){var d=this._latlng.lng,b=this._latlng.lat,S=this._map,F=S.options.crs;if(F.distance===kn.distance){var $=Math.PI/180,ie=this._mRadius/kn.R/$,we=S.project([b+ie,d]),Fe=S.project([b-ie,d]),He=we.add(Fe).divideBy(2),at=S.unproject(He).lat,It=Math.acos((Math.cos(ie*$)-Math.sin(b*$)*Math.sin(at*$))/(Math.cos(b*$)*Math.cos(at*$)))/$;(isNaN(It)||It===0)&&(It=ie/Math.cos(Math.PI/180*b)),this._point=He.subtract(S.getPixelOrigin()),this._radius=isNaN(It)?0:He.x-S.project([at,d-It]).x,this._radiusY=He.y-we.y}else{var Jt=F.unproject(F.project(this._latlng).subtract([this._mRadius,0]));this._point=S.latLngToLayerPoint(this._latlng),this._radius=this._point.x-S.latLngToLayerPoint(Jt).x}this._updateBounds()}});function t_(d,b,S){return new lc(d,b,S)}var aa=Is.extend({options:{smoothFactor:1,noClip:!1},initialize:function(d,b){q(this,b),this._setLatLngs(d)},getLatLngs:function(){return this._latlngs},setLatLngs:function(d){return this._setLatLngs(d),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(d){for(var b=1/0,S=null,F=Ts,$,ie,we=0,Fe=this._parts.length;we<Fe;we++)for(var He=this._parts[we],at=1,It=He.length;at<It;at++){$=He[at-1],ie=He[at];var Jt=F(d,$,ie,!0);Jt<b&&(b=Jt,S=F(d,$,ie))}return S&&(S.distance=Math.sqrt(b)),S},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Md(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(d,b){return b=b||this._defaultShape(),d=Rt(d),b.push(d),this._bounds.extend(d),this.redraw()},_setLatLngs:function(d){this._bounds=new Qt,this._latlngs=this._convertLatLngs(d)},_defaultShape:function(){return xr(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(d){for(var b=[],S=xr(d),F=0,$=d.length;F<$;F++)S?(b[F]=Rt(d[F]),this._bounds.extend(b[F])):b[F]=this._convertLatLngs(d[F]);return b},_project:function(){var d=new Dt;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,d),this._bounds.isValid()&&d.isValid()&&(this._rawPxBounds=d,this._updateBounds())},_updateBounds:function(){var d=this._clickTolerance(),b=new dt(d,d);this._rawPxBounds&&(this._pxBounds=new Dt([this._rawPxBounds.min.subtract(b),this._rawPxBounds.max.add(b)]))},_projectLatlngs:function(d,b,S){var F=d[0]instanceof Zt,$=d.length,ie,we;if(F){for(we=[],ie=0;ie<$;ie++)we[ie]=this._map.latLngToLayerPoint(d[ie]),S.extend(we[ie]);b.push(we)}else for(ie=0;ie<$;ie++)this._projectLatlngs(d[ie],b,S)},_clipPoints:function(){var d=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(d))){if(this.options.noClip){this._parts=this._rings;return}var b=this._parts,S,F,$,ie,we,Fe,He;for(S=0,$=0,ie=this._rings.length;S<ie;S++)for(He=this._rings[S],F=0,we=He.length;F<we-1;F++)Fe=su(He[F],He[F+1],d,F,!0),Fe&&(b[$]=b[$]||[],b[$].push(Fe[0]),(Fe[1]!==He[F+1]||F===we-2)&&(b[$].push(Fe[1]),$++))}},_simplifyPoints:function(){for(var d=this._parts,b=this.options.smoothFactor,S=0,F=d.length;S<F;S++)d[S]=rc(d[S],b)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(d,b){var S,F,$,ie,we,Fe,He=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(d))return!1;for(S=0,ie=this._parts.length;S<ie;S++)for(Fe=this._parts[S],F=0,we=Fe.length,$=we-1;F<we;$=F++)if(!(!b&&F===0)&&Ci(d,Fe[$],Fe[F])<=He)return!0;return!1}});function vp(d,b){return new aa(d,b)}aa._flat=Wi;var Ss=aa.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return mi(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(d){var b=aa.prototype._convertLatLngs.call(this,d),S=b.length;return S>=2&&b[0]instanceof Zt&&b[0].equals(b[S-1])&&b.pop(),b},_setLatLngs:function(d){aa.prototype._setLatLngs.call(this,d),xr(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return xr(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var d=this._renderer._bounds,b=this.options.weight,S=new dt(b,b);if(d=new Dt(d.min.subtract(S),d.max.add(S)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(d))){if(this.options.noClip){this._parts=this._rings;return}for(var F=0,$=this._rings.length,ie;F<$;F++)ie=hs(this._rings[F],d,!0),ie.length&&this._parts.push(ie)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(d){var b=!1,S,F,$,ie,we,Fe,He,at;if(!this._pxBounds||!this._pxBounds.contains(d))return!1;for(ie=0,He=this._parts.length;ie<He;ie++)for(S=this._parts[ie],we=0,at=S.length,Fe=at-1;we<at;Fe=we++)F=S[we],$=S[Fe],F.y>d.y!=$.y>d.y&&d.x<($.x-F.x)*(d.y-F.y)/($.y-F.y)+F.x&&(b=!b);return b||aa.prototype._containsPoint.call(this,d,!0)}});function xp(d,b){return new Ss(d,b)}var fs=ds.extend({initialize:function(d,b){q(this,b),this._layers={},d&&this.addData(d)},addData:function(d){var b=ue(d)?d:d.features,S,F,$;if(b){for(S=0,F=b.length;S<F;S++)$=b[S],($.geometries||$.geometry||$.features||$.coordinates)&&this.addData($);return this}var ie=this.options;if(ie.filter&&!ie.filter(d))return this;var we=lu(d,ie);return we?(we.feature=pl(d),we.defaultOptions=we.options,this.resetStyle(we),ie.onEachFeature&&ie.onEachFeature(d,we),this.addLayer(we)):this},resetStyle:function(d){return d===void 0?this.eachLayer(this.resetStyle,this):(d.options=t({},d.defaultOptions),this._setLayerStyle(d,this.options.style),this)},setStyle:function(d){return this.eachLayer(function(b){this._setLayerStyle(b,d)},this)},_setLayerStyle:function(d,b){d.setStyle&&(typeof b=="function"&&(b=b(d.feature)),d.setStyle(b))}});function lu(d,b){var S=d.type==="Feature"?d.geometry:d,F=S?S.coordinates:null,$=[],ie=b&&b.pointToLayer,we=b&&b.coordsToLatLng||Ro,Fe,He,at,It;if(!F&&!S)return null;switch(S.type){case"Point":return Fe=we(F),cu(ie,d,Fe,b);case"MultiPoint":for(at=0,It=F.length;at<It;at++)Fe=we(F[at]),$.push(cu(ie,d,Fe,b));return new ds($);case"LineString":case"MultiLineString":return He=fl(F,S.type==="LineString"?0:1,we),new aa(He,b);case"Polygon":case"MultiPolygon":return He=fl(F,S.type==="Polygon"?1:2,we),new Ss(He,b);case"GeometryCollection":for(at=0,It=S.geometries.length;at<It;at++){var Jt=lu({geometry:S.geometries[at],type:"Feature",properties:d.properties},b);Jt&&$.push(Jt)}return new ds($);case"FeatureCollection":for(at=0,It=S.features.length;at<It;at++){var wn=lu(S.features[at],b);wn&&$.push(wn)}return new ds($);default:throw new Error("Invalid GeoJSON object.")}}function cu(d,b,S,F){return d?d(b,S):new Cs(S,F&&F.markersInheritOptions&&F)}function Ro(d){return new Zt(d[1],d[0],d[2])}function fl(d,b,S){for(var F=[],$=0,ie=d.length,we;$<ie;$++)we=b?fl(d[$],b-1,S):(S||Ro)(d[$]),F.push(we);return F}function uu(d,b){return d=Rt(d),d.alt!==void 0?[A(d.lng,b),A(d.lat,b),A(d.alt,b)]:[A(d.lng,b),A(d.lat,b)]}function cc(d,b,S,F){for(var $=[],ie=0,we=d.length;ie<we;ie++)$.push(b?cc(d[ie],xr(d[ie])?0:b-1,S,F):uu(d[ie],F));return!b&&S&&$.length>0&&$.push($[0].slice()),$}function Va(d,b){return d.feature?t({},d.feature,{geometry:b}):pl(b)}function pl(d){return d.type==="Feature"||d.type==="FeatureCollection"?d:{type:"Feature",properties:{},geometry:d}}var la={toGeoJSON:function(d){return Va(this,{type:"Point",coordinates:uu(this.getLatLng(),d)})}};Cs.include(la),lc.include(la),sa.include(la),aa.include({toGeoJSON:function(d){var b=!xr(this._latlngs),S=cc(this._latlngs,b?1:0,!1,d);return Va(this,{type:(b?"Multi":"")+"LineString",coordinates:S})}}),Ss.include({toGeoJSON:function(d){var b=!xr(this._latlngs),S=b&&!xr(this._latlngs[0]),F=cc(this._latlngs,S?2:b?1:0,!0,d);return b||(F=[F]),Va(this,{type:(S?"Multi":"")+"Polygon",coordinates:F})}}),dl.include({toMultiPoint:function(d){var b=[];return this.eachLayer(function(S){b.push(S.toGeoJSON(d).geometry.coordinates)}),Va(this,{type:"MultiPoint",coordinates:b})},toGeoJSON:function(d){var b=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(b==="MultiPoint")return this.toMultiPoint(d);var S=b==="GeometryCollection",F=[];return this.eachLayer(function($){if($.toGeoJSON){var ie=$.toGeoJSON(d);if(S)F.push(ie.geometry);else{var we=pl(ie);we.type==="FeatureCollection"?F.push.apply(F,we.features):F.push(we)}}}),S?Va(this,{geometries:F,type:"GeometryCollection"}):{type:"FeatureCollection",features:F}}});function yh(d,b){return new fs(d,b)}var n_=yh,hu=co.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(d,b,S){this._url=d,this._bounds=et(b),q(this,S)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(cn(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){ii(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(d){return this.options.opacity=d,this._image&&this._updateOpacity(),this},setStyle:function(d){return d.opacity&&this.setOpacity(d.opacity),this},bringToFront:function(){return this._map&&ai(this._image),this},bringToBack:function(){return this._map&&al(this._image),this},setUrl:function(d){return this._url=d,this._image&&(this._image.src=d),this},setBounds:function(d){return this._bounds=et(d),this._map&&this._reset(),this},getEvents:function(){var d={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(d.zoomanim=this._animateZoom),d},setZIndex:function(d){return this.options.zIndex=d,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var d=this._url.tagName==="IMG",b=this._image=d?this._url:jn("img");if(cn(b,"leaflet-image-layer"),this._zoomAnimated&&cn(b,"leaflet-zoom-animated"),this.options.className&&cn(b,this.options.className),b.onselectstart=D,b.onmousemove=D,b.onload=a(this.fire,this,"load"),b.onerror=a(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(b.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),d){this._url=b.src;return}b.src=this._url,b.alt=this.options.alt},_animateZoom:function(d){var b=this._map.getZoomScale(d.zoom),S=this._map._latLngBoundsToNewLayerBounds(this._bounds,d.zoom,d.center).min;ea(this._image,S,b)},_reset:function(){var d=this._image,b=new Dt(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),S=b.getSize();ji(d,b.min),d.style.width=S.x+"px",d.style.height=S.y+"px"},_updateOpacity:function(){qr(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var d=this.options.errorOverlayUrl;d&&this._url!==d&&(this._url=d,this._image.src=d)},getCenter:function(){return this._bounds.getCenter()}}),i_=function(d,b,S){return new hu(d,b,S)},bp=hu.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var d=this._url.tagName==="VIDEO",b=this._image=d?this._url:jn("video");if(cn(b,"leaflet-image-layer"),this._zoomAnimated&&cn(b,"leaflet-zoom-animated"),this.options.className&&cn(b,this.options.className),b.onselectstart=D,b.onmousemove=D,b.onloadeddata=a(this.fire,this,"load"),d){for(var S=b.getElementsByTagName("source"),F=[],$=0;$<S.length;$++)F.push(S[$].src);this._url=S.length>0?F:[b.src];return}ue(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(b.style,"objectFit")&&(b.style.objectFit="fill"),b.autoplay=!!this.options.autoplay,b.loop=!!this.options.loop,b.muted=!!this.options.muted,b.playsInline=!!this.options.playsInline;for(var ie=0;ie<this._url.length;ie++){var we=jn("source");we.src=this._url[ie],b.appendChild(we)}}});function wp(d,b,S){return new bp(d,b,S)}var Ep=hu.extend({_initImage:function(){var d=this._image=this._url;cn(d,"leaflet-image-layer"),this._zoomAnimated&&cn(d,"leaflet-zoom-animated"),this.options.className&&cn(d,this.options.className),d.onselectstart=D,d.onmousemove=D}});function Un(d,b,S){return new Ep(d,b,S)}var Lo=co.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(d,b){d&&(d instanceof Zt||ue(d))?(this._latlng=Rt(d),q(this,b)):(q(this,d),this._source=b),this.options.content&&(this._content=this.options.content)},openOn:function(d){return d=arguments.length?d:this._source._map,d.hasLayer(this)||d.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(d){return this._map?this.close():(arguments.length?this._source=d:d=this._source,this._prepareOpen(),this.openOn(d._map)),this},onAdd:function(d){this._zoomAnimated=d._zoomAnimated,this._container||this._initLayout(),d._fadeAnimated&&qr(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),d._fadeAnimated&&qr(this._container,1),this.bringToFront(),this.options.interactive&&(cn(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(d){d._fadeAnimated?(qr(this._container,0),this._removeTimeout=setTimeout(a(ii,void 0,this._container),200)):ii(this._container),this.options.interactive&&(Bi(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(d){return this._latlng=Rt(d),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(d){return this._content=d,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var d={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(d.zoomanim=this._animateZoom),d},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&ai(this._container),this},bringToBack:function(){return this._map&&al(this._container),this},_prepareOpen:function(d){var b=this._source;if(!b._map)return!1;if(b instanceof ds){b=null;var S=this._source._layers;for(var F in S)if(S[F]._map){b=S[F];break}if(!b)return!1;this._source=b}if(!d)if(b.getCenter)d=b.getCenter();else if(b.getLatLng)d=b.getLatLng();else if(b.getBounds)d=b.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(d),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var d=this._contentNode,b=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof b=="string")d.innerHTML=b;else{for(;d.hasChildNodes();)d.removeChild(d.firstChild);d.appendChild(b)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var d=this._map.latLngToLayerPoint(this._latlng),b=rt(this.options.offset),S=this._getAnchor();this._zoomAnimated?ji(this._container,d.add(S)):b=b.add(d).add(S);var F=this._containerBottom=-b.y,$=this._containerLeft=-Math.round(this._containerWidth/2)+b.x;this._container.style.bottom=F+"px",this._container.style.left=$+"px"}},_getAnchor:function(){return[0,0]}});yn.include({_initOverlay:function(d,b,S,F){var $=b;return $ instanceof d||($=new d(F).setContent(b)),S&&$.setLatLng(S),$}}),co.include({_initOverlay:function(d,b,S,F){var $=S;return $ instanceof d?(q($,F),$._source=this):($=b&&!F?b:new d(F,this),$.setContent(S)),$}});var ml=Lo.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(d){return d=arguments.length?d:this._source._map,!d.hasLayer(this)&&d._popup&&d._popup.options.autoClose&&d.removeLayer(d._popup),d._popup=this,Lo.prototype.openOn.call(this,d)},onAdd:function(d){Lo.prototype.onAdd.call(this,d),d.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Is||this._source.on("preclick",qi))},onRemove:function(d){Lo.prototype.onRemove.call(this,d),d.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Is||this._source.off("preclick",qi))},getEvents:function(){var d=Lo.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(d.preclick=this.close),this.options.keepInView&&(d.moveend=this._adjustPan),d},_initLayout:function(){var d="leaflet-popup",b=this._container=jn("div",d+" "+(this.options.className||"")+" leaflet-zoom-animated"),S=this._wrapper=jn("div",d+"-content-wrapper",b);if(this._contentNode=jn("div",d+"-content",S),qo(b),Na(this._contentNode),Bt(b,"contextmenu",qi),this._tipContainer=jn("div",d+"-tip-container",b),this._tip=jn("div",d+"-tip",this._tipContainer),this.options.closeButton){var F=this._closeButton=jn("a",d+"-close-button",b);F.setAttribute("role","button"),F.setAttribute("aria-label","Close popup"),F.href="#close",F.innerHTML='<span aria-hidden="true">&#215;</span>',Bt(F,"click",function($){Pn($),this.close()},this)}},_updateLayout:function(){var d=this._contentNode,b=d.style;b.width="",b.whiteSpace="nowrap";var S=d.offsetWidth;S=Math.min(S,this.options.maxWidth),S=Math.max(S,this.options.minWidth),b.width=S+1+"px",b.whiteSpace="",b.height="";var F=d.offsetHeight,$=this.options.maxHeight,ie="leaflet-popup-scrolled";$&&F>$?(b.height=$+"px",cn(d,ie)):Bi(d,ie),this._containerWidth=this._container.offsetWidth},_animateZoom:function(d){var b=this._map._latLngToNewLayerPoint(this._latlng,d.zoom,d.center),S=this._getAnchor();ji(this._container,b.add(S))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var d=this._map,b=parseInt(Zr(this._container,"marginBottom"),10)||0,S=this._container.offsetHeight+b,F=this._containerWidth,$=new dt(this._containerLeft,-S-this._containerBottom);$._add(ll(this._container));var ie=d.layerPointToContainerPoint($),we=rt(this.options.autoPanPadding),Fe=rt(this.options.autoPanPaddingTopLeft||we),He=rt(this.options.autoPanPaddingBottomRight||we),at=d.getSize(),It=0,Jt=0;ie.x+F+He.x>at.x&&(It=ie.x+F-at.x+He.x),ie.x-It-Fe.x<0&&(It=ie.x-Fe.x),ie.y+S+He.y>at.y&&(Jt=ie.y+S-at.y+He.y),ie.y-Jt-Fe.y<0&&(Jt=ie.y-Fe.y),(It||Jt)&&(this.options.keepInView&&(this._autopanning=!0),d.fire("autopanstart").panBy([It,Jt]))}},_getAnchor:function(){return rt(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),vh=function(d,b){return new ml(d,b)};yn.mergeOptions({closePopupOnClick:!0}),yn.include({openPopup:function(d,b,S){return this._initOverlay(ml,d,b,S).openOn(this),this},closePopup:function(d){return d=arguments.length?d:this._popup,d&&d.close(),this}}),co.include({bindPopup:function(d,b){return this._popup=this._initOverlay(ml,this._popup,d,b),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(d){return this._popup&&(this instanceof ds||(this._popup._source=this),this._popup._prepareOpen(d||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(d){return this._popup&&this._popup.setContent(d),this},getPopup:function(){return this._popup},_openPopup:function(d){if(!(!this._popup||!this._map)){Po(d);var b=d.layer||d.target;if(this._popup._source===b&&!(b instanceof Is)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(d.latlng);return}this._popup._source=b,this.openPopup(d.latlng)}},_movePopup:function(d){this._popup.setLatLng(d.latlng)},_onKeyPress:function(d){d.originalEvent.keyCode===13&&this._openPopup(d)}});var uc=Lo.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(d){Lo.prototype.onAdd.call(this,d),this.setOpacity(this.options.opacity),d.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(d){Lo.prototype.onRemove.call(this,d),d.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var d=Lo.prototype.getEvents.call(this);return this.options.permanent||(d.preclick=this.close),d},_initLayout:function(){var d="leaflet-tooltip",b=d+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=jn("div",b),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+f(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(d){var b,S,F=this._map,$=this._container,ie=F.latLngToContainerPoint(F.getCenter()),we=F.layerPointToContainerPoint(d),Fe=this.options.direction,He=$.offsetWidth,at=$.offsetHeight,It=rt(this.options.offset),Jt=this._getAnchor();Fe==="top"?(b=He/2,S=at):Fe==="bottom"?(b=He/2,S=0):Fe==="center"?(b=He/2,S=at/2):Fe==="right"?(b=0,S=at/2):Fe==="left"?(b=He,S=at/2):we.x<ie.x?(Fe="right",b=0,S=at/2):(Fe="left",b=He+(It.x+Jt.x)*2,S=at/2),d=d.subtract(rt(b,S,!0)).add(It).add(Jt),Bi($,"leaflet-tooltip-right"),Bi($,"leaflet-tooltip-left"),Bi($,"leaflet-tooltip-top"),Bi($,"leaflet-tooltip-bottom"),cn($,"leaflet-tooltip-"+Fe),ji($,d)},_updatePosition:function(){var d=this._map.latLngToLayerPoint(this._latlng);this._setPosition(d)},setOpacity:function(d){this.options.opacity=d,this._container&&qr(this._container,d)},_animateZoom:function(d){var b=this._map._latLngToNewLayerPoint(this._latlng,d.zoom,d.center);this._setPosition(b)},_getAnchor:function(){return rt(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),gl=function(d,b){return new uc(d,b)};yn.include({openTooltip:function(d,b,S){return this._initOverlay(uc,d,b,S).openOn(this),this},closeTooltip:function(d){return d.close(),this}}),co.include({bindTooltip:function(d,b){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(uc,this._tooltip,d,b),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(d){if(!(!d&&this._tooltipHandlersAdded)){var b=d?"off":"on",S={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?S.add=this._openTooltip:(S.mouseover=this._openTooltip,S.mouseout=this.closeTooltip,S.click=this._openTooltip,this._map?this._addFocusListeners():S.add=this._addFocusListeners),this._tooltip.options.sticky&&(S.mousemove=this._moveTooltip),this[b](S),this._tooltipHandlersAdded=!d}},openTooltip:function(d){return this._tooltip&&(this instanceof ds||(this._tooltip._source=this),this._tooltip._prepareOpen(d)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(d){return this._tooltip&&this._tooltip.setContent(d),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(d){var b=typeof d.getElement=="function"&&d.getElement();b&&(Bt(b,"focus",function(){this._tooltip._source=d,this.openTooltip()},this),Bt(b,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(d){var b=typeof d.getElement=="function"&&d.getElement();b&&b.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(d){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var b=this;this._map.once("moveend",function(){b._openOnceFlag=!1,b._openTooltip(d)});return}this._tooltip._source=d.layer||d.target,this.openTooltip(this._tooltip.options.sticky?d.latlng:void 0)}},_moveTooltip:function(d){var b=d.latlng,S,F;this._tooltip.options.sticky&&d.originalEvent&&(S=this._map.mouseEventToContainerPoint(d.originalEvent),F=this._map.containerPointToLayerPoint(S),b=this._map.layerPointToLatLng(F)),this._tooltip.setLatLng(b)}});var hc=ja.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(d){var b=d&&d.tagName==="DIV"?d:document.createElement("div"),S=this.options;if(S.html instanceof Element?(sl(b),b.appendChild(S.html)):b.innerHTML=S.html!==!1?S.html:"",S.bgPos){var F=rt(S.bgPos);b.style.backgroundPosition=-F.x+"px "+-F.y+"px"}return this._setIconStyles(b,"icon"),b},createShadow:function(){return null}});function dc(d){return new hc(d)}ja.Default=ac;var Sr=co.extend({options:{tileSize:256,opacity:1,updateWhenIdle:De.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(d){q(this,d)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(d){d._addZoomLimit(this)},onRemove:function(d){this._removeAllTiles(),ii(this._container),d._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(ai(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(al(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(d){return this.options.opacity=d,this._updateOpacity(),this},setZIndex:function(d){return this.options.zIndex=d,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var d=this._clampZoom(this._map.getZoom());d!==this._tileZoom&&(this._tileZoom=d,this._updateLevels()),this._update()}return this},getEvents:function(){var d={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=v(this._onMoveEnd,this.options.updateInterval,this)),d.move=this._onMove),this._zoomAnimated&&(d.zoomanim=this._animateZoom),d},createTile:function(){return document.createElement("div")},getTileSize:function(){var d=this.options.tileSize;return d instanceof dt?d:new dt(d,d)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(d){for(var b=this.getPane().children,S=-d(-1/0,1/0),F=0,$=b.length,ie;F<$;F++)ie=b[F].style.zIndex,b[F]!==this._container&&ie&&(S=d(S,+ie));isFinite(S)&&(this.options.zIndex=S+d(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!De.ielt9){qr(this._container,this.options.opacity);var d=+new Date,b=!1,S=!1;for(var F in this._tiles){var $=this._tiles[F];if(!(!$.current||!$.loaded)){var ie=Math.min(1,(d-$.loaded)/200);qr($.el,ie),ie<1?b=!0:($.active?S=!0:this._onOpaqueTile($),$.active=!0)}}S&&!this._noPrune&&this._pruneTiles(),b&&(pt(this._fadeFrame),this._fadeFrame=it(this._updateOpacity,this))}},_onOpaqueTile:D,_initContainer:function(){this._container||(this._container=jn("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var d=this._tileZoom,b=this.options.maxZoom;if(d!==void 0){for(var S in this._levels)S=Number(S),this._levels[S].el.children.length||S===d?(this._levels[S].el.style.zIndex=b-Math.abs(d-S),this._onUpdateLevel(S)):(ii(this._levels[S].el),this._removeTilesAtZoom(S),this._onRemoveLevel(S),delete this._levels[S]);var F=this._levels[d],$=this._map;return F||(F=this._levels[d]={},F.el=jn("div","leaflet-tile-container leaflet-zoom-animated",this._container),F.el.style.zIndex=b,F.origin=$.project($.unproject($.getPixelOrigin()),d).round(),F.zoom=d,this._setZoomTransform(F,$.getCenter(),$.getZoom()),D(F.el.offsetWidth),this._onCreateLevel(F)),this._level=F,F}},_onUpdateLevel:D,_onRemoveLevel:D,_onCreateLevel:D,_pruneTiles:function(){if(this._map){var d,b,S=this._map.getZoom();if(S>this.options.maxZoom||S<this.options.minZoom){this._removeAllTiles();return}for(d in this._tiles)b=this._tiles[d],b.retain=b.current;for(d in this._tiles)if(b=this._tiles[d],b.current&&!b.active){var F=b.coords;this._retainParent(F.x,F.y,F.z,F.z-5)||this._retainChildren(F.x,F.y,F.z,F.z+2)}for(d in this._tiles)this._tiles[d].retain||this._removeTile(d)}},_removeTilesAtZoom:function(d){for(var b in this._tiles)this._tiles[b].coords.z===d&&this._removeTile(b)},_removeAllTiles:function(){for(var d in this._tiles)this._removeTile(d)},_invalidateAll:function(){for(var d in this._levels)ii(this._levels[d].el),this._onRemoveLevel(Number(d)),delete this._levels[d];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(d,b,S,F){var $=Math.floor(d/2),ie=Math.floor(b/2),we=S-1,Fe=new dt(+$,+ie);Fe.z=+we;var He=this._tileCoordsToKey(Fe),at=this._tiles[He];return at&&at.active?(at.retain=!0,!0):(at&&at.loaded&&(at.retain=!0),we>F?this._retainParent($,ie,we,F):!1)},_retainChildren:function(d,b,S,F){for(var $=2*d;$<2*d+2;$++)for(var ie=2*b;ie<2*b+2;ie++){var we=new dt($,ie);we.z=S+1;var Fe=this._tileCoordsToKey(we),He=this._tiles[Fe];if(He&&He.active){He.retain=!0;continue}else He&&He.loaded&&(He.retain=!0);S+1<F&&this._retainChildren($,ie,S+1,F)}},_resetView:function(d){var b=d&&(d.pinch||d.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),b,b)},_animateZoom:function(d){this._setView(d.center,d.zoom,!0,d.noUpdate)},_clampZoom:function(d){var b=this.options;return b.minNativeZoom!==void 0&&d<b.minNativeZoom?b.minNativeZoom:b.maxNativeZoom!==void 0&&b.maxNativeZoom<d?b.maxNativeZoom:d},_setView:function(d,b,S,F){var $=Math.round(b);this.options.maxZoom!==void 0&&$>this.options.maxZoom||this.options.minZoom!==void 0&&$<this.options.minZoom?$=void 0:$=this._clampZoom($);var ie=this.options.updateWhenZooming&&$!==this._tileZoom;(!F||ie)&&(this._tileZoom=$,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),$!==void 0&&this._update(d),S||this._pruneTiles(),this._noPrune=!!S),this._setZoomTransforms(d,b)},_setZoomTransforms:function(d,b){for(var S in this._levels)this._setZoomTransform(this._levels[S],d,b)},_setZoomTransform:function(d,b,S){var F=this._map.getZoomScale(S,d.zoom),$=d.origin.multiplyBy(F).subtract(this._map._getNewPixelOrigin(b,S)).round();De.any3d?ea(d.el,$,F):ji(d.el,$)},_resetGrid:function(){var d=this._map,b=d.options.crs,S=this._tileSize=this.getTileSize(),F=this._tileZoom,$=this._map.getPixelWorldBounds(this._tileZoom);$&&(this._globalTileRange=this._pxBoundsToTileRange($)),this._wrapX=b.wrapLng&&!this.options.noWrap&&[Math.floor(d.project([0,b.wrapLng[0]],F).x/S.x),Math.ceil(d.project([0,b.wrapLng[1]],F).x/S.y)],this._wrapY=b.wrapLat&&!this.options.noWrap&&[Math.floor(d.project([b.wrapLat[0],0],F).y/S.x),Math.ceil(d.project([b.wrapLat[1],0],F).y/S.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(d){var b=this._map,S=b._animatingZoom?Math.max(b._animateToZoom,b.getZoom()):b.getZoom(),F=b.getZoomScale(S,this._tileZoom),$=b.project(d,this._tileZoom).floor(),ie=b.getSize().divideBy(F*2);return new Dt($.subtract(ie),$.add(ie))},_update:function(d){var b=this._map;if(b){var S=this._clampZoom(b.getZoom());if(d===void 0&&(d=b.getCenter()),this._tileZoom!==void 0){var F=this._getTiledPixelBounds(d),$=this._pxBoundsToTileRange(F),ie=$.getCenter(),we=[],Fe=this.options.keepBuffer,He=new Dt($.getBottomLeft().subtract([Fe,-Fe]),$.getTopRight().add([Fe,-Fe]));if(!(isFinite($.min.x)&&isFinite($.min.y)&&isFinite($.max.x)&&isFinite($.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var at in this._tiles){var It=this._tiles[at].coords;(It.z!==this._tileZoom||!He.contains(new dt(It.x,It.y)))&&(this._tiles[at].current=!1)}if(Math.abs(S-this._tileZoom)>1){this._setView(d,S);return}for(var Jt=$.min.y;Jt<=$.max.y;Jt++)for(var wn=$.min.x;wn<=$.max.x;wn++){var rr=new dt(wn,Jt);if(rr.z=this._tileZoom,!!this._isValidTile(rr)){var Xi=this._tiles[this._tileCoordsToKey(rr)];Xi?Xi.current=!0:we.push(rr)}}if(we.sort(function(Xr,Ds){return Xr.distanceTo(ie)-Ds.distanceTo(ie)}),we.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Oo=document.createDocumentFragment();for(wn=0;wn<we.length;wn++)this._addTile(we[wn],Oo);this._level.el.appendChild(Oo)}}}},_isValidTile:function(d){var b=this._map.options.crs;if(!b.infinite){var S=this._globalTileRange;if(!b.wrapLng&&(d.x<S.min.x||d.x>S.max.x)||!b.wrapLat&&(d.y<S.min.y||d.y>S.max.y))return!1}if(!this.options.bounds)return!0;var F=this._tileCoordsToBounds(d);return et(this.options.bounds).overlaps(F)},_keyToBounds:function(d){return this._tileCoordsToBounds(this._keyToTileCoords(d))},_tileCoordsToNwSe:function(d){var b=this._map,S=this.getTileSize(),F=d.scaleBy(S),$=F.add(S),ie=b.unproject(F,d.z),we=b.unproject($,d.z);return[ie,we]},_tileCoordsToBounds:function(d){var b=this._tileCoordsToNwSe(d),S=new Qt(b[0],b[1]);return this.options.noWrap||(S=this._map.wrapLatLngBounds(S)),S},_tileCoordsToKey:function(d){return d.x+":"+d.y+":"+d.z},_keyToTileCoords:function(d){var b=d.split(":"),S=new dt(+b[0],+b[1]);return S.z=+b[2],S},_removeTile:function(d){var b=this._tiles[d];b&&(ii(b.el),delete this._tiles[d],this.fire("tileunload",{tile:b.el,coords:this._keyToTileCoords(d)}))},_initTile:function(d){cn(d,"leaflet-tile");var b=this.getTileSize();d.style.width=b.x+"px",d.style.height=b.y+"px",d.onselectstart=D,d.onmousemove=D,De.ielt9&&this.options.opacity<1&&qr(d,this.options.opacity)},_addTile:function(d,b){var S=this._getTilePos(d),F=this._tileCoordsToKey(d),$=this.createTile(this._wrapCoords(d),a(this._tileReady,this,d));this._initTile($),this.createTile.length<2&&it(a(this._tileReady,this,d,null,$)),ji($,S),this._tiles[F]={el:$,coords:d,current:!0},b.appendChild($),this.fire("tileloadstart",{tile:$,coords:d})},_tileReady:function(d,b,S){b&&this.fire("tileerror",{error:b,tile:S,coords:d});var F=this._tileCoordsToKey(d);S=this._tiles[F],S&&(S.loaded=+new Date,this._map._fadeAnimated?(qr(S.el,0),pt(this._fadeFrame),this._fadeFrame=it(this._updateOpacity,this)):(S.active=!0,this._pruneTiles()),b||(cn(S.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:S.el,coords:d})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),De.ielt9||!this._map._fadeAnimated?it(this._pruneTiles,this):setTimeout(a(this._pruneTiles,this),250)))},_getTilePos:function(d){return d.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(d){var b=new dt(this._wrapX?w(d.x,this._wrapX):d.x,this._wrapY?w(d.y,this._wrapY):d.y);return b.z=d.z,b},_pxBoundsToTileRange:function(d){var b=this.getTileSize();return new Dt(d.min.unscaleBy(b).floor(),d.max.unscaleBy(b).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var d in this._tiles)if(!this._tiles[d].loaded)return!1;return!0}});function Tp(d){return new Sr(d)}var _l=Sr.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(d,b){this._url=d,b=q(this,b),b.detectRetina&&De.retina&&b.maxZoom>0?(b.tileSize=Math.floor(b.tileSize/2),b.zoomReverse?(b.zoomOffset--,b.minZoom=Math.min(b.maxZoom,b.minZoom+1)):(b.zoomOffset++,b.maxZoom=Math.max(b.minZoom,b.maxZoom-1)),b.minZoom=Math.max(0,b.minZoom)):b.zoomReverse?b.minZoom=Math.min(b.maxZoom,b.minZoom):b.maxZoom=Math.max(b.minZoom,b.maxZoom),typeof b.subdomains=="string"&&(b.subdomains=b.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(d,b){return this._url===d&&b===void 0&&(b=!0),this._url=d,b||this.redraw(),this},createTile:function(d,b){var S=document.createElement("img");return Bt(S,"load",a(this._tileOnLoad,this,b,S)),Bt(S,"error",a(this._tileOnError,this,b,S)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(S.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(S.referrerPolicy=this.options.referrerPolicy),S.alt="",S.src=this.getTileUrl(d),S},getTileUrl:function(d){var b={r:De.retina?"@2x":"",s:this._getSubdomain(d),x:d.x,y:d.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var S=this._globalTileRange.max.y-d.y;this.options.tms&&(b.y=S),b["-y"]=S}return ce(this._url,t(b,this.options))},_tileOnLoad:function(d,b){De.ielt9?setTimeout(a(d,this,null,b),0):d(null,b)},_tileOnError:function(d,b,S){var F=this.options.errorTileUrl;F&&b.getAttribute("src")!==F&&(b.src=F),d(S,b)},_onTileRemove:function(d){d.tile.onload=null},_getZoomForUrl:function(){var d=this._tileZoom,b=this.options.maxZoom,S=this.options.zoomReverse,F=this.options.zoomOffset;return S&&(d=b-d),d+F},_getSubdomain:function(d){var b=Math.abs(d.x+d.y)%this.options.subdomains.length;return this.options.subdomains[b]},_abortLoading:function(){var d,b;for(d in this._tiles)if(this._tiles[d].coords.z!==this._tileZoom&&(b=this._tiles[d].el,b.onload=D,b.onerror=D,!b.complete)){b.src=Ue;var S=this._tiles[d].coords;ii(b),delete this._tiles[d],this.fire("tileabort",{tile:b,coords:S})}},_removeTile:function(d){var b=this._tiles[d];if(b)return b.el.setAttribute("src",Ue),Sr.prototype._removeTile.call(this,d)},_tileReady:function(d,b,S){if(!(!this._map||S&&S.getAttribute("src")===Ue))return Sr.prototype._tileReady.call(this,d,b,S)}});function xh(d,b){return new _l(d,b)}var Ua=_l.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(d,b){this._url=d;var S=t({},this.defaultWmsParams);for(var F in b)F in this.options||(S[F]=b[F]);b=q(this,b);var $=b.detectRetina&&De.retina?2:1,ie=this.getTileSize();S.width=ie.x*$,S.height=ie.y*$,this.wmsParams=S},onAdd:function(d){this._crs=this.options.crs||d.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var b=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[b]=this._crs.code,_l.prototype.onAdd.call(this,d)},getTileUrl:function(d){var b=this._tileCoordsToNwSe(d),S=this._crs,F=$t(S.project(b[0]),S.project(b[1])),$=F.min,ie=F.max,we=(this._wmsVersion>=1.3&&this._crs===pp?[$.y,$.x,ie.y,ie.x]:[$.x,$.y,ie.x,ie.y]).join(","),Fe=_l.prototype.getTileUrl.call(this,d);return Fe+W(this.wmsParams,Fe,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+we},setParams:function(d,b){return t(this.wmsParams,d),b||this.redraw(),this}});function bh(d,b){return new Ua(d,b)}_l.WMS=Ua,xh.wms=bh;var Xo=co.extend({options:{padding:.1},initialize:function(d){q(this,d),f(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),cn(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var d={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(d.zoomanim=this._onAnimZoom),d},_onAnimZoom:function(d){this._updateTransform(d.center,d.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(d,b){var S=this._map.getZoomScale(b,this._zoom),F=this._map.getSize().multiplyBy(.5+this.options.padding),$=this._map.project(this._center,b),ie=F.multiplyBy(-S).add($).subtract(this._map._getNewPixelOrigin(d,b));De.any3d?ea(this._container,ie,S):ji(this._container,ie)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var d in this._layers)this._layers[d]._reset()},_onZoomEnd:function(){for(var d in this._layers)this._layers[d]._project()},_updatePaths:function(){for(var d in this._layers)this._layers[d]._update()},_update:function(){var d=this.options.padding,b=this._map.getSize(),S=this._map.containerPointToLayerPoint(b.multiplyBy(-d)).round();this._bounds=new Dt(S,S.add(b.multiplyBy(1+d*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),fc=Xo.extend({options:{tolerance:0},getEvents:function(){var d=Xo.prototype.getEvents.call(this);return d.viewprereset=this._onViewPreReset,d},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Xo.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var d=this._container=document.createElement("canvas");Bt(d,"mousemove",this._onMouseMove,this),Bt(d,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Bt(d,"mouseout",this._handleMouseOut,this),d._leaflet_disable_events=!0,this._ctx=d.getContext("2d")},_destroyContainer:function(){pt(this._redrawRequest),delete this._ctx,ii(this._container),bt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var d;this._redrawBounds=null;for(var b in this._layers)d=this._layers[b],d._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Xo.prototype._update.call(this);var d=this._bounds,b=this._container,S=d.getSize(),F=De.retina?2:1;ji(b,d.min),b.width=F*S.x,b.height=F*S.y,b.style.width=S.x+"px",b.style.height=S.y+"px",De.retina&&this._ctx.scale(2,2),this._ctx.translate(-d.min.x,-d.min.y),this.fire("update")}},_reset:function(){Xo.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(d){this._updateDashArray(d),this._layers[f(d)]=d;var b=d._order={layer:d,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=b),this._drawLast=b,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(d){this._requestRedraw(d)},_removePath:function(d){var b=d._order,S=b.next,F=b.prev;S?S.prev=F:this._drawLast=F,F?F.next=S:this._drawFirst=S,delete d._order,delete this._layers[f(d)],this._requestRedraw(d)},_updatePath:function(d){this._extendRedrawBounds(d),d._project(),d._update(),this._requestRedraw(d)},_updateStyle:function(d){this._updateDashArray(d),this._requestRedraw(d)},_updateDashArray:function(d){if(typeof d.options.dashArray=="string"){var b=d.options.dashArray.split(/[, ]+/),S=[],F,$;for($=0;$<b.length;$++){if(F=Number(b[$]),isNaN(F))return;S.push(F)}d.options._dashArray=S}else d.options._dashArray=d.options.dashArray},_requestRedraw:function(d){this._map&&(this._extendRedrawBounds(d),this._redrawRequest=this._redrawRequest||it(this._redraw,this))},_extendRedrawBounds:function(d){if(d._pxBounds){var b=(d.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Dt,this._redrawBounds.extend(d._pxBounds.min.subtract([b,b])),this._redrawBounds.extend(d._pxBounds.max.add([b,b]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var d=this._redrawBounds;if(d){var b=d.getSize();this._ctx.clearRect(d.min.x,d.min.y,b.x,b.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var d,b=this._redrawBounds;if(this._ctx.save(),b){var S=b.getSize();this._ctx.beginPath(),this._ctx.rect(b.min.x,b.min.y,S.x,S.y),this._ctx.clip()}this._drawing=!0;for(var F=this._drawFirst;F;F=F.next)d=F.layer,(!b||d._pxBounds&&d._pxBounds.intersects(b))&&d._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(d,b){if(this._drawing){var S,F,$,ie,we=d._parts,Fe=we.length,He=this._ctx;if(Fe){for(He.beginPath(),S=0;S<Fe;S++){for(F=0,$=we[S].length;F<$;F++)ie=we[S][F],He[F?"lineTo":"moveTo"](ie.x,ie.y);b&&He.closePath()}this._fillStroke(He,d)}}},_updateCircle:function(d){if(!(!this._drawing||d._empty())){var b=d._point,S=this._ctx,F=Math.max(Math.round(d._radius),1),$=(Math.max(Math.round(d._radiusY),1)||F)/F;$!==1&&(S.save(),S.scale(1,$)),S.beginPath(),S.arc(b.x,b.y/$,F,0,Math.PI*2,!1),$!==1&&S.restore(),this._fillStroke(S,d)}},_fillStroke:function(d,b){var S=b.options;S.fill&&(d.globalAlpha=S.fillOpacity,d.fillStyle=S.fillColor||S.color,d.fill(S.fillRule||"evenodd")),S.stroke&&S.weight!==0&&(d.setLineDash&&d.setLineDash(b.options&&b.options._dashArray||[]),d.globalAlpha=S.opacity,d.lineWidth=S.weight,d.strokeStyle=S.color,d.lineCap=S.lineCap,d.lineJoin=S.lineJoin,d.stroke())},_onClick:function(d){for(var b=this._map.mouseEventToLayerPoint(d),S,F,$=this._drawFirst;$;$=$.next)S=$.layer,S.options.interactive&&S._containsPoint(b)&&(!(d.type==="click"||d.type==="preclick")||!this._map._draggableMoved(S))&&(F=S);this._fireEvent(F?[F]:!1,d)},_onMouseMove:function(d){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var b=this._map.mouseEventToLayerPoint(d);this._handleMouseHover(d,b)}},_handleMouseOut:function(d){var b=this._hoveredLayer;b&&(Bi(this._container,"leaflet-interactive"),this._fireEvent([b],d,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(d,b){if(!this._mouseHoverThrottled){for(var S,F,$=this._drawFirst;$;$=$.next)S=$.layer,S.options.interactive&&S._containsPoint(b)&&(F=S);F!==this._hoveredLayer&&(this._handleMouseOut(d),F&&(cn(this._container,"leaflet-interactive"),this._fireEvent([F],d,"mouseover"),this._hoveredLayer=F)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,d),this._mouseHoverThrottled=!0,setTimeout(a(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(d,b,S){this._map._fireDOMEvent(b,S||b.type,d)},_bringToFront:function(d){var b=d._order;if(b){var S=b.next,F=b.prev;if(S)S.prev=F;else return;F?F.next=S:S&&(this._drawFirst=S),b.prev=this._drawLast,this._drawLast.next=b,b.next=null,this._drawLast=b,this._requestRedraw(d)}},_bringToBack:function(d){var b=d._order;if(b){var S=b.next,F=b.prev;if(F)F.next=S;else return;S?S.prev=F:F&&(this._drawLast=F),b.prev=null,b.next=this._drawFirst,this._drawFirst.prev=b,this._drawFirst=b,this._requestRedraw(d)}}});function du(d){return De.canvas?new fc(d):null}var pc=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(d){return document.createElement("<lvml:"+d+' class="lvml">')}}catch{}return function(d){return document.createElement("<"+d+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),mc={_initContainer:function(){this._container=jn("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Xo.prototype._update.call(this),this.fire("update"))},_initPath:function(d){var b=d._container=pc("shape");cn(b,"leaflet-vml-shape "+(this.options.className||"")),b.coordsize="1 1",d._path=pc("path"),b.appendChild(d._path),this._updateStyle(d),this._layers[f(d)]=d},_addPath:function(d){var b=d._container;this._container.appendChild(b),d.options.interactive&&d.addInteractiveTarget(b)},_removePath:function(d){var b=d._container;ii(b),d.removeInteractiveTarget(b),delete this._layers[f(d)]},_updateStyle:function(d){var b=d._stroke,S=d._fill,F=d.options,$=d._container;$.stroked=!!F.stroke,$.filled=!!F.fill,F.stroke?(b||(b=d._stroke=pc("stroke")),$.appendChild(b),b.weight=F.weight+"px",b.color=F.color,b.opacity=F.opacity,F.dashArray?b.dashStyle=ue(F.dashArray)?F.dashArray.join(" "):F.dashArray.replace(/( *, *)/g," "):b.dashStyle="",b.endcap=F.lineCap.replace("butt","flat"),b.joinstyle=F.lineJoin):b&&($.removeChild(b),d._stroke=null),F.fill?(S||(S=d._fill=pc("fill")),$.appendChild(S),S.color=F.fillColor||F.color,S.opacity=F.fillOpacity):S&&($.removeChild(S),d._fill=null)},_updateCircle:function(d){var b=d._point.round(),S=Math.round(d._radius),F=Math.round(d._radiusY||S);this._setPath(d,d._empty()?"M0 0":"AL "+b.x+","+b.y+" "+S+","+F+" 0,"+65535*360)},_setPath:function(d,b){d._path.v=b},_bringToFront:function(d){ai(d._container)},_bringToBack:function(d){al(d._container)}},ca=De.vml?pc:ir,gc=Xo.extend({_initContainer:function(){this._container=ca("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=ca("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){ii(this._container),bt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Xo.prototype._update.call(this);var d=this._bounds,b=d.getSize(),S=this._container;(!this._svgSize||!this._svgSize.equals(b))&&(this._svgSize=b,S.setAttribute("width",b.x),S.setAttribute("height",b.y)),ji(S,d.min),S.setAttribute("viewBox",[d.min.x,d.min.y,b.x,b.y].join(" ")),this.fire("update")}},_initPath:function(d){var b=d._path=ca("path");d.options.className&&cn(b,d.options.className),d.options.interactive&&cn(b,"leaflet-interactive"),this._updateStyle(d),this._layers[f(d)]=d},_addPath:function(d){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(d._path),d.addInteractiveTarget(d._path)},_removePath:function(d){ii(d._path),d.removeInteractiveTarget(d._path),delete this._layers[f(d)]},_updatePath:function(d){d._project(),d._update()},_updateStyle:function(d){var b=d._path,S=d.options;b&&(S.stroke?(b.setAttribute("stroke",S.color),b.setAttribute("stroke-opacity",S.opacity),b.setAttribute("stroke-width",S.weight),b.setAttribute("stroke-linecap",S.lineCap),b.setAttribute("stroke-linejoin",S.lineJoin),S.dashArray?b.setAttribute("stroke-dasharray",S.dashArray):b.removeAttribute("stroke-dasharray"),S.dashOffset?b.setAttribute("stroke-dashoffset",S.dashOffset):b.removeAttribute("stroke-dashoffset")):b.setAttribute("stroke","none"),S.fill?(b.setAttribute("fill",S.fillColor||S.color),b.setAttribute("fill-opacity",S.fillOpacity),b.setAttribute("fill-rule",S.fillRule||"evenodd")):b.setAttribute("fill","none"))},_updatePoly:function(d,b){this._setPath(d,Qi(d._parts,b))},_updateCircle:function(d){var b=d._point,S=Math.max(Math.round(d._radius),1),F=Math.max(Math.round(d._radiusY),1)||S,$="a"+S+","+F+" 0 1,0 ",ie=d._empty()?"M0 0":"M"+(b.x-S)+","+b.y+$+S*2+",0 "+$+-S*2+",0 ";this._setPath(d,ie)},_setPath:function(d,b){d._path.setAttribute("d",b)},_bringToFront:function(d){ai(d._path)},_bringToBack:function(d){al(d._path)}});De.vml&&gc.include(mc);function wh(d){return De.svg||De.vml?new gc(d):null}yn.include({getRenderer:function(d){var b=d.options.renderer||this._getPaneRenderer(d.options.pane)||this.options.renderer||this._renderer;return b||(b=this._renderer=this._createRenderer()),this.hasLayer(b)||this.addLayer(b),b},_getPaneRenderer:function(d){if(d==="overlayPane"||d===void 0)return!1;var b=this._paneRenderers[d];return b===void 0&&(b=this._createRenderer({pane:d}),this._paneRenderers[d]=b),b},_createRenderer:function(d){return this.options.preferCanvas&&du(d)||wh(d)}});var hn=Ss.extend({initialize:function(d,b){Ss.prototype.initialize.call(this,this._boundsToLatLngs(d),b)},setBounds:function(d){return this.setLatLngs(this._boundsToLatLngs(d))},_boundsToLatLngs:function(d){return d=et(d),[d.getSouthWest(),d.getNorthWest(),d.getNorthEast(),d.getSouthEast()]}});function Eh(d,b){return new hn(d,b)}gc.create=ca,gc.pointsToPath=Qi,fs.geometryToLayer=lu,fs.coordsToLatLng=Ro,fs.coordsToLatLngs=fl,fs.latLngToCoords=uu,fs.latLngsToCoords=cc,fs.getFeature=Va,fs.asFeature=pl,yn.mergeOptions({boxZoom:!0});var Cp=Wo.extend({initialize:function(d){this._map=d,this._container=d._container,this._pane=d._panes.overlayPane,this._resetStateTimeout=0,d.on("unload",this._destroy,this)},addHooks:function(){Bt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){bt(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){ii(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(d){if(!d.shiftKey||d.which!==1&&d.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),ta(),tu(),this._startPoint=this._map.mouseEventToContainerPoint(d),Bt(document,{contextmenu:Po,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(d){this._moved||(this._moved=!0,this._box=jn("div","leaflet-zoom-box",this._container),cn(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(d);var b=new Dt(this._point,this._startPoint),S=b.getSize();ji(this._box,b.min),this._box.style.width=S.x+"px",this._box.style.height=S.y+"px"},_finish:function(){this._moved&&(ii(this._box),Bi(this._container,"leaflet-crosshair")),ka(),cl(),bt(document,{contextmenu:Po,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(d){if(!(d.which!==1&&d.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(a(this._resetState,this),0);var b=new Qt(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(b).fire("boxzoomend",{boxZoomBounds:b})}},_onKeyDown:function(d){d.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});yn.addInitHook("addHandler","boxZoom",Cp),yn.mergeOptions({doubleClickZoom:!0});var Rd=Wo.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(d){var b=this._map,S=b.getZoom(),F=b.options.zoomDelta,$=d.originalEvent.shiftKey?S-F:S+F;b.options.doubleClickZoom==="center"?b.setZoom($):b.setZoomAround(d.containerPoint,$)}});yn.addInitHook("addHandler","doubleClickZoom",Rd),yn.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var _c=Wo.extend({addHooks:function(){if(!this._draggable){var d=this._map;this._draggable=new Vi(d._mapPane,d._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),d.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),d.on("zoomend",this._onZoomEnd,this),d.whenReady(this._onZoomEnd,this))}cn(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Bi(this._map._container,"leaflet-grab"),Bi(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var d=this._map;if(d._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var b=et(this._map.options.maxBounds);this._offsetLimit=$t(this._map.latLngToContainerPoint(b.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(b.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;d.fire("movestart").fire("dragstart"),d.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(d){if(this._map.options.inertia){var b=this._lastTime=+new Date,S=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(S),this._times.push(b),this._prunePositions(b)}this._map.fire("move",d).fire("drag",d)},_prunePositions:function(d){for(;this._positions.length>1&&d-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var d=this._map.getSize().divideBy(2),b=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=b.subtract(d).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(d,b){return d-(d-b)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var d=this._draggable._newPos.subtract(this._draggable._startPos),b=this._offsetLimit;d.x<b.min.x&&(d.x=this._viscousLimit(d.x,b.min.x)),d.y<b.min.y&&(d.y=this._viscousLimit(d.y,b.min.y)),d.x>b.max.x&&(d.x=this._viscousLimit(d.x,b.max.x)),d.y>b.max.y&&(d.y=this._viscousLimit(d.y,b.max.y)),this._draggable._newPos=this._draggable._startPos.add(d)}},_onPreDragWrap:function(){var d=this._worldWidth,b=Math.round(d/2),S=this._initialWorldOffset,F=this._draggable._newPos.x,$=(F-b+S)%d+b-S,ie=(F+b+S)%d-b-S,we=Math.abs($+S)<Math.abs(ie+S)?$:ie;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=we},_onDragEnd:function(d){var b=this._map,S=b.options,F=!S.inertia||d.noInertia||this._times.length<2;if(b.fire("dragend",d),F)b.fire("moveend");else{this._prunePositions(+new Date);var $=this._lastPos.subtract(this._positions[0]),ie=(this._lastTime-this._times[0])/1e3,we=S.easeLinearity,Fe=$.multiplyBy(we/ie),He=Fe.distanceTo([0,0]),at=Math.min(S.inertiaMaxSpeed,He),It=Fe.multiplyBy(at/He),Jt=at/(S.inertiaDeceleration*we),wn=It.multiplyBy(-Jt/2).round();!wn.x&&!wn.y?b.fire("moveend"):(wn=b._limitOffset(wn,b.options.maxBounds),it(function(){b.panBy(wn,{duration:Jt,easeLinearity:we,noMoveStart:!0,animate:!0})}))}}});yn.addInitHook("addHandler","dragging",_c),yn.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Ip=Wo.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(d){this._map=d,this._setPanDelta(d.options.keyboardPanDelta),this._setZoomDelta(d.options.zoomDelta)},addHooks:function(){var d=this._map._container;d.tabIndex<=0&&(d.tabIndex="0"),Bt(d,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),bt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var d=document.body,b=document.documentElement,S=d.scrollTop||b.scrollTop,F=d.scrollLeft||b.scrollLeft;this._map._container.focus(),window.scrollTo(F,S)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(d){var b=this._panKeys={},S=this.keyCodes,F,$;for(F=0,$=S.left.length;F<$;F++)b[S.left[F]]=[-1*d,0];for(F=0,$=S.right.length;F<$;F++)b[S.right[F]]=[d,0];for(F=0,$=S.down.length;F<$;F++)b[S.down[F]]=[0,d];for(F=0,$=S.up.length;F<$;F++)b[S.up[F]]=[0,-1*d]},_setZoomDelta:function(d){var b=this._zoomKeys={},S=this.keyCodes,F,$;for(F=0,$=S.zoomIn.length;F<$;F++)b[S.zoomIn[F]]=d;for(F=0,$=S.zoomOut.length;F<$;F++)b[S.zoomOut[F]]=-d},_addHooks:function(){Bt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){bt(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(d){if(!(d.altKey||d.ctrlKey||d.metaKey)){var b=d.keyCode,S=this._map,F;if(b in this._panKeys){if(!S._panAnim||!S._panAnim._inProgress)if(F=this._panKeys[b],d.shiftKey&&(F=rt(F).multiplyBy(3)),S.options.maxBounds&&(F=S._limitOffset(rt(F),S.options.maxBounds)),S.options.worldCopyJump){var $=S.wrapLatLng(S.unproject(S.project(S.getCenter()).add(F)));S.panTo($)}else S.panBy(F)}else if(b in this._zoomKeys)S.setZoom(S.getZoom()+(d.shiftKey?3:1)*this._zoomKeys[b]);else if(b===27&&S._popup&&S._popup.options.closeOnEscapeKey)S.closePopup();else return;Po(d)}}});yn.addInitHook("addHandler","keyboard",Ip),yn.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Sp=Wo.extend({addHooks:function(){Bt(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){bt(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(d){var b=za(d),S=this._map.options.wheelDebounceTime;this._delta+=b,this._lastMousePos=this._map.mouseEventToContainerPoint(d),this._startTime||(this._startTime=+new Date);var F=Math.max(S-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(a(this._performZoom,this),F),Po(d)},_performZoom:function(){var d=this._map,b=d.getZoom(),S=this._map.options.zoomSnap||0;d._stop();var F=this._delta/(this._map.options.wheelPxPerZoomLevel*4),$=4*Math.log(2/(1+Math.exp(-Math.abs(F))))/Math.LN2,ie=S?Math.ceil($/S)*S:$,we=d._limitZoom(b+(this._delta>0?ie:-ie))-b;this._delta=0,this._startTime=null,we&&(d.options.scrollWheelZoom==="center"?d.setZoom(b+we):d.setZoomAround(this._lastMousePos,b+we))}});yn.addInitHook("addHandler","scrollWheelZoom",Sp);var Dp=600;yn.mergeOptions({tapHold:De.touchNative&&De.safari&&De.mobile,tapTolerance:15});var Mp=Wo.extend({addHooks:function(){Bt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){bt(this._map._container,"touchstart",this._onDown,this)},_onDown:function(d){if(clearTimeout(this._holdTimeout),d.touches.length===1){var b=d.touches[0];this._startPos=this._newPos=new dt(b.clientX,b.clientY),this._holdTimeout=setTimeout(a(function(){this._cancel(),this._isTapValid()&&(Bt(document,"touchend",Pn),Bt(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",b))},this),Dp),Bt(document,"touchend touchcancel contextmenu",this._cancel,this),Bt(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function d(){bt(document,"touchend",Pn),bt(document,"touchend touchcancel",d)},_cancel:function(){clearTimeout(this._holdTimeout),bt(document,"touchend touchcancel contextmenu",this._cancel,this),bt(document,"touchmove",this._onMove,this)},_onMove:function(d){var b=d.touches[0];this._newPos=new dt(b.clientX,b.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(d,b){var S=new MouseEvent(d,{bubbles:!0,cancelable:!0,view:window,screenX:b.screenX,screenY:b.screenY,clientX:b.clientX,clientY:b.clientY});S._simulated=!0,b.target.dispatchEvent(S)}});yn.addInitHook("addHandler","tapHold",Mp),yn.mergeOptions({touchZoom:De.touch,bounceAtZoomLimits:!0});var Th=Wo.extend({addHooks:function(){cn(this._map._container,"leaflet-touch-zoom"),Bt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Bi(this._map._container,"leaflet-touch-zoom"),bt(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(d){var b=this._map;if(!(!d.touches||d.touches.length!==2||b._animatingZoom||this._zooming)){var S=b.mouseEventToContainerPoint(d.touches[0]),F=b.mouseEventToContainerPoint(d.touches[1]);this._centerPoint=b.getSize()._divideBy(2),this._startLatLng=b.containerPointToLatLng(this._centerPoint),b.options.touchZoom!=="center"&&(this._pinchStartLatLng=b.containerPointToLatLng(S.add(F)._divideBy(2))),this._startDist=S.distanceTo(F),this._startZoom=b.getZoom(),this._moved=!1,this._zooming=!0,b._stop(),Bt(document,"touchmove",this._onTouchMove,this),Bt(document,"touchend touchcancel",this._onTouchEnd,this),Pn(d)}},_onTouchMove:function(d){if(!(!d.touches||d.touches.length!==2||!this._zooming)){var b=this._map,S=b.mouseEventToContainerPoint(d.touches[0]),F=b.mouseEventToContainerPoint(d.touches[1]),$=S.distanceTo(F)/this._startDist;if(this._zoom=b.getScaleZoom($,this._startZoom),!b.options.bounceAtZoomLimits&&(this._zoom<b.getMinZoom()&&$<1||this._zoom>b.getMaxZoom()&&$>1)&&(this._zoom=b._limitZoom(this._zoom)),b.options.touchZoom==="center"){if(this._center=this._startLatLng,$===1)return}else{var ie=S._add(F)._divideBy(2)._subtract(this._centerPoint);if($===1&&ie.x===0&&ie.y===0)return;this._center=b.unproject(b.project(this._pinchStartLatLng,this._zoom).subtract(ie),this._zoom)}this._moved||(b._moveStart(!0,!1),this._moved=!0),pt(this._animRequest);var we=a(b._move,b,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=it(we,this,!0),Pn(d)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,pt(this._animRequest),bt(document,"touchmove",this._onTouchMove,this),bt(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});yn.addInitHook("addHandler","touchZoom",Th),yn.BoxZoom=Cp,yn.DoubleClickZoom=Rd,yn.Drag=_c,yn.Keyboard=Ip,yn.ScrollWheelZoom=Sp,yn.TapHold=Mp,yn.TouchZoom=Th,n.Bounds=Dt,n.Browser=De,n.CRS=Sn,n.Canvas=fc,n.Circle=lc,n.CircleMarker=sa,n.Class=Pt,n.Control=Ir,n.DivIcon=hc,n.DivOverlay=Lo,n.DomEvent=dp,n.DomUtil=ao,n.Draggable=Vi,n.Evented=yt,n.FeatureGroup=ds,n.GeoJSON=fs,n.GridLayer=Sr,n.Handler=Wo,n.Icon=ja,n.ImageOverlay=hu,n.LatLng=Zt,n.LatLngBounds=Qt,n.Layer=co,n.LayerGroup=dl,n.LineUtil=oc,n.Map=yn,n.Marker=Cs,n.Mixin=Jg,n.Path=Is,n.Point=dt,n.PolyUtil=Sd,n.Polygon=Ss,n.Polyline=aa,n.Popup=ml,n.PosAnimation=ph,n.Projection=e_,n.Rectangle=hn,n.Renderer=Xo,n.SVG=gc,n.SVGOverlay=Ep,n.TileLayer=_l,n.Tooltip=uc,n.Transformation=Ti,n.Util=Vt,n.VideoOverlay=bp,n.bind=a,n.bounds=$t,n.canvas=du,n.circle=t_,n.circleMarker=yp,n.control=mn,n.divIcon=dc,n.extend=t,n.featureGroup=Pd,n.geoJSON=yh,n.geoJson=n_,n.gridLayer=Tp,n.icon=gp,n.imageOverlay=i_,n.latLng=Rt,n.latLngBounds=et,n.layerGroup=mp,n.map=li,n.marker=_p,n.point=rt,n.polygon=xp,n.polyline=vp,n.popup=vh,n.rectangle=Eh,n.setOptions=q,n.stamp=f,n.svg=wh,n.svgOverlay=Un,n.tileLayer=xh,n.tooltip=gl,n.transformation=ti,n.version=e,n.videoOverlay=wp;var yc=window.L;n.noConflict=function(){return window.L=yc,this},window.L=n})});var DN=a2((ES,TS)=>{"use strict";(function(n,e){typeof ES=="object"&&typeof TS<"u"?TS.exports=e():typeof define=="function"&&define.amd?define(e):(n=typeof globalThis<"u"?globalThis:n||self,n.maplibregl=e())})(ES,function(){"use strict";var n={},e={};function t(a,s,f){if(e[a]=f,a==="index"){var v="var sharedModule = {}; ("+e.shared+")(sharedModule); ("+e.worker+")(sharedModule);",w={};return e.shared(w),e.index(n,w),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([v],{type:"text/javascript"}))),n}}t("shared",["exports"],function(a){"use strict";function s(c,i,l,h){return new(l||(l=Promise))(function(m,_){function y(P){try{I(h.next(P))}catch(O){_(O)}}function T(P){try{I(h.throw(P))}catch(O){_(O)}}function I(P){var O;P.done?m(P.value):(O=P.value,O instanceof l?O:new l(function(N){N(O)})).then(y,T)}I((h=h.apply(c,i||[])).next())})}function f(c,i){this.x=c,this.y=i}function v(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var w,D;typeof SuppressedError=="function"&&SuppressedError,f.prototype={clone(){return new f(this.x,this.y)},add(c){return this.clone()._add(c)},sub(c){return this.clone()._sub(c)},multByPoint(c){return this.clone()._multByPoint(c)},divByPoint(c){return this.clone()._divByPoint(c)},mult(c){return this.clone()._mult(c)},div(c){return this.clone()._div(c)},rotate(c){return this.clone()._rotate(c)},rotateAround(c,i){return this.clone()._rotateAround(c,i)},matMult(c){return this.clone()._matMult(c)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(c){return this.x===c.x&&this.y===c.y},dist(c){return Math.sqrt(this.distSqr(c))},distSqr(c){let i=c.x-this.x,l=c.y-this.y;return i*i+l*l},angle(){return Math.atan2(this.y,this.x)},angleTo(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith(c){return this.angleWithSep(c.x,c.y)},angleWithSep(c,i){return Math.atan2(this.x*i-this.y*c,this.x*c+this.y*i)},_matMult(c){let i=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=i,this},_add(c){return this.x+=c.x,this.y+=c.y,this},_sub(c){return this.x-=c.x,this.y-=c.y,this},_mult(c){return this.x*=c,this.y*=c,this},_div(c){return this.x/=c,this.y/=c,this},_multByPoint(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint(c){return this.x/=c.x,this.y/=c.y,this},_unit(){return this._div(this.mag()),this},_perp(){let c=this.y;return this.y=this.x,this.x=-c,this},_rotate(c){let i=Math.cos(c),l=Math.sin(c),h=l*this.x+i*this.y;return this.x=i*this.x-l*this.y,this.y=h,this},_rotateAround(c,i){let l=Math.cos(c),h=Math.sin(c),m=i.y+h*(this.x-i.x)+l*(this.y-i.y);return this.x=i.x+l*(this.x-i.x)-h*(this.y-i.y),this.y=m,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:f},f.convert=function(c){if(c instanceof f)return c;if(Array.isArray(c))return new f(+c[0],+c[1]);if(c.x!==void 0&&c.y!==void 0)return new f(+c.x,+c.y);throw new Error("Expected [x, y] or {x, y} point format")};var A=(function(){if(D)return w;function c(i,l,h,m){this.cx=3*i,this.bx=3*(h-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(m-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=l,this.p2x=h,this.p2y=m}return D=1,w=c,c.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,l){if(l===void 0&&(l=1e-6),i<0)return 0;if(i>1)return 1;for(var h=i,m=0;m<8;m++){var _=this.sampleCurveX(h)-i;if(Math.abs(_)<l)return h;var y=this.sampleCurveDerivativeX(h);if(Math.abs(y)<1e-6)break;h-=_/y}var T=0,I=1;for(h=i,m=0;m<20&&(_=this.sampleCurveX(h),!(Math.abs(_-i)<l));m++)i>_?T=h:I=h,h=.5*(I-T)+T;return h},solve:function(i,l){return this.sampleCurveY(this.solveCurveX(i,l))}},w})(),z=v(A);let H,q;function W(){return H==null&&(H=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),H}function me(){if(q==null&&(q=!1,W())){let i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let h=0;h<25;h++){let m=4*h;i.fillStyle=`rgb(${m},${m+1},${m+2})`,i.fillRect(h%5,Math.floor(h/5),1,1)}let l=i.getImageData(0,0,5,5).data;for(let h=0;h<100;h++)if(h%4!=3&&l[h]!==h){q=!0;break}}}return q||!1}var ce=1e-6,ue=typeof Float32Array<"u"?Float32Array:Array;function Me(){var c=new ue(9);return ue!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function Ue(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function Pe(){var c=new ue(3);return ue!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function ke(c){var i=c[0],l=c[1],h=c[2];return Math.sqrt(i*i+l*l+h*h)}function Qe(c,i,l){var h=new ue(3);return h[0]=c,h[1]=i,h[2]=l,h}function ot(c,i,l){return c[0]=i[0]+l[0],c[1]=i[1]+l[1],c[2]=i[2]+l[2],c}function st(c,i,l){return c[0]=i[0]*l,c[1]=i[1]*l,c[2]=i[2]*l,c}function it(c,i,l){var h=i[0],m=i[1],_=i[2],y=l[0],T=l[1],I=l[2];return c[0]=m*I-_*T,c[1]=_*y-h*I,c[2]=h*T-m*y,c}var pt,Vt=ke;function Pt(c,i,l){var h=i[0],m=i[1],_=i[2],y=i[3];return c[0]=l[0]*h+l[4]*m+l[8]*_+l[12]*y,c[1]=l[1]*h+l[5]*m+l[9]*_+l[13]*y,c[2]=l[2]*h+l[6]*m+l[10]*_+l[14]*y,c[3]=l[3]*h+l[7]*m+l[11]*_+l[15]*y,c}function At(){var c=new ue(4);return ue!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function Gt(c,i,l,h){var m=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",_=Math.PI/360;i*=_,h*=_,l*=_;var y=Math.sin(i),T=Math.cos(i),I=Math.sin(l),P=Math.cos(l),O=Math.sin(h),N=Math.cos(h);switch(m){case"xyz":c[0]=y*P*N+T*I*O,c[1]=T*I*N-y*P*O,c[2]=T*P*O+y*I*N,c[3]=T*P*N-y*I*O;break;case"xzy":c[0]=y*P*N-T*I*O,c[1]=T*I*N-y*P*O,c[2]=T*P*O+y*I*N,c[3]=T*P*N+y*I*O;break;case"yxz":c[0]=y*P*N+T*I*O,c[1]=T*I*N-y*P*O,c[2]=T*P*O-y*I*N,c[3]=T*P*N+y*I*O;break;case"yzx":c[0]=y*P*N+T*I*O,c[1]=T*I*N+y*P*O,c[2]=T*P*O-y*I*N,c[3]=T*P*N-y*I*O;break;case"zxy":c[0]=y*P*N-T*I*O,c[1]=T*I*N+y*P*O,c[2]=T*P*O+y*I*N,c[3]=T*P*N-y*I*O;break;case"zyx":c[0]=y*P*N-T*I*O,c[1]=T*I*N+y*P*O,c[2]=T*P*O-y*I*N,c[3]=T*P*N+y*I*O;break;default:throw new Error("Unknown angle order "+m)}return c}function yt(){var c=new ue(2);return ue!=Float32Array&&(c[0]=0,c[1]=0),c}function dt(c,i){var l=new ue(2);return l[0]=c,l[1]=i,l}Pe(),pt=new ue(4),ue!=Float32Array&&(pt[0]=0,pt[1]=0,pt[2]=0,pt[3]=0),Pe(),Qe(1,0,0),Qe(0,1,0),At(),At(),Me(),yt();let ft=8192;function rt(c,i,l){return i*(ft/(c.tileSize*Math.pow(2,l-c.tileID.overscaledZ)))}function Dt(c,i){return(c%i+i)%i}function $t(c,i,l){return c*(1-l)+i*l}function Qt(c){if(c<=0)return 0;if(c>=1)return 1;let i=c*c,l=i*c;return 4*(c<.5?l:3*(c-i)+l-.75)}function et(c,i,l,h){let m=new z(c,i,l,h);return _=>m.solve(_)}let Zt=et(.25,.1,.25,1);function Rt(c,i,l){return Math.min(l,Math.max(i,c))}function Sn(c,i,l){let h=l-i,m=((c-i)%h+h)%h+i;return m===i?l:m}function kn(c,...i){for(let l of i)for(let h in l)c[h]=l[h];return c}let Ei=1;function Zi(c,i,l){let h={};for(let m in c)h[m]=i.call(this,c[m],m,c);return h}function Ti(c,i,l){let h={};for(let m in c)i.call(this,c[m],m,c)&&(h[m]=c[m]);return h}function ti(c){return Array.isArray(c)?c.map(ti):typeof c=="object"&&c?Zi(c,ti):c}let ss={};function zi(c){ss[c]||(typeof console<"u"&&console.warn(c),ss[c]=!0)}function ir(c,i,l){return(l.y-c.y)*(i.x-c.x)>(i.y-c.y)*(l.x-c.x)}function Qi(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let bn=null;function Di(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}let Do="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ro(c,i,l,h,m){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let _=new VideoFrame(c,{timestamp:0});try{let y=_?.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);let T=y.startsWith("BGR"),I=new Uint8ClampedArray(h*m*4);if(yield _.copyTo(I,(function(P,O,N,j,V){let Z=4*Math.max(-O,0),X=(Math.max(0,N)-N)*j*4+Z,K=4*j,ne=Math.max(0,O),he=Math.max(0,N);return{rect:{x:ne,y:he,width:Math.min(P.width,O+j)-ne,height:Math.min(P.height,N+V)-he},layout:[{offset:X,stride:K}]}})(c,i,l,h,m)),T)for(let P=0;P<I.length;P+=4){let O=I[P];I[P]=I[P+2],I[P+2]=O}return I}finally{_.close()}})}let ur,hr;function $r(c,i,l,h){return c.addEventListener(i,l,h),{unsubscribe:()=>{c.removeEventListener(i,l,h)}}}function Mo(c){return c*Math.PI/180}function $n(c){return c/Math.PI*180}let oo={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},xs={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Zo="AbortError";class as extends Error{constructor(i=Zo){super(i instanceof Error?i.message:i),this.name=Zo,i instanceof Error&&i.stack&&(this.stack=i.stack)}}function Ie(c){return c.name===Zo}let J={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Q(c){return J.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}let te="global-dispatcher";class ge extends Error{constructor(i,l,h,m){super(`AJAXError: ${l} (${i}): ${h}`),this.status=i,this.statusText=l,this.url=h,this.body=m}}let be=()=>Qi(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Le=function(c,i){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){let h=Q(c.url);if(h)return h(c,i);if(Qi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,targetMapId:te},i)}if(!(/^file:/.test(l=c.url)||/^file:/.test(be())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(h,m){return s(this,void 0,void 0,function*(){let _=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,cache:h.cache,referrer:be(),signal:m.signal}),y,T;h.type!=="json"||_.headers.has("Accept")||_.headers.set("Accept","application/json");try{y=yield fetch(_)}catch(P){throw Ie(P)?P:new ge(0,P.message,h.url,new Blob)}if(!y.ok){let P=yield y.blob();throw new ge(y.status,y.statusText,h.url,P)}T=h.type==="arrayBuffer"||h.type==="image"?y.arrayBuffer():h.type==="json"?y.json():y.text();let I=yield T;return m.signal.throwIfAborted(),{data:I,cacheControl:y.headers.get("Cache-Control"),expires:y.headers.get("Expires")}})})(c,i);if(Qi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,mustQueue:!0,targetMapId:te},i)}var l;return(function(h,m){return new Promise((_,y)=>{var T;let I=new XMLHttpRequest;I.open(h.method||"GET",h.url,!0),h.type!=="arrayBuffer"&&h.type!=="image"||(I.responseType="arraybuffer");for(let P in h.headers)I.setRequestHeader(P,h.headers[P]);h.type==="json"&&(I.responseType="text",!((T=h.headers)===null||T===void 0)&&T.Accept||I.setRequestHeader("Accept","application/json")),I.withCredentials=h.credentials==="include",I.onerror=()=>{y(new Error(I.statusText))},I.onload=()=>{if(!m.signal.aborted)if((I.status>=200&&I.status<300||I.status===0)&&I.response!==null){let P=I.response;if(h.type==="json")try{P=JSON.parse(I.response)}catch(O){return void y(O)}_({data:P,cacheControl:I.getResponseHeader("Cache-Control"),expires:I.getResponseHeader("Expires")})}else{let P=new Blob([I.response],{type:I.getResponseHeader("Content-Type")});y(new ge(I.status,I.statusText,h.url,P))}},m.signal.addEventListener("abort",()=>{I.abort(),y(new as(m.signal.reason))}),I.send(h.body)})})(c,i)};function Ae(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;let i=new URL(c),l=window.location;return i.protocol===l.protocol&&i.host===l.host}function Se(c,i,l){l[c]&&l[c].indexOf(i)!==-1||(l[c]=l[c]||[],l[c].push(i))}function Re(c,i,l){if(l&&l[c]){let h=l[c].indexOf(i);h!==-1&&l[c].splice(h,1)}}class Xe{constructor(i,l={}){kn(this,l),this.type=i}}class Ge extends Xe{constructor(i,l={}){super("error",kn({error:i},l))}}class Ke{on(i,l){return this._listeners=this._listeners||{},Se(i,l,this._listeners),{unsubscribe:()=>{this.off(i,l)}}}off(i,l){return Re(i,l,this._listeners),Re(i,l,this._oneTimeListeners),this}once(i,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Se(i,l,this._oneTimeListeners),this):new Promise(h=>this.once(i,h))}fire(i,l){typeof i=="string"&&(i=new Xe(i,l||{}));let h=i.type;if(this.listens(h)){i.target=this;let m=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(let T of m)T.call(this,i);let _=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(let T of _)Re(h,T,this._oneTimeListeners),T.call(this,i);let y=this._eventedParent;y&&(kn(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(i))}else i instanceof Ge&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,l){return this._eventedParent=i,this._eventedParentData=l,this}}var Te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};let Ut=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Wn(c,i){let l={};for(let h in c)h!=="ref"&&(l[h]=c[h]);return Ut.forEach(h=>{h in i&&(l[h]=i[h])}),l}function Et(c,i){if(Array.isArray(c)){if(!Array.isArray(i)||c.length!==i.length)return!1;for(let l=0;l<c.length;l++)if(!Et(c[l],i[l]))return!1;return!0}if(typeof c=="object"&&c!==null&&i!==null){if(typeof i!="object"||Object.keys(c).length!==Object.keys(i).length)return!1;for(let l in c)if(!Et(c[l],i[l]))return!1;return!0}return c===i}function xt(c,i){c.push(i)}function qt(c,i,l){xt(l,{command:"addSource",args:[c,i[c]]})}function Dn(c,i,l){xt(i,{command:"removeSource",args:[c]}),l[c]=!0}function Mn(c,i,l,h){Dn(c,l,h),qt(c,i,l)}function Hn(c,i,l){let h;for(h in c[l])if(Object.prototype.hasOwnProperty.call(c[l],h)&&h!=="data"&&!Et(c[l][h],i[l][h]))return!1;for(h in i[l])if(Object.prototype.hasOwnProperty.call(i[l],h)&&h!=="data"&&!Et(c[l][h],i[l][h]))return!1;return!0}function ni(c,i,l,h,m,_){c=c||{},i=i||{};for(let y in c)Object.prototype.hasOwnProperty.call(c,y)&&(Et(c[y],i[y])||l.push({command:_,args:[h,y,i[y],m]}));for(let y in i)Object.prototype.hasOwnProperty.call(i,y)&&!Object.prototype.hasOwnProperty.call(c,y)&&(Et(c[y],i[y])||l.push({command:_,args:[h,y,i[y],m]}))}function Bn(c){return c.id}function Yt(c,i){return c[i.id]=i,c}class De{constructor(i,l,h,m){this.message=(i?`${i}: `:"")+h,m&&(this.identifier=m),l!=null&&l.__line__&&(this.line=l.__line__)}}function Zn(c,...i){for(let l of i)for(let h in l)c[h]=l[h];return c}class yr extends Error{constructor(i,l){super(l),this.message=l,this.key=i}}class La{constructor(i,l=[]){this.parent=i,this.bindings={};for(let[h,m]of l)this.bindings[h]=m}concat(i){return new La(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}let Mi={kind:"null"},ht={kind:"number"},en={kind:"string"},tn={kind:"boolean"},so={kind:"color"},ch={kind:"projectionDefinition"},Js={kind:"object"},on={kind:"value"},Kc={kind:"collator"},Yl={kind:"formatted"},uh={kind:"padding"},Qs={kind:"colorArray"},Jc={kind:"numberArray"},Kl={kind:"resolvedImage"},Qc={kind:"variableAnchorOffsetCollection"};function Hr(c,i){return{kind:"array",itemType:c,N:i}}function Kn(c){if(c.kind==="array"){let i=Kn(c.itemType);return typeof c.N=="number"?`array<${i}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${i}>`}return c.kind}let Jl=[Mi,ht,en,tn,so,ch,Yl,Js,Hr(on),uh,Jc,Qs,Kl,Qc];function bs(c,i){if(i.kind==="error")return null;if(c.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!bs(c.itemType,i.itemType))&&(typeof c.N!="number"||c.N===i.N))return null}else{if(c.kind===i.kind)return null;if(c.kind==="value"){for(let l of Jl)if(!bs(l,i))return null}}return`Expected ${Kn(c)} but found ${Kn(i)} instead.`}function Ql(c,i){return i.some(l=>l.kind===c.kind)}function Oa(c,i){return i.some(l=>l==="null"?c===null:l==="array"?Array.isArray(c):l==="object"?c&&!Array.isArray(c)&&typeof c=="object":l===typeof c)}function Zr(c,i){return c.kind==="array"&&i.kind==="array"?c.itemType.kind===i.itemType.kind&&typeof c.N=="number":c.kind===i.kind}let jn=.96422,ii=.82521,sl=4/29,ai=6/29,al=3*ai*ai,hh=ai*ai*ai,cn=Math.PI/180,Bi=180/Math.PI;function dh(c){return(c%=360)<0&&(c+=360),c}function eu([c,i,l,h]){let m,_,y=Cd((.2225045*(c=qr(c))+.7168786*(i=qr(i))+.0606169*(l=qr(l)))/1);c===i&&i===l?m=_=y:(m=Cd((.4360747*c+.3850649*i+.1430804*l)/jn),_=Cd((.0139322*c+.0971045*i+.7141733*l)/ii));let T=116*y-16;return[T<0?0:T,500*(m-y),200*(y-_),h]}function qr(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Cd(c){return c>hh?Math.pow(c,1/3):c/al+sl}function ec([c,i,l,h]){let m=(c+16)/116,_=isNaN(i)?m:m+i/500,y=isNaN(l)?m:m-l/200;return m=1*ji(m),_=jn*ji(_),y=ii*ji(y),[ea(3.1338561*_-1.6168667*m-.4906146*y),ea(-.9787684*_+1.9161415*m+.033454*y),ea(.0719453*_-.2289914*m+1.4052427*y),h]}function ea(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function ji(c){return c>ai?c*c*c:al*(c-sl)}let ll=Object.hasOwn||function(c,i){return Object.prototype.hasOwnProperty.call(c,i)};function ta(c,i){return ll(c,i)?c[i]:void 0}function ka(c){return parseInt(c.padEnd(2,c),16)/255}function fh(c,i){return ws(i?c/100:c,0,1)}function ws(c,i,l){return Math.min(Math.max(i,c),l)}function tu(c){return!c.some(Number.isNaN)}let cl={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function ls(c,i,l){return c+l*(i-c)}function Fa(c,i,l){return c.map((h,m)=>ls(h,i[m],l))}class sn{constructor(i,l,h,m=1,_=!0){this.r=i,this.g=l,this.b=h,this.a=m,_||(this.r*=m,this.g*=m,this.b*=m,m||this.overwriteGetter("rgb",[i,l,h,m]))}static parse(i){if(i instanceof sn)return i;if(typeof i!="string")return;let l=(function(h){if((h=h.toLowerCase().trim())==="transparent")return[0,0,0,0];let m=ta(cl,h);if(m){let[y,T,I]=m;return[y/255,T/255,I/255,1]}if(h.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(h)){let y=h.length<6?1:2,T=1;return[ka(h.slice(T,T+=y)),ka(h.slice(T,T+=y)),ka(h.slice(T,T+=y)),ka(h.slice(T,T+y)||"ff")]}if(h.startsWith("rgb")){let y=h.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){let[T,I,P,O,N,j,V,Z,X,K,ne,he]=y,re=[O||" ",V||" ",K].join("");if(re==="  "||re==="  /"||re===",,"||re===",,,"){let oe=[P,j,X].join(""),pe=oe==="%%%"?100:oe===""?255:0;if(pe){let ve=[ws(+I/pe,0,1),ws(+N/pe,0,1),ws(+Z/pe,0,1),ne?fh(+ne,he):1];if(tu(ve))return ve}}return}}let _=h.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){let[y,T,I,P,O,N,j,V,Z]=_,X=[I||" ",O||" ",j].join("");if(X==="  "||X==="  /"||X===",,"||X===",,,"){let K=[+T,ws(+P,0,100),ws(+N,0,100),V?fh(+V,Z):1];if(tu(K))return(function([ne,he,re,oe]){function pe(ve){let Oe=(ve+ne/30)%12,qe=he*Math.min(re,1-re);return re-qe*Math.max(-1,Math.min(Oe-3,9-Oe,1))}return ne=dh(ne),he/=100,re/=100,[pe(0),pe(8),pe(4),oe]})(K)}}})(i);return l?new sn(...l,!1):void 0}get rgb(){let{r:i,g:l,b:h,a:m}=this,_=m||1/0;return this.overwriteGetter("rgb",[i/_,l/_,h/_,m])}get hcl(){return this.overwriteGetter("hcl",(function(i){let[l,h,m,_]=eu(i),y=Math.sqrt(h*h+m*m);return[Math.round(1e4*y)?dh(Math.atan2(m,h)*Bi):NaN,y,l,_]})(this.rgb))}get lab(){return this.overwriteGetter("lab",eu(this.rgb))}overwriteGetter(i,l){return Object.defineProperty(this,i,{value:l}),l}toString(){let[i,l,h,m]=this.rgb;return`rgba(${[i,l,h].map(_=>Math.round(255*_)).join(",")},${m})`}static interpolate(i,l,h,m="rgb"){switch(m){case"rgb":{let[_,y,T,I]=Fa(i.rgb,l.rgb,h);return new sn(_,y,T,I,!1)}case"hcl":{let[_,y,T,I]=i.hcl,[P,O,N,j]=l.hcl,V,Z;if(isNaN(_)||isNaN(P))isNaN(_)?isNaN(P)?V=NaN:(V=P,T!==1&&T!==0||(Z=O)):(V=_,N!==1&&N!==0||(Z=y));else{let re=P-_;P>_&&re>180?re-=360:P<_&&_-P>180&&(re+=360),V=_+h*re}let[X,K,ne,he]=(function([re,oe,pe,ve]){return re=isNaN(re)?0:re*cn,ec([pe,Math.cos(re)*oe,Math.sin(re)*oe,ve])})([V,Z??ls(y,O,h),ls(T,N,h),ls(I,j,h)]);return new sn(X,K,ne,he,!1)}case"lab":{let[_,y,T,I]=ec(Fa(i.lab,l.lab,h));return new sn(_,y,T,I,!1)}}}}sn.black=new sn(0,0,0,1),sn.white=new sn(1,1,1,1),sn.transparent=new sn(0,0,0,0),sn.red=new sn(1,0,0,1);class tc{constructor(i,l,h){this.sensitivity=i?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}let hp=["bottom","center","top"];class nu{constructor(i,l,h,m,_,y){this.text=i,this.image=l,this.scale=h,this.fontStack=m,this.textColor=_,this.verticalAlign=y}}class ao{constructor(i){this.sections=i}static fromString(i){return new ao([new nu(i,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof ao?i:ao.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class Bt{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Bt)return i;if(typeof i=="number")return new Bt([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(let l of i)if(typeof l!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new Bt(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,l,h){return new Bt(Fa(i.values,l.values,h))}}class Vn{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Vn)return i;if(typeof i=="number")return new Vn([i]);if(Array.isArray(i)){for(let l of i)if(typeof l!="number")return;return new Vn(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,l,h){return new Vn(Fa(i.values,l.values,h))}}class bt{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof bt)return i;if(typeof i=="string"){let h=sn.parse(i);return h?new bt([h]):void 0}if(!Array.isArray(i))return;let l=[];for(let h of i){if(typeof h!="string")return;let m=sn.parse(h);if(!m)return;l.push(m)}return new bt(l)}toString(){return JSON.stringify(this.values)}static interpolate(i,l,h,m="rgb"){let _=[];if(i.values.length!=l.values.length)throw new Error(`colorArray: Arrays have mismatched length (${i.values.length} vs. ${l.values.length}), cannot interpolate.`);for(let y=0;y<i.values.length;y++)_.push(sn.interpolate(i.values[y],l.values[y],h,m));return new bt(_)}}class ri extends Error{constructor(i){super(i),this.name="RuntimeError"}toJSON(){return this.message}}let Es=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class vr{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof vr)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let l=0;l<i.length;l+=2){let h=i[l],m=i[l+1];if(typeof h!="string"||!Es.has(h)||!Array.isArray(m)||m.length!==2||typeof m[0]!="number"||typeof m[1]!="number")return}return new vr(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,l,h){let m=i.values,_=l.values;if(m.length!==_.length)throw new ri(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${l.toString()}`);let y=[];for(let T=0;T<m.length;T+=2){if(m[T]!==_[T])throw new ri(`Cannot interpolate values containing mismatched anchors. from[${T}]: ${m[T]}, to[${T}]: ${_[T]}`);y.push(m[T]);let[I,P]=m[T+1],[O,N]=_[T+1];y.push([ls(I,O,h),ls(P,N,h)])}return new vr(y)}}class Wr{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Wr({name:i,available:!1}):null}}class qi{constructor(i,l,h){this.from=i,this.to=l,this.transition=h}static interpolate(i,l,h){return new qi(i,l,h)}static parse(i){return i instanceof qi?i:Array.isArray(i)&&i.length===3&&typeof i[0]=="string"&&typeof i[1]=="string"&&typeof i[2]=="number"?new qi(i[0],i[1],i[2]):typeof i=="object"&&typeof i.from=="string"&&typeof i.to=="string"&&typeof i.transition=="number"?new qi(i.from,i.to,i.transition):typeof i=="string"?new qi(i,i,1):void 0}}function Na(c,i,l,h){return typeof c=="number"&&c>=0&&c<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof l=="number"&&l>=0&&l<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[c,i,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[c,i,l,h]:[c,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function qo(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof qi||c instanceof sn||c instanceof tc||c instanceof ao||c instanceof Bt||c instanceof Vn||c instanceof bt||c instanceof vr||c instanceof Wr)return!0;if(Array.isArray(c)){for(let i of c)if(!qo(i))return!1;return!0}if(typeof c=="object"){for(let i in c)if(!qo(c[i]))return!1;return!0}return!1}function Pn(c){if(c===null)return Mi;if(typeof c=="string")return en;if(typeof c=="boolean")return tn;if(typeof c=="number")return ht;if(c instanceof sn)return so;if(c instanceof qi)return ch;if(c instanceof tc)return Kc;if(c instanceof ao)return Yl;if(c instanceof Bt)return uh;if(c instanceof Vn)return Jc;if(c instanceof bt)return Qs;if(c instanceof vr)return Qc;if(c instanceof Wr)return Kl;if(Array.isArray(c)){let i=c.length,l;for(let h of c){let m=Pn(h);if(l){if(l===m)continue;l=on;break}l=m}return Hr(l||on,i)}return Js}function Po(c){let i=typeof c;return c===null?"":i==="string"||i==="number"||i==="boolean"?String(c):c instanceof sn||c instanceof qi||c instanceof ao||c instanceof Bt||c instanceof Vn||c instanceof bt||c instanceof vr||c instanceof Wr?c.toString():JSON.stringify(c)}class cs{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(i.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!qo(i[1]))return l.error("invalid value");let h=i[1],m=Pn(h),_=l.expectedType;return m.kind!=="array"||m.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(m=_),new cs(m,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}let iu={string:en,number:ht,boolean:tn,object:Js};class lo{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let h,m=1,_=i[0];if(_==="array"){let T,I;if(i.length>2){let P=i[1];if(typeof P!="string"||!(P in iu)||P==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);T=iu[P],m++}else T=on;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);I=i[2],m++}h=Hr(T,I)}else{if(!iu[_])throw new Error(`Types doesn't contain name = ${_}`);h=iu[_]}let y=[];for(;m<i.length;m++){let T=l.parse(i[m],m,on);if(!T)return null;y.push(T)}return new lo(h,y)}evaluate(i){for(let l=0;l<this.args.length;l++){let h=this.args[l].evaluate(i);if(!bs(this.type,Pn(h)))return h;if(l===this.args.length-1)throw new ri(`Expected value to be of type ${Kn(this.type)}, but found ${Kn(Pn(h))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}let za={"to-boolean":tn,"to-color":so,"to-number":ht,"to-string":en};class us{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let h=i[0];if(!za[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if((h==="to-boolean"||h==="to-string")&&i.length!==2)return l.error("Expected one argument.");let m=za[h],_=[];for(let y=1;y<i.length;y++){let T=l.parse(i[y],y,on);if(!T)return null;_.push(T)}return new us(m,_)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let l,h;for(let m of this.args){if(l=m.evaluate(i),h=null,l instanceof sn)return l;if(typeof l=="string"){let _=i.parseColor(l);if(_)return _}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rgba value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Na(l[0],l[1],l[2],l[3]),!h))return new sn(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new ri(h||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"padding":{let l;for(let h of this.args){l=h.evaluate(i);let m=Bt.parse(l);if(m)return m}throw new ri(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"numberArray":{let l;for(let h of this.args){l=h.evaluate(i);let m=Vn.parse(l);if(m)return m}throw new ri(`Could not parse numberArray from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"colorArray":{let l;for(let h of this.args){l=h.evaluate(i);let m=bt.parse(l);if(m)return m}throw new ri(`Could not parse colorArray from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(let h of this.args){l=h.evaluate(i);let m=vr.parse(l);if(m)return m}throw new ri(`Could not parse variableAnchorOffsetCollection from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(let h of this.args){if(l=h.evaluate(i),l===null)return 0;let m=Number(l);if(!isNaN(m))return m}throw new ri(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return ao.fromString(Po(this.args[0].evaluate(i)));case"resolvedImage":return Wr.fromString(Po(this.args[0].evaluate(i)));case"projectionDefinition":return this.args[0].evaluate(i);default:return Po(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}let dp=["Unknown","Point","LineString","Polygon"];class ph{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?dp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let l=this._parseColorCache.get(i);return l||(l=sn.parse(i),this._parseColorCache.set(i,l)),l}}class yn{constructor(i,l,h=[],m,_=new La,y=[]){this.registry=i,this.path=h,this.key=h.map(T=>`[${T}]`).join(""),this.scope=_,this.errors=y,this.expectedType=m,this._isConstant=l}parse(i,l,h,m,_={}){return l?this.concat(l,h,m)._parse(i,_):this._parse(i,_)}_parse(i,l){function h(m,_,y){return y==="assert"?new lo(_,[m]):y==="coerce"?new us(_,[m]):m}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let m=i[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let _=this.registry[m];if(_){let y=_.parse(i,this);if(!y)return null;if(this.expectedType){let T=this.expectedType,I=y.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||I.kind!=="value"){if(T.kind==="projectionDefinition"&&["string","array"].includes(I.kind)||["color","formatted","resolvedImage"].includes(T.kind)&&["value","string"].includes(I.kind)||["padding","numberArray"].includes(T.kind)&&["value","number","array"].includes(I.kind)||T.kind==="colorArray"&&["value","string","array"].includes(I.kind)||T.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(I.kind))y=h(y,T,l.typeAnnotation||"coerce");else if(this.checkSubtype(T,I))return null}else y=h(y,T,l.typeAnnotation||"assert")}if(!(y instanceof cs)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){let T=new ph;try{y=new cs(y.type,y.evaluate(T))}catch(I){return this.error(I.message),null}}return y}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,l,h){let m=typeof i=="number"?this.path.concat(i):this.path,_=h?this.scope.concat(h):this.scope;return new yn(this.registry,this._isConstant,m,l||null,_,this.errors)}error(i,...l){let h=`${this.key}${l.map(m=>`[${m}]`).join("")}`;this.errors.push(new yr(h,i))}checkSubtype(i,l){let h=bs(i,l);return h&&this.error(h),h}}class li{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(let l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);let h=[];for(let _=1;_<i.length-1;_+=2){let y=i[_];if(typeof y!="string")return l.error(`Expected string, but found ${typeof y} instead.`,_);if(/[^a-zA-Z0-9_]/.test(y))return l.error("Variable names must contain only alphanumeric characters or '_'.",_);let T=l.parse(i[_+1],_+1);if(!T)return null;h.push([y,T])}let m=l.parse(i[i.length-1],i.length-1,l.expectedType,h);return m?new li(h,m):null}outputDefined(){return this.result.outputDefined()}}class Ir{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(i.length!==2||typeof i[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");let h=i[1];return l.scope.has(h)?new Ir(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class mn{constructor(i,l,h){this.type=i,this.index=l,this.input=h}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);let h=l.parse(i[1],1,ht),m=l.parse(i[2],2,Hr(l.expectedType||on));return h&&m?new mn(m.type.itemType,h,m):null}evaluate(i){let l=this.index.evaluate(i),h=this.input.evaluate(i);if(l<0)throw new ri(`Array index out of bounds: ${l} < 0.`);if(l>=h.length)throw new ri(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l!==Math.floor(l))throw new ri(`Array index must be an integer, but found ${l} instead.`);return h[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class rn{constructor(i,l){this.type=tn,this.needle=i,this.haystack=l}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);let h=l.parse(i[1],1,on),m=l.parse(i[2],2,on);return h&&m?Ql(h.type,[tn,en,ht,Mi,on])?new rn(h,m):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Kn(h.type)} instead`):null}evaluate(i){let l=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!h)return!1;if(!Oa(l,["boolean","string","number","null"]))throw new ri(`Expected first argument to be of type boolean, string, number or null, but found ${Kn(Pn(l))} instead.`);if(!Oa(h,["string","array"]))throw new ri(`Expected second argument to be of type array or string, but found ${Kn(Pn(h))} instead.`);return h.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class nc{constructor(i,l,h){this.type=ht,this.needle=i,this.haystack=l,this.fromIndex=h}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 2 or 3 arguments, but found ${i.length-1} instead.`);let h=l.parse(i[1],1,on),m=l.parse(i[2],2,on);if(!h||!m)return null;if(!Ql(h.type,[tn,en,ht,Mi,on]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Kn(h.type)} instead`);if(i.length===4){let _=l.parse(i[3],3,ht);return _?new nc(h,m,_):null}return new nc(h,m)}evaluate(i){let l=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!Oa(l,["boolean","string","number","null"]))throw new ri(`Expected first argument to be of type boolean, string, number or null, but found ${Kn(Pn(l))} instead.`);let m;if(this.fromIndex&&(m=this.fromIndex.evaluate(i)),Oa(h,["string"])){let _=h.indexOf(l,m);return _===-1?-1:[...h.slice(0,_)].length}if(Oa(h,["array"]))return h.indexOf(l,m);throw new ri(`Expected second argument to be of type array or string, but found ${Kn(Pn(h))} instead.`)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class An{constructor(i,l,h,m,_,y){this.inputType=i,this.type=l,this.input=h,this.cases=m,this.outputs=_,this.otherwise=y}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return l.error("Expected an even number of arguments.");let h,m;l.expectedType&&l.expectedType.kind!=="value"&&(m=l.expectedType);let _={},y=[];for(let P=2;P<i.length-1;P+=2){let O=i[P],N=i[P+1];Array.isArray(O)||(O=[O]);let j=l.concat(P);if(O.length===0)return j.error("Expected at least one branch label.");for(let Z of O){if(typeof Z!="number"&&typeof Z!="string")return j.error("Branch labels must be numbers or strings.");if(typeof Z=="number"&&Math.abs(Z)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Z=="number"&&Math.floor(Z)!==Z)return j.error("Numeric branch labels must be integer values.");if(h){if(j.checkSubtype(h,Pn(Z)))return null}else h=Pn(Z);if(_[String(Z)]!==void 0)return j.error("Branch labels must be unique.");_[String(Z)]=y.length}let V=l.parse(N,P,m);if(!V)return null;m=m||V.type,y.push(V)}let T=l.parse(i[1],1,on);if(!T)return null;let I=l.parse(i[i.length-1],i.length-1,m);return I?T.type.kind!=="value"&&l.concat(1).checkSubtype(h,T.type)?null:new An(h,m,T,_,y,I):null}evaluate(i){let l=this.input.evaluate(i);return(Pn(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class ru{constructor(i,l,h){this.type=i,this.branches=l,this.otherwise=h}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&l.expectedType.kind!=="value"&&(h=l.expectedType);let m=[];for(let y=1;y<i.length-1;y+=2){let T=l.parse(i[y],y,tn);if(!T)return null;let I=l.parse(i[y+1],y+1,h);if(!I)return null;m.push([T,I]),h=h||I.type}let _=l.parse(i[i.length-1],i.length-1,h);if(!_)return null;if(!h)throw new Error("Can't infer output type");return new ru(h,m,_)}evaluate(i){for(let[l,h]of this.branches)if(l.evaluate(i))return h.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(let[l,h]of this.branches)i(l),i(h);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}}class Ao{constructor(i,l,h,m){this.type=i,this.input=l,this.beginIndex=h,this.endIndex=m}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 2 or 3 arguments, but found ${i.length-1} instead.`);let h=l.parse(i[1],1,on),m=l.parse(i[2],2,ht);if(!h||!m)return null;if(!Ql(h.type,[Hr(on),en,on]))return l.error(`Expected first argument to be of type array or string, but found ${Kn(h.type)} instead`);if(i.length===4){let _=l.parse(i[3],3,ht);return _?new Ao(h.type,h,m,_):null}return new Ao(h.type,h,m)}evaluate(i){let l=this.input.evaluate(i),h=this.beginIndex.evaluate(i),m;if(this.endIndex&&(m=this.endIndex.evaluate(i)),Oa(l,["string"]))return[...l].slice(h,m).join("");if(Oa(l,["array"]))return l.slice(h,m);throw new ri(`Expected first argument to be of type array or string, but found ${Kn(Pn(l))} instead.`)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function ic(c,i){let l=c.length-1,h,m,_=0,y=l,T=0;for(;_<=y;)if(T=Math.floor((_+y)/2),h=c[T],m=c[T+1],h<=i){if(T===l||i<m)return T;_=T+1}else{if(!(h>i))throw new ri("Input is not a number.");y=T-1}return 0}class Ba{constructor(i,l,h){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(let[m,_]of h)this.labels.push(m),this.outputs.push(_)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");let h=l.parse(i[1],1,ht);if(!h)return null;let m=[],_=null;l.expectedType&&l.expectedType.kind!=="value"&&(_=l.expectedType);for(let y=1;y<i.length;y+=2){let T=y===1?-1/0:i[y],I=i[y+1],P=y,O=y+1;if(typeof T!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(m.length&&m[m.length-1][0]>=T)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);let N=l.parse(I,O,_);if(!N)return null;_=_||N.type,m.push([T,N])}return new Ba(_,h,m)}evaluate(i){let l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(i);let m=this.input.evaluate(i);if(m<=l[0])return h[0].evaluate(i);let _=l.length;return m>=l[_-1]?h[_-1].evaluate(i):h[ic(l,m)].evaluate(i)}eachChild(i){i(this.input);for(let l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function mh(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var ou,Wo,Jg=(function(){if(Wo)return ou;function c(i,l,h,m){this.cx=3*i,this.bx=3*(h-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(m-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=l,this.p2x=h,this.p2y=m}return Wo=1,ou=c,c.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,l){if(l===void 0&&(l=1e-6),i<0)return 0;if(i>1)return 1;for(var h=i,m=0;m<8;m++){var _=this.sampleCurveX(h)-i;if(Math.abs(_)<l)return h;var y=this.sampleCurveDerivativeX(h);if(Math.abs(y)<1e-6)break;h-=_/y}var T=0,I=1;for(h=i,m=0;m<20&&(_=this.sampleCurveX(h),!(Math.abs(_-i)<l));m++)i>_?T=h:I=h,h=.5*(I-T)+T;return h},solve:function(i,l){return this.sampleCurveY(this.solveCurveX(i,l))}},ou})(),Id=mh(Jg);class Vi{constructor(i,l,h,m,_){this.type=i,this.operator=l,this.interpolation=h,this.input=m,this.labels=[],this.outputs=[];for(let[y,T]of _)this.labels.push(y),this.outputs.push(T)}static interpolationFactor(i,l,h,m){let _=0;if(i.name==="exponential")_=hs(l,i.base,h,m);else if(i.name==="linear")_=hs(l,1,h,m);else if(i.name==="cubic-bezier"){let y=i.controlPoints;_=new Id(y[0],y[1],y[2],y[3]).solve(hs(l,1,h,m))}return _}static parse(i,l){let[h,m,_,...y]=i;if(!Array.isArray(m)||m.length===0)return l.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){let P=m[1];if(typeof P!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:P}}else{if(m[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(m[0])}`,1,0);{let P=m.slice(1);if(P.length!==4||P.some(O=>typeof O!="number"||O<0||O>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:P}}}if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(_=l.parse(_,2,ht),!_)return null;let T=[],I=null;h!=="interpolate-hcl"&&h!=="interpolate-lab"||l.expectedType==Qs?l.expectedType&&l.expectedType.kind!=="value"&&(I=l.expectedType):I=so;for(let P=0;P<y.length;P+=2){let O=y[P],N=y[P+1],j=P+3,V=P+4;if(typeof O!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(T.length&&T[T.length-1][0]>=O)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);let Z=l.parse(N,V,I);if(!Z)return null;I=I||Z.type,T.push([O,Z])}return Zr(I,ht)||Zr(I,ch)||Zr(I,so)||Zr(I,uh)||Zr(I,Jc)||Zr(I,Qs)||Zr(I,Qc)||Zr(I,Hr(ht))?new Vi(I,h,m,_,T):l.error(`Type ${Kn(I)} is not interpolatable.`)}evaluate(i){let l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(i);let m=this.input.evaluate(i);if(m<=l[0])return h[0].evaluate(i);let _=l.length;if(m>=l[_-1])return h[_-1].evaluate(i);let y=ic(l,m),T=Vi.interpolationFactor(this.interpolation,m,l[y],l[y+1]),I=h[y].evaluate(i),P=h[y+1].evaluate(i);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return ls(I,P,T);case"color":return sn.interpolate(I,P,T);case"padding":return Bt.interpolate(I,P,T);case"colorArray":return bt.interpolate(I,P,T);case"numberArray":return Vn.interpolate(I,P,T);case"variableAnchorOffsetCollection":return vr.interpolate(I,P,T);case"array":return Fa(I,P,T);case"projectionDefinition":return qi.interpolate(I,P,T)}case"interpolate-hcl":switch(this.type.kind){case"color":return sn.interpolate(I,P,T,"hcl");case"colorArray":return bt.interpolate(I,P,T,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return sn.interpolate(I,P,T,"lab");case"colorArray":return bt.interpolate(I,P,T,"lab")}}}eachChild(i){i(this.input);for(let l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function hs(c,i,l,h){let m=h-l,_=c-l;return m===0?0:i===1?_/m:(Math.pow(i,_)-1)/(Math.pow(i,m)-1)}let mi={color:sn.interpolate,number:ls,padding:Bt.interpolate,numberArray:Vn.interpolate,colorArray:bt.interpolate,variableAnchorOffsetCollection:vr.interpolate,array:Fa};class na{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let h=null,m=l.expectedType;m&&m.kind!=="value"&&(h=m);let _=[];for(let T of i.slice(1)){let I=l.parse(T,1+_.length,h,void 0,{typeAnnotation:"omit"});if(!I)return null;h=h||I.type,_.push(I)}if(!h)throw new Error("No output type");let y=m&&_.some(T=>bs(m,T.type));return new na(y?on:h,_)}evaluate(i){let l,h=null,m=0;for(let _ of this.args)if(m++,h=_.evaluate(i),h&&h instanceof Wr&&!h.available&&(l||(l=h.name),h=null,m===this.args.length&&(h=l)),h!==null)break;return h}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}function Sd(c,i){return c==="=="||c==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function rc(c,i,l,h){return h.compare(i,l)===0}function Ci(c,i,l){let h=c!=="=="&&c!=="!=";return class SN{constructor(_,y,T){this.type=tn,this.lhs=_,this.rhs=y,this.collator=T,this.hasUntypedArgument=_.type.kind==="value"||y.type.kind==="value"}static parse(_,y){if(_.length!==3&&_.length!==4)return y.error("Expected two or three arguments.");let T=_[0],I=y.parse(_[1],1,on);if(!I)return null;if(!Sd(T,I.type))return y.concat(1).error(`"${T}" comparisons are not supported for type '${Kn(I.type)}'.`);let P=y.parse(_[2],2,on);if(!P)return null;if(!Sd(T,P.type))return y.concat(2).error(`"${T}" comparisons are not supported for type '${Kn(P.type)}'.`);if(I.type.kind!==P.type.kind&&I.type.kind!=="value"&&P.type.kind!=="value")return y.error(`Cannot compare types '${Kn(I.type)}' and '${Kn(P.type)}'.`);h&&(I.type.kind==="value"&&P.type.kind!=="value"?I=new lo(P.type,[I]):I.type.kind!=="value"&&P.type.kind==="value"&&(P=new lo(I.type,[P])));let O=null;if(_.length===4){if(I.type.kind!=="string"&&P.type.kind!=="string"&&I.type.kind!=="value"&&P.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(O=y.parse(_[3],3,Kc),!O)return null}return new SN(I,P,O)}evaluate(_){let y=this.lhs.evaluate(_),T=this.rhs.evaluate(_);if(h&&this.hasUntypedArgument){let I=Pn(y),P=Pn(T);if(I.kind!==P.kind||I.kind!=="string"&&I.kind!=="number")throw new ri(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${I.kind}, ${P.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){let I=Pn(y),P=Pn(T);if(I.kind!=="string"||P.kind!=="string")return i(_,y,T)}return this.collator?l(_,y,T,this.collator.evaluate(_)):i(_,y,T)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}let fp=Ci("==",function(c,i,l){return i===l},rc),Dd=Ci("!=",function(c,i,l){return i!==l},function(c,i,l,h){return!rc(0,i,l,h)}),gh=Ci("<",function(c,i,l){return i<l},function(c,i,l,h){return h.compare(i,l)<0}),Qg=Ci(">",function(c,i,l){return i>l},function(c,i,l,h){return h.compare(i,l)>0}),ul=Ci("<=",function(c,i,l){return i<=l},function(c,i,l,h){return h.compare(i,l)<=0}),su=Ci(">=",function(c,i,l){return i>=l},function(c,i,l,h){return h.compare(i,l)>=0});class ia{constructor(i,l,h){this.type=Kc,this.locale=h,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(i.length!==2)return l.error("Expected one argument.");let h=i[1];if(typeof h!="object"||Array.isArray(h))return l.error("Collator options argument must be an object.");let m=l.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,tn);if(!m)return null;let _=l.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,tn);if(!_)return null;let y=null;return h.locale&&(y=l.parse(h.locale,1,en),!y)?null:new ia(m,_,y)}evaluate(i){return new tc(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}class ra{constructor(i,l,h,m,_){this.type=en,this.number=i,this.locale=l,this.currency=h,this.minFractionDigits=m,this.maxFractionDigits=_}static parse(i,l){if(i.length!==3)return l.error("Expected two arguments.");let h=l.parse(i[1],1,ht);if(!h)return null;let m=i[2];if(typeof m!="object"||Array.isArray(m))return l.error("NumberFormat options argument must be an object.");let _=null;if(m.locale&&(_=l.parse(m.locale,1,en),!_))return null;let y=null;if(m.currency&&(y=l.parse(m.currency,1,en),!y))return null;let T=null;if(m["min-fraction-digits"]&&(T=l.parse(m["min-fraction-digits"],1,ht),!T))return null;let I=null;return m["max-fraction-digits"]&&(I=l.parse(m["max-fraction-digits"],1,ht),!I)?null:new ra(h,_,y,T,I)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class au{constructor(i){this.type=Yl,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let h=i[1];if(!Array.isArray(h)&&typeof h=="object")return l.error("First argument must be an image or text section.");let m=[],_=!1;for(let y=1;y<=i.length-1;++y){let T=i[y];if(_&&typeof T=="object"&&!Array.isArray(T)){_=!1;let I=null;if(T["font-scale"]&&(I=l.parse(T["font-scale"],1,ht),!I))return null;let P=null;if(T["text-font"]&&(P=l.parse(T["text-font"],1,Hr(en)),!P))return null;let O=null;if(T["text-color"]&&(O=l.parse(T["text-color"],1,so),!O))return null;let N=null;if(T["vertical-align"]){if(typeof T["vertical-align"]=="string"&&!hp.includes(T["vertical-align"]))return l.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${T["vertical-align"]}' instead.`);if(N=l.parse(T["vertical-align"],1,en),!N)return null}let j=m[m.length-1];j.scale=I,j.font=P,j.textColor=O,j.verticalAlign=N}else{let I=l.parse(i[y],1,on);if(!I)return null;let P=I.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,m.push({content:I,scale:null,font:null,textColor:null,verticalAlign:null})}}return new au(m)}evaluate(i){return new ao(this.sections.map(l=>{let h=l.content.evaluate(i);return Pn(h)===Kl?new nu("",h,null,null,null,l.verticalAlign?l.verticalAlign.evaluate(i):null):new nu(Po(h),null,l.scale?l.scale.evaluate(i):null,l.font?l.font.evaluate(i).join(","):null,l.textColor?l.textColor.evaluate(i):null,l.verticalAlign?l.verticalAlign.evaluate(i):null)}))}eachChild(i){for(let l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor),l.verticalAlign&&i(l.verticalAlign)}outputDefined(){return!1}}class Ts{constructor(i){this.type=Kl,this.input=i}static parse(i,l){if(i.length!==2)return l.error("Expected two arguments.");let h=l.parse(i[1],1,en);return h?new Ts(h):l.error("No image name provided.")}evaluate(i){let l=this.input.evaluate(i),h=Wr.fromString(l);return h&&i.availableImages&&(h.available=i.availableImages.indexOf(l)>-1),h}eachChild(i){i(this.input)}outputDefined(){return!1}}class xr{constructor(i){this.type=ht,this.input=i}static parse(i,l){if(i.length!==2)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);let h=l.parse(i[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${Kn(h.type)} instead.`):new xr(h):null}evaluate(i){let l=this.input.evaluate(i);if(typeof l=="string")return[...l].length;if(Array.isArray(l))return l.length;throw new ri(`Expected value to be of type string or array, but found ${Kn(Pn(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}let Wi=8192;function Md(c,i){let l=(180+c[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,m=Math.pow(2,i.z);return[Math.round(l*m*Wi),Math.round(h*m*Wi)]}function oc(c,i){let l=Math.pow(2,i.z);return[(m=(c[0]/Wi+i.x)/l,360*m-180),(h=(c[1]/Wi+i.y)/l,360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90)];var h,m}function hl(c,i){c[0]=Math.min(c[0],i[0]),c[1]=Math.min(c[1],i[1]),c[2]=Math.max(c[2],i[0]),c[3]=Math.max(c[3],i[1])}function oa(c,i){return!(c[0]<=i[0]||c[2]>=i[2]||c[1]<=i[1]||c[3]>=i[3])}function e_(c,i,l){let h=c[0]-i[0],m=c[1]-i[1],_=c[0]-l[0],y=c[1]-l[1];return h*y-_*m==0&&h*_<=0&&m*y<=0}function _h(c,i,l,h){return(m=[h[0]-l[0],h[1]-l[1]])[0]*(_=[i[0]-c[0],i[1]-c[1]])[1]-m[1]*_[0]!=0&&!(!ds(c,i,l,h)||!ds(l,h,c,i));var m,_}function pp(c,i,l){for(let h of l)for(let m=0;m<h.length-1;++m)if(_h(c,i,h[m],h[m+1]))return!0;return!1}function sc(c,i,l=!1){let h=!1;for(let T of i)for(let I=0;I<T.length-1;I++){if(e_(c,T[I],T[I+1]))return l;(_=T[I])[1]>(m=c)[1]!=(y=T[I+1])[1]>m[1]&&m[0]<(y[0]-_[0])*(m[1]-_[1])/(y[1]-_[1])+_[0]&&(h=!h)}var m,_,y;return h}function co(c,i){for(let l of i)if(sc(c,l))return!0;return!1}function dl(c,i){for(let l of c)if(!sc(l,i))return!1;for(let l=0;l<c.length-1;++l)if(pp(c[l],c[l+1],i))return!1;return!0}function mp(c,i){for(let l of i)if(dl(c,l))return!0;return!1}function ds(c,i,l,h){let m=h[0]-l[0],_=h[1]-l[1],y=(c[0]-l[0])*_-m*(c[1]-l[1]),T=(i[0]-l[0])*_-m*(i[1]-l[1]);return y>0&&T<0||y<0&&T>0}function Pd(c,i,l){let h=[];for(let m=0;m<c.length;m++){let _=[];for(let y=0;y<c[m].length;y++){let T=Md(c[m][y],l);hl(i,T),_.push(T)}h.push(_)}return h}function ja(c,i,l){let h=[];for(let m=0;m<c.length;m++){let _=Pd(c[m],i,l);h.push(_)}return h}function gp(c,i,l,h){if(c[0]<l[0]||c[0]>l[2]){let m=.5*h,_=c[0]-l[0]>m?-h:l[0]-c[0]>m?h:0;_===0&&(_=c[0]-l[2]>m?-h:l[2]-c[0]>m?h:0),c[0]+=_}hl(i,c)}function ac(c,i,l,h){let m=Math.pow(2,h.z)*Wi,_=[h.x*Wi,h.y*Wi],y=[];for(let T of c)for(let I of T){let P=[I.x+_[0],I.y+_[1]];gp(P,i,l,m),y.push(P)}return y}function Ad(c,i,l,h){let m=Math.pow(2,h.z)*Wi,_=[h.x*Wi,h.y*Wi],y=[];for(let I of c){let P=[];for(let O of I){let N=[O.x+_[0],O.y+_[1]];hl(i,N),P.push(N)}y.push(P)}if(i[2]-i[0]<=m/2){(T=i)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(let I of y)for(let P of I)gp(P,i,l,m)}var T;return y}class Cs{constructor(i,l){this.type=tn,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(qo(i[1])){let h=i[1];if(h.type==="FeatureCollection"){let m=[];for(let _ of h.features){let{type:y,coordinates:T}=_.geometry;y==="Polygon"&&m.push(T),y==="MultiPolygon"&&m.push(...T)}if(m.length)return new Cs(h,{type:"MultiPolygon",coordinates:m})}else if(h.type==="Feature"){let m=h.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Cs(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new Cs(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return(function(l,h){let m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(h.type==="Polygon"){let T=Pd(h.coordinates,_,y),I=ac(l.geometry(),m,_,y);if(!oa(m,_))return!1;for(let P of I)if(!sc(P,T))return!1}if(h.type==="MultiPolygon"){let T=ja(h.coordinates,_,y),I=ac(l.geometry(),m,_,y);if(!oa(m,_))return!1;for(let P of I)if(!co(P,T))return!1}return!0})(i,this.geometries);if(i.geometryType()==="LineString")return(function(l,h){let m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(h.type==="Polygon"){let T=Pd(h.coordinates,_,y),I=Ad(l.geometry(),m,_,y);if(!oa(m,_))return!1;for(let P of I)if(!dl(P,T))return!1}if(h.type==="MultiPolygon"){let T=ja(h.coordinates,_,y),I=Ad(l.geometry(),m,_,y);if(!oa(m,_))return!1;for(let P of I)if(!mp(P,T))return!1}return!0})(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let _p=class{constructor(c=[],i=(l,h)=>l<h?-1:l>h?1:0){if(this.data=c,this.length=this.data.length,this.compare=i,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(c){this.data.push(c),this._up(this.length++)}pop(){if(this.length===0)return;let c=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),c}peek(){return this.data[0]}_up(c){let{data:i,compare:l}=this,h=i[c];for(;c>0;){let m=c-1>>1,_=i[m];if(l(h,_)>=0)break;i[c]=_,c=m}i[c]=h}_down(c){let{data:i,compare:l}=this,h=this.length>>1,m=i[c];for(;c<h;){let _=1+(c<<1),y=_+1;if(y<this.length&&l(i[y],i[_])<0&&(_=y),l(i[_],m)>=0)break;i[c]=i[_],c=_}i[c]=m}};function Is(c,i,l=0,h=c.length-1,m=yp){for(;h>l;){if(h-l>600){let I=h-l+1,P=i-l+1,O=Math.log(I),N=.5*Math.exp(2*O/3),j=.5*Math.sqrt(O*N*(I-N)/I)*(P-I/2<0?-1:1);Is(c,i,Math.max(l,Math.floor(i-P*N/I+j)),Math.min(h,Math.floor(i+(I-P)*N/I+j)),m)}let _=c[i],y=l,T=h;for(sa(c,l,i),m(c[h],_)>0&&sa(c,l,h);y<T;){for(sa(c,y,T),y++,T--;m(c[y],_)<0;)y++;for(;m(c[T],_)>0;)T--}m(c[l],_)===0?sa(c,l,T):(T++,sa(c,T,h)),T<=i&&(l=T+1),i<=T&&(h=T-1)}}function sa(c,i,l){let h=c[i];c[i]=c[l],c[l]=h}function yp(c,i){return c<i?-1:c>i?1:0}function lc(c,i){if(c.length<=1)return[c];let l=[],h,m;for(let _ of c){let y=aa(_);y!==0&&(_.area=Math.abs(y),m===void 0&&(m=y<0),m===y<0?(h&&l.push(h),h=[_]):h.push(_))}if(h&&l.push(h),i>1)for(let _=0;_<l.length;_++)l[_].length<=i||(Is(l[_],i,1,l[_].length-1,t_),l[_]=l[_].slice(0,i));return l}function t_(c,i){return i.area-c.area}function aa(c){let i=0;for(let l,h,m=0,_=c.length,y=_-1;m<_;y=m++)l=c[m],h=c[y],i+=(h.x-l.x)*(l.y+h.y);return i}let vp=1/298.257223563,Ss=vp*(2-vp),xp=Math.PI/180;class fs{constructor(i){let l=6378.137*xp*1e3,h=Math.cos(i*xp),m=1/(1-Ss*(1-h*h)),_=Math.sqrt(m);this.kx=l*_*h,this.ky=l*_*m*(1-Ss)}distance(i,l){let h=this.wrap(i[0]-l[0])*this.kx,m=(i[1]-l[1])*this.ky;return Math.sqrt(h*h+m*m)}pointOnLine(i,l){let h,m,_,y,T=1/0;for(let I=0;I<i.length-1;I++){let P=i[I][0],O=i[I][1],N=this.wrap(i[I+1][0]-P)*this.kx,j=(i[I+1][1]-O)*this.ky,V=0;N===0&&j===0||(V=(this.wrap(l[0]-P)*this.kx*N+(l[1]-O)*this.ky*j)/(N*N+j*j),V>1?(P=i[I+1][0],O=i[I+1][1]):V>0&&(P+=N/this.kx*V,O+=j/this.ky*V)),N=this.wrap(l[0]-P)*this.kx,j=(l[1]-O)*this.ky;let Z=N*N+j*j;Z<T&&(T=Z,h=P,m=O,_=I,y=V)}return{point:[h,m],index:_,t:Math.max(0,Math.min(1,y))}}wrap(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}}function lu(c,i){return i[0]-c[0]}function cu(c){return c[1]-c[0]+1}function Ro(c,i){return c[1]>=c[0]&&c[1]<i}function fl(c,i){if(c[0]>c[1])return[null,null];let l=cu(c);if(i){if(l===2)return[c,null];let m=Math.floor(l/2);return[[c[0],c[0]+m],[c[0]+m,c[1]]]}if(l===1)return[c,null];let h=Math.floor(l/2)-1;return[[c[0],c[0]+h],[c[0]+h+1,c[1]]]}function uu(c,i){if(!Ro(i,c.length))return[1/0,1/0,-1/0,-1/0];let l=[1/0,1/0,-1/0,-1/0];for(let h=i[0];h<=i[1];++h)hl(l,c[h]);return l}function cc(c){let i=[1/0,1/0,-1/0,-1/0];for(let l of c)for(let h of l)hl(i,h);return i}function Va(c){return c[0]!==-1/0&&c[1]!==-1/0&&c[2]!==1/0&&c[3]!==1/0}function pl(c,i,l){if(!Va(c)||!Va(i))return NaN;let h=0,m=0;return c[2]<i[0]&&(h=i[0]-c[2]),c[0]>i[2]&&(h=c[0]-i[2]),c[1]>i[3]&&(m=c[1]-i[3]),c[3]<i[1]&&(m=i[1]-c[3]),l.distance([0,0],[h,m])}function la(c,i,l){let h=l.pointOnLine(i,c);return l.distance(c,h.point)}function yh(c,i,l,h,m){let _=Math.min(la(c,[l,h],m),la(i,[l,h],m)),y=Math.min(la(l,[c,i],m),la(h,[c,i],m));return Math.min(_,y)}function n_(c,i,l,h,m){if(!Ro(i,c.length)||!Ro(h,l.length))return 1/0;let _=1/0;for(let y=i[0];y<i[1];++y){let T=c[y],I=c[y+1];for(let P=h[0];P<h[1];++P){let O=l[P],N=l[P+1];if(_h(T,I,O,N))return 0;_=Math.min(_,yh(T,I,O,N,m))}}return _}function hu(c,i,l,h,m){if(!Ro(i,c.length)||!Ro(h,l.length))return NaN;let _=1/0;for(let y=i[0];y<=i[1];++y)for(let T=h[0];T<=h[1];++T)if(_=Math.min(_,m.distance(c[y],l[T])),_===0)return _;return _}function i_(c,i,l){if(sc(c,i,!0))return 0;let h=1/0;for(let m of i){let _=m[0],y=m[m.length-1];if(_!==y&&(h=Math.min(h,la(c,[y,_],l)),h===0))return h;let T=l.pointOnLine(m,c);if(h=Math.min(h,l.distance(c,T.point)),h===0)return h}return h}function bp(c,i,l,h){if(!Ro(i,c.length))return NaN;for(let _=i[0];_<=i[1];++_)if(sc(c[_],l,!0))return 0;let m=1/0;for(let _=i[0];_<i[1];++_){let y=c[_],T=c[_+1];for(let I of l)for(let P=0,O=I.length,N=O-1;P<O;N=P++){let j=I[N],V=I[P];if(_h(y,T,j,V))return 0;m=Math.min(m,yh(y,T,j,V,h))}}return m}function wp(c,i){for(let l of c)for(let h of l)if(sc(h,i,!0))return!0;return!1}function Ep(c,i,l,h=1/0){let m=cc(c),_=cc(i);if(h!==1/0&&pl(m,_,l)>=h)return h;if(oa(m,_)){if(wp(c,i))return 0}else if(wp(i,c))return 0;let y=1/0;for(let T of c)for(let I=0,P=T.length,O=P-1;I<P;O=I++){let N=T[O],j=T[I];for(let V of i)for(let Z=0,X=V.length,K=X-1;Z<X;K=Z++){let ne=V[K],he=V[Z];if(_h(N,j,ne,he))return 0;y=Math.min(y,yh(N,j,ne,he,l))}}return y}function Un(c,i,l,h,m,_){if(!_)return;let y=pl(uu(h,_),m,l);y<i&&c.push([y,_,[0,0]])}function Lo(c,i,l,h,m,_,y){if(!_||!y)return;let T=pl(uu(h,_),uu(m,y),l);T<i&&c.push([T,_,y])}function ml(c,i,l,h,m=1/0){let _=Math.min(h.distance(c[0],l[0][0]),m);if(_===0)return _;let y=new _p([[0,[0,c.length-1],[0,0]]],lu),T=cc(l);for(;y.length>0;){let I=y.pop();if(I[0]>=_)continue;let P=I[1],O=i?50:100;if(cu(P)<=O){if(!Ro(P,c.length))return NaN;if(i){let N=bp(c,P,l,h);if(isNaN(N)||N===0)return N;_=Math.min(_,N)}else for(let N=P[0];N<=P[1];++N){let j=i_(c[N],l,h);if(_=Math.min(_,j),_===0)return 0}}else{let N=fl(P,i);Un(y,_,h,c,T,N[0]),Un(y,_,h,c,T,N[1])}}return _}function vh(c,i,l,h,m,_=1/0){let y=Math.min(_,m.distance(c[0],l[0]));if(y===0)return y;let T=new _p([[0,[0,c.length-1],[0,l.length-1]]],lu);for(;T.length>0;){let I=T.pop();if(I[0]>=y)continue;let P=I[1],O=I[2],N=i?50:100,j=h?50:100;if(cu(P)<=N&&cu(O)<=j){if(!Ro(P,c.length)&&Ro(O,l.length))return NaN;let V;if(i&&h)V=n_(c,P,l,O,m),y=Math.min(y,V);else if(i&&!h){let Z=c.slice(P[0],P[1]+1);for(let X=O[0];X<=O[1];++X)if(V=la(l[X],Z,m),y=Math.min(y,V),y===0)return y}else if(!i&&h){let Z=l.slice(O[0],O[1]+1);for(let X=P[0];X<=P[1];++X)if(V=la(c[X],Z,m),y=Math.min(y,V),y===0)return y}else V=hu(c,P,l,O,m),y=Math.min(y,V)}else{let V=fl(P,i),Z=fl(O,h);Lo(T,y,m,c,l,V[0],Z[0]),Lo(T,y,m,c,l,V[0],Z[1]),Lo(T,y,m,c,l,V[1],Z[0]),Lo(T,y,m,c,l,V[1],Z[1])}}return y}function uc(c){return c.type==="MultiPolygon"?c.coordinates.map(i=>({type:"Polygon",coordinates:i})):c.type==="MultiLineString"?c.coordinates.map(i=>({type:"LineString",coordinates:i})):c.type==="MultiPoint"?c.coordinates.map(i=>({type:"Point",coordinates:i})):[c]}class gl{constructor(i,l){this.type=ht,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'distance' expression requires exactly one argument, but found ${i.length-1} instead.`);if(qo(i[1])){let h=i[1];if(h.type==="FeatureCollection")return new gl(h,h.features.map(m=>uc(m.geometry)).flat());if(h.type==="Feature")return new gl(h,uc(h.geometry));if("type"in h&&"coordinates"in h)return new gl(h,uc(h))}return l.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return(function(l,h){let m=l.geometry(),_=m.flat().map(I=>oc([I.x,I.y],l.canonical));if(m.length===0)return NaN;let y=new fs(_[0][1]),T=1/0;for(let I of h){switch(I.type){case"Point":T=Math.min(T,vh(_,!1,[I.coordinates],!1,y,T));break;case"LineString":T=Math.min(T,vh(_,!1,I.coordinates,!0,y,T));break;case"Polygon":T=Math.min(T,ml(_,!1,I.coordinates,y,T))}if(T===0)return T}return T})(i,this.geometries);if(i.geometryType()==="LineString")return(function(l,h){let m=l.geometry(),_=m.flat().map(I=>oc([I.x,I.y],l.canonical));if(m.length===0)return NaN;let y=new fs(_[0][1]),T=1/0;for(let I of h){switch(I.type){case"Point":T=Math.min(T,vh(_,!0,[I.coordinates],!1,y,T));break;case"LineString":T=Math.min(T,vh(_,!0,I.coordinates,!0,y,T));break;case"Polygon":T=Math.min(T,ml(_,!0,I.coordinates,y,T))}if(T===0)return T}return T})(i,this.geometries);if(i.geometryType()==="Polygon")return(function(l,h){let m=l.geometry();if(m.length===0||m[0].length===0)return NaN;let _=lc(m,0).map(I=>I.map(P=>P.map(O=>oc([O.x,O.y],l.canonical)))),y=new fs(_[0][0][0][1]),T=1/0;for(let I of h)for(let P of _){switch(I.type){case"Point":T=Math.min(T,ml([I.coordinates],!1,P,y,T));break;case"LineString":T=Math.min(T,ml(I.coordinates,!0,P,y,T));break;case"Polygon":T=Math.min(T,Ep(P,I.coordinates,y,T))}if(T===0)return T}return T})(i,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class hc{constructor(i){this.type=on,this.key=i}static parse(i,l){if(i.length!==2)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);let h=i[1];return h==null?l.error("Global state property must be defined."):typeof h!="string"?l.error(`Global state property must be string, but found ${typeof i[1]} instead.`):new hc(h)}evaluate(i){var l;let h=(l=i.globals)===null||l===void 0?void 0:l.globalState;return h&&Object.keys(h).length!==0?ta(h,this.key):null}eachChild(){}outputDefined(){return!1}}let dc={"==":fp,"!=":Dd,">":Qg,"<":gh,">=":su,"<=":ul,array:lo,at:mn,boolean:lo,case:ru,coalesce:na,collator:ia,format:au,image:Ts,in:rn,"index-of":nc,interpolate:Vi,"interpolate-hcl":Vi,"interpolate-lab":Vi,length:xr,let:li,literal:cs,match:An,number:lo,"number-format":ra,object:lo,slice:Ao,step:Ba,string:lo,"to-boolean":us,"to-color":us,"to-number":us,"to-string":us,var:Ir,within:Cs,distance:gl,"global-state":hc};class Sr{constructor(i,l,h,m){this.name=i,this.type=l,this._evaluate=h,this.args=m}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,l){let h=i[0],m=Sr.definitions[h];if(!m)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);let _=Array.isArray(m)?m[0]:m.type,y=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,T=y.filter(([P])=>!Array.isArray(P)||P.length===i.length-1),I=null;for(let[P,O]of T){I=new yn(l.registry,bh,l.path,null,l.scope);let N=[],j=!1;for(let V=1;V<i.length;V++){let Z=i[V],X=Array.isArray(P)?P[V-1]:P.type,K=I.parse(Z,1+N.length,X);if(!K){j=!0;break}N.push(K)}if(!j)if(Array.isArray(P)&&P.length!==N.length)I.error(`Expected ${P.length} arguments, but found ${N.length} instead.`);else{for(let V=0;V<N.length;V++){let Z=Array.isArray(P)?P[V]:P.type,X=N[V];I.concat(V+1).checkSubtype(Z,X.type)}if(I.errors.length===0)return new Sr(h,_,O,N)}}if(T.length===1)l.errors.push(...I.errors);else{let P=(T.length?T:y).map(([N])=>{return j=N,Array.isArray(j)?`(${j.map(Kn).join(", ")})`:`(${Kn(j.type)}...)`;var j}).join(" | "),O=[];for(let N=1;N<i.length;N++){let j=l.parse(i[N],1+O.length);if(!j)return null;O.push(Kn(j.type))}l.error(`Expected arguments of type ${P}, but found (${O.join(", ")}) instead.`)}return null}static register(i,l){Sr.definitions=l;for(let h in l)i[h]=Sr}}function Tp(c,[i,l,h,m]){i=i.evaluate(c),l=l.evaluate(c),h=h.evaluate(c);let _=m?m.evaluate(c):1,y=Na(i,l,h,_);if(y)throw new ri(y);return new sn(i/255,l/255,h/255,_,!1)}function _l(c,i){return c in i}function xh(c,i){let l=i[c];return l===void 0?null:l}function Ua(c){return{type:c}}function bh(c){if(c instanceof Ir)return bh(c.boundExpression);if(c instanceof Sr&&c.name==="error"||c instanceof ia||c instanceof Cs||c instanceof gl||c instanceof hc)return!1;let i=c instanceof us||c instanceof lo,l=!0;return c.eachChild(h=>{l=i?l&&bh(h):l&&h instanceof cs}),!!l&&Xo(c)&&du(c,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Xo(c){if(c instanceof Sr&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Cs||c instanceof gl)return!1;let i=!0;return c.eachChild(l=>{i&&!Xo(l)&&(i=!1)}),i}function fc(c){if(c instanceof Sr&&c.name==="feature-state")return!1;let i=!0;return c.eachChild(l=>{i&&!fc(l)&&(i=!1)}),i}function du(c,i){if(c instanceof Sr&&i.indexOf(c.name)>=0)return!1;let l=!0;return c.eachChild(h=>{l&&!du(h,i)&&(l=!1)}),l}function pc(c){return{result:"success",value:c}}function mc(c){return{result:"error",value:c}}function ca(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function gc(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function wh(c){return!!c.expression&&c.expression.interpolated}function hn(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function Eh(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)&&Pn(c)===Js}function Cp(c){return c}function Rd(c,i){let l=c.stops&&typeof c.stops[0][0]=="object",h=l||!(l||c.property!==void 0),m=c.type||(wh(i)?"exponential":"interval"),_=(function(O){switch(O.type){case"color":return sn.parse;case"padding":return Bt.parse;case"numberArray":return Vn.parse;case"colorArray":return bt.parse;default:return null}})(i);if(_&&((c=Zn({},c)).stops&&(c.stops=c.stops.map(O=>[O[0],_(O[1])])),c.default=_(c.default?c.default:i.default)),c.colorSpace&&(y=c.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var y;let T=(function(O){switch(O){case"exponential":return Dp;case"interval":return Sp;case"categorical":return Ip;case"identity":return Mp;default:throw new Error(`Unknown function type "${O}"`)}})(m),I,P;if(m==="categorical"){I=Object.create(null);for(let O of c.stops)I[O[0]]=O[1];P=typeof c.stops[0][0]}if(l){let O={},N=[];for(let Z=0;Z<c.stops.length;Z++){let X=c.stops[Z],K=X[0].zoom;O[K]===void 0&&(O[K]={zoom:K,type:c.type,property:c.property,default:c.default,stops:[]},N.push(K)),O[K].stops.push([X[0].value,X[1]])}let j=[];for(let Z of N)j.push([O[Z].zoom,Rd(O[Z],i)]);let V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:Vi.interpolationFactor.bind(void 0,V),zoomStops:j.map(Z=>Z[0]),evaluate:({zoom:Z},X)=>Dp({stops:j,base:c.base},i,Z).evaluate(Z,X)}}if(h){let O=m==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:O,interpolationFactor:Vi.interpolationFactor.bind(void 0,O),zoomStops:c.stops.map(N=>N[0]),evaluate:({zoom:N})=>T(c,i,N,I,P)}}return{kind:"source",evaluate(O,N){let j=N&&N.properties?N.properties[c.property]:void 0;return j===void 0?_c(c.default,i.default):T(c,i,j,I,P)}}}function _c(c,i,l){return c!==void 0?c:i!==void 0?i:l!==void 0?l:void 0}function Ip(c,i,l,h,m){return _c(typeof l===m?h[l]:void 0,c.default,i.default)}function Sp(c,i,l){if(hn(l)!=="number")return _c(c.default,i.default);let h=c.stops.length;if(h===1||l<=c.stops[0][0])return c.stops[0][1];if(l>=c.stops[h-1][0])return c.stops[h-1][1];let m=ic(c.stops.map(_=>_[0]),l);return c.stops[m][1]}function Dp(c,i,l){let h=c.base!==void 0?c.base:1;if(hn(l)!=="number")return _c(c.default,i.default);let m=c.stops.length;if(m===1||l<=c.stops[0][0])return c.stops[0][1];if(l>=c.stops[m-1][0])return c.stops[m-1][1];let _=ic(c.stops.map(O=>O[0]),l),y=(function(O,N,j,V){let Z=V-j,X=O-j;return Z===0?0:N===1?X/Z:(Math.pow(N,X)-1)/(Math.pow(N,Z)-1)})(l,h,c.stops[_][0],c.stops[_+1][0]),T=c.stops[_][1],I=c.stops[_+1][1],P=mi[i.type]||Cp;return typeof T.evaluate=="function"?{evaluate(...O){let N=T.evaluate.apply(void 0,O),j=I.evaluate.apply(void 0,O);if(N!==void 0&&j!==void 0)return P(N,j,y,c.colorSpace)}}:P(T,I,y,c.colorSpace)}function Mp(c,i,l){switch(i.type){case"color":l=sn.parse(l);break;case"formatted":l=ao.fromString(l.toString());break;case"resolvedImage":l=Wr.fromString(l.toString());break;case"padding":l=Bt.parse(l);break;case"colorArray":l=bt.parse(l);break;case"numberArray":l=Vn.parse(l);break;default:hn(l)===i.type||i.type==="enum"&&i.values[l]||(l=void 0)}return _c(l,c.default,i.default)}Sr.register(dc,{error:[{kind:"error"},[en],(c,[i])=>{throw new ri(i.evaluate(c))}],typeof:[en,[on],(c,[i])=>Kn(Pn(i.evaluate(c)))],"to-rgba":[Hr(ht,4),[so],(c,[i])=>{let[l,h,m,_]=i.evaluate(c).rgb;return[255*l,255*h,255*m,_]}],rgb:[so,[ht,ht,ht],Tp],rgba:[so,[ht,ht,ht,ht],Tp],has:{type:tn,overloads:[[[en],(c,[i])=>_l(i.evaluate(c),c.properties())],[[en,Js],(c,[i,l])=>_l(i.evaluate(c),l.evaluate(c))]]},get:{type:on,overloads:[[[en],(c,[i])=>xh(i.evaluate(c),c.properties())],[[en,Js],(c,[i,l])=>xh(i.evaluate(c),l.evaluate(c))]]},"feature-state":[on,[en],(c,[i])=>xh(i.evaluate(c),c.featureState||{})],properties:[Js,[],c=>c.properties()],"geometry-type":[en,[],c=>c.geometryType()],id:[on,[],c=>c.id()],zoom:[ht,[],c=>c.globals.zoom],"heatmap-density":[ht,[],c=>c.globals.heatmapDensity||0],elevation:[ht,[],c=>c.globals.elevation||0],"line-progress":[ht,[],c=>c.globals.lineProgress||0],accumulated:[on,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[ht,Ua(ht),(c,i)=>{let l=0;for(let h of i)l+=h.evaluate(c);return l}],"*":[ht,Ua(ht),(c,i)=>{let l=1;for(let h of i)l*=h.evaluate(c);return l}],"-":{type:ht,overloads:[[[ht,ht],(c,[i,l])=>i.evaluate(c)-l.evaluate(c)],[[ht],(c,[i])=>-i.evaluate(c)]]},"/":[ht,[ht,ht],(c,[i,l])=>i.evaluate(c)/l.evaluate(c)],"%":[ht,[ht,ht],(c,[i,l])=>i.evaluate(c)%l.evaluate(c)],ln2:[ht,[],()=>Math.LN2],pi:[ht,[],()=>Math.PI],e:[ht,[],()=>Math.E],"^":[ht,[ht,ht],(c,[i,l])=>Math.pow(i.evaluate(c),l.evaluate(c))],sqrt:[ht,[ht],(c,[i])=>Math.sqrt(i.evaluate(c))],log10:[ht,[ht],(c,[i])=>Math.log(i.evaluate(c))/Math.LN10],ln:[ht,[ht],(c,[i])=>Math.log(i.evaluate(c))],log2:[ht,[ht],(c,[i])=>Math.log(i.evaluate(c))/Math.LN2],sin:[ht,[ht],(c,[i])=>Math.sin(i.evaluate(c))],cos:[ht,[ht],(c,[i])=>Math.cos(i.evaluate(c))],tan:[ht,[ht],(c,[i])=>Math.tan(i.evaluate(c))],asin:[ht,[ht],(c,[i])=>Math.asin(i.evaluate(c))],acos:[ht,[ht],(c,[i])=>Math.acos(i.evaluate(c))],atan:[ht,[ht],(c,[i])=>Math.atan(i.evaluate(c))],min:[ht,Ua(ht),(c,i)=>Math.min(...i.map(l=>l.evaluate(c)))],max:[ht,Ua(ht),(c,i)=>Math.max(...i.map(l=>l.evaluate(c)))],abs:[ht,[ht],(c,[i])=>Math.abs(i.evaluate(c))],round:[ht,[ht],(c,[i])=>{let l=i.evaluate(c);return l<0?-Math.round(-l):Math.round(l)}],floor:[ht,[ht],(c,[i])=>Math.floor(i.evaluate(c))],ceil:[ht,[ht],(c,[i])=>Math.ceil(i.evaluate(c))],"filter-==":[tn,[en,on],(c,[i,l])=>c.properties()[i.value]===l.value],"filter-id-==":[tn,[on],(c,[i])=>c.id()===i.value],"filter-type-==":[tn,[en],(c,[i])=>c.geometryType()===i.value],"filter-<":[tn,[en,on],(c,[i,l])=>{let h=c.properties()[i.value],m=l.value;return typeof h==typeof m&&h<m}],"filter-id-<":[tn,[on],(c,[i])=>{let l=c.id(),h=i.value;return typeof l==typeof h&&l<h}],"filter->":[tn,[en,on],(c,[i,l])=>{let h=c.properties()[i.value],m=l.value;return typeof h==typeof m&&h>m}],"filter-id->":[tn,[on],(c,[i])=>{let l=c.id(),h=i.value;return typeof l==typeof h&&l>h}],"filter-<=":[tn,[en,on],(c,[i,l])=>{let h=c.properties()[i.value],m=l.value;return typeof h==typeof m&&h<=m}],"filter-id-<=":[tn,[on],(c,[i])=>{let l=c.id(),h=i.value;return typeof l==typeof h&&l<=h}],"filter->=":[tn,[en,on],(c,[i,l])=>{let h=c.properties()[i.value],m=l.value;return typeof h==typeof m&&h>=m}],"filter-id->=":[tn,[on],(c,[i])=>{let l=c.id(),h=i.value;return typeof l==typeof h&&l>=h}],"filter-has":[tn,[on],(c,[i])=>i.value in c.properties()],"filter-has-id":[tn,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[tn,[Hr(en)],(c,[i])=>i.value.indexOf(c.geometryType())>=0],"filter-id-in":[tn,[Hr(on)],(c,[i])=>i.value.indexOf(c.id())>=0],"filter-in-small":[tn,[en,Hr(on)],(c,[i,l])=>l.value.indexOf(c.properties()[i.value])>=0],"filter-in-large":[tn,[en,Hr(on)],(c,[i,l])=>(function(h,m,_,y){for(;_<=y;){let T=_+y>>1;if(m[T]===h)return!0;m[T]>h?y=T-1:_=T+1}return!1})(c.properties()[i.value],l.value,0,l.value.length-1)],all:{type:tn,overloads:[[[tn,tn],(c,[i,l])=>i.evaluate(c)&&l.evaluate(c)],[Ua(tn),(c,i)=>{for(let l of i)if(!l.evaluate(c))return!1;return!0}]]},any:{type:tn,overloads:[[[tn,tn],(c,[i,l])=>i.evaluate(c)||l.evaluate(c)],[Ua(tn),(c,i)=>{for(let l of i)if(l.evaluate(c))return!0;return!1}]]},"!":[tn,[tn],(c,[i])=>!i.evaluate(c)],"is-supported-script":[tn,[en],(c,[i])=>{let l=c.globals&&c.globals.isSupportedScript;return!l||l(i.evaluate(c))}],upcase:[en,[en],(c,[i])=>i.evaluate(c).toUpperCase()],downcase:[en,[en],(c,[i])=>i.evaluate(c).toLowerCase()],concat:[en,Ua(on),(c,i)=>i.map(l=>Po(l.evaluate(c))).join("")],"resolved-locale":[en,[Kc],(c,[i])=>i.evaluate(c).resolvedLocale()]});class Th{constructor(i,l,h){this.expression=i,this._warningHistory={},this._evaluator=new ph,this._defaultValue=l?(function(m){if(m.type==="color"&&Eh(m.default))return new sn(0,0,0,0);switch(m.type){case"color":return sn.parse(m.default)||null;case"padding":return Bt.parse(m.default)||null;case"numberArray":return Vn.parse(m.default)||null;case"colorArray":return bt.parse(m.default)||null;case"variableAnchorOffsetCollection":return vr.parse(m.default)||null;case"projectionDefinition":return qi.parse(m.default)||null;default:return m.default===void 0?null:m.default}})(l):null,this._enumValues=l&&l.type==="enum"?l.values:null,this._globalState=h}evaluateWithoutErrorHandling(i,l,h,m,_,y){return this._globalState&&(i=Fe(i,this._globalState)),this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(i,l,h,m,_,y){this._globalState&&(i=Fe(i,this._globalState)),this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y||null;try{let T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new ri(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function yc(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in dc}function d(c,i,l){let h=new yn(dc,bh,[],i?(function(_){let y={color:so,string:en,number:ht,enum:en,boolean:tn,formatted:Yl,padding:uh,numberArray:Jc,colorArray:Qs,projectionDefinition:ch,resolvedImage:Kl,variableAnchorOffsetCollection:Qc};return _.type==="array"?Hr(y[_.value]||on,_.length):y[_.type]})(i):void 0),m=h.parse(c,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?pc(new Th(m,i,l)):mc(h.errors)}class b{constructor(i,l,h){this.kind=i,this._styleExpression=l,this.isStateDependent=i!=="constant"&&!fc(l.expression),this.globalStateRefs=we(l.expression),this._globalState=h}evaluateWithoutErrorHandling(i,l,h,m,_,y){return this._globalState&&(i=Fe(i,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(i,l,h,m,_,y)}evaluate(i,l,h,m,_,y){return this._globalState&&(i=Fe(i,this._globalState)),this._styleExpression.evaluate(i,l,h,m,_,y)}}class S{constructor(i,l,h,m,_){this.kind=i,this.zoomStops=h,this._styleExpression=l,this.isStateDependent=i!=="camera"&&!fc(l.expression),this.globalStateRefs=we(l.expression),this.interpolationType=m,this._globalState=_}evaluateWithoutErrorHandling(i,l,h,m,_,y){return this._globalState&&(i=Fe(i,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(i,l,h,m,_,y)}evaluate(i,l,h,m,_,y){return this._globalState&&(i=Fe(i,this._globalState)),this._styleExpression.evaluate(i,l,h,m,_,y)}interpolationFactor(i,l,h){return this.interpolationType?Vi.interpolationFactor(this.interpolationType,i,l,h):0}}function F(c,i,l){let h=d(c,i,l);if(h.result==="error")return h;let m=h.value.expression,_=Xo(m);if(!_&&!ca(i))return mc([new yr("","data expressions not supported")]);let y=du(m,["zoom"]);if(!y&&!gc(i))return mc([new yr("","zoom expressions not supported")]);let T=ie(m);return T||y?T instanceof yr?mc([T]):T instanceof Vi&&!wh(i)?mc([new yr("",'"interpolate" expressions cannot be used with this property')]):pc(T?new S(_?"camera":"composite",h.value,T.labels,T instanceof Vi?T.interpolation:void 0,l):new b(_?"constant":"source",h.value,l)):mc([new yr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ${constructor(i,l){this._parameters=i,this._specification=l,Zn(this,Rd(this._parameters,this._specification))}static deserialize(i){return new $(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function ie(c){let i=null;if(c instanceof li)i=ie(c.result);else if(c instanceof na){for(let l of c.args)if(i=ie(l),i)break}else(c instanceof Ba||c instanceof Vi)&&c.input instanceof Sr&&c.input.name==="zoom"&&(i=c);return i instanceof yr||c.eachChild(l=>{let h=ie(l);h instanceof yr?i=h:!i&&h?i=new yr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&h&&i!==h&&(i=new yr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function we(c,i=new Set){return c instanceof hc&&i.add(c.key),c.eachChild(l=>{we(l,i)}),i}function Fe(c,i){let{zoom:l,heatmapDensity:h,elevation:m,lineProgress:_,isSupportedScript:y,accumulated:T}=c??{};return{zoom:l,heatmapDensity:h,elevation:m,lineProgress:_,isSupportedScript:y,accumulated:T,globalState:i}}function He(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(let i of c.slice(1))if(!He(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}let at={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function It(c,i){if(c==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};He(c)||(c=rr(c));let l=d(c,at,i);if(l.result==="error")throw new Error(l.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,m,_)=>l.value.evaluate(h,m,{},_),needGeometry:wn(c),getGlobalStateRefs:()=>we(l.value.expression)}}function Jt(c,i){return c<i?-1:c>i?1:0}function wn(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let i=1;i<c.length;i++)if(wn(c[i]))return!0;return!1}function rr(c){if(!c)return!0;let i=c[0];return c.length<=1?i!=="any":i==="=="?Xi(c[1],c[2],"=="):i==="!="?Ds(Xi(c[1],c[2],"==")):i==="<"||i===">"||i==="<="||i===">="?Xi(c[1],c[2],i):i==="any"?(l=c.slice(1),["any"].concat(l.map(rr))):i==="all"?["all"].concat(c.slice(1).map(rr)):i==="none"?["all"].concat(c.slice(1).map(rr).map(Ds)):i==="in"?Oo(c[1],c.slice(2)):i==="!in"?Ds(Oo(c[1],c.slice(2))):i==="has"?Xr(c[1]):i!=="!has"||Ds(Xr(c[1]));var l}function Xi(c,i,l){switch(c){case"$type":return[`filter-type-${l}`,i];case"$id":return[`filter-id-${l}`,i];default:return[`filter-${l}`,c,i]}}function Oo(c,i){if(i.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(l=>typeof l!=typeof i[0])?["filter-in-large",c,["literal",i.sort(Jt)]]:["filter-in-small",c,["literal",i]]}}function Xr(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Ds(c){return["!",c]}function Ch(c){let i=typeof c;if(i==="number"||i==="boolean"||i==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let m="[";for(let _ of c)m+=`${Ch(_)},`;return`${m}]`}let l=Object.keys(c).sort(),h="{";for(let m=0;m<l.length;m++)h+=`${JSON.stringify(l[m])}:${Ch(c[l[m]])},`;return`${h}}`}function Pp(c){let i="";for(let l of Ut)i+=`/${Ch(c[l])}`;return i}function Ap(c){let i=c.value;return i?[new De(c.key,i,"constants have been deprecated as of v8")]:[]}function Pi(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function yl(c){if(Array.isArray(c))return c.map(yl);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){let i={};for(let l in c)i[l]=yl(c[l]);return i}return Pi(c)}function uo(c){let i=c.key,l=c.value,h=c.valueSpec||{},m=c.objectElementValidators||{},_=c.style,y=c.styleSpec,T=c.validateSpec,I=[],P=hn(l);if(P!=="object")return[new De(i,l,`object expected, ${P} found`)];for(let O in l){let N=O.split(".")[0],j=ta(h,N)||h["*"],V;if(ta(m,N))V=m[N];else if(ta(h,N)){if(l[O]===void 0)continue;V=T}else if(m["*"])V=m["*"];else{if(!h["*"]){I.push(new De(i,l[O],`unknown property "${O}"`));continue}V=T}I=I.concat(V({key:(i&&`${i}.`)+O,value:l[O],valueSpec:j,style:_,styleSpec:y,object:l,objectKey:O,validateSpec:T},l))}for(let O in h)m[O]||h[O].required&&h[O].default===void 0&&l[O]===void 0&&I.push(new De(i,l,`missing required property "${O}"`));return I}function Ai(c){let i=c.value,l=c.valueSpec,h=c.style,m=c.styleSpec,_=c.key,y=c.arrayElementValidator||c.validateSpec;if(hn(i)!=="array")return[new De(_,i,`array expected, ${hn(i)} found`)];if(l.length&&i.length!==l.length)return[new De(_,i,`array length ${l.length} expected, length ${i.length} found`)];let T={type:l.value,values:l.values};m.$version<7&&(T.function=l.function),hn(l.value)==="object"&&(T=l.value);let I=[];for(let P=0;P<i.length;P++)I=I.concat(y({array:i,arrayIndex:P,value:i[P],valueSpec:T,validateSpec:c.validateSpec,style:h,styleSpec:m,key:`${_}[${P}]`}));return I}function Ga(c){let i=c.key,l=c.value,h=c.valueSpec,m=hn(l);return m==="number"&&l!=l&&(m="NaN"),m!=="number"?[new De(i,l,`number expected, ${m} found`)]:"minimum"in h&&l<h.minimum?[new De(i,l,`${l} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&l>h.maximum?[new De(i,l,`${l} is greater than the maximum value ${h.maximum}`)]:[]}function Ih(c){let i=c.valueSpec,l=Pi(c.value.type),h,m,_,y={},T=l!=="categorical"&&c.value.property===void 0,I=!T,P=hn(c.value.stops)==="array"&&hn(c.value.stops[0])==="array"&&hn(c.value.stops[0][0])==="object",O=uo({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(V){if(l==="identity")return[new De(V.key,V.value,'identity function may not have a "stops" property')];let Z=[],X=V.value;return Z=Z.concat(Ai({key:V.key,value:X,valueSpec:V.valueSpec,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:N})),hn(X)==="array"&&X.length===0&&Z.push(new De(V.key,X,"array must have at least one stop")),Z},default:function(V){return V.validateSpec({key:V.key,value:V.value,valueSpec:i,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec})}}});return l==="identity"&&T&&O.push(new De(c.key,c.value,'missing required property "property"')),l==="identity"||c.value.stops||O.push(new De(c.key,c.value,'missing required property "stops"')),l==="exponential"&&c.valueSpec.expression&&!wh(c.valueSpec)&&O.push(new De(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(I&&!ca(c.valueSpec)?O.push(new De(c.key,c.value,"property functions not supported")):T&&!gc(c.valueSpec)&&O.push(new De(c.key,c.value,"zoom functions not supported"))),l!=="categorical"&&!P||c.value.property!==void 0||O.push(new De(c.key,c.value,'"property" property is required')),O;function N(V){let Z=[],X=V.value,K=V.key;if(hn(X)!=="array")return[new De(K,X,`array expected, ${hn(X)} found`)];if(X.length!==2)return[new De(K,X,`array length 2 expected, length ${X.length} found`)];if(P){if(hn(X[0])!=="object")return[new De(K,X,`object expected, ${hn(X[0])} found`)];if(X[0].zoom===void 0)return[new De(K,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new De(K,X,"object stop key must have value")];if(_&&_>Pi(X[0].zoom))return[new De(K,X[0].zoom,"stop zoom values must appear in ascending order")];Pi(X[0].zoom)!==_&&(_=Pi(X[0].zoom),m=void 0,y={}),Z=Z.concat(uo({key:`${K}[0]`,value:X[0],valueSpec:{zoom:{}},validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Ga,value:j}}))}else Z=Z.concat(j({key:`${K}[0]`,value:X[0],validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec},X));return yc(yl(X[1]))?Z.concat([new De(`${K}[1]`,X[1],"expressions are not allowed in function stops.")]):Z.concat(V.validateSpec({key:`${K}[1]`,value:X[1],valueSpec:i,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec}))}function j(V,Z){let X=hn(V.value),K=Pi(V.value),ne=V.value!==null?V.value:Z;if(h){if(X!==h)return[new De(V.key,ne,`${X} stop domain type must match previous stop domain type ${h}`)]}else h=X;if(X!=="number"&&X!=="string"&&X!=="boolean")return[new De(V.key,ne,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&l!=="categorical"){let he=`number expected, ${X} found`;return ca(i)&&l===void 0&&(he+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new De(V.key,ne,he)]}return l!=="categorical"||X!=="number"||isFinite(K)&&Math.floor(K)===K?l!=="categorical"&&X==="number"&&m!==void 0&&K<m?[new De(V.key,ne,"stop domain values must appear in ascending order")]:(m=K,l==="categorical"&&K in y?[new De(V.key,ne,"stop domain values must be unique")]:(y[K]=!0,[])):[new De(V.key,ne,`integer expected, found ${K}`)]}}function $a(c){let i=(c.expressionContext==="property"?F:d)(yl(c.value),c.valueSpec);if(i.result==="error")return i.value.map(h=>new De(`${c.key}${h.key}`,c.value,h.message));let l=i.value.expression||i.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!l.outputDefined())return[new De(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!fc(l))return[new De(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!fc(l))return[new De(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!du(l,["zoom","feature-state"]))return[new De(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!Xo(l))return[new De(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function fu(c){let i=c.key,l=c.value,h=hn(l);return h!=="string"?[new De(i,l,`color expected, ${h} found`)]:sn.parse(String(l))?[]:[new De(i,l,`color expected, "${l}" found`)]}function ua(c){let i=c.key,l=c.value,h=c.valueSpec,m=[];return Array.isArray(h.values)?h.values.indexOf(Pi(l))===-1&&m.push(new De(i,l,`expected one of [${h.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(h.values).indexOf(Pi(l))===-1&&m.push(new De(i,l,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(l)} found`)),m}function vl(c){return He(yl(c.value))?$a(Zn({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Rp(c)}function Rp(c){let i=c.value,l=c.key;if(hn(i)!=="array")return[new De(l,i,`array expected, ${hn(i)} found`)];let h=c.styleSpec,m,_=[];if(i.length<1)return[new De(l,i,"filter array must have at least 1 element")];switch(_=_.concat(ua({key:`${l}[0]`,value:i[0],valueSpec:h.filter_operator,style:c.style,styleSpec:c.styleSpec})),Pi(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&Pi(i[1])==="$type"&&_.push(new De(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&_.push(new De(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(m=hn(i[1]),m!=="string"&&_.push(new De(`${l}[1]`,i[1],`string expected, ${m} found`)));for(let y=2;y<i.length;y++)m=hn(i[y]),Pi(i[1])==="$type"?_=_.concat(ua({key:`${l}[${y}]`,value:i[y],valueSpec:h.geometry_type,style:c.style,styleSpec:c.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&_.push(new De(`${l}[${y}]`,i[y],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let y=1;y<i.length;y++)_=_.concat(Rp({key:`${l}[${y}]`,value:i[y],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":m=hn(i[1]),i.length!==2?_.push(new De(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):m!=="string"&&_.push(new De(`${l}[1]`,i[1],`string expected, ${m} found`))}return _}function t0(c,i){let l=c.key,h=c.validateSpec,m=c.style,_=c.styleSpec,y=c.value,T=c.objectKey,I=_[`${i}_${c.layerType}`];if(!I)return[];let P=T.match(/^(.*)-transition$/);if(i==="paint"&&P&&I[P[1]]&&I[P[1]].transition)return h({key:l,value:y,valueSpec:_.transition,style:m,styleSpec:_});let O=c.valueSpec||I[T];if(!O)return[new De(l,y,`unknown property "${T}"`)];let N;if(hn(y)==="string"&&ca(O)&&!O.tokens&&(N=/^{([^}]+)}$/.exec(y)))return[new De(l,y,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(N[1])} }\`.`)];let j=[];return c.layerType==="symbol"&&T==="text-font"&&Eh(yl(y))&&Pi(y.type)==="identity"&&j.push(new De(l,y,'"text-font" does not support identity functions')),j.concat(h({key:c.key,value:y,valueSpec:O,style:m,styleSpec:_,expressionContext:"property",propertyType:i,propertyKey:T}))}function n0(c){return t0(c,"paint")}function i0(c){return t0(c,"layout")}function r0(c){let i=[],l=c.value,h=c.key,m=c.style,_=c.styleSpec;if(hn(l)!=="object")return[new De(h,l,`object expected, ${hn(l)} found`)];l.type||l.ref||i.push(new De(h,l,'either "type" or "ref" is required'));let y=Pi(l.type),T=Pi(l.ref);if(l.id){let I=Pi(l.id);for(let P=0;P<c.arrayIndex;P++){let O=m.layers[P];Pi(O.id)===I&&i.push(new De(h,l.id,`duplicate layer id "${l.id}", previously used at line ${O.id.__line__}`))}}if("ref"in l){let I;["type","source","source-layer","filter","layout"].forEach(P=>{P in l&&i.push(new De(h,l[P],`"${P}" is prohibited for ref layers`))}),m.layers.forEach(P=>{Pi(P.id)===T&&(I=P)}),I?I.ref?i.push(new De(h,l.ref,"ref cannot reference another ref layer")):y=Pi(I.type):i.push(new De(h,l.ref,`ref layer "${T}" not found`))}else if(y!=="background")if(l.source){let I=m.sources&&m.sources[l.source],P=I&&Pi(I.type);I?P==="vector"&&y==="raster"?i.push(new De(h,l.source,`layer "${l.id}" requires a raster source`)):P!=="raster-dem"&&y==="hillshade"||P!=="raster-dem"&&y==="color-relief"?i.push(new De(h,l.source,`layer "${l.id}" requires a raster-dem source`)):P==="raster"&&y!=="raster"?i.push(new De(h,l.source,`layer "${l.id}" requires a vector source`)):P!=="vector"||l["source-layer"]?P==="raster-dem"&&y!=="hillshade"&&y!=="color-relief"?i.push(new De(h,l.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):y!=="line"||!l.paint||!l.paint["line-gradient"]||P==="geojson"&&I.lineMetrics||i.push(new De(h,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new De(h,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new De(h,l.source,`source "${l.source}" not found`))}else i.push(new De(h,l,'missing required property "source"'));return i=i.concat(uo({key:h,value:l,valueSpec:_.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${h}.type`,value:l.type,valueSpec:_.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:l,objectKey:"type"}),filter:vl,layout:I=>uo({layer:l,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":P=>i0(Zn({layerType:y},P))}}),paint:I=>uo({layer:l,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":P=>n0(Zn({layerType:y},P))}})}})),i}function vc(c){let i=c.value,l=c.key,h=hn(i);return h!=="string"?[new De(l,i,`string expected, ${h} found`)]:[]}let r_={promoteId:function({key:c,value:i}){if(hn(i)==="string")return vc({key:c,value:i});{let l=[];for(let h in i)l.push(...vc({key:`${c}.${h}`,value:i[h]}));return l}}};function o_(c){let i=c.value,l=c.key,h=c.styleSpec,m=c.style,_=c.validateSpec;if(!i.type)return[new De(l,i,'"type" is required')];let y=Pi(i.type),T;switch(y){case"vector":case"raster":return T=uo({key:l,value:i,valueSpec:h[`source_${y.replace("-","_")}`],style:c.style,styleSpec:h,objectElementValidators:r_,validateSpec:_}),T;case"raster-dem":return T=(function(I){var P;let O=(P=I.sourceName)!==null&&P!==void 0?P:"",N=I.value,j=I.styleSpec,V=j.source_raster_dem,Z=I.style,X=[],K=hn(N);if(N===void 0)return X;if(K!=="object")return X.push(new De("source_raster_dem",N,`object expected, ${K} found`)),X;let ne=Pi(N.encoding)==="custom",he=["redFactor","greenFactor","blueFactor","baseShift"],re=I.value.encoding?`"${I.value.encoding}"`:"Default";for(let oe in N)!ne&&he.includes(oe)?X.push(new De(oe,N[oe],`In "${O}": "${oe}" is only valid when "encoding" is set to "custom". ${re} encoding found`)):V[oe]?X=X.concat(I.validateSpec({key:oe,value:N[oe],valueSpec:V[oe],validateSpec:I.validateSpec,style:Z,styleSpec:j})):X.push(new De(oe,N[oe],`unknown property "${oe}"`));return X})({sourceName:l,value:i,style:c.style,styleSpec:h,validateSpec:_}),T;case"geojson":if(T=uo({key:l,value:i,valueSpec:h.source_geojson,style:m,styleSpec:h,validateSpec:_,objectElementValidators:r_}),i.cluster)for(let I in i.clusterProperties){let[P,O]=i.clusterProperties[I],N=typeof P=="string"?[P,["accumulated"],["get",I]]:P;T.push(...$a({key:`${l}.${I}.map`,value:O,expressionContext:"cluster-map"})),T.push(...$a({key:`${l}.${I}.reduce`,value:N,expressionContext:"cluster-reduce"}))}return T;case"video":return uo({key:l,value:i,valueSpec:h.source_video,style:m,validateSpec:_,styleSpec:h});case"image":return uo({key:l,value:i,valueSpec:h.source_image,style:m,validateSpec:_,styleSpec:h});case"canvas":return[new De(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ua({key:`${l}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Ld(c){let i=c.value,l=c.styleSpec,h=l.light,m=c.style,_=[],y=hn(i);if(i===void 0)return _;if(y!=="object")return _=_.concat([new De("light",i,`object expected, ${y} found`)]),_;for(let T in i){let I=T.match(/^(.*)-transition$/);_=_.concat(I&&h[I[1]]&&h[I[1]].transition?c.validateSpec({key:T,value:i[T],valueSpec:l.transition,validateSpec:c.validateSpec,style:m,styleSpec:l}):h[T]?c.validateSpec({key:T,value:i[T],valueSpec:h[T],validateSpec:c.validateSpec,style:m,styleSpec:l}):[new De(T,i[T],`unknown property "${T}"`)])}return _}function o0(c){let i=c.value,l=c.styleSpec,h=l.sky,m=c.style,_=hn(i);if(i===void 0)return[];if(_!=="object")return[new De("sky",i,`object expected, ${_} found`)];let y=[];for(let T in i)y=y.concat(h[T]?c.validateSpec({key:T,value:i[T],valueSpec:h[T],style:m,styleSpec:l}):[new De(T,i[T],`unknown property "${T}"`)]);return y}function s_(c){let i=c.value,l=c.styleSpec,h=l.terrain,m=c.style,_=[],y=hn(i);if(i===void 0)return _;if(y!=="object")return _=_.concat([new De("terrain",i,`object expected, ${y} found`)]),_;for(let T in i)_=_.concat(h[T]?c.validateSpec({key:T,value:i[T],valueSpec:h[T],validateSpec:c.validateSpec,style:m,styleSpec:l}):[new De(T,i[T],`unknown property "${T}"`)]);return _}function a_(c){let i=[],l=c.value,h=c.key;if(Array.isArray(l)){let m=[],_=[];for(let y in l)l[y].id&&m.includes(l[y].id)&&i.push(new De(h,l,`all the sprites' ids must be unique, but ${l[y].id} is duplicated`)),m.push(l[y].id),l[y].url&&_.includes(l[y].url)&&i.push(new De(h,l,`all the sprites' URLs must be unique, but ${l[y].url} is duplicated`)),_.push(l[y].url),i=i.concat(uo({key:`${h}[${y}]`,value:l[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return i}return vc({key:h,value:l})}function s0(c){return!!c&&c.constructor===Object}function l_(c){return s0(c.value)?[]:[new De(c.key,c.value,`object expected, ${hn(c.value)} found`)]}let c_={"*":()=>[],array:Ai,boolean:function(c){let i=c.value,l=c.key,h=hn(i);return h!=="boolean"?[new De(l,i,`boolean expected, ${h} found`)]:[]},number:Ga,color:fu,constants:Ap,enum:ua,filter:vl,function:Ih,layer:r0,object:uo,source:o_,light:Ld,sky:o0,terrain:s_,projection:function(c){let i=c.value,l=c.styleSpec,h=l.projection,m=c.style,_=hn(i);if(i===void 0)return[];if(_!=="object")return[new De("projection",i,`object expected, ${_} found`)];let y=[];for(let T in i)y=y.concat(h[T]?c.validateSpec({key:T,value:i[T],valueSpec:h[T],style:m,styleSpec:l}):[new De(T,i[T],`unknown property "${T}"`)]);return y},projectionDefinition:function(c){let i=c.key,l=c.value;l=l instanceof String?l.valueOf():l;let h=hn(l);return h!=="array"||(function(m){return Array.isArray(m)&&m.length===3&&typeof m[0]=="string"&&typeof m[1]=="string"&&typeof m[2]=="number"})(l)||(function(m){return!!["interpolate","step","literal"].includes(m[0])})(l)?["array","string"].includes(h)?[]:[new De(i,l,`projection expected, invalid type "${h}" found`)]:[new De(i,l,`projection expected, invalid array ${JSON.stringify(l)} found`)]},string:vc,formatted:function(c){return vc(c).length===0?[]:$a(c)},resolvedImage:function(c){return vc(c).length===0?[]:$a(c)},padding:function(c){let i=c.key,l=c.value;if(hn(l)==="array"){if(l.length<1||l.length>4)return[new De(i,l,`padding requires 1 to 4 values; ${l.length} values found`)];let h={type:"number"},m=[];for(let _=0;_<l.length;_++)m=m.concat(c.validateSpec({key:`${i}[${_}]`,value:l[_],validateSpec:c.validateSpec,valueSpec:h}));return m}return Ga({key:i,value:l,valueSpec:{}})},numberArray:function(c){let i=c.key,l=c.value;if(hn(l)==="array"){let h={type:"number"};if(l.length<1)return[new De(i,l,"array length at least 1 expected, length 0 found")];let m=[];for(let _=0;_<l.length;_++)m=m.concat(c.validateSpec({key:`${i}[${_}]`,value:l[_],validateSpec:c.validateSpec,valueSpec:h}));return m}return Ga({key:i,value:l,valueSpec:{}})},colorArray:function(c){let i=c.key,l=c.value;if(hn(l)==="array"){if(l.length<1)return[new De(i,l,"array length at least 1 expected, length 0 found")];let h=[];for(let m=0;m<l.length;m++)h=h.concat(fu({key:`${i}[${m}]`,value:l[m]}));return h}return fu({key:i,value:l})},variableAnchorOffsetCollection:function(c){let i=c.key,l=c.value,h=hn(l),m=c.styleSpec;if(h!=="array"||l.length<1||l.length%2!=0)return[new De(i,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let y=0;y<l.length;y+=2)_=_.concat(ua({key:`${i}[${y}]`,value:l[y],valueSpec:m.layout_symbol["text-anchor"]})),_=_.concat(Ai({key:`${i}[${y+1}]`,value:l[y+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:m}));return _},sprite:a_,state:l_,fontFaces:function(c){let i=c.key,l=c.value,h=c.validateSpec,m=c.styleSpec,_=c.style;if(!s0(l))return[new De(i,l,`object expected, ${hn(l)} found`)];let y=[];for(let T in l){let I=l[T],P=hn(I);if(P==="string")y.push(...vc({key:`${i}.${T}`,value:I}));else if(P==="array"){let O={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(let[N,j]of I.entries())y.push(...uo({key:`${i}.${T}[${N}]`,value:j,valueSpec:O,styleSpec:m,style:_,validateSpec:h}))}else y.push(new De(`${i}.${T}`,I,`string or array expected, ${P} found`))}return y}};function xc(c){let i=c.value,l=c.valueSpec,h=c.styleSpec;return c.validateSpec=xc,l.expression&&Eh(Pi(i))?Ih(c):l.expression&&yc(yl(i))?$a(c):l.type&&c_[l.type]?c_[l.type](c):uo(Zn({},c,{valueSpec:l.type?h[l.type]:l}))}function a0(c){let i=c.value,l=c.key,h=vc(c);return h.length||(i.indexOf("{fontstack}")===-1&&h.push(new De(l,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&h.push(new De(l,i,'"glyphs" url must include a "{range}" token'))),h}function Ms(c,i=Te){let l=[];return l=l.concat(xc({key:"",value:c,valueSpec:i.$root,styleSpec:i,style:c,validateSpec:xc,objectElementValidators:{glyphs:a0,"*":()=>[]}})),c.constants&&(l=l.concat(Ap({key:"constants",value:c.constants}))),l0(l)}function ha(c){return function(i){return c(Object.assign({},i,{validateSpec:xc}))}}function l0(c){return[].concat(c).sort((i,l)=>i.line-l.line)}function da(c){return function(...i){return l0(c.apply(this,i))}}Ms.source=da(ha(o_)),Ms.sprite=da(ha(a_)),Ms.glyphs=da(ha(a0)),Ms.light=da(ha(Ld)),Ms.sky=da(ha(o0)),Ms.terrain=da(ha(s_)),Ms.state=da(ha(l_)),Ms.layer=da(ha(r0)),Ms.filter=da(ha(vl)),Ms.paintProperty=da(ha(n0)),Ms.layoutProperty=da(ha(i0));let Y1={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class Od{constructor(i,l){this._globalState=l,this.setValue(i)}evaluate(){var i;return(i=this._literalValue)!==null&&i!==void 0?i:this._compiledValue.evaluate({})}setValue(i){if(i==null||i==="visible"||i==="none")return this._literalValue=i==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);let l=d(i,Y1,this._globalState);if(l.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(l.value.map(h=>`${h.key}: ${h.message}`).join(", "));this._literalValue=void 0,this._compiledValue=l.value,this._globalStateRefs=we(l.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}let kd=Te,Dr=Ms,Fd=Dr.light,c0=Dr.sky,K1=Dr.paintProperty,J1=Dr.layoutProperty;function Sh(c,i){let l=!1;if(i&&i.length)for(let h of i)c.fire(new Ge(new Error(h.message))),l=!0;return l}class Dh{constructor(i,l,h){let m=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;let y=new Int32Array(this.arrayBuffer);i=y[0],this.d=(l=y[1])+2*(h=y[2]);for(let I=0;I<this.d*this.d;I++){let P=y[3+I],O=y[3+I+1];m.push(P===O?null:y.subarray(P,O))}let T=y[3+m.length+1];this.keys=y.subarray(y[3+m.length],T),this.bboxes=y.subarray(T),this.insert=this._insertReadonly}else{this.d=l+2*h;for(let y=0;y<this.d*this.d;y++)m.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=i,this.padding=h,this.scale=l/i,this.uid=0;let _=h/l*i;this.min=-_,this.max=i+_}insert(i,l,h,m,_){this._forEachCell(l,h,m,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,l,h,m,_,y){this.cells[_].push(y)}query(i,l,h,m,_){let y=this.min,T=this.max;if(i<=y&&l<=y&&T<=h&&T<=m&&!_)return Array.prototype.slice.call(this.keys);{let I=[];return this._forEachCell(i,l,h,m,this._queryCell,I,{},_),I}}_queryCell(i,l,h,m,_,y,T,I){let P=this.cells[_];if(P!==null){let O=this.keys,N=this.bboxes;for(let j=0;j<P.length;j++){let V=P[j];if(T[V]===void 0){let Z=4*V;(I?I(N[Z+0],N[Z+1],N[Z+2],N[Z+3]):i<=N[Z+2]&&l<=N[Z+3]&&h>=N[Z+0]&&m>=N[Z+1])?(T[V]=!0,y.push(O[V])):T[V]=!1}}}}_forEachCell(i,l,h,m,_,y,T,I){let P=this._convertToCellCoord(i),O=this._convertToCellCoord(l),N=this._convertToCellCoord(h),j=this._convertToCellCoord(m);for(let V=P;V<=N;V++)for(let Z=O;Z<=j;Z++){let X=this.d*Z+V;if((!I||I(this._convertFromCellCoord(V),this._convertFromCellCoord(Z),this._convertFromCellCoord(V+1),this._convertFromCellCoord(Z+1)))&&_.call(this,i,l,h,m,X,y,T,I))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let i=this.cells,l=3+this.cells.length+1+1,h=0;for(let y=0;y<this.cells.length;y++)h+=this.cells[y].length;let m=new Int32Array(l+h+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;let _=l;for(let y=0;y<i.length;y++){let T=i[y];m[3+y]=_,m.set(T,_),_+=T.length}return m[3+i.length]=_,m.set(this.keys,_),_+=this.keys.length,m[3+i.length+1]=_,m.set(this.bboxes,_),_+=this.bboxes.length,m.buffer}static serialize(i,l){let h=i.toArrayBuffer();return l&&l.push(h),{buffer:h}}static deserialize(i){return new Dh(i.buffer)}}let fa={};function wt(c,i,l={}){if(fa[c])throw new Error(`${c} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:c,writeable:!1}),fa[c]={klass:i,omit:l.omit||[],shallow:l.shallow||[]}}wt("Object",Object),wt("Set",Set),wt("TransferableGridIndex",Dh),wt("Color",sn),wt("Error",Error),wt("AJAXError",ge),wt("ResolvedImage",Wr),wt("StylePropertyFunction",$),wt("StyleExpression",Th,{omit:["_evaluator"]}),wt("ZoomDependentExpression",S),wt("ZoomConstantExpression",b),wt("CompoundExpression",Sr,{omit:["_evaluate"]});for(let c in dc)dc[c]._classRegistryKey||wt(`Expression_${c}`,dc[c]);function Lp(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function u_(c){return c.$name||c.constructor._classRegistryKey}function Mh(c){return!(function(i){if(i===null||typeof i!="object")return!1;let l=u_(i);return!(!l||l==="Object")})(c)&&(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||Lp(c)||Di(c)||ArrayBuffer.isView(c)||c instanceof ImageData)}function Nd(c,i){if(Mh(c))return(Lp(c)||Di(c))&&i&&i.push(c),ArrayBuffer.isView(c)&&i&&i.push(c.buffer),c instanceof ImageData&&i&&i.push(c.data.buffer),c;if(Array.isArray(c)){let _=[];for(let y of c)_.push(Nd(y,i));return _}if(typeof c!="object")throw new Error("can't serialize object of type "+typeof c);let l=u_(c);if(!l)throw new Error(`can't serialize object of unregistered class ${c.constructor.name}`);if(!fa[l])throw new Error(`${l} is not registered.`);let{klass:h}=fa[l],m=h.serialize?h.serialize(c,i):{};if(h.serialize){if(i&&m===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let _ in c){if(!c.hasOwnProperty(_)||fa[l].omit.indexOf(_)>=0)continue;let y=c[_];m[_]=fa[l].shallow.indexOf(_)>=0?y:Nd(y,i)}c instanceof Error&&(m.message=c.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(m.$name=l),m}function zd(c){if(Mh(c))return c;if(Array.isArray(c))return c.map(zd);if(typeof c!="object")throw new Error("can't deserialize object of type "+typeof c);let i=u_(c)||"Object";if(!fa[i])throw new Error(`can't deserialize unregistered class ${i}`);let{klass:l}=fa[i];if(!l)throw new Error(`can't deserialize unregistered class ${i}`);if(l.deserialize)return l.deserialize(c);let h=Object.create(l.prototype);for(let m of Object.keys(c)){if(m==="$name")continue;let _=c[m];h[m]=fa[i].shallow.indexOf(m)>=0?_:zd(_)}return h}class h_{constructor(){this.first=!0}update(i,l){let h=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=l),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=h,!0))}}function Bd(c){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(c))}function d_(c){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(c))}function u0(c){return/\s/u.test(String.fromCodePoint(c))}function Ph(c){for(let i of c)if(d_(i.codePointAt(0)))return!0;return!1}function Q1(c){for(let i of c)if(!h0(i.codePointAt(0)))return!1;return!0}function Op(c){let i=c.map(l=>{try{return new RegExp(`\\p{sc=${l}}`,"u").source}catch{return null}}).filter(l=>l);return new RegExp(i.join("|"),"u")}let kp=Op(["Arab","Dupl","Mong","Ougr","Syrc"]);function h0(c){return!kp.test(String.fromCodePoint(c))}function f_(c){return!(d_(c)||(i=c,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(i))));var i}let d0=Op(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function p_(c){return d0.test(String.fromCodePoint(c))}function m_(c,i){return!(!i&&p_(c)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(c)))}function f0(c){for(let i of c)if(p_(i.codePointAt(0)))return!0;return!1}let bc=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){if(bc.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(c,i){return s(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(c.pluginStatus!=="loading")return this.setState(c),c;let l=c.pluginURL,h=new Promise(_=>{this.loadScriptResolve=_});i(l);let m=new Promise(_=>setTimeout(()=>_(),this.TIMEOUT));if(yield Promise.race([h,m]),this.isParsed()){let _={pluginStatus:"loaded",pluginURL:l};return this.setState(_),_}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${l}`)})}};class ui{constructor(i,l){this.isSupportedScript=eE,this.zoom=i,l?(this.now=l.now||0,this.fadeDuration=l.fadeDuration||0,this.zoomHistory=l.zoomHistory||new h_,this.transition=l.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new h_,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let i=this.zoom,l=i-Math.floor(i),h=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*l}}}function eE(c){return(function(i,l){for(let h of i)if(!m_(h.codePointAt(0),l))return!1;return!0})(c,bc.getRTLTextPluginStatus()==="loaded")}let jd="-transition";class Fp{constructor(i,l,h){this.property=i,this.value=l,this.expression=(function(m,_,y){if(Eh(m))return new $(m,_);if(yc(m)){let T=F(m,_,y);if(T.result==="error")throw new Error(T.value.map(I=>`${I.key}: ${I.message}`).join(", "));return T.value}{let T=m;return _.type==="color"&&typeof m=="string"?T=sn.parse(m):_.type!=="padding"||typeof m!="number"&&!Array.isArray(m)?_.type!=="numberArray"||typeof m!="number"&&!Array.isArray(m)?_.type!=="colorArray"||typeof m!="string"&&!Array.isArray(m)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(m)?T=vr.parse(m):_.type==="projectionDefinition"&&typeof m=="string"&&(T=qi.parse(m)):T=bt.parse(m):T=Vn.parse(m):T=Bt.parse(m),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>T}}})(l===void 0?i.specification.default:l,i.specification,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(i,l,h){return this.property.possiblyEvaluate(this,i,l,h)}}class Np{constructor(i,l){this.property=i,this.value=new Fp(i,void 0,l)}transitioned(i,l){return new p0(this.property,this.value,l,kn({},i.transition,this.transition),i.now)}untransitioned(){return new p0(this.property,this.value,null,{},0)}}class g_{constructor(i,l){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues),this._globalState=l}getValue(i){return ti(this._values[i].value.value)}setValue(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Np(this._values[i].property,this._globalState)),this._values[i].value=new Fp(this._values[i].property,l===null?void 0:ti(l),this._globalState)}getTransition(i){return ti(this._values[i].transition)}setTransition(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Np(this._values[i].property,this._globalState)),this._values[i].transition=ti(l)||void 0}serialize(){let i={};for(let l of Object.keys(this._values)){let h=this.getValue(l);h!==void 0&&(i[l]=h);let m=this.getTransition(l);m!==void 0&&(i[`${l}${jd}`]=m)}return i}transitioned(i,l){let h=new m0(this._properties);for(let m of Object.keys(this._values))h._values[m]=this._values[m].transitioned(i,l._values[m]);return h}untransitioned(){let i=new m0(this._properties);for(let l of Object.keys(this._values))i._values[l]=this._values[l].untransitioned();return i}}class p0{constructor(i,l,h,m,_){this.property=i,this.value=l,this.begin=_+m.delay||0,this.end=this.begin+m.duration||0,i.specification.transition&&(m.delay||m.duration)&&(this.prior=h)}possiblyEvaluate(i,l,h){let m=i.now||0,_=this.value.possiblyEvaluate(i,l,h),y=this.prior;if(y){if(m>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(m<this.begin)return y.possiblyEvaluate(i,l,h);{let T=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(i,l,h),_,Qt(T))}}return _}}class m0{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,l,h){let m=new Vd(this._properties);for(let _ of Object.keys(this._values))m._values[_]=this._values[_].possiblyEvaluate(i,l,h);return m}hasTransition(){for(let i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class g0{constructor(i,l){this._properties=i,this._values=Object.create(i.defaultPropertyValues),this._globalState=l}hasValue(i){return this._values[i].value!==void 0}getValue(i){return ti(this._values[i].value)}setValue(i,l){this._values[i]=new Fp(this._values[i].property,l===null?void 0:ti(l),this._globalState)}serialize(){let i={};for(let l of Object.keys(this._values)){let h=this.getValue(l);h!==void 0&&(i[l]=h)}return i}possiblyEvaluate(i,l,h){let m=new Vd(this._properties);for(let _ of Object.keys(this._values))m._values[_]=this._values[_].possiblyEvaluate(i,l,h);return m}}class pa{constructor(i,l,h){this.property=i,this.value=l,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,l,h,m){return this.property.evaluate(this.value,this.parameters,i,l,h,m)}}class Vd{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Lt{constructor(i){this.specification=i}possiblyEvaluate(i,l){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(l)}interpolate(i,l,h){let m=mi[this.specification.type];return m?m(i,l,h):i}}class zt{constructor(i,l){this.specification=i,this.overrides=l}possiblyEvaluate(i,l,h,m){return new pa(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(l,null,{},h,m)}:i.expression,l)}interpolate(i,l,h){if(i.value.kind!=="constant"||l.value.kind!=="constant")return i;if(i.value.value===void 0||l.value.value===void 0)return new pa(this,{kind:"constant",value:void 0},i.parameters);let m=mi[this.specification.type];if(m){let _=m(i.value.value,l.value.value,h);return new pa(this,{kind:"constant",value:_},i.parameters)}return i}evaluate(i,l,h,m,_,y){return i.kind==="constant"?i.value:i.evaluate(l,h,m,_,y)}}class Ud extends zt{possiblyEvaluate(i,l,h,m){if(i.value===void 0)return new pa(this,{kind:"constant",value:void 0},l);if(i.expression.kind==="constant"){let _=i.expression.evaluate(l,null,{},h,m),y=i.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,T=this._calculate(y,y,y,l);return new pa(this,{kind:"constant",value:T},l)}if(i.expression.kind==="camera"){let _=this._calculate(i.expression.evaluate({zoom:l.zoom-1}),i.expression.evaluate({zoom:l.zoom}),i.expression.evaluate({zoom:l.zoom+1}),l);return new pa(this,{kind:"constant",value:_},l)}return new pa(this,i.expression,l)}evaluate(i,l,h,m,_,y){if(i.kind==="source"){let T=i.evaluate(l,h,m,_,y);return this._calculate(T,T,T,l)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(l.zoom)-1},h,m),i.evaluate({zoom:Math.floor(l.zoom)},h,m),i.evaluate({zoom:Math.floor(l.zoom)+1},h,m),l):i.value}_calculate(i,l,h,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:h,to:l}}interpolate(i){return i}}class zp{constructor(i){this.specification=i}possiblyEvaluate(i,l,h,m){if(i.value!==void 0){if(i.expression.kind==="constant"){let _=i.expression.evaluate(l,null,{},h,m);return this._calculate(_,_,_,l)}return this._calculate(i.expression.evaluate(new ui(Math.floor(l.zoom-1),l)),i.expression.evaluate(new ui(Math.floor(l.zoom),l)),i.expression.evaluate(new ui(Math.floor(l.zoom+1),l)),l)}}_calculate(i,l,h,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:h,to:l}}interpolate(i){return i}}class Bp{constructor(i){this.specification=i}possiblyEvaluate(i,l,h,m){return!!i.expression.evaluate(l,null,{},h,m)}interpolate(){return!1}}class ko{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let l in i){let h=i[l];h.specification.overridable&&this.overridableProperties.push(l);let m=this.defaultPropertyValues[l]=new Fp(h,void 0,void 0),_=this.defaultTransitionablePropertyValues[l]=new Np(h,void 0);this.defaultTransitioningPropertyValues[l]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=m.possiblyEvaluate({})}}}wt("DataDrivenProperty",zt),wt("DataConstantProperty",Lt),wt("CrossFadedDataDrivenProperty",Ud),wt("CrossFadedProperty",zp),wt("ColorRampProperty",Bp);class Ps extends Ke{constructor(i,l,h){if(super(),this.id=i.id,this.type=i.type,this._globalState=h,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},this._visibilityExpression=(function(m,_){return new Od(m,_)})(this.visibility,h),i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter,this._featureFilter=It(i.filter,h)),l.layout&&(this._unevaluatedLayout=new g0(l.layout,h)),l.paint)){this._transitionablePaint=new g_(l.paint,h);for(let m in i.paint)this.setPaintProperty(m,i.paint[m],{validate:!1});for(let m in i.layout)this.setLayoutProperty(m,i.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Vd(l.paint)}}setFilter(i){this.filter=i,this._featureFilter=It(i,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}getLayoutAffectingGlobalStateRefs(){let i=new Set;for(let l of this._visibilityExpression.getGlobalStateRefs())i.add(l);if(this._unevaluatedLayout)for(let l in this._unevaluatedLayout._values){let h=this._unevaluatedLayout._values[l];for(let m of h.getGlobalStateRefs())i.add(m)}for(let l of this._featureFilter.getGlobalStateRefs())i.add(l);return i}getPaintAffectingGlobalStateRefs(){var i;let l=new globalThis.Map;if(this._transitionablePaint)for(let h in this._transitionablePaint._values){let m=this._transitionablePaint._values[h].value;for(let _ of m.getGlobalStateRefs()){let y=(i=l.get(_))!==null&&i!==void 0?i:[];y.push({name:h,value:m.value}),l.set(_,y)}}return l}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(i,l,h={}){if(l==null||!this._validate(J1,`layers.${this.id}.layout.${i}`,i,l,h))return i==="visibility"?(this.visibility=l,this._visibilityExpression.setValue(l),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(i,l)}getPaintProperty(i){return i.endsWith(jd)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,l,h={}){if(l!=null&&this._validate(K1,`layers.${this.id}.paint.${i}`,i,l,h))return!1;if(i.endsWith(jd))return this._transitionablePaint.setTransition(i.slice(0,-11),l||void 0),!1;{let m=this._transitionablePaint._values[i],_=m.property.specification["property-type"]==="cross-faded-data-driven",y=m.value.isDataDriven(),T=m.value;this._transitionablePaint.setValue(i,l),this._handleSpecialPaintPropertyUpdate(i);let I=this._transitionablePaint._values[i].value;return I.isDataDriven()||y||_||this._handleOverridablePaintPropertyUpdate(i,T,I)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,l,h){return!1}isHidden(i=this.minzoom,l=!1){return!!(this.minzoom&&i<(l?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&i>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(i,l){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,l)}serialize(){let i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Ti(i,(l,h)=>!(l===void 0||h==="layout"&&!Object.keys(l).length||h==="paint"&&!Object.keys(l).length))}_validate(i,l,h,m,_={}){return(!_||_.validate!==!1)&&Sh(this,i.call(Dr,{key:l,layerType:this.type,objectKey:h,value:m,styleSpec:Te,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let i in this.paint._values){let l=this.paint.get(i);if(l instanceof pa&&ca(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}}let __;var _0={get paint(){return __=__||new ko({"raster-opacity":new Lt(Te.paint_raster["raster-opacity"]),"raster-hue-rotate":new Lt(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Lt(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Lt(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new Lt(Te.paint_raster["raster-saturation"]),"raster-contrast":new Lt(Te.paint_raster["raster-contrast"]),"raster-resampling":new Lt(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new Lt(Te.paint_raster["raster-fade-duration"])})}};class tE extends Ps{constructor(i,l){super(i,_0,l)}}let nE={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Gd{constructor(i,l){this._structArray=i,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ui{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,l){return i._trim(),l&&(i.isTransferred=!0,l.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){let l=Object.create(this.prototype);return l.arrayBuffer=i.arrayBuffer,l.length=i.length,l.capacity=i.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function er(c,i=1){let l=0,h=0;return{members:c.map(m=>{let _=nE[m.type].BYTES_PER_ELEMENT,y=l=pu(l,Math.max(i,_)),T=m.components||1;return h=Math.max(h,_),l+=_*T,{name:m.name,type:m.type,components:T,offset:y}}),size:pu(l,Math.max(h,i)),alignment:i}}function pu(c,i){return Math.ceil(c/i)*i}class $d extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l){let h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){let m=2*i;return this.int16[m+0]=l,this.int16[m+1]=h,i}}$d.prototype.bytesPerElement=4,wt("StructArrayLayout2i4",$d);class jp extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h){let m=this.length;return this.resize(m+1),this.emplace(m,i,l,h)}emplace(i,l,h,m){let _=3*i;return this.int16[_+0]=l,this.int16[_+1]=h,this.int16[_+2]=m,i}}jp.prototype.bytesPerElement=6,wt("StructArrayLayout3i6",jp);class y_ extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,m){let _=this.length;return this.resize(_+1),this.emplace(_,i,l,h,m)}emplace(i,l,h,m,_){let y=4*i;return this.int16[y+0]=l,this.int16[y+1]=h,this.int16[y+2]=m,this.int16[y+3]=_,i}}y_.prototype.bytesPerElement=8,wt("StructArrayLayout4i8",y_);class Vp extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,_,y){let T=this.length;return this.resize(T+1),this.emplace(T,i,l,h,m,_,y)}emplace(i,l,h,m,_,y,T){let I=6*i;return this.int16[I+0]=l,this.int16[I+1]=h,this.int16[I+2]=m,this.int16[I+3]=_,this.int16[I+4]=y,this.int16[I+5]=T,i}}Vp.prototype.bytesPerElement=12,wt("StructArrayLayout2i4i12",Vp);class v_ extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,_,y){let T=this.length;return this.resize(T+1),this.emplace(T,i,l,h,m,_,y)}emplace(i,l,h,m,_,y,T){let I=4*i,P=8*i;return this.int16[I+0]=l,this.int16[I+1]=h,this.uint8[P+4]=m,this.uint8[P+5]=_,this.uint8[P+6]=y,this.uint8[P+7]=T,i}}v_.prototype.bytesPerElement=8,wt("StructArrayLayout2i4ub8",v_);class Hd extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l){let h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){let m=2*i;return this.float32[m+0]=l,this.float32[m+1]=h,i}}Hd.prototype.bytesPerElement=8,wt("StructArrayLayout2f8",Hd);class xl extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,_,y,T,I,P,O){let N=this.length;return this.resize(N+1),this.emplace(N,i,l,h,m,_,y,T,I,P,O)}emplace(i,l,h,m,_,y,T,I,P,O,N){let j=10*i;return this.uint16[j+0]=l,this.uint16[j+1]=h,this.uint16[j+2]=m,this.uint16[j+3]=_,this.uint16[j+4]=y,this.uint16[j+5]=T,this.uint16[j+6]=I,this.uint16[j+7]=P,this.uint16[j+8]=O,this.uint16[j+9]=N,i}}xl.prototype.bytesPerElement=20,wt("StructArrayLayout10ui20",xl);class Up extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,_,y,T,I){let P=this.length;return this.resize(P+1),this.emplace(P,i,l,h,m,_,y,T,I)}emplace(i,l,h,m,_,y,T,I,P){let O=8*i;return this.uint16[O+0]=l,this.uint16[O+1]=h,this.uint16[O+2]=m,this.uint16[O+3]=_,this.uint16[O+4]=y,this.uint16[O+5]=T,this.uint16[O+6]=I,this.uint16[O+7]=P,i}}Up.prototype.bytesPerElement=16,wt("StructArrayLayout8ui16",Up);class Zd extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,_,y,T,I,P,O,N,j){let V=this.length;return this.resize(V+1),this.emplace(V,i,l,h,m,_,y,T,I,P,O,N,j)}emplace(i,l,h,m,_,y,T,I,P,O,N,j,V){let Z=12*i;return this.int16[Z+0]=l,this.int16[Z+1]=h,this.int16[Z+2]=m,this.int16[Z+3]=_,this.uint16[Z+4]=y,this.uint16[Z+5]=T,this.uint16[Z+6]=I,this.uint16[Z+7]=P,this.int16[Z+8]=O,this.int16[Z+9]=N,this.int16[Z+10]=j,this.int16[Z+11]=V,i}}Zd.prototype.bytesPerElement=24,wt("StructArrayLayout4i4ui4i24",Zd);class Gp extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h){let m=this.length;return this.resize(m+1),this.emplace(m,i,l,h)}emplace(i,l,h,m){let _=3*i;return this.float32[_+0]=l,this.float32[_+1]=h,this.float32[_+2]=m,i}}Gp.prototype.bytesPerElement=12,wt("StructArrayLayout3f12",Gp);class qd extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){let l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint32[1*i+0]=l,i}}qd.prototype.bytesPerElement=4,wt("StructArrayLayout1ul4",qd);class x_ extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,_,y,T,I,P){let O=this.length;return this.resize(O+1),this.emplace(O,i,l,h,m,_,y,T,I,P)}emplace(i,l,h,m,_,y,T,I,P,O){let N=10*i,j=5*i;return this.int16[N+0]=l,this.int16[N+1]=h,this.int16[N+2]=m,this.int16[N+3]=_,this.int16[N+4]=y,this.int16[N+5]=T,this.uint32[j+3]=I,this.uint16[N+8]=P,this.uint16[N+9]=O,i}}x_.prototype.bytesPerElement=20,wt("StructArrayLayout6i1ul2ui20",x_);class Ah extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,_,y){let T=this.length;return this.resize(T+1),this.emplace(T,i,l,h,m,_,y)}emplace(i,l,h,m,_,y,T){let I=6*i;return this.int16[I+0]=l,this.int16[I+1]=h,this.int16[I+2]=m,this.int16[I+3]=_,this.int16[I+4]=y,this.int16[I+5]=T,i}}Ah.prototype.bytesPerElement=12,wt("StructArrayLayout2i2i2i12",Ah);class mu extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,_){let y=this.length;return this.resize(y+1),this.emplace(y,i,l,h,m,_)}emplace(i,l,h,m,_,y){let T=4*i,I=8*i;return this.float32[T+0]=l,this.float32[T+1]=h,this.float32[T+2]=m,this.int16[I+6]=_,this.int16[I+7]=y,i}}mu.prototype.bytesPerElement=16,wt("StructArrayLayout2f1f2i16",mu);class b_ extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,_,y){let T=this.length;return this.resize(T+1),this.emplace(T,i,l,h,m,_,y)}emplace(i,l,h,m,_,y,T){let I=16*i,P=4*i,O=8*i;return this.uint8[I+0]=l,this.uint8[I+1]=h,this.float32[P+1]=m,this.float32[P+2]=_,this.int16[O+6]=y,this.int16[O+7]=T,i}}b_.prototype.bytesPerElement=16,wt("StructArrayLayout2ub2f2i16",b_);class Wd extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h){let m=this.length;return this.resize(m+1),this.emplace(m,i,l,h)}emplace(i,l,h,m){let _=3*i;return this.uint16[_+0]=l,this.uint16[_+1]=h,this.uint16[_+2]=m,i}}Wd.prototype.bytesPerElement=6,wt("StructArrayLayout3ui6",Wd);class gu extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,m,_,y,T,I,P,O,N,j,V,Z,X,K,ne){let he=this.length;return this.resize(he+1),this.emplace(he,i,l,h,m,_,y,T,I,P,O,N,j,V,Z,X,K,ne)}emplace(i,l,h,m,_,y,T,I,P,O,N,j,V,Z,X,K,ne,he){let re=24*i,oe=12*i,pe=48*i;return this.int16[re+0]=l,this.int16[re+1]=h,this.uint16[re+2]=m,this.uint16[re+3]=_,this.uint32[oe+2]=y,this.uint32[oe+3]=T,this.uint32[oe+4]=I,this.uint16[re+10]=P,this.uint16[re+11]=O,this.uint16[re+12]=N,this.float32[oe+7]=j,this.float32[oe+8]=V,this.uint8[pe+36]=Z,this.uint8[pe+37]=X,this.uint8[pe+38]=K,this.uint32[oe+10]=ne,this.int16[re+22]=he,i}}gu.prototype.bytesPerElement=48,wt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",gu);class w_ extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,m,_,y,T,I,P,O,N,j,V,Z,X,K,ne,he,re,oe,pe,ve,Oe,qe,Ze,We,ut,nt){let $e=this.length;return this.resize($e+1),this.emplace($e,i,l,h,m,_,y,T,I,P,O,N,j,V,Z,X,K,ne,he,re,oe,pe,ve,Oe,qe,Ze,We,ut,nt)}emplace(i,l,h,m,_,y,T,I,P,O,N,j,V,Z,X,K,ne,he,re,oe,pe,ve,Oe,qe,Ze,We,ut,nt,$e){let Ve=32*i,vt=16*i;return this.int16[Ve+0]=l,this.int16[Ve+1]=h,this.int16[Ve+2]=m,this.int16[Ve+3]=_,this.int16[Ve+4]=y,this.int16[Ve+5]=T,this.int16[Ve+6]=I,this.int16[Ve+7]=P,this.uint16[Ve+8]=O,this.uint16[Ve+9]=N,this.uint16[Ve+10]=j,this.uint16[Ve+11]=V,this.uint16[Ve+12]=Z,this.uint16[Ve+13]=X,this.uint16[Ve+14]=K,this.uint16[Ve+15]=ne,this.uint16[Ve+16]=he,this.uint16[Ve+17]=re,this.uint16[Ve+18]=oe,this.uint16[Ve+19]=pe,this.uint16[Ve+20]=ve,this.uint16[Ve+21]=Oe,this.uint16[Ve+22]=qe,this.uint32[vt+12]=Ze,this.float32[vt+13]=We,this.float32[vt+14]=ut,this.uint16[Ve+30]=nt,this.uint16[Ve+31]=$e,i}}w_.prototype.bytesPerElement=64,wt("StructArrayLayout8i15ui1ul2f2ui64",w_);class $p extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){let l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.float32[1*i+0]=l,i}}$p.prototype.bytesPerElement=4,wt("StructArrayLayout1f4",$p);class Hp extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h){let m=this.length;return this.resize(m+1),this.emplace(m,i,l,h)}emplace(i,l,h,m){let _=3*i;return this.uint16[6*i+0]=l,this.float32[_+1]=h,this.float32[_+2]=m,i}}Hp.prototype.bytesPerElement=12,wt("StructArrayLayout1ui2f12",Hp);class E_ extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h){let m=this.length;return this.resize(m+1),this.emplace(m,i,l,h)}emplace(i,l,h,m){let _=4*i;return this.uint32[2*i+0]=l,this.uint16[_+2]=h,this.uint16[_+3]=m,i}}E_.prototype.bytesPerElement=8,wt("StructArrayLayout1ul2ui8",E_);class x extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l){let h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){let m=2*i;return this.uint16[m+0]=l,this.uint16[m+1]=h,i}}x.prototype.bytesPerElement=4,wt("StructArrayLayout2ui4",x);class r extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){let l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint16[1*i+0]=l,i}}r.prototype.bytesPerElement=2,wt("StructArrayLayout1ui2",r);class u extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,m){let _=this.length;return this.resize(_+1),this.emplace(_,i,l,h,m)}emplace(i,l,h,m,_){let y=4*i;return this.float32[y+0]=l,this.float32[y+1]=h,this.float32[y+2]=m,this.float32[y+3]=_,i}}u.prototype.bytesPerElement=16,wt("StructArrayLayout4f16",u);class p extends Gd{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new f(this.anchorPointX,this.anchorPointY)}}p.prototype.size=20;class g extends x_{get(i){return new p(this,i)}}wt("CollisionBoxArray",g);class E extends Gd{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}E.prototype.size=48;class C extends gu{get(i){return new E(this,i)}}wt("PlacedSymbolArray",C);class M extends Gd{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}M.prototype.size=64;class R extends w_{get(i){return new M(this,i)}}wt("SymbolInstanceArray",R);class k extends $p{getoffsetX(i){return this.float32[1*i+0]}}wt("GlyphOffsetArray",k);class B extends jp{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}wt("SymbolLineVertexArray",B);class G extends Gd{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}G.prototype.size=12;class U extends Hp{get(i){return new G(this,i)}}wt("TextAnchorOffsetArray",U);class Y extends Gd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Y.prototype.size=8;class ee extends E_{get(i){return new Y(this,i)}}wt("FeatureIndexArray",ee);class se extends $d{}class le extends $d{}class ae extends $d{}class fe extends Vp{}class xe extends v_{}class de extends Hd{}class ye extends xl{}class Ee extends Up{}class _e extends Zd{}class Ce extends Gp{}class je extends qd{}class Ne extends Ah{}class ze extends b_{}class Be extends Wd{}class lt extends x{}let ct=er([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ye}=ct;class mt{constructor(i=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=i}prepareSegment(i,l,h,m){let _=this.segments[this.segments.length-1];return i>mt.MAX_VERTEX_ARRAY_LENGTH&&zi(`Max vertices per segment is ${mt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${mt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!_||_.vertexLength+i>mt.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==m?this.createNewSegment(l,h,m):_}createNewSegment(i,l,h){let m={vertexOffset:i.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0,vaos:{}};return h!==void 0&&(m.sortKey=h),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(m),m}getOrCreateLatestSegment(i,l,h){return this.prepareSegment(0,i,l,h)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(let i of this.segments)for(let l in i.vaos)i.vaos[l].destroy()}static simpleSegment(i,l,h,m){return new mt([{vertexOffset:i,primitiveOffset:l,vertexLength:h,primitiveLength:m,vaos:{},sortKey:0}])}}function nn(c,i){return 256*(c=Rt(Math.floor(c),0,255))+Rt(Math.floor(i),0,255)}mt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,wt("SegmentVector",mt);let oi=er([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ii=er([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var gi,Ri,_i,Yi={exports:{}},Li={exports:{}},Mr={exports:{}},or=(function(){if(_i)return Yi.exports;_i=1;var c=(gi||(gi=1,Li.exports=function(l,h){var m,_,y,T,I,P,O,N;for(_=l.length-(m=3&l.length),y=h,I=3432918353,P=461845907,N=0;N<_;)O=255&l.charCodeAt(N)|(255&l.charCodeAt(++N))<<8|(255&l.charCodeAt(++N))<<16|(255&l.charCodeAt(++N))<<24,++N,y=27492+(65535&(T=5*(65535&(y=(y^=O=(65535&(O=(O=(65535&O)*I+(((O>>>16)*I&65535)<<16)&4294967295)<<15|O>>>17))*P+(((O>>>16)*P&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(O=0,m){case 3:O^=(255&l.charCodeAt(N+2))<<16;case 2:O^=(255&l.charCodeAt(N+1))<<8;case 1:y^=O=(65535&(O=(O=(65535&(O^=255&l.charCodeAt(N)))*I+(((O>>>16)*I&65535)<<16)&4294967295)<<15|O>>>17))*P+(((O>>>16)*P&65535)<<16)&4294967295}return y^=l.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),Li.exports),i=(Ri||(Ri=1,Mr.exports=function(l,h){for(var m,_=l.length,y=h^_,T=0;_>=4;)m=1540483477*(65535&(m=255&l.charCodeAt(T)|(255&l.charCodeAt(++T))<<8|(255&l.charCodeAt(++T))<<16|(255&l.charCodeAt(++T))<<24))+((1540483477*(m>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),_-=4,++T;switch(_){case 3:y^=(255&l.charCodeAt(T+2))<<16;case 2:y^=(255&l.charCodeAt(T+1))<<8;case 1:y=1540483477*(65535&(y^=255&l.charCodeAt(T)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),Mr.exports);return Yi.exports=c,Yi.exports.murmur3=c,Yi.exports.murmur2=i,Yi.exports})(),tr=v(or);class Yr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,l,h,m){this.ids.push(wc(i)),this.positions.push(l,h,m)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let l=wc(i),h=0,m=this.ids.length-1;for(;h<m;){let y=h+m>>1;this.ids[y]>=l?m=y:h=y+1}let _=[];for(;this.ids[h]===l;)_.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return _}static serialize(i,l){let h=new Float64Array(i.ids),m=new Uint32Array(i.positions);return bl(h,m,0,h.length-1),l&&l.push(h.buffer,m.buffer),{ids:h,positions:m}}static deserialize(i){let l=new Yr;return l.ids=i.ids,l.positions=i.positions,l.indexed=!0,l}}function wc(c){let i=+c;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:tr(String(c))}function bl(c,i,l,h){for(;l<h;){let m=c[l+h>>1],_=l-1,y=h+1;for(;;){do _++;while(c[_]<m);do y--;while(c[y]>m);if(_>=y)break;Ha(c,_,y),Ha(i,3*_,3*y),Ha(i,3*_+1,3*y+1),Ha(i,3*_+2,3*y+2)}y-l<h-y?(bl(c,i,l,y),l=y+1):(bl(c,i,y+1,h),h=y)}}function Ha(c,i,l){let h=c[i];c[i]=c[l],c[l]=h}wt("FeaturePositionMap",Yr);class Yo{constructor(i,l){this.gl=i.gl,this.location=l}}class _u extends Yo{constructor(i,l){super(i,l),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Xd extends Yo{constructor(i,l){super(i,l),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class yu extends Yo{constructor(i,l){super(i,l),this.current=sn.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}let As=new Float32Array(16);function Za(c){return[nn(255*c.r,255*c.g),nn(255*c.b,255*c.a)]}class ma{constructor(i,l,h){this.value=i,this.uniformNames=l.map(m=>`u_${m}`),this.type=h}setUniform(i,l,h){i.set(h.constantOr(this.value))}getBinding(i,l,h){return this.type==="color"?new yu(i,l):new _u(i,l)}}class ga{constructor(i,l){this.uniformNames=l.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=i.tlbr}setConstantDashPositions(i,l){this.dashTo=[0,i.y,i.height,i.width],this.dashFrom=[0,l.y,l.height,l.width]}setUniform(i,l,h,m){let _=null;m==="u_pattern_to"?_=this.patternTo:m==="u_pattern_from"?_=this.patternFrom:m==="u_dasharray_to"?_=this.dashTo:m==="u_dasharray_from"?_=this.dashFrom:m==="u_pixel_ratio_to"?_=this.pixelRatioTo:m==="u_pixel_ratio_from"&&(_=this.pixelRatioFrom),_!==null&&i.set(_)}getBinding(i,l,h){return h.substr(0,9)==="u_pattern"||h.substr(0,12)==="u_dasharray_"?new Xd(i,l):new _u(i,l)}}class bi{constructor(i,l,h,m){this.expression=i,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map(_=>({name:`a_${_}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(i,l,h){let m=this.paintVertexArray.length,_=this.expression.evaluate(new ui(0,h),l,{},h.canonical,[],h.formattedSection);this.paintVertexArray.resize(i),this._setPaintValue(m,i,_)}updatePaintArray(i,l,h,m,_){let y=this.expression.evaluate(new ui(0,_),h,m);this._setPaintValue(i,l,y)}_setPaintValue(i,l,h){if(this.type==="color"){let m=Za(h);for(let _=i;_<l;_++)this.paintVertexArray.emplace(_,m[0],m[1])}else{for(let m=i;m<l;m++)this.paintVertexArray.emplace(m,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class yi{constructor(i,l,h,m,_,y){this.expression=i,this.uniformNames=l.map(T=>`u_${T}_t`),this.type=h,this.useIntegerZoom=m,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=l.map(T=>({name:`a_${T}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(i,l,h){let m=this.expression.evaluate(new ui(this.zoom,h),l,{},h.canonical,[],h.formattedSection),_=this.expression.evaluate(new ui(this.zoom+1,h),l,{},h.canonical,[],h.formattedSection),y=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(y,i,m,_)}updatePaintArray(i,l,h,m,_){let y=this.expression.evaluate(new ui(this.zoom,_),h,m),T=this.expression.evaluate(new ui(this.zoom+1,_),h,m);this._setPaintValue(i,l,y,T)}_setPaintValue(i,l,h,m){if(this.type==="color"){let _=Za(h),y=Za(m);for(let T=i;T<l;T++)this.paintVertexArray.emplace(T,_[0],_[1],y[0],y[1])}else{for(let _=i;_<l;_++)this.paintVertexArray.emplace(_,h,m);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(m))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,l){let h=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,m=Rt(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);i.set(m)}getBinding(i,l,h){return new _u(i,l)}}class br{constructor(i,l,h,m,_,y){this.expression=i,this.type=l,this.useIntegerZoom=h,this.zoom=m,this.layerId=y,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(i,l,h){let m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(m,i,this.getPositionIds(l),h)}updatePaintArray(i,l,h,m,_){this._setPaintValues(i,l,this.getPositionIds(h),_)}_setPaintValues(i,l,h,m){let _=this.getPositions(m);if(!_||!h)return;let y=_[h.min],T=_[h.mid],I=_[h.max];if(y&&T&&I)for(let P=i;P<l;P++)this.emplace(this.zoomInPaintVertexArray,P,T,y),this.emplace(this.zoomOutPaintVertexArray,P,T,I)}upload(i){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){let l=this.getVertexAttributes();this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,l,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,l,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class wr extends br{getPositions(i){return i.imagePositions}getPositionIds(i){return i.patterns&&i.patterns[this.layerId]}getVertexAttributes(){return oi.members}emplace(i,l,h,m){i.emplace(l,h.tlbr[0],h.tlbr[1],h.tlbr[2],h.tlbr[3],m.tlbr[0],m.tlbr[1],m.tlbr[2],m.tlbr[3],h.pixelRatio,m.pixelRatio)}}class y0 extends br{getPositions(i){return i.dashPositions}getPositionIds(i){return i.dashes&&i.dashes[this.layerId]}getVertexAttributes(){return Ii.members}emplace(i,l,h,m){i.emplace(l,0,h.y,h.height,h.width,0,m.y,m.height,m.width)}}class v0{constructor(i,l,h){this.binders={},this._buffers=[];let m=[];for(let _ in i.paint._values){if(!h(_))continue;let y=i.paint.get(_);if(!(y instanceof pa&&ca(y.property.specification)))continue;let T=iE(_,i.type),I=y.value,P=y.property.specification.type,O=y.property.useIntegerZoom,N=y.property.specification["property-type"],j=N==="cross-faded"||N==="cross-faded-data-driven";if(I.kind==="constant")this.binders[_]=j?new ga(I.value,T):new ma(I.value,T,P),m.push(`/u_${_}`);else if(I.kind==="source"||j){let V=x0(_,P,"source");this.binders[_]=j?_==="line-dasharray"?new y0(I,P,O,l,V,i.id):new wr(I,P,O,l,V,i.id):new bi(I,T,P,V),m.push(`/a_${_}`)}else{let V=x0(_,P,"composite");this.binders[_]=new yi(I,T,P,O,l,V),m.push(`/z_${_}`)}}this.cacheKey=m.sort().join("")}getMaxValue(i){let l=this.binders[i];return l instanceof bi||l instanceof yi?l.maxValue:0}populatePaintArrays(i,l,h){for(let m in this.binders){let _=this.binders[m];(_ instanceof bi||_ instanceof yi||_ instanceof br)&&_.populatePaintArray(i,l,h)}}setConstantPatternPositions(i,l){for(let h in this.binders){let m=this.binders[h];m instanceof ga&&m.setConstantPatternPositions(i,l)}}setConstantDashPositions(i,l){for(let h in this.binders){let m=this.binders[h];m instanceof ga&&m.setConstantDashPositions(i,l)}}updatePaintArrays(i,l,h,m,_){let y=!1;for(let T in i){let I=l.getPositions(T);for(let P of I){let O=h.feature(P.index);for(let N in this.binders){let j=this.binders[N];if((j instanceof bi||j instanceof yi||j instanceof br)&&j.expression.isStateDependent===!0){let V=m.paint.get(N);j.expression=V.value,j.updatePaintArray(P.start,P.end,O,i[T],_),y=!0}}}}return y}defines(){let i=[];for(let l in this.binders){let h=this.binders[l];(h instanceof ma||h instanceof ga)&&i.push(...h.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return i}getBinderAttributes(){let i=[];for(let l in this.binders){let h=this.binders[l];if(h instanceof bi||h instanceof yi)for(let m=0;m<h.paintVertexAttributes.length;m++)i.push(h.paintVertexAttributes[m].name);else if(h instanceof br){let m=h.getVertexAttributes();for(let _ of m)i.push(_.name)}}return i}getBinderUniforms(){let i=[];for(let l in this.binders){let h=this.binders[l];if(h instanceof ma||h instanceof ga||h instanceof yi)for(let m of h.uniformNames)i.push(m)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,l){let h=[];for(let m in this.binders){let _=this.binders[m];if(_ instanceof ma||_ instanceof ga||_ instanceof yi){for(let y of _.uniformNames)if(l[y]){let T=_.getBinding(i,l[y],y);h.push({name:y,property:m,binding:T})}}}return h}setUniforms(i,l,h,m){for(let{name:_,property:y,binding:T}of l)this.binders[y].setUniform(T,m,h.get(y),_)}updatePaintBuffers(i){this._buffers=[];for(let l in this.binders){let h=this.binders[l];if(i&&h instanceof br){let m=i.fromScale===2?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(h instanceof bi||h instanceof yi)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(i){for(let l in this.binders){let h=this.binders[l];(h instanceof bi||h instanceof yi||h instanceof br)&&h.upload(i)}this.updatePaintBuffers()}destroy(){for(let i in this.binders){let l=this.binders[i];(l instanceof bi||l instanceof yi||l instanceof br)&&l.destroy()}}}class vu{constructor(i,l,h=()=>!0){this.programConfigurations={};for(let m of i)this.programConfigurations[m.id]=new v0(m,l,h);this.needsUpload=!1,this._featureMap=new Yr,this._bufferOffset=0}populatePaintArrays(i,l,h,m){for(let _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(i,l,m);l.id!==void 0&&this._featureMap.add(l.id,h,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,l,h,m){for(let _ of h)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(i,this._featureMap,l,_,m)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(let l in this.programConfigurations)this.programConfigurations[l].upload(i);this.needsUpload=!1}}destroy(){for(let i in this.programConfigurations)this.programConfigurations[i].destroy()}}function iE(c,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${i}-`,"").replace(/-/g,"_")]}function x0(c,i,l){let h={color:{source:Hd,composite:u},number:{source:$p,composite:Hd}},m=(function(_){return{"line-pattern":{source:ye,composite:ye},"fill-pattern":{source:ye,composite:ye},"fill-extrusion-pattern":{source:ye,composite:ye},"line-dasharray":{source:Ee,composite:Ee}}[_]})(c);return m&&m[l]||h[i][l]}wt("ConstantBinder",ma),wt("CrossFadedConstantBinder",ga),wt("SourceExpressionBinder",bi),wt("CrossFadedPatternBinder",wr),wt("CrossFadedDasharrayBinder",y0),wt("CompositeExpressionBinder",yi),wt("ProgramConfiguration",v0,{omit:["_buffers"]}),wt("ProgramConfigurationSet",vu);let T_=Math.pow(2,14)-1,Ec=-T_-1;function Tc(c){let i=ft/c.extent,l=c.loadGeometry();for(let h=0;h<l.length;h++){let m=l[h];for(let _=0;_<m.length;_++){let y=m[_],T=Math.round(y.x*i),I=Math.round(y.y*i);y.x=Rt(T,Ec,T_),y.y=Rt(I,Ec,T_),(T<y.x||T>y.x+1||I<y.y||I>y.y+1)&&zi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function Cc(c,i){return{type:c.type,id:c.id,properties:c.properties,geometry:i?Tc(c):[]}}let C_=-32768;function I_(c,i,l,h,m){c.emplaceBack(C_+8*i+h,C_+8*l+m)}class Zp{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasDependencies=!1,this.layoutVertexArray=new le,this.indexArray=new Be,this.segments=new mt,this.programConfigurations=new vu(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h){let m=this.layers[0],_=[],y=null,T=!1,I=m.type==="heatmap";if(m.type==="circle"){let O=m;y=O.layout.get("circle-sort-key"),T=!y.isConstant(),I=I||O.paint.get("circle-pitch-alignment")==="map"}let P=I?l.subdivisionGranularity.circle:1;for(let{feature:O,id:N,index:j,sourceLayerIndex:V}of i){let Z=this.layers[0]._featureFilter.needGeometry,X=Cc(O,Z);if(!this.layers[0]._featureFilter.filter(new ui(this.zoom),X,h))continue;let K=T?y.evaluate(X,{},h):void 0,ne={id:N,properties:O.properties,type:O.type,sourceLayerIndex:V,index:j,geometry:Z?X.geometry:Tc(O),patterns:{},sortKey:K};_.push(ne)}T&&_.sort((O,N)=>O.sortKey-N.sortKey);for(let O of _){let{geometry:N,index:j,sourceLayerIndex:V}=O,Z=i[j].feature;this.addFeature(O,N,j,h,P),l.featureIndex.insert(Z,N,j,V,this.index)}}update(i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,{imagePositions:h})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Ye),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,h,m,_=1){let y;switch(_){case 1:y=[0,7];break;case 3:y=[0,2,5,7];break;case 5:y=[0,1,3,4,6,7];break;case 7:y=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${_}; valid values are 1, 3, 5, 7.`)}let T=y.length;for(let I of l)for(let P of I){let O=P.x,N=P.y;if(O<0||O>=ft||N<0||N>=ft)continue;let j=this.segments.prepareSegment(T*T,this.layoutVertexArray,this.indexArray,i.sortKey),V=j.vertexLength;for(let Z=0;Z<T;Z++)for(let X=0;X<T;X++)I_(this.layoutVertexArray,O,N,y[X],y[Z]);for(let Z=0;Z<T-1;Z++)for(let X=0;X<T-1;X++){let K=V+Z*T+X,ne=V+(Z+1)*T+X;this.indexArray.emplaceBack(K,ne+1,K+1),this.indexArray.emplaceBack(K,ne,ne+1)}j.vertexLength+=T*T,j.primitiveLength+=(T-1)*(T-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,{imagePositions:{},canonical:m})}}function qp(c,i){for(let l=0;l<c.length;l++)if(Wp(i,c[l]))return!0;for(let l=0;l<i.length;l++)if(Wp(c,i[l]))return!0;return!!rE(c,i)}function b0(c,i,l){return!!Wp(c,i)||!!oE(i,c,l)}function YP(c,i){if(c.length===1)return JP(i,c[0]);for(let l=0;l<i.length;l++){let h=i[l];for(let m=0;m<h.length;m++)if(Wp(c,h[m]))return!0}for(let l=0;l<c.length;l++)if(JP(i,c[l]))return!0;for(let l=0;l<i.length;l++)if(rE(c,i[l]))return!0;return!1}function Hj(c,i,l){if(c.length>1){if(rE(c,i))return!0;for(let h=0;h<i.length;h++)if(oE(i[h],c,l))return!0}for(let h=0;h<c.length;h++)if(oE(c[h],i,l))return!0;return!1}function rE(c,i){if(c.length===0||i.length===0)return!1;for(let l=0;l<c.length-1;l++){let h=c[l],m=c[l+1];for(let _=0;_<i.length-1;_++)if(Zj(h,m,i[_],i[_+1]))return!0}return!1}function Zj(c,i,l,h){return ir(c,l,h)!==ir(i,l,h)&&ir(c,i,l)!==ir(c,i,h)}function oE(c,i,l){let h=l*l;if(i.length===1)return c.distSqr(i[0])<h;for(let m=1;m<i.length;m++)if(KP(c,i[m-1],i[m])<h)return!0;return!1}function KP(c,i,l){let h=i.distSqr(l);if(h===0)return c.distSqr(i);let m=((c.x-i.x)*(l.x-i.x)+(c.y-i.y)*(l.y-i.y))/h;return c.distSqr(m<0?i:m>1?l:l.sub(i)._mult(m)._add(i))}function JP(c,i){let l,h,m,_=!1;for(let y=0;y<c.length;y++){l=c[y];for(let T=0,I=l.length-1;T<l.length;I=T++)h=l[T],m=l[I],h.y>i.y!=m.y>i.y&&i.x<(m.x-h.x)*(i.y-h.y)/(m.y-h.y)+h.x&&(_=!_)}return _}function Wp(c,i){let l=!1;for(let h=0,m=c.length-1;h<c.length;m=h++){let _=c[h],y=c[m];_.y>i.y!=y.y>i.y&&i.x<(y.x-_.x)*(i.y-_.y)/(y.y-_.y)+_.x&&(l=!l)}return l}function qj(c,i,l){let h=l[0],m=l[2];if(c.x<h.x&&i.x<h.x||c.x>m.x&&i.x>m.x||c.y<h.y&&i.y<h.y||c.y>m.y&&i.y>m.y)return!1;let _=ir(c,i,l[0]);return _!==ir(c,i,l[1])||_!==ir(c,i,l[2])||_!==ir(c,i,l[3])}function Xp(c,i,l){let h=i.paint.get(c).value;return h.kind==="constant"?h.value:l.programConfigurations.get(i.id).getMaxValue(c)}function w0(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function E0(c,i,l,h,m){if(!i[0]&&!i[1])return c;let _=f.convert(i)._mult(m);l==="viewport"&&_._rotate(-h);let y=[];for(let T=0;T<c.length;T++)y.push(c[T].sub(_));return y}function Wj(c){let i=[];for(let l=0;l<c.length;l++){let h=c[l],m=i.at(-1);(l===0||m&&!h.equals(m))&&i.push(h)}return i}function Xj({queryGeometry:c,size:i},l){return b0(c,l,i)}function Yj({queryGeometry:c,size:i,transform:l,unwrappedTileID:h,getElevation:m},_){return b0(c,_,i*(l.projectTileCoordinates(_.x,_.y,h,m).signedDistanceFromCamera/l.cameraToCenterDistance))}function Kj({queryGeometry:c,size:i,transform:l,unwrappedTileID:h,getElevation:m},_){let y=l.projectTileCoordinates(_.x,_.y,h,m).signedDistanceFromCamera,T=i*(l.cameraToCenterDistance/y);return b0(c,sE(_,l,h,m),T)}function Jj({queryGeometry:c,size:i,transform:l,unwrappedTileID:h,getElevation:m},_){return b0(c,sE(_,l,h,m),i)}function QP({queryGeometry:c,size:i,transform:l,unwrappedTileID:h,getElevation:m,pitchAlignment:_="map",pitchScale:y="map"},T){let I=_==="map"?y==="map"?Xj:Yj:y==="map"?Kj:Jj,P={queryGeometry:c,size:i,transform:l,unwrappedTileID:h,getElevation:m};for(let O of T)for(let N of O)if(I(P,N))return!0;return!1}function sE(c,i,l,h){let m=i.projectTileCoordinates(c.x,c.y,l,h).point;return new f((.5*m.x+.5)*i.width,(.5*-m.y+.5)*i.height)}let eA,tA;wt("CircleBucket",Zp,{omit:["layers"]});var Qj={get paint(){return tA=tA||new ko({"circle-radius":new zt(Te.paint_circle["circle-radius"]),"circle-color":new zt(Te.paint_circle["circle-color"]),"circle-blur":new zt(Te.paint_circle["circle-blur"]),"circle-opacity":new zt(Te.paint_circle["circle-opacity"]),"circle-translate":new Lt(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new Lt(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Lt(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Lt(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new zt(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new zt(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new zt(Te.paint_circle["circle-stroke-opacity"])})},get layout(){return eA=eA||new ko({"circle-sort-key":new zt(Te.layout_circle["circle-sort-key"])})}};class e3 extends Ps{constructor(i,l){super(i,Qj,l)}createBucket(i){return new Zp(i)}queryRadius(i){let l=i;return Xp("circle-radius",this,l)+Xp("circle-stroke-width",this,l)+w0(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:i,feature:l,featureState:h,geometry:m,transform:_,pixelsToTileUnits:y,unwrappedTileID:T,getElevation:I}){let P=E0(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-_.bearingInRadians,y),O=this.paint.get("circle-radius").evaluate(l,h)+this.paint.get("circle-stroke-width").evaluate(l,h),N=this.paint.get("circle-pitch-scale"),j=this.paint.get("circle-pitch-alignment"),V,Z;return j==="map"?(V=P,Z=O*y):(V=(function(X,K,ne,he){return X.map(re=>sE(re,K,ne,he))})(P,_,T,I),Z=O),QP({queryGeometry:V,size:Z,transform:_,unwrappedTileID:T,getElevation:I,pitchAlignment:j,pitchScale:N},m)}}class nA extends Zp{}let iA;wt("HeatmapBucket",nA,{omit:["layers"]});var t3={get paint(){return iA=iA||new ko({"heatmap-radius":new zt(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new zt(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Lt(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Bp(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Lt(Te.paint_heatmap["heatmap-opacity"])})}};function aE(c,{width:i,height:l},h,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==i*l*h)throw new RangeError(`mismatched image size. expected: ${m.length} but got: ${i*l*h}`)}else m=new Uint8Array(i*l*h);return c.width=i,c.height=l,c.data=m,c}function rA(c,{width:i,height:l},h){if(i===c.width&&l===c.height)return;let m=aE({},{width:i,height:l},h);lE(c,m,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,i),height:Math.min(c.height,l)},h),c.width=i,c.height=l,c.data=m.data}function lE(c,i,l,h,m,_){if(m.width===0||m.height===0)return i;if(m.width>c.width||m.height>c.height||l.x>c.width-m.width||l.y>c.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>i.width||m.height>i.height||h.x>i.width-m.width||h.y>i.height-m.height)throw new RangeError("out of range destination coordinates for image copy");let y=c.data,T=i.data;if(y===T)throw new Error("srcData equals dstData, so image is already copied");for(let I=0;I<m.height;I++){let P=((l.y+I)*c.width+l.x)*_,O=((h.y+I)*i.width+h.x)*_;for(let N=0;N<m.width*_;N++)T[O+N]=y[P+N]}return i}class S_{constructor(i,l){aE(this,i,1,l)}resize(i){rA(this,i,1)}clone(){return new S_({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,h,m,_){lE(i,l,h,m,_,1)}}class ps{constructor(i,l){aE(this,i,4,l)}resize(i){rA(this,i,4)}replace(i,l){l?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new ps({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,h,m,_){lE(i,l,h,m,_,4)}setPixel(i,l,h){let m=4*(i*this.width+l);this.data[m+0]=Math.round(255*h.r/h.a),this.data[m+1]=Math.round(255*h.g/h.a),this.data[m+2]=Math.round(255*h.b/h.a),this.data[m+3]=Math.round(255*h.a)}}function oA(c){let i={},l=c.resolution||256,h=c.clips?c.clips.length:1,m=c.image||new ps({width:l,height:h});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);let _=(y,T,I)=>{i[c.evaluationKey]=I;let P=c.expression.evaluate(i);m.setPixel(y/4/l,T/4,P)};if(c.clips)for(let y=0,T=0;y<h;++y,T+=4*l)for(let I=0,P=0;I<l;I++,P+=4){let O=I/(l-1),{start:N,end:j}=c.clips[y];_(T,P,N*(1-O)+j*O)}else for(let y=0,T=0;y<l;y++,T+=4)_(0,T,y/(l-1));return m}wt("AlphaImage",S_),wt("RGBAImage",ps);let cE="big-fb";class n3 extends Ps{createBucket(i){return new nA(i)}constructor(i,l){super(i,t3,l),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=oA({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(cE)&&this.heatmapFbos.delete(cE)}queryRadius(i){return Xp("heatmap-radius",this,i)}queryIntersectsFeature({queryGeometry:i,feature:l,featureState:h,geometry:m,transform:_,pixelsToTileUnits:y,unwrappedTileID:T,getElevation:I}){return QP({queryGeometry:i,size:this.paint.get("heatmap-radius").evaluate(l,h)*y,transform:_,unwrappedTileID:T,getElevation:I},m)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let sA;var i3={get paint(){return sA=sA||new ko({"hillshade-illumination-direction":new Lt(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Lt(Te.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Lt(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Lt(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Lt(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Lt(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Lt(Te.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Lt(Te.paint_hillshade["hillshade-method"])})}};class r3 extends Ps{constructor(i,l){super(i,i3,l),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let i=this.paint.get("hillshade-illumination-direction").values,l=this.paint.get("hillshade-illumination-altitude").values,h=this.paint.get("hillshade-highlight-color").values,m=this.paint.get("hillshade-shadow-color").values,_=Math.max(i.length,l.length,h.length,m.length);i=i.concat(Array(_-i.length).fill(i.at(-1))),l=l.concat(Array(_-l.length).fill(l.at(-1))),h=h.concat(Array(_-h.length).fill(h.at(-1))),m=m.concat(Array(_-m.length).fill(m.at(-1)));let y=l.map(Mo);return{directionRadians:i.map(Mo),altitudeRadians:y,shadowColor:m,highlightColor:h}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let aA;var o3={get paint(){return aA=aA||new ko({"color-relief-opacity":new Lt(Te["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Bp(Te["paint_color-relief"]["color-relief-color"])})}};class uE{constructor(i,l,h,m){this.context=i,this.format=h,this.texture=i.gl.createTexture(),this.update(l,m)}update(i,l,h){let{width:m,height:_}=i,y=!(this.size&&this.size[0]===m&&this.size[1]===_||h),{context:T}=this,{gl:I}=T;if(this.useMipmap=!!(l&&l.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!l||l.premultiply!==!1)),y)this.size=[m,_],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||Di(i)?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,i):I.texImage2D(I.TEXTURE_2D,0,this.format,m,_,0,this.format,I.UNSIGNED_BYTE,i.data);else{let{x:P,y:O}=h||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||Di(i)?I.texSubImage2D(I.TEXTURE_2D,0,P,O,I.RGBA,I.UNSIGNED_BYTE,i):I.texSubImage2D(I.TEXTURE_2D,0,P,O,m,_,I.RGBA,I.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D),T.pixelStoreUnpackFlipY.setDefault(),T.pixelStoreUnpack.setDefault(),T.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(i,l,h){let{context:m}=this,{gl:_}=m;_.bindTexture(_.TEXTURE_2D,this.texture),h!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=_.LINEAR),i!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,i),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,h||i),this.filter=i),l!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,l),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class lA{constructor(i,l,h,m=1,_=1,y=1,T=0){if(this.uid=i,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&!["mapbox","terrarium","custom"].includes(h))return void zi(`"${h}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=l.height;let I=this.dim=l.height-2;switch(this.data=new Uint32Array(l.data.buffer),h){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=m,this.greenFactor=_,this.blueFactor=y,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<I;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(I,P)]=this.data[this._idx(I-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,I)]=this.data[this._idx(P,I-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(I,-1)]=this.data[this._idx(I-1,0)],this.data[this._idx(-1,I)]=this.data[this._idx(0,I-1)],this.data[this._idx(I,I)]=this.data[this._idx(I-1,I-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<I;P++)for(let O=0;O<I;O++){let N=this.get(P,O);N>this.max&&(this.max=N),N<this.min&&(this.min=N)}}get(i,l){let h=new Uint8Array(this.data.buffer),m=4*this._idx(i,l);return this.unpack(h[m],h[m+1],h[m+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,l){if(i<-1||i>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${i}, y: ${l}, dim: ${this.dim}`);return(l+1)*this.stride+(i+1)}unpack(i,l,h){return i*this.redFactor+l*this.greenFactor+h*this.blueFactor-this.baseShift}pack(i){return cA(i,this.getUnpackVector())}getPixels(){return new ps({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,l,h){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let m=l*this.dim,_=l*this.dim+this.dim,y=h*this.dim,T=h*this.dim+this.dim;switch(l){case-1:m=_-1;break;case 1:_=m+1}switch(h){case-1:y=T-1;break;case 1:T=y+1}let I=-l*this.dim,P=-h*this.dim;for(let O=y;O<T;O++)for(let N=m;N<_;N++)this.data[this._idx(N,O)]=i.data[this._idx(N+I,O+P)]}}function cA(c,i){let l=i[0],h=i[1],m=i[2],_=i[3],y=Math.min(l,h,m),T=Math.round((c+_)/y);return{r:Math.floor(T*y/l)%256,g:Math.floor(T*y/h)%256,b:Math.floor(T*y/m)%256}}wt("DEMData",lA);class s3 extends Ps{constructor(i,l){super(i,o3,l)}_createColorRamp(i){let l={elevationStops:[],colorStops:[]},h=this._transitionablePaint._values["color-relief-color"].value.expression;if(h instanceof b&&h._styleExpression.expression instanceof Vi){this.colorRampExpression=h;let y=h._styleExpression.expression;l.elevationStops=y.labels,l.colorStops=[];for(let T of l.elevationStops)l.colorStops.push(y.evaluate({globals:{elevation:T}}))}if(l.elevationStops.length<1&&(l.elevationStops=[0],l.colorStops=[sn.transparent]),l.elevationStops.length<2&&(l.elevationStops.push(l.elevationStops[0]+1),l.colorStops.push(l.colorStops[0])),l.elevationStops.length<=i)return l;let m={elevationStops:[],colorStops:[]},_=(l.elevationStops.length-1)/(i-1);for(let y=0;y<l.elevationStops.length-.5;y+=_)m.elevationStops.push(l.elevationStops[Math.round(y)]),m.colorStops.push(l.colorStops[Math.round(y)]);return zi(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${i}, provided: ${l.elevationStops.length}`),m}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(i,l,h){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;let m=this._createColorRamp(l),_=new ps({width:m.colorStops.length,height:1}),y=new ps({width:m.colorStops.length,height:1});for(let T=0;T<m.elevationStops.length;T++){let I=cA(m.elevationStops[T],h);y.setPixel(0,T,new sn(I.r/255,I.g/255,I.b/255,1)),_.setPixel(0,T,m.colorStops[T])}return this.colorRampTextures={elevationTexture:new uE(i,y,i.gl.RGBA),colorTexture:new uE(i,_,i.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}let a3=er([{name:"a_pos",components:2,type:"Int16"}],4),{members:l3}=a3;function T0(c,i,l){let h=l.patternDependencies,m=!1;for(let _ of i){let y=_.paint.get(`${c}-pattern`);y.isConstant()||(m=!0);let T=y.constantOr(null);T&&(m=!0,h[T.to]=!0,h[T.from]=!0)}return m}function hE(c,i,l,h,m){let{zoom:_}=h,y=m.patternDependencies;for(let T of i){let I=T.paint.get(`${c}-pattern`).value;if(I.kind!=="constant"){let P=I.evaluate({zoom:_-1},l,{},m.availableImages),O=I.evaluate({zoom:_},l,{},m.availableImages),N=I.evaluate({zoom:_+1},l,{},m.availableImages);P=P&&P.name?P.name:P,O=O&&O.name?O.name:O,N=N&&N.name?N.name:N,y[P]=!0,y[O]=!0,y[N]=!0,l.patterns[T.id]={min:P,mid:O,max:N}}}return l}function uA(c,i,l,h,m){let _;if(m===(function(y,T,I,P){let O=0;for(let N=T,j=I-P;N<I;N+=P)O+=(y[j]-y[N])*(y[N+1]+y[j+1]),j=N;return O})(c,i,l,h)>0)for(let y=i;y<l;y+=h)_=pA(y/h|0,c[y],c[y+1],_);else for(let y=l-h;y>=i;y-=h)_=pA(y/h|0,c[y],c[y+1],_);return _&&Yp(_,_.next)&&(A_(_),_=_.next),_}function Yd(c,i){if(!c)return c;i||(i=c);let l,h=c;do if(l=!1,h.steiner||!Yp(h,h.next)&&sr(h.prev,h,h.next)!==0)h=h.next;else{if(A_(h),h=i=h.prev,h===h.next)break;l=!0}while(l||h!==i);return i}function D_(c,i,l,h,m,_,y){if(!c)return;!y&&_&&(function(I,P,O,N){let j=I;do j.z===0&&(j.z=dE(j.x,j.y,P,O,N)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next;while(j!==I);j.prevZ.nextZ=null,j.prevZ=null,(function(V){let Z,X=1;do{let K,ne=V;V=null;let he=null;for(Z=0;ne;){Z++;let re=ne,oe=0;for(let ve=0;ve<X&&(oe++,re=re.nextZ,re);ve++);let pe=X;for(;oe>0||pe>0&&re;)oe!==0&&(pe===0||!re||ne.z<=re.z)?(K=ne,ne=ne.nextZ,oe--):(K=re,re=re.nextZ,pe--),he?he.nextZ=K:V=K,K.prevZ=he,he=K;ne=re}he.nextZ=null,X*=2}while(Z>1)})(j)})(c,h,m,_);let T=c;for(;c.prev!==c.next;){let I=c.prev,P=c.next;if(_?u3(c,h,m,_):c3(c))i.push(I.i,c.i,P.i),A_(c),c=P.next,T=P.next;else if((c=P)===T){y?y===1?D_(c=h3(Yd(c),i),i,l,h,m,_,2):y===2&&d3(c,i,l,h,m,_):D_(Yd(c),i,l,h,m,_,1);break}}}function c3(c){let i=c.prev,l=c,h=c.next;if(sr(i,l,h)>=0)return!1;let m=i.x,_=l.x,y=h.x,T=i.y,I=l.y,P=h.y,O=Math.min(m,_,y),N=Math.min(T,I,P),j=Math.max(m,_,y),V=Math.max(T,I,P),Z=h.next;for(;Z!==i;){if(Z.x>=O&&Z.x<=j&&Z.y>=N&&Z.y<=V&&M_(m,T,_,I,y,P,Z.x,Z.y)&&sr(Z.prev,Z,Z.next)>=0)return!1;Z=Z.next}return!0}function u3(c,i,l,h){let m=c.prev,_=c,y=c.next;if(sr(m,_,y)>=0)return!1;let T=m.x,I=_.x,P=y.x,O=m.y,N=_.y,j=y.y,V=Math.min(T,I,P),Z=Math.min(O,N,j),X=Math.max(T,I,P),K=Math.max(O,N,j),ne=dE(V,Z,i,l,h),he=dE(X,K,i,l,h),re=c.prevZ,oe=c.nextZ;for(;re&&re.z>=ne&&oe&&oe.z<=he;){if(re.x>=V&&re.x<=X&&re.y>=Z&&re.y<=K&&re!==m&&re!==y&&M_(T,O,I,N,P,j,re.x,re.y)&&sr(re.prev,re,re.next)>=0||(re=re.prevZ,oe.x>=V&&oe.x<=X&&oe.y>=Z&&oe.y<=K&&oe!==m&&oe!==y&&M_(T,O,I,N,P,j,oe.x,oe.y)&&sr(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;re&&re.z>=ne;){if(re.x>=V&&re.x<=X&&re.y>=Z&&re.y<=K&&re!==m&&re!==y&&M_(T,O,I,N,P,j,re.x,re.y)&&sr(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;oe&&oe.z<=he;){if(oe.x>=V&&oe.x<=X&&oe.y>=Z&&oe.y<=K&&oe!==m&&oe!==y&&M_(T,O,I,N,P,j,oe.x,oe.y)&&sr(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function h3(c,i){let l=c;do{let h=l.prev,m=l.next.next;!Yp(h,m)&&dA(h,l,l.next,m)&&P_(h,m)&&P_(m,h)&&(i.push(h.i,l.i,m.i),A_(l),A_(l.next),l=c=m),l=l.next}while(l!==c);return Yd(l)}function d3(c,i,l,h,m,_){let y=c;do{let T=y.next.next;for(;T!==y.prev;){if(y.i!==T.i&&_3(y,T)){let I=fA(y,T);return y=Yd(y,y.next),I=Yd(I,I.next),D_(y,i,l,h,m,_,0),void D_(I,i,l,h,m,_,0)}T=T.next}y=y.next}while(y!==c)}function f3(c,i){let l=c.x-i.x;return l===0&&(l=c.y-i.y,l===0)&&(l=(c.next.y-c.y)/(c.next.x-c.x)-(i.next.y-i.y)/(i.next.x-i.x)),l}function p3(c,i){let l=(function(m,_){let y=_,T=m.x,I=m.y,P,O=-1/0;if(Yp(m,y))return y;do{if(Yp(m,y.next))return y.next;if(I<=y.y&&I>=y.next.y&&y.next.y!==y.y){let X=y.x+(I-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(X<=T&&X>O&&(O=X,P=y.x<y.next.x?y:y.next,X===T))return P}y=y.next}while(y!==_);if(!P)return null;let N=P,j=P.x,V=P.y,Z=1/0;y=P;do{if(T>=y.x&&y.x>=j&&T!==y.x&&hA(I<V?T:O,I,j,V,I<V?O:T,I,y.x,y.y)){let X=Math.abs(I-y.y)/(T-y.x);P_(y,m)&&(X<Z||X===Z&&(y.x>P.x||y.x===P.x&&m3(P,y)))&&(P=y,Z=X)}y=y.next}while(y!==N);return P})(c,i);if(!l)return i;let h=fA(l,c);return Yd(h,h.next),Yd(l,l.next)}function m3(c,i){return sr(c.prev,c,i.prev)<0&&sr(i.next,c,c.next)<0}function dE(c,i,l,h,m){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-l)*m|0)|c<<8))|c<<4))|c<<2))|c<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-h)*m|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function g3(c){let i=c,l=c;do(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next;while(i!==c);return l}function hA(c,i,l,h,m,_,y,T){return(m-y)*(i-T)>=(c-y)*(_-T)&&(c-y)*(h-T)>=(l-y)*(i-T)&&(l-y)*(_-T)>=(m-y)*(h-T)}function M_(c,i,l,h,m,_,y,T){return!(c===y&&i===T)&&hA(c,i,l,h,m,_,y,T)}function _3(c,i){return c.next.i!==i.i&&c.prev.i!==i.i&&!(function(l,h){let m=l;do{if(m.i!==l.i&&m.next.i!==l.i&&m.i!==h.i&&m.next.i!==h.i&&dA(m,m.next,l,h))return!0;m=m.next}while(m!==l);return!1})(c,i)&&(P_(c,i)&&P_(i,c)&&(function(l,h){let m=l,_=!1,y=(l.x+h.x)/2,T=(l.y+h.y)/2;do m.y>T!=m.next.y>T&&m.next.y!==m.y&&y<(m.next.x-m.x)*(T-m.y)/(m.next.y-m.y)+m.x&&(_=!_),m=m.next;while(m!==l);return _})(c,i)&&(sr(c.prev,c,i.prev)||sr(c,i.prev,i))||Yp(c,i)&&sr(c.prev,c,c.next)>0&&sr(i.prev,i,i.next)>0)}function sr(c,i,l){return(i.y-c.y)*(l.x-i.x)-(i.x-c.x)*(l.y-i.y)}function Yp(c,i){return c.x===i.x&&c.y===i.y}function dA(c,i,l,h){let m=I0(sr(c,i,l)),_=I0(sr(c,i,h)),y=I0(sr(l,h,c)),T=I0(sr(l,h,i));return m!==_&&y!==T||!(m!==0||!C0(c,l,i))||!(_!==0||!C0(c,h,i))||!(y!==0||!C0(l,c,h))||!(T!==0||!C0(l,i,h))}function C0(c,i,l){return i.x<=Math.max(c.x,l.x)&&i.x>=Math.min(c.x,l.x)&&i.y<=Math.max(c.y,l.y)&&i.y>=Math.min(c.y,l.y)}function I0(c){return c>0?1:c<0?-1:0}function P_(c,i){return sr(c.prev,c,c.next)<0?sr(c,i,c.next)>=0&&sr(c,c.prev,i)>=0:sr(c,i,c.prev)<0||sr(c,c.next,i)<0}function fA(c,i){let l=fE(c.i,c.x,c.y),h=fE(i.i,i.x,i.y),m=c.next,_=i.prev;return c.next=i,i.prev=c,l.next=m,m.prev=l,h.next=l,l.prev=h,_.next=h,h.prev=_,h}function pA(c,i,l,h){let m=fE(c,i,l);return h?(m.next=h.next,m.prev=h,h.next.prev=m,h.next=m):(m.prev=m,m.next=m),m}function A_(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function fE(c,i,l){return{i:c,x:i,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Kp{constructor(i,l){if(l>i)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=i,this._minGranularity=l}getGranularityForZoomLevel(i){return Math.max(Math.floor(this._baseZoomGranularity/(1<<i)),this._minGranularity,1)}}class S0{constructor(i){this.fill=i.fill,this.line=i.line,this.tile=i.tile,this.stencil=i.stencil,this.circle=i.circle}}S0.noSubdivision=new S0({fill:new Kp(0,0),line:new Kp(0,0),tile:new Kp(0,0),stencil:new Kp(0,0),circle:1}),wt("SubdivisionGranularityExpression",Kp),wt("SubdivisionGranularitySetting",S0);let Jp=-32768,R_=32767;class y3{constructor(i,l){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=i,this._granularityCellSize=ft/i,this._canonical=l}_getKey(i,l){return(i+=32768)<<16|l+32768}_vertexToIndex(i,l){if(i<-32768||l<-32768||i>32767||l>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");let h=0|Math.round(i),m=0|Math.round(l),_=this._getKey(h,m);if(this._vertexDictionary.has(_))return this._vertexDictionary.get(_);let y=this._vertexBuffer.length/2;return this._vertexDictionary.set(_,y),this._vertexBuffer.push(h,m),y}_subdivideTrianglesScanline(i){if(this._granularity<2)return(function(m,_){let y=[];for(let T=0;T<_.length;T+=3){let I=_[T],P=_[T+1],O=_[T+2],N=m[2*I],j=m[2*I+1];(m[2*P]-N)*(m[2*O+1]-j)-(m[2*P+1]-j)*(m[2*O]-N)>0?(y.push(I),y.push(O),y.push(P)):(y.push(I),y.push(P),y.push(O))}return y})(this._vertexBuffer,i);let l=[],h=i.length;for(let m=0;m<h;m+=3){let _=[i[m+0],i[m+1],i[m+2]],y=[this._vertexBuffer[2*i[m+0]+0],this._vertexBuffer[2*i[m+0]+1],this._vertexBuffer[2*i[m+1]+0],this._vertexBuffer[2*i[m+1]+1],this._vertexBuffer[2*i[m+2]+0],this._vertexBuffer[2*i[m+2]+1]],T=1/0,I=1/0,P=-1/0,O=-1/0;for(let X=0;X<3;X++){let K=y[2*X],ne=y[2*X+1];T=Math.min(T,K),P=Math.max(P,K),I=Math.min(I,ne),O=Math.max(O,ne)}if(T===P||I===O)continue;let N=Math.floor(T/this._granularityCellSize),j=Math.ceil(P/this._granularityCellSize),V=Math.floor(I/this._granularityCellSize),Z=Math.ceil(O/this._granularityCellSize);if(N!==j||V!==Z)for(let X=V;X<Z;X++){let K=this._scanlineGenerateVertexRingForCellRow(X,y,_);v3(this._vertexBuffer,K,l)}else l.push(..._)}return l}_scanlineGenerateVertexRingForCellRow(i,l,h){let m=i*this._granularityCellSize,_=m+this._granularityCellSize,y=[];for(let T=0;T<3;T++){let I=l[2*T],P=l[2*T+1],O=l[2*(T+1)%6],N=l[(2*(T+1)+1)%6],j=l[2*(T+2)%6],V=l[(2*(T+2)+1)%6],Z=O-I,X=N-P,K=Z===0,ne=X===0,he=(m-P)/X,re=(_-P)/X,oe=Math.min(he,re),pe=Math.max(he,re);if(!ne&&(oe>=1||pe<=0)||ne&&(P<m||P>_)){N>=m&&N<=_&&y.push(h[(T+1)%3]);continue}!ne&&oe>0&&y.push(this._vertexToIndex(I+Z*oe,P+X*oe));let ve=I+Z*Math.max(oe,0),Oe=I+Z*Math.min(pe,1);K||this._generateIntraEdgeVertices(y,I,P,O,N,ve,Oe),!ne&&pe<1&&y.push(this._vertexToIndex(I+Z*pe,P+X*pe)),(ne||N>=m&&N<=_)&&y.push(h[(T+1)%3]),!ne&&(N<=m||N>=_)&&this._generateInterEdgeVertices(y,I,P,O,N,j,V,Oe,m,_)}return y}_generateIntraEdgeVertices(i,l,h,m,_,y,T){let I=m-l,P=_-h,O=P===0,N=O?Math.min(l,m):Math.min(y,T),j=O?Math.max(l,m):Math.max(y,T),V=Math.floor(N/this._granularityCellSize)+1,Z=Math.ceil(j/this._granularityCellSize)-1;if(O?l<m:y<T)for(let X=V;X<=Z;X++){let K=X*this._granularityCellSize;i.push(this._vertexToIndex(K,h+P*(K-l)/I))}else for(let X=Z;X>=V;X--){let K=X*this._granularityCellSize;i.push(this._vertexToIndex(K,h+P*(K-l)/I))}}_generateInterEdgeVertices(i,l,h,m,_,y,T,I,P,O){let N=_-h,j=y-m,V=T-_,Z=(P-_)/V,X=(O-_)/V,K=Math.min(Z,X),ne=Math.max(Z,X),he=m+j*K,re=Math.floor(Math.min(he,I)/this._granularityCellSize)+1,oe=Math.ceil(Math.max(he,I)/this._granularityCellSize)-1,pe=I<he,ve=V===0;if(ve&&(T===P||T===O))return;if(ve||K>=1||ne<=0){let qe=h-T,Ze=y+(l-y)*Math.min((P-T)/qe,(O-T)/qe);re=Math.floor(Math.min(Ze,I)/this._granularityCellSize)+1,oe=Math.ceil(Math.max(Ze,I)/this._granularityCellSize)-1,pe=I<Ze}let Oe=N>0?O:P;if(pe)for(let qe=re;qe<=oe;qe++)i.push(this._vertexToIndex(qe*this._granularityCellSize,Oe));else for(let qe=oe;qe>=re;qe--)i.push(this._vertexToIndex(qe*this._granularityCellSize,Oe))}_generateOutline(i){let l=[];for(let h of i){let m=Kd(h,this._granularity,!0),_=this._pointArrayToIndices(m),y=[];for(let T=1;T<_.length;T++)y.push(_[T-1]),y.push(_[T]);l.push(y)}return l}_handlePoles(i){let l=!1,h=!1;this._canonical&&(this._canonical.y===0&&(l=!0),this._canonical.y===(1<<this._canonical.z)-1&&(h=!0)),(l||h)&&this._fillPoles(i,l,h)}_ensureNoPoleVertices(){let i=this._vertexBuffer;for(let l=0;l<i.length;l+=2){let h=i[l+1];h===Jp&&(i[l+1]=-32767),h===R_&&(i[l+1]=32766)}}_generatePoleQuad(i,l,h,m,_,y){m>_!=(y===Jp)?(i.push(l),i.push(h),i.push(this._vertexToIndex(m,y)),i.push(h),i.push(this._vertexToIndex(_,y)),i.push(this._vertexToIndex(m,y))):(i.push(h),i.push(l),i.push(this._vertexToIndex(m,y)),i.push(this._vertexToIndex(_,y)),i.push(h),i.push(this._vertexToIndex(m,y)))}_fillPoles(i,l,h){let m=this._vertexBuffer,_=ft,y=i.length;for(let T=2;T<y;T+=3){let I=i[T-2],P=i[T-1],O=i[T],N=m[2*I],j=m[2*I+1],V=m[2*P],Z=m[2*P+1],X=m[2*O],K=m[2*O+1];l&&(j===0&&Z===0&&this._generatePoleQuad(i,I,P,N,V,Jp),Z===0&&K===0&&this._generatePoleQuad(i,P,O,V,X,Jp),K===0&&j===0&&this._generatePoleQuad(i,O,I,X,N,Jp)),h&&(j===_&&Z===_&&this._generatePoleQuad(i,I,P,N,V,R_),Z===_&&K===_&&this._generatePoleQuad(i,P,O,V,X,R_),K===_&&j===_&&this._generatePoleQuad(i,O,I,X,N,R_))}}_initializeVertices(i){for(let l=0;l<i.length;l+=2)this._vertexToIndex(i[l],i[l+1])}subdividePolygonInternal(i,l){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;let{flattened:h,holeIndices:m}=(function(T){let I=[],P=[];for(let O of T)if(O.length!==0){O!==T[0]&&I.push(P.length/2);for(let N=0;N<O.length;N++)P.push(O[N].x),P.push(O[N].y)}return{flattened:P,holeIndices:I}})(i),_;this._initializeVertices(h);try{let T=(function(P,O,N=2){let j=O&&O.length,V=j?O[0]*N:P.length,Z=uA(P,0,V,N,!0),X=[];if(!Z||Z.next===Z.prev)return X;let K,ne,he;if(j&&(Z=(function(re,oe,pe,ve){let Oe=[];for(let qe=0,Ze=oe.length;qe<Ze;qe++){let We=uA(re,oe[qe]*ve,qe<Ze-1?oe[qe+1]*ve:re.length,ve,!1);We===We.next&&(We.steiner=!0),Oe.push(g3(We))}Oe.sort(f3);for(let qe=0;qe<Oe.length;qe++)pe=p3(Oe[qe],pe);return pe})(P,O,Z,N)),P.length>80*N){K=P[0],ne=P[1];let re=K,oe=ne;for(let pe=N;pe<V;pe+=N){let ve=P[pe],Oe=P[pe+1];ve<K&&(K=ve),Oe<ne&&(ne=Oe),ve>re&&(re=ve),Oe>oe&&(oe=Oe)}he=Math.max(re-K,oe-ne),he=he!==0?32767/he:0}return D_(Z,X,N,K,ne,he,0),X})(h,m),I=this._convertIndices(h,T);_=this._subdivideTrianglesScanline(I)}catch(T){console.error(T)}let y=[];return l&&(y=this._generateOutline(i)),this._ensureNoPoleVertices(),this._handlePoles(_),{verticesFlattened:this._vertexBuffer,indicesTriangles:_,indicesLineList:y}}_convertIndices(i,l){let h=[];for(let m=0;m<l.length;m++)h.push(this._vertexToIndex(i[2*l[m]],i[2*l[m]+1]));return h}_pointArrayToIndices(i){let l=[];for(let h=0;h<i.length;h++){let m=i[h];l.push(this._vertexToIndex(m.x,m.y))}return l}}function mA(c,i,l,h=!0){return new y3(l,i).subdividePolygonInternal(c,h)}function Kd(c,i,l=!1){if(!c||c.length<1)return[];if(c.length<2)return[];let h=c[0],m=c[c.length-1],_=l&&(h.x!==m.x||h.y!==m.y);if(i<2)return _?[...c,c[0]]:[...c];let y=Math.floor(ft/i),T=[];T.push(new f(c[0].x,c[0].y));let I=c.length,P=_?I:I-1;for(let O=0;O<P;O++){let N=c[O],j=O<I-1?c[O+1]:c[0],V=N.x,Z=N.y,X=j.x,K=j.y,ne=V!==X,he=Z!==K;if(!ne&&!he)continue;let re=X-V,oe=K-Z,pe=Math.abs(re),ve=Math.abs(oe),Oe=V,qe=Z;for(;;){let We=re>0?(Math.floor(Oe/y)+1)*y:(Math.ceil(Oe/y)-1)*y,ut=oe>0?(Math.floor(qe/y)+1)*y:(Math.ceil(qe/y)-1)*y,nt=Math.abs(Oe-We),$e=Math.abs(qe-ut),Ve=Math.abs(Oe-X),vt=Math.abs(qe-K),gt=ne?nt/pe:Number.POSITIVE_INFINITY,Tt=he?$e/ve:Number.POSITIVE_INFINITY;if((Ve<=nt||!ne)&&(vt<=$e||!he))break;if(gt<Tt&&ne||!he){Oe=We,qe+=oe*gt;let _t=new f(Oe,Math.round(qe));T[T.length-1].x===_t.x&&T[T.length-1].y===_t.y||T.push(_t)}else{Oe+=re*Tt,qe=ut;let _t=new f(Math.round(Oe),qe);T[T.length-1].x===_t.x&&T[T.length-1].y===_t.y||T.push(_t)}}let Ze=new f(X,K);T[T.length-1].x===Ze.x&&T[T.length-1].y===Ze.y||T.push(Ze)}return T}function v3(c,i,l){if(i.length===0)throw new Error("Subdivision vertex ring is empty.");let h=0,m=c[2*i[0]];for(let I=1;I<i.length;I++){let P=c[2*i[I]];P<m&&(m=P,h=I)}let _=i.length,y=h,T=(y+1)%_;for(;;){let I=y-1>=0?y-1:_-1,P=(T+1)%_,O=c[2*i[I]],N=c[2*i[P]],j=c[2*i[y]],V=c[2*i[y]+1],Z=c[2*i[T]+1],X=!1;if(O<N)X=!0;else if(O>N)X=!1;else{let K=Z-V,ne=-(c[2*i[T]]-j),he=V<Z?1:-1;((O-j)*K+(c[2*i[I]+1]-V)*ne)*he>((N-j)*K+(c[2*i[P]+1]-V)*ne)*he&&(X=!0)}if(X){let K=i[I],ne=i[y],he=i[T];K!==ne&&K!==he&&ne!==he&&l.push(he,ne,K),y--,y<0&&(y=_-1)}else{let K=i[P],ne=i[y],he=i[T];K!==ne&&K!==he&&ne!==he&&l.push(he,ne,K),T++,T>=_&&(T=0)}if(I===P)break}}function gA(c,i,l,h,m,_,y,T,I){let P=m.length/2,O=y&&T&&I;if(P<mt.MAX_VERTEX_ARRAY_LENGTH){let N=i.prepareSegment(P,l,h),j=N.vertexLength;for(let X=0;X<_.length;X+=3)h.emplaceBack(j+_[X],j+_[X+1],j+_[X+2]);let V,Z;N.vertexLength+=P,N.primitiveLength+=_.length/3,O&&(Z=y.prepareSegment(P,l,T),V=Z.vertexLength,Z.vertexLength+=P);for(let X=0;X<m.length;X+=2)c(m[X],m[X+1]);if(O)for(let X=0;X<I.length;X++){let K=I[X];for(let ne=1;ne<K.length;ne+=2)T.emplaceBack(V+K[ne-1],V+K[ne]);Z.primitiveLength+=K.length/2}}else(function(N,j,V,Z,X,K){let ne=[];for(let ve=0;ve<Z.length/2;ve++)ne.push(-1);let he={count:0},re=0,oe=N.getOrCreateLatestSegment(j,V),pe=oe.vertexLength;for(let ve=2;ve<X.length;ve+=3){let Oe=X[ve-2],qe=X[ve-1],Ze=X[ve],We=ne[Oe]<re,ut=ne[qe]<re,nt=ne[Ze]<re;oe.vertexLength+((We?1:0)+(ut?1:0)+(nt?1:0))>mt.MAX_VERTEX_ARRAY_LENGTH&&(oe=N.createNewSegment(j,V),re=he.count,We=!0,ut=!0,nt=!0,pe=0);let $e=L_(ne,Z,K,he,Oe,We,oe),Ve=L_(ne,Z,K,he,qe,ut,oe),vt=L_(ne,Z,K,he,Ze,nt,oe);V.emplaceBack(pe+$e-re,pe+Ve-re,pe+vt-re),oe.primitiveLength++}})(i,l,h,m,_,c),O&&(function(N,j,V,Z,X,K){let ne=[];for(let ve=0;ve<Z.length/2;ve++)ne.push(-1);let he={count:0},re=0,oe=N.getOrCreateLatestSegment(j,V),pe=oe.vertexLength;for(let ve=0;ve<X.length;ve++){let Oe=X[ve];for(let qe=1;qe<X[ve].length;qe+=2){let Ze=Oe[qe-1],We=Oe[qe],ut=ne[Ze]<re,nt=ne[We]<re;oe.vertexLength+((ut?1:0)+(nt?1:0))>mt.MAX_VERTEX_ARRAY_LENGTH&&(oe=N.createNewSegment(j,V),re=he.count,ut=!0,nt=!0,pe=0);let $e=L_(ne,Z,K,he,Ze,ut,oe),Ve=L_(ne,Z,K,he,We,nt,oe);V.emplaceBack(pe+$e-re,pe+Ve-re),oe.primitiveLength++}}})(y,l,T,m,I,c),i.forceNewSegmentOnNextPrepare(),y?.forceNewSegmentOnNextPrepare()}function L_(c,i,l,h,m,_,y){if(_){let T=h.count;return l(i[2*m],i[2*m+1]),c[m]=h.count,h.count++,y.vertexLength++,T}return c[m]}class pE{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new ae,this.indexArray=new Be,this.indexArray2=new lt,this.programConfigurations=new vu(i.layers,i.zoom),this.segments=new mt,this.segments2=new mt,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h){this.hasDependencies=T0("fill",this.layers,l);let m=this.layers[0].layout.get("fill-sort-key"),_=!m.isConstant(),y=[];for(let{feature:T,id:I,index:P,sourceLayerIndex:O}of i){let N=this.layers[0]._featureFilter.needGeometry,j=Cc(T,N);if(!this.layers[0]._featureFilter.filter(new ui(this.zoom),j,h))continue;let V=_?m.evaluate(j,{},h,l.availableImages):void 0,Z={id:I,properties:T.properties,type:T.type,sourceLayerIndex:O,index:P,geometry:N?j.geometry:Tc(T),patterns:{},sortKey:V};y.push(Z)}_&&y.sort((T,I)=>T.sortKey-I.sortKey);for(let T of y){let{geometry:I,index:P,sourceLayerIndex:O}=T;if(this.hasDependencies){let N=hE("fill",this.layers,T,{zoom:this.zoom},l);this.patternFeatures.push(N)}else this.addFeature(T,I,P,h,{},l.subdivisionGranularity);l.featureIndex.insert(i[P].feature,I,P,O,this.index)}}update(i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,{imagePositions:h})}addFeatures(i,l,h){for(let m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,l,h,i.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,l3),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,l,h,m,_,y){for(let T of lc(l,500)){let I=mA(T,m,y.fill.getGranularityForZoomLevel(m.z)),P=this.layoutVertexArray;gA((O,N)=>{P.emplaceBack(O,N)},this.segments,this.layoutVertexArray,this.indexArray,I.verticesFlattened,I.indicesTriangles,this.segments2,this.indexArray2,I.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,{imagePositions:_,canonical:m})}}let _A,yA;wt("FillBucket",pE,{omit:["layers","patternFeatures"]});var x3={get paint(){return yA=yA||new ko({"fill-antialias":new Lt(Te.paint_fill["fill-antialias"]),"fill-opacity":new zt(Te.paint_fill["fill-opacity"]),"fill-color":new zt(Te.paint_fill["fill-color"]),"fill-outline-color":new zt(Te.paint_fill["fill-outline-color"]),"fill-translate":new Lt(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new Lt(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ud(Te.paint_fill["fill-pattern"])})},get layout(){return _A=_A||new ko({"fill-sort-key":new zt(Te.layout_fill["fill-sort-key"])})}};class b3 extends Ps{constructor(i,l){super(i,x3,l)}recalculate(i,l){super.recalculate(i,l);let h=this.paint._values["fill-outline-color"];h.value.kind==="constant"&&h.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new pE(i)}queryRadius(){return w0(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:i,geometry:l,transform:h,pixelsToTileUnits:m}){return YP(E0(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-h.bearingInRadians,m),l)}isTileClipped(){return!0}}let w3=er([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),E3=er([{name:"a_centroid",components:2,type:"Int16"}],4),{members:T3}=w3;class O_{constructor(i,l,h,m,_){this.properties={},this.extent=h,this.type=0,this.id=void 0,this._pbf=i,this._geometry=-1,this._keys=m,this._values=_,i.readFields(C3,this,l)}loadGeometry(){let i=this._pbf;i.pos=this._geometry;let l=i.readVarint()+i.pos,h=[],m,_=1,y=0,T=0,I=0;for(;i.pos<l;){if(y<=0){let P=i.readVarint();_=7&P,y=P>>3}if(y--,_===1||_===2)T+=i.readSVarint(),I+=i.readSVarint(),_===1&&(m&&h.push(m),m=[]),m&&m.push(new f(T,I));else{if(_!==7)throw new Error(`unknown command ${_}`);m&&m.push(m[0].clone())}}return m&&h.push(m),h}bbox(){let i=this._pbf;i.pos=this._geometry;let l=i.readVarint()+i.pos,h=1,m=0,_=0,y=0,T=1/0,I=-1/0,P=1/0,O=-1/0;for(;i.pos<l;){if(m<=0){let N=i.readVarint();h=7&N,m=N>>3}if(m--,h===1||h===2)_+=i.readSVarint(),y+=i.readSVarint(),_<T&&(T=_),_>I&&(I=_),y<P&&(P=y),y>O&&(O=y);else if(h!==7)throw new Error(`unknown command ${h}`)}return[T,P,I,O]}toGeoJSON(i,l,h){let m=this.extent*Math.pow(2,h),_=this.extent*i,y=this.extent*l,T=this.loadGeometry();function I(j){return[360*(j.x+_)/m-180,360/Math.PI*Math.atan(Math.exp((1-2*(j.y+y)/m)*Math.PI))-90]}function P(j){return j.map(I)}let O;if(this.type===1){let j=[];for(let Z of T)j.push(Z[0]);let V=P(j);O=j.length===1?{type:"Point",coordinates:V[0]}:{type:"MultiPoint",coordinates:V}}else if(this.type===2){let j=T.map(P);O=j.length===1?{type:"LineString",coordinates:j[0]}:{type:"MultiLineString",coordinates:j}}else{if(this.type!==3)throw new Error("unknown feature type");{let j=vA(T),V=[];for(let Z of j)V.push(Z.map(P));O=V.length===1?{type:"Polygon",coordinates:V[0]}:{type:"MultiPolygon",coordinates:V}}}let N={type:"Feature",geometry:O,properties:this.properties};return this.id!=null&&(N.id=this.id),N}}function C3(c,i,l){c===1?i.id=l.readVarint():c===2?(function(h,m){let _=h.readVarint()+h.pos;for(;h.pos<_;){let y=m._keys[h.readVarint()],T=m._values[h.readVarint()];m.properties[y]=T}})(l,i):c===3?i.type=l.readVarint():c===4&&(i._geometry=l.pos)}function vA(c){let i=c.length;if(i<=1)return[c];let l=[],h,m;for(let _=0;_<i;_++){let y=I3(c[_]);y!==0&&(m===void 0&&(m=y<0),m===y<0?(h&&l.push(h),h=[c[_]]):h&&h.push(c[_]))}return h&&l.push(h),l}function I3(c){let i=0;for(let l,h,m=0,_=c.length,y=_-1;m<_;y=m++)l=c[m],h=c[y],i+=(h.x-l.x)*(l.y+h.y);return i}O_.types=["Unknown","Point","LineString","Polygon"];class S3{constructor(i,l){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(D3,this,l),this.length=this._features.length}feature(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];let l=this._pbf.readVarint()+this._pbf.pos;return new O_(this._pbf,l,this.extent,this._keys,this._values)}}function D3(c,i,l){c===15?i.version=l.readVarint():c===1?i.name=l.readString():c===5?i.extent=l.readVarint():c===2?i._features.push(l.pos):c===3?i._keys.push(l.readString()):c===4&&i._values.push((function(h){let m=null,_=h.readVarint()+h.pos;for(;h.pos<_;){let y=h.readVarint()>>3;m=y===1?h.readString():y===2?h.readFloat():y===3?h.readDouble():y===4?h.readVarint64():y===5?h.readVarint():y===6?h.readSVarint():y===7?h.readBoolean():null}if(m==null)throw new Error("unknown feature value");return m})(l))}class xA{constructor(i,l){this.layers=i.readFields(M3,{},l)}}function M3(c,i,l){if(c===3){let h=new S3(l,l.readVarint()+l.pos);h.length&&(i[h.name]=h)}}let mE=Math.pow(2,13);function k_(c,i,l,h,m,_,y,T){c.emplaceBack(i,l,2*Math.floor(h*mE)+y,m*mE*2,_*mE*2,Math.round(T))}class gE{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasDependencies=!1,this.layoutVertexArray=new fe,this.centroidVertexArray=new se,this.indexArray=new Be,this.programConfigurations=new vu(i.layers,i.zoom),this.segments=new mt,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h){this.features=[],this.hasDependencies=T0("fill-extrusion",this.layers,l);for(let{feature:m,id:_,index:y,sourceLayerIndex:T}of i){let I=this.layers[0]._featureFilter.needGeometry,P=Cc(m,I);if(!this.layers[0]._featureFilter.filter(new ui(this.zoom),P,h))continue;let O={id:_,sourceLayerIndex:T,index:y,geometry:I?P.geometry:Tc(m),properties:m.properties,type:m.type,patterns:{}};this.hasDependencies?this.features.push(hE("fill-extrusion",this.layers,O,{zoom:this.zoom},l)):this.addFeature(O,O.geometry,y,h,{},l.subdivisionGranularity),l.featureIndex.insert(m,O.geometry,y,T,this.index,!0)}}addFeatures(i,l,h){for(let m of this.features){let{geometry:_}=m;this.addFeature(m,_,m.index,l,h,i.subdivisionGranularity)}}update(i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,{imagePositions:h})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,T3),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,E3.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,l,h,m,_,y){for(let T of lc(l,500)){let I={x:0,y:0,sampleCount:0},P=this.layoutVertexArray.length;this.processPolygon(I,m,i,T,y);let O=this.layoutVertexArray.length-P,N=Math.floor(I.x/I.sampleCount),j=Math.floor(I.y/I.sampleCount);for(let V=0;V<O;V++)this.centroidVertexArray.emplaceBack(N,j)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,{imagePositions:_,canonical:m})}processPolygon(i,l,h,m,_){if(m.length<1||bA(m[0]))return;for(let N of m)N.length!==0&&P3(i,N);let y={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},T=_.fill.getGranularityForZoomLevel(l.z),I=O_.types[h.type]==="Polygon";for(let N of m){if(N.length===0||bA(N))continue;let j=Kd(N,T,I);this._generateSideFaces(j,y)}if(!I)return;let P=mA(m,l,T,!1),O=this.layoutVertexArray;gA((N,j)=>{k_(O,N,j,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,P.verticesFlattened,P.indicesTriangles)}_generateSideFaces(i,l){let h=0;for(let m=1;m<i.length;m++){let _=i[m],y=i[m-1];if(A3(_,y))continue;l.segment.vertexLength+4>mt.MAX_VERTEX_ARRAY_LENGTH&&(l.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let T=_.sub(y)._perp()._unit(),I=y.dist(_);h+I>32768&&(h=0),k_(this.layoutVertexArray,_.x,_.y,T.x,T.y,0,0,h),k_(this.layoutVertexArray,_.x,_.y,T.x,T.y,0,1,h),h+=I,k_(this.layoutVertexArray,y.x,y.y,T.x,T.y,0,0,h),k_(this.layoutVertexArray,y.x,y.y,T.x,T.y,0,1,h);let P=l.segment.vertexLength;this.indexArray.emplaceBack(P,P+2,P+1),this.indexArray.emplaceBack(P+1,P+2,P+3),l.segment.vertexLength+=4,l.segment.primitiveLength+=2}}}function P3(c,i){for(let l=0;l<i.length;l++){let h=i[l];l===i.length-1&&i[0].x===h.x&&i[0].y===h.y||(c.x+=h.x,c.y+=h.y,c.sampleCount++)}}function A3(c,i){return c.x===i.x&&(c.x<0||c.x>ft)||c.y===i.y&&(c.y<0||c.y>ft)}function bA(c){return c.every(i=>i.x<0)||c.every(i=>i.x>ft)||c.every(i=>i.y<0)||c.every(i=>i.y>ft)}let wA;wt("FillExtrusionBucket",gE,{omit:["layers","features"]});var R3={get paint(){return wA=wA||new ko({"fill-extrusion-opacity":new Lt(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new zt(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Lt(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Lt(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ud(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new zt(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new zt(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Lt(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class L3 extends Ps{constructor(i,l){super(i,R3,l)}createBucket(i){return new gE(i)}queryRadius(){return w0(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:i,feature:l,featureState:h,geometry:m,transform:_,pixelsToTileUnits:y,pixelPosMatrix:T}){let I=E0(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-_.bearingInRadians,y),P=this.paint.get("fill-extrusion-height").evaluate(l,h),O=this.paint.get("fill-extrusion-base").evaluate(l,h),N=(function(V,Z){let X=[];for(let K of V){let ne=[K.x,K.y,0,1];Pt(ne,ne,Z),X.push(new f(ne[0]/ne[3],ne[1]/ne[3]))}return X})(I,T),j=(function(V,Z,X,K){let ne=[],he=[],re=K[8]*Z,oe=K[9]*Z,pe=K[10]*Z,ve=K[11]*Z,Oe=K[8]*X,qe=K[9]*X,Ze=K[10]*X,We=K[11]*X;for(let ut of V){let nt=[],$e=[];for(let Ve of ut){let vt=Ve.x,gt=Ve.y,Tt=K[0]*vt+K[4]*gt+K[12],_t=K[1]*vt+K[5]*gt+K[13],kt=K[2]*vt+K[6]*gt+K[14],Nn=K[3]*vt+K[7]*gt+K[15],En=kt+pe,Oi=Nn+ve,po=Tt+Oe,dr=_t+qe,ki=kt+Ze,Si=Nn+We,Jn=new f((Tt+re)/Oi,(_t+oe)/Oi);Jn.z=En/Oi,nt.push(Jn);let Ki=new f(po/Si,dr/Si);Ki.z=ki/Si,$e.push(Ki)}ne.push(nt),he.push($e)}return[ne,he]})(m,O,P,T);return(function(V,Z,X){let K=1/0;YP(X,Z)&&(K=EA(X,Z[0]));for(let ne=0;ne<Z.length;ne++){let he=Z[ne],re=V[ne];for(let oe=0;oe<he.length-1;oe++){let pe=he[oe],ve=[pe,he[oe+1],re[oe+1],re[oe],pe];qp(X,ve)&&(K=Math.min(K,EA(X,ve)))}}return K!==1/0&&K})(j[0],j[1],N)}}function F_(c,i){return c.x*i.x+c.y*i.y}function EA(c,i){if(c.length===1){let l=0,h=i[l++],m;for(;!m||h.equals(m);)if(m=i[l++],!m)return 1/0;for(;l<i.length;l++){let _=i[l],y=c[0],T=m.sub(h),I=_.sub(h),P=y.sub(h),O=F_(T,T),N=F_(T,I),j=F_(I,I),V=F_(P,T),Z=F_(P,I),X=O*j-N*N,K=(j*V-N*Z)/X,ne=(O*Z-N*V)/X,he=h.z*(1-K-ne)+m.z*K+_.z*ne;if(isFinite(he))return he}return 1/0}{let l=1/0;for(let h of i)l=Math.min(l,h.z);return l}}let O3=er([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:k3}=O3,F3=er([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:N3}=F3,z3=Math.cos(Math.PI/180*37.5),TA=Math.pow(2,14)/.5;class _E{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new xe,this.layoutVertexArray2=new de,this.indexArray=new Be,this.programConfigurations=new vu(i.layers,i.zoom),this.segments=new mt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h){this.hasDependencies=T0("line",this.layers,l)||this.hasLineDasharray(this.layers);let m=this.layers[0].layout.get("line-sort-key"),_=!m.isConstant(),y=[];for(let{feature:T,id:I,index:P,sourceLayerIndex:O}of i){let N=this.layers[0]._featureFilter.needGeometry,j=Cc(T,N);if(!this.layers[0]._featureFilter.filter(new ui(this.zoom),j,h))continue;let V=_?m.evaluate(j,{},h):void 0,Z={id:I,properties:T.properties,type:T.type,sourceLayerIndex:O,index:P,geometry:N?j.geometry:Tc(T),patterns:{},dashes:{},sortKey:V};y.push(Z)}_&&y.sort((T,I)=>T.sortKey-I.sortKey);for(let T of y){let{geometry:I,index:P,sourceLayerIndex:O}=T;this.hasDependencies?(T0("line",this.layers,l)?hE("line",this.layers,T,{zoom:this.zoom},l):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,T,this.zoom,l),this.patternFeatures.push(T)):this.addFeature(T,I,P,h,{},{},l.subdivisionGranularity),l.featureIndex.insert(i[P].feature,I,P,O,this.index)}}update(i,l,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,{imagePositions:h,dashPositions:m})}addFeatures(i,l,h,m){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,l,h,m,i.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,N3)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,k3),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,l,h,m,_,y,T){let I=this.layers[0].layout,P=I.get("line-join").evaluate(i,{}),O=I.get("line-cap"),N=I.get("line-miter-limit"),j=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(let V of l)this.addLine(V,i,P,O,N,j,m,T);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,{imagePositions:_,dashPositions:y,canonical:m})}addLine(i,l,h,m,_,y,T,I){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,i=Kd(i,T?I.line.getGranularityForZoomLevel(T.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let re=0;re<i.length-1;re++)this.totalDistance+=i[re].dist(i[re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let P=O_.types[l.type]==="Polygon",O=i.length;for(;O>=2&&i[O-1].equals(i[O-2]);)O--;let N=0;for(;N<O-1&&i[N].equals(i[N+1]);)N++;if(O<(P?3:2))return;h==="bevel"&&(_=1.05);let j=this.overscaling<=16?122880/(512*this.overscaling):0,V=this.segments.prepareSegment(10*O,this.layoutVertexArray,this.indexArray),Z,X,K,ne,he;this.e1=this.e2=-1,P&&(Z=i[O-2],he=i[N].sub(Z)._unit()._perp());for(let re=N;re<O;re++){if(K=re===O-1?P?i[N+1]:void 0:i[re+1],K&&i[re].equals(K))continue;he&&(ne=he),Z&&(X=Z),Z=i[re],he=K?K.sub(Z)._unit()._perp():ne,ne=ne||he;let oe=ne.add(he);oe.x===0&&oe.y===0||oe._unit();let pe=ne.x*he.x+ne.y*he.y,ve=oe.x*he.x+oe.y*he.y,Oe=ve!==0?1/ve:1/0,qe=2*Math.sqrt(2-2*ve),Ze=ve<z3&&X&&K,We=ne.x*he.y-ne.y*he.x>0;if(Ze&&re>N){let $e=Z.dist(X);if($e>2*j){let Ve=Z.sub(Z.sub(X)._mult(j/$e)._round());this.updateDistance(X,Ve),this.addCurrentVertex(Ve,ne,0,0,V),X=Ve}}let ut=X&&K,nt=ut?h:P?"butt":m;if(ut&&nt==="round"&&(Oe<y?nt="miter":Oe<=2&&(nt="fakeround")),nt==="miter"&&Oe>_&&(nt="bevel"),nt==="bevel"&&(Oe>2&&(nt="flipbevel"),Oe<_&&(nt="miter")),X&&this.updateDistance(X,Z),nt==="miter")oe._mult(Oe),this.addCurrentVertex(Z,oe,0,0,V);else if(nt==="flipbevel"){if(Oe>100)oe=he.mult(-1);else{let $e=Oe*ne.add(he).mag()/ne.sub(he).mag();oe._perp()._mult($e*(We?-1:1))}this.addCurrentVertex(Z,oe,0,0,V),this.addCurrentVertex(Z,oe.mult(-1),0,0,V)}else if(nt==="bevel"||nt==="fakeround"){let $e=-Math.sqrt(Oe*Oe-1),Ve=We?$e:0,vt=We?0:$e;if(X&&this.addCurrentVertex(Z,ne,Ve,vt,V),nt==="fakeround"){let gt=Math.round(180*qe/Math.PI/20);for(let Tt=1;Tt<gt;Tt++){let _t=Tt/gt;if(_t!==.5){let Nn=_t-.5;_t+=_t*Nn*(_t-1)*((1.0904+pe*(pe*(3.55645-1.43519*pe)-3.2452))*Nn*Nn+(.848013+pe*(.215638*pe-1.06021)))}let kt=he.sub(ne)._mult(_t)._add(ne)._unit()._mult(We?-1:1);this.addHalfVertex(Z,kt.x,kt.y,!1,We,0,V)}}K&&this.addCurrentVertex(Z,he,-Ve,-vt,V)}else if(nt==="butt")this.addCurrentVertex(Z,oe,0,0,V);else if(nt==="square"){let $e=X?1:-1;this.addCurrentVertex(Z,oe,$e,$e,V)}else nt==="round"&&(X&&(this.addCurrentVertex(Z,ne,0,0,V),this.addCurrentVertex(Z,ne,1,1,V,!0)),K&&(this.addCurrentVertex(Z,he,-1,-1,V,!0),this.addCurrentVertex(Z,he,0,0,V)));if(Ze&&re<O-1){let $e=Z.dist(K);if($e>2*j){let Ve=Z.add(K.sub(Z)._mult(j/$e)._round());this.updateDistance(Z,Ve),this.addCurrentVertex(Ve,he,0,0,V),Z=Ve}}}}addCurrentVertex(i,l,h,m,_,y=!1){let T=l.y*m-l.x,I=-l.y-l.x*m;this.addHalfVertex(i,l.x+l.y*h,l.y-l.x*h,y,!1,h,_),this.addHalfVertex(i,T,I,y,!0,-m,_),this.distance>TA/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,l,h,m,_,y))}addHalfVertex({x:i,y:l},h,m,_,y,T,I){let P=.5*(this.lineClips?this.scaledDistance*(TA-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(_?1:0),(l<<1)+(y?1:0),Math.round(63*h)+128,Math.round(63*m)+128,1+(T===0?0:T<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let O=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,O,this.e2),I.primitiveLength++),y?this.e2=O:this.e1=O}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,l){this.distance+=i.dist(l),this.updateScaledDistance()}hasLineDasharray(i){for(let l of i){let h=l.paint.get("line-dasharray");if(h&&!h.isConstant())return!0}return!1}addLineDashDependencies(i,l,h,m){for(let _ of i){let y=_.paint.get("line-dasharray");if(!y||y.value.kind==="constant")continue;let T=_.layout.get("line-cap")==="round",I={dasharray:y.value.evaluate({zoom:h-1},l,{}),round:T},P={dasharray:y.value.evaluate({zoom:h},l,{}),round:T},O={dasharray:y.value.evaluate({zoom:h+1},l,{}),round:T},N=`${I.dasharray.join(",")},${I.round}`,j=`${P.dasharray.join(",")},${P.round}`,V=`${O.dasharray.join(",")},${O.round}`;m.dashDependencies[N]=I,m.dashDependencies[j]=P,m.dashDependencies[V]=O,l.dashes[_.id]={min:N,mid:j,max:V}}}}let CA,IA;wt("LineBucket",_E,{omit:["layers","patternFeatures"]});var SA={get paint(){return IA=IA||new ko({"line-opacity":new zt(Te.paint_line["line-opacity"]),"line-color":new zt(Te.paint_line["line-color"]),"line-translate":new Lt(Te.paint_line["line-translate"]),"line-translate-anchor":new Lt(Te.paint_line["line-translate-anchor"]),"line-width":new zt(Te.paint_line["line-width"]),"line-gap-width":new zt(Te.paint_line["line-gap-width"]),"line-offset":new zt(Te.paint_line["line-offset"]),"line-blur":new zt(Te.paint_line["line-blur"]),"line-dasharray":new Ud(Te.paint_line["line-dasharray"]),"line-pattern":new Ud(Te.paint_line["line-pattern"]),"line-gradient":new Bp(Te.paint_line["line-gradient"])})},get layout(){return CA=CA||new ko({"line-cap":new Lt(Te.layout_line["line-cap"]),"line-join":new zt(Te.layout_line["line-join"]),"line-miter-limit":new Lt(Te.layout_line["line-miter-limit"]),"line-round-limit":new Lt(Te.layout_line["line-round-limit"]),"line-sort-key":new zt(Te.layout_line["line-sort-key"])})}};class B3 extends zt{possiblyEvaluate(i,l){return l=new ui(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(i,l)}evaluate(i,l,h,m){return l=kn({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(i,l,h,m)}}let D0;class j3 extends Ps{constructor(i,l){super(i,SA,l),this.gradientVersion=0,D0||(D0=new B3(SA.paint.properties["line-width"].specification),D0.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){let l=this.gradientExpression();this.stepInterpolant=!!(function(h){return h._styleExpression!==void 0})(l)&&l._styleExpression.expression instanceof Ba,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,l){super.recalculate(i,l),this.paint._values["line-floorwidth"]=D0.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new _E(i)}queryRadius(i){let l=i,h=DA(Xp("line-width",this,l),Xp("line-gap-width",this,l)),m=Xp("line-offset",this,l);return h/2+Math.abs(m)+w0(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:i,feature:l,featureState:h,geometry:m,transform:_,pixelsToTileUnits:y}){let T=E0(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-_.bearingInRadians,y),I=y/2*DA(this.paint.get("line-width").evaluate(l,h),this.paint.get("line-gap-width").evaluate(l,h)),P=this.paint.get("line-offset").evaluate(l,h);return P&&(m=(function(O,N){let j=[];for(let V=0;V<O.length;V++){let Z=Wj(O[V]),X=[];for(let K=0;K<Z.length;K++){let ne=Z[K],he=Z[K-1],re=Z[K+1],oe=K===0?new f(0,0):ne.sub(he)._unit()._perp(),pe=K===Z.length-1?new f(0,0):re.sub(ne)._unit()._perp(),ve=oe._add(pe)._unit(),Oe=ve.x*pe.x+ve.y*pe.y;Oe!==0&&ve._mult(1/Oe),X.push(ve._mult(N)._add(ne))}j.push(X)}return j})(m,P*y)),(function(O,N,j){for(let V=0;V<N.length;V++){let Z=N[V];if(O.length>=3){for(let X=0;X<Z.length;X++)if(Wp(O,Z[X]))return!0}if(Hj(O,Z,j))return!0}return!1})(T,m,I)}isTileClipped(){return!0}}function DA(c,i){return i>0?i+2*c:c}let V3=er([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),U3=er([{name:"a_projected_pos",components:3,type:"Float32"}],4);er([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let G3=er([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);er([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let MA=er([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$3=er([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function H3(c,i,l){return c.sections.forEach(h=>{h.text=(function(m,_,y){let T=_.layout.get("text-transform").evaluate(y,{});return T==="uppercase"?m=m.toLocaleUpperCase():T==="lowercase"&&(m=m.toLocaleLowerCase()),bc.applyArabicShaping&&(m=bc.applyArabicShaping(m)),m})(h.text,i,l)}),c}er([{name:"triangle",components:3,type:"Uint16"}]),er([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),er([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),er([{type:"Float32",name:"offsetX"}]),er([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),er([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Pr=24;let N_={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u22EF":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Z3={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},q3={40:!0};function PA(c,i,l,h,m,_){if("fontStack"in i){let y=l[i.fontStack],T=y&&y[c];return T?T.metrics.advance*i.scale+m:0}{let y=h[i.imageName];return y?y.displaySize[0]*i.scale*Pr/_+m:0}}function AA(c,i,l,h){let m=Math.pow(c-i,2);return h?c<i?m/2:2*m:m+Math.abs(l)*l}function W3(c,i,l){let h=0;return c===10&&(h-=1e4),l&&(h+=150),c!==40&&c!==65288||(h+=50),i!==41&&i!==65289||(h+=50),h}function RA(c,i,l,h,m,_){let y=null,T=AA(i,l,m,_);for(let I of h){let P=AA(i-I.x,l,m,_)+I.badness;P<=T&&(y=I,T=P)}return{index:c,x:i,priorBreak:y,badness:T}}function LA(c){return c?LA(c.priorBreak).concat(c.index):[]}class Qp{constructor(i="",l=[],h=[]){this.text=i,this.sections=l,this.sectionIndex=h,this.imageSectionID=null}static fromFeature(i,l){let h=new Qp;for(let m=0;m<i.sections.length;m++){let _=i.sections[m];_.image?h.addImageSection(_):h.addTextSection(_,l)}return h}length(){return[...this.text].length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}verticalizePunctuation(){this.text=(function(i){let l="",h={premature:!0,value:void 0},m=i[Symbol.iterator](),_=m.next(),y=i[Symbol.iterator]();y.next();let T=y.next();for(;!_.done;)l+=!T.done&&f_(T.value.codePointAt(0))&&!N_[T.value]||!h.premature&&f_(h.value.codePointAt(0))&&!N_[h.value]||!N_[_.value]?_.value:N_[_.value],h={value:_.value,premature:!1},_=m.next(),T=y.next();return l})(this.text)}hasZeroWidthSpaces(){return this.text.includes("\u200B")}trim(){let i=this.text.match(/^\s*/),l=i?i[0].length:0,h=this.text.match(/\S\s*$/),m=h?h[0].length-1:0;this.text=this.text.substring(l,this.text.length-m),this.sectionIndex=this.sectionIndex.slice(l,this.sectionIndex.length-m)}substring(i,l){let h=[...this.text].slice(i,l).join(""),m=this.sectionIndex.slice(i,l);return new Qp(h,this.sections,m)}toCodeUnitIndex(i){return[...this.text].slice(0,i).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,l)=>Math.max(i,this.sections[l].scale),0)}getMaxImageSize(i){let l=0,h=0;for(let m=0;m<this.length();m++){let _=this.getSection(m);if("imageName"in _){let y=i[_.imageName];if(!y)continue;let T=y.displaySize;l=Math.max(l,T[0]),h=Math.max(h,T[1])}}return{maxImageWidth:l,maxImageHeight:h}}addTextSection(i,l){this.text+=i.text,this.sections.push({scale:i.scale||1,verticalAlign:i.verticalAlign||"bottom",fontStack:i.fontStack||l});let h=this.sections.length-1;this.sectionIndex.push(...[...i.text].map(()=>h))}addImageSection(i){let l=i.image?i.image.name:"";if(l.length===0)return void zi("Can't add FormattedSection with an empty image.");let h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push({scale:1,verticalAlign:i.verticalAlign||"bottom",imageName:l}),this.sectionIndex.push(this.sections.length-1)):zi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(i,l,h,m,_){let y=[],T=this.determineAverageLineWidth(i,l,h,m,_),I=this.hasZeroWidthSpaces(),P=0,O=0,N=this.text[Symbol.iterator](),j=N.next(),V=this.text[Symbol.iterator]();V.next();let Z=V.next(),X=this.text[Symbol.iterator]();X.next(),X.next();let K=X.next();for(;!j.done;){let ne=this.getSection(O),he=j.value.codePointAt(0);if(u0(he)||(P+=PA(he,ne,h,m,i,_)),!Z.done){let re=Bd(he),oe=Z.value.codePointAt(0);(Z3[he]||re||"imageName"in ne||!K.done&&q3[oe])&&y.push(RA(O+1,P,T,y,W3(he,oe,re&&I),!1))}O++,j=N.next(),Z=V.next(),K=X.next()}return LA(RA(this.length(),P,T,y,0,!0))}determineAverageLineWidth(i,l,h,m,_){let y=0,T=0;for(let I of this.text){let P=this.getSection(T);y+=PA(I.codePointAt(0),P,h,m,i,_),T++}return y/Math.max(1,Math.ceil(y/l))}}let yE=4294967296,OA=1/yE,kA=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class M0{constructor(i=new Uint8Array(16)){this.buf=ArrayBuffer.isView(i)?i:new Uint8Array(i),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(i,l,h=this.length){for(;this.pos<h;){let m=this.readVarint(),_=m>>3,y=this.pos;this.type=7&m,i(_,l,this),this.pos===y&&this.skip(m)}return l}readMessage(i,l){return this.readFields(i,l,this.readVarint()+this.pos)}readFixed32(){let i=this.dataView.getUint32(this.pos,!0);return this.pos+=4,i}readSFixed32(){let i=this.dataView.getInt32(this.pos,!0);return this.pos+=4,i}readFixed64(){let i=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*yE;return this.pos+=8,i}readSFixed64(){let i=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*yE;return this.pos+=8,i}readFloat(){let i=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,i}readDouble(){let i=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,i}readVarint(i){let l=this.buf,h,m;return m=l[this.pos++],h=127&m,m<128?h:(m=l[this.pos++],h|=(127&m)<<7,m<128?h:(m=l[this.pos++],h|=(127&m)<<14,m<128?h:(m=l[this.pos++],h|=(127&m)<<21,m<128?h:(m=l[this.pos],h|=(15&m)<<28,(function(_,y,T){let I=T.buf,P,O;if(O=I[T.pos++],P=(112&O)>>4,O<128||(O=I[T.pos++],P|=(127&O)<<3,O<128)||(O=I[T.pos++],P|=(127&O)<<10,O<128)||(O=I[T.pos++],P|=(127&O)<<17,O<128)||(O=I[T.pos++],P|=(127&O)<<24,O<128)||(O=I[T.pos++],P|=(1&O)<<31,O<128))return em(_,P,y);throw new Error("Expected varint not more than 10 bytes")})(h,i,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){let i=this.readVarint();return i%2==1?(i+1)/-2:i/2}readBoolean(){return!!this.readVarint()}readString(){let i=this.readVarint()+this.pos,l=this.pos;return this.pos=i,i-l>=12&&kA?kA.decode(this.buf.subarray(l,i)):(function(h,m,_){let y="",T=m;for(;T<_;){let I=h[T],P,O,N,j=null,V=I>239?4:I>223?3:I>191?2:1;if(T+V>_)break;V===1?I<128&&(j=I):V===2?(P=h[T+1],(192&P)==128&&(j=(31&I)<<6|63&P,j<=127&&(j=null))):V===3?(P=h[T+1],O=h[T+2],(192&P)==128&&(192&O)==128&&(j=(15&I)<<12|(63&P)<<6|63&O,(j<=2047||j>=55296&&j<=57343)&&(j=null))):V===4&&(P=h[T+1],O=h[T+2],N=h[T+3],(192&P)==128&&(192&O)==128&&(192&N)==128&&(j=(15&I)<<18|(63&P)<<12|(63&O)<<6|63&N,(j<=65535||j>=1114112)&&(j=null))),j===null?(j=65533,V=1):j>65535&&(j-=65536,y+=String.fromCharCode(j>>>10&1023|55296),j=56320|1023&j),y+=String.fromCharCode(j),T+=V}return y})(this.buf,l,i)}readBytes(){let i=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,i);return this.pos=i,l}readPackedVarint(i=[],l){let h=this.readPackedEnd();for(;this.pos<h;)i.push(this.readVarint(l));return i}readPackedSVarint(i=[]){let l=this.readPackedEnd();for(;this.pos<l;)i.push(this.readSVarint());return i}readPackedBoolean(i=[]){let l=this.readPackedEnd();for(;this.pos<l;)i.push(this.readBoolean());return i}readPackedFloat(i=[]){let l=this.readPackedEnd();for(;this.pos<l;)i.push(this.readFloat());return i}readPackedDouble(i=[]){let l=this.readPackedEnd();for(;this.pos<l;)i.push(this.readDouble());return i}readPackedFixed32(i=[]){let l=this.readPackedEnd();for(;this.pos<l;)i.push(this.readFixed32());return i}readPackedSFixed32(i=[]){let l=this.readPackedEnd();for(;this.pos<l;)i.push(this.readSFixed32());return i}readPackedFixed64(i=[]){let l=this.readPackedEnd();for(;this.pos<l;)i.push(this.readFixed64());return i}readPackedSFixed64(i=[]){let l=this.readPackedEnd();for(;this.pos<l;)i.push(this.readSFixed64());return i}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(i){let l=7&i;if(l===0)for(;this.buf[this.pos++]>127;);else if(l===2)this.pos=this.readVarint()+this.pos;else if(l===5)this.pos+=4;else{if(l!==1)throw new Error(`Unimplemented type: ${l}`);this.pos+=8}}writeTag(i,l){this.writeVarint(i<<3|l)}realloc(i){let l=this.length||16;for(;l<this.pos+i;)l*=2;if(l!==this.length){let h=new Uint8Array(l);h.set(this.buf),this.buf=h,this.dataView=new DataView(h.buffer),this.length=l}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(i){this.realloc(4),this.dataView.setInt32(this.pos,i,!0),this.pos+=4}writeSFixed32(i){this.realloc(4),this.dataView.setInt32(this.pos,i,!0),this.pos+=4}writeFixed64(i){this.realloc(8),this.dataView.setInt32(this.pos,-1&i,!0),this.dataView.setInt32(this.pos+4,Math.floor(i*OA),!0),this.pos+=8}writeSFixed64(i){this.realloc(8),this.dataView.setInt32(this.pos,-1&i,!0),this.dataView.setInt32(this.pos+4,Math.floor(i*OA),!0),this.pos+=8}writeVarint(i){(i=+i||0)>268435455||i<0?(function(l,h){let m,_;if(l>=0?(m=l%4294967296|0,_=l/4294967296|0):(m=~(-l%4294967296),_=~(-l/4294967296),4294967295^m?m=m+1|0:(m=0,_=_+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),(function(y,T,I){I.buf[I.pos++]=127&y|128,y>>>=7,I.buf[I.pos++]=127&y|128,y>>>=7,I.buf[I.pos++]=127&y|128,y>>>=7,I.buf[I.pos++]=127&y|128,I.buf[I.pos]=127&(y>>>=7)})(m,0,h),(function(y,T){let I=(7&y)<<4;T.buf[T.pos++]|=I|((y>>>=3)?128:0),y&&(T.buf[T.pos++]=127&y|((y>>>=7)?128:0),y&&(T.buf[T.pos++]=127&y|((y>>>=7)?128:0),y&&(T.buf[T.pos++]=127&y|((y>>>=7)?128:0),y&&(T.buf[T.pos++]=127&y|((y>>>=7)?128:0),y&&(T.buf[T.pos++]=127&y)))))})(_,h)})(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))}writeSVarint(i){this.writeVarint(i<0?2*-i-1:2*i)}writeBoolean(i){this.writeVarint(+i)}writeString(i){i=String(i),this.realloc(4*i.length),this.pos++;let l=this.pos;this.pos=(function(m,_,y){for(let T,I,P=0;P<_.length;P++){if(T=_.charCodeAt(P),T>55295&&T<57344){if(!I){T>56319||P+1===_.length?(m[y++]=239,m[y++]=191,m[y++]=189):I=T;continue}if(T<56320){m[y++]=239,m[y++]=191,m[y++]=189,I=T;continue}T=I-55296<<10|T-56320|65536,I=null}else I&&(m[y++]=239,m[y++]=191,m[y++]=189,I=null);T<128?m[y++]=T:(T<2048?m[y++]=T>>6|192:(T<65536?m[y++]=T>>12|224:(m[y++]=T>>18|240,m[y++]=T>>12&63|128),m[y++]=T>>6&63|128),m[y++]=63&T|128)}return y})(this.buf,i,this.pos);let h=this.pos-l;h>=128&&FA(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h}writeFloat(i){this.realloc(4),this.dataView.setFloat32(this.pos,i,!0),this.pos+=4}writeDouble(i){this.realloc(8),this.dataView.setFloat64(this.pos,i,!0),this.pos+=8}writeBytes(i){let l=i.length;this.writeVarint(l),this.realloc(l);for(let h=0;h<l;h++)this.buf[this.pos++]=i[h]}writeRawMessage(i,l){this.pos++;let h=this.pos;i(l,this);let m=this.pos-h;m>=128&&FA(h,m,this),this.pos=h-1,this.writeVarint(m),this.pos+=m}writeMessage(i,l,h){this.writeTag(i,2),this.writeRawMessage(l,h)}writePackedVarint(i,l){l.length&&this.writeMessage(i,X3,l)}writePackedSVarint(i,l){l.length&&this.writeMessage(i,Y3,l)}writePackedBoolean(i,l){l.length&&this.writeMessage(i,Q3,l)}writePackedFloat(i,l){l.length&&this.writeMessage(i,K3,l)}writePackedDouble(i,l){l.length&&this.writeMessage(i,J3,l)}writePackedFixed32(i,l){l.length&&this.writeMessage(i,eV,l)}writePackedSFixed32(i,l){l.length&&this.writeMessage(i,tV,l)}writePackedFixed64(i,l){l.length&&this.writeMessage(i,nV,l)}writePackedSFixed64(i,l){l.length&&this.writeMessage(i,iV,l)}writeBytesField(i,l){this.writeTag(i,2),this.writeBytes(l)}writeFixed32Field(i,l){this.writeTag(i,5),this.writeFixed32(l)}writeSFixed32Field(i,l){this.writeTag(i,5),this.writeSFixed32(l)}writeFixed64Field(i,l){this.writeTag(i,1),this.writeFixed64(l)}writeSFixed64Field(i,l){this.writeTag(i,1),this.writeSFixed64(l)}writeVarintField(i,l){this.writeTag(i,0),this.writeVarint(l)}writeSVarintField(i,l){this.writeTag(i,0),this.writeSVarint(l)}writeStringField(i,l){this.writeTag(i,2),this.writeString(l)}writeFloatField(i,l){this.writeTag(i,5),this.writeFloat(l)}writeDoubleField(i,l){this.writeTag(i,1),this.writeDouble(l)}writeBooleanField(i,l){this.writeVarintField(i,+l)}}function em(c,i,l){return l?4294967296*i+(c>>>0):4294967296*(i>>>0)+(c>>>0)}function FA(c,i,l){let h=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));l.realloc(h);for(let m=l.pos-1;m>=c;m--)l.buf[m+h]=l.buf[m]}function X3(c,i){for(let l=0;l<c.length;l++)i.writeVarint(c[l])}function Y3(c,i){for(let l=0;l<c.length;l++)i.writeSVarint(c[l])}function K3(c,i){for(let l=0;l<c.length;l++)i.writeFloat(c[l])}function J3(c,i){for(let l=0;l<c.length;l++)i.writeDouble(c[l])}function Q3(c,i){for(let l=0;l<c.length;l++)i.writeBoolean(c[l])}function eV(c,i){for(let l=0;l<c.length;l++)i.writeFixed32(c[l])}function tV(c,i){for(let l=0;l<c.length;l++)i.writeSFixed32(c[l])}function nV(c,i){for(let l=0;l<c.length;l++)i.writeFixed64(c[l])}function iV(c,i){for(let l=0;l<c.length;l++)i.writeSFixed64(c[l])}function rV(c,i,l){c===1&&l.readMessage(oV,i)}function oV(c,i,l){if(c===3){let{id:h,bitmap:m,width:_,height:y,left:T,top:I,advance:P}=l.readMessage(sV,{});i.push({id:h,bitmap:new S_({width:_+6,height:y+6},m),metrics:{width:_,height:y,left:T,top:I,advance:P}})}}function sV(c,i,l){c===1?i.id=l.readVarint():c===2?i.bitmap=l.readBytes():c===3?i.width=l.readVarint():c===4?i.height=l.readVarint():c===5?i.left=l.readSVarint():c===6?i.top=l.readSVarint():c===7&&(i.advance=l.readVarint())}function NA(c){let i=0,l=0;for(let y of c)i+=y.w*y.h,l=Math.max(l,y.w);c.sort((y,T)=>T.h-y.h);let h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),l),h:1/0}],m=0,_=0;for(let y of c)for(let T=h.length-1;T>=0;T--){let I=h[T];if(!(y.w>I.w||y.h>I.h)){if(y.x=I.x,y.y=I.y,_=Math.max(_,y.y+y.h),m=Math.max(m,y.x+y.w),y.w===I.w&&y.h===I.h){let P=h.pop();P&&T<h.length&&(h[T]=P)}else y.h===I.h?(I.x+=y.w,I.w-=y.w):y.w===I.w?(I.y+=y.h,I.h-=y.h):(h.push({x:I.x+y.w,y:I.y,w:I.w-y.w,h:y.h}),I.y+=y.h,I.h-=y.h);break}}return{w:m,h:_,fill:i/(m*_)||0}}class vE{constructor(i,{pixelRatio:l,version:h,stretchX:m,stretchY:_,content:y,textFitWidth:T,textFitHeight:I}){this.paddedRect=i,this.pixelRatio=l,this.stretchX=m,this.stretchY=_,this.content=y,this.version=h,this.textFitWidth=T,this.textFitHeight=I}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class zA{constructor(i,l){let h={},m={};this.haveRenderCallbacks=[];let _=[];this.addImages(i,h,_),this.addImages(l,m,_);let{w:y,h:T}=NA(_),I=new ps({width:y||1,height:T||1});for(let P in i){let O=i[P],N=h[P].paddedRect;ps.copy(O.data,I,{x:0,y:0},{x:N.x+1,y:N.y+1},O.data)}for(let P in l){let O=l[P],N=m[P].paddedRect,j=N.x+1,V=N.y+1,Z=O.data.width,X=O.data.height;ps.copy(O.data,I,{x:0,y:0},{x:j,y:V},O.data),ps.copy(O.data,I,{x:0,y:X-1},{x:j,y:V-1},{width:Z,height:1}),ps.copy(O.data,I,{x:0,y:0},{x:j,y:V+X},{width:Z,height:1}),ps.copy(O.data,I,{x:Z-1,y:0},{x:j-1,y:V},{width:1,height:X}),ps.copy(O.data,I,{x:0,y:0},{x:j+Z,y:V},{width:1,height:X})}this.image=I,this.iconPositions=h,this.patternPositions=m}addImages(i,l,h){for(let m in i){let _=i[m],y={x:0,y:0,w:_.data.width+2,h:_.data.height+2};h.push(y),l[m]=new vE(y,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(i,l){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let h in i.updatedImages)this.patchUpdatedImage(this.iconPositions[h],i.getImage(h),l),this.patchUpdatedImage(this.patternPositions[h],i.getImage(h),l)}patchUpdatedImage(i,l,h){if(!i||!l||i.version===l.version)return;i.version=l.version;let[m,_]=i.tl;h.update(l.data,void 0,{x:m,y:_})}}var Rh;function P0(c,i,l,h,m,_,y,T,I,P,O,N,j,V,Z){let X=Qp.fromFeature(c,m),K;N===a.az.vertical&&X.verticalizePunctuation();let ne=X.determineLineBreaks(P,_,i,h,V),{processBidirectionalText:he,processStyledBidirectionalText:re}=bc;if(he&&X.sections.length===1){K=[],ne=ne.map(Oe=>X.toCodeUnitIndex(Oe));let ve=he(X.toString(),ne);for(let Oe of ve){let qe=[...Oe].map(()=>0);K.push(new Qp(Oe,X.sections,qe))}}else if(re){K=[],ne=ne.map(Ze=>X.toCodeUnitIndex(Ze));let ve=0,Oe=[];for(let Ze of X.text)Oe.push(...Array(Ze.length).fill(X.sectionIndex[ve])),ve++;let qe=re(X.text,Oe,ne);for(let Ze of qe){let We=[],ut="";for(let nt of Ze[0])We.push(Ze[1][ut.length]),ut+=nt;K.push(new Qp(Ze[0],X.sections,We))}}else K=(function(ve,Oe){let qe=[],Ze=0;for(let We of Oe)qe.push(ve.substring(Ze,We)),Ze=We;return Ze<ve.length()&&qe.push(ve.substring(Ze,ve.length())),qe})(X,ne);let oe=[],pe={positionedLines:oe,text:X.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:N,iconsInText:!1,verticalizable:!1};return(function(ve,Oe,qe,Ze,We,ut,nt,$e,Ve,vt,gt,Tt){let _t=0,kt=0,Nn=0,En=0,Oi=$e==="right"?1:$e==="left"?0:.5,po=Pr/Tt,dr=0;for(let Jn of We){Jn.trim();let Ki=Jn.getMaxScale(),nr={positionedGlyphs:[],lineOffset:0};ve.positionedLines[dr]=nr;let wi=nr.positionedGlyphs,ms=0;if(!Jn.length()){kt+=ut,++dr;continue}let mo=aV(Ze,Jn,po),gs=0;for(let Lr of Jn.text){let Gi=Jn.getSection(gs),fr=Lr.codePointAt(0),Ji=lV(Ve,gt,fr),Or={glyph:fr,imageName:null,x:_t,y:kt+-17,vertical:Ji,scale:1,fontStack:"",sectionIndex:Jn.getSectionIndex(gs),metrics:null,rect:null},wu;if("fontStack"in Gi){if(wu=cV(Gi,fr,Ji,mo,Oe,qe),!wu)continue;Or.fontStack=Gi.fontStack}else{if(ve.iconsInText=!0,Gi.scale*=po,wu=uV(Gi,Ji,Ki,mo,Ze),!wu)continue;ms=Math.max(ms,wu.imageOffset),Or.imageName=Gi.imageName}let{rect:Tl,metrics:$_,baselineOffset:Nh}=wu;Or.y+=Nh,Or.scale=Gi.scale,Or.metrics=$_,Or.rect=Tl,wi.push(Or),Ji?(ve.verticalizable=!0,_t+=("imageName"in Gi?$_.advance:Pr)*Gi.scale+vt):_t+=$_.advance*Gi.scale+vt,gs++}wi.length!==0&&(Nn=Math.max(_t-vt,Nn),hV(wi,0,wi.length-1,Oi)),_t=0,nr.lineOffset=Math.max(ms,(Ki-1)*Pr);let qa=ut*Ki+ms;kt+=qa,En=Math.max(qa,En),++dr}let{horizontalAlign:ki,verticalAlign:Si}=xE(nt);(function(Jn,Ki,nr,wi,ms,mo,gs,qa,Lr){let Gi=(Ki-nr)*ms,fr=0;fr=mo!==gs?-qa*wi- -17:-wi*Lr*gs+.5*gs;for(let Ji of Jn)for(let Or of Ji.positionedGlyphs)Or.x+=Gi,Or.y+=fr})(ve.positionedLines,Oi,ki,Si,Nn,En,ut,kt,We.length),ve.top+=-Si*kt,ve.bottom=ve.top+kt,ve.left+=-ki*Nn,ve.right=ve.left+Nn})(pe,i,l,h,K,y,T,I,N,P,j,Z),!(function(ve){for(let Oe of ve)if(Oe.positionedGlyphs.length!==0)return!1;return!0})(oe)&&pe}function xE(c){let i=.5,l=.5;switch(c){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:i,verticalAlign:l}}function aV(c,i,l){let h=i.getMaxScale()*Pr,{maxImageWidth:m,maxImageHeight:_}=i.getMaxImageSize(c),y=Math.max(h,_*l);return{verticalLineContentWidth:Math.max(h,m*l),horizontalLineContentHeight:y}}function BA(c){switch(c){case"top":return 0;case"center":return .5;default:return 1}}function lV(c,i,l){return!(c===a.az.horizontal||!i&&!d_(l)||i&&(u0(l)||(h=l,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(h)))));var h}function cV(c,i,l,h,m,_){let y=_[c.fontStack],T=(function(P,O,N,j){if(P&&P.rect)return P;let V=O[N.fontStack],Z=V&&V[j];return Z?{rect:null,metrics:Z.metrics}:null})(y&&y[i],m,c,i);if(T===null)return null;let I;if(l)I=h.verticalLineContentWidth-c.scale*Pr;else{let P=BA(c.verticalAlign);I=(h.horizontalLineContentHeight-c.scale*Pr)*P}return{rect:T.rect,metrics:T.metrics,baselineOffset:I}}function uV(c,i,l,h,m){let _=m[c.imageName];if(!_)return null;let y=_.paddedRect,T=_.displaySize,I={width:T[0],height:T[1],left:1,top:-3,advance:i?T[1]:T[0]},P;if(i)P=h.verticalLineContentWidth-T[1]*c.scale;else{let O=BA(c.verticalAlign);P=(h.horizontalLineContentHeight-T[1]*c.scale)*O}return{rect:y,metrics:I,baselineOffset:P,imageOffset:(i?T[0]:T[1])*c.scale-Pr*l}}function hV(c,i,l,h){if(h===0)return;let m=c[l],_=(c[l].x+m.metrics.advance*m.scale)*h;for(let y=i;y<=l;y++)c[y].x-=_}function dV(c,i,l){let{horizontalAlign:h,verticalAlign:m}=xE(l),_=i[0]-c.displaySize[0]*h,y=i[1]-c.displaySize[1]*m;return{image:c,top:y,bottom:y+c.displaySize[1],left:_,right:_+c.displaySize[0]}}function jA(c){var i,l;let h=c.left,m=c.top,_=c.right-h,y=c.bottom-m,T=(i=c.image.textFitWidth)!==null&&i!==void 0?i:"stretchOrShrink",I=(l=c.image.textFitHeight)!==null&&l!==void 0?l:"stretchOrShrink",P=(c.image.content[2]-c.image.content[0])/(c.image.content[3]-c.image.content[1]);if(I==="proportional"){if(T==="stretchOnly"&&_/y<P||T==="proportional"){let O=Math.ceil(y*P);h*=O/_,_=O}}else if(T==="proportional"&&I==="stretchOnly"&&P!==0&&_/y>P){let O=Math.ceil(_/P);m*=O/y,y=O}return{x1:h,y1:m,x2:h+_,y2:m+y}}function VA(c,i,l,h,m,_){let y=c.image,T;if(y.content){let K=y.content,ne=y.pixelRatio||1;T=[K[0]/ne,K[1]/ne,y.displaySize[0]-K[2]/ne,y.displaySize[1]-K[3]/ne]}let I=i.left*_,P=i.right*_,O,N,j,V;l==="width"||l==="both"?(V=m[0]+I-h[3],N=m[0]+P+h[1]):(V=m[0]+(I+P-y.displaySize[0])/2,N=V+y.displaySize[0]);let Z=i.top*_,X=i.bottom*_;return l==="height"||l==="both"?(O=m[1]+Z-h[0],j=m[1]+X+h[2]):(O=m[1]+(Z+X-y.displaySize[1])/2,j=O+y.displaySize[1]),{image:y,top:O,right:N,bottom:j,left:V,collisionPadding:T}}wt("ImagePosition",vE),wt("ImageAtlas",zA),a.az=void 0,(Rh=a.az||(a.az={}))[Rh.none=0]="none",Rh[Rh.horizontal=1]="horizontal",Rh[Rh.vertical=2]="vertical",Rh[Rh.horizontalOnly=3]="horizontalOnly";let xu=128,Lh=32640;function UA(c,i){let{expression:l}=i;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new ui(c+1))};if(l.kind==="source")return{kind:"source"};{let{zoomStops:h,interpolationType:m}=l,_=0;for(;_<h.length&&h[_]<=c;)_++;_=Math.max(0,_-1);let y=_;for(;y<h.length&&h[y]<c+1;)y++;y=Math.min(h.length-1,y);let T=h[_],I=h[y];return l.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:I,interpolationType:m}:{kind:"camera",minZoom:T,maxZoom:I,minSize:l.evaluate(new ui(T)),maxSize:l.evaluate(new ui(I)),interpolationType:m}}}function bE(c,i,l){let h="never",m=c.get(i);return m?h=m:c.get(l)&&(h="always"),h}let fV=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function A0(c,i,l,h,m,_,y,T,I,P,O,N,j){let V=T?Math.min(Lh,Math.round(T[0])):0,Z=T?Math.min(Lh,Math.round(T[1])):0;c.emplaceBack(i,l,Math.round(32*h),Math.round(32*m),_,y,(V<<1)+(I?1:0),Z,16*P,16*O,256*N,256*j)}function wE(c,i,l){c.emplaceBack(i.x,i.y,l),c.emplaceBack(i.x,i.y,l),c.emplaceBack(i.x,i.y,l),c.emplaceBack(i.x,i.y,l)}function pV(c){for(let i of c.sections)if(f0(i.text))return!0;return!1}class EE{constructor(i){this.layoutVertexArray=new _e,this.indexArray=new Be,this.programConfigurations=i,this.segments=new mt,this.dynamicLayoutVertexArray=new Ce,this.opacityVertexArray=new je,this.hasVisibleVertices=!1,this.placedSymbolArray=new C}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,l,h,m){this.isEmpty()||(h&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,V3.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,U3.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,fV,!0),this.opacityVertexBuffer.itemSize=1),(h||m)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}wt("SymbolBuffers",EE);class TE{constructor(i,l,h){this.layoutVertexArray=new i,this.layoutAttributes=l,this.indexArray=new h,this.segments=new mt,this.collisionVertexArray=new ze}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,G3.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}wt("CollisionBuffers",TE);class tm{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(y=>y.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];let l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=UA(this.zoom,l["text-size"]),this.iconSizeData=UA(this.zoom,l["icon-size"]);let h=this.layers[0].layout,m=h.get("symbol-sort-key"),_=h.get("symbol-z-order");this.canOverlap=bE(h,"text-overlap","text-allow-overlap")!=="never"||bE(h,"icon-overlap","icon-allow-overlap")!=="never"||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!m.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,h.get("symbol-placement")==="point"&&(this.writingModes=h.get("text-writing-mode").map(y=>a.az[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=i.sourceID}createArrays(){this.text=new EE(new vu(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new EE(new vu(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new k,this.lineVertexArray=new B,this.symbolInstances=new R,this.textAnchorOffsets=new U}calculateGlyphDependencies(i,l,h,m,_){for(let y of i)if(l[y.codePointAt(0)]=!0,(h||m)&&_){let T=N_[y];T&&(l[T.codePointAt(0)]=!0)}}populate(i,l,h){let m=this.layers[0],_=m.layout,y=_.get("text-font"),T=_.get("text-field"),I=_.get("icon-image"),P=(T.value.kind!=="constant"||T.value.value instanceof ao&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),O=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,N=_.get("symbol-sort-key");if(this.features=[],!P&&!O)return;let j=l.iconDependencies,V=l.glyphDependencies,Z=l.availableImages,X=new ui(this.zoom);for(let{feature:K,id:ne,index:he,sourceLayerIndex:re}of i){let oe=m._featureFilter.needGeometry,pe=Cc(K,oe);if(!m._featureFilter.filter(X,pe,h))continue;let ve,Oe;if(oe||(pe.geometry=Tc(K)),P){let Ze=m.getValueAndResolveTokens("text-field",pe,h,Z),We=ao.factory(Ze),ut=this.hasRTLText=this.hasRTLText||pV(We);(!ut||bc.getRTLTextPluginStatus()==="unavailable"||ut&&bc.isParsed())&&(ve=H3(We,m,pe))}if(O){let Ze=m.getValueAndResolveTokens("icon-image",pe,h,Z);Oe=Ze instanceof Wr?Ze:Wr.fromString(Ze)}if(!ve&&!Oe)continue;let qe=this.sortFeaturesByKey?N.evaluate(pe,{},h):void 0;if(this.features.push({id:ne,text:ve,icon:Oe,index:he,sourceLayerIndex:re,geometry:pe.geometry,properties:K.properties,type:O_.types[K.type],sortKey:qe}),Oe&&(j[Oe.name]=!0),ve){let Ze=y.evaluate(pe,{},h).join(","),We=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.az.vertical)>=0;for(let ut of ve.sections)if(ut.image)j[ut.image.name]=!0;else{let nt=Ph(ve.toString()),$e=ut.fontStack||Ze,Ve=V[$e]=V[$e]||{};this.calculateGlyphDependencies(ut.text,Ve,We,this.allowVerticalPlacement,nt)}}}_.get("symbol-placement")==="line"&&(this.features=(function(K){let ne={},he={},re=[],oe=0;function pe(Ze){re.push(K[Ze]),oe++}function ve(Ze,We,ut){let nt=he[Ze];return delete he[Ze],he[We]=nt,re[nt].geometry[0].pop(),re[nt].geometry[0]=re[nt].geometry[0].concat(ut[0]),nt}function Oe(Ze,We,ut){let nt=ne[We];return delete ne[We],ne[Ze]=nt,re[nt].geometry[0].shift(),re[nt].geometry[0]=ut[0].concat(re[nt].geometry[0]),nt}function qe(Ze,We,ut){let nt=ut?We[0][We[0].length-1]:We[0][0];return`${Ze}:${nt.x}:${nt.y}`}for(let Ze=0;Ze<K.length;Ze++){let We=K[Ze],ut=We.geometry,nt=We.text?We.text.toString():null;if(!nt){pe(Ze);continue}let $e=qe(nt,ut),Ve=qe(nt,ut,!0);if($e in he&&Ve in ne&&he[$e]!==ne[Ve]){let vt=Oe($e,Ve,ut),gt=ve($e,Ve,re[vt].geometry);delete ne[$e],delete he[Ve],he[qe(nt,re[gt].geometry,!0)]=gt,re[vt].geometry=null}else $e in he?ve($e,Ve,ut):Ve in ne?Oe($e,Ve,ut):(pe(Ze),ne[$e]=oe-1,he[Ve]=oe-1)}return re.filter(Ze=>Ze.geometry)})(this.features)),this.sortFeaturesByKey&&this.features.sort((K,ne)=>K.sortKey-ne.sortKey)}update(i,l,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,l,this.layers,{imagePositions:h}),this.icon.programConfigurations.updatePaintArrays(i,l,this.layers,{imagePositions:h}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,l){let h=this.lineVertexArray.length;if(i.segment!==void 0){let m=i.dist(l[i.segment+1]),_=i.dist(l[i.segment]),y={};for(let T=i.segment+1;T<l.length;T++)y[T]={x:l[T].x,y:l[T].y,tileUnitDistanceFromAnchor:m},T<l.length-1&&(m+=l[T+1].dist(l[T]));for(let T=i.segment||0;T>=0;T--)y[T]={x:l[T].x,y:l[T].y,tileUnitDistanceFromAnchor:_},T>0&&(_+=l[T-1].dist(l[T]));for(let T=0;T<l.length;T++){let I=y[T];this.lineVertexArray.emplaceBack(I.x,I.y,I.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(i,l,h,m,_,y,T,I,P,O,N,j){let V=i.indexArray,Z=i.layoutVertexArray,X=i.segments.prepareSegment(4*l.length,Z,V,this.canOverlap?y.sortKey:void 0),K=this.glyphOffsetArray.length,ne=X.vertexLength,he=this.allowVerticalPlacement&&T===a.az.vertical?Math.PI/2:0,re=y.text&&y.text.sections;for(let oe=0;oe<l.length;oe++){let{tl:pe,tr:ve,bl:Oe,br:qe,tex:Ze,pixelOffsetTL:We,pixelOffsetBR:ut,minFontScaleX:nt,minFontScaleY:$e,glyphOffset:Ve,isSDF:vt,sectionIndex:gt}=l[oe],Tt=X.vertexLength,_t=Ve[1];A0(Z,I.x,I.y,pe.x,_t+pe.y,Ze.x,Ze.y,h,vt,We.x,We.y,nt,$e),A0(Z,I.x,I.y,ve.x,_t+ve.y,Ze.x+Ze.w,Ze.y,h,vt,ut.x,We.y,nt,$e),A0(Z,I.x,I.y,Oe.x,_t+Oe.y,Ze.x,Ze.y+Ze.h,h,vt,We.x,ut.y,nt,$e),A0(Z,I.x,I.y,qe.x,_t+qe.y,Ze.x+Ze.w,Ze.y+Ze.h,h,vt,ut.x,ut.y,nt,$e),wE(i.dynamicLayoutVertexArray,I,he),V.emplaceBack(Tt,Tt+2,Tt+1),V.emplaceBack(Tt+1,Tt+2,Tt+3),X.vertexLength+=4,X.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ve[0]),oe!==l.length-1&&gt===l[oe+1].sectionIndex||i.programConfigurations.populatePaintArrays(Z.length,y,y.index,{imagePositions:{},canonical:j,formattedSection:re&&re[gt]})}i.placedSymbolArray.emplaceBack(I.x,I.y,K,this.glyphOffsetArray.length-K,ne,P,O,I.segment,h?h[0]:0,h?h[1]:0,m[0],m[1],T,0,!1,0,N)}_addCollisionDebugVertex(i,l,h,m,_,y){return l.emplaceBack(0,0),i.emplaceBack(h.x,h.y,m,_,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(i,l,h,m,_,y,T){let I=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),P=I.vertexLength,O=_.layoutVertexArray,N=_.collisionVertexArray,j=T.anchorX,V=T.anchorY;this._addCollisionDebugVertex(O,N,y,j,V,new f(i,l)),this._addCollisionDebugVertex(O,N,y,j,V,new f(h,l)),this._addCollisionDebugVertex(O,N,y,j,V,new f(h,m)),this._addCollisionDebugVertex(O,N,y,j,V,new f(i,m)),I.vertexLength+=4;let Z=_.indexArray;Z.emplaceBack(P,P+1),Z.emplaceBack(P+1,P+2),Z.emplaceBack(P+2,P+3),Z.emplaceBack(P+3,P),I.primitiveLength+=4}addDebugCollisionBoxes(i,l,h,m){for(let _=i;_<l;_++){let y=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,m?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new TE(Ne,MA.members,lt),this.iconCollisionBox=new TE(Ne,MA.members,lt);for(let i=0;i<this.symbolInstances.length;i++){let l=this.symbolInstances.get(i);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(i,l,h,m,_,y,T,I,P){let O={};for(let N=l;N<h;N++){let j=i.get(N);O.textBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},O.textFeatureIndex=j.featureIndex;break}for(let N=m;N<_;N++){let j=i.get(N);O.verticalTextBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},O.verticalTextFeatureIndex=j.featureIndex;break}for(let N=y;N<T;N++){let j=i.get(N);O.iconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},O.iconFeatureIndex=j.featureIndex;break}for(let N=I;N<P;N++){let j=i.get(N);O.verticalIconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},O.verticalIconFeatureIndex=j.featureIndex;break}return O}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){let h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,l){let h=i.placedSymbolArray.get(l),m=h.vertexStartIndex+4*h.numGlyphs;for(let _=h.vertexStartIndex;_<m;_+=4)i.indexArray.emplaceBack(_,_+2,_+1),i.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let l=Math.sin(i),h=Math.cos(i),m=[],_=[],y=[];for(let T=0;T<this.symbolInstances.length;++T){y.push(T);let I=this.symbolInstances.get(T);m.push(0|Math.round(l*I.anchorX+h*I.anchorY)),_.push(I.featureIndex)}return y.sort((T,I)=>m[T]-m[I]||_[I]-_[T]),y}addToSortKeyRanges(i,l){let h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let l of this.symbolInstanceIndexes){let h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((m,_,y)=>{m>=0&&y.indexOf(m)===_&&this.addIndicesForPlacedSymbol(this.text,m)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let GA,$A;wt("SymbolBucket",tm,{omit:["layers","collisionBoxArray","features","compareText"]}),tm.MAX_GLYPHS=65535,tm.addDynamicAttributes=wE;var CE={get paint(){return $A=$A||new ko({"icon-opacity":new zt(Te.paint_symbol["icon-opacity"]),"icon-color":new zt(Te.paint_symbol["icon-color"]),"icon-halo-color":new zt(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new zt(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new zt(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new Lt(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new Lt(Te.paint_symbol["icon-translate-anchor"]),"text-opacity":new zt(Te.paint_symbol["text-opacity"]),"text-color":new zt(Te.paint_symbol["text-color"],{runtimeType:so,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new zt(Te.paint_symbol["text-halo-color"]),"text-halo-width":new zt(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new zt(Te.paint_symbol["text-halo-blur"]),"text-translate":new Lt(Te.paint_symbol["text-translate"]),"text-translate-anchor":new Lt(Te.paint_symbol["text-translate-anchor"])})},get layout(){return GA=GA||new ko({"symbol-placement":new Lt(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new Lt(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Lt(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new zt(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Lt(Te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Lt(Te.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Lt(Te.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Lt(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new Lt(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Lt(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new zt(Te.layout_symbol["icon-size"]),"icon-text-fit":new Lt(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Lt(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new zt(Te.layout_symbol["icon-image"]),"icon-rotate":new zt(Te.layout_symbol["icon-rotate"]),"icon-padding":new zt(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new Lt(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new zt(Te.layout_symbol["icon-offset"]),"icon-anchor":new zt(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Lt(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Lt(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Lt(Te.layout_symbol["text-rotation-alignment"]),"text-field":new zt(Te.layout_symbol["text-field"]),"text-font":new zt(Te.layout_symbol["text-font"]),"text-size":new zt(Te.layout_symbol["text-size"]),"text-max-width":new zt(Te.layout_symbol["text-max-width"]),"text-line-height":new Lt(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new zt(Te.layout_symbol["text-letter-spacing"]),"text-justify":new zt(Te.layout_symbol["text-justify"]),"text-radial-offset":new zt(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Lt(Te.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new zt(Te.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new zt(Te.layout_symbol["text-anchor"]),"text-max-angle":new Lt(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new Lt(Te.layout_symbol["text-writing-mode"]),"text-rotate":new zt(Te.layout_symbol["text-rotate"]),"text-padding":new Lt(Te.layout_symbol["text-padding"]),"text-keep-upright":new Lt(Te.layout_symbol["text-keep-upright"]),"text-transform":new zt(Te.layout_symbol["text-transform"]),"text-offset":new zt(Te.layout_symbol["text-offset"]),"text-allow-overlap":new Lt(Te.layout_symbol["text-allow-overlap"]),"text-overlap":new Lt(Te.layout_symbol["text-overlap"]),"text-ignore-placement":new Lt(Te.layout_symbol["text-ignore-placement"]),"text-optional":new Lt(Te.layout_symbol["text-optional"])})}};class HA{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:Mi,this.defaultValue=i}evaluate(i){if(i.formattedSection){let l=this.defaultValue.property.overrides;if(l&&l.hasOverride(i.formattedSection))return l.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}wt("FormatSectionOverride",HA,{omit:["defaultValue"]});class R0 extends Ps{constructor(i,l){super(i,CE,l)}recalculate(i,l){if(super.recalculate(i,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let h=this.layout.get("text-writing-mode");if(h){let m=[];for(let _ of h)m.indexOf(_)<0&&m.push(_);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,l,h,m){let _=this.layout.get(i).evaluate(l,{},h,m),y=this._unevaluatedLayout._values[i];return y.isDataDriven()||yc(y.value)||!_?_:(function(T,I){return I.replace(/{([^{}]+)}/g,(P,O)=>T&&O in T?String(T[O]):"")})(l.properties,_)}createBucket(i){return new tm(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let i of CE.paint.overridableProperties){if(!R0.hasPaintOverride(this.layout,i))continue;let l=this.paint.get(i),h=new HA(l),m=new Th(h,l.property.specification),_=null;_=l.value.kind==="constant"||l.value.kind==="source"?new b("source",m):new S("composite",m,l.value.zoomStops),this.paint._values[i]=new pa(l.property,_,l.parameters)}}_handleOverridablePaintPropertyUpdate(i,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&R0.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,l){let h=i.get("text-field"),m=CE.paint.properties[l],_=!1,y=T=>{for(let I of T)if(m.overrides&&m.overrides.hasOverride(I))return void(_=!0)};if(h.value.kind==="constant"&&h.value.value instanceof ao)y(h.value.value.sections);else if(h.value.kind==="source"||h.value.kind==="composite"){let T=P=>{_||(P instanceof cs&&Pn(P.value)===Yl?y(P.value.sections):P instanceof au?y(P.sections):P.eachChild(T))},I=h.value;I._styleExpression&&T(I._styleExpression.expression)}return _}}let ZA;var mV={get paint(){return ZA=ZA||new ko({"background-color":new Lt(Te.paint_background["background-color"]),"background-pattern":new zp(Te.paint_background["background-pattern"]),"background-opacity":new Lt(Te.paint_background["background-opacity"])})}};class gV extends Ps{constructor(i,l){super(i,mV,l)}}class _V extends Ps{constructor(i,l){super(i,{},l),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class yV{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}let vV={once:!0},IE=63710088e-1;class Oh{constructor(i,l){if(isNaN(i)||isNaN(l))throw new Error(`Invalid LngLat object: (${i}, ${l})`);if(this.lng=+i,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Oh(Sn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){let l=Math.PI/180,h=this.lat*l,m=i.lat*l,_=Math.sin(h)*Math.sin(m)+Math.cos(h)*Math.cos(m)*Math.cos((i.lng-this.lng)*l);return IE*Math.acos(Math.min(_,1))}static convert(i){if(i instanceof Oh)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new Oh(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new Oh(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let qA=2*Math.PI*IE;function WA(c){return qA*Math.cos(c*Math.PI/180)}function XA(c){return(180+c)/360}function YA(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function KA(c,i){return c/WA(i)}function JA(c){return 360*c-180}function L0(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function QA(c,i){return c*WA(L0(i))}class z_{constructor(i,l,h=0){this.x=+i,this.y=+l,this.z=+h}static fromLngLat(i,l=0){let h=Oh.convert(i);return new z_(XA(h.lng),YA(h.lat),KA(l,h.lat))}toLngLat(){return new Oh(JA(this.x),L0(this.y))}toAltitude(){return QA(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/qA*(i=L0(this.y),1/Math.cos(i*Math.PI/180));var i}}function eR(c,i,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[c*h-2*Math.PI*6378137/2,i*h-2*Math.PI*6378137/2]}class SE{constructor(i,l,h){if(!(function(m,_,y){return!(m<0||m>25||y<0||y>=Math.pow(2,m)||_<0||_>=Math.pow(2,m))})(i,l,h))throw new Error(`x=${l}, y=${h}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=l,this.y=h,this.key=nm(0,i,i,l,h)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,l,h){let m=(y=this.y,T=this.z,I=eR(256*(_=this.x),256*(y=Math.pow(2,T)-y-1),T),P=eR(256*(_+1),256*(y+1),T),I[0]+","+I[1]+","+P[0]+","+P[1]);var _,y,T,I,P;let O=(function(N,j,V){let Z,X="";for(let K=N;K>0;K--)Z=1<<K-1,X+=(j&Z?1:0)+(V&Z?2:0);return X})(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,O).replace(/{bbox-epsg-3857}/g,m)}isChildOf(i){let l=this.z-i.z;return l>0&&i.x===this.x>>l&&i.y===this.y>>l}getTilePoint(i){let l=Math.pow(2,this.z);return new f((i.x*l-this.x)*ft,(i.y*l-this.y)*ft)}toString(){return`${this.z}/${this.x}/${this.y}`}}class tR{constructor(i,l){this.wrap=i,this.canonical=l,this.key=nm(i,l.z,l.z,l.x,l.y)}}class _a{constructor(i,l,h,m,_){if(this.terrainRttPosMatrix32f=null,i<h)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${h}`);this.overscaledZ=i,this.wrap=l,this.canonical=new SE(h,+m,+_),this.key=nm(l,i,h,m,_)}clone(){return new _a(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);let l=this.canonical.z-i;return i>this.canonical.z?new _a(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new _a(i,this.wrap,i,this.canonical.x>>l,this.canonical.y>>l)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(i,l){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);let h=this.canonical.z-i;return i>this.canonical.z?nm(this.wrap*+l,i,this.canonical.z,this.canonical.x,this.canonical.y):nm(this.wrap*+l,i,i,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(i){if(i.wrap!==this.wrap||this.overscaledZ-i.overscaledZ<=0)return!1;if(i.overscaledZ===0)return this.overscaledZ>0;let l=this.canonical.z-i.canonical.z;return!(l<0)&&i.canonical.x===this.canonical.x>>l&&i.canonical.y===this.canonical.y>>l}children(i){if(this.overscaledZ>=i)return[new _a(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let l=this.canonical.z+1,h=2*this.canonical.x,m=2*this.canonical.y;return[new _a(l,this.wrap,l,h,m),new _a(l,this.wrap,l,h+1,m),new _a(l,this.wrap,l,h,m+1),new _a(l,this.wrap,l,h+1,m+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new _a(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new _a(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new tR(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new z_(i.x-this.wrap,i.y))}}function nm(c,i,l,h,m){(c*=2)<0&&(c=-1*c-1);let _=1<<l;return(_*_*c+_*m+h).toString(36)+l.toString(36)+i.toString(36)}function DE(c,i){return i?c.properties[i]:c.id}function xV(c,i){let l={id:c.id};if(i.removeAllProperties&&(delete c.removeProperties,delete c.addOrUpdateProperties,delete i.removeProperties),i.removeProperties)for(let h of i.removeProperties){let m=c.addOrUpdateProperties.findIndex(_=>_.key===h);m>-1&&c.addOrUpdateProperties.splice(m,1)}return(c.removeAllProperties||i.removeAllProperties)&&(l.removeAllProperties=!0),(c.removeProperties||i.removeProperties)&&(l.removeProperties=[...c.removeProperties||[],...i.removeProperties||[]]),(c.addOrUpdateProperties||i.addOrUpdateProperties)&&(l.addOrUpdateProperties=[...c.addOrUpdateProperties||[],...i.addOrUpdateProperties||[]]),(c.newGeometry||i.newGeometry)&&(l.newGeometry=i.newGeometry||c.newGeometry),l}function nR(c){var i,l;if(!c)return{};let h={};return h.removeAll=c.removeAll,h.remove=new Set(c.remove||[]),h.add=new Map((i=c.add)===null||i===void 0?void 0:i.map(m=>[m.id,m])),h.update=new Map((l=c.update)===null||l===void 0?void 0:l.map(m=>[m.id,m])),h}wt("CanonicalTileID",SE),wt("OverscaledTileID",_a,{omit:["terrainRttPosMatrix32f"]});class Jd{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(i){return this.minX=Math.min(this.minX,i.x),this.minY=Math.min(this.minY,i.y),this.maxX=Math.max(this.maxX,i.x),this.maxY=Math.max(this.maxY,i.y),this}expandBy(i){return this.minX-=i,this.minY-=i,this.maxX+=i,this.maxY+=i,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(i){return this.expandBy(-i)}map(i){let l=new Jd;return l.extend(i(new f(this.minX,this.minY))),l.extend(i(new f(this.maxX,this.minY))),l.extend(i(new f(this.minX,this.maxY))),l.extend(i(new f(this.maxX,this.maxY))),l}static fromPoints(i){let l=new Jd;for(let h of i)l.extend(h);return l}contains(i){return i.x>=this.minX&&i.x<=this.maxX&&i.y>=this.minY&&i.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(i){return!this.empty()&&!i.empty()&&i.minX>=this.minX&&i.maxX<=this.maxX&&i.minY>=this.minY&&i.maxY<=this.maxY}intersects(i){return!this.empty()&&!i.empty()&&i.minX<=this.maxX&&i.maxX>=this.minX&&i.minY<=this.maxY&&i.maxY>=this.minY}}class iR{constructor(i){this._stringToNumber={},this._numberToString=[];for(let l=0;l<i.length;l++){let h=i[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class rR{constructor(i,l,h,m,_){this.type="Feature",this._vectorTileFeature=i,this._x=h,this._y=m,this._z=l,this.properties=i.properties,this.id=_}projectPoint(i,l,h,m){return[360*(i.x+l)/m-180,360/Math.PI*Math.atan(Math.exp((1-2*(i.y+h)/m)*Math.PI))-90]}projectLine(i,l,h,m){return i.map(_=>this.projectPoint(_,l,h,m))}get geometry(){if(this._geometry)return this._geometry;let i=this._vectorTileFeature,l=i.extent*Math.pow(2,this._z),h=i.extent*this._x,m=i.extent*this._y,_=i.loadGeometry();switch(i.type){case 1:{let y=[];for(let I of _)y.push(I[0]);let T=this.projectLine(y,h,m,l);this._geometry=y.length===1?{type:"Point",coordinates:T[0]}:{type:"MultiPoint",coordinates:T};break}case 2:{let y=_.map(T=>this.projectLine(T,h,m,l));this._geometry=y.length===1?{type:"LineString",coordinates:y[0]}:{type:"MultiLineString",coordinates:y};break}case 3:{let y=vA(_),T=[];for(let I of y)T.push(I.map(P=>this.projectLine(P,h,m,l)));this._geometry=T.length===1?{type:"Polygon",coordinates:T[0]}:{type:"MultiPolygon",coordinates:T};break}default:throw new Error(`unknown feature type: ${i.type}`)}return this._geometry}set geometry(i){this._geometry=i}toJSON(){let i={geometry:this.geometry};for(let l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&l!=="_x"&&l!=="_y"&&l!=="_z"&&(i[l]=this[l]);return i}}class im{_name;dataBuffer;nullabilityBuffer;_size;constructor(i,l,h){this._name=i,this.dataBuffer=l,typeof h=="number"?this._size=h:(this.nullabilityBuffer=h,this._size=h.size())}getValue(i){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(i)?null:this.getValueFromBuffer(i)}has(i){return this.nullabilityBuffer&&this.nullabilityBuffer.get(i)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class O0 extends im{}class ME extends O0{getValueFromBuffer(i){return this.dataBuffer[i]}}class PE extends O0{getValueFromBuffer(i){return this.dataBuffer[i]}}class oR extends im{delta;constructor(i,l,h,m){super(i,l,m),this.delta=h}}class AE extends oR{constructor(i,l,h,m){super(i,Int32Array.of(l),h,m)}getValueFromBuffer(i){return this.dataBuffer[0]+i*this.delta}}class RE extends im{constructor(i,l,h){super(i,Int32Array.of(l),h)}getValueFromBuffer(i){return this.dataBuffer[0]}}class bV{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(i,l,h,m,_=4096){this._name=i,this._geometryVector=l,this._idVector=h,this._propertyVectors=m,this._extent=_}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(i){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map(l=>[l.name,l]))),this.propertyVectorsMap.get(i)}*[Symbol.iterator](){let i=this.geometryVector[Symbol.iterator](),l=0;for(;l<this.numFeatures;){let h;this.idVector&&(h=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(l)):this.idVector.getValue(l));let m=i?.next().value,_={};for(let y of this.propertyVectors){if(!y)continue;let T=y.name,I=y.getValue(l);I!==null&&(_[T]=I)}l++,yield{id:h,geometry:m,properties:_}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){let i=[],l=this.geometryVector.getGeometries();for(let h=0;h<this.numFeatures;h++){let m;this.idVector&&(m=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(h)):this.idVector.getValue(h));let _={coordinates:l[h],type:this.geometryVector.geometryType(h)},y={};for(let T of this.propertyVectors){if(!T)continue;let I=T.name,P=T.getValue(h);P!==null&&(y[I]=P)}i.push({id:m,geometry:_,properties:y})}return i}containsMaxSaveIntegerValues(i){return i instanceof ME||i instanceof RE&&i instanceof AE||i instanceof PE}}class wV{value;constructor(i){this.value=i}get(){return this.value}set(i){this.value=i}increment(){return this.value++}add(i){this.value+=i}}var Rn,bu,ho,wl,Qd,Rs,Ar,Rr,sR,ya;function Kr(c,i,l){let h=new Int32Array(l),m=0,_=i.get();for(let y=0;y<h.length;y++){let T=c[_++],I=127&T;T<128||(T=c[_++],I|=(127&T)<<7,T<128||(T=c[_++],I|=(127&T)<<14,T<128||(T=c[_++],I|=(127&T)<<21,T<128||(T=c[_++],I|=(15&T)<<28)))),h[m++]=I}return i.set(_),h}function k0(c,i,l){let h=new BigInt64Array(l);for(let m=0;m<h.length;m++)h[m]=TV(c,i);return h}function EV(c,i){let l,h;return h=c[i.get()],i.increment(),l=127&h,h<128?l:(h=c[i.get()],i.increment(),l|=(127&h)<<7,h<128?l:(h=c[i.get()],i.increment(),l|=(127&h)<<14,h<128?l:(h=c[i.get()],i.increment(),l|=(127&h)<<21,h<128?l:(h=c[i.get()],l|=(15&h)<<28,(function(m,_,y){let T,I;if(I=_[y.get()],y.increment(),T=(112&I)>>4,I<128||(I=_[y.get()],y.increment(),T|=(127&I)<<3,I<128)||(I=_[y.get()],y.increment(),T|=(127&I)<<10,I<128)||(I=_[y.get()],y.increment(),T|=(127&I)<<17,I<128)||(I=_[y.get()],y.increment(),T|=(127&I)<<24,I<128)||(I=_[y.get()],y.increment(),T|=(1&I)<<31,I<128))return 4294967296*T+(m>>>0);throw new Error("Expected varint not more than 10 bytes")})(l,c,i)))))}function aR(c,i,l,h){throw new Error("FastPFor is not implemented yet.")}function ef(c){return c>>>1^-(1&c)}function rm(c){return c>>1n^-(1n&c)}function TV(c,i){let l=0n,h=0,m=i.get();for(;m<c.length;){let _=c[m++];if(l|=BigInt(127&_)<<BigInt(h),!(128&_))break;if(h+=7,h>=64)throw new Error("Varint too long")}return i.set(m),l}function lR(c,i,l){let h=new Int32Array(l),m=0;for(let _=0;_<i;_++){let y=c[_];h.fill(c[_+i],m,m+y),m+=y}return h}function cR(c,i,l){let h=new BigInt64Array(l),m=0;for(let _=0;_<i;_++){let y=Number(c[_]);h.fill(c[_+i],m,m+y),m+=y}return h}function uR(c,i,l){let h=new Float64Array(l),m=0;for(let _=0;_<i;_++){let y=c[_];h.fill(c[_+i],m,m+y),m+=y}return h}function LE(c){let i=c.length/4*4,l=1;if(i>=4)for(let h=c[0];l<i-4;l+=4)h=c[l]+=h,h=c[l+1]+=h,h=c[l+2]+=h,h=c[l+3]+=h;for(;l!=c.length;)c[l]+=c[l-1],++l}function hR(c){c[0]=c[0]>>>1^-(1&c[0]),c[1]=c[1]>>>1^-(1&c[1]);let i=c.length/4*4,l=2;if(i>=4)for(;l<i-4;l+=4){let h=c[l],m=c[l+1],_=c[l+2],y=c[l+3];c[l]=(h>>>1^-(1&h))+c[l-2],c[l+1]=(m>>>1^-(1&m))+c[l-1],c[l+2]=(_>>>1^-(1&_))+c[l],c[l+3]=(y>>>1^-(1&y))+c[l+1]}for(;l!=c.length;l+=2)c[l]=(c[l]>>>1^-(1&c[l]))+c[l-2],c[l+1]=(c[l+1]>>>1^-(1&c[l+1]))+c[l-1]}(function(c){c.NONE="NONE",c.DELTA="DELTA",c.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",c.RLE="RLE",c.MORTON="MORTON",c.PDE="PDE"})(Rn||(Rn={})),(function(c){c.NONE="NONE",c.FAST_PFOR="FAST_PFOR",c.VARINT="VARINT",c.ALP="ALP"})(bu||(bu={})),(function(c){c.PRESENT="PRESENT",c.DATA="DATA",c.OFFSET="OFFSET",c.LENGTH="LENGTH"})(ho||(ho={}));class OE{_dictionaryType;_offsetType;_lengthType;constructor(i,l,h){this._dictionaryType=i,this._offsetType=l,this._lengthType=h}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Ko(c,i){let l=(function(h,m){let _=h[m.get()],y=Object.values(ho)[_>>4],T=null;switch(y){case ho.DATA:T=new OE(Object.values(wl)[15&_]);break;case ho.OFFSET:T=new OE(null,Object.values(Qd)[15&_]);break;case ho.LENGTH:T=new OE(null,null,Object.values(Rs)[15&_])}m.increment();let I=h[m.get()],P=Object.values(Rn)[I>>5],O=Object.values(Rn)[I>>2&7],N=Object.values(bu)[3&I];m.increment();let j=Kr(h,m,2),V=j[0];return{physicalStreamType:y,logicalStreamType:T,logicalLevelTechnique1:P,logicalLevelTechnique2:O,physicalLevelTechnique:N,numValues:V,byteLength:j[1],decompressedCount:V}})(c,i);return l.logicalLevelTechnique1===Rn.MORTON?(function(h,m,_){let y=Kr(m,_,2);return{physicalStreamType:h.physicalStreamType,logicalStreamType:h.logicalStreamType,logicalLevelTechnique1:h.logicalLevelTechnique1,logicalLevelTechnique2:h.logicalLevelTechnique2,physicalLevelTechnique:h.physicalLevelTechnique,numValues:h.numValues,byteLength:h.byteLength,decompressedCount:h.decompressedCount,numBits:y[0],coordinateShift:y[1]}})(l,c,i):Rn.RLE!==l.logicalLevelTechnique1&&Rn.RLE!==l.logicalLevelTechnique2||bu.NONE===l.physicalLevelTechnique?l:(function(h,m,_){let y=Kr(m,_,2);return{physicalStreamType:h.physicalStreamType,logicalStreamType:h.logicalStreamType,logicalLevelTechnique1:h.logicalLevelTechnique1,logicalLevelTechnique2:h.logicalLevelTechnique2,physicalLevelTechnique:h.physicalLevelTechnique,numValues:h.numValues,byteLength:h.byteLength,decompressedCount:y[1],runs:y[0],numRleValues:y[1]}})(l,c,i)}(function(c){c.NONE="NONE",c.SINGLE="SINGLE",c.SHARED="SHARED",c.VERTEX="VERTEX",c.MORTON="MORTON",c.FSST="FSST"})(wl||(wl={})),(function(c){c.VERTEX="VERTEX",c.INDEX="INDEX",c.STRING="STRING",c.KEY="KEY"})(Qd||(Qd={})),(function(c){c.VAR_BINARY="VAR_BINARY",c.GEOMETRIES="GEOMETRIES",c.PARTS="PARTS",c.RINGS="RINGS",c.TRIANGLES="TRIANGLES",c.SYMBOL="SYMBOL",c.DICTIONARY="DICTIONARY"})(Rs||(Rs={})),(function(c){c[c.FLAT=0]="FLAT",c[c.CONST=1]="CONST",c[c.SEQUENCE=2]="SEQUENCE",c[c.DICTIONARY=3]="DICTIONARY",c[c.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Ar||(Ar={}));class El{values;_size;constructor(i,l){this.values=i,this._size=l}get(i){let l=Math.floor(i/8);return(this.values[l]>>i%8&1)==1}set(i,l){let h=Math.floor(i/8);this.values[h]=this.values[h]|(l?1:0)<<i%8}getInt(i){let l=Math.floor(i/8);return this.values[l]>>i%8&1}size(){return this._size}getBuffer(){return this.values}}function Jo(c,i,l,h,m){return(function(_,y,T){switch(y.logicalLevelTechnique1){case Rn.DELTA:return y.logicalLevelTechnique2===Rn.RLE?(function(I,P,O){let N=new Int32Array(O),j=0,V=0;for(let Z=0;Z<P;Z++){let X=I[Z],K=ef(I[Z+P]);for(let ne=0;ne<X;ne++)V+=K,N[j++]=V}return N})(_,y.runs,y.numRleValues):((function(I){I[0]=I[0]>>>1^-(1&I[0]);let P=I.length/4*4,O=1;if(P>=4)for(;O<P-4;O+=4){let N=I[O],j=I[O+1],V=I[O+2],Z=I[O+3];I[O]=(N>>>1^-(1&N))+I[O-1],I[O+1]=(j>>>1^-(1&j))+I[O],I[O+2]=(V>>>1^-(1&V))+I[O+1],I[O+3]=(Z>>>1^-(1&Z))+I[O+2]}for(;O!=I.length;++O)I[O]=(I[O]>>>1^-(1&I[O]))+I[O-1]})(_),_);case Rn.RLE:return(function(I,P,O){return O?(function(N,j,V){let Z=new Int32Array(V),X=0;for(let K=0;K<j;K++){let ne=N[K],he=N[K+j];he=he>>>1^-(1&he),Z.fill(he,X,X+ne),X+=ne}return Z})(I,P.runs,P.numRleValues):lR(I,P.runs,P.numRleValues)})(_,y,T);case Rn.MORTON:return LE(_),_;case Rn.COMPONENTWISE_DELTA:return hR(_),_;case Rn.NONE:return T&&(function(I){for(let P=0;P<I.length;P++){let O=I[P];I[P]=O>>>1^-(1&O)}})(_),_;default:throw new Error(`The specified Logical level technique is not supported: ${y.logicalLevelTechnique1}`)}})(F0(c,i,l),l,h)}function kh(c,i,l){return(function(h,m){if(m.logicalLevelTechnique1===Rn.DELTA&&m.logicalLevelTechnique2===Rn.NONE)return(function(y){let T=new Int32Array(y.length+1);T[0]=0,T[1]=ef(y[0]);let I=T[1],P=2;for(;P!=T.length;++P){let O=y[P-1];I+=O>>>1^-(1&O),T[P]=T[P-1]+I}return T})(h);if(m.logicalLevelTechnique1===Rn.RLE&&m.logicalLevelTechnique2===Rn.NONE)return(function(y,T,I){let P=new Int32Array(I+1);P[0]=0;let O=1,N=P[0];for(let j=0;j<T;j++){let V=y[j],Z=y[j+T];for(let X=O;X<O+V;X++)P[X]=Z+N,N=P[X];O+=V}return P})(h,m.runs,m.numRleValues);if(m.logicalLevelTechnique1===Rn.NONE&&m.logicalLevelTechnique2===Rn.NONE){(function(y){let T=0;for(let I=0;I<y.length;I++)y[I]+=T,T=y[I]})(h);let _=new Int32Array(m.numValues+1);return _[0]=0,_.set(h,1),_}if(m.logicalLevelTechnique1===Rn.DELTA&&m.logicalLevelTechnique2===Rn.RLE){let _=(function(y,T,I){let P=new Int32Array(I+1);P[0]=0;let O=1,N=P[0];for(let j=0;j<T;j++){let V=y[j],Z=y[j+T];Z=Z>>>1^-(1&Z);for(let X=O;X<O+V;X++)P[X]=Z+N,N=P[X];O+=V}return P})(h,m.runs,m.numRleValues);return LE(_),_}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(F0(c,i,l),l)}function F0(c,i,l){let h=l.physicalLevelTechnique;if(h===bu.FAST_PFOR)return aR();if(h===bu.VARINT)return Kr(c,i,l.numValues);if(h===bu.NONE){let m=i.get();i.add(l.byteLength);let _=c.subarray(m,i.get());return new Int32Array(_)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function kE(c,i,l,h){let m=F0(c,i,l);if(m.length===1){let _=m[0];return h?ef(_):_}return h?(function(_){return ef(_[1])})(m):(function(_){return _[1]})(m)}function dR(c,i,l){return(function(h){if(h.length==2){let m=ef(h[1]);return[m,m]}return[ef(h[2]),ef(h[3])]})(F0(c,i,l))}function fR(c,i,l){return(function(h){if(h.length==2){let m=rm(h[1]);return[m,m]}return[rm(h[2]),rm(h[3])]})(k0(c,i,l.numValues))}function pR(c,i,l,h){return(function(m,_,y){switch(_.logicalLevelTechnique1){case Rn.DELTA:return _.logicalLevelTechnique2===Rn.RLE?(function(T,I,P){let O=new BigInt64Array(P),N=0,j=0n;for(let V=0;V<I;V++){let Z=Number(T[V]),X=rm(T[V+I]);for(let K=0;K<Z;K++)j+=X,O[N++]=j}return O})(m,_.runs,_.numRleValues):((function(T){T[0]=T[0]>>1n^-(1n&T[0]);let I=T.length/4*4,P=1;if(I>=4)for(;P<I-4;P+=4){let O=T[P],N=T[P+1],j=T[P+2],V=T[P+3];T[P]=(O>>1n^-(1n&O))+T[P-1],T[P+1]=(N>>1n^-(1n&N))+T[P],T[P+2]=(j>>1n^-(1n&j))+T[P+1],T[P+3]=(V>>1n^-(1n&V))+T[P+2]}for(;P!=T.length;++P)T[P]=(T[P]>>1n^-(1n&T[P]))+T[P-1]})(m),m);case Rn.RLE:return(function(T,I,P){return P?(function(O,N,j){let V=new BigInt64Array(j),Z=0;for(let X=0;X<N;X++){let K=Number(O[X]),ne=O[X+N];ne=ne>>1n^-(1n&ne),V.fill(ne,Z,Z+K),Z+=K}return V})(T,I.runs,I.numRleValues):cR(T,I.runs,I.numRleValues)})(m,_,y);case Rn.NONE:return y&&(function(T){for(let I=0;I<T.length;I++){let P=T[I];T[I]=P>>1n^-(1n&P)}})(m),m;default:throw new Error(`The specified Logical level technique is not supported: ${_.logicalLevelTechnique1}`)}})(k0(c,i,l.numValues),l,h)}function mR(c,i,l,h){let m=k0(c,i,l.numValues);if(m.length===1){let _=m[0];return h?rm(_):_}return h?(function(_){return rm(_[1])})(m):(function(_){return _[1]})(m)}function FE(c,i,l,h,m){return(function(_,y,T,I){switch(y.logicalLevelTechnique1){case Rn.DELTA:return y.logicalLevelTechnique2===Rn.RLE&&(_=lR(_,y.runs,y.numRleValues)),(function(P,O){let N=new Int32Array(P.size()),j=0;P.get(0)?(N[0]=P.get(0)?O[0]>>>1^-(1&O[0]):0,j=1):N[0]=0;let V=1;for(;V!=N.length;++V)N[V]=P.get(V)?N[V-1]+(O[j]>>>1^-(1&O[j++])):N[V-1];return N})(I,_);case Rn.RLE:return(function(P,O,N,j){let V=O;return N?(function(Z,X,K){let ne=new Int32Array(Z.size()),he=0;for(let re=0;re<K;re++){let oe=X[re],pe=X[re+K];pe=pe>>>1^-(1&pe);for(let ve=he;ve<he+oe;ve++)Z.get(ve)?ne[ve]=pe:(ne[ve]=0,he++);he+=oe}return ne})(j,P,V.runs):(function(Z,X,K){let ne=new Int32Array(Z.size()),he=0;for(let re=0;re<K;re++){let oe=X[re],pe=X[re+K];for(let ve=he;ve<he+oe;ve++)Z.get(ve)?ne[ve]=pe:(ne[ve]=0,he++);he+=oe}return ne})(j,P,V.runs)})(_,y,T,I);case Rn.MORTON:return LE(_),_;case Rn.COMPONENTWISE_DELTA:return hR(_),_;case Rn.NONE:return _=T?(function(P,O){let N=new Int32Array(P.size()),j=0,V=0;for(;V!=N.length;++V)if(P.get(V)){let Z=O[j++];N[V]=Z>>>1^-(1&Z)}else N[V]=0;return N})(I,_):(function(P,O){let N=new Int32Array(P.size()),j=0,V=0;for(;V!=N.length;++V)N[V]=P.get(V)?O[j++]:0;return N})(I,_),_;default:throw new Error("The specified Logical level technique is not supported")}})(l.physicalLevelTechnique===bu.FAST_PFOR?aR():Kr(c,i,l.numValues),l,h,m)}function N0(c,i,l,h){let m=c.logicalLevelTechnique1;if(m===Rn.RLE)return c.runs===1?Ar.CONST:Ar.FLAT;let _=i instanceof El?i.size():i;if(m===Rn.DELTA&&c.logicalLevelTechnique2===Rn.RLE){let y=c.runs,T=2;if(c.numRleValues!==_)return Ar.FLAT;if(y===1)return Ar.SEQUENCE;if(y===2){let I=h.get(),P;if(c.physicalLevelTechnique===bu.VARINT)P=Kr(l,h,4);else{let O=h.get();P=new Int32Array(l.buffer,l.byteOffset+O,4)}if(h.set(I),P[2]===T&&P[3]===T)return Ar.SEQUENCE}}return c.numValues===1?Ar.CONST:Ar.FLAT}class gR extends O0{getValueFromBuffer(i){return this.dataBuffer[i]}}class _R extends oR{constructor(i,l,h,m){super(i,BigInt64Array.of(l),h,m)}getValueFromBuffer(i){return this.dataBuffer[0]+BigInt(i)*this.delta}}class om{_geometryOffsets;_partOffsets;_ringOffsets;constructor(i,l,h){this._geometryOffsets=i,this._partOffsets=l,this._ringOffsets=h}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function NE(c,i,l){return{x:yR(c,i)-l,y:yR(c>>1,i)-l}}function yR(c,i){let l=0;for(let h=0;h<i;h++)l|=(c&1<<2*h)>>h;return l}(function(c){c[c.POINT=0]="POINT",c[c.LINESTRING=1]="LINESTRING",c[c.POLYGON=2]="POLYGON",c[c.MULTIPOINT=3]="MULTIPOINT",c[c.MULTILINESTRING=4]="MULTILINESTRING",c[c.MULTIPOLYGON=5]="MULTIPOLYGON"})(Rr||(Rr={})),(function(c){c[c.POINT=0]="POINT",c[c.LINESTRING=1]="LINESTRING",c[c.POLYGON=2]="POLYGON"})(sR||(sR={})),(function(c){c[c.MORTON=0]="MORTON",c[c.VEC_2=1]="VEC_2",c[c.VEC_3=2]="VEC_3"})(ya||(ya={}));class CV{createPoint(i){return[[i]]}createMultiPoint(i){return i.map(l=>[l])}createLineString(i){return[i]}createMultiLineString(i){return i}createPolygon(i,l){return[i].concat(l)}createMultiPolygon(i){return i.flat()}}function vR(c){let i=new Array(c.numGeometries),l=1,h=1,m=1,_=0,y=new CV,T=0,I=0,P=c.mortonSettings,O=c.topologyVector,N=O.geometryOffsets,j=O.partOffsets,V=O.ringOffsets,Z=c.vertexOffsets,X=c.containsPolygonGeometry(),K=c.vertexBuffer;for(let ne=0;ne<c.numGeometries;ne++){let he=c.geometryType(ne);if(he===Rr.POINT){if(Z&&Z.length!==0)if(c.vertexBufferType===ya.VEC_2){let re=2*Z[I++],oe=new f(K[re],K[re+1]);i[_++]=y.createPoint(oe)}else{let re=NE(K[Z[I++]],P.numBits,P.coordinateShift),oe=new f(re.x,re.y);i[_++]=y.createPoint(oe)}else{let re=new f(K[T++],K[T++]);i[_++]=y.createPoint(re)}N&&m++,j&&l++,V&&h++}else if(he===Rr.MULTIPOINT){let re=N[m]-N[m-1];m++;let oe=new Array(re);if(Z&&Z.length!==0){for(let pe=0;pe<re;pe++){let ve=2*Z[I++];oe[pe]=new f(K[ve],K[ve+1])}i[_++]=y.createMultiPoint(oe)}else{for(let pe=0;pe<re;pe++){let ve=K[T++],Oe=K[T++];oe[pe]=new f(ve,Oe)}i[_++]=y.createMultiPoint(oe)}}else if(he===Rr.LINESTRING){let re,oe=0;X?(oe=V[h]-V[h-1],h++):oe=j[l]-j[l-1],l++,Z&&Z.length!==0?(re=c.vertexBufferType===ya.VEC_2?BE(K,Z,I,oe,!1):jE(K,Z,I,oe,!1,P),I+=oe):(re=zE(K,T,oe,!1),T+=2*oe),i[_++]=y.createLineString(re),N&&m++}else if(he===Rr.POLYGON){let re=j[l]-j[l-1];l++;let oe=new Array(re-1),pe=V[h]-V[h-1];if(h++,Z&&Z.length!==0){let ve=c.vertexBufferType===ya.VEC_2?B0(K,Z,I,pe):j0(K,Z,I,pe,0,P);I+=pe;for(let Oe=0;Oe<oe.length;Oe++)pe=V[h]-V[h-1],h++,oe[Oe]=c.vertexBufferType===ya.VEC_2?B0(K,Z,I,pe):j0(K,Z,I,pe,0,P),I+=pe;i[_++]=y.createPolygon(ve,oe)}else{let ve=z0(K,T,pe);T+=2*pe;for(let Oe=0;Oe<oe.length;Oe++)pe=V[h]-V[h-1],h++,oe[Oe]=z0(K,T,pe),T+=2*pe;i[_++]=y.createPolygon(ve,oe)}N&&m++}else if(he===Rr.MULTILINESTRING){let re=N[m]-N[m-1];m++;let oe=new Array(re);if(Z&&Z.length!==0){for(let pe=0;pe<re;pe++){let ve=0;X?(ve=V[h]-V[h-1],h++):ve=j[l]-j[l-1],l++;let Oe=c.vertexBufferType===ya.VEC_2?BE(K,Z,I,ve,!1):jE(K,Z,I,ve,!1,P);oe[pe]=Oe,I+=ve}i[_++]=y.createMultiLineString(oe)}else{for(let pe=0;pe<re;pe++){let ve=0;X?(ve=V[h]-V[h-1],h++):ve=j[l]-j[l-1],l++,oe[pe]=zE(K,T,ve,!1),T+=2*ve}i[_++]=y.createMultiLineString(oe)}}else{if(he!==Rr.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{let re=N[m]-N[m-1];m++;let oe=new Array(re),pe=0;if(Z&&Z.length!==0){for(let ve=0;ve<re;ve++){let Oe=j[l]-j[l-1];l++;let qe=new Array(Oe-1);pe=V[h]-V[h-1],h++;let Ze=c.vertexBufferType===ya.VEC_2?B0(K,Z,I,pe):j0(K,Z,I,pe,0,P);I+=pe;for(let We=0;We<qe.length;We++)pe=V[h]-V[h-1],h++,qe[We]=c.vertexBufferType===ya.VEC_2?B0(K,Z,I,pe):j0(K,Z,I,pe,0,P),I+=pe;oe[ve]=y.createPolygon(Ze,qe)}i[_++]=y.createMultiPolygon(oe)}else{for(let ve=0;ve<re;ve++){let Oe=j[l]-j[l-1];l++;let qe=new Array(Oe-1);pe=V[h]-V[h-1],h++;let Ze=z0(K,T,pe);T+=2*pe;for(let We=0;We<qe.length;We++){let ut=V[h]-V[h-1];h++,qe[We]=z0(K,T,ut),T+=2*ut}oe[ve]=y.createPolygon(Ze,qe)}i[_++]=y.createMultiPolygon(oe)}}}}return i}function z0(c,i,l){return zE(c,i,l,!0)}function B0(c,i,l,h){return BE(c,i,l,h,!0)}function j0(c,i,l,h,m,_){return jE(c,i,l,h,!0,_)}function zE(c,i,l,h){let m=new Array(h?l+1:l);for(let _=0;_<2*l;_+=2)m[_/2]=new f(c[i+_],c[i+_+1]);return h&&(m[m.length-1]=m[0]),m}function BE(c,i,l,h,m){let _=new Array(m?h+1:h);for(let y=0;y<2*h;y+=2){let T=2*i[l+y/2];_[y/2]=new f(c[T],c[T+1])}return m&&(_[_.length-1]=_[0]),_}function jE(c,i,l,h,m,_){let y=new Array(m?h+1:h);for(let T=0;T<h;T++){let I=NE(c[i[l+T]],_.numBits,_.coordinateShift);y[T]=new f(I.x,I.y)}return m&&(y[y.length-1]=y[0]),y}class xR{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(i,l,h,m,_){this._vertexBufferType=i,this._topologyVector=l,this._vertexOffsets=h,this._vertexBuffer=m,this._mortonSettings=_}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){let i=vR(this),l=0;for(;l<this.numGeometries;)yield{coordinates:i[l],type:this.geometryType(l)},l++}getSimpleEncodedVertex(i){let l=this.vertexOffsets?2*this.vertexOffsets[i]:2*i;return[this.vertexBuffer[l],this.vertexBuffer[l+1]]}getVertex(i){if(this.vertexOffsets&&this.mortonSettings){let h=NE(this.vertexBuffer[this.vertexOffsets[i]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[h.x,h.y]}let l=this.vertexOffsets?2*this.vertexOffsets[i]:2*i;return[this.vertexBuffer[l],this.vertexBuffer[l+1]]}getGeometries(){return vR(this)}get mortonSettings(){return this._mortonSettings}}class bR extends xR{_numGeometries;_geometryType;constructor(i,l,h,m,_,y,T){super(h,m,_,y,T),this._numGeometries=i,this._geometryType=l}geometryType(i){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===Rr.POLYGON||this._geometryType===Rr.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class wR extends xR{_geometryTypes;constructor(i,l,h,m,_,y){super(i,h,m,_,y),this._geometryTypes=l}geometryType(i){return this._geometryTypes[i]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let i=0;i<this.numGeometries;i++)if(this.geometryType(i)===Rr.POLYGON||this.geometryType(i)===Rr.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class ER{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(i,l,h,m){this._triangleOffsets=i,this._indexBuffer=l,this._vertexBuffer=h,this._topologyVector=m}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");let i=new Array(this.numGeometries),l=this._topologyVector,h=l.partOffsets,m=l.ringOffsets,_=l.geometryOffsets,y=0,T=1,I=1,P=1;for(let O=0;O<this.numGeometries;O++)switch(this.geometryType(O)){case Rr.POLYGON:{let N=h[T]-h[T-1];T++;let j=[];for(let V=0;V<N;V++){let Z=m[I]-m[I-1];I++;let X=[];for(let K=0;K<Z;K++){let ne=this._vertexBuffer[y++],he=this._vertexBuffer[y++];X.push(new f(ne,he))}X.length>0&&X.push(X[0]),j.push(X)}i[O]=j,_&&P++}break;case Rr.MULTIPOLYGON:{let N=_[P]-_[P-1];P++;let j=[];for(let V=0;V<N;V++){let Z=h[T]-h[T-1];T++;for(let X=0;X<Z;X++){let K=m[I]-m[I-1];I++;let ne=[];for(let he=0;he<K;he++){let re=this._vertexBuffer[y++],oe=this._vertexBuffer[y++];ne.push(new f(re,oe))}ne.length>0&&ne.push(ne[0]),j.push(ne)}}i[O]=j}}return i}[Symbol.iterator](){return null}}function TR(c,i,l,h,m,_){return new IV(c,i,l,h,m,_)}class IV extends ER{_numGeometries;_geometryType;constructor(i,l,h,m,_,y){super(h,m,_,y),this._numGeometries=i,this._geometryType=l}geometryType(i){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function CR(c,i,l,h,m){return new SV(c,i,l,h,m)}class SV extends ER{_geometryTypes;constructor(i,l,h,m,_){super(l,h,m,_),this._geometryTypes=i}geometryType(i){return this._geometryTypes[i]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function DV(c,i,l,h,m){let _=Ko(c,l),y=null,T=null,I=null,P=null,O=null,N=null,j=null,V=null;if(N0(_,h,c,l)===Ar.CONST){let X=kE(c,l,_,!1);for(let K=0;K<i-1;K++){let ne=Ko(c,l);switch(ne.physicalStreamType){case ho.LENGTH:switch(ne.logicalStreamType.lengthType){case Rs.GEOMETRIES:y=kh(c,l,ne);break;case Rs.PARTS:T=kh(c,l,ne);break;case Rs.RINGS:I=kh(c,l,ne);break;case Rs.TRIANGLES:j=kh(c,l,ne)}break;case ho.OFFSET:switch(ne.logicalStreamType.offsetType){case Qd.VERTEX:P=Jo(c,l,ne,!1);break;case Qd.INDEX:V=Jo(c,l,ne,!1)}break;case ho.DATA:wl.VERTEX===ne.logicalStreamType.dictionaryType?O=Jo(c,l,ne,!0):(N={numBits:ne.numBits,coordinateShift:ne.coordinateShift},O=Jo(c,l,ne,!1))}}return V!==null?y!=null||T!=null?TR(h,X,j,V,O,new om(y,T,I)):TR(h,X,j,V,O):N===null?(function(K,ne,he,re,oe){return new bR(K,ne,ya.VEC_2,he,re,oe)})(h,X,new om(y,T,I),P,O):(function(K,ne,he,re,oe,pe){return new bR(K,ne,ya.MORTON,he,re,oe,pe)})(h,X,new om(y,T,I),P,O,N)}let Z=Jo(c,l,_,!1);for(let X=0;X<i-1;X++){let K=Ko(c,l);switch(K.physicalStreamType){case ho.LENGTH:switch(K.logicalStreamType.lengthType){case Rs.GEOMETRIES:y=Jo(c,l,K,!1);break;case Rs.PARTS:T=Jo(c,l,K,!1);break;case Rs.RINGS:I=Jo(c,l,K,!1);break;case Rs.TRIANGLES:j=kh(c,l,K)}break;case ho.OFFSET:switch(K.logicalStreamType.offsetType){case Qd.VERTEX:P=Jo(c,l,K,!1);break;case Qd.INDEX:V=Jo(c,l,K,!1)}break;case ho.DATA:wl.VERTEX===K.logicalStreamType.dictionaryType?O=Jo(c,l,K,!0):(N={numBits:K.numBits,coordinateShift:K.coordinateShift},O=Jo(c,l,K,!1))}}return V!==null&&T===null?CR(Z,j,V,O):(y!==null?(y=VE(Z,y,2),T!==null&&I!==null?(T=IR(Z,y,T,!1),I=(function(X,K,ne,he){let re=new Int32Array(ne[ne.length-1]+1),oe=0;re[0]=oe;let pe=1,ve=1,Oe=0;for(let qe=0;qe<X.length;qe++){let Ze=X[qe],We=K[qe+1]-K[qe];if(Ze!==0&&Ze!==3)for(let ut=0;ut<We;ut++){let nt=ne[pe]-ne[pe-1];pe++;for(let $e=0;$e<nt;$e++)oe=re[ve++]=oe+he[Oe++]}else for(let ut=0;ut<We;ut++)re[ve++]=++oe,pe++}return re})(Z,y,T,I)):T!==null&&(T=(function(X,K,ne){let he=new Int32Array(K[K.length-1]+1),re=0;he[0]=re;let oe=1,pe=0;for(let ve=0;ve<X.length;ve++){let Oe=X[ve],qe=K[ve+1]-K[ve];if(Oe===4||Oe===1)for(let Ze=0;Ze<qe;Ze++)re=he[oe++]=re+ne[pe++];else for(let Ze=0;Ze<qe;Ze++)he[oe++]=++re}return he})(Z,y,T))):T!==null&&I!==null?(T=VE(Z,T,1),I=IR(Z,T,I,!0)):T!==null&&(T=VE(Z,T,0)),V!==null?CR(Z,j,V,O,new om(y,T,I)):N===null?(function(X,K,ne,he){return new wR(ya.VEC_2,X,K,ne,he)})(Z,new om(y,T,I),P,O):(function(X,K,ne,he,re){return new wR(ya.MORTON,X,K,ne,he,re)})(Z,new om(y,T,I),P,O,N))}function VE(c,i,l){let h=new Int32Array(c.length+1),m=0;h[0]=m;let _=0;for(let y=0;y<c.length;y++)m=h[y+1]=m+(c[y]>l?i[_++]:1);return h}function IR(c,i,l,h){let m=new Int32Array(i[i.length-1]+1),_=0;m[0]=_;let y=1,T=0;for(let I=0;I<c.length;I++){let P=c[I],O=i[I+1]-i[I];if(P===5||P===2||h&&(P===4||P===1))for(let N=0;N<O;N++)_=m[y++]=_+l[T++];else for(let N=0;N<O;N++)m[y++]=++_}return m}class MV extends im{dataVector;constructor(i,l,h){super(i,l.getBuffer(),h),this.dataVector=l}getValueFromBuffer(i){return this.dataVector.get(i)}}class PV extends O0{getValueFromBuffer(i){return this.dataBuffer[i]}}class SR extends im{constructor(i,l,h){super(i,BigInt64Array.of(l),h)}getValueFromBuffer(i){return this.dataBuffer[0]}}function B_(c,i,l){return DR(c,Math.ceil(i/8),l)}function DR(c,i,l){let h=new Uint8Array(i),m=0;for(;m<i;){let _=c[l.increment()];if(_<=127){let y=_+3,T=c[l.increment()],I=m+y;h.fill(T,m,I),m=I}else{let y=256-_;for(let T=0;T<y;T++)h[m++]=c[l.increment()]}}return h}let AV=new TextDecoder;function UE(c,i,l){return l-i>=12?AV.decode(c.subarray(i,l)):(function(h,m,_){let y="",T=m;for(;T<_;){let I=h[T],P,O,N,j=null,V=I>239?4:I>223?3:I>191?2:1;if(T+V>_)break;V===1?I<128&&(j=I):V===2?(P=h[T+1],(192&P)==128&&(j=(31&I)<<6|63&P,j<=127&&(j=null))):V===3?(P=h[T+1],O=h[T+2],(192&P)==128&&(192&O)==128&&(j=(15&I)<<12|(63&P)<<6|63&O,(j<=2047||j>=55296&&j<=57343)&&(j=null))):V===4&&(P=h[T+1],O=h[T+2],N=h[T+3],(192&P)==128&&(192&O)==128&&(192&N)==128&&(j=(15&I)<<18|(63&P)<<12|(63&O)<<6|63&N,(j<=65535||j>=1114112)&&(j=null))),j===null?(j=65533,V=1):j>65535&&(j-=65536,y+=String.fromCharCode(j>>>10&1023|55296),j=56320|1023&j),y+=String.fromCharCode(j),T+=V}return y})(c,i,l)}class GE extends im{offsetBuffer;constructor(i,l,h,m){super(i,h,m),this.offsetBuffer=l}}class MR extends GE{textEncoder;constructor(i,l,h,m){super(i,l,h,m??l.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(i){return UE(this.dataBuffer,this.offsetBuffer[i],this.offsetBuffer[i+1])}}class sm extends GE{indexBuffer;textEncoder;constructor(i,l,h,m,_){super(i,h,m,_??l.length),this.indexBuffer=l,this.indexBuffer=l,this.textEncoder=new TextEncoder}getValueFromBuffer(i){let l=this.indexBuffer[i];return UE(this.dataBuffer,this.offsetBuffer[l],this.offsetBuffer[l+1])}}class PR extends GE{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(i,l,h,m,_,y,T){super(i,h,m,T),this.indexBuffer=l,this.symbolOffsetBuffer=_,this.symbolTableBuffer=y,this.textEncoder=new TextEncoder}getValueFromBuffer(i){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(h,m,_){let y=[],T=new Array(m.length).fill(0);for(let I=1;I<m.length;I++)T[I]=T[I-1]+m[I-1];for(let I=0;I<_.length;I++)if(_[I]===255)y.push(_[++I]);else{let P=m[_[I]],O=T[_[I]];for(let N=0;N<P;N++)y.push(h[O+N])}return new Uint8Array(y)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));let l=this.indexBuffer[i];return UE(this.decodedDictionary,this.offsetBuffer[l],this.offsetBuffer[l+1])}offsetToLengthBuffer(i){let l=new Uint32Array(i.length-1),h=i[0];for(let m=1;m<i.length;m++){let _=i[m];l[m-1]=_-h,h=_}return l}}function RV(c,i,l,h,m,_){return l.type==="scalarType"?(function(y,T,I,P,O,N){let j=null,V=0;if(y===0)return null;if(N.nullable){let X=Ko(T,I);V=X.numValues;let K=I.get(),ne=B_(T,V,I);I.set(K+X.byteLength),j=new El(ne,X.numValues)}let Z=j??P;switch(O.physicalType){case 4:case 3:return(function(X,K,ne,he,re){let oe=Ko(X,K),pe=N0(oe,re,X,K),ve=he.physicalType===3;if(pe===Ar.FLAT){let Oe=j_(re)?FE(X,K,oe,ve,re):Jo(X,K,oe,ve);return new ME(ne.name,Oe,re)}if(pe===Ar.SEQUENCE){let Oe=dR(X,K,oe);return new AE(ne.name,Oe[0],Oe[1],oe.numRleValues)}{let Oe=kE(X,K,oe,ve);return new RE(ne.name,Oe,re)}})(T,I,N,O,Z);case 9:return(function(X,K,ne,he,re){let oe=null,pe=null,ve=null,Oe=null,qe=null,Ze=null,We=null,ut=null;for(let nt=0;nt<he;nt++){let $e=Ko(K,ne);if($e.byteLength!==0)switch($e.physicalStreamType){case ho.PRESENT:{let Ve=B_(K,$e.numValues,ne);Ze=new El(Ve,$e.numValues);break}case ho.OFFSET:pe=re!=null||Ze!=null?FE(K,ne,$e,!1,re??Ze):Jo(K,ne,$e,!1);break;case ho.LENGTH:{let Ve=kh(K,ne,$e);Rs.DICTIONARY===$e.logicalStreamType.lengthType?oe=Ve:Rs.SYMBOL===$e.logicalStreamType.lengthType?Oe=Ve:We=Ve;break}case ho.DATA:{let Ve=K.subarray(ne.get(),ne.get()+$e.byteLength);ne.add($e.byteLength);let vt=$e.logicalStreamType.dictionaryType;wl.FSST===vt?qe=Ve:wl.SINGLE===vt||wl.SHARED===vt?ve=Ve:wl.NONE===vt&&(ut=Ve);break}}}return(function(nt,$e,Ve,vt,gt,Tt,_t){return $e?new PR(nt,Ve,vt,gt,Tt,$e,_t):null})(X,qe,pe,oe,ve,Oe,re??Ze)??(function(nt,$e,Ve,vt,gt){return $e?gt?new sm(nt,Ve,vt,$e,gt):new sm(nt,Ve,vt,$e):null})(X,ve,pe,oe,re??Ze)??(function(nt,$e,Ve,vt,gt){if(!$e||!Ve)return null;if(vt)return gt?new sm(nt,vt,$e,Ve,gt):new sm(nt,vt,$e,Ve);if(gt&&gt.size()!==$e.length-1){let Tt=new Int32Array(gt.size()),_t=0;for(let kt=0;kt<gt.size();kt++)Tt[kt]=gt.get(kt)?_t++:0;return new sm(nt,Tt,$e,Ve,gt)}return gt?new MR(nt,$e,Ve,gt):new MR(nt,$e,Ve)})(X,We,ut,pe,re??Ze)})(N.name,T,I,N.nullable?y-1:y,j);case 0:return(function(X,K,ne,he,re){let oe=Ko(X,K),pe=oe.numValues,ve=K.get(),Oe=j_(re)?(function(Ze,We,ut,nt){let $e=DR(Ze,Math.ceil(We/8),ut),Ve=new El($e,We),vt=nt.size(),gt=new El(new Uint8Array(vt),vt),Tt=0;for(let _t=0;_t<nt.size();_t++){let kt=!!nt.get(_t)&&Ve.get(Tt++);gt.set(_t,kt)}return gt.getBuffer()})(X,pe,K,re):B_(X,pe,K);K.set(ve+oe.byteLength);let qe=new El(Oe,pe);return new MV(ne.name,qe,re)})(T,I,N,0,Z);case 6:case 5:return(function(X,K,ne,he,re){let oe=Ko(X,K),pe=N0(oe,he,X,K),ve=re.physicalType===5;if(pe===Ar.FLAT){let Oe=j_(he)?(function(qe,Ze,We,ut,nt){return(function($e,Ve,vt,gt){switch(Ve.logicalLevelTechnique1){case Rn.DELTA:return Ve.logicalLevelTechnique2===Rn.RLE&&($e=cR($e,Ve.runs,Ve.numRleValues)),(function(Tt,_t){let kt=new BigInt64Array(Tt.size()),Nn=0;Tt.get(0)?(kt[0]=Tt.get(0)?_t[0]>>1n^-(1n&_t[0]):0n,Nn=1):kt[0]=0n;let En=1;for(;En!=kt.length;++En)kt[En]=Tt.get(En)?kt[En-1]+(_t[Nn]>>1n^-(1n&_t[Nn++])):kt[En-1];return kt})(gt,$e);case Rn.RLE:return(function(Tt,_t,kt,Nn){let En=_t;return kt?(function(Oi,po,dr){let ki=new BigInt64Array(Oi.size()),Si=0;for(let Jn=0;Jn<dr;Jn++){let Ki=Number(po[Jn]),nr=po[Jn+dr];nr=nr>>1n^-(1n&nr);for(let wi=Si;wi<Si+Ki;wi++)Oi.get(wi)?ki[wi]=nr:(ki[wi]=0n,Si++);Si+=Ki}return ki})(Nn,Tt,En.runs):(function(Oi,po,dr){let ki=new BigInt64Array(Oi.size()),Si=0;for(let Jn=0;Jn<dr;Jn++){let Ki=Number(po[Jn]),nr=po[Jn+dr];for(let wi=Si;wi<Si+Ki;wi++)Oi.get(wi)?ki[wi]=nr:(ki[wi]=0n,Si++);Si+=Ki}return ki})(Nn,Tt,En.runs)})($e,Ve,vt,gt);case Rn.NONE:return $e=vt?(function(Tt,_t){let kt=new BigInt64Array(Tt.size()),Nn=0,En=0;for(;En!=kt.length;++En)if(Tt.get(En)){let Oi=_t[Nn++];kt[En]=Oi>>1n^-(1n&Oi)}else kt[En]=0n;return kt})(gt,$e):(function(Tt,_t){let kt=new BigInt64Array(Tt.size()),Nn=0,En=0;for(;En!=kt.length;++En)kt[En]=Tt.get(En)?_t[Nn++]:0n;return kt})(gt,$e),$e;default:throw new Error("The specified Logical level technique is not supported")}})(k0(qe,Ze,We.numValues),We,ut,nt)})(X,K,oe,ve,he):pR(X,K,oe,ve);return new gR(ne.name,Oe,he)}if(pe===Ar.SEQUENCE){let Oe=fR(X,K,oe);return new _R(ne.name,Oe[0],Oe[1],oe.numRleValues)}{let Oe=mR(X,K,oe,ve);return new SR(ne.name,Oe,he)}})(T,I,N,Z,O);case 7:return(function(X,K,ne,he){let re=Ko(X,K),oe=j_(he)?(function(pe,ve,Oe,qe){let Ze=ve.get(),We=Ze+qe*Float32Array.BYTES_PER_ELEMENT,ut=new Uint8Array(pe.subarray(Ze,We)).buffer,nt=new Float32Array(ut);ve.set(We);let $e=Oe.size(),Ve=new Float32Array($e),vt=0;for(let gt=0;gt<$e;gt++)Ve[gt]=Oe.get(gt)?nt[vt++]:0;return Ve})(X,K,he,re.numValues):(function(pe,ve,Oe){let qe=ve.get(),Ze=qe+Oe*Float32Array.BYTES_PER_ELEMENT,We=new Uint8Array(pe.subarray(qe,Ze)).buffer,ut=new Float32Array(We);return ve.set(Ze),ut})(X,K,re.numValues);return new PV(ne.name,oe,he)})(T,I,N,Z);case 8:return(function(X,K,ne,he){let re=Ko(X,K),oe=j_(he)?(function(pe,ve,Oe,qe){let Ze=ve.get(),We=Ze+qe*Float64Array.BYTES_PER_ELEMENT,ut=new Uint8Array(pe.subarray(Ze,We)).buffer,nt=new Float64Array(ut);ve.set(We);let $e=Oe.size(),Ve=new Float64Array($e),vt=0;for(let gt=0;gt<$e;gt++)Ve[gt]=Oe.get(gt)?nt[vt++]:0;return Ve})(X,K,he,re.numValues):(function(pe,ve,Oe){let qe=ve.get(),Ze=qe+Oe*Float64Array.BYTES_PER_ELEMENT,We=new Uint8Array(pe.subarray(qe,Ze)).buffer,ut=new Float64Array(We);return ve.set(Ze),ut})(X,K,re.numValues);return new PE(ne.name,oe,he)})(T,I,N,Z);default:throw new Error(`The specified data type for the field is currently not supported: ${O}`)}})(h,c,i,m,l.scalarType,l):h!=1?null:(function(y,T,I,P){let O=null,N=null,j=null,V=null,Z=!1;for(;!Z;){let he=Ko(y,T);switch(he.physicalStreamType){case ho.LENGTH:Rs.DICTIONARY===he.logicalStreamType.lengthType?O=kh(y,T,he):j=kh(y,T,he);break;case ho.DATA:wl.SINGLE===he.logicalStreamType.dictionaryType||wl.SHARED===he.logicalStreamType.dictionaryType?(N=y.subarray(T.get(),T.get()+he.byteLength),Z=!0):V=y.subarray(T.get(),T.get()+he.byteLength),T.add(he.byteLength)}}let X=I.complexType.children,K=[],ne=0;for(let he of X){let re=Kr(y,T,1)[0];if(re==0)continue;let oe=`${I.name}${he.name==="default"?"":":"+he.name}`;if(re!==2||he.type!=="scalarField"||he.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");let pe=Ko(y,T),ve=B_(y,pe.numValues,T),Oe=Ko(y,T),qe=Oe.decompressedCount!==P?FE(y,T,Oe,!1,new El(ve,pe.numValues)):Jo(y,T,Oe,!1);K[ne++]=V?new PR(oe,qe,O,N,j,V,new El(ve,pe.numValues)):new sm(oe,qe,O,N,new El(ve,pe.numValues))}return K})(c,i,l,m)}function j_(c){return c instanceof El}function LV(c){if(c.name==="id")return!1;if(c.type==="scalarType"){let i=c.scalarType;if(i.type==="physicalType")switch(i.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(i.type==="logicalType")return!1}else if(c.type==="complexType"){let i=c.complexType;if(i.type==="physicalType")switch(i.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",c),!1}let OV=new TextDecoder;function AR(c,i){let l=Kr(c,i,1)[0];if(l===0)return"";let h=i.get(),m=c.subarray(h,h+l);return i.add(l),OV.decode(m)}function RR(c,i){let l=Kr(c,i,1)[0]>>>0,h=!!(4&l),m=!!(2&l),_=Kr(c,i,1)[0]>>>0,y={};if(1&l&&(y.nullable=!0),m){let T={};if(h?(T.type="logicalType",T.logicalType=_):(T.type="physicalType",T.physicalType=_),8&l){let I=Kr(c,i,1)[0]>>>0;T.children=new Array(I);for(let P=0;P<I;P++)T.children[P]=RR(c,i)}y.type="complexField",y.complexField=T}else{let T={};h?(T.type="logicalType",T.logicalType=_):(T.type="physicalType",T.physicalType=_),y.type="scalarField",y.scalarField=T}return y}function kV(c,i){let l=Kr(c,i,1)[0]>>>0,h=(function(m){switch(m){case 0:case 1:case 2:case 3:{let _={};_.nullable=!!(1&m),_.columnScope=0;let y={};return y.physicalType=m>1?6:4,y.type="physicalType",_.scalarType=y,_.type="scalarType",_}case 4:{let _={nullable:!1,columnScope:0},y={type:"physicalType",physicalType:0};return _.type="complexType",_.complexType=y,_}case 30:{let _={nullable:!1,columnScope:0},y={type:"physicalType",physicalType:1};return _.type="complexType",_.complexType=y,_}default:return(function(_){let y=null;switch(_){case 10:case 11:y=0;break;case 12:case 13:y=1;break;case 14:case 15:y=2;break;case 16:case 17:y=3;break;case 18:case 19:y=4;break;case 20:case 21:y=5;break;case 22:case 23:y=6;break;case 24:case 25:y=7;break;case 26:case 27:y=8;break;case 28:case 29:y=9;break;default:return null}let T={};T.nullable=!!(1&_),T.columnScope=0;let I={type:"physicalType"};return I.physicalType=y,T.type="scalarType",T.scalarType=I,T})(m)}})(l);if(!h)throw new Error(`Unsupported column type code: ${l}`);if((function(m){return m>=10})(l)?h.name=AR(c,i):l>=0&&l<=3?h.name="id":l===4&&(h.name="geometry"),(function(m){return m===30})(l)){let m=Kr(c,i,1)[0]>>>0,_=h.complexType;_.children=new Array(m);for(let y=0;y<m;y++)_.children[y]=RR(c,i)}return h}function FV(c,i){let l={featureTables:[]},h={};h.name=AR(c,i);let m=Kr(c,i,1)[0]>>>0,_=Kr(c,i,1)[0]>>>0;h.columns=new Array(_);for(let y=0;y<_;y++)h.columns[y]=kV(c,i);return l.featureTables.push(h),[l,m]}function NV(c,i,l,h,m,_,y=!1){let T=i.scalarType.physicalType,I=N0(m,_,c,l);if(T===4)switch(I){case Ar.FLAT:{let P=Jo(c,l,m,!1);return new ME(h,P,_)}case Ar.SEQUENCE:{let P=dR(c,l,m);return new AE(h,P[0],P[1],m.numRleValues)}case Ar.CONST:{let P=kE(c,l,m,!1);return new RE(h,P,_)}}else switch(I){case Ar.FLAT:{if(y){let O=(function(N,j,V,Z){let X=(function(K,ne,he){let re=new Float64Array(ne);for(let oe=0;oe<ne;oe++)re[oe]=EV(K,he);return re})(N,V.numValues,j);return(function(K,ne,he){switch(ne.logicalLevelTechnique1){case Rn.DELTA:return ne.logicalLevelTechnique2===Rn.RLE&&(K=uR(K,ne.runs,ne.numRleValues)),(function(re){re[0]=re[0]%2==1?(re[0]+1)/-2:re[0]/2;let oe=re.length/4*4,pe=1;if(oe>=4)for(;pe<oe-4;pe+=4){let ve=re[pe],Oe=re[pe+1],qe=re[pe+2],Ze=re[pe+3];re[pe]=(ve%2==1?(ve+1)/-2:ve/2)+re[pe-1],re[pe+1]=(Oe%2==1?(Oe+1)/-2:Oe/2)+re[pe],re[pe+2]=(qe%2==1?(qe+1)/-2:qe/2)+re[pe+1],re[pe+3]=(Ze%2==1?(Ze+1)/-2:Ze/2)+re[pe+2]}for(;pe!=re.length;++pe)re[pe]=(re[pe]%2==1?(re[pe]+1)/-2:re[pe]/2)+re[pe-1]})(K),K;case Rn.RLE:return(function(re,oe,pe){return pe?(function(ve,Oe,qe){let Ze=new Float64Array(qe),We=0;for(let ut=0;ut<Oe;ut++){let nt=ve[ut],$e=ve[ut+Oe];$e=$e%2==1?($e+1)/-2:$e/2,Ze.fill($e,We,We+nt),We+=nt}return Ze})(re,oe.runs,oe.numRleValues):uR(re,oe.runs,oe.numRleValues)})(K,ne,he);case Rn.NONE:return K;default:throw new Error(`The specified Logical level technique is not supported: ${ne.logicalLevelTechnique1}`)}})(X,V,Z)})(c,l,m,!1);return new PE(h,O,_)}let P=pR(c,l,m,!1);return new gR(h,P,_)}case Ar.SEQUENCE:{let P=fR(c,l,m);return new _R(h,P[0],P[1],m.numRleValues)}case Ar.CONST:{let P=mR(c,l,m,!1);return new SR(h,P,_)}}throw new Error("Vector type not supported for id column.")}class zV{constructor(i,l){var h;switch(this._featureData=i,this.properties=this._featureData.properties||{},(h=this._featureData.geometry)===null||h===void 0?void 0:h.type){case Rr.POINT:case Rr.MULTIPOINT:this.type=1;break;case Rr.LINESTRING:case Rr.MULTILINESTRING:this.type=2;break;case Rr.POLYGON:case Rr.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=l,this.id=Number(this._featureData.id)}loadGeometry(){let i=[];for(let l of this._featureData.geometry.coordinates){let h=[];for(let m of l)h.push(new f(m.x,m.y));i.push(h)}return i}}class BV{constructor(i){this.features=[],this.featureTable=i,this.name=i.name,this.extent=i.extent,this.version=2,this.features=i.getFeatures(),this.length=this.features.length}feature(i){return new zV(this.features[i],this.extent)}}class LR{constructor(i){this.layers={};let l=(function(h,m,_=!0){let y=new wV(0),T=[];for(;y.get()<h.length;){let I=Kr(h,y,1)[0]>>>0,P=y.get()+I;if(P>h.length)throw new Error(`Block overruns tile: ${P} > ${h.length}`);if(Kr(h,y,1)[0]>>>0!=1){y.set(P);continue}let O=FV(h,y),N=O[1],j=O[0].featureTables[0],V=null,Z=null,X=[],K=0;for(let he of j.columns){let re=he.name;if(re==="id"){let oe=null;if(he.nullable){let ve=Ko(h,y),Oe=y.get(),qe=B_(h,ve.numValues,y);y.set(Oe+ve.byteLength),oe=new El(qe,ve.numValues)}let pe=Ko(h,y);K=pe.decompressedCount,V=NV(h,he,y,re,pe,oe??K,_)}else if(re==="geometry"){let oe=Kr(h,y,1)[0];if(K===0){let pe=y.get();K=Ko(h,y).decompressedCount,y.set(pe)}Z=DV(h,oe,y,K)}else{let oe=LV(he)?Kr(h,y,1)[0]:1;if(oe===0&&he.type==="scalarType")continue;let pe=RV(h,y,he,oe,K);if(pe)if(Array.isArray(pe))for(let ve of pe)X.push(ve);else X.push(pe)}}let ne=new bV(j.name,Z,V,X,N);T.push(ne),y.set(P)}return T})(new Uint8Array(i));this.layers=l.reduce((h,m)=>Object.assign(Object.assign({},h),{[m.name]:new BV(m)}),{})}}class jV{constructor(i,l){this.feature=i,this.type=i.type,this.properties=i.tags?i.tags:{},this.extent=l,"id"in i&&(typeof i.id=="string"?this.id=parseInt(i.id,10):typeof i.id!="number"||isNaN(i.id)||(this.id=i.id))}loadGeometry(){let i=[],l=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(let h of l){let m=[];for(let _ of h)m.push(new f(_[0],_[1]));i.push(m)}return i}}let V_="_geojsonTileLayer";function VV(c,i){i.writeVarintField(15,c.version||1),i.writeStringField(1,c.name||""),i.writeVarintField(5,c.extent||4096);let l={keys:[],values:[],keycache:{},valuecache:{}};for(let _=0;_<c.length;_++)l.feature=c.feature(_),i.writeMessage(2,UV,l);let h=l.keys;for(let _ of h)i.writeStringField(3,_);let m=l.values;for(let _ of m)i.writeMessage(4,HV,_)}function UV(c,i){if(!c.feature)return;let l=c.feature;l.id!==void 0&&i.writeVarintField(1,l.id),i.writeMessage(2,GV,c),i.writeVarintField(3,l.type),i.writeMessage(4,$V,l)}function GV(c,i){for(let l in c.feature?.properties){let h=c.feature.properties[l],m=c.keycache[l];if(h==null)continue;m===void 0&&(c.keys.push(l),m=c.keys.length-1,c.keycache[l]=m),i.writeVarint(m),typeof h!="string"&&typeof h!="boolean"&&typeof h!="number"&&(h=JSON.stringify(h));let _=typeof h+":"+h,y=c.valuecache[_];y===void 0&&(c.values.push(h),y=c.values.length-1,c.valuecache[_]=y),i.writeVarint(y)}}function $E(c,i){return(i<<3)+(7&c)}function OR(c){return c<<1^c>>31}function $V(c,i){let l=c.loadGeometry(),h=c.type,m=0,_=0;for(let y of l){let T=1;h===1&&(T=y.length),i.writeVarint($E(1,T));let I=h===3?y.length-1:y.length;for(let P=0;P<I;P++){P===1&&h!==1&&i.writeVarint($E(2,I-1));let O=y[P].x-m,N=y[P].y-_;i.writeVarint(OR(O)),i.writeVarint(OR(N)),m+=O,_+=N}c.type===3&&i.writeVarint($E(7,1))}}function HV(c,i){let l=typeof c;l==="string"?i.writeStringField(1,c):l==="boolean"?i.writeBooleanField(7,c):l==="number"&&(c%1!=0?i.writeDoubleField(3,c):c<0?i.writeSVarintField(6,c):i.writeVarintField(5,c))}class kR{constructor(i,l){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Dh(ft,16,0),this.grid3D=new Dh(ft,16,0),this.featureIndexArray=new ee,this.promoteId=l}insert(i,l,h,m,_,y){let T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,m,_);let I=y?this.grid3D:this.grid;for(let P=0;P<l.length;P++){let O=l[P],N=[1/0,1/0,-1/0,-1/0];for(let j=0;j<O.length;j++){let V=O[j];N[0]=Math.min(N[0],V.x),N[1]=Math.min(N[1],V.y),N[2]=Math.max(N[2],V.x),N[3]=Math.max(N[3],V.y)}N[0]<ft&&N[1]<ft&&N[2]>=0&&N[3]>=0&&I.insert(T,N[0],N[1],N[2],N[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new xA(new M0(this.rawTileData)).layers:new LR(this.rawTileData).layers,this.sourceLayerCoder=new iR(this.vtLayers?Object.keys(this.vtLayers).sort():[V_])),this.vtLayers}query(i,l,h,m){this.loadVTLayers();let _=i.params,y=ft/i.tileSize/i.scale,T=It(_.filter,_.globalState),I=i.queryGeometry,P=i.queryPadding*y,O=Jd.fromPoints(I),N=this.grid.query(O.minX-P,O.minY-P,O.maxX+P,O.maxY+P),j=Jd.fromPoints(i.cameraQueryGeometry).expandBy(P),V=this.grid3D.query(j.minX,j.minY,j.maxX,j.maxY,(K,ne,he,re)=>(function(oe,pe,ve,Oe,qe){for(let We of oe)if(pe<=We.x&&ve<=We.y&&Oe>=We.x&&qe>=We.y)return!0;let Ze=[new f(pe,ve),new f(pe,qe),new f(Oe,qe),new f(Oe,ve)];if(oe.length>2){for(let We of Ze)if(Wp(oe,We))return!0}for(let We=0;We<oe.length-1;We++)if(qj(oe[We],oe[We+1],Ze))return!0;return!1})(i.cameraQueryGeometry,K-P,ne-P,he+P,re+P));for(let K of V)N.push(K);N.sort(ZV);let Z={},X;for(let K=0;K<N.length;K++){let ne=N[K];if(ne===X)continue;X=ne;let he=this.featureIndexArray.get(ne),re=null;this.loadMatchingFeature(Z,he.bucketIndex,he.sourceLayerIndex,he.featureIndex,T,_.layers,_.availableImages,l,h,m,(oe,pe,ve)=>(re||(re=Tc(oe)),pe.queryIntersectsFeature({queryGeometry:I,feature:oe,featureState:ve,geometry:re,zoom:this.z,transform:i.transform,pixelsToTileUnits:y,pixelPosMatrix:i.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:i.getElevation})))}return Z}loadMatchingFeature(i,l,h,m,_,y,T,I,P,O,N){let j=this.bucketLayerIDs[l];if(y&&!j.some(K=>y.has(K)))return;let V=this.sourceLayerCoder.decode(h),Z=this.vtLayers[V].feature(m);if(_.needGeometry){let K=Cc(Z,!0);if(!_.filter(new ui(this.tileID.overscaledZ),K,this.tileID.canonical))return}else if(!_.filter(new ui(this.tileID.overscaledZ),Z))return;let X=this.getId(Z,V);for(let K=0;K<j.length;K++){let ne=j[K];if(y&&!y.has(ne))continue;let he=I[ne];if(!he)continue;let re={};X&&O&&(re=O.getState(he.sourceLayer||V_,X));let oe=kn({},P[ne]);oe.paint=FR(oe.paint,he.paint,Z,re,T),oe.layout=FR(oe.layout,he.layout,Z,re,T);let pe=!N||N(Z,he,re);if(!pe)continue;let ve=new rR(Z,this.z,this.x,this.y,X);ve.layer=oe;let Oe=i[ne];Oe===void 0&&(Oe=i[ne]=[]),Oe.push({featureIndex:m,feature:ve,intersectionZ:pe})}}lookupSymbolFeatures(i,l,h,m,_,y,T,I){let P={};this.loadVTLayers();let O=It(_.filterSpec,_.globalState);for(let N of i)this.loadMatchingFeature(P,h,m,N,O,y,T,I,l);return P}hasLayer(i){for(let l of this.bucketLayerIDs)for(let h of l)if(i===h)return!0;return!1}getId(i,l){var h;let m=i.id;return this.promoteId&&(m=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]],typeof m=="boolean"&&(m=Number(m)),m===void 0&&(!((h=i.properties)===null||h===void 0)&&h.cluster)&&this.promoteId&&(m=Number(i.properties.cluster_id))),m}}function FR(c,i,l,h,m){return Zi(c,(_,y)=>{let T=i instanceof Vd?i.get(y):null;return T&&T.evaluate?T.evaluate(l,h,m):T})}function ZV(c,i){return i-c}function NR(c,i,l,h,m){let _=[];for(let y=0;y<c.length;y++){let T=c[y],I;for(let P=0;P<T.length-1;P++){let O=T[P],N=T[P+1];O.x<i&&N.x<i||(O.x<i?O=new f(i,O.y+(i-O.x)/(N.x-O.x)*(N.y-O.y))._round():N.x<i&&(N=new f(i,O.y+(i-O.x)/(N.x-O.x)*(N.y-O.y))._round()),O.y<l&&N.y<l||(O.y<l?O=new f(O.x+(l-O.y)/(N.y-O.y)*(N.x-O.x),l)._round():N.y<l&&(N=new f(O.x+(l-O.y)/(N.y-O.y)*(N.x-O.x),l)._round()),O.x>=h&&N.x>=h||(O.x>=h?O=new f(h,O.y+(h-O.x)/(N.x-O.x)*(N.y-O.y))._round():N.x>=h&&(N=new f(h,O.y+(h-O.x)/(N.x-O.x)*(N.y-O.y))._round()),O.y>=m&&N.y>=m||(O.y>=m?O=new f(O.x+(m-O.y)/(N.y-O.y)*(N.x-O.x),m)._round():N.y>=m&&(N=new f(O.x+(m-O.y)/(N.y-O.y)*(N.x-O.x),m)._round()),I&&O.equals(I[I.length-1])||(I=[O],_.push(I)),I.push(N)))))}}return _}function zR(c,i,l,h,m){switch(i){case 1:return(function(_,y,T,I){let P=[];for(let O of _)for(let N of O){let j=I===0?N.x:N.y;j>=y&&j<=T&&P.push([N])}return P})(c,l,h,m);case 2:return BR(c,l,h,m,!1);case 3:return BR(c,l,h,m,!0)}return[]}function qV(c,i,l,h,m){let _=h===0?WV:XV,y=[],T=[];for(let O=0;O<c.length-1;O++){let N=c[O],j=c[O+1],V=h===0?N.x:N.y,Z=h===0?j.x:j.y,X=!1;V<i?Z>i&&y.push(_(N,j,i)):V>l?Z<l&&y.push(_(N,j,l)):y.push(N),Z<i&&V>=i&&(y.push(_(N,j,i)),X=!0),Z>l&&V<=l&&(y.push(_(N,j,l)),X=!0),!m&&X&&(T.push(y),y=[])}let I=c.length-1,P=h===0?c[I].x:c[I].y;return P>=i&&P<=l&&y.push(c[I]),m&&y.length>0&&!y[0].equals(y[y.length-1])&&y.push(new f(y[0].x,y[0].y)),y.length>0&&T.push(y),T}function BR(c,i,l,h,m){let _=[];for(let y of c){let T=qV(y,i,l,h,m);T.length>0&&_.push(...T)}return _}function WV(c,i,l){return new f(l,c.y+(l-c.x)/(i.x-c.x)*(i.y-c.y))}function XV(c,i,l){return new f(c.x+(l-c.y)/(i.y-c.y)*(i.x-c.x),l)}wt("FeatureIndex",kR,{omit:["rawTileData","sourceLayerCoder"]});class Fh extends f{constructor(i,l,h,m){super(i,l),this.angle=h,m!==void 0&&(this.segment=m)}clone(){return new Fh(this.x,this.y,this.angle,this.segment)}}function jR(c,i,l,h,m){if(i.segment===void 0||l===0)return!0;let _=i,y=i.segment+1,T=0;for(;T>-l/2;){if(y--,y<0)return!1;T-=c[y].dist(_),_=c[y]}T+=c[y].dist(c[y+1]),y++;let I=[],P=0;for(;T<l/2;){let O=c[y],N=c[y+1];if(!N)return!1;let j=c[y-1].angleTo(O)-O.angleTo(N);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:T,angleDelta:j}),P+=j;T-I[0].distance>h;)P-=I.shift().angleDelta;if(P>m)return!1;y++,T+=O.dist(N)}return!0}function VR(c){let i=0;for(let l=0;l<c.length-1;l++)i+=c[l].dist(c[l+1]);return i}function UR(c,i,l){return c?.6*i*l:0}function GR(c,i){return Math.max(c?c.right-c.left:0,i?i.right-i.left:0)}function YV(c,i,l,h,m,_){let y=UR(l,m,_),T=GR(l,h)*_,I=0,P=VR(c)/2;for(let O=0;O<c.length-1;O++){let N=c[O],j=c[O+1],V=N.dist(j);if(I+V>P){let Z=(P-I)/V,X=mi.number(N.x,j.x,Z),K=mi.number(N.y,j.y,Z),ne=new Fh(X,K,j.angleTo(N),O);return ne._round(),!y||jR(c,ne,T,y,i)?ne:void 0}I+=V}}function KV(c,i,l,h,m,_,y,T,I){let P=UR(h,_,y),O=GR(h,m),N=O*y,j=c[0].x===0||c[0].x===I||c[0].y===0||c[0].y===I;return i-N<i/4&&(i=N+i/4),$R(c,j?i/2*T%i:(O/2+2*_)*y*T%i,i,P,l,N,j,!1,I)}function $R(c,i,l,h,m,_,y,T,I){let P=_/2,O=VR(c),N=0,j=i-l,V=[];for(let Z=0;Z<c.length-1;Z++){let X=c[Z],K=c[Z+1],ne=X.dist(K),he=K.angleTo(X);for(;j+l<N+ne;){j+=l;let re=(j-N)/ne,oe=mi.number(X.x,K.x,re),pe=mi.number(X.y,K.y,re);if(oe>=0&&oe<I&&pe>=0&&pe<I&&j-P>=0&&j+P<=O){let ve=new Fh(oe,pe,he,Z);ve._round(),h&&!jR(c,ve,_,h,m)||V.push(ve)}}N+=ne}return T||V.length||y||(V=$R(c,N/2,l,h,m,_,y,!0,I)),V}function HR(c,i,l,h){let m=[],_=c.image,y=_.pixelRatio,T=_.paddedRect.w-2,I=_.paddedRect.h-2,P={x1:c.left,y1:c.top,x2:c.right,y2:c.bottom},O=_.stretchX||[[0,T]],N=_.stretchY||[[0,I]],j=(Ve,vt)=>Ve+vt[1]-vt[0],V=O.reduce(j,0),Z=N.reduce(j,0),X=T-V,K=I-Z,ne=0,he=V,re=0,oe=Z,pe=0,ve=X,Oe=0,qe=K;if(_.content&&h){let Ve=_.content,vt=Ve[2]-Ve[0],gt=Ve[3]-Ve[1];(_.textFitWidth||_.textFitHeight)&&(P=jA(c)),ne=V0(O,0,Ve[0]),re=V0(N,0,Ve[1]),he=V0(O,Ve[0],Ve[2]),oe=V0(N,Ve[1],Ve[3]),pe=Ve[0]-ne,Oe=Ve[1]-re,ve=vt-he,qe=gt-oe}let Ze=P.x1,We=P.y1,ut=P.x2-Ze,nt=P.y2-We,$e=(Ve,vt,gt,Tt)=>{let _t=U0(Ve.stretch-ne,he,ut,Ze),kt=G0(Ve.fixed-pe,ve,Ve.stretch,V),Nn=U0(vt.stretch-re,oe,nt,We),En=G0(vt.fixed-Oe,qe,vt.stretch,Z),Oi=U0(gt.stretch-ne,he,ut,Ze),po=G0(gt.fixed-pe,ve,gt.stretch,V),dr=U0(Tt.stretch-re,oe,nt,We),ki=G0(Tt.fixed-Oe,qe,Tt.stretch,Z),Si=new f(_t,Nn),Jn=new f(Oi,Nn),Ki=new f(Oi,dr),nr=new f(_t,dr),wi=new f(kt/y,En/y),ms=new f(po/y,ki/y),mo=i*Math.PI/180;if(mo){let Lr=Math.sin(mo),Gi=Math.cos(mo),fr=[Gi,-Lr,Lr,Gi];Si._matMult(fr),Jn._matMult(fr),nr._matMult(fr),Ki._matMult(fr)}let gs=Ve.stretch+Ve.fixed,qa=vt.stretch+vt.fixed;return{tl:Si,tr:Jn,bl:nr,br:Ki,tex:{x:_.paddedRect.x+1+gs,y:_.paddedRect.y+1+qa,w:gt.stretch+gt.fixed-gs,h:Tt.stretch+Tt.fixed-qa},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:wi,pixelOffsetBR:ms,minFontScaleX:ve/y/ut,minFontScaleY:qe/y/nt,isSDF:l}};if(h&&(_.stretchX||_.stretchY)){let Ve=ZR(O,X,V),vt=ZR(N,K,Z);for(let gt=0;gt<Ve.length-1;gt++){let Tt=Ve[gt],_t=Ve[gt+1];for(let kt=0;kt<vt.length-1;kt++)m.push($e(Tt,vt[kt],_t,vt[kt+1]))}}else m.push($e({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:I+1}));return m}function V0(c,i,l){let h=0;for(let m of c)h+=Math.max(i,Math.min(l,m[1]))-Math.max(i,Math.min(l,m[0]));return h}function ZR(c,i,l){let h=[{fixed:-1,stretch:0}];for(let[m,_]of c){let y=h[h.length-1];h.push({fixed:m-y.stretch,stretch:y.stretch}),h.push({fixed:m-y.stretch,stretch:y.stretch+(_-m)})}return h.push({fixed:i+1,stretch:l}),h}function U0(c,i,l,h){return c/i*l+h}function G0(c,i,l,h){return c-i*l/h}wt("Anchor",Fh);class $0{constructor(i,l,h,m,_,y,T,I,P,O){var N;if(this.boxStartIndex=i.length,P){let j=y.top,V=y.bottom,Z=y.collisionPadding;Z&&(j-=Z[1],V+=Z[3]);let X=V-j;X>0&&(X=Math.max(10,X),this.circleDiameter=X)}else{let j=!((N=y.image)===null||N===void 0)&&N.content&&(y.image.textFitWidth||y.image.textFitHeight)?jA(y):{x1:y.left,y1:y.top,x2:y.right,y2:y.bottom};j.y1=j.y1*T-I[0],j.y2=j.y2*T+I[2],j.x1=j.x1*T-I[3],j.x2=j.x2*T+I[1];let V=y.collisionPadding;if(V&&(j.x1-=V[0]*T,j.y1-=V[1]*T,j.x2+=V[2]*T,j.y2+=V[3]*T),O){let Z=new f(j.x1,j.y1),X=new f(j.x2,j.y1),K=new f(j.x1,j.y2),ne=new f(j.x2,j.y2),he=O*Math.PI/180;Z._rotate(he),X._rotate(he),K._rotate(he),ne._rotate(he),j.x1=Math.min(Z.x,X.x,K.x,ne.x),j.x2=Math.max(Z.x,X.x,K.x,ne.x),j.y1=Math.min(Z.y,X.y,K.y,ne.y),j.y2=Math.max(Z.y,X.y,K.y,ne.y)}i.emplaceBack(l.x,l.y,j.x1,j.y1,j.x2,j.y2,h,m,_)}this.boxEndIndex=i.length}}class JV{constructor(i=[],l=(h,m)=>h<m?-1:h>m?1:0){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;let i=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){let{data:l,compare:h}=this,m=l[i];for(;i>0;){let _=i-1>>1,y=l[_];if(h(m,y)>=0)break;l[i]=y,i=_}l[i]=m}_down(i){let{data:l,compare:h}=this,m=this.length>>1,_=l[i];for(;i<m;){let y=1+(i<<1),T=y+1;if(T<this.length&&h(l[T],l[y])<0&&(y=T),h(l[y],_)>=0)break;l[i]=l[y],i=y}l[i]=_}}function QV(c,i=1,l=!1){let h=Jd.fromPoints(c[0]),m=Math.min(h.width(),h.height()),_=m/2,y=new JV([],eU),{minX:T,minY:I,maxX:P,maxY:O}=h;if(m===0)return new f(T,I);for(let V=T;V<P;V+=m)for(let Z=I;Z<O;Z+=m)y.push(new am(V+_,Z+_,_,c));let N=(function(V){let Z=0,X=0,K=0,ne=V[0];for(let he=0,re=ne.length,oe=re-1;he<re;oe=he++){let pe=ne[he],ve=ne[oe],Oe=pe.x*ve.y-ve.x*pe.y;X+=(pe.x+ve.x)*Oe,K+=(pe.y+ve.y)*Oe,Z+=3*Oe}return new am(X/Z,K/Z,0,V)})(c),j=y.length;for(;y.length;){let V=y.pop();(V.d>N.d||!N.d)&&(N=V,l&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,j)),V.max-N.d<=i||(_=V.h/2,y.push(new am(V.p.x-_,V.p.y-_,_,c)),y.push(new am(V.p.x+_,V.p.y-_,_,c)),y.push(new am(V.p.x-_,V.p.y+_,_,c)),y.push(new am(V.p.x+_,V.p.y+_,_,c)),j+=4)}return l&&(console.log(`num probes: ${j}`),console.log(`best distance: ${N.d}`)),N.p}function eU(c,i){return i.max-c.max}function am(c,i,l,h){this.p=new f(c,i),this.h=l,this.d=(function(m,_){let y=!1,T=1/0;for(let I=0;I<_.length;I++){let P=_[I];for(let O=0,N=P.length,j=N-1;O<N;j=O++){let V=P[O],Z=P[j];V.y>m.y!=Z.y>m.y&&m.x<(Z.x-V.x)*(m.y-V.y)/(Z.y-V.y)+V.x&&(y=!y),T=Math.min(T,KP(m,V,Z))}}return(y?1:-1)*Math.sqrt(T)})(this.p,h),this.max=this.d+this.h*Math.SQRT2}var fo;a.aP=void 0,(fo=a.aP||(a.aP={}))[fo.center=1]="center",fo[fo.left=2]="left",fo[fo.right=3]="right",fo[fo.top=4]="top",fo[fo.bottom=5]="bottom",fo[fo["top-left"]=6]="top-left",fo[fo["top-right"]=7]="top-right",fo[fo["bottom-left"]=8]="bottom-left",fo[fo["bottom-right"]=9]="bottom-right";let HE=Number.POSITIVE_INFINITY;function qR(c,i){return i[1]!==HE?(function(l,h,m){let _=0,y=0;switch(h=Math.abs(h),m=Math.abs(m),l){case"top-right":case"top-left":case"top":y=m-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-m}switch(l){case"top-right":case"bottom-right":case"right":_=-h;break;case"top-left":case"bottom-left":case"left":_=h}return[_,y]})(c,i[0],i[1]):(function(l,h){let m=0,_=0;h<0&&(h=0);let y=h/Math.SQRT2;switch(l){case"top-right":case"top-left":_=y-7;break;case"bottom-right":case"bottom-left":_=7-y;break;case"bottom":_=7-h;break;case"top":_=h-7}switch(l){case"top-right":case"bottom-right":m=-y;break;case"top-left":case"bottom-left":m=y;break;case"left":m=h;break;case"right":m=-h}return[m,_]})(c,i[0])}function WR(c,i,l){var h;let m=c.layout,_=(h=m.get("text-variable-anchor-offset"))===null||h===void 0?void 0:h.evaluate(i,{},l);if(_){let T=_.values,I=[];for(let P=0;P<T.length;P+=2){let O=I[P]=T[P],N=T[P+1].map(j=>j*Pr);O.startsWith("top")?N[1]-=7:O.startsWith("bottom")&&(N[1]+=7),I[P+1]=N}return new vr(I)}let y=m.get("text-variable-anchor");if(y){let T;T=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[m.get("text-radial-offset").evaluate(i,{},l)*Pr,HE]:m.get("text-offset").evaluate(i,{},l).map(P=>P*Pr);let I=[];for(let P of y)I.push(P,qR(P,T));return new vr(I)}return null}function ZE(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tU(c,i,l,h,m,_,y,T,I,P,O,N){let j=_.textMaxSize.evaluate(i,{});j===void 0&&(j=y);let V=c.layers[0].layout,Z=V.get("icon-offset").evaluate(i,{},O),X=YR(l.horizontal),K=y/24,ne=c.tilePixelRatio*K,he=c.tilePixelRatio*j/24,re=c.tilePixelRatio*T,oe=c.tilePixelRatio*V.get("symbol-spacing"),pe=V.get("text-padding")*c.tilePixelRatio,ve=(function(gt,Tt,_t,kt=1){let Nn=gt.get("icon-padding").evaluate(Tt,{},_t),En=Nn&&Nn.values;return[En[0]*kt,En[1]*kt,En[2]*kt,En[3]*kt]})(V,i,O,c.tilePixelRatio),Oe=V.get("text-max-angle")/180*Math.PI,qe=V.get("text-rotation-alignment")!=="viewport"&&V.get("symbol-placement")!=="point",Ze=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",We=V.get("symbol-placement"),ut=oe/2,nt=V.get("icon-text-fit"),$e;h&&nt!=="none"&&(c.allowVerticalPlacement&&l.vertical&&($e=VA(h,l.vertical,nt,V.get("icon-text-fit-padding"),Z,K)),X&&(h=VA(h,X,nt,V.get("icon-text-fit-padding"),Z,K)));let Ve=O?N.line.getGranularityForZoomLevel(O.z):1,vt=(gt,Tt)=>{Tt.x<0||Tt.x>=ft||Tt.y<0||Tt.y>=ft||(function(_t,kt,Nn,En,Oi,po,dr,ki,Si,Jn,Ki,nr,wi,ms,mo,gs,qa,Lr,Gi,fr,Ji,Or,wu,Tl,$_){let Nh=_t.addToLineVertexArray(kt,Nn),tf,lm,cm,um,e2=0,t2=0,n2=0,i2=0,eT=-1,tT=-1,Eu={},r2=tr("");if(_t.allowVerticalPlacement&&En.vertical){let Fo=ki.layout.get("text-rotate").evaluate(Ji,{},Tl)+90;cm=new $0(Si,kt,Jn,Ki,nr,En.vertical,wi,ms,mo,Fo),dr&&(um=new $0(Si,kt,Jn,Ki,nr,dr,qa,Lr,mo,Fo))}if(Oi){let Fo=ki.layout.get("icon-rotate").evaluate(Ji,{}),va=ki.layout.get("icon-text-fit")!=="none",nf=HR(Oi,Fo,wu,va),Il=dr?HR(dr,Fo,wu,va):void 0;lm=new $0(Si,kt,Jn,Ki,nr,Oi,qa,Lr,!1,Fo),e2=4*nf.length;let rf=_t.iconSizeData,Ic=null;rf.kind==="source"?(Ic=[xu*ki.layout.get("icon-size").evaluate(Ji,{})],Ic[0]>Lh&&zi(`${_t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):rf.kind==="composite"&&(Ic=[xu*Or.compositeIconSizes[0].evaluate(Ji,{},Tl),xu*Or.compositeIconSizes[1].evaluate(Ji,{},Tl)],(Ic[0]>Lh||Ic[1]>Lh)&&zi(`${_t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),_t.addSymbols(_t.icon,nf,Ic,fr,Gi,Ji,a.az.none,kt,Nh.lineStartIndex,Nh.lineLength,-1,Tl),eT=_t.icon.placedSymbolArray.length-1,Il&&(t2=4*Il.length,_t.addSymbols(_t.icon,Il,Ic,fr,Gi,Ji,a.az.vertical,kt,Nh.lineStartIndex,Nh.lineLength,-1,Tl),tT=_t.icon.placedSymbolArray.length-1)}let o2=Object.keys(En.horizontal);for(let Fo of o2){let va=En.horizontal[Fo];if(!tf){r2=tr(va.text);let Il=ki.layout.get("text-rotate").evaluate(Ji,{},Tl);tf=new $0(Si,kt,Jn,Ki,nr,va,wi,ms,mo,Il)}let nf=va.positionedLines.length===1;if(n2+=XR(_t,kt,va,po,ki,mo,Ji,gs,Nh,En.vertical?a.az.horizontal:a.az.horizontalOnly,nf?o2:[Fo],Eu,eT,Or,Tl),nf)break}En.vertical&&(i2+=XR(_t,kt,En.vertical,po,ki,mo,Ji,gs,Nh,a.az.vertical,["vertical"],Eu,tT,Or,Tl));let rU=tf?tf.boxStartIndex:_t.collisionBoxArray.length,oU=tf?tf.boxEndIndex:_t.collisionBoxArray.length,sU=cm?cm.boxStartIndex:_t.collisionBoxArray.length,aU=cm?cm.boxEndIndex:_t.collisionBoxArray.length,lU=lm?lm.boxStartIndex:_t.collisionBoxArray.length,cU=lm?lm.boxEndIndex:_t.collisionBoxArray.length,uU=um?um.boxStartIndex:_t.collisionBoxArray.length,hU=um?um.boxEndIndex:_t.collisionBoxArray.length,Cl=-1,Z0=(Fo,va)=>Fo&&Fo.circleDiameter?Math.max(Fo.circleDiameter,va):va;Cl=Z0(tf,Cl),Cl=Z0(cm,Cl),Cl=Z0(lm,Cl),Cl=Z0(um,Cl);let s2=Cl>-1?1:0;s2&&(Cl*=$_/Pr),_t.glyphOffsetArray.length>=tm.MAX_GLYPHS&&zi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ji.sortKey!==void 0&&_t.addToSortKeyRanges(_t.symbolInstances.length,Ji.sortKey);let dU=WR(ki,Ji,Tl),[fU,pU]=(function(Fo,va){let nf=Fo.length,Il=va?.values;if(Il?.length>0)for(let rf=0;rf<Il.length;rf+=2){let Ic=Il[rf+1];Fo.emplaceBack(a.aP[Il[rf]],Ic[0],Ic[1])}return[nf,Fo.length]})(_t.textAnchorOffsets,dU);_t.symbolInstances.emplaceBack(kt.x,kt.y,Eu.right>=0?Eu.right:-1,Eu.center>=0?Eu.center:-1,Eu.left>=0?Eu.left:-1,Eu.vertical||-1,eT,tT,r2,rU,oU,sU,aU,lU,cU,uU,hU,Jn,n2,i2,e2,t2,s2,0,wi,Cl,fU,pU)})(c,Tt,gt,l,h,m,$e,c.layers[0],c.collisionBoxArray,i.index,i.sourceLayerIndex,c.index,ne,[pe,pe,pe,pe],qe,I,re,ve,Ze,Z,i,_,P,O,y)};if(We==="line")for(let gt of NR(i.geometry,0,0,ft,ft)){let Tt=Kd(gt,Ve),_t=KV(Tt,oe,Oe,l.vertical||X,h,24,he,c.overscaling,ft);for(let kt of _t)X&&nU(c,X.text,ut,kt)||vt(Tt,kt)}else if(We==="line-center"){for(let gt of i.geometry)if(gt.length>1){let Tt=Kd(gt,Ve),_t=YV(Tt,Oe,l.vertical||X,h,24,he);_t&&vt(Tt,_t)}}else if(i.type==="Polygon")for(let gt of lc(i.geometry,0)){let Tt=QV(gt,16);vt(Kd(gt[0],Ve,!0),new Fh(Tt.x,Tt.y,0))}else if(i.type==="LineString")for(let gt of i.geometry){let Tt=Kd(gt,Ve);vt(Tt,new Fh(Tt[0].x,Tt[0].y,0))}else if(i.type==="Point")for(let gt of i.geometry)for(let Tt of gt)vt([Tt],new Fh(Tt.x,Tt.y,0))}function XR(c,i,l,h,m,_,y,T,I,P,O,N,j,V,Z){let X=(function(he,re,oe,pe,ve,Oe,qe,Ze){let We=pe.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,ut=[];for(let nt of re.positionedLines)for(let $e of nt.positionedGlyphs){if(!$e.rect)continue;let Ve=$e.rect||{},vt=4,gt=!0,Tt=1,_t=0,kt=(ve||Ze)&&$e.vertical,Nn=$e.metrics.advance*$e.scale/2;if(Ze&&re.verticalizable&&(_t=nt.lineOffset/2-($e.imageName?-(Pr-$e.metrics.width*$e.scale)/2:($e.scale-1)*Pr)),$e.imageName){let Lr=qe[$e.imageName];gt=Lr.sdf,Tt=Lr.pixelRatio,vt=1/Tt}let En=ve?[$e.x+Nn,$e.y]:[0,0],Oi=ve?[0,0]:[$e.x+Nn+oe[0],$e.y+oe[1]-_t],po=[0,0];kt&&(po=Oi,Oi=[0,0]);let dr=$e.metrics.isDoubleResolution?2:1,ki=($e.metrics.left-vt)*$e.scale-Nn+Oi[0],Si=(-$e.metrics.top-vt)*$e.scale+Oi[1],Jn=ki+Ve.w/dr*$e.scale/Tt,Ki=Si+Ve.h/dr*$e.scale/Tt,nr=new f(ki,Si),wi=new f(Jn,Si),ms=new f(ki,Ki),mo=new f(Jn,Ki);if(kt){let Lr=new f(-Nn,Nn- -17),Gi=-Math.PI/2,fr=12-Nn,Ji=new f(22-fr,-($e.imageName?fr:0)),Or=new f(...po);nr._rotateAround(Gi,Lr)._add(Ji)._add(Or),wi._rotateAround(Gi,Lr)._add(Ji)._add(Or),ms._rotateAround(Gi,Lr)._add(Ji)._add(Or),mo._rotateAround(Gi,Lr)._add(Ji)._add(Or)}if(We){let Lr=Math.sin(We),Gi=Math.cos(We),fr=[Gi,-Lr,Lr,Gi];nr._matMult(fr),wi._matMult(fr),ms._matMult(fr),mo._matMult(fr)}let gs=new f(0,0),qa=new f(0,0);ut.push({tl:nr,tr:wi,bl:ms,br:mo,tex:Ve,writingMode:re.writingMode,glyphOffset:En,sectionIndex:$e.sectionIndex,isSDF:gt,pixelOffsetTL:gs,pixelOffsetBR:qa,minFontScaleX:0,minFontScaleY:0})}return ut})(0,l,T,m,_,y,h,c.allowVerticalPlacement),K=c.textSizeData,ne=null;K.kind==="source"?(ne=[xu*m.layout.get("text-size").evaluate(y,{})],ne[0]>Lh&&zi(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):K.kind==="composite"&&(ne=[xu*V.compositeTextSizes[0].evaluate(y,{},Z),xu*V.compositeTextSizes[1].evaluate(y,{},Z)],(ne[0]>Lh||ne[1]>Lh)&&zi(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),c.addSymbols(c.text,X,ne,T,_,y,P,i,I.lineStartIndex,I.lineLength,j,Z);for(let he of O)N[he]=c.text.placedSymbolArray.length-1;return 4*X.length}function YR(c){for(let i in c)return c[i];return null}function nU(c,i,l,h){let m=c.compareText;if(i in m){let _=m[i];for(let y=_.length-1;y>=0;y--)if(h.dist(_[y])<l)return!0}else m[i]=[];return m[i].push(h),!1}let KR=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class qE{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[l,h]=new Uint8Array(i,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");let m=h>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);let _=KR[15&h];if(!_)throw new Error("Unrecognized array type.");let[y]=new Uint16Array(i,2,1),[T]=new Uint32Array(i,4,1);return new qE(T,y,_,i)}constructor(i,l=64,h=Float64Array,m){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=h,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;let _=KR.indexOf(this.ArrayType),y=2*i*this.ArrayType.BYTES_PER_ELEMENT,T=i*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-T%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${h}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+T+I,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+y+T+I),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+T+I,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=i)}add(i,l){let h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=i,this.coords[this._pos++]=l,h}finish(){let i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return WE(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,l,h,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:_,coords:y,nodeSize:T}=this,I=[0,_.length-1,0],P=[];for(;I.length;){let O=I.pop()||0,N=I.pop()||0,j=I.pop()||0;if(N-j<=T){for(let K=j;K<=N;K++){let ne=y[2*K],he=y[2*K+1];ne>=i&&ne<=h&&he>=l&&he<=m&&P.push(_[K])}continue}let V=j+N>>1,Z=y[2*V],X=y[2*V+1];Z>=i&&Z<=h&&X>=l&&X<=m&&P.push(_[V]),(O===0?i<=Z:l<=X)&&(I.push(j),I.push(V-1),I.push(1-O)),(O===0?h>=Z:m>=X)&&(I.push(V+1),I.push(N),I.push(1-O))}return P}within(i,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:m,coords:_,nodeSize:y}=this,T=[0,m.length-1,0],I=[],P=h*h;for(;T.length;){let O=T.pop()||0,N=T.pop()||0,j=T.pop()||0;if(N-j<=y){for(let K=j;K<=N;K++)QR(_[2*K],_[2*K+1],i,l)<=P&&I.push(m[K]);continue}let V=j+N>>1,Z=_[2*V],X=_[2*V+1];QR(Z,X,i,l)<=P&&I.push(m[V]),(O===0?i-h<=Z:l-h<=X)&&(T.push(j),T.push(V-1),T.push(1-O)),(O===0?i+h>=Z:l+h>=X)&&(T.push(V+1),T.push(N),T.push(1-O))}return I}}function WE(c,i,l,h,m,_){if(m-h<=l)return;let y=h+m>>1;JR(c,i,y,h,m,_),WE(c,i,l,h,y-1,1-_),WE(c,i,l,y+1,m,1-_)}function JR(c,i,l,h,m,_){for(;m>h;){if(m-h>600){let P=m-h+1,O=l-h+1,N=Math.log(P),j=.5*Math.exp(2*N/3),V=.5*Math.sqrt(N*j*(P-j)/P)*(O-P/2<0?-1:1);JR(c,i,l,Math.max(h,Math.floor(l-O*j/P+V)),Math.min(m,Math.floor(l+(P-O)*j/P+V)),_)}let y=i[2*l+_],T=h,I=m;for(U_(c,i,h,l),i[2*m+_]>y&&U_(c,i,h,m);T<I;){for(U_(c,i,T,I),T++,I--;i[2*T+_]<y;)T++;for(;i[2*I+_]>y;)I--}i[2*h+_]===y?U_(c,i,h,I):(I++,U_(c,i,I,m)),I<=l&&(h=I+1),l<=I&&(m=I-1)}}function U_(c,i,l,h){XE(c,l,h),XE(i,2*l,2*h),XE(i,2*l+1,2*h+1)}function XE(c,i,l){let h=c[i];c[i]=c[l],c[l]=h}function QR(c,i,l,h){let m=c-l,_=i-h;return m*m+_*_}var YE;a.cI=void 0,(YE=a.cI||(a.cI={})).create="create",YE.load="load",YE.fullLoad="fullLoad";let H0=null,G_=[],KE=1e3/60,JE="loadTime",QE="fullLoadTime",iU={mark(c){performance.mark(c)},frame(c){let i=c;H0!=null&&G_.push(i-H0),H0=i},clearMetrics(){H0=null,G_=[],performance.clearMeasures(JE),performance.clearMeasures(QE);for(let c in a.cI)performance.clearMarks(a.cI[c])},getPerformanceMetrics(){performance.measure(JE,a.cI.create,a.cI.load),performance.measure(QE,a.cI.create,a.cI.fullLoad);let c=performance.getEntriesByName(JE)[0].duration,i=performance.getEntriesByName(QE)[0].duration,l=G_.length,h=1/(G_.reduce((_,y)=>_+y,0)/l/1e3),m=G_.filter(_=>_>KE).reduce((_,y)=>_+(y-KE)/KE,0);return{loadTime:c,fullLoadTime:i,fps:h,percentDroppedFrames:m/(l+m)*100,totalFrames:l}}};a.$=W,a.A=ue,a.B=Sh,a.C=Dr,a.D=Lt,a.E=Ke,a.F=function([c,i,l]){return i+=90,i*=Math.PI/180,l*=Math.PI/180,{x:c*Math.cos(i)*Math.sin(l),y:c*Math.sin(i)*Math.sin(l),z:c*Math.cos(l)}},a.G=mi,a.H=ui,a.I=vE,a.J=c0,a.K=function(c){if(bn==null){let i=c.navigator?c.navigator.userAgent:null;bn=!!c.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return bn},a.L=class{constructor(c,i){this.target=c,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new yV(()=>this.process()),this.subscription=$r(this.target,"message",l=>this.receive(l),!1),this.globalScope=Qi(self)?c:window}registerMessageHandler(c,i){this.messageHandlers[c]=i}unregisterMessageHandler(c){delete this.messageHandlers[c]}sendAsync(c,i){return new Promise((l,h)=>{let m=Math.round(1e18*Math.random()).toString(36).substring(0,10),_=i?$r(i.signal,"abort",()=>{_?.unsubscribe(),delete this.resolveRejects[m];let I={id:m,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(I)},vV):null;this.resolveRejects[m]={resolve:I=>{_?.unsubscribe(),l(I)},reject:I=>{_?.unsubscribe(),h(I)}};let y=[],T=Object.assign(Object.assign({},c),{id:m,sourceMapId:this.mapId,origin:location.origin,data:Nd(c.data,y)});this.target.postMessage(T,{transfer:y})})}receive(c){let i=c.data,l=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!=="resource://android"&&location.origin!=="resource://android"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[l];let h=this.abortControllers[l];return delete this.abortControllers[l],void(h&&h.abort())}if(Qi(self)||i.mustQueue)return this.tasks[l]=i,this.taskQueue.push(l),void this.invoker.trigger();this.processTask(l,i)}}process(){if(this.taskQueue.length===0)return;let c=this.taskQueue.shift(),i=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(c,i)}processTask(c,i){return s(this,void 0,void 0,function*(){if(i.type==="<response>"){let m=this.resolveRejects[c];return delete this.resolveRejects[c],m?void(i.error?m.reject(zd(i.error)):m.resolve(zd(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));let l=zd(i.data),h=new AbortController;this.abortControllers[c]=h;try{let m=yield this.messageHandlers[i.type](i.sourceMapId,l,h);this.completeTask(c,null,m)}catch(m){this.completeTask(c,m)}})}completeTask(c,i,l){let h=[];delete this.abortControllers[c];let m={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?Nd(i):null,data:Nd(l,h)};this.target.postMessage(m,{transfer:h})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},a.M=te,a.N=function(){var c=new ue(16);return ue!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},a.O=function(c,i,l){var h,m,_,y,T,I,P,O,N,j,V,Z,X=l[0],K=l[1],ne=l[2];return i===c?(c[12]=i[0]*X+i[4]*K+i[8]*ne+i[12],c[13]=i[1]*X+i[5]*K+i[9]*ne+i[13],c[14]=i[2]*X+i[6]*K+i[10]*ne+i[14],c[15]=i[3]*X+i[7]*K+i[11]*ne+i[15]):(m=i[1],_=i[2],y=i[3],T=i[4],I=i[5],P=i[6],O=i[7],N=i[8],j=i[9],V=i[10],Z=i[11],c[0]=h=i[0],c[1]=m,c[2]=_,c[3]=y,c[4]=T,c[5]=I,c[6]=P,c[7]=O,c[8]=N,c[9]=j,c[10]=V,c[11]=Z,c[12]=h*X+T*K+N*ne+i[12],c[13]=m*X+I*K+j*ne+i[13],c[14]=_*X+P*K+V*ne+i[14],c[15]=y*X+O*K+Z*ne+i[15]),c},a.P=f,a.Q=function(c,i,l){var h=l[0],m=l[1],_=l[2];return c[0]=i[0]*h,c[1]=i[1]*h,c[2]=i[2]*h,c[3]=i[3]*h,c[4]=i[4]*m,c[5]=i[5]*m,c[6]=i[6]*m,c[7]=i[7]*m,c[8]=i[8]*_,c[9]=i[9]*_,c[10]=i[10]*_,c[11]=i[11]*_,c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15],c},a.R=ps,a.S=function(c,i,l){var h=i[0],m=i[1],_=i[2],y=i[3],T=i[4],I=i[5],P=i[6],O=i[7],N=i[8],j=i[9],V=i[10],Z=i[11],X=i[12],K=i[13],ne=i[14],he=i[15],re=l[0],oe=l[1],pe=l[2],ve=l[3];return c[0]=re*h+oe*T+pe*N+ve*X,c[1]=re*m+oe*I+pe*j+ve*K,c[2]=re*_+oe*P+pe*V+ve*ne,c[3]=re*y+oe*O+pe*Z+ve*he,c[4]=(re=l[4])*h+(oe=l[5])*T+(pe=l[6])*N+(ve=l[7])*X,c[5]=re*m+oe*I+pe*j+ve*K,c[6]=re*_+oe*P+pe*V+ve*ne,c[7]=re*y+oe*O+pe*Z+ve*he,c[8]=(re=l[8])*h+(oe=l[9])*T+(pe=l[10])*N+(ve=l[11])*X,c[9]=re*m+oe*I+pe*j+ve*K,c[10]=re*_+oe*P+pe*V+ve*ne,c[11]=re*y+oe*O+pe*Z+ve*he,c[12]=(re=l[12])*h+(oe=l[13])*T+(pe=l[14])*N+(ve=l[15])*X,c[13]=re*m+oe*I+pe*j+ve*K,c[14]=re*_+oe*P+pe*V+ve*ne,c[15]=re*y+oe*O+pe*Z+ve*he,c},a.T=uE,a.U=function(c,i){let l={};for(let h=0;h<i.length;h++){let m=i[h];m in c&&(l[m]=c[m])}return l},a.V=Oh,a.W=Sn,a.X=YA,a.Y=XA,a.Z=Ie,a._=s,a.a=as,a.a$=st,a.a0=me,a.a1=ro,a.a2=_a,a.a3=JA,a.a4=L0,a.a5=ft,a.a6=function(c,i,l){if(!c)return i||{};if(!i)return c||{};let h=nR(c),m=nR(i);(function(y,T){T.removeAll&&(y.add.clear(),y.update.clear(),y.remove.clear(),T.remove.clear());for(let I of T.remove)y.add.delete(I),y.update.delete(I);for(let[I,P]of T.update){let O=y.update.get(I);O&&(T.update.set(I,xV(O,P)),y.update.delete(I))}})(h,m);let _={};if((h.removeAll||m.removeAll)&&(_.removeAll=!0),_.remove=new Set([...h.remove,...m.remove]),_.add=new Map([...h.add,...m.add]),_.update=new Map([...h.update,...m.update]),_.remove.size&&_.add.size)for(let y of _.add.keys())_.remove.delete(y);return(function(y){let T={};return y.removeAll&&(T.removeAll=y.removeAll),y.remove&&(T.remove=Array.from(y.remove)),y.add&&(T.add=Array.from(y.add.values())),y.update&&(T.update=Array.from(y.update.values())),T})(_)},a.a7=function(c,i){let l=new Map;if(c==null||c.type==null)return l;if(c.type==="Feature"){let h=DE(c,i);return h==null?void 0:(l.set(h,c),l)}if(c.type==="FeatureCollection"){let h=new Set;for(let m of c.features){let _=DE(m,i);if(_==null||h.has(_))return;h.add(_),l.set(_,m)}return l}},a.a8=function(c,i,l){var h,m;let _=[];if(i.removeAll)c.clear();else if(i.remove)for(let y of i.remove){let T=c.get(y);T&&(_.push(T.geometry),c.delete(y))}if(i.add)for(let y of i.add){let T=DE(y,l);if(T==null)continue;let I=c.get(T);I&&_.push(I.geometry),_.push(y.geometry),c.set(T,y)}if(i.update)for(let y of i.update){let T=c.get(y.id);if(!T)continue;let I=!!y.newGeometry,P=y.removeAllProperties||((h=y.removeProperties)===null||h===void 0?void 0:h.length)>0||((m=y.addOrUpdateProperties)===null||m===void 0?void 0:m.length)>0;if(!I&&!P)continue;_.push(T.geometry);let O=Object.assign({},T);if(c.set(y.id,O),I&&(_.push(y.newGeometry),O.geometry=y.newGeometry),P){if(O.properties=y.removeAllProperties?{}:Object.assign({},O.properties||{}),y.removeProperties)for(let N of y.removeProperties)delete O.properties[N];if(y.addOrUpdateProperties)for(let{key:N,value:j}of y.addOrUpdateProperties)O.properties[N]=j}}return _},a.a9=z_,a.aA=function(c,{uSize:i,uSizeT:l},{lowerSize:h,upperSize:m}){return c.kind==="source"?h/xu:c.kind==="composite"?mi.number(h/xu,m/xu,l):i},a.aB=function(c,i){var l=i[0],h=i[1],m=i[2],_=i[3],y=i[4],T=i[5],I=i[6],P=i[7],O=i[8],N=i[9],j=i[10],V=i[11],Z=i[12],X=i[13],K=i[14],ne=i[15],he=l*T-h*y,re=l*I-m*y,oe=l*P-_*y,pe=h*I-m*T,ve=h*P-_*T,Oe=m*P-_*I,qe=O*X-N*Z,Ze=O*K-j*Z,We=O*ne-V*Z,ut=N*K-j*X,nt=N*ne-V*X,$e=j*ne-V*K,Ve=he*$e-re*nt+oe*ut+pe*We-ve*Ze+Oe*qe;return Ve?(c[0]=(T*$e-I*nt+P*ut)*(Ve=1/Ve),c[1]=(m*nt-h*$e-_*ut)*Ve,c[2]=(X*Oe-K*ve+ne*pe)*Ve,c[3]=(j*ve-N*Oe-V*pe)*Ve,c[4]=(I*We-y*$e-P*Ze)*Ve,c[5]=(l*$e-m*We+_*Ze)*Ve,c[6]=(K*oe-Z*Oe-ne*re)*Ve,c[7]=(O*Oe-j*oe+V*re)*Ve,c[8]=(y*nt-T*We+P*qe)*Ve,c[9]=(h*We-l*nt-_*qe)*Ve,c[10]=(Z*ve-X*oe+ne*he)*Ve,c[11]=(N*oe-O*ve-V*he)*Ve,c[12]=(T*Ze-y*ut-I*qe)*Ve,c[13]=(l*ut-h*Ze+m*qe)*Ve,c[14]=(X*re-Z*pe-K*he)*Ve,c[15]=(O*pe-N*re+j*he)*Ve,c):null},a.aC=yt,a.aD=function(c){var i=c[0],l=c[1];return Math.sqrt(i*i+l*l)},a.aE=function(c){return c[0]=0,c[1]=0,c},a.aF=function(c,i,l){return c[0]=i[0]*l,c[1]=i[1]*l,c},a.aG=wE,a.aH=Pt,a.aI=function(c,i,l,h){let m=i.y-c.y,_=i.x-c.x,y=h.y-l.y,T=h.x-l.x,I=y*_-T*m;if(I===0)return null;let P=(T*(c.y-l.y)-y*(c.x-l.x))/I;return new f(c.x+P*_,c.y+P*m)},a.aJ=NR,a.aK=qp,a.aL=function(c){let i=1/0,l=1/0,h=-1/0,m=-1/0;for(let _ of c)i=Math.min(i,_.x),l=Math.min(l,_.y),h=Math.max(h,_.x),m=Math.max(m,_.y);return[i,l,h,m]},a.aM=Pr,a.aN=rt,a.aO=function(c,i,l,h,m=!1){if(!l[0]&&!l[1])return[0,0];let _=m?h==="map"?-c.bearingInRadians:0:h==="viewport"?c.bearingInRadians:0;if(_){let y=Math.sin(_),T=Math.cos(_);l=[l[0]*T-l[1]*y,l[0]*y+l[1]*T]}return[m?l[0]:rt(i,l[0],c.zoom),m?l[1]:rt(i,l[1],c.zoom)]},a.aQ=bE,a.aR=ZE,a.aS=xE,a.aT=qE,a.aU=er,a.aV=S0,a.aW=se,a.aX=mt,a.aY=Be,a.aZ=$n,a.a_=QA,a.aa=Jd,a.ab=25,a.ac=SE,a.ad=c=>{let i=window.document.createElement("video");return i.muted=!0,new Promise(l=>{i.onloadstart=()=>{l(i)};for(let h of c){let m=window.document.createElement("source");Ae(h)||(i.crossOrigin="Anonymous"),m.src=h,i.appendChild(m)}})},a.ae=De,a.af=function(){return Ei++},a.ag=g,a.ah=tm,a.ai=V_,a.aj=It,a.ak=Cc,a.al=rR,a.am=function(c){let i={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,h,m,_)=>{let y=m||_;return i[h]=!y||y.toLowerCase(),""}),i["max-age"]){let l=parseInt(i["max-age"],10);isNaN(l)?delete i["max-age"]:i["max-age"]=l}return i},a.an=Rt,a.ao=85.051129,a.ap=Mo,a.aq=function(c){return Math.pow(2,c)},a.ar=Ue,a.as=KA,a.at=function(c){return Math.log(c)/Math.LN2},a.au=function(c){var i=c[0],l=c[1];return i*i+l*l},a.av=function(c){if(!c.length)return new Set;let i=Math.max(...c.map(I=>I.canonical.z)),l=1/0,h=-1/0,m=1/0,_=-1/0,y=[];for(let I of c){let{x:P,y:O,z:N}=I.canonical,j=Math.pow(2,i-N),V=P*j,Z=O*j;y.push({id:I,x:V,y:Z}),V<l&&(l=V),V>h&&(h=V),Z<m&&(m=Z),Z>_&&(_=Z)}let T=new Set;for(let I of y)I.x!==l&&I.x!==h&&I.y!==m&&I.y!==_||T.add(I.id);return T},a.aw=function(c,i){let l=Math.abs(2*c.wrap)-+(c.wrap<0),h=Math.abs(2*i.wrap)-+(i.wrap<0);return c.overscaledZ-i.overscaledZ||h-l||i.canonical.y-c.canonical.y||i.canonical.x-c.canonical.x},a.ax=class{constructor(c,i){this.max=c,this.onRemove=i,this.reset()}reset(){for(let c in this.data)for(let i of this.data[c])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(c,i,l){let h=c.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);let m={value:i,timeout:void 0};if(l!==void 0&&(m.timeout=setTimeout(()=>{this.remove(c,m)},l)),this.data[h].push(m),this.order.push(h),this.order.length>this.max){let _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(c){return c.wrapped().key in this.data}getAndRemove(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null}_getAndRemoveByKey(c){let i=this.data[c].shift();return i.timeout&&clearTimeout(i.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),i.value}getByKey(c){let i=this.data[c];return i?i[0].value:null}get(c){return this.has(c)?this.data[c.wrapped().key][0].value:null}remove(c,i){if(!this.has(c))return this;let l=c.wrapped().key,h=i===void 0?0:this.data[l].indexOf(i),m=this.data[l][h];return this.data[l].splice(h,1),m.timeout&&clearTimeout(m.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(m.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(c){for(this.max=c;this.order.length>this.max;){let i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(c){let i=[];for(let l in this.data)for(let h of this.data[l])c(h.value)||i.push(h);for(let l of i)this.remove(l.value.tileID,l)}},a.ay=function(c,i){let l=0,h=0;if(c.kind==="constant")h=c.layoutSize;else if(c.kind!=="source"){let{interpolationType:m,minZoom:_,maxZoom:y}=c,T=m?Rt(Vi.interpolationFactor(m,i,_,y),0,1):0;c.kind==="camera"?h=mi.number(c.minSize,c.maxSize,T):l=T}return{uSizeT:l,uSize:h}},a.b=Di,a.b$=yu,a.b0=ot,a.b1=function(c){var i=new ue(3);return i[0]=c[0],i[1]=c[1],i[2]=c[2],i},a.b2=function(c,i,l){return c[0]=i[0]-l[0],c[1]=i[1]-l[1],c[2]=i[2]-l[2],c},a.b3=function(c,i){var l=i[0],h=i[1],m=i[2],_=l*l+h*h+m*m;return _>0&&(_=1/Math.sqrt(_)),c[0]=i[0]*_,c[1]=i[1]*_,c[2]=i[2]*_,c},a.b4=it,a.b5=function(c,i){return c[0]*i[0]+c[1]*i[1]+c[2]*i[2]},a.b6=function(c,i,l){return c[0]=i[0]*l[0],c[1]=i[1]*l[1],c[2]=i[2]*l[2],c[3]=i[3]*l[3],c},a.b7=ke,a.b8=function(c,i,l){let h=i[0]*l[0]+i[1]*l[1]+i[2]*l[2];return h===0?null:(-(c[0]*l[0]+c[1]*l[1]+c[2]*l[2])-l[3])/h},a.b9=Vt,a.bA=function(){return new Float64Array(3)},a.bB=Gt,a.bC=function(c,i,l){var h=l[0],m=l[1],_=l[2],y=l[3],T=i[0],I=i[1],P=i[2],O=m*P-_*I,N=_*T-h*P,j=h*I-m*T;return c[0]=T+y*(O+=O)+m*(j+=j)-_*(N+=N),c[1]=I+y*N+_*O-h*j,c[2]=P+y*j+h*N-m*O,c},a.bD=function(c,i,l){let h=(m=[c[0],c[1],c[2],i[0],i[1],i[2],l[0],l[1],l[2]])[0]*((O=m[8])*(y=m[4])-(T=m[5])*(P=m[7]))+m[1]*(-O*(_=m[3])+T*(I=m[6]))+m[2]*(P*_-y*I);var m,_,y,T,I,P,O;if(h===0)return null;let N=it([],[i[0],i[1],i[2]],[l[0],l[1],l[2]]),j=it([],[l[0],l[1],l[2]],[c[0],c[1],c[2]]),V=it([],[c[0],c[1],c[2]],[i[0],i[1],i[2]]),Z=st([],N,-c[3]);return ot(Z,Z,st([],j,-i[3])),ot(Z,Z,st([],V,-l[3])),st(Z,Z,1/h),Z},a.bE=IE,a.bF=function(){return new Float64Array(4)},a.bG=function(c,i,l,h){var m=[],_=[];return m[0]=i[0]-l[0],m[1]=i[1]-l[1],m[2]=i[2]-l[2],_[0]=m[0]*Math.cos(h)-m[1]*Math.sin(h),_[1]=m[0]*Math.sin(h)+m[1]*Math.cos(h),_[2]=m[2],c[0]=_[0]+l[0],c[1]=_[1]+l[1],c[2]=_[2]+l[2],c},a.bH=function(c,i,l,h){var m=[],_=[];return m[0]=i[0]-l[0],m[1]=i[1]-l[1],m[2]=i[2]-l[2],_[0]=m[0],_[1]=m[1]*Math.cos(h)-m[2]*Math.sin(h),_[2]=m[1]*Math.sin(h)+m[2]*Math.cos(h),c[0]=_[0]+l[0],c[1]=_[1]+l[1],c[2]=_[2]+l[2],c},a.bI=function(c,i,l,h){var m=[],_=[];return m[0]=i[0]-l[0],m[1]=i[1]-l[1],m[2]=i[2]-l[2],_[0]=m[2]*Math.sin(h)+m[0]*Math.cos(h),_[1]=m[1],_[2]=m[2]*Math.cos(h)-m[0]*Math.sin(h),c[0]=_[0]+l[0],c[1]=_[1]+l[1],c[2]=_[2]+l[2],c},a.bJ=function(c,i,l){var h=Math.sin(l),m=Math.cos(l),_=i[0],y=i[1],T=i[2],I=i[3],P=i[8],O=i[9],N=i[10],j=i[11];return i!==c&&(c[4]=i[4],c[5]=i[5],c[6]=i[6],c[7]=i[7],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15]),c[0]=_*m-P*h,c[1]=y*m-O*h,c[2]=T*m-N*h,c[3]=I*m-j*h,c[8]=_*h+P*m,c[9]=y*h+O*m,c[10]=T*h+N*m,c[11]=I*h+j*m,c},a.bK=function(c,i){let l=Dt(c,360),h=Dt(i,360),m=h-l,_=h>l?m-360:m+360;return Math.abs(m)<Math.abs(_)?m:_},a.bL=function(c){return c[0]=0,c[1]=0,c[2]=0,c},a.bM=function(c,i,l,h){let m=Math.sqrt(c*c+i*i),_=Math.sqrt(l*l+h*h);c/=m,i/=m,l/=_,h/=_;let y=Math.acos(c*l+i*h);return-i*l+c*h>0?y:-y},a.bN=function(c,i){let l=Dt(c,2*Math.PI),h=Dt(i,2*Math.PI);return Math.min(Math.abs(l-h),Math.abs(l-h+2*Math.PI),Math.abs(l-h-2*Math.PI))},a.bO=function(){let c={},i=Te.$version;for(let l in Te.$root){let h=Te.$root[l];if(h.required){let m=null;m=l==="version"?i:h.type==="array"?[]:{},m!=null&&(c[l]=m)}}return c},a.bP=be,a.bQ=h_,a.bR=function c(i,l){if(Array.isArray(i)){if(!Array.isArray(l)||i.length!==l.length)return!1;for(let h=0;h<i.length;h++)if(!c(i[h],l[h]))return!1;return!0}if(typeof i=="object"&&i!==null&&l!==null){if(typeof l!="object"||Object.keys(i).length!==Object.keys(l).length)return!1;for(let h in i)if(!c(i[h],l[h]))return!1;return!0}return i===l},a.bS=function(c){c=c.slice();let i=Object.create(null);for(let l=0;l<c.length;l++)i[c[l].id]=c[l];for(let l=0;l<c.length;l++)"ref"in c[l]&&(c[l]=Wn(c[l],i[c[l].ref]));return c},a.bT=function(c,i){if(c.type==="custom")return new _V(c,i);switch(c.type){case"background":return new gV(c,i);case"circle":return new e3(c,i);case"color-relief":return new s3(c,i);case"fill":return new b3(c,i);case"fill-extrusion":return new L3(c,i);case"heatmap":return new n3(c,i);case"hillshade":return new r3(c,i);case"line":return new j3(c,i);case"raster":return new tE(c,i);case"symbol":return new R0(c,i)}},a.bU=c=>c.type==="raster",a.bV=ti,a.bW=function(c,i){if(!c)return[{command:"setStyle",args:[i]}];let l=[];try{if(!Et(c.version,i.version))return[{command:"setStyle",args:[i]}];Et(c.center,i.center)||l.push({command:"setCenter",args:[i.center]}),Et(c.state,i.state)||l.push({command:"setGlobalState",args:[i.state]}),Et(c.centerAltitude,i.centerAltitude)||l.push({command:"setCenterAltitude",args:[i.centerAltitude]}),Et(c.zoom,i.zoom)||l.push({command:"setZoom",args:[i.zoom]}),Et(c.bearing,i.bearing)||l.push({command:"setBearing",args:[i.bearing]}),Et(c.pitch,i.pitch)||l.push({command:"setPitch",args:[i.pitch]}),Et(c.roll,i.roll)||l.push({command:"setRoll",args:[i.roll]}),Et(c.sprite,i.sprite)||l.push({command:"setSprite",args:[i.sprite]}),Et(c.glyphs,i.glyphs)||l.push({command:"setGlyphs",args:[i.glyphs]}),Et(c.transition,i.transition)||l.push({command:"setTransition",args:[i.transition]}),Et(c.light,i.light)||l.push({command:"setLight",args:[i.light]}),Et(c.terrain,i.terrain)||l.push({command:"setTerrain",args:[i.terrain]}),Et(c.sky,i.sky)||l.push({command:"setSky",args:[i.sky]}),Et(c.projection,i.projection)||l.push({command:"setProjection",args:[i.projection]});let h={},m=[];(function(y,T,I,P){let O;for(O in T=T||{},y=y||{})Object.prototype.hasOwnProperty.call(y,O)&&(Object.prototype.hasOwnProperty.call(T,O)||Dn(O,I,P));for(O in T)Object.prototype.hasOwnProperty.call(T,O)&&(Object.prototype.hasOwnProperty.call(y,O)?Et(y[O],T[O])||(y[O].type==="geojson"&&T[O].type==="geojson"&&Hn(y,T,O)?xt(I,{command:"setGeoJSONSourceData",args:[O,T[O].data]}):Mn(O,T,I,P)):qt(O,T,I))})(c.sources,i.sources,m,h);let _=[];c.layers&&c.layers.forEach(y=>{"source"in y&&h[y.source]?l.push({command:"removeLayer",args:[y.id]}):_.push(y)}),l=l.concat(m),(function(y,T,I){T=T||[];let P=(y=y||[]).map(Bn),O=T.map(Bn),N=y.reduce(Yt,{}),j=T.reduce(Yt,{}),V=P.slice(),Z=Object.create(null),X,K,ne,he,re;for(let oe=0,pe=0;oe<P.length;oe++)X=P[oe],Object.prototype.hasOwnProperty.call(j,X)?pe++:(xt(I,{command:"removeLayer",args:[X]}),V.splice(V.indexOf(X,pe),1));for(let oe=0,pe=0;oe<O.length;oe++)X=O[O.length-1-oe],V[V.length-1-oe]!==X&&(Object.prototype.hasOwnProperty.call(N,X)?(xt(I,{command:"removeLayer",args:[X]}),V.splice(V.lastIndexOf(X,V.length-pe),1)):pe++,he=V[V.length-oe],xt(I,{command:"addLayer",args:[j[X],he]}),V.splice(V.length-oe,0,X),Z[X]=!0);for(let oe=0;oe<O.length;oe++)if(X=O[oe],K=N[X],ne=j[X],!Z[X]&&!Et(K,ne))if(Et(K.source,ne.source)&&Et(K["source-layer"],ne["source-layer"])&&Et(K.type,ne.type)){for(re in ni(K.layout,ne.layout,I,X,null,"setLayoutProperty"),ni(K.paint,ne.paint,I,X,null,"setPaintProperty"),Et(K.filter,ne.filter)||xt(I,{command:"setFilter",args:[X,ne.filter]}),Et(K.minzoom,ne.minzoom)&&Et(K.maxzoom,ne.maxzoom)||xt(I,{command:"setLayerZoomRange",args:[X,ne.minzoom,ne.maxzoom]}),K)Object.prototype.hasOwnProperty.call(K,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?ni(K[re],ne[re],I,X,re.slice(6),"setPaintProperty"):Et(K[re],ne[re])||xt(I,{command:"setLayerProperty",args:[X,re,ne[re]]}));for(re in ne)Object.prototype.hasOwnProperty.call(ne,re)&&!Object.prototype.hasOwnProperty.call(K,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?ni(K[re],ne[re],I,X,re.slice(6),"setPaintProperty"):Et(K[re],ne[re])||xt(I,{command:"setLayerProperty",args:[X,re,ne[re]]}))}else xt(I,{command:"removeLayer",args:[X]}),he=V[V.lastIndexOf(X)+1],xt(I,{command:"addLayer",args:[ne,he]})})(_,i.layers,l)}catch(h){console.warn("Unable to compute style diff:",h),l=[{command:"setStyle",args:[i]}]}return l},a.bX=function(c){let i=[],l=c.id;return l===void 0&&i.push({message:`layers.${l}: missing required property "id"`}),c.render===void 0&&i.push({message:`layers.${l}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&i.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),i},a.bY=Zi,a.bZ=Ti,a.b_=class extends Yo{constructor(c,i){super(c,i),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},a.ba=function(c,i,l){return c[0]=i[0]*l,c[1]=i[1]*l,c[2]=i[2]*l,c[3]=i[3]*l,c},a.bb=function(c,i){return c[0]*i[0]+c[1]*i[1]+c[2]*i[2]+c[3]},a.bc=tR,a.bd=nm,a.be=function(c,i,l,h,m){var _=1/Math.tan(i/2);if(c[0]=_/l,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=_,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,m!=null&&m!==1/0){var y=1/(h-m);c[10]=(m+h)*y,c[14]=2*m*h*y}else c[10]=-1,c[14]=-2*h;return c},a.bf=function(c){var i=new ue(16);return i[0]=c[0],i[1]=c[1],i[2]=c[2],i[3]=c[3],i[4]=c[4],i[5]=c[5],i[6]=c[6],i[7]=c[7],i[8]=c[8],i[9]=c[9],i[10]=c[10],i[11]=c[11],i[12]=c[12],i[13]=c[13],i[14]=c[14],i[15]=c[15],i},a.bg=function(c,i,l){var h=Math.sin(l),m=Math.cos(l),_=i[0],y=i[1],T=i[2],I=i[3],P=i[4],O=i[5],N=i[6],j=i[7];return i!==c&&(c[8]=i[8],c[9]=i[9],c[10]=i[10],c[11]=i[11],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15]),c[0]=_*m+P*h,c[1]=y*m+O*h,c[2]=T*m+N*h,c[3]=I*m+j*h,c[4]=P*m-_*h,c[5]=O*m-y*h,c[6]=N*m-T*h,c[7]=j*m-I*h,c},a.bh=function(c,i,l){var h=Math.sin(l),m=Math.cos(l),_=i[4],y=i[5],T=i[6],I=i[7],P=i[8],O=i[9],N=i[10],j=i[11];return i!==c&&(c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15]),c[4]=_*m+P*h,c[5]=y*m+O*h,c[6]=T*m+N*h,c[7]=I*m+j*h,c[8]=P*m-_*h,c[9]=O*m-y*h,c[10]=N*m-T*h,c[11]=j*m-I*h,c},a.bi=function(){let c=new Float32Array(16);return Ue(c),c},a.bj=function(){let c=new Float64Array(16);return Ue(c),c},a.bk=function(){return new Float64Array(16)},a.bl=function(c,i,l){let h=new Float64Array(4);return Gt(h,c,i-90,l),h},a.bm=function(c,i,l,h){var m,_,y,T,I,P=i[0],O=i[1],N=i[2],j=i[3],V=l[0],Z=l[1],X=l[2],K=l[3];return(_=P*V+O*Z+N*X+j*K)<0&&(_=-_,V=-V,Z=-Z,X=-X,K=-K),1-_>ce?(m=Math.acos(_),y=Math.sin(m),T=Math.sin((1-h)*m)/y,I=Math.sin(h*m)/y):(T=1-h,I=h),c[0]=T*P+I*V,c[1]=T*O+I*Z,c[2]=T*N+I*X,c[3]=T*j+I*K,c},a.bn=function(c){let i=new Float64Array(9);var l,h,m,_,y,T,I,P,O,N,j,V,Z,X,K,ne,he,re;N=(m=(h=c)[0])*(I=m+m),j=(_=h[1])*I,Z=(y=h[2])*I,X=y*(P=_+_),ne=(T=h[3])*I,he=T*P,re=T*(O=y+y),(l=i)[0]=1-(V=_*P)-(K=y*O),l[3]=j-re,l[6]=Z+he,l[1]=j+re,l[4]=1-N-K,l[7]=X-ne,l[2]=Z-he,l[5]=X+ne,l[8]=1-N-V;let oe=$n(-Math.asin(Rt(i[2],-1,1))),pe,ve;return Math.hypot(i[5],i[8])<.001?(pe=0,ve=-$n(Math.atan2(i[3],i[4]))):(pe=$n(i[5]===0&&i[8]===0?0:Math.atan2(i[5],i[8])),ve=$n(i[1]===0&&i[0]===0?0:Math.atan2(i[1],i[0]))),{roll:pe,pitch:oe+90,bearing:ve}},a.bo=function(c,i){return c.roll==i.roll&&c.pitch==i.pitch&&c.bearing==i.bearing},a.bp=sn,a.bq=_u,a.br=Jp,a.bs=R_,a.bt=Kp,a.bu=$t,a.bv=Qt,a.bw=qi,a.bx=function(c,i,l,h,m){return $t(h,m,Rt((c-i)/(l-i),0,1))},a.by=function(c,i,l,h){return c[0]=i[0]+l[0]*h,c[1]=i[1]+l[1]*h,c[2]=i[2]+l[2]*h,c},a.bz=Dt,a.c=J,a.c$=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},a.c0=class extends Yo{constructor(c,i){super(c,i),this.current=As}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let i=1;i<16;i++)if(c[i]!==this.current[i]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},a.c1=Xd,a.c2=class extends Yo{constructor(c,i){super(c,i),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},a.c3=class extends Yo{constructor(c,i){super(c,i),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},a.c4=Me,a.c5=function(c,i){var l=Math.sin(i),h=Math.cos(i);return c[0]=h,c[1]=l,c[2]=0,c[3]=-l,c[4]=h,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},a.c6=function(c,i,l){var h=i[0],m=i[1],_=i[2];return c[0]=h*l[0]+m*l[3]+_*l[6],c[1]=h*l[1]+m*l[4]+_*l[7],c[2]=h*l[2]+m*l[5]+_*l[8],c},a.c7=function(c,i,l,h,m,_,y){var T=1/(i-l),I=1/(h-m),P=1/(_-y);return c[0]=-2*T,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*I,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*P,c[11]=0,c[12]=(i+l)*T,c[13]=(m+h)*I,c[14]=(y+_)*P,c[15]=1,c},a.c8=class extends Yo{constructor(c,i){super(c,i),this.current=new Array}set(c){if(c!=this.current){this.current=c;let i=new Float32Array(4*c.length);for(let l=0;l<c.length;l++)i[4*l]=c[l].r,i[4*l+1]=c[l].g,i[4*l+2]=c[l].b,i[4*l+3]=c[l].a;this.gl.uniform4fv(this.location,i)}}},a.c9=class extends Yo{constructor(c,i){super(c,i),this.current=new Array}set(c){if(c!=this.current){this.current=c;let i=new Float32Array(c);this.gl.uniform1fv(this.location,i)}}},a.cA=function(c,i){var l;if(!xs[i])return!1;let h=c?.target,m=((l=h?.ownerDocument)===null||l===void 0?void 0:l.defaultView)||window;return c instanceof m.MouseEvent||c instanceof m.WheelEvent},a.cB=function(c,i){return oo[i]&&"touches"in c},a.cC=function(c){return oo[c]||xs[c]},a.cD=function(c,i,l){var h=i[0],m=i[1];return c[0]=l[0]*h+l[4]*m+l[12],c[1]=l[1]*h+l[5]*m+l[13],c},a.cE=function(c,i){let{x:l,y:h}=z_.fromLngLat(i);return!(c<0||c>25||h<0||h>=1||l<0||l>=1)},a.cF=function(c,i){return c[0]=i[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=i[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=i[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},a.cG=class extends jp{},a.cH=iU,a.cJ=ge,a.cK=function(c,i){J.REGISTERED_PROTOCOLS[c]=i},a.cL=function(c){delete J.REGISTERED_PROTOCOLS[c]},a.cM=function(c,i){let l={};for(let m=0;m<c.length;m++){let _=i&&i[c[m].id]||Pp(c[m]);i&&(i[c[m].id]=_);let y=l[_];y||(y=l[_]=[]),y.push(c[m])}let h=[];for(let m in l)h.push(l[m]);return h},a.cN=wt,a.cO=iR,a.cP=kR,a.cQ=zA,a.cR=function(c){var i;c.bucket.createArrays(),c.bucket.tilePixelRatio=ft/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;let l=c.bucket.layers[0],h=l.layout,m=l._unevaluatedLayout._values,_={layoutIconSize:m["icon-size"].possiblyEvaluate(new ui(c.bucket.zoom+1),c.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new ui(c.bucket.zoom+1),c.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new ui(18))};if(c.bucket.textSizeData.kind==="composite"){let{minZoom:O,maxZoom:N}=c.bucket.textSizeData;_.compositeTextSizes=[m["text-size"].possiblyEvaluate(new ui(O),c.canonical),m["text-size"].possiblyEvaluate(new ui(N),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){let{minZoom:O,maxZoom:N}=c.bucket.iconSizeData;_.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new ui(O),c.canonical),m["icon-size"].possiblyEvaluate(new ui(N),c.canonical)]}let y=h.get("text-line-height")*Pr,T=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",I=h.get("text-keep-upright"),P=h.get("text-size");for(let O of c.bucket.features){let N=h.get("text-font").evaluate(O,{},c.canonical).join(","),j=P.evaluate(O,{},c.canonical),V=_.layoutTextSize.evaluate(O,{},c.canonical),Z=_.layoutIconSize.evaluate(O,{},c.canonical),X={horizontal:{},vertical:void 0},K=O.text,ne,he=[0,0];if(K){let pe=K.toString(),ve=h.get("text-letter-spacing").evaluate(O,{},c.canonical)*Pr,Oe=Q1(pe)?ve:0,qe=h.get("text-anchor").evaluate(O,{},c.canonical),Ze=WR(l,O,c.canonical);if(!Ze){let $e=h.get("text-radial-offset").evaluate(O,{},c.canonical);he=$e?qR(qe,[$e*Pr,HE]):h.get("text-offset").evaluate(O,{},c.canonical).map(Ve=>Ve*Pr)}let We=T?"center":h.get("text-justify").evaluate(O,{},c.canonical),ut=h.get("symbol-placement")==="point"?h.get("text-max-width").evaluate(O,{},c.canonical)*Pr:1/0,nt=()=>{c.bucket.allowVerticalPlacement&&Ph(pe)&&(X.vertical=P0(K,c.glyphMap,c.glyphPositions,c.imagePositions,N,ut,y,qe,"left",Oe,he,a.az.vertical,!0,V,j))};if(!T&&Ze){let $e=new Set;if(We==="auto")for(let vt=0;vt<Ze.values.length;vt+=2)$e.add(ZE(Ze.values[vt]));else $e.add(We);let Ve=!1;for(let vt of $e)if(!X.horizontal[vt])if(Ve)X.horizontal[vt]=X.horizontal[0];else{let gt=P0(K,c.glyphMap,c.glyphPositions,c.imagePositions,N,ut,y,"center",vt,Oe,he,a.az.horizontal,!1,V,j);gt&&(X.horizontal[vt]=gt,Ve=gt.positionedLines.length===1)}nt()}else{We==="auto"&&(We=ZE(qe));let $e=P0(K,c.glyphMap,c.glyphPositions,c.imagePositions,N,ut,y,qe,We,Oe,he,a.az.horizontal,!1,V,j);$e&&(X.horizontal[We]=$e),nt(),Ph(pe)&&T&&I&&(X.vertical=P0(K,c.glyphMap,c.glyphPositions,c.imagePositions,N,ut,y,qe,We,Oe,he,a.az.vertical,!1,V,j))}}let re=!1;if(O.icon&&O.icon.name){let pe=c.imageMap[O.icon.name];pe&&(ne=dV(c.imagePositions[O.icon.name],h.get("icon-offset").evaluate(O,{},c.canonical),h.get("icon-anchor").evaluate(O,{},c.canonical)),re=!!pe.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=re:c.bucket.sdfIcons!==re&&zi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(pe.pixelRatio!==c.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}let oe=YR(X.horizontal)||X.vertical;(i=c.bucket).iconsInText||(i.iconsInText=!!oe&&oe.iconsInText),(oe||ne)&&tU(c.bucket,O,X,ne,c.imageMap,_,V,Z,he,re,c.canonical,c.subdivisionGranularity)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},a.cS=pE,a.cT=gE,a.cU=_E,a.cV=function(c){let i=new M0;return(function(l,h){for(let m in l.layers)h.writeMessage(3,VV,l.layers[m])})(c,i),i.finish()},a.cW=function(c,i,l,h,m,_){let y=zR(c,i,l,m,0);return y=zR(y,i,h,_,1),y},a.cX=class{constructor(c){this.maxEntries=c,this.map=new Map}get(c){let i=this.map.get(c);return i!==void 0&&(this.map.delete(c),this.map.set(c,i)),i}set(c,i){if(this.map.has(c))this.map.delete(c);else if(this.map.size>=this.maxEntries){let l=this.map.keys().next().value;this.map.delete(l)}this.map.set(c,i)}clear(){this.map.clear()}},a.cY=xA,a.cZ=M0,a.c_=LR,a.ca=class extends mu{},a.cb=$3,a.cc=class extends Wd{},a.cd=cE,a.ce=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},a.cf=oA,a.cg=function(c,i,l){var h=i[0],m=i[1],_=i[2],y=l[3]*h+l[7]*m+l[11]*_+l[15];return c[0]=(l[0]*h+l[4]*m+l[8]*_+l[12])/(y=y||1),c[1]=(l[1]*h+l[5]*m+l[9]*_+l[13])/y,c[2]=(l[2]*h+l[6]*m+l[10]*_+l[14])/y,c},a.ch=class extends y_{},a.ci=class extends r{},a.cj=function(c,i){return c[0]===i[0]&&c[1]===i[1]&&c[2]===i[2]&&c[3]===i[3]&&c[4]===i[4]&&c[5]===i[5]&&c[6]===i[6]&&c[7]===i[7]&&c[8]===i[8]&&c[9]===i[9]&&c[10]===i[10]&&c[11]===i[11]&&c[12]===i[12]&&c[13]===i[13]&&c[14]===i[14]&&c[15]===i[15]},a.ck=function(c,i){var l=c[0],h=c[1],m=c[2],_=c[3],y=c[4],T=c[5],I=c[6],P=c[7],O=c[8],N=c[9],j=c[10],V=c[11],Z=c[12],X=c[13],K=c[14],ne=c[15],he=i[0],re=i[1],oe=i[2],pe=i[3],ve=i[4],Oe=i[5],qe=i[6],Ze=i[7],We=i[8],ut=i[9],nt=i[10],$e=i[11],Ve=i[12],vt=i[13],gt=i[14],Tt=i[15];return Math.abs(l-he)<=ce*Math.max(1,Math.abs(l),Math.abs(he))&&Math.abs(h-re)<=ce*Math.max(1,Math.abs(h),Math.abs(re))&&Math.abs(m-oe)<=ce*Math.max(1,Math.abs(m),Math.abs(oe))&&Math.abs(_-pe)<=ce*Math.max(1,Math.abs(_),Math.abs(pe))&&Math.abs(y-ve)<=ce*Math.max(1,Math.abs(y),Math.abs(ve))&&Math.abs(T-Oe)<=ce*Math.max(1,Math.abs(T),Math.abs(Oe))&&Math.abs(I-qe)<=ce*Math.max(1,Math.abs(I),Math.abs(qe))&&Math.abs(P-Ze)<=ce*Math.max(1,Math.abs(P),Math.abs(Ze))&&Math.abs(O-We)<=ce*Math.max(1,Math.abs(O),Math.abs(We))&&Math.abs(N-ut)<=ce*Math.max(1,Math.abs(N),Math.abs(ut))&&Math.abs(j-nt)<=ce*Math.max(1,Math.abs(j),Math.abs(nt))&&Math.abs(V-$e)<=ce*Math.max(1,Math.abs(V),Math.abs($e))&&Math.abs(Z-Ve)<=ce*Math.max(1,Math.abs(Z),Math.abs(Ve))&&Math.abs(X-vt)<=ce*Math.max(1,Math.abs(X),Math.abs(vt))&&Math.abs(K-gt)<=ce*Math.max(1,Math.abs(K),Math.abs(gt))&&Math.abs(ne-Tt)<=ce*Math.max(1,Math.abs(ne),Math.abs(Tt))},a.cl=function(c,i){return c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3],c[4]=i[4],c[5]=i[5],c[6]=i[6],c[7]=i[7],c[8]=i[8],c[9]=i[9],c[10]=i[10],c[11]=i[11],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15],c},a.cm=c=>c.type==="symbol",a.cn=c=>c.type==="circle",a.co=c=>c.type==="heatmap",a.cp=c=>c.type==="line",a.cq=c=>c.type==="fill",a.cr=c=>c.type==="fill-extrusion",a.cs=c=>c.type==="hillshade",a.ct=c=>c.type==="color-relief",a.cu=c=>c.type==="background",a.cv=c=>c.type==="custom",a.cw=et,a.cx=function(c,i,l){if(i<=0)return c;let h=1/i;return l===void 0||Math.abs(l)<1e-10?Math.round(c*h)/h:(l>0?Math.ceil(c*h-1e-9):Math.floor(c*h+1e-10))/h},a.cy=function(c,i,l){let h=dt(i.x-l.x,i.y-l.y),m=dt(c.x-l.x,c.y-l.y);var _,y;return $n(Math.atan2(h[0]*m[1]-h[1]*m[0],(_=h)[0]*(y=m)[0]+_[1]*y[1]))},a.cz=Zt,a.d=Ae,a.d0=function(c,i,l,h,m){return s(this,void 0,void 0,function*(){if(me())try{return yield ro(c,i,l,h,m)}catch{}return(function(_,y,T,I,P){let O=_.width,N=_.height;ur&&hr||(ur=new OffscreenCanvas(O,N),hr=ur.getContext("2d",{willReadFrequently:!0})),ur.width=O,ur.height=N,hr.drawImage(_,0,0,O,N);let j=hr.getImageData(y,T,I,P);return hr.clearRect(0,0,O,N),j.data})(c,i,l,h,m)})},a.d1=lA,a.d2=v,a.d3=class{constructor(c,i){this.layers={[V_]:this},this.name=V_,this.version=i?i.version:1,this.extent=i?i.extent:4096,this.length=c.length,this.features=c}feature(c){return new jV(this.features[c],this.extent)}},a.d4=d,a.d5=bc,a.e=kn,a.f=c=>s(void 0,void 0,void 0,function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));let i=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(i)}catch(l){throw new Error(`Could not load image because of ${l.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),a.g=Q,a.h=c=>new Promise((i,l)=>{let h=new Image;h.onload=()=>{i(h),URL.revokeObjectURL(h.src),h.onload=null,window.requestAnimationFrame(()=>{h.src=Do})},h.onerror=()=>l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let m=new Blob([new Uint8Array(c)],{type:"image/png"});h.src=c.byteLength?URL.createObjectURL(m):Do}),a.i=Qi,a.j=(c,i)=>Le(kn(c,{type:"json"}),i),a.k=Ge,a.l=Xe,a.m=Le,a.n=(c,i)=>Le(kn(c,{type:"arrayBuffer"}),i),a.o=function(c){return new M0(c).readFields(rV,[])},a.p=NA,a.q=function(c){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(c))},a.r=S_,a.s=$r,a.t=ko,a.u=Te,a.v=kd,a.w=zi,a.x=g_,a.y=Fd,a.z=jd}),t("worker",["./shared"],function(a){"use strict";class s{constructor(J,Q){this.keyCache={},J&&this.replace(J,Q)}replace(J,Q){this._layerConfigs={},this._layers={},this.update(J,[],Q)}update(J,Q,te){for(let be of J){this._layerConfigs[be.id]=be;let Le=this._layers[be.id]=a.bT(be,te);Le._featureFilter=a.aj(Le.filter,te),this.keyCache[be.id]&&delete this.keyCache[be.id]}for(let be of Q)delete this.keyCache[be],delete this._layerConfigs[be],delete this._layers[be];this.familiesBySource={};let ge=a.cM(Object.values(this._layerConfigs),this.keyCache);for(let be of ge){let Le=be.map(Ke=>this._layers[Ke.id]),Ae=Le[0];if(Ae.isHidden())continue;let Se=Ae.source||"",Re=this.familiesBySource[Se];Re||(Re=this.familiesBySource[Se]={});let Xe=Ae.sourceLayer||a.ai,Ge=Re[Xe];Ge||(Ge=Re[Xe]=[]),Ge.push(Le)}}}class f{constructor(J){let Q={},te=[];for(let Ae in J){let Se=J[Ae],Re=Q[Ae]={};for(let Xe in Se){let Ge=Se[+Xe];if(!Ge||Ge.bitmap.width===0||Ge.bitmap.height===0)continue;let Ke={x:0,y:0,w:Ge.bitmap.width+2,h:Ge.bitmap.height+2};te.push(Ke),Re[Xe]={rect:Ke,metrics:Ge.metrics}}}let{w:ge,h:be}=a.p(te),Le=new a.r({width:ge||1,height:be||1});for(let Ae in J){let Se=J[Ae];for(let Re in Se){let Xe=Se[+Re];if(!Xe||Xe.bitmap.width===0||Xe.bitmap.height===0)continue;let Ge=Q[Ae][Re].rect;a.r.copy(Xe.bitmap,Le,{x:0,y:0},{x:Ge.x+1,y:Ge.y+1},Xe.bitmap)}}this.image=Le,this.positions=Q}}a.cN("GlyphAtlas",f);class v{constructor(J){this.tileID=new a.a2(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.uid=J.uid,this.zoom=J.zoom,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.collectResourceTiming,this.returnDependencies=!!J.returnDependencies,this.promoteId=J.promoteId,this.inFlightDependencies=[]}parse(J,Q,te,ge,be){return a._(this,void 0,void 0,function*(){this.status="parsing",this.data=J,this.collisionBoxArray=new a.ag;let Le=new a.cO(Object.keys(J.layers).sort()),Ae=new a.cP(this.tileID,this.promoteId);Ae.bucketLayerIDs=[];let Se={},Re={featureIndex:Ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:te,subdivisionGranularity:be},Xe=Q.familiesBySource[this.source];for(let De in Xe){let Zn=J.layers[De];if(!Zn)continue;Zn.version===1&&a.w(`Vector tile source "${this.source}" layer "${De}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let yr=Le.encode(De),La=[];for(let Mi=0;Mi<Zn.length;Mi++){let ht=Zn.feature(Mi),en=Ae.getId(ht,De);La.push({feature:ht,id:en,index:Mi,sourceLayerIndex:yr})}for(let Mi of Xe[De]){let ht=Mi[0];ht.source!==this.source&&a.w(`layer.source = ${ht.source} does not equal this.source = ${this.source}`),ht.isHidden(this.zoom,!0)||(w(Mi,this.zoom,te),(Se[ht.id]=ht.createBucket({index:Ae.bucketLayerIDs.length,layers:Mi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:yr,sourceID:this.source})).populate(La,Re,this.tileID.canonical),Ae.bucketLayerIDs.push(Mi.map(en=>en.id)))}}let Ge=a.bY(Re.glyphDependencies,De=>Object.keys(De).map(Number));this.inFlightDependencies.forEach(De=>De?.abort()),this.inFlightDependencies=[];let Ke=Promise.resolve({});if(Object.keys(Ge).length){let De=new AbortController;this.inFlightDependencies.push(De),Ke=ge.sendAsync({type:"GG",data:{stacks:Ge,source:this.source,tileID:this.tileID,type:"glyphs"}},De)}let Te=Object.keys(Re.iconDependencies),Ut=Promise.resolve({});if(Te.length){let De=new AbortController;this.inFlightDependencies.push(De),Ut=ge.sendAsync({type:"GI",data:{icons:Te,source:this.source,tileID:this.tileID,type:"icons"}},De)}let Wn=Object.keys(Re.patternDependencies),Et=Promise.resolve({});if(Wn.length){let De=new AbortController;this.inFlightDependencies.push(De),Et=ge.sendAsync({type:"GI",data:{icons:Wn,source:this.source,tileID:this.tileID,type:"patterns"}},De)}let xt=Re.dashDependencies,qt=Promise.resolve({});if(Object.keys(xt).length){let De=new AbortController;this.inFlightDependencies.push(De),qt=ge.sendAsync({type:"GDA",data:{dashes:xt}},De)}let[Dn,Mn,Hn,ni]=yield Promise.all([Ke,Ut,Et,qt]),Bn=new f(Dn),Yt=new a.cQ(Mn,Hn);for(let De in Se){let Zn=Se[De];Zn instanceof a.ah?(w(Zn.layers,this.zoom,te),a.cR({bucket:Zn,glyphMap:Dn,glyphPositions:Bn.positions,imageMap:Mn,imagePositions:Yt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Re.subdivisionGranularity})):Zn.hasDependencies&&(Zn instanceof a.cS||Zn instanceof a.cT||Zn instanceof a.cU)&&(w(Zn.layers,this.zoom,te),Zn.addFeatures(Re,this.tileID.canonical,Yt.patternPositions,ni))}return this.status="done",{buckets:Object.values(Se).filter(De=>!De.isEmpty()),featureIndex:Ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Bn.image,imageAtlas:Yt,dashPositions:ni,glyphMap:this.returnDependencies?Dn:null,iconMap:this.returnDependencies?Mn:null,glyphPositions:this.returnDependencies?Bn.positions:null}})}}function w(Ie,J,Q){let te=new a.H(J);for(let ge of Ie)ge.recalculate(te,Q)}class D{constructor(J,Q,te,ge,be){this.type=J,this.properties=te||{},this.extent=be,this.pointsArray=Q,this.id=ge}loadGeometry(){return this.pointsArray.map(J=>J.map(Q=>new a.P(Q.x,Q.y)))}}class A{constructor(J,Q,te){this.version=2,this._myFeatures=J,this.name=Q,this.length=J.length,this.extent=te}feature(J){return this._myFeatures[J]}}class z{constructor(){this.layers={}}addLayer(J){this.layers[J.name]=J}}function H(Ie){let J=a.cV(Ie);return J.byteOffset===0&&J.byteLength===J.buffer.byteLength||(J=new Uint8Array(J)),{vectorTile:Ie,rawData:J.buffer}}function q(Ie,J,Q){let{extent:te}=Ie,ge=Math.pow(2,Q.z-J.z),be=(Q.x-J.x*ge)*te,Le=(Q.y-J.y*ge)*te,Ae=[];for(let Se=0;Se<Ie.length;Se++){let Re=Ie.feature(Se),Xe=Re.loadGeometry();for(let Ke of Xe)for(let Te of Ke)Te.x=Te.x*ge-be,Te.y=Te.y*ge-Le;let Ge=128;Xe=a.cW(Xe,Re.type,-Ge,-Ge,te+Ge,te+Ge),Xe.length!==0&&Ae.push(new D(Re.type,Xe,Re.properties,Re.id,te))}return new A(Ae,Ie.name,te)}class W{constructor(J,Q,te){this.actor=J,this.layerIndex=Q,this.availableImages=te,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new a.cX(1e3)}loadVectorTile(J,Q){return a._(this,void 0,void 0,function*(){let te=yield a.n(J.request,Q);try{return{vectorTile:J.encoding!=="mlt"?new a.cY(new a.cZ(te.data)):new a.c_(te.data),rawData:te.data,cacheControl:te.cacheControl,expires:te.expires}}catch(ge){let be=new Uint8Array(te.data),Le=`Unable to parse the tile at ${J.request.url}, `;throw Le+=be[0]===31&&be[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ge.message}`,new Error(Le)}})}loadTile(J){return a._(this,void 0,void 0,function*(){let{uid:Q,overzoomParameters:te}=J;te&&(J.request=te.overzoomRequest);let ge=!!(J&&J.request&&J.request.collectResourceTiming)&&new a.c$(J.request),be=new v(J);this.loading[Q]=be;let Le=new AbortController;be.abort=Le;try{let Ae=yield this.loadVectorTile(J,Le);if(delete this.loading[Q],!Ae)return null;if(te){let Ke=this._getOverzoomTile(J,Ae.vectorTile);Ae.rawData=Ke.rawData,Ae.vectorTile=Ke.vectorTile}let Se=Ae.rawData,Re={};Ae.expires&&(Re.expires=Ae.expires),Ae.cacheControl&&(Re.cacheControl=Ae.cacheControl);let Xe={};if(ge){let Ke=ge.finish();Ke&&(Xe.resourceTiming=JSON.parse(JSON.stringify(Ke)))}be.vectorTile=Ae.vectorTile;let Ge=be.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor,J.subdivisionGranularity);this.loaded[Q]=be,this.fetching[Q]={rawTileData:Se,cacheControl:Re,resourceTiming:Xe};try{let Ke=yield Ge;return a.e({rawTileData:Se.slice(0),encoding:J.encoding},Ke,Re,Xe)}finally{delete this.fetching[Q]}}catch(Ae){throw delete this.loading[Q],be.status="done",this.loaded[Q]=be,Ae}})}_getOverzoomTile(J,Q){let{tileID:te,source:ge,overzoomParameters:be}=J,{maxZoomTileID:Le}=be,Ae=`${Le.key}_${te.key}`,Se=this.overzoomedTileResultCache.get(Ae);if(Se)return Se;let Re=new z,Xe=this.layerIndex.familiesBySource[ge];for(let Ke in Xe){let Te=Q.layers[Ke];if(!Te)continue;let Ut=q(Te,Le,te.canonical);Ut.length>0&&Re.addLayer(Ut)}let Ge=H(Re);return this.overzoomedTileResultCache.set(Ae,Ge),Ge}reloadTile(J){return a._(this,void 0,void 0,function*(){let Q=J.uid;if(!this.loaded||!this.loaded[Q])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");let te=this.loaded[Q];if(te.showCollisionBoxes=J.showCollisionBoxes,te.status==="parsing"){let ge=yield te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,J.subdivisionGranularity),be;if(this.fetching[Q]){let{rawTileData:Le,cacheControl:Ae,resourceTiming:Se}=this.fetching[Q];delete this.fetching[Q],be=a.e({rawTileData:Le.slice(0),encoding:J.encoding},ge,Ae,Se)}else be=ge;return be}if(te.status==="done"&&te.vectorTile)return te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,J.subdivisionGranularity)})}abortTile(J){return a._(this,void 0,void 0,function*(){let Q=this.loading,te=J.uid;Q&&Q[te]&&Q[te].abort&&(Q[te].abort.abort(),delete Q[te])})}removeTile(J){return a._(this,void 0,void 0,function*(){this.loaded&&this.loaded[J.uid]&&delete this.loaded[J.uid]})}}class me{constructor(){this.loaded={}}loadTile(J){return a._(this,void 0,void 0,function*(){let{uid:Q,encoding:te,rawImageData:ge,redFactor:be,greenFactor:Le,blueFactor:Ae,baseShift:Se}=J,Re=ge.width+2,Xe=ge.height+2,Ge=a.b(ge)?new a.R({width:Re,height:Xe},yield a.d0(ge,-1,-1,Re,Xe)):ge,Ke=new a.d1(Q,Ge,te,be,Le,Ae,Se);return this.loaded=this.loaded||{},this.loaded[Q]=Ke,Ke})}removeTile(J){let Q=this.loaded,te=J.uid;Q&&Q[te]&&delete Q[te]}}var ce,ue,Me=(function(){if(ue)return ce;function Ie(Q,te){if(Q.length!==0){J(Q[0],te);for(var ge=1;ge<Q.length;ge++)J(Q[ge],!te)}}function J(Q,te){for(var ge=0,be=0,Le=0,Ae=Q.length,Se=Ae-1;Le<Ae;Se=Le++){var Re=(Q[Le][0]-Q[Se][0])*(Q[Se][1]+Q[Le][1]),Xe=ge+Re;be+=Math.abs(ge)>=Math.abs(Re)?ge-Xe+Re:Re-Xe+ge,ge=Xe}ge+be>=0!=!!te&&Q.reverse()}return ue=1,ce=function Q(te,ge){var be,Le=te&&te.type;if(Le==="FeatureCollection")for(be=0;be<te.features.length;be++)Q(te.features[be],ge);else if(Le==="GeometryCollection")for(be=0;be<te.geometries.length;be++)Q(te.geometries[be],ge);else if(Le==="Feature")Q(te.geometry,ge);else if(Le==="Polygon")Ie(te.coordinates,ge);else if(Le==="MultiPolygon")for(be=0;be<te.coordinates.length;be++)Ie(te.coordinates[be],ge);return te}})(),Ue=a.d2(Me);let Pe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ie=>Ie},ke=Math.fround||(Qe=new Float32Array(1),Ie=>(Qe[0]=+Ie,Qe[0]));var Qe;class ot{constructor(J){this.options=Object.assign(Object.create(Pe),J),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(J){let{log:Q,minZoom:te,maxZoom:ge}=this.options;Q&&console.time("total time");let be=`prepare ${J.length} points`;Q&&console.time(be),this.points=J;let Le=[];for(let Se=0;Se<J.length;Se++){let Re=J[Se];if(!Re.geometry)continue;let[Xe,Ge]=Re.geometry.coordinates,Ke=ke(pt(Xe)),Te=ke(Vt(Ge));Le.push(Ke,Te,1/0,Se,-1,1),this.options.reduce&&Le.push(0)}let Ae=this.trees[ge+1]=this._createTree(Le);Q&&console.timeEnd(be);for(let Se=ge;Se>=te;Se--){let Re=+Date.now();Ae=this.trees[Se]=this._createTree(this._cluster(Ae,Se)),Q&&console.log("z%d: %d clusters in %dms",Se,Ae.numItems,+Date.now()-Re)}return Q&&console.timeEnd("total time"),this}getClusters(J,Q){let te=((J[0]+180)%360+360)%360-180,ge=Math.max(-90,Math.min(90,J[1])),be=J[2]===180?180:((J[2]+180)%360+360)%360-180,Le=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)te=-180,be=180;else if(te>be){let Ge=this.getClusters([te,ge,180,Le],Q),Ke=this.getClusters([-180,ge,be,Le],Q);return Ge.concat(Ke)}let Ae=this.trees[this._limitZoom(Q)],Se=Ae.range(pt(te),Vt(Le),pt(be),Vt(ge)),Re=Ae.data,Xe=[];for(let Ge of Se){let Ke=this.stride*Ge;Xe.push(Re[Ke+5]>1?st(Re,Ke,this.clusterProps):this.points[Re[Ke+3]])}return Xe}getChildren(J){let Q=this._getOriginId(J),te=this._getOriginZoom(J),ge="No cluster with the specified id.",be=this.trees[te];if(!be)throw new Error(ge);let Le=be.data;if(Q*this.stride>=Le.length)throw new Error(ge);let Ae=this.options.radius/(this.options.extent*Math.pow(2,te-1)),Se=be.within(Le[Q*this.stride],Le[Q*this.stride+1],Ae),Re=[];for(let Xe of Se){let Ge=Xe*this.stride;Le[Ge+4]===J&&Re.push(Le[Ge+5]>1?st(Le,Ge,this.clusterProps):this.points[Le[Ge+3]])}if(Re.length===0)throw new Error(ge);return Re}getLeaves(J,Q,te){let ge=[];return this._appendLeaves(ge,J,Q=Q||10,te=te||0,0),ge}getTile(J,Q,te){let ge=this.trees[this._limitZoom(J)],be=Math.pow(2,J),{extent:Le,radius:Ae}=this.options,Se=Ae/Le,Re=(te-Se)/be,Xe=(te+1+Se)/be,Ge={features:[]};return this._addTileFeatures(ge.range((Q-Se)/be,Re,(Q+1+Se)/be,Xe),ge.data,Q,te,be,Ge),Q===0&&this._addTileFeatures(ge.range(1-Se/be,Re,1,Xe),ge.data,be,te,be,Ge),Q===be-1&&this._addTileFeatures(ge.range(0,Re,Se/be,Xe),ge.data,-1,te,be,Ge),Ge.features.length?Ge:null}getClusterExpansionZoom(J){let Q=this._getOriginZoom(J)-1;for(;Q<=this.options.maxZoom;){let te=this.getChildren(J);if(Q++,te.length!==1)break;J=te[0].properties.cluster_id}return Q}_appendLeaves(J,Q,te,ge,be){let Le=this.getChildren(Q);for(let Ae of Le){let Se=Ae.properties;if(Se&&Se.cluster?be+Se.point_count<=ge?be+=Se.point_count:be=this._appendLeaves(J,Se.cluster_id,te,ge,be):be<ge?be++:J.push(Ae),J.length===te)break}return be}_createTree(J){let Q=new a.aT(J.length/this.stride|0,this.options.nodeSize,Float32Array);for(let te=0;te<J.length;te+=this.stride)Q.add(J[te],J[te+1]);return Q.finish(),Q.data=J,Q}_addTileFeatures(J,Q,te,ge,be,Le){for(let Ae of J){let Se=Ae*this.stride,Re=Q[Se+5]>1,Xe,Ge,Ke;if(Re)Xe=it(Q,Se,this.clusterProps),Ge=Q[Se],Ke=Q[Se+1];else{let Wn=this.points[Q[Se+3]];Xe=Wn.properties;let[Et,xt]=Wn.geometry.coordinates;Ge=pt(Et),Ke=Vt(xt)}let Te={type:1,geometry:[[Math.round(this.options.extent*(Ge*be-te)),Math.round(this.options.extent*(Ke*be-ge))]],tags:Xe},Ut;Ut=Re||this.options.generateId?Q[Se+3]:this.points[Q[Se+3]].id,Ut!==void 0&&(Te.id=Ut),Le.features.push(Te)}}_limitZoom(J){return Math.max(this.options.minZoom,Math.min(Math.floor(+J),this.options.maxZoom+1))}_cluster(J,Q){let{radius:te,extent:ge,reduce:be,minPoints:Le}=this.options,Ae=te/(ge*Math.pow(2,Q)),Se=J.data,Re=[],Xe=this.stride;for(let Ge=0;Ge<Se.length;Ge+=Xe){if(Se[Ge+2]<=Q)continue;Se[Ge+2]=Q;let Ke=Se[Ge],Te=Se[Ge+1],Ut=J.within(Se[Ge],Se[Ge+1],Ae),Wn=Se[Ge+5],Et=Wn;for(let xt of Ut){let qt=xt*Xe;Se[qt+2]>Q&&(Et+=Se[qt+5])}if(Et>Wn&&Et>=Le){let xt,qt=Ke*Wn,Dn=Te*Wn,Mn=-1,Hn=(Ge/Xe<<5)+(Q+1)+this.points.length;for(let ni of Ut){let Bn=ni*Xe;if(Se[Bn+2]<=Q)continue;Se[Bn+2]=Q;let Yt=Se[Bn+5];qt+=Se[Bn]*Yt,Dn+=Se[Bn+1]*Yt,Se[Bn+4]=Hn,be&&(xt||(xt=this._map(Se,Ge,!0),Mn=this.clusterProps.length,this.clusterProps.push(xt)),be(xt,this._map(Se,Bn)))}Se[Ge+4]=Hn,Re.push(qt/Et,Dn/Et,1/0,Hn,-1,Et),be&&Re.push(Mn)}else{for(let xt=0;xt<Xe;xt++)Re.push(Se[Ge+xt]);if(Et>1)for(let xt of Ut){let qt=xt*Xe;if(!(Se[qt+2]<=Q)){Se[qt+2]=Q;for(let Dn=0;Dn<Xe;Dn++)Re.push(Se[qt+Dn])}}}}return Re}_getOriginId(J){return J-this.points.length>>5}_getOriginZoom(J){return(J-this.points.length)%32}_map(J,Q,te){if(J[Q+5]>1){let Le=this.clusterProps[J[Q+6]];return te?Object.assign({},Le):Le}let ge=this.points[J[Q+3]].properties,be=this.options.map(ge);return te&&be===ge?Object.assign({},be):be}}function st(Ie,J,Q){return{type:"Feature",id:Ie[J+3],properties:it(Ie,J,Q),geometry:{type:"Point",coordinates:[(te=Ie[J],360*(te-.5)),Pt(Ie[J+1])]}};var te}function it(Ie,J,Q){let te=Ie[J+5],ge=te>=1e4?`${Math.round(te/1e3)}k`:te>=1e3?Math.round(te/100)/10+"k":te,be=Ie[J+6],Le=be===-1?{}:Object.assign({},Q[be]);return Object.assign(Le,{cluster:!0,cluster_id:Ie[J+3],point_count:te,point_count_abbreviated:ge})}function pt(Ie){return Ie/360+.5}function Vt(Ie){let J=Math.sin(Ie*Math.PI/180),Q=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return Q<0?0:Q>1?1:Q}function Pt(Ie){let J=(180-360*Ie)*Math.PI/180;return 360*Math.atan(Math.exp(J))/Math.PI-90}function At(Ie,J,Q,te){let ge=te,be=J+(Q-J>>1),Le,Ae=Q-J,Se=Ie[J],Re=Ie[J+1],Xe=Ie[Q],Ge=Ie[Q+1];for(let Ke=J+3;Ke<Q;Ke+=3){let Te=Gt(Ie[Ke],Ie[Ke+1],Se,Re,Xe,Ge);if(Te>ge)Le=Ke,ge=Te;else if(Te===ge){let Ut=Math.abs(Ke-be);Ut<Ae&&(Le=Ke,Ae=Ut)}}ge>te&&(Le-J>3&&At(Ie,J,Le,te),Ie[Le+2]=ge,Q-Le>3&&At(Ie,Le,Q,te))}function Gt(Ie,J,Q,te,ge,be){let Le=ge-Q,Ae=be-te;if(Le!==0||Ae!==0){let Se=((Ie-Q)*Le+(J-te)*Ae)/(Le*Le+Ae*Ae);Se>1?(Q=ge,te=be):Se>0&&(Q+=Le*Se,te+=Ae*Se)}return Le=Ie-Q,Ae=J-te,Le*Le+Ae*Ae}function yt(Ie,J,Q,te){let ge={type:J,geom:Q},be={id:Ie??null,type:ge.type,geometry:ge.geom,tags:te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};switch(ge.type){case"Point":case"MultiPoint":case"LineString":dt(be,ge.geom);break;case"Polygon":dt(be,ge.geom[0]);break;case"MultiLineString":for(let Le of ge.geom)dt(be,Le);break;case"MultiPolygon":for(let Le of ge.geom)dt(be,Le[0])}return be}function dt(Ie,J){for(let Q=0;Q<J.length;Q+=3)Ie.minX=Math.min(Ie.minX,J[Q]),Ie.minY=Math.min(Ie.minY,J[Q+1]),Ie.maxX=Math.max(Ie.maxX,J[Q]),Ie.maxY=Math.max(Ie.maxY,J[Q+1])}function ft(Ie,J){let Q=[];switch(Ie.type){case"FeatureCollection":for(let te=0;te<Ie.features.length;te++)rt(Q,Ie.features[te],J,te);break;case"Feature":rt(Q,Ie,J);break;default:rt(Q,{geometry:Ie,properties:void 0},J)}return Q}function rt(Ie,J,Q,te){if(!J.geometry)return;if(J.geometry.type==="GeometryCollection"){for(let Ae of J.geometry.geometries)rt(Ie,{id:J.id,geometry:Ae,properties:J.properties},Q,te);return}if(!J.geometry.coordinates?.length)return;let be=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2),Le=J.id;switch(Q.promoteId?Le=J.properties?.[Q.promoteId]:Q.generateId&&(Le=te||0),J.geometry.type){case"Point":{let Ae=[];return Dt(J.geometry.coordinates,Ae),void Ie.push(yt(Le,J.geometry.type,Ae,J.properties))}case"MultiPoint":{let Ae=[];for(let Se of J.geometry.coordinates)Dt(Se,Ae);return void Ie.push(yt(Le,J.geometry.type,Ae,J.properties))}case"LineString":{let Ae=[];return $t(J.geometry.coordinates,Ae,be,!1),void Ie.push(yt(Le,J.geometry.type,Ae,J.properties))}case"MultiLineString":{if(Q.lineMetrics){for(let Se of J.geometry.coordinates){let Re=[];$t(Se,Re,be,!1),Ie.push(yt(Le,"LineString",Re,J.properties))}return}let Ae=[];return Qt(J.geometry.coordinates,Ae,be,!1),void Ie.push(yt(Le,J.geometry.type,Ae,J.properties))}case"Polygon":{let Ae=[];return Qt(J.geometry.coordinates,Ae,be,!0),void Ie.push(yt(Le,J.geometry.type,Ae,J.properties))}case"MultiPolygon":{let Ae=[];for(let Se of J.geometry.coordinates){let Re=[];Qt(Se,Re,be,!0),Ae.push(Re)}return void Ie.push(yt(Le,J.geometry.type,Ae,J.properties))}default:throw new Error("Input data is not a valid GeoJSON object.")}}function Dt(Ie,J){J.push(et(Ie[0]),Zt(Ie[1]),0)}function $t(Ie,J,Q,te){let ge,be,Le=0;for(let Se=0;Se<Ie.length;Se++){let Re=et(Ie[Se][0]),Xe=Zt(Ie[Se][1]);J.push(Re,Xe,0),Se>0&&(Le+=te?(ge*Xe-Re*be)/2:Math.sqrt(Math.pow(Re-ge,2)+Math.pow(Xe-be,2))),ge=Re,be=Xe}let Ae=J.length-3;J[2]=1,Q>0&&At(J,0,Ae,Q),J[Ae+2]=1,J.size=Math.abs(Le),J.start=0,J.end=J.size}function Qt(Ie,J,Q,te){for(let ge=0;ge<Ie.length;ge++){let be=[];$t(Ie[ge],be,Q,te),J.push(be)}}function et(Ie){return Ie/360+.5}function Zt(Ie){let J=Math.sin(Ie*Math.PI/180),Q=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return Q<0?0:Q>1?1:Q}function Rt(Ie,J,Q,te,ge,be,Le,Ae){if(te/=J,be>=(Q/=J)&&Le<te)return Ie;if(Le<Q||be>=te)return null;let Se=[];for(let Re of Ie){let Xe=ge===0?Re.minX:Re.minY,Ge=ge===0?Re.maxX:Re.maxY;if(Xe>=Q&&Ge<te)Se.push(Re);else if(!(Ge<Q||Xe>=te))switch(Re.type){case"Point":case"MultiPoint":{let Ke=[];if(Sn(Re.geometry,Ke,Q,te,ge),!Ke.length)continue;Se.push(yt(Re.id,Ke.length===3?"Point":"MultiPoint",Ke,Re.tags));continue}case"LineString":{let Ke=[];if(kn(Re.geometry,Ke,Q,te,ge,!1,Ae.lineMetrics),!Ke.length)continue;if(Ae.lineMetrics){for(let Te of Ke)Se.push(yt(Re.id,Re.type,Te,Re.tags));continue}if(Ke.length>1){Se.push(yt(Re.id,"MultiLineString",Ke,Re.tags));continue}Se.push(yt(Re.id,Re.type,Ke[0],Re.tags));continue}case"MultiLineString":{let Ke=[];if(Zi(Re.geometry,Ke,Q,te,ge,!1),!Ke.length)continue;if(Ke.length===1){Se.push(yt(Re.id,"LineString",Ke[0],Re.tags));continue}Se.push(yt(Re.id,Re.type,Ke,Re.tags));continue}case"Polygon":{let Ke=[];if(Zi(Re.geometry,Ke,Q,te,ge,!0),!Ke.length)continue;Se.push(yt(Re.id,Re.type,Ke,Re.tags));continue}case"MultiPolygon":{let Ke=[];for(let Te of Re.geometry){let Ut=[];Zi(Te,Ut,Q,te,ge,!0),Ut.length&&Ke.push(Ut)}if(!Ke.length)continue;Se.push(yt(Re.id,Re.type,Ke,Re.tags));continue}}}return Se.length?Se:null}function Sn(Ie,J,Q,te,ge){for(let be=0;be<Ie.length;be+=3){let Le=Ie[be+ge];Le>=Q&&Le<=te&&Ti(J,Ie[be],Ie[be+1],Ie[be+2])}}function kn(Ie,J,Q,te,ge,be,Le){let Ae=Ei(Ie),Se=ge===0?ti:ss,Re,Xe,Ge=Ie.start;for(let Et=0;Et<Ie.length-3;Et+=3){let xt=Ie[Et],qt=Ie[Et+1],Dn=Ie[Et+2],Mn=Ie[Et+3],Hn=Ie[Et+4],ni=ge===0?xt:qt,Bn=ge===0?Mn:Hn,Yt=!1;Le&&(Re=Math.sqrt(Math.pow(xt-Mn,2)+Math.pow(qt-Hn,2))),ni<Q?Bn>Q&&(Xe=Se(Ae,xt,qt,Mn,Hn,Q),Le&&(Ae.start=Ge+Re*Xe)):ni>te?Bn<te&&(Xe=Se(Ae,xt,qt,Mn,Hn,te),Le&&(Ae.start=Ge+Re*Xe)):Ti(Ae,xt,qt,Dn),Bn<Q&&ni>=Q&&(Xe=Se(Ae,xt,qt,Mn,Hn,Q),Yt=!0),Bn>te&&ni<=te&&(Xe=Se(Ae,xt,qt,Mn,Hn,te),Yt=!0),!be&&Yt&&(Le&&(Ae.end=Ge+Re*Xe),J.push(Ae),Ae=Ei(Ie)),Le&&(Ge+=Re)}let Ke=Ie.length-3,Te=Ie[Ke],Ut=Ie[Ke+1],Wn=ge===0?Te:Ut;Wn>=Q&&Wn<=te&&Ti(Ae,Te,Ut,Ie[Ke+2]),Ke=Ae.length-3,be&&Ke>=3&&(Ae[Ke]!==Ae[0]||Ae[Ke+1]!==Ae[1])&&Ti(Ae,Ae[0],Ae[1],Ae[2]),Ae.length&&J.push(Ae)}function Ei(Ie){let J=[];return J.size=Ie.size,J.start=Ie.start,J.end=Ie.end,J}function Zi(Ie,J,Q,te,ge,be){for(let Le of Ie)kn(Le,J,Q,te,ge,be,!1)}function Ti(Ie,J,Q,te){Ie.push(J,Q,te)}function ti(Ie,J,Q,te,ge,be){let Le=(be-J)/(te-J);return Ti(Ie,be,Q+(ge-Q)*Le,1),Le}function ss(Ie,J,Q,te,ge,be){let Le=(be-Q)/(ge-Q);return Ti(Ie,J+(te-J)*Le,be,1),Le}function zi(Ie,J){let Q=J.buffer/J.extent,te=Ie,ge=Rt(Ie,1,-1-Q,Q,0,-1,2,J),be=Rt(Ie,1,1-Q,2+Q,0,-1,2,J);return(ge||be)&&(te=Rt(Ie,1,-Q,1+Q,0,-1,2,J)||[],ge&&(te=ir(ge,1).concat(te)),be&&(te=te.concat(ir(be,-1)))),te}function ir(Ie,J){let Q=[];for(let te of Ie)switch(te.type){case"Point":case"MultiPoint":case"LineString":{let ge=Qi(te.geometry,J);Q.push(yt(te.id,te.type,ge,te.tags));continue}case"MultiLineString":case"Polygon":{let ge=[];for(let be of te.geometry)ge.push(Qi(be,J));Q.push(yt(te.id,te.type,ge,te.tags));continue}case"MultiPolygon":{let ge=[];for(let be of te.geometry){let Le=[];for(let Ae of be)Le.push(Qi(Ae,J));ge.push(Le)}Q.push(yt(te.id,te.type,ge,te.tags));continue}}return Q}function Qi(Ie,J){let Q=[];Q.size=Ie.size,Ie.start!==void 0&&(Q.start=Ie.start,Q.end=Ie.end);for(let te=0;te<Ie.length;te+=3)Q.push(Ie[te]+J,Ie[te+1],Ie[te+2]);return Q}function bn(Ie,J){if(Ie.transformed)return Ie;let Q=1<<Ie.z,te=Ie.x,ge=Ie.y;for(let be of Ie.features){if(be.type===1){let Ae=[];for(let Se=0;Se<be.geometry.length;Se+=2)Ae.push(Di(be.geometry[Se],be.geometry[Se+1],J,Q,te,ge));be.geometry=Ae;continue}let Le=[];for(let Ae of be.geometry){let Se=[];for(let Re=0;Re<Ae.length;Re+=2)Se.push(Di(Ae[Re],Ae[Re+1],J,Q,te,ge));Le.push(Se)}be.geometry=Le}return Ie.transformed=!0,Ie}function Di(Ie,J,Q,te,ge,be){return[Math.round(Q*(Ie*te-ge)),Math.round(Q*(J*te-be))]}function Do(Ie,J,Q,te,ge){let be=J===ge.maxZoom?0:ge.tolerance/((1<<J)*ge.extent),Le={features:[],numPoints:0,numSimplified:0,numFeatures:Ie.length,source:null,x:Q,y:te,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let Ae of Ie)ro(Le,Ae,be,ge);return Le}function ro(Ie,J,Q,te){Ie.minX=Math.min(Ie.minX,J.minX),Ie.minY=Math.min(Ie.minY,J.minY),Ie.maxX=Math.max(Ie.maxX,J.maxX),Ie.maxY=Math.max(Ie.maxY,J.maxY);let ge,be=J.tags||null;switch(J.type){case"Point":case"MultiPoint":{let Le=[];for(let Ae=0;Ae<J.geometry.length;Ae+=3)Le.push(J.geometry[Ae],J.geometry[Ae+1]),Ie.numPoints++,Ie.numSimplified++;if(!Le.length)return;ge={type:1,tags:be,geometry:Le};break}case"LineString":{let Le=[];if(ur(Le,J.geometry,Ie,Q,!1,!1),!Le.length)return;if(te.lineMetrics){be={};for(let Ae in J.tags)be[Ae]=J.tags[Ae];be.mapbox_clip_start=J.geometry.start/J.geometry.size,be.mapbox_clip_end=J.geometry.end/J.geometry.size}ge={type:2,tags:be,geometry:Le};break}case"MultiLineString":case"Polygon":{let Le=[];for(let Ae=0;Ae<J.geometry.length;Ae++)ur(Le,J.geometry[Ae],Ie,Q,J.type==="Polygon",Ae===0);if(!Le.length)return;ge={type:J.type==="Polygon"?3:2,tags:be,geometry:Le};break}case"MultiPolygon":{let Le=[];for(let Ae=0;Ae<J.geometry.length;Ae++){let Se=J.geometry[Ae];for(let Re=0;Re<Se.length;Re++)ur(Le,Se[Re],Ie,Q,!0,Re===0)}if(!Le.length)return;ge={type:3,tags:be,geometry:Le};break}}J.id!==null&&(ge.id=J.id),Ie.features.push(ge)}function ur(Ie,J,Q,te,ge,be){let Le=te*te;if(te>0&&J.size<(ge?Le:te))return void(Q.numPoints+=J.length/3);let Ae=[];for(let Se=0;Se<J.length;Se+=3)(te===0||J[Se+2]>Le)&&(Q.numSimplified++,Ae.push(J[Se],J[Se+1])),Q.numPoints++;ge&&(function(Se,Re){let Xe=0;for(let Ge=0,Ke=Se.length,Te=Ke-2;Ge<Ke;Te=Ge,Ge+=2)Xe+=(Se[Ge]-Se[Te])*(Se[Ge+1]+Se[Te+1]);if(Xe>0===Re)for(let Ge=0,Ke=Se.length;Ge<Ke/2;Ge+=2){let Te=Se[Ge],Ut=Se[Ge+1];Se[Ge]=Se[Ke-2-Ge],Se[Ge+1]=Se[Ke-1-Ge],Se[Ke-2-Ge]=Te,Se[Ke-1-Ge]=Ut}})(Ae,be),Ie.push(Ae)}function hr(Ie,J,Q){let te=!!J.newGeometry,ge=J.removeAllProperties||J.removeProperties?.length>0||J.addOrUpdateProperties?.length>0;if(te){let be=ft({type:"FeatureCollection",features:[{type:"Feature",id:Ie.id,geometry:J.newGeometry,properties:ge?$r(Ie.tags,J):Ie.tags}]},Q);return be=zi(be,Q),be[0]}if(ge){let be=St({},Ie);return be.tags=$r(be.tags,J),be}return null}function $r(Ie,J){if(J.removeAllProperties)return{};let Q=St({},Ie||{});if(J.removeProperties)for(let te of J.removeProperties)delete Q[te];if(J.addOrUpdateProperties)for(let{key:te,value:ge}of J.addOrUpdateProperties)Q[te]=ge;return Q}let Mo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,updateable:!1,debug:0};class $n{options;tiles;tileCoords;stats={};total=0;source;constructor(J,Q){let te=(Q=this.options=Object.assign({},Mo,Q)).debug;if(te&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");let ge=ft(J,Q);this.tiles={},this.tileCoords=[],te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ge=zi(ge,Q),ge.length&&this.splitTile(ge,0,0,0),Q.updateable&&(this.source=ge),te&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(J,Q,te,ge,be,Le,Ae){let Se=[J,Q,te,ge],Re=this.options,Xe=Re.debug;for(;Se.length;){ge=Se.pop(),te=Se.pop(),Q=Se.pop(),J=Se.pop();let Ge=1<<Q,Ke=oo(Q,te,ge),Te=this.tiles[Ke];if(!Te&&(Xe>1&&console.time("creation"),Te=this.tiles[Ke]=Do(J,Q,te,ge,Re),this.tileCoords.push({z:Q,x:te,y:ge,id:Ke}),Xe)){Xe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,te,ge,Te.numFeatures,Te.numPoints,Te.numSimplified),console.timeEnd("creation"));let Yt=`z${Q}`;this.stats[Yt]=(this.stats[Yt]||0)+1,this.total++}if(Te.source=J,be==null){if(Q===Re.indexMaxZoom||Te.numPoints<=Re.indexMaxPoints)continue}else{if(Q===Re.maxZoom||Q===be)continue;if(be!=null){let Yt=be-Q;if(te!==Le>>Yt||ge!==Ae>>Yt)continue}}if(Te.source=null,!J.length)continue;Xe>1&&console.time("clipping");let Ut=.5*Re.buffer/Re.extent,Wn=.5-Ut,Et=.5+Ut,xt=1+Ut,qt=null,Dn=null,Mn=null,Hn=null,ni=Rt(J,Ge,te-Ut,te+Et,0,Te.minX,Te.maxX,Re),Bn=Rt(J,Ge,te+Wn,te+xt,0,Te.minX,Te.maxX,Re);ni&&(qt=Rt(ni,Ge,ge-Ut,ge+Et,1,Te.minY,Te.maxY,Re),Dn=Rt(ni,Ge,ge+Wn,ge+xt,1,Te.minY,Te.maxY,Re)),Bn&&(Mn=Rt(Bn,Ge,ge-Ut,ge+Et,1,Te.minY,Te.maxY,Re),Hn=Rt(Bn,Ge,ge+Wn,ge+xt,1,Te.minY,Te.maxY,Re)),Xe>1&&console.timeEnd("clipping"),Se.push(qt||[],Q+1,2*te,2*ge),Se.push(Dn||[],Q+1,2*te,2*ge+1),Se.push(Mn||[],Q+1,2*te+1,2*ge),Se.push(Hn||[],Q+1,2*te+1,2*ge+1)}}getTile(J,Q,te){J=+J,Q=+Q,te=+te;let ge=this.options,{extent:be,debug:Le}=ge;if(J<0||J>24)return null;let Ae=1<<J,Se=oo(J,Q=Q+Ae&Ae-1,te);if(this.tiles[Se])return bn(this.tiles[Se],be);Le>1&&console.log("drilling down to z%d-%d-%d",J,Q,te);let Re,Xe=J,Ge=Q,Ke=te;for(;!Re&&Xe>0;)Xe--,Ge>>=1,Ke>>=1,Re=this.tiles[oo(Xe,Ge,Ke)];return Re?.source?(Le>1&&(console.log("found parent tile z%d-%d-%d",Xe,Ge,Ke),console.time("drilling down")),this.splitTile(Re.source,Xe,Ge,Ke,J,Q,te),Le>1&&console.timeEnd("drilling down"),this.tiles[Se]?bn(this.tiles[Se],be):null):null}invalidateTiles(J){let Q=this.options,{debug:te}=Q,ge=1/0,be=-1/0,Le=1/0,Ae=-1/0;for(let Xe of J)ge=Math.min(ge,Xe.minX),be=Math.max(be,Xe.maxX),Le=Math.min(Le,Xe.minY),Ae=Math.max(Ae,Xe.maxY);let Se=Q.buffer/Q.extent,Re=new Set;for(let Xe in this.tiles){let Ge=this.tiles[Xe],Ke=1<<Ge.z,Te=(Ge.x-Se)/Ke,Ut=(Ge.x+1+Se)/Ke,Wn=(Ge.y-Se)/Ke,Et=(Ge.y+1+Se)/Ke;if(be<Te||ge>=Ut||Ae<Wn||Le>=Et)continue;let xt=!1;for(let qt of J)if(qt.maxX>=Te&&qt.minX<Ut&&qt.maxY>=Wn&&qt.minY<Et){xt=!0;break}if(xt){if(te){te>1&&console.log("invalidate tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ge.z,Ge.x,Ge.y,Ge.numFeatures,Ge.numPoints,Ge.numSimplified);let qt=`z${Ge.z}`;this.stats[qt]=(this.stats[qt]||0)-1,this.total--}delete this.tiles[Xe],Re.add(Xe)}}Re.size&&(this.tileCoords=this.tileCoords.filter(Xe=>!Re.has(Xe.id)))}updateData(J){let Q=this.options,te=Q.debug;if(!Q.updateable)throw new Error("to update tile geojson `updateable` option must be set to true");let{affected:ge,source:be}=(function(Ge,Ke,Te){let Ut=(function(Et){return Et?{removeAll:Et.removeAll,remove:new Set(Et.remove||[]),add:new Map(Et.add?.map(xt=>[xt.id,xt])),update:new Map(Et.update?.map(xt=>[xt.id,xt]))}:{remove:new Set,add:new Map,update:new Map}})(Ke),Wn=[];if(Ut.removeAll&&(Wn=Ge,Ge=[]),Ut.remove.size||Ut.add.size){let Et=[];for(let xt of Ge){let{id:qt}=xt;(Ut.remove.has(qt)||Ut.add.has(qt))&&Et.push(xt)}if(Et.length){Wn.push(...Et);let xt=new Set(Et.map(qt=>qt.id));Ge=Ge.filter(qt=>!xt.has(qt.id))}if(Ut.add.size){let xt=ft({type:"FeatureCollection",features:Array.from(Ut.add.values())},Te);xt=zi(xt,Te),Wn.push(...xt),Ge.push(...xt)}}if(Ut.update.size)for(let[Et,xt]of Ut.update){let qt=Ge.findIndex(Hn=>Hn.id===Et);if(qt===-1)continue;let Dn=Ge[qt],Mn=hr(Dn,xt,Te);Mn&&(Wn.push(Dn,Mn),Ge[qt]=Mn)}return{affected:Wn,source:Ge}})(this.source,J,Q);if(!ge.length)return;this.source=be,te>1&&(console.log("invalidating tiles"),console.time("invalidating")),this.invalidateTiles(ge),te>1&&console.timeEnd("invalidating");let[Le,Ae,Se]=[0,0,0],Re=Do(this.source,Le,Ae,Se,this.options);Re.source=this.source;let Xe=oo(Le,Ae,Se);if(this.tiles[Xe]=Re,this.tileCoords.push({z:Le,x:Ae,y:Se,id:Xe}),te){let Ge=`z${Le}`;this.stats[Ge]=(this.stats[Ge]||0)+1,this.total++}}}function oo(Ie,J,Q){return 32*((1<<Ie)*Q+J)+Ie}class xs extends W{constructor(J,Q,te,ge=Zo){super(J,Q,te),this._dataUpdateable=new Map,this._createGeoJSONIndex=ge}loadVectorTile(J,Q){return a._(this,void 0,void 0,function*(){let te=J.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");let ge=this._geoJSONIndex.getTile(te.z,te.x,te.y);return ge?H(new a.d3(ge.features,{version:2,extent:a.a5})):null})}loadData(J){return a._(this,void 0,void 0,function*(){var Q;(Q=this._pendingRequest)===null||Q===void 0||Q.abort();let te=this._startPerformance(J);this._pendingRequest=new AbortController;try{(!this._pendingData||J.request||J.data||J.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(J,this._pendingRequest));let ge=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(ge,J),this.loaded={};let be={};return J.request&&(be.data=ge),this._finishPerformance(te,J,be),be}catch(ge){if(delete this._pendingRequest,a.Z(ge))return{abandoned:!0};throw ge}})}_startPerformance(J){var Q;if(!((Q=J?.request)===null||Q===void 0)&&Q.collectResourceTiming)return new a.c$(J.request)}_finishPerformance(J,Q,te){if(!J)return;let ge=J.finish();ge&&(te.resourceTiming={},te.resourceTiming[Q.source]=JSON.parse(JSON.stringify(ge)))}getData(){return a._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(J){let Q=this.loaded;return Q&&Q[J.uid]?super.reloadTile(J):this.loadTile(J)}loadAndProcessGeoJSON(J,Q){return a._(this,void 0,void 0,function*(){let te;if(J.request?te=yield this.loadGeoJSONFromUrl(J.request,J.promoteId,Q):J.data?te=this._loadGeoJSONFromObject(J.data,J.promoteId):J.dataDiff&&(te=this._loadGeoJSONFromDiff(J.dataDiff,J.promoteId,J.source)),delete this._pendingRequest,typeof te!="object")throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`);return Ue(te,!0),J.filter&&(te=this._filterGeoJSON(te,J.filter)),te})}loadGeoJSONFromUrl(J,Q,te){return a._(this,void 0,void 0,function*(){let ge=yield a.j(J,te);return this._dataUpdateable=a.a7(ge.data,Q),ge.data})}_loadGeoJSONFromObject(J,Q){return this._dataUpdateable=a.a7(J,Q),J}_loadGeoJSONFromDiff(J,Q,te){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${te}`);a.a8(this._dataUpdateable,J,Q);let ge=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(ge)}_filterGeoJSON(J,Q){let te=a.d4(Q,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(te.result==="error")throw new Error(te.value.map(be=>`${be.key}: ${be.message}`).join(", "));let ge=J.features.filter(be=>te.value.evaluate({zoom:0},be));return this._toFeatureCollection(ge)}_toFeatureCollection(J){return{type:"FeatureCollection",features:J}}removeSource(J){return a._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(J){return this._geoJSONIndex.getClusterExpansionZoom(J.clusterId)}getClusterChildren(J){return this._geoJSONIndex.getChildren(J.clusterId)}getClusterLeaves(J){return this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset)}}function Zo(Ie,J){return J.cluster?new ot((function({superclusterOptions:Q,clusterProperties:te}){if(!te||!Q)return Q;let ge={},be={},Le={accumulated:null,zoom:0},Ae={properties:null},Se=Object.keys(te);for(let Re of Se){let[Xe,Ge]=te[Re],Ke=a.d4(Ge),Te=a.d4(typeof Xe=="string"?[Xe,["accumulated"],["get",Re]]:Xe);ge[Re]=Ke.value,be[Re]=Te.value}return Q.map=Re=>{Ae.properties=Re;let Xe={};for(let Ge of Se)Xe[Ge]=ge[Ge].evaluate(Le,Ae);return Xe},Q.reduce=(Re,Xe)=>{Ae.properties=Xe;for(let Ge of Se)Le.accumulated=Re[Ge],Re[Ge]=be[Ge].evaluate(Le,Ae)},Q})(J)).load(Ie.features):(function(Q,te){return new $n(Q,te)})(Ie,J.geojsonVtOptions)}class as{constructor(J){this.self=J,this.actor=new a.L(J),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(Q,te)=>{if(this.externalWorkerSourceTypes[Q])throw new Error(`Worker source with name "${Q}" already registered.`);this.externalWorkerSourceTypes[Q]=te},this.self.addProtocol=a.cK,this.self.removeProtocol=a.cL,this.self.registerRTLTextPlugin=Q=>{a.d5.setMethods(Q)},this.actor.registerMessageHandler("LDT",(Q,te)=>this._getDEMWorkerSource(Q,te.source).loadTile(te)),this.actor.registerMessageHandler("RDT",(Q,te)=>a._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Q,te.source).removeTile(te)})),this.actor.registerMessageHandler("GCEZ",(Q,te)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,te.type,te.source).getClusterExpansionZoom(te)})),this.actor.registerMessageHandler("GCC",(Q,te)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,te.type,te.source).getClusterChildren(te)})),this.actor.registerMessageHandler("GCL",(Q,te)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,te.type,te.source).getClusterLeaves(te)})),this.actor.registerMessageHandler("LD",(Q,te)=>this._getWorkerSource(Q,te.type,te.source).loadData(te)),this.actor.registerMessageHandler("GD",(Q,te)=>this._getWorkerSource(Q,te.type,te.source).getData()),this.actor.registerMessageHandler("LT",(Q,te)=>this._getWorkerSource(Q,te.type,te.source).loadTile(te)),this.actor.registerMessageHandler("RT",(Q,te)=>this._getWorkerSource(Q,te.type,te.source).reloadTile(te)),this.actor.registerMessageHandler("AT",(Q,te)=>this._getWorkerSource(Q,te.type,te.source).abortTile(te)),this.actor.registerMessageHandler("RMT",(Q,te)=>this._getWorkerSource(Q,te.type,te.source).removeTile(te)),this.actor.registerMessageHandler("RS",(Q,te)=>a._(this,void 0,void 0,function*(){if(!this.workerSources[Q]||!this.workerSources[Q][te.type]||!this.workerSources[Q][te.type][te.source])return;let ge=this.workerSources[Q][te.type][te.source];delete this.workerSources[Q][te.type][te.source],ge.removeSource!==void 0&&ge.removeSource(te)})),this.actor.registerMessageHandler("RM",Q=>a._(this,void 0,void 0,function*(){delete this.layerIndexes[Q],delete this.availableImages[Q],delete this.workerSources[Q],delete this.demWorkerSources[Q],this.globalStates.delete(Q)})),this.actor.registerMessageHandler("SR",(Q,te)=>a._(this,void 0,void 0,function*(){this.referrer=te})),this.actor.registerMessageHandler("SRPS",(Q,te)=>this._syncRTLPluginState(Q,te)),this.actor.registerMessageHandler("IS",(Q,te)=>a._(this,void 0,void 0,function*(){this.self.importScripts(te)})),this.actor.registerMessageHandler("SI",(Q,te)=>this._setImages(Q,te)),this.actor.registerMessageHandler("UL",(Q,te)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(Q).update(te.layers,te.removedIds,this._getGlobalState(Q))})),this.actor.registerMessageHandler("UGS",(Q,te)=>a._(this,void 0,void 0,function*(){let ge=this._getGlobalState(Q);for(let be in te)ge[be]=te[be]})),this.actor.registerMessageHandler("SL",(Q,te)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(Q).replace(te,this._getGlobalState(Q))}))}_getGlobalState(J){let Q=this.globalStates.get(J);return Q||(Q={},this.globalStates.set(J,Q)),Q}_setImages(J,Q){return a._(this,void 0,void 0,function*(){this.availableImages[J]=Q;for(let te in this.workerSources[J]){let ge=this.workerSources[J][te];for(let be in ge)ge[be].availableImages=Q}})}_syncRTLPluginState(J,Q){return a._(this,void 0,void 0,function*(){return yield a.d5.syncState(Q,this.self.importScripts)})}_getAvailableImages(J){let Q=this.availableImages[J];return Q||(Q=[]),Q}_getLayerIndex(J){let Q=this.layerIndexes[J];return Q||(Q=this.layerIndexes[J]=new s),Q}_getWorkerSource(J,Q,te){if(this.workerSources[J]||(this.workerSources[J]={}),this.workerSources[J][Q]||(this.workerSources[J][Q]={}),!this.workerSources[J][Q][te]){let ge={sendAsync:(be,Le)=>(be.targetMapId=J,this.actor.sendAsync(be,Le))};switch(Q){case"vector":this.workerSources[J][Q][te]=new W(ge,this._getLayerIndex(J),this._getAvailableImages(J));break;case"geojson":this.workerSources[J][Q][te]=new xs(ge,this._getLayerIndex(J),this._getAvailableImages(J));break;default:this.workerSources[J][Q][te]=new this.externalWorkerSourceTypes[Q](ge,this._getLayerIndex(J),this._getAvailableImages(J))}}return this.workerSources[J][Q][te]}_getDEMWorkerSource(J,Q){return this.demWorkerSources[J]||(this.demWorkerSources[J]={}),this.demWorkerSources[J][Q]||(this.demWorkerSources[J][Q]=new me),this.demWorkerSources[J][Q]}}return a.i(self)&&(self.worker=new as(self)),as}),t("index",["exports","./shared"],function(a,s){"use strict";var f="5.17.0";function v(){var x=new s.A(4);return s.A!=Float32Array&&(x[1]=0,x[2]=0),x[0]=1,x[3]=1,x}let w,D,A,z={frame(x,r,u,p){let g=p||window,E=g.requestAnimationFrame(M=>{C(),r(M)}),{unsubscribe:C}=s.s(x.signal,"abort",()=>{C(),g.cancelAnimationFrame(E),u(new s.a(x.signal.reason))},!1)},frameAsync(x,r){return new Promise((u,p)=>{this.frame(x,u,p,r)})},getImageData(x,r=0){return this.getImageCanvasContext(x).getImageData(-r,-r,x.width+2*r,x.height+2*r)},getImageCanvasContext(x){let r=window.document.createElement("canvas"),u=r.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return r.width=x.width,r.height=x.height,u.drawImage(x,0,0,x.width,x.height),u},resolveURL:x=>(w||(w=document.createElement("a")),w.href=x,w.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return A!==void 0?A:!!matchMedia&&(D==null&&(D=matchMedia("(prefers-reduced-motion: reduce)")),D.matches)},set prefersReducedMotion(x){A=x}},H=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(x){this._frozenAt=x}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function q(){return H.getCurrentTime()}class W{static testProp(r){if(!W.docStyle)return r[0];for(let u=0;u<r.length;u++)if(r[u]in W.docStyle)return r[u];return r[0]}static create(r,u,p){let g=window.document.createElement(r);return u!==void 0&&(g.className=u),p&&p.appendChild(g),g}static createNS(r,u){return window.document.createElementNS(r,u)}static disableDrag(){W.docStyle&&W.selectProp&&(W.userSelect=W.docStyle[W.selectProp],W.docStyle[W.selectProp]="none")}static enableDrag(){W.docStyle&&W.selectProp&&(W.docStyle[W.selectProp]=W.userSelect)}static setTransform(r,u){r.style[W.transformProp]=u}static addEventListener(r,u,p,g={}){r.addEventListener(u,p,"passive"in g?g:g.capture)}static removeEventListener(r,u,p,g={}){r.removeEventListener(u,p,"passive"in g?g:g.capture)}static suppressClickInternal(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",W.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",W.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",W.suppressClickInternal,!0)},0)}static getScale(r){let u=r.getBoundingClientRect();return{x:u.width/r.offsetWidth||1,y:u.height/r.offsetHeight||1,boundingClientRect:u}}static getPoint(r,u,p){let g=u.boundingClientRect;return new s.P((p.clientX-g.left)/u.x-r.clientLeft,(p.clientY-g.top)/u.y-r.clientTop)}static mousePos(r,u){let p=W.getScale(r);return W.getPoint(r,p,u)}static touchPos(r,u){let p=[],g=W.getScale(r);for(let E=0;E<u.length;E++)p.push(W.getPoint(r,g,u[E]));return p}static mouseButton(r){return r.button}static remove(r){r.parentNode&&r.parentNode.removeChild(r)}static sanitize(r){let u=new DOMParser().parseFromString(r,"text/html").body||document.createElement("body"),p=u.querySelectorAll("script");for(let g of p)g.remove();return W.clean(u),u.innerHTML}static isPossiblyDangerous(r,u){let p=u.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(r)||!p.includes("javascript:")&&!p.includes("data:"))||!!r.startsWith("on")||void 0}static clean(r){let u=r.children;for(let p of u)W.removeAttributes(p),W.clean(p)}static removeAttributes(r){for(let{name:u,value:p}of r.attributes)W.isPossiblyDangerous(u,p)&&r.removeAttribute(u)}}W.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,W.selectProp=W.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),W.transformProp=W.testProp(["transform","WebkitTransform"]);let me={supported:!1,testSupport:function(x){!Me&&ue&&(Ue?Pe(x):ce=x)}},ce,ue,Me=!1,Ue=!1;function Pe(x){let r=x.createTexture();x.bindTexture(x.TEXTURE_2D,r);try{if(x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,ue),x.isContextLost())return;me.supported=!0}catch{}x.deleteTexture(r),Me=!0}var ke;typeof document<"u"&&(ue=document.createElement("img"),ue.onload=()=>{ce&&Pe(ce),ce=null,Ue=!0},ue.onerror=()=>{Me=!0,ce=null},ue.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(x){let r,u,p,g;x.resetRequestQueue=()=>{r=[],u=0,p=0,g={}},x.addThrottleControl=R=>{let k=p++;return g[k]=R,k},x.removeThrottleControl=R=>{delete g[R],C()},x.getImage=(R,k,B=!0)=>new Promise((G,U)=>{me.supported&&(R.headers||(R.headers={}),R.headers.accept="image/webp,*/*"),s.e(R,{type:"image"}),r.push({abortController:k,requestParameters:R,supportImageRefresh:B,state:"queued",onError:Y=>{U(Y)},onSuccess:Y=>{G(Y)}}),C()});let E=R=>s._(this,void 0,void 0,function*(){R.state="running";let{requestParameters:k,supportImageRefresh:B,onError:G,onSuccess:U,abortController:Y}=R,ee=B===!1&&!s.i(self)&&!s.g(k.url)&&(!k.headers||Object.keys(k.headers).reduce((ae,fe)=>ae&&fe==="accept",!0));u++;let se=ee?M(k,Y):s.m(k,Y);try{let ae=yield se;delete R.abortController,R.state="completed",ae.data instanceof HTMLImageElement||s.b(ae.data)?U(ae):ae.data&&U({data:yield(le=ae.data,typeof createImageBitmap=="function"?s.f(le):s.h(le)),cacheControl:ae.cacheControl,expires:ae.expires})}catch(ae){delete R.abortController,G(ae)}finally{u--,C()}var le}),C=()=>{let R=(()=>{for(let k of Object.keys(g))if(g[k]())return!0;return!1})()?s.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let k=u;k<R&&r.length>0;k++){let B=r.shift();B.abortController.signal.aborted?k--:E(B)}},M=(R,k)=>new Promise((B,G)=>{let U=new Image,Y=R.url,ee=R.credentials;ee&&ee==="include"?U.crossOrigin="use-credentials":(ee&&ee==="same-origin"||!s.d(Y))&&(U.crossOrigin="anonymous"),k.signal.addEventListener("abort",()=>{U.src="",G(new s.a(k.signal.reason))}),U.fetchPriority="high",U.onload=()=>{U.onerror=U.onload=null,B({data:U})},U.onerror=()=>{U.onerror=U.onload=null,k.signal.aborted||G(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},U.src=Y})})(ke||(ke={})),ke.resetRequestQueue();class Qe{constructor(r){this._transformRequestFn=r??null}transformRequest(r,u){return this._transformRequestFn&&this._transformRequestFn(r,u)||{url:r}}setTransformRequest(r){this._transformRequestFn=r}}function ot(x){let r=[];if(typeof x=="string")r.push({id:"default",url:x});else if(x&&x.length>0){let u=[];for(let{id:p,url:g}of x){let E=`${p}${g}`;u.indexOf(E)===-1&&(u.push(E),r.push({id:p,url:g}))}}return r}function st(x,r,u){try{let p=new URL(x);return p.pathname+=`${r}${u}`,p.toString()}catch{throw new Error(`Invalid sprite URL "${x}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function it(x){let{userImage:r}=x;return!!(r&&r.render&&r.render())&&(x.data.replace(new Uint8Array(r.data.buffer)),!0)}class pt extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(let r of Object.keys(this.images))this.removeImage(r);this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(let{ids:u,promiseResolve:p}of this.requestors)p(this._getImagesForIds(u));this.requestors=[]}}getImage(r){let u=this.images[r];if(u&&!u.data&&u.spriteData){let p=u.spriteData;u.data=new s.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),u.spriteData=null}return u}addImage(r,u){if(this.images[r])throw new Error(`Image id ${r} already exist, use updateImage instead`);this._validate(r,u)&&(this.images[r]=u)}_validate(r,u){let p=!0,g=u.data||u.spriteData;return this._validateStretch(u.stretchX,g&&g.width)||(this.fire(new s.k(new Error(`Image "${r}" has invalid "stretchX" value`))),p=!1),this._validateStretch(u.stretchY,g&&g.height)||(this.fire(new s.k(new Error(`Image "${r}" has invalid "stretchY" value`))),p=!1),this._validateContent(u.content,u)||(this.fire(new s.k(new Error(`Image "${r}" has invalid "content" value`))),p=!1),p}_validateStretch(r,u){if(!r)return!0;let p=0;for(let g of r){if(g[0]<p||g[1]<g[0]||u<g[1])return!1;p=g[1]}return!0}_validateContent(r,u){if(!r)return!0;if(r.length!==4)return!1;let p=u.spriteData,g=p&&p.width||u.data.width,E=p&&p.height||u.data.height;return!(r[0]<0||g<r[0]||r[1]<0||E<r[1]||r[2]<0||g<r[2]||r[3]<0||E<r[3]||r[2]<r[0]||r[3]<r[1])}updateImage(r,u,p=!0){let g=this.getImage(r);if(p&&(g.data.width!==u.data.width||g.data.height!==u.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=g.version+1,this.images[r]=u,this.updatedImages[r]=!0}removeImage(r){let u=this.images[r];delete this.images[r],delete this.patterns[r],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r){return new Promise((u,p)=>{let g=!0;if(!this.isLoaded())for(let E of r)this.images[E]||(g=!1);this.isLoaded()||g?u(this._getImagesForIds(r)):this.requestors.push({ids:r,promiseResolve:u})})}_getImagesForIds(r){let u={};for(let p of r){let g=this.getImage(p);g||(this.fire(new s.l("styleimagemissing",{id:p})),g=this.getImage(p)),g?u[p]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,textFitWidth:g.textFitWidth,textFitHeight:g.textFitHeight,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:s.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return u}getPixelSize(){let{width:r,height:u}=this.atlasImage;return{width:r,height:u}}getPattern(r){let u=this.patterns[r],p=this.getImage(r);if(!p)return null;if(u&&u.position.version===p.version)return u.position;if(u)u.position.version=p.version;else{let g={w:p.data.width+2,h:p.data.height+2,x:0,y:0},E=new s.I(g,p);this.patterns[r]={bin:g,position:E}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){let u=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.T(r,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){let r=[];for(let E in this.patterns)r.push(this.patterns[E].bin);let{w:u,h:p}=s.p(r),g=this.atlasImage;g.resize({width:u||1,height:p||1});for(let E in this.patterns){let{bin:C}=this.patterns[E],M=C.x+1,R=C.y+1,k=this.getImage(E).data,B=k.width,G=k.height;s.R.copy(k,g,{x:0,y:0},{x:M,y:R},{width:B,height:G}),s.R.copy(k,g,{x:0,y:G-1},{x:M,y:R-1},{width:B,height:1}),s.R.copy(k,g,{x:0,y:0},{x:M,y:R+G},{width:B,height:1}),s.R.copy(k,g,{x:B-1,y:0},{x:M-1,y:R},{width:1,height:G}),s.R.copy(k,g,{x:0,y:0},{x:M+B,y:R},{width:1,height:G})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(let u of r){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;let p=this.getImage(u);p||s.w(`Image with ID: "${u}" was not found`),it(p)&&this.updateImage(u,p)}}cloneImages(){let r={};for(let u in this.images){let p=this.images[u];r[u]=Object.assign(Object.assign({},p),{data:p.data?p.data.clone():null})}return r}}let Vt=1e20;function Pt(x,r,u,p,g,E,C,M,R){for(let k=r;k<r+p;k++)At(x,u*E+k,E,g,C,M,R);for(let k=u;k<u+g;k++)At(x,k*E+r,1,p,C,M,R)}function At(x,r,u,p,g,E,C){E[0]=0,C[0]=-Vt,C[1]=Vt,g[0]=x[r];for(let M=1,R=0,k=0;M<p;M++){g[M]=x[r+M*u];let B=M*M;do{let G=E[R];k=(g[M]-g[G]+B-G*G)/(M-G)/2}while(k<=C[R]&&--R>-1);R++,E[R]=M,C[R]=k,C[R+1]=Vt}for(let M=0,R=0;M<p;M++){for(;C[R+1]<M;)R++;let k=E[R],B=M-k;x[r+M*u]=g[k]+B*B}}let Gt=s.v.layout_symbol["text-font"].default.join(",");class yt{constructor(r,u,p){this.requestManager=r,this.localIdeographFontFamily=u,this.entries={},this.lang=p}setURL(r){this.url=r}getGlyphs(r){return s._(this,void 0,void 0,function*(){let u=[];for(let E in r)for(let C of r[E])u.push(this._getAndCacheGlyphsPromise(E,C));let p=yield Promise.all(u),g={};for(let{stack:E,id:C,glyph:M}of p)g[E]||(g[E]={}),g[E][C]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics};return g})}_getAndCacheGlyphsPromise(r,u){return s._(this,void 0,void 0,function*(){let p=this.entries[r];p||(p=this.entries[r]={glyphs:{},requests:{},ranges:{}});let g=p.glyphs[u];return g!==void 0?{stack:r,id:u,glyph:g}:!this.url||this._charUsesLocalIdeographFontFamily(u)?(g=p.glyphs[u]=this._drawGlyph(p,r,u),{stack:r,id:u,glyph:g}):yield this._downloadAndCacheRangePromise(r,u)})}_downloadAndCacheRangePromise(r,u){return s._(this,void 0,void 0,function*(){let p=this.entries[r],g=Math.floor(u/256);if(p.ranges[g])return{stack:r,id:u,glyph:null};if(!p.requests[g]){let E=yt.loadGlyphRange(r,g,this.url,this.requestManager);p.requests[g]=E}try{let E=yield p.requests[g];for(let C in E)p.glyphs[+C]=E[+C];return p.ranges[g]=!0,{stack:r,id:u,glyph:E[u]||null}}catch(E){let C=p.glyphs[u]=this._drawGlyph(p,r,u);return this._warnOnMissingGlyphRange(C,g,u,E),{stack:r,id:u,glyph:C}}})}_warnOnMissingGlyphRange(r,u,p,g){let E=256*u,C=E+255,M=p.toString(16).padStart(4,"0").toUpperCase();s.w(`Unable to load glyph range ${u}, ${E}-${C}. Rendering codepoint U+${M} locally instead. ${g}`)}_charUsesLocalIdeographFontFamily(r){return!!this.localIdeographFontFamily&&s.q(r)}_drawGlyph(r,u,p){let g=u===Gt&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(p),E=g?"ideographTinySDF":"tinySDF";r[E]||(r[E]=this._createTinySDF(g?this.localIdeographFontFamily:u));let C=r[E].draw(String.fromCodePoint(p)),M=new RegExp("^\\p{gc=Cf}+$","u").test(String.fromCodePoint(p));return{id:p,bitmap:new s.r({width:C.width||60,height:C.height||60},C.data),metrics:{width:M?0:C.glyphWidth/2||24,height:C.glyphHeight/2||24,left:C.glyphLeft/2+.5||0,top:C.glyphTop/2-27.5||-8,advance:M?0:C.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(r){let u=r?r.split(","):[];u.push("sans-serif");let p=u.map(g=>/[-\w]+/.test(g)?g:`'${CSS.escape(g)}'`).join(",");return new yt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:p,fontWeight:this._fontWeight(u[0]),fontStyle:this._fontStyle(u[0]),lang:this.lang})}_fontStyle(r){return/italic/i.test(r)?"italic":/oblique/i.test(r)?"oblique":"normal"}_fontWeight(r){let u={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950},p;for(let[g,E]of Object.entries(u))new RegExp(`\\b${g}\\b`,"i").test(r)&&(p=`${E}`);return p}destroy(){for(let r in this.entries){let u=this.entries[r];u.tinySDF&&(u.tinySDF=null),u.ideographTinySDF&&(u.ideographTinySDF=null),u.glyphs={},u.requests={},u.ranges={}}this.entries={}}}yt.loadGlyphRange=function(x,r,u,p){return s._(this,void 0,void 0,function*(){let g=256*r,E=g+255,C=p.transformRequest(u.replace("{fontstack}",x).replace("{range}",`${g}-${E}`),"Glyphs"),M=yield s.n(C,new AbortController);if(!M||!M.data)throw new Error(`Could not load glyph range. range: ${r}, ${g}-${E}`);let R={};for(let k of s.o(M.data))R[k.id]=k;return R})},yt.TinySDF=class{constructor({fontSize:x=24,buffer:r=3,radius:u=8,cutoff:p=.25,fontFamily:g="sans-serif",fontWeight:E="normal",fontStyle:C="normal",lang:M=null}={}){this.buffer=r,this.cutoff=p,this.radius=u,this.lang=M;let R=this.size=x+4*r,k=this._createCanvas(R),B=this.ctx=k.getContext("2d",{willReadFrequently:!0});B.font=`${C} ${E} ${x}px ${g}`,B.textBaseline="alphabetic",B.textAlign="left",B.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Uint16Array(R)}_createCanvas(x){let r=document.createElement("canvas");return r.width=r.height=x,r}draw(x){let{width:r,actualBoundingBoxAscent:u,actualBoundingBoxDescent:p,actualBoundingBoxLeft:g,actualBoundingBoxRight:E}=this.ctx.measureText(x),C=Math.ceil(u),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(E-g))),R=Math.min(this.size-this.buffer,C+Math.ceil(p)),k=M+2*this.buffer,B=R+2*this.buffer,G=Math.max(k*B,0),U=new Uint8ClampedArray(G),Y={data:U,width:k,height:B,glyphWidth:M,glyphHeight:R,glyphTop:C,glyphLeft:0,glyphAdvance:r};if(M===0||R===0)return Y;let{ctx:ee,buffer:se,gridInner:le,gridOuter:ae}=this;this.lang&&(ee.lang=this.lang),ee.clearRect(se,se,M,R),ee.fillText(x,se,se+C);let fe=ee.getImageData(se,se,M,R);ae.fill(Vt,0,G),le.fill(0,0,G);for(let xe=0;xe<R;xe++)for(let de=0;de<M;de++){let ye=fe.data[4*(xe*M+de)+3]/255;if(ye===0)continue;let Ee=(xe+se)*k+de+se;if(ye===1)ae[Ee]=0,le[Ee]=Vt;else{let _e=.5-ye;ae[Ee]=_e>0?_e*_e:0,le[Ee]=_e<0?_e*_e:0}}Pt(ae,0,0,k,B,k,this.f,this.v,this.z),Pt(le,se,se,M,R,k,this.f,this.v,this.z);for(let xe=0;xe<G;xe++){let de=Math.sqrt(ae[xe])-Math.sqrt(le[xe]);U[xe]=Math.round(255-255*(de/this.radius+this.cutoff))}return Y}};class dt{constructor(){this.specification=s.u.light.position}possiblyEvaluate(r,u){return s.F(r.expression.evaluate(u))}interpolate(r,u,p){return{x:s.G.number(r.x,u.x,p),y:s.G.number(r.y,u.y,p),z:s.G.number(r.z,u.z,p)}}}let ft;class rt extends s.E{constructor(r){super(),ft=ft||new s.t({anchor:new s.D(s.u.light.anchor),position:new dt,color:new s.D(s.u.light.color),intensity:new s.D(s.u.light.intensity)}),this._transitionable=new s.x(ft,void 0),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,u={}){if(!this._validate(s.y,r,u))for(let p in r){let g=r[p];p.endsWith(s.z)?this._transitionable.setTransition(p.slice(0,-s.z.length),g):this._transitionable.setValue(p,g)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,u,p){return(!p||p.validate!==!1)&&s.B(this,r.call(s.C,{value:u,style:{glyphs:!0,sprite:!0},styleSpec:s.u}))}}let Dt=new s.t({"sky-color":new s.D(s.u.sky["sky-color"]),"horizon-color":new s.D(s.u.sky["horizon-color"]),"fog-color":new s.D(s.u.sky["fog-color"]),"fog-ground-blend":new s.D(s.u.sky["fog-ground-blend"]),"horizon-fog-blend":new s.D(s.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new s.D(s.u.sky["sky-horizon-blend"]),"atmosphere-blend":new s.D(s.u.sky["atmosphere-blend"])});class $t extends s.E{constructor(r){super(),this._transitionable=new s.x(Dt,void 0),this.setSky(r),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.H(0))}setSky(r,u={}){if(!this._validate(s.J,r,u)){r||(r={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(let p in r){let g=r[p];p.endsWith(s.z)?this._transitionable.setTransition(p.slice(0,-s.z.length),g):this._transitionable.setValue(p,g)}}}getSky(){return this._transitionable.serialize()}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,u,p={}){return p?.validate!==!1&&s.B(this,r.call(s.C,s.e({value:u,style:{glyphs:!0,sprite:!0},styleSpec:s.u})))}calculateFogBlendOpacity(r){return r<60?0:r<70?(r-60)/10:1}}class Qt{constructor(r,u){this.width=r,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(r,u){let p=r.join(",")+String(u);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(r,u)),this.dashEntry[p]}getDashRanges(r,u,p){let g=[],E=r.length%2==1?-r[r.length-1]*p:0,C=r[0]*p,M=!0;g.push({left:E,right:C,isDash:M,zeroLength:r[0]===0});let R=r[0];for(let k=1;k<r.length;k++){M=!M;let B=r[k];E=R*p,R+=B,C=R*p,g.push({left:E,right:C,isDash:M,zeroLength:B===0})}return g}addRoundDash(r,u,p){let g=u/2;for(let E=-p;E<=p;E++){let C=this.width*(this.nextRow+p+E),M=0,R=r[M];for(let k=0;k<this.width;k++){k/R.right>1&&(R=r[++M]);let B=Math.abs(k-R.left),G=Math.abs(k-R.right),U=Math.min(B,G),Y,ee=E/p*(g+1);if(R.isDash){let se=g-Math.abs(ee);Y=Math.sqrt(U*U+se*se)}else Y=g-Math.sqrt(U*U+ee*ee);this.data[C+k]=Math.max(0,Math.min(255,Y+128))}}}addRegularDash(r){for(let M=r.length-1;M>=0;--M){let R=r[M],k=r[M+1];R.zeroLength?r.splice(M,1):k&&k.isDash===R.isDash&&(k.left=R.left,r.splice(M,1))}let u=r[0],p=r[r.length-1];u.isDash===p.isDash&&(u.left=p.left-this.width,p.right=u.right+this.width);let g=this.width*this.nextRow,E=0,C=r[E];for(let M=0;M<this.width;M++){M/C.right>1&&(C=r[++E]);let R=Math.abs(M-C.left),k=Math.abs(M-C.right),B=Math.min(R,k);this.data[g+M]=Math.max(0,Math.min(255,(C.isDash?B:-B)+128))}}addDash(r,u){let p=u?7:0,g=2*p+1;if(this.nextRow+g>this.height)return s.w("LineAtlas out of space"),null;let E=0;for(let M=0;M<r.length;M++)E+=r[M];if(E!==0){let M=this.width/E,R=this.getDashRanges(r,this.width,M);u?this.addRoundDash(R,M,p):this.addRegularDash(R)}let C={y:this.nextRow+p,height:2*p,width:E};return this.nextRow+=g,this.dirty=!0,C}bind(r){let u=r.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}let et="maplibre_preloaded_worker_pool";class Zt{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Zt.workerCount;)this.workers.push(new Worker(s.c.WORKER_URL));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[et]}numActive(){return Object.keys(this.active).length}}let Rt=Math.floor(z.hardwareConcurrency/2),Sn,kn;function Ei(){return Sn||(Sn=new Zt),Sn}Zt.workerCount=s.K(globalThis)?Math.max(Math.min(Rt,3),1):1;class Zi{constructor(r,u){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=u;let p=this.workerPool.acquire(u);for(let g=0;g<p.length;g++){let E=new s.L(p[g],u);E.name=`Worker ${g}`,this.actors.push(E)}if(!this.actors.length)throw new Error("No actors found")}broadcast(r,u){let p=[];for(let g of this.actors)p.push(g.sendAsync({type:r,data:u}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(r=!0){this.actors.forEach(u=>{u.remove()}),this.actors=[],r&&this.workerPool.release(this.id)}registerMessageHandler(r,u){for(let p of this.actors)p.registerMessageHandler(r,u)}unregisterMessageHandler(r){for(let u of this.actors)u.unregisterMessageHandler(r)}}function Ti(){return kn||(kn=new Zi(Ei(),s.M),kn.registerMessageHandler("GR",(x,r,u)=>s.m(r,u))),kn}function ti(x,r){let u=s.N();return s.O(u,u,[1,1,0]),s.Q(u,u,[.5*x.width,.5*x.height,1]),x.calculatePosMatrix?s.S(u,u,x.calculatePosMatrix(r.toUnwrapped())):u}function ss(x,r,u,p,g,E,C){var M;let R=(function(U,Y,ee){if(U)for(let se of U){let le=Y[se];if(le&&le.source===ee&&le.type==="fill-extrusion")return!0}else for(let se in Y){let le=Y[se];if(le.source===ee&&le.type==="fill-extrusion")return!0}return!1})((M=g?.layers)!==null&&M!==void 0?M:null,r,x.id),k=E.maxPitchScaleFactor(),B=x.tilesIn(p,k,R);B.sort(zi);let G=[];for(let U of B)G.push({wrappedTileID:U.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(r,u,x.getState(),U.queryGeometry,U.cameraQueryGeometry,U.scale,g,E,k,ti(E,U.tileID),C?(Y,ee)=>C(U.tileID,Y,ee):void 0)});return(function(U,Y){for(let ee in U)for(let se of U[ee])ir(se,Y);return U})((function(U){let Y={},ee={};for(let se of U){let le=se.queryResults,ae=se.wrappedTileID,fe=ee[ae]=ee[ae]||{};for(let xe in le){let de=le[xe],ye=fe[xe]=fe[xe]||{},Ee=Y[xe]=Y[xe]||[];for(let _e of de)ye[_e.featureIndex]||(ye[_e.featureIndex]=!0,Ee.push(_e))}}return Y})(G),x)}function zi(x,r){let u=x.tileID,p=r.tileID;return u.overscaledZ-p.overscaledZ||u.canonical.y-p.canonical.y||u.wrap-p.wrap||u.canonical.x-p.canonical.x}function ir(x,r){let u=x.feature,p=r.getFeatureState(u.layer["source-layer"],u.id);u.source=u.layer.source,u.layer["source-layer"]&&(u.sourceLayer=u.layer["source-layer"]),u.state=p}function Qi(x,r,u,p){return s._(this,void 0,void 0,function*(){let g=x;if(x.url?g=(yield s.j(r.transformRequest(x.url,"Source"),u)).data:yield z.frameAsync(u,p),!g)return null;let E=s.U(s.e(g,x),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in g&&g.vector_layers&&(E.vectorLayerIds=g.vector_layers.map(C=>C.id)),E})}class bn{constructor(r,u){r&&(u?this.setSouthWest(r).setNorthEast(u):Array.isArray(r)&&(r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1])))}setNorthEast(r){return this._ne=r instanceof s.V?new s.V(r.lng,r.lat):s.V.convert(r),this}setSouthWest(r){return this._sw=r instanceof s.V?new s.V(r.lng,r.lat):s.V.convert(r),this}extend(r){let u=this._sw,p=this._ne,g,E;if(r instanceof s.V)g=r,E=r;else{if(!(r instanceof bn))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(bn.convert(r)):this.extend(s.V.convert(r)):r&&("lng"in r||"lon"in r)&&"lat"in r?this.extend(s.V.convert(r)):this;if(g=r._sw,E=r._ne,!g||!E)return this}return u||p?(u.lng=Math.min(g.lng,u.lng),u.lat=Math.min(g.lat,u.lat),p.lng=Math.max(E.lng,p.lng),p.lat=Math.max(E.lat,p.lat)):(this._sw=new s.V(g.lng,g.lat),this._ne=new s.V(E.lng,E.lat)),this}getCenter(){return new s.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.V(this.getWest(),this.getNorth())}getSouthEast(){return new s.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){let{lng:u,lat:p}=s.V.convert(r),g=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&g}intersects(r){if(!((r=bn.convert(r)).getNorth()>=this.getSouth()&&r.getSouth()<=this.getNorth()))return!1;let u=Math.abs(this.getEast()-this.getWest()),p=Math.abs(r.getEast()-r.getWest());if(u>=360||p>=360)return!0;let g=s.W(this.getWest(),-180,180),E=s.W(this.getEast(),-180,180),C=s.W(r.getWest(),-180,180),M=s.W(r.getEast(),-180,180),R=g>=E,k=C>=M;return!(!R||!k)||(R?M>=g||C<=E:k?E>=C||g<=M:C<=E&&M>=g)}static convert(r){return r instanceof bn?r:r&&new bn(r)}static fromLngLat(r,u=0){let p=360*u/40075017,g=p/Math.cos(Math.PI/180*r.lat);return new bn(new s.V(r.lng-g,r.lat-p),new s.V(r.lng+g,r.lat+p))}adjustAntiMeridian(){let r=new s.V(this._sw.lng,this._sw.lat),u=new s.V(this._ne.lng,this._ne.lat);return new bn(r,r.lng>u.lng?new s.V(u.lng+360,u.lat):u)}}class Di{constructor(r,u,p){this.bounds=bn.convert(this.validateBounds(r)),this.minzoom=u||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){let u=Math.pow(2,r.z),p=Math.floor(s.Y(this.bounds.getWest())*u),g=Math.floor(s.X(this.bounds.getNorth())*u),E=Math.ceil(s.Y(this.bounds.getEast())*u),C=Math.ceil(s.X(this.bounds.getSouth())*u);return r.x>=p&&r.x<E&&r.y>=g&&r.y<C}}class Do extends s.E{constructor(r,u,p,g){if(super(),this.id=r,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.U(u,["url","scheme","tileSize","promoteId","encoding"])),this._options=s.e({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let r=yield Qi(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),r&&(s.e(this,r),r.bounds&&(this.tileBounds=new Di(r.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})))}catch(r){this._tileJSONRequest=null,this._loaded=!0,s.Z(r)||this.fire(new s.k(r))}})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.abort(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(r){return s._(this,void 0,void 0,function*(){let u=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(u,"Tile"),uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(r)};p.request.collectResourceTiming=this._collectResourceTiming;let g="RT";if(r.actor&&r.state!=="expired"){if(r.state==="loading")return new Promise((E,C)=>{r.reloadPromise={resolve:E,reject:C}})}else r.actor=this.dispatcher.getActor(),g="LT";r.abortController=new AbortController;try{let E=yield r.actor.sendAsync({type:g,data:p},r.abortController);if(delete r.abortController,r.aborted)return;this._afterTileLoadWorkerResponse(r,E)}catch(E){if(delete r.abortController,r.aborted)return;if(E&&E.status!==404)throw E;this._afterTileLoadWorkerResponse(r,null)}})}_getOverzoomParameters(r){if(r.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;let u=r.tileID.scaledTo(this.maxzoom).canonical,p=u.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:u,overzoomRequest:this.map._requestManager.transformRequest(p,"Tile")}}_afterTileLoadWorkerResponse(r,u){if(u&&u.resourceTiming&&(r.resourceTiming=u.resourceTiming),u&&this.map._refreshExpiredTiles&&r.setExpiryData(u),r.loadVectorData(u,this.map.painter),r.reloadPromise){let p=r.reloadPromise;r.reloadPromise=null,this.loadTile(r).then(p.resolve).catch(p.reject)}}abortTile(r){return s._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.actor&&(yield r.actor.sendAsync({type:"AT",data:{uid:r.uid,type:this.type,source:this.id}}))})}unloadTile(r){return s._(this,void 0,void 0,function*(){r.unloadVectorData(),r.actor&&(yield r.actor.sendAsync({type:"RMT",data:{uid:r.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ro extends s.E{constructor(r,u,p,g){super(),this.id=r,this.dispatcher=p,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},u),s.e(this,s.U(u,["url","scheme","tileSize"]))}load(){return s._(this,arguments,void 0,function*(r=!1){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let u=yield Qi(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,u&&(s.e(this,u),u.bounds&&(this.tileBounds=new Di(u.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:r})))}catch(u){this._tileJSONRequest=null,this._loaded=!0,s.Z(u)||this.fire(new s.k(u))}})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(r){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),r(),this.load(!0)}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}serialize(){return s.e({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r){return s._(this,void 0,void 0,function*(){let u=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);r.abortController=new AbortController;try{let p=yield ke.getImage(this.map._requestManager.transformRequest(u,"Tile"),r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&(p.cacheControl||p.expires)&&r.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});let g=this.map.painter.context,E=g.gl,C=p.data;r.texture=this.map.painter.getTileTexture(C.width),r.texture?r.texture.update(C,{useMipmap:!0}):(r.texture=new s.T(g,C,E.RGBA,{useMipmap:!0}),r.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST)),r.state="loaded"}}catch(p){if(delete r.abortController,r.aborted)r.state="unloaded";else if(p)throw r.state="errored",p}})}abortTile(r){return s._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController)})}unloadTile(r){return s._(this,void 0,void 0,function*(){r.texture&&this.map.painter.saveTileTexture(r.texture)})}hasTransition(){return!1}}class ur extends ro{constructor(r,u,p,g){super(r,u,p,g),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox",this.redFactor=u.redFactor,this.greenFactor=u.greenFactor,this.blueFactor=u.blueFactor,this.baseShift=u.baseShift}loadTile(r){return s._(this,void 0,void 0,function*(){let u=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(u,"Tile");r.neighboringTiles=this._getNeighboringTiles(r.tileID),r.abortController=new AbortController;try{let g=yield ke.getImage(p,r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(g&&g.data){let E=g.data;this.map._refreshExpiredTiles&&(g.cacheControl||g.expires)&&r.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});let C=s.b(E)&&s.$()?E:yield this.readImageNow(E),M={type:this.type,uid:r.uid,source:this.id,rawImageData:C,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!r.actor||r.state==="expired"){r.actor=this.dispatcher.getActor();let R=yield r.actor.sendAsync({type:"LDT",data:M});r.dem=R,r.needsHillshadePrepare=!0,r.needsTerrainPrepare=!0,r.state="loaded"}}}catch(g){if(delete r.abortController,r.aborted)r.state="unloaded";else if(g)throw r.state="errored",g}})}readImageNow(r){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.a0()){let u=r.width+2,p=r.height+2;try{return new s.R({width:u,height:p},yield s.a1(r,-1,-1,u,p))}catch{}}return z.getImageData(r,1)})}_getNeighboringTiles(r){let u=r.canonical,p=Math.pow(2,u.z),g=(u.x-1+p)%p,E=u.x===0?r.wrap-1:r.wrap,C=(u.x+1+p)%p,M=u.x+1===p?r.wrap+1:r.wrap,R={};return R[new s.a2(r.overscaledZ,E,u.z,g,u.y).key]={backfilled:!1},R[new s.a2(r.overscaledZ,M,u.z,C,u.y).key]={backfilled:!1},u.y>0&&(R[new s.a2(r.overscaledZ,E,u.z,g,u.y-1).key]={backfilled:!1},R[new s.a2(r.overscaledZ,r.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},R[new s.a2(r.overscaledZ,M,u.z,C,u.y-1).key]={backfilled:!1}),u.y+1<p&&(R[new s.a2(r.overscaledZ,E,u.z,g,u.y+1).key]={backfilled:!1},R[new s.a2(r.overscaledZ,r.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},R[new s.a2(r.overscaledZ,M,u.z,C,u.y+1).key]={backfilled:!1}),R}unloadTile(r){return s._(this,void 0,void 0,function*(){r.demTexture&&this.map.painter.saveTileTexture(r.demTexture),r.fbo&&(r.fbo.destroy(),delete r.fbo),r.dem&&delete r.dem,delete r.neighboringTiles,r.state="unloaded",r.actor&&(yield r.actor.sendAsync({type:"RDT",data:{type:this.type,uid:r.uid,source:this.id}}))})}}function hr(x){return x.type==="GeometryCollection"?x.geometries.map(r=>r.coordinates).flat(1/0):x.coordinates.flat(1/0)}function $r(x){let r=new bn,u;switch(x.type){case"FeatureCollection":u=x.features.map(p=>hr(p.geometry)).flat(1/0);break;case"Feature":u=hr(x.geometry);break;default:u=hr(x)}if(u.length==0)return r;for(let p=0;p<u.length-1;p+=2)r.extend([u[p],u[p+1]]);return r}class Mo extends s.E{constructor(r,u,p,g){super(),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:u.data},this.actor=p.getActor(),this.setEventedParent(g),this._data=typeof u.data=="string"?{url:u.data}:{geojson:u.data},this._options=s.e({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId,u.clusterMaxZoom!==void 0&&this.maxzoom<=u.clusterMaxZoom&&s.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${u.clusterMaxZoom}".`),this.workerOptions=s.e({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(u.buffer!==void 0?u.buffer:128),tolerance:this._pixelsToTileUnits(u.tolerance!==void 0?u.tolerance:.375),extent:s.a5,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(u.clusterMaxZoom),minPoints:Math.max(2,u.clusterMinPoints||2),extent:s.a5,radius:this._pixelsToTileUnits(u.clusterRadius||50),log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(r){return r*(s.a5/this.tileSize)}_getClusterMaxZoom(r){let u=r?Math.round(r):this.maxzoom-1;return Number.isInteger(r)||r===void 0||s.w(`Integer expected for option 'clusterMaxZoom': provided value "${r}" rounded to "${u}"`),u}load(){return s._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(r){this.map=r,this.load()}setData(r,u){this._data=typeof r=="string"?{url:r}:{geojson:r},this._pendingWorkerUpdate={data:r};let p=this._updateWorkerData();return u?p:this}updateData(r,u){this._pendingWorkerUpdate.diff=s.a6(this._pendingWorkerUpdate.diff,r);let p=this._updateWorkerData();return u?p:this}getData(){return s._(this,void 0,void 0,function*(){let r=s.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:r})})}getBounds(){return s._(this,void 0,void 0,function*(){return $r(yield this.getData())})}setClusterOptions(r){return this.workerOptions.cluster=r.cluster,r.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(r.clusterRadius)),r.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(r.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(r){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:r,source:this.id}})}getClusterChildren(r){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:r,source:this.id}})}getClusterLeaves(r,u,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:r,limit:u,offset:p}})}_updateWorkerData(){return s._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void s.w(`No pending worker updates for GeoJSONSource ${this.id}.`);let{data:r,diff:u}=this._pendingWorkerUpdate,p=this._getLoadGeoJSONParameters(r,u);r!==void 0?this._pendingWorkerUpdate.data=void 0:u&&(this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,yield this._dispatchWorkerUpdate(p)})}_getLoadGeoJSONParameters(r,u){let p=s.e({type:this.type},this.workerOptions);return typeof r=="string"?(p.request=this.map._requestManager.transformRequest(z.resolveURL(r),"Source"),p.request.collectResourceTiming=this._collectResourceTiming,p):r!==void 0?(p.data=r,p):(u&&(p.dataDiff=u),p)}_dispatchWorkerUpdate(r){return s._(this,void 0,void 0,function*(){this._isUpdatingWorker=!0,this.fire(new s.l("dataloading",{dataType:"source"}));try{let u=yield this.actor.sendAsync({type:"LD",data:r});if(this._isUpdatingWorker=!1,this._removed||u.abandoned)return void this.fire(new s.l("dataabort",{dataType:"source"}));u.data&&(this._data={geojson:u.data});let p=this._applyDiffToSource(r.dataDiff),g=this._getShouldReloadTileOptions(p),E={dataType:"source"};this._applyResourceTiming(E,u),this.fire(new s.l("data",Object.assign(Object.assign({},E),{sourceDataType:"metadata"}))),this.fire(new s.l("data",Object.assign(Object.assign({},E),{sourceDataType:"content",shouldReloadTileOptions:g})))}catch(u){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new s.l("dataabort",{dataType:"source"}));this.fire(new s.k(u))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}})}_applyResourceTiming(r,u){var p;if(!this._collectResourceTiming)return;let g=(p=u.resourceTiming)===null||p===void 0?void 0:p[this.id];if(!g)return;let E=g.slice(0);E?.length&&s.e(r,{resourceTiming:E})}_applyDiffToSource(r){if(!r)return;let u=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){let g=s.a7(this._data.geojson,u);if(!g)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:g}}if(!this._data.updateable)return;let p=s.a8(this._data.updateable,r,u);return r.removeAll||this._options.cluster?void 0:p}_getShouldReloadTileOptions(r){if(r)return{affectedBounds:r.filter(Boolean).map(u=>$r(u))}}shouldReloadTile(r,{affectedBounds:u}){if(r.state==="loading")return!0;if(r.state==="unloaded")return!1;let{buffer:p,extent:g}=this.workerOptions.geojsonVtOptions,E=(function({x:C,y:M,z:R},k=0){let B=s.a3((C-k)/Math.pow(2,R)),G=s.a4((M+1+k)/Math.pow(2,R)),U=s.a3((C+1+k)/Math.pow(2,R)),Y=s.a4((M-k)/Math.pow(2,R));return new bn([B,G],[U,Y])})(r.tileID.canonical,p/g);for(let C of u)if(E.intersects(C))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(r){return s._(this,void 0,void 0,function*(){let u=r.actor?"RT":"LT";r.actor=this.actor;let p={type:this.type,uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};r.abortController=new AbortController;let g=yield this.actor.sendAsync({type:u,data:p},r.abortController);delete r.abortController,r.unloadVectorData(),r.aborted||r.loadVectorData(g,this.map.painter,u==="RT")})}abortTile(r){return s._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.aborted=!0})}unloadTile(r){return s._(this,void 0,void 0,function*(){r.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:r.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class $n extends s.E{constructor(r,u,p,g){super(),this.flippedWindingOrder=!1,this.id=r,this.dispatcher=p,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=u}load(r){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{let u=yield ke.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,u&&u.data&&(this.image=u.data,r&&(this.coordinates=r),this._finishLoading())}catch(u){this._request=null,this._loaded=!0,s.Z(u)||this.fire(new s.k(u))}})}loaded(){return this._loaded}updateImage(r){return r.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=r.url,this.load(r.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(r){this.coordinates=r;let u=r.map(s.a9.fromLngLat);var p;return this.tileID=(function(g){let E=s.aa.fromPoints(g),C=E.width(),M=E.height(),R=Math.max(C,M),k=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),B=Math.pow(2,k);return new s.ac(k,Math.floor((E.minX+E.maxX)/2*B),Math.floor((E.minY+E.maxY)/2*B))})(u),this.terrainTileRanges=this._getOverlappingTileRanges(u),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=u.map(g=>this.tileID.getTilePoint(g)._round()),this.flippedWindingOrder=((p=this.tileCoords)[1].x-p[0].x)*(p[2].y-p[0].y)-(p[1].y-p[0].y)*(p[2].x-p[0].x)<0,this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let r=this.map.painter.context,u=r.gl;this.texture||(this.texture=new s.T(r,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let p=!1;for(let g in this.tiles){let E=this.tiles[g];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,p=!0)}p&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(r){return s._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={}):r.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(r){let{minX:u,minY:p,maxX:g,maxY:E}=s.aa.fromPoints(r),C={};for(let M=0;M<=s.ab;M++){let R=Math.pow(2,M),k=Math.floor(u*R),B=Math.floor(p*R),G=Math.floor(g*R),U=Math.floor(E*R),Y=(k%R+R)%R,ee=G%R,se=Math.floor(k/R),le=Math.floor(G/R);C[M]={minWrap:se,maxWrap:le,minTileXWrapped:Y,maxTileXWrapped:ee,minTileY:B,maxTileY:U}}return C}}class oo extends $n{constructor(r,u,p,g){super(r,u,p,g),this.roundZoom=!0,this.type="video",this.options=u}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1;let r=this.options;this.urls=[];for(let u of r.urls)this.urls.push(this.map._requestManager.transformRequest(u,"Source").url);try{let u=yield s.ad(this.urls);if(this._loaded=!0,!u)return;this.video=u,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(u){this.fire(new s.k(u))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(r){if(this.video){let u=this.video.seekable;r<u.start(0)||r>u.end(0)?this.fire(new s.k(new s.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=r}}getVideo(){return this.video}onAdd(r){this.map||(this.map=r,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let r=this.map.painter.context,u=r.gl;this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(r,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let p=!1;for(let g in this.tiles){let E=this.tiles[g];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,p=!0)}p&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class xs extends $n{constructor(r,u,p,g){super(r,u,p,g),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some(E=>!Array.isArray(E)||E.length!==2||E.some(C=>typeof C!="number"))||this.fire(new s.k(new s.ae(`sources.${r}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.k(new s.ae(`sources.${r}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new s.k(new s.ae(`sources.${r}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof HTMLCanvasElement||this.fire(new s.k(new s.ae(`sources.${r}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.k(new s.ae(`sources.${r}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){return s._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(r){this.map=r,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let r=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,r=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,r=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let u=this.map.painter.context,p=u.gl;this.texture?(r||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new s.T(u,this.canvas,p.RGBA,{premultiply:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE));let g=!1;for(let E in this.tiles){let C=this.tiles[E];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,g=!0)}g&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let r of[this.canvas.width,this.canvas.height])if(isNaN(r)||r<=0)return!0;return!1}}let Zo={},as=x=>{switch(x){case"geojson":return Mo;case"image":return $n;case"raster":return ro;case"raster-dem":return ur;case"vector":return Do;case"video":return oo;case"canvas":return xs}return Zo[x]},Ie="RTLPluginLoaded";class J extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ti()}_syncState(r){return this.status=r,this.dispatcher.broadcast("SRPS",{pluginStatus:r,pluginURL:this.url}).catch(u=>{throw this.status="error",u})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(r){return s._(this,arguments,void 0,function*(u,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=z.resolveURL(u),!this.url)throw new Error(`requested url ${u} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return s._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.l(Ie))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Q=null;function te(){return Q||(Q=new J),Q}var ge,be;(function(x){x[x.Base=0]="Base",x[x.Parent=1]="Parent"})(ge||(ge={})),(function(x){x[x.Departing=0]="Departing",x[x.Incoming=1]="Incoming"})(be||(be={}));class Le{constructor(r,u){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=r,this.uid=s.af(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(r){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(r||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:r,fadingDirection:u,fadingParentID:p,fadeEndTime:g}){this.resetFadeLogic(),this.fadingRole=r,this.fadingDirection=u,this.fadingParentID=p,this.fadeEndTime=g}setSelfFadeLogic(r){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=r}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=q(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(r){this.demTexture&&r.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(r,u,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData,this.latestFeatureIndex.encoding=r.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=(function(g,E){let C={};if(!E)return C;for(let M of g){let R=M.layerIds.map(k=>E.getLayer(k)).filter(Boolean);if(R.length!==0){M.layers=R,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(k=>R.filter(B=>B.id===k)[0]));for(let k of R)C[k.id]=M}}return C})(r.buckets,u?.style),this.hasSymbolBuckets=!1;for(let g in this.buckets){let E=this.buckets[g];if(E instanceof s.ah){if(this.hasSymbolBuckets=!0,!p)break;E.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let g in this.buckets){let E=this.buckets[g];if(E instanceof s.ah&&E.hasRTLText){this.hasRTLText=!0,te().lazyLoad();break}}this.queryPadding=0;for(let g in this.buckets){let E=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(g).queryRadius(E))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),this.dashPositions=r.dashPositions}else this.collisionBoxArray=new s.ag}unloadVectorData(){for(let r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(r){return this.buckets[r.id]}upload(r){for(let p in this.buckets){let g=this.buckets[p];g.uploadPending()&&g.upload(r)}let u=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new s.T(r,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(r,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,u,p,g,E,C,M,R,k,B,G){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:E,scale:C,tileSize:this.tileSize,pixelPosMatrix:B,transform:R,params:M,queryPadding:this.queryPadding*k,getElevation:G},r,u,p):{}}querySourceFeatures(r,u){let p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;let g=p.loadVTLayers(),E=u&&u.sourceLayer?u.sourceLayer:"",C=g[s.ai]||g[E];if(!C)return;let M=s.aj(u?.filter,u?.globalState),{z:R,x:k,y:B}=this.tileID.canonical,G={z:R,x:k,y:B};for(let U=0;U<C.length;U++){let Y=C.feature(U);if(M.needGeometry){let le=s.ak(Y,!0);if(!M.filter(new s.H(this.tileID.overscaledZ),le,this.tileID.canonical))continue}else if(!M.filter(new s.H(this.tileID.overscaledZ),Y))continue;let ee=p.getId(Y,E),se=new s.al(Y,R,k,B,ee);se.tile=G,r.push(se)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){let u=this.expirationTime;if(r.cacheControl){let p=s.am(r.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){let p=Date.now(),g=!1;if(this.expirationTime>p)g=!1;else if(u)if(this.expirationTime<u)g=!0;else{let E=this.expirationTime-u;E?this.expirationTime=p+Math.max(E,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0)return;let p=this.latestFeatureIndex.loadVTLayers();for(let g in this.buckets){if(!u.style.hasLayer(g))continue;let E=this.buckets[g],C=E.layers[0].sourceLayer||s.ai,M=p[C],R=r[C];if(!M||!R||Object.keys(R).length===0)continue;E.update(R,M,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});let k=u&&u.style&&u.style.getLayer(g);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(E)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<q()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(r){this.symbolFadeHoldUntil=q()+r}setDependencies(r,u){let p={};for(let g of u)p[g]=!0;this.dependencies[r]=p}hasDependency(r,u){for(let p of r){let g=this.dependencies[p];if(g){for(let E of u)if(g[E])return!0}}return!1}}class Ae{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,u,p){let g=String(u);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][g]=this.stateChanges[r][g]||{},s.e(this.stateChanges[r][g],p),this.deletedStates[r]===null){this.deletedStates[r]={};for(let E in this.state[r])E!==g&&(this.deletedStates[r][E]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][g]===null){this.deletedStates[r][g]={};for(let E in this.state[r][g])p[E]||(this.deletedStates[r][g][E]=null)}else for(let E in p)this.deletedStates[r]&&this.deletedStates[r][g]&&this.deletedStates[r][g][E]===null&&delete this.deletedStates[r][g][E]}removeFeatureState(r,u,p){if(this.deletedStates[r]===null)return;let g=String(u);if(this.deletedStates[r]=this.deletedStates[r]||{},p&&u!==void 0)this.deletedStates[r][g]!==null&&(this.deletedStates[r][g]=this.deletedStates[r][g]||{},this.deletedStates[r][g][p]=null);else if(u!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][g])for(p in this.deletedStates[r][g]={},this.stateChanges[r][g])this.deletedStates[r][g][p]=null;else this.deletedStates[r][g]=null;else this.deletedStates[r]=null}getState(r,u){let p=String(u),g=s.e({},(this.state[r]||{})[p],(this.stateChanges[r]||{})[p]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){let E=this.deletedStates[r][u];if(E===null)return{};for(let C in E)delete g[C]}return g}initializeTileState(r,u){r.setFeatureState(this.state,u)}coalesceChanges(r,u){let p={};for(let g in this.stateChanges){this.state[g]=this.state[g]||{};let E={};for(let C in this.stateChanges[g])this.state[g][C]||(this.state[g][C]={}),s.e(this.state[g][C],this.stateChanges[g][C]),E[C]=this.state[g][C];p[g]=E}for(let g in this.deletedStates){this.state[g]=this.state[g]||{};let E={};if(this.deletedStates[g]===null)for(let C in this.state[g])E[C]={},this.state[g][C]={};else for(let C in this.deletedStates[g]){if(this.deletedStates[g][C]===null)this.state[g][C]={};else for(let M of Object.keys(this.deletedStates[g][C]))delete this.state[g][C][M];E[C]=this.state[g][C]}p[g]=p[g]||{},s.e(p[g],E)}this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0&&r.setFeatureState(p,u)}}let Se=89.25;function Re(x,r){let u=s.an(r.lat,-s.ao,s.ao);return new s.P(s.Y(r.lng)*x,s.X(u)*x)}function Xe(x,r){return new s.a9(r.x/x,r.y/x).toLngLat()}function Ge(x){return x.cameraToCenterDistance*Math.min(.85*Math.tan(s.ap(90-x.pitch)),Math.tan(s.ap(Se-x.pitch)))}function Ke(x,r){let u=x.canonical,p=r/s.aq(u.z),g=u.x+Math.pow(2,u.z)*x.wrap,E=s.ar(new Float64Array(16));return s.O(E,E,[g*p,u.y*p,0]),s.Q(E,E,[p/s.a5,p/s.a5,1]),E}function Te(x,r,u,p,g){let E=s.a9.fromLngLat(x,r),C=g*s.as(1,x.lat),{x:M,y:R,z:k}=Ut(u,p);return new s.a9(E.x+C*-M,E.y+C*-R,E.z+C*-k)}function Ut(x,r){let u=s.ap(x),p=s.ap(r),g=Math.cos(-u),E=Math.sin(u);return{x:E*Math.sin(p),y:-E*Math.cos(p),z:g}}function Wn(x,r,u){let p=r.intersectsFrustum(x);if(!u||p===0)return p;let g=r.intersectsPlane(u);return g===0?0:p===2&&g===2?2:1}function Et(x,r,u){let p=0,g=(u-r)/10;for(let E=0;E<10;E++)p+=g*Math.pow(Math.cos(r+(E+.5)/10*(u-r)),x);return p}function xt(x,r){return function(u,p,g,E,C){let M=2*((x-1)/s.at(Math.cos(s.ap(Se-C))/Math.cos(s.ap(Se)))-1),R=Math.acos(g/E),k=2*Et(M-1,0,s.ap(C/2)),B=Math.min(s.ap(Se),R+s.ap(C/2)),G=Et(M-1,Math.min(B,R-s.ap(C/2)),B),U=Math.atan(p/g),Y=Math.hypot(p,g),ee=u;return ee+=s.at(E/Y/Math.max(.5,Math.cos(s.ap(C/2)))),ee+=M*s.at(Math.cos(U))/2,ee-=s.at(Math.max(1,G/k/r))/2,ee}}let qt=xt(9.314,3);function Dn(x,r){let u=(r.roundZoom?Math.round:Math.floor)(x.zoom+s.at(x.tileSize/r.tileSize));return Math.max(0,u)}function Mn(x,r){let u=x.getCameraFrustum(),p=x.getClippingPlane(),g=x.screenPointToMercatorCoordinate(x.getCameraPoint()),E=s.a9.fromLngLat(x.center,x.elevation);g.z=E.z+Math.cos(x.pitchInRadians)*x.cameraToCenterDistance/x.worldSize;let C=x.getCoveringTilesDetailsProvider(),M=C.allowVariableZoom(x,r),R=Dn(x,r),k=r.minzoom||0,B=r.maxzoom!==void 0?r.maxzoom:x.maxZoom,G=Math.min(Math.max(0,R),B),U=Math.pow(2,G),Y=[U*g.x,U*g.y,0],ee=[U*E.x,U*E.y,0],se=Math.hypot(E.x-g.x,E.y-g.y),le=Math.abs(E.z-g.z),ae=Math.hypot(se,le),fe=ye=>({zoom:0,x:0,y:0,wrap:ye,fullyVisible:!1}),xe=[],de=[];if(x.renderWorldCopies&&C.allowWorldCopies())for(let ye=1;ye<=3;ye++)xe.push(fe(-ye)),xe.push(fe(ye));for(xe.push(fe(0));xe.length>0;){let ye=xe.pop(),Ee=ye.x,_e=ye.y,Ce=ye.fullyVisible,je={x:Ee,y:_e,z:ye.zoom},Ne=C.getTileBoundingVolume(je,ye.wrap,x.elevation,r);if(!Ce){let ct=Wn(u,Ne,p);if(ct===0)continue;Ce=ct===2}let ze=C.distanceToTile2d(g.x,g.y,je,Ne),Be=R;M&&(Be=(r.calculateTileZoom||qt)(x.zoom+s.at(x.tileSize/r.tileSize),ze,le,ae,x.fov)),Be=(r.roundZoom?Math.round:Math.floor)(Be),Be=Math.max(0,Be);let lt=Math.min(Be,B);if(ye.wrap=C.getWrap(E,je,ye.wrap),ye.zoom>=lt){if(ye.zoom<k)continue;let ct=G-ye.zoom,Ye=Y[0]-.5-(Ee<<ct),mt=Y[1]-.5-(_e<<ct),nn=r.reparseOverscaled?Math.max(ye.zoom,Be):ye.zoom;de.push({tileID:new s.a2(ye.zoom===B?nn:ye.zoom,ye.wrap,ye.zoom,Ee,_e),distanceSq:s.au([ee[0]-.5-Ee,ee[1]-.5-_e]),tileDistanceToCamera:Math.sqrt(Ye*Ye+mt*mt)})}else for(let ct=0;ct<4;ct++)xe.push({zoom:ye.zoom+1,x:(Ee<<1)+ct%2,y:(_e<<1)+(ct>>1),wrap:ye.wrap,fullyVisible:Ce})}return de.sort((ye,Ee)=>ye.distanceSq-Ee.distanceSq).map(ye=>ye.tileID)}let Hn=s.aa.fromPoints([new s.P(0,0),new s.P(s.a5,s.a5)]);function ni(x){return x==="raster"||x==="image"||x==="video"}function Bn(x,r,u,p,g,E,C){if(!r.hasData())return!1;let{tileID:M,fadingRole:R,fadingDirection:k,fadingParentID:B}=r;if(R===ge.Base&&k===be.Incoming&&B)return u[B.key]=B,!0;let G=Math.max(M.overscaledZ-g,E);for(let U=M.overscaledZ-1;U>=G;U--){let Y=M.scaledTo(U),ee=x.getLoadedTile(Y);if(ee)return r.setCrossFadeLogic({fadingRole:ge.Base,fadingDirection:be.Incoming,fadingParentID:ee.tileID,fadeEndTime:p+C}),ee.setCrossFadeLogic({fadingRole:ge.Parent,fadingDirection:be.Departing,fadeEndTime:p+C}),u[Y.key]=Y,!0}return!1}function Yt(x,r,u,p,g,E){if(!r.hasData())return!1;let C=r.tileID.children(g),M=De(x,r,C,u,p,g,E);if(M)return!0;for(let R of C)De(x,r,R.children(g),u,p,g,E)&&(M=!0);return M}function De(x,r,u,p,g,E,C){if(u[0].overscaledZ>=E)return!1;let M=!1;for(let R of u){let k=x.getLoadedTile(R);if(!k)continue;let{fadingRole:B,fadingDirection:G,fadingParentID:U}=k;B===ge.Base&&G===be.Departing&&U||(k.setCrossFadeLogic({fadingRole:ge.Base,fadingDirection:be.Departing,fadingParentID:r.tileID,fadeEndTime:g+C}),r.setCrossFadeLogic({fadingRole:ge.Parent,fadingDirection:be.Incoming,fadeEndTime:g+C})),p[R.key]=R,M=!0}return M}function Zn(x,r,u,p){let g=x.tileID;return!!x.selfFading||!x.hasData()&&!!r.has(g)&&(x.setSelfFadeLogic(u+p),!0)}function yr(x,r){var u;x.needsHillshadePrepare=!0,x.needsTerrainPrepare=!0;let p=r.tileID.canonical.x-x.tileID.canonical.x,g=r.tileID.canonical.y-x.tileID.canonical.y,E=Math.pow(2,x.tileID.canonical.z),C=r.tileID.key;p===0&&g===0||Math.abs(g)>1||(Math.abs(p)>1&&(Math.abs(p+E)===1?p+=E:Math.abs(p-E)===1&&(p-=E)),r.dem&&x.dem&&(x.dem.backfillBorder(r.dem,p,g),!((u=x.neighboringTiles)===null||u===void 0)&&u[C]&&(x.neighboringTiles[C].backfilled=!0)))}class La{constructor(){this._tiles={}}handleWrapJump(r){let u={};for(let p in this._tiles){let g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+r),u[g.tileID.key]=g}this._tiles=u}setFeatureState(r,u){for(let p in this._tiles)this._tiles[p].setFeatureState(r,u)}getAllTiles(){return Object.values(this._tiles)}getAllIds(r=!1){return r?Object.values(this._tiles).map(u=>u.tileID).sort(s.aw).map(u=>u.key):Object.keys(this._tiles)}getTileById(r){return this._tiles[r]}setTile(r,u){this._tiles[r]=u}deleteTileById(r){delete this._tiles[r]}getLoadedTile(r){let u=this.getTileById(r.key);return u?.hasData()?u:null}isIdRenderable(r,u=!1){var p;return(p=this.getTileById(r))===null||p===void 0?void 0:p.isRenderable(u)}getRenderableIds(r=0,u){let p=[];for(let g of this.getAllIds())this.isIdRenderable(g,u)&&p.push(this.getTileById(g));return u?p.sort((g,E)=>{let C=g.tileID,M=E.tileID,R=new s.P(C.canonical.x,C.canonical.y)._rotate(-r),k=new s.P(M.canonical.x,M.canonical.y)._rotate(-r);return C.overscaledZ-M.overscaledZ||k.y-R.y||k.x-R.x}).map(g=>g.tileID.key):p.map(g=>g.tileID).sort(s.aw).map(g=>g.key)}}class Mi extends s.E{constructor(r,u,p){super(),this.id=r,this.dispatcher=p,this.on("data",g=>this._dataHandler(g)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,E,C,M)=>{let R=new(as(E.type))(g,E,C,M);if(R.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${R.id}`);return R})(r,u,p,this),this._inViewTiles=new La,this._outOfViewCache=new s.ax(0,g=>this._unloadTile(g)),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Ae,this._didEmitContent=!1,this._updated=!1}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null,this._maxTileCacheZoomLevels=r?r._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(r)}onRemove(r){for(let u of this._inViewTiles.getAllTiles())u.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(r),this._inViewTiles=new La}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let r of this._inViewTiles.getAllTiles())if(r.state!=="loaded"&&r.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;let r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(r,u,p){return s._(this,void 0,void 0,function*(){try{yield this._source.loadTile(r),this._tileLoaded(r,u,p)}catch(g){r.state="errored",g.status!==404?this._source.fire(new s.k(g,{tile:r})):this.update(this.transform,this.terrain)}})}_unloadTile(r){this._source.unloadTile&&this._source.unloadTile(r)}_abortTile(r){this._source.abortTile&&this._source.abortTile(r),this._source.fire(new s.l("dataabort",{tile:r,coord:r.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(let u of this._inViewTiles.getAllTiles())u.upload(r),u.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(r){var u;return this._inViewTiles.getRenderableIds((u=this.transform)===null||u===void 0?void 0:u.bearingInRadians,r)}hasRenderableParent(r){let u=r.overscaledZ-1;if(u>=this._source.minzoom){let p=this.getLoadedTile(r.scaledTo(u));if(p)return this._inViewTiles.isIdRenderable(p.tileID.key)}return!1}reload(r,u=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(let p of this._inViewTiles.getAllIds()){let g=this._inViewTiles.getTileById(p);u&&!this._source.shouldReloadTile(g,u)||(r?this._reloadTile(p,"expired"):g.state!=="errored"&&this._reloadTile(p,"reloading"))}}}_reloadTile(r,u){return s._(this,void 0,void 0,function*(){let p=this._inViewTiles.getTileById(r);p&&(p.state!=="loading"&&(p.state=u),yield this._loadTile(p,r,u))})}_tileLoaded(r,u,p){r.timeAdded=q(),r.selfFading&&(r.fadeEndTime=r.timeAdded+this._rasterFadeDuration),p==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(u,r),this.getSource().type==="raster-dem"&&r.dem&&(function(g,E){var C,M;let R=E.getRenderableIds();for(let k of R){if(!g.neighboringTiles||!g.neighboringTiles[k])continue;let B=E.getTileById(k);g.neighboringTiles[k].backfilled||yr(g,B),!((M=(C=B.neighboringTiles)===null||C===void 0?void 0:C[g.tileID.key])===null||M===void 0)&&M.backfilled||yr(B,g)}})(r,this._inViewTiles),this._state.initializeTileState(r,this.map?this.map.painter:null),r.aborted||this._source.fire(new s.l("data",{dataType:"source",tile:r,coord:r.tileID}))}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._inViewTiles.getTileById(r)}_retainLoadedChildren(r,u){let p=this._getLoadedDescendents(u),g=new Set;for(let E of u){let C=p[E.key];if(!C?.length){g.add(E);continue}let M=E.overscaledZ+Mi.maxOverzooming,R=C.filter(G=>G.tileID.overscaledZ<=M);if(!R.length){g.add(E);continue}let k=Math.min(...R.map(G=>G.tileID.overscaledZ)),B=R.filter(G=>G.tileID.overscaledZ===k).map(G=>G.tileID);for(let G of B)r[G.key]=G;this._areDescendentsComplete(B,k,E.overscaledZ)||g.add(E)}return g}_getLoadedDescendents(r){var u;let p={};for(let g of this._inViewTiles.getAllTiles().filter(E=>E.hasData()))for(let E of r)g.tileID.isChildOf(E)&&(p[u=E.key]||(p[u]=[])).push(g);return p}_areDescendentsComplete(r,u,p){return r.length===1&&r[0].isOverscaled()?r[0].overscaledZ===u:Math.pow(4,u-p)===r.length}getLoadedTile(r){return this._inViewTiles.getLoadedTile(r)}updateCacheSize(r){let u=Math.ceil(r.width/this._source.tileSize)+1,p=Math.ceil(r.height/this._source.tileSize)+1,g=Math.floor(u*p*(this._maxTileCacheZoomLevels===null?s.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._outOfViewCache.setMaxSize(E)}handleWrapJump(r){let u=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);this._prevLng=r,u&&(this._inViewTiles.handleWrapJump(u),this._resetTileReloadTimers())}update(r,u){if(!this._sourceLoaded||this._paused)return;let p;this.transform=r,this.terrain=u,this.updateCacheSize(r),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?p=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(R=>new s.a2(R.canonical.z,R.wrap,R.canonical.z,R.canonical.x,R.canonical.y)):(p=Mn(r,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?r.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(p=p.filter(R=>this._source.hasTile(R)))):p=[],this.usedForTerrain&&(p=this._addTerrainIdealTiles(p));let g=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,g&&this.fire(new s.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let E=Dn(r,this._source),C=this._updateRetainedTiles(p,E),M=ni(this._source.type);M&&this._rasterFadeDuration>0&&!u&&(function(R,k,B,G,U,Y,ee){let se=q(),le=s.av(k);for(let ae of k){let fe=R.getTileById(ae.key);fe.fadingDirection!==be.Departing&&fe.fadeOpacity!==0||fe.resetFadeLogic(),Bn(R,fe,B,se,G,U,ee)||Yt(R,fe,B,se,Y,ee)||Zn(fe,le,se,ee)||fe.resetFadeLogic()}})(this._inViewTiles,p,C,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),M?this._cleanUpRasterTiles(C):this._cleanUpVectorTiles(C)}_cleanUpRasterTiles(r){for(let u of this._inViewTiles.getAllIds())r[u]||this._removeTile(u)}_cleanUpVectorTiles(r){for(let u of this._inViewTiles.getAllIds()){let p=this._inViewTiles.getTileById(u);r[u]?p.clearSymbolFadeHold():p.hasSymbolBuckets?p.holdingForSymbolFade()?p.symbolFadeFinished()&&this._removeTile(u):p.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(u)}}_addTerrainIdealTiles(r){let u=[];for(let p of r)if(p.canonical.z>this._source.minzoom){let g=p.scaledTo(p.canonical.z-1);u.push(g);let E=p.scaledTo(Math.max(this._source.minzoom,Math.min(p.canonical.z,5)));u.push(E)}return r.concat(u)}releaseSymbolFadeTiles(){for(let r of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(r).holdingForSymbolFade()&&this._removeTile(r)}_updateRetainedTiles(r,u){var p;let g=new Set;for(let k of r)this._addTile(k).hasData()||g.add(k);let E=r.reduce((k,B)=>(k[B.key]=B,k),{}),C=this._retainLoadedChildren(E,g),M={},R=Math.max(u-Mi.maxUnderzooming,this._source.minzoom);for(let k of C){let B=this._inViewTiles.getTileById(k.key),G=B?.wasRequested();for(let U=k.overscaledZ-1;U>=R;--U){let Y=k.scaledTo(U);if(M[Y.key])break;if(M[Y.key]=!0,B=this.getTile(Y),!B&&G&&(B=this._addTile(Y)),B){let ee=B.hasData();if((ee||!(!((p=this.map)===null||p===void 0)&&p.cancelPendingTileRequestsWhileZooming)||G)&&(E[Y.key]=Y),G=B.wasRequested(),ee)break}}}return E}_addTile(r){let u=this._inViewTiles.getTileById(r.key);if(u)return u;u=this._outOfViewCache.getAndRemove(r),u&&(u.resetFadeLogic(),this._setTileReloadTimer(r.key,u),u.tileID=r,this._state.initializeTileState(u,this.map?this.map.painter:null));let p=u;return u||(u=new Le(r,this._source.tileSize*r.overscaleFactor()),this._loadTile(u,r.key,u.state)),u.uses++,this._inViewTiles.setTile(r.key,u),p||this._source.fire(new s.l("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(r,u){this._clearTileReloadTimer(r);let p=u.getExpiryTimeout();p&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},p))}_clearTileReloadTimer(r){let u=this._timers[r];u&&(clearTimeout(u),delete this._timers[r])}_resetTileReloadTimers(){for(let r in this._timers)clearTimeout(this._timers[r]),delete this._timers[r];for(let r of this._inViewTiles.getAllIds()){let u=this._inViewTiles.getTileById(r);this._setTileReloadTimer(r,u)}}refreshTiles(r){for(let u of this._inViewTiles.getAllIds()){let p=this._inViewTiles.getTileById(u);(this._inViewTiles.isIdRenderable(u)||p.state=="errored")&&r.some(g=>g.equals(p.tileID.canonical))&&this._reloadTile(u,"expired")}}_removeTile(r){let u=this._inViewTiles.getTileById(r);u&&(u.uses--,this._inViewTiles.deleteTileById(r),this._clearTileReloadTimer(r),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._outOfViewCache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}_dataHandler(r){r.dataType==="source"&&(r.sourceDataType!=="metadata"?r.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(r.sourceDataChanged,r.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let r of this._inViewTiles.getAllIds())this._removeTile(r);this._outOfViewCache.reset()}tilesIn(r,u,p){let g=[],E=this.transform;if(!E)return g;let C=E.getCoveringTilesDetailsProvider().allowWorldCopies(),M=p?E.getCameraQueryGeometry(r):r,R=Y=>E.screenPointToMercatorCoordinate(Y,this.terrain),k=this.transformBbox(r,R,!C),B=this.transformBbox(M,R,!C),G=this.getIds(),U=s.aa.fromPoints(B);for(let Y=0;Y<G.length;Y++){let ee=this._inViewTiles.getTileById(G[Y]);if(ee.holdingForSymbolFade())continue;let se=C?[ee.tileID]:[ee.tileID.unwrapTo(-1),ee.tileID.unwrapTo(0)],le=Math.pow(2,E.zoom-ee.tileID.overscaledZ),ae=u*ee.queryPadding*s.a5/ee.tileSize/le;for(let fe of se){let xe=U.map(de=>fe.getTilePoint(new s.a9(de.x,de.y)));if(xe.expandBy(ae),xe.intersects(Hn)){let de=k.map(Ee=>fe.getTilePoint(Ee)),ye=B.map(Ee=>fe.getTilePoint(Ee));g.push({tile:ee,tileID:C?fe:fe.unwrapTo(0),queryGeometry:de,cameraQueryGeometry:ye,scale:le})}}}return g}transformBbox(r,u,p){let g=r.map(u);if(p){let E=s.aa.fromPoints(r);E.shrinkBy(.001*Math.min(E.width(),E.height()));let C=E.map(u);s.aa.fromPoints(g).covers(C)||(g=g.map(M=>M.x>.5?new s.a9(M.x-1,M.y,M.z):M))}return g}getVisibleCoordinates(r){let u=this.getRenderableIds(r).map(p=>this._inViewTiles.getTileById(p).tileID);return this.transform&&this.transform.populateCache(u),u}hasTransition(){return!!this._source.hasTransition()||!(!ni(this._source.type)||!(function(r,u){if(u<=0)return!1;let p=q();for(let g of r.getAllTiles())if(g.fadeEndTime>=p)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(r){this._rasterFadeDuration=r}setFeatureState(r,u,p){this._state.updateState(r=r||s.ai,u,p)}removeFeatureState(r,u,p){this._state.removeFeatureState(r=r||s.ai,u,p)}getFeatureState(r,u){return this._state.getState(r=r||s.ai,u)}setDependencies(r,u,p){let g=this._inViewTiles.getTileById(r);g&&g.setDependencies(u,p)}reloadTilesForDependencies(r,u){for(let p of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(p).hasDependency(r,u)&&this._reloadTile(p,"reloading");this._outOfViewCache.filter(p=>!p.hasDependency(r,u))}areTilesLoaded(){for(let r of this._inViewTiles.getAllTiles())if(r.state!=="loaded"&&r.state!=="errored")return!1;return!0}}Mi.maxUnderzooming=10,Mi.maxOverzooming=3;class ht{constructor(r,u){this.reset(r,u)}reset(r,u){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=s.an(r,0,1);let u=1,p=this._distances[u],g=r*this.paddedLength+this.padding;for(;p<g&&u<this._distances.length;)p=this._distances[++u];let E=u-1,C=this._distances[E],M=p-C,R=M>0?(g-C)/M:0;return this.points[E].mult(1-R).add(this.points[u].mult(R))}}function en(x,r){let u=!0;return x==="always"||x!=="never"&&r!=="never"||(u=!1),u}class tn{constructor(r,u,p){let g=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(u/p);for(let C=0;C<this.xCellCount*this.yCellCount;C++)g.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=u,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,u,p,g,E){this._forEachCell(u,p,g,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(g),this.bboxes.push(E)}insertCircle(r,u,p,g){this._forEachCell(u-g,p-g,u+g,p+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(u),this.circles.push(p),this.circles.push(g)}_insertBoxCell(r,u,p,g,E,C){this.boxCells[E].push(C)}_insertCircleCell(r,u,p,g,E,C){this.circleCells[E].push(C)}_query(r,u,p,g,E,C,M){if(p<0||r>this.width||g<0||u>this.height)return[];let R=[];if(r<=0&&u<=0&&this.width<=p&&this.height<=g){if(E)return[{key:null,x1:r,y1:u,x2:p,y2:g}];for(let k=0;k<this.boxKeys.length;k++)R.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){let B=this.circles[3*k],G=this.circles[3*k+1],U=this.circles[3*k+2];R.push({key:this.circleKeys[k],x1:B-U,y1:G-U,x2:B+U,y2:G+U})}}else this._forEachCell(r,u,p,g,this._queryCell,R,{hitTest:E,overlapMode:C,seenUids:{box:{},circle:{}}},M);return R}query(r,u,p,g){return this._query(r,u,p,g,!1,null)}hitTest(r,u,p,g,E,C){return this._query(r,u,p,g,!0,E,C).length>0}hitTestCircle(r,u,p,g,E){let C=r-p,M=r+p,R=u-p,k=u+p;if(M<0||C>this.width||k<0||R>this.height)return!1;let B=[];return this._forEachCell(C,R,M,k,this._queryCellCircle,B,{hitTest:!0,overlapMode:g,circle:{x:r,y:u,radius:p},seenUids:{box:{},circle:{}}},E),B.length>0}_queryCell(r,u,p,g,E,C,M,R){let{seenUids:k,hitTest:B,overlapMode:G}=M,U=this.boxCells[E];if(U!==null){let ee=this.bboxes;for(let se of U)if(!k.box[se]){k.box[se]=!0;let le=4*se,ae=this.boxKeys[se];if(r<=ee[le+2]&&u<=ee[le+3]&&p>=ee[le+0]&&g>=ee[le+1]&&(!R||R(ae))&&(!B||!en(G,ae.overlapMode))&&(C.push({key:ae,x1:ee[le],y1:ee[le+1],x2:ee[le+2],y2:ee[le+3]}),B))return!0}}let Y=this.circleCells[E];if(Y!==null){let ee=this.circles;for(let se of Y)if(!k.circle[se]){k.circle[se]=!0;let le=3*se,ae=this.circleKeys[se];if(this._circleAndRectCollide(ee[le],ee[le+1],ee[le+2],r,u,p,g)&&(!R||R(ae))&&(!B||!en(G,ae.overlapMode))){let fe=ee[le],xe=ee[le+1],de=ee[le+2];if(C.push({key:ae,x1:fe-de,y1:xe-de,x2:fe+de,y2:xe+de}),B)return!0}}}return!1}_queryCellCircle(r,u,p,g,E,C,M,R){let{circle:k,seenUids:B,overlapMode:G}=M,U=this.boxCells[E];if(U!==null){let ee=this.bboxes;for(let se of U)if(!B.box[se]){B.box[se]=!0;let le=4*se,ae=this.boxKeys[se];if(this._circleAndRectCollide(k.x,k.y,k.radius,ee[le+0],ee[le+1],ee[le+2],ee[le+3])&&(!R||R(ae))&&!en(G,ae.overlapMode))return C.push(!0),!0}}let Y=this.circleCells[E];if(Y!==null){let ee=this.circles;for(let se of Y)if(!B.circle[se]){B.circle[se]=!0;let le=3*se,ae=this.circleKeys[se];if(this._circlesCollide(ee[le],ee[le+1],ee[le+2],k.x,k.y,k.radius)&&(!R||R(ae))&&!en(G,ae.overlapMode))return C.push(!0),!0}}}_forEachCell(r,u,p,g,E,C,M,R){let k=this._convertToXCellCoord(r),B=this._convertToYCellCoord(u),G=this._convertToXCellCoord(p),U=this._convertToYCellCoord(g);for(let Y=k;Y<=G;Y++)for(let ee=B;ee<=U;ee++)if(E.call(this,r,u,p,g,this.xCellCount*ee+Y,C,M,R))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,u,p,g,E,C){let M=g-r,R=E-u,k=p+C;return k*k>M*M+R*R}_circleAndRectCollide(r,u,p,g,E,C,M){let R=(C-g)/2,k=Math.abs(r-(g+R));if(k>R+p)return!1;let B=(M-E)/2,G=Math.abs(u-(E+B));if(G>B+p)return!1;if(k<=R||G<=B)return!0;let U=k-R,Y=G-B;return U*U+Y*Y<=p*p}}function so(x,r,u){let p=s.N();if(!x){let{vecSouth:G,vecEast:U}=Js(r),Y=v();Y[0]=U[0],Y[1]=U[1],Y[2]=G[0],Y[3]=G[1],g=Y,(B=(C=(E=Y)[0])*(k=E[3])-(R=E[2])*(M=E[1]))&&(g[0]=k*(B=1/B),g[1]=-M*B,g[2]=-R*B,g[3]=C*B),p[0]=Y[0],p[1]=Y[1],p[4]=Y[2],p[5]=Y[3]}var g,E,C,M,R,k,B;return s.Q(p,p,[1/u,1/u,1]),p}function ch(x,r,u,p){if(x){let g=s.N();if(!r){let{vecSouth:E,vecEast:C}=Js(u);g[0]=C[0],g[1]=C[1],g[4]=E[0],g[5]=E[1]}return s.Q(g,g,[p,p,1]),g}return u.pixelsToClipSpaceMatrix}function Js(x){let r=Math.cos(x.rollInRadians),u=Math.sin(x.rollInRadians),p=Math.cos(x.pitchInRadians),g=Math.cos(x.bearingInRadians),E=Math.sin(x.bearingInRadians),C=s.aC();C[0]=-g*p*u-E*r,C[1]=-E*p*u+g*r;let M=s.aD(C);M<1e-9?s.aE(C):s.aF(C,C,1/M);let R=s.aC();R[0]=g*p*r-E*u,R[1]=E*p*r+g*u;let k=s.aD(R);return k<1e-9?s.aE(R):s.aF(R,R,1/k),{vecEast:R,vecSouth:C}}function on(x,r,u,p){let g;p?(g=[x,r,p(x,r),1],s.aH(g,g,u)):(g=[x,r,0,1],sl(g,g,u));let E=g[3];return{point:new s.P(g[0]/E,g[1]/E),signedDistanceFromCamera:E,isOccluded:!1}}function Kc(x,r){return .5+x/r*.5}function Yl(x,r){return x.x>=-r[0]&&x.x<=r[0]&&x.y>=-r[1]&&x.y<=r[1]}function uh(x,r,u,p,g,E,C,M,R,k,B,G,U){let Y=u?x.textSizeData:x.iconSizeData,ee=s.ay(Y,r.transform.zoom),se=[256/r.width*2+1,256/r.height*2+1],le=u?x.text.dynamicLayoutVertexArray:x.icon.dynamicLayoutVertexArray;le.clear();let ae=x.lineVertexArray,fe=u?x.text.placedSymbolArray:x.icon.placedSymbolArray,xe=r.transform.width/r.transform.height,de=!1;for(let ye=0;ye<fe.length;ye++){let Ee=fe.get(ye);if(Ee.hidden||Ee.writingMode===s.az.vertical&&!de){ii(Ee.numGlyphs,le);continue}de=!1;let _e=new s.P(Ee.anchorX,Ee.anchorY),Ce={getElevation:U,pitchedLabelPlaneMatrix:p,lineVertexArray:ae,pitchWithMap:E,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:r.transform,tileAnchorPoint:_e,unwrappedTileID:R,width:k,height:B,translation:G},je=bs(Ee.anchorX,Ee.anchorY,Ce);if(!Yl(je.point,se)){ii(Ee.numGlyphs,le);continue}let Ne=Kc(r.transform.cameraToCenterDistance,je.signedDistanceFromCamera),ze=s.aA(Y,ee,Ee),Be=E?ze*r.transform.getPitchedTextCorrection(Ee.anchorX,Ee.anchorY,R)/Ne:ze*Ne,lt=Kl({projectionContext:Ce,pitchedLabelPlaneMatrixInverse:g,symbol:Ee,fontSize:Be,flip:!1,keepUpright:C,glyphOffsetArray:x.glyphOffsetArray,dynamicLayoutVertexArray:le,aspectRatio:xe,rotateToLine:M});de=lt.useVertical,(lt.notEnoughRoom||de||lt.needsFlipping&&Kl({projectionContext:Ce,pitchedLabelPlaneMatrixInverse:g,symbol:Ee,fontSize:Be,flip:!0,keepUpright:C,glyphOffsetArray:x.glyphOffsetArray,dynamicLayoutVertexArray:le,aspectRatio:xe,rotateToLine:M}).notEnoughRoom)&&ii(Ee.numGlyphs,le)}u?x.text.dynamicLayoutVertexBuffer.updateData(le):x.icon.dynamicLayoutVertexBuffer.updateData(le)}function Qs(x,r,u,p,g,E,C,M){let R=E.glyphStartIndex+E.numGlyphs,k=E.lineStartIndex,B=E.lineStartIndex+E.lineLength,G=r.getoffsetX(E.glyphStartIndex),U=r.getoffsetX(R-1),Y=Zr(x*G,u,p,g,E.segment,k,B,M,C);if(!Y)return null;let ee=Zr(x*U,u,p,g,E.segment,k,B,M,C);return ee?M.projectionCache.anyProjectionOccluded?null:{first:Y,last:ee}:null}function Jc(x,r,u,p){return x===s.az.horizontal&&Math.abs(u.y-r.y)>Math.abs(u.x-r.x)*p?{useVertical:!0}:(x===s.az.vertical?r.y<u.y:r.x>u.x)?{needsFlipping:!0}:null}function Kl(x){let{projectionContext:r,pitchedLabelPlaneMatrixInverse:u,symbol:p,fontSize:g,flip:E,keepUpright:C,glyphOffsetArray:M,dynamicLayoutVertexArray:R,aspectRatio:k,rotateToLine:B}=x,G=g/24,U=p.lineOffsetX*G,Y=p.lineOffsetY*G,ee;if(p.numGlyphs>1){let se=p.glyphStartIndex+p.numGlyphs,le=p.lineStartIndex,ae=p.lineStartIndex+p.lineLength,fe=Qs(G,M,U,Y,E,p,B,r);if(!fe)return{notEnoughRoom:!0};let xe=Jl(fe.first.point.x,fe.first.point.y,r,u),de=Jl(fe.last.point.x,fe.last.point.y,r,u);if(C&&!E){let ye=Jc(p.writingMode,xe,de,k);if(ye)return ye}ee=[fe.first];for(let ye=p.glyphStartIndex+1;ye<se-1;ye++){let Ee=Zr(G*M.getoffsetX(ye),U,Y,E,p.segment,le,ae,r,B);if(!Ee)return{notEnoughRoom:!0};ee.push(Ee)}ee.push(fe.last)}else{if(C&&!E){let le=Kn(r.tileAnchorPoint.x,r.tileAnchorPoint.y,r).point,ae=p.lineStartIndex+p.segment+1,fe=new s.P(r.lineVertexArray.getx(ae),r.lineVertexArray.gety(ae)),xe=Kn(fe.x,fe.y,r),de=xe.signedDistanceFromCamera>0?xe.point:Qc(r.tileAnchorPoint,fe,le,1,r),ye=Jl(le.x,le.y,r,u),Ee=Jl(de.x,de.y,r,u),_e=Jc(p.writingMode,ye,Ee,k);if(_e)return _e}let se=Zr(G*M.getoffsetX(p.glyphStartIndex),U,Y,E,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,r,B);if(!se||r.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ee=[se]}for(let se of ee)s.aG(R,se.point,se.angle);return{}}function Qc(x,r,u,p,g){let E=x.add(x.sub(r)._unit()),C=Kn(E.x,E.y,g).point,M=u.sub(C);return u.add(M._mult(p/M.mag()))}function Hr(x,r,u){let p=r.projectionCache;if(p.projections[x])return p.projections[x];let g=new s.P(r.lineVertexArray.getx(x),r.lineVertexArray.gety(x)),E=Kn(g.x,g.y,r);if(E.signedDistanceFromCamera>0)return p.projections[x]=E.point,p.anyProjectionOccluded=p.anyProjectionOccluded||E.isOccluded,E.point;let C=x-u.direction;return Qc(u.distanceFromAnchor===0?r.tileAnchorPoint:new s.P(r.lineVertexArray.getx(C),r.lineVertexArray.gety(C)),g,u.previousVertex,u.absOffsetX-u.distanceFromAnchor+1,r)}function Kn(x,r,u){let p=x+u.translation[0],g=r+u.translation[1],E;return u.pitchWithMap?(E=on(p,g,u.pitchedLabelPlaneMatrix,u.getElevation),E.isOccluded=!1):(E=u.transform.projectTileCoordinates(p,g,u.unwrappedTileID,u.getElevation),E.point.x=(.5*E.point.x+.5)*u.width,E.point.y=(.5*-E.point.y+.5)*u.height),E}function Jl(x,r,u,p){if(u.pitchWithMap){let g=[x,r,0,1];return s.aH(g,g,p),u.transform.projectTileCoordinates(g[0]/g[3],g[1]/g[3],u.unwrappedTileID,u.getElevation).point}return{x:x/u.width*2-1,y:1-r/u.height*2}}function bs(x,r,u){return u.transform.projectTileCoordinates(x,r,u.unwrappedTileID,u.getElevation)}function Ql(x,r,u){return x._unit()._perp()._mult(r*u)}function Oa(x,r,u,p,g,E,C,M,R){if(M.projectionCache.offsets[x])return M.projectionCache.offsets[x];let k=u.add(r);if(x+R.direction<p||x+R.direction>=g)return M.projectionCache.offsets[x]=k,k;let B=Hr(x+R.direction,M,R),G=Ql(B.sub(u),C,R.direction),U=u.add(G),Y=B.add(G);return M.projectionCache.offsets[x]=s.aI(E,k,U,Y)||k,M.projectionCache.offsets[x]}function Zr(x,r,u,p,g,E,C,M,R){let k=p?x-r:x+r,B=k>0?1:-1,G=0;p&&(B*=-1,G=Math.PI),B<0&&(G+=Math.PI);let U,Y=B>0?E+g:E+g+1;M.projectionCache.cachedAnchorPoint?U=M.projectionCache.cachedAnchorPoint:(U=Kn(M.tileAnchorPoint.x,M.tileAnchorPoint.y,M).point,M.projectionCache.cachedAnchorPoint=U);let ee,se,le=U,ae=U,fe=0,xe=0,de=Math.abs(k),ye=[],Ee;for(;fe+xe<=de;){if(Y+=B,Y<E||Y>=C)return null;fe+=xe,ae=le,se=ee;let je={absOffsetX:de,direction:B,distanceFromAnchor:fe,previousVertex:ae};if(le=Hr(Y,M,je),u===0)ye.push(ae),Ee=le.sub(ae);else{let Ne,ze=le.sub(ae);Ne=ze.mag()===0?Ql(Hr(Y+B,M,je).sub(le),u,B):Ql(ze,u,B),se||(se=ae.add(Ne)),ee=Oa(Y,Ne,le,E,C,se,u,M,je),ye.push(se),Ee=ee.sub(se)}xe=Ee.mag()}let _e=Ee._mult((de-fe)/xe)._add(se||ae),Ce=G+Math.atan2(le.y-ae.y,le.x-ae.x);return ye.push(_e),{point:_e,angle:R?Ce:0,path:ye}}let jn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ii(x,r){for(let u=0;u<x;u++){let p=r.length;r.resize(p+4),r.float32.set(jn,3*p)}}function sl(x,r,u){let p=r[0],g=r[1];return x[0]=u[0]*p+u[4]*g+u[12],x[1]=u[1]*p+u[5]*g+u[13],x[3]=u[3]*p+u[7]*g+u[15],x}let ai=100;class al{constructor(r,u=new tn(r.width+200,r.height+200,25),p=new tn(r.width+200,r.height+200,25)){this.transform=r,this.grid=u,this.ignoredGrid=p,this.pitchFactor=Math.cos(r.pitch*Math.PI/180)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+ai,this.screenBottomBoundary=r.height+ai,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(r,u,p,g,E,C,M,R,k,B,G,U){let Y=this.projectAndGetPerspectiveRatio(r.anchorPointX+R[0],r.anchorPointY+R[1],E,B,U),ee=p*Y.perspectiveRatio,se;if(C||M)se=this._projectCollisionBox(r,ee,g,E,C,M,R,Y,B,G,U);else{let Ee=Y.x+(G?G.x*ee:0),_e=Y.y+(G?G.y*ee:0);se={allPointsOccluded:!1,box:[Ee+r.x1*ee,_e+r.y1*ee,Ee+r.x2*ee,_e+r.y2*ee]}}let[le,ae,fe,xe]=se.box,de=C?se.allPointsOccluded:Y.isOccluded,ye=de;return ye||(ye=Y.perspectiveRatio<this.perspectiveRatioCutoff),ye||(ye=!this.isInsideGrid(le,ae,fe,xe)),ye||u!=="always"&&this.grid.hitTest(le,ae,fe,xe,u,k)?{box:[le,ae,fe,xe],placeable:!1,offscreen:!1,occluded:de}:{box:[le,ae,fe,xe],placeable:!0,offscreen:this.isOffscreen(le,ae,fe,xe),occluded:de}}placeCollisionCircles(r,u,p,g,E,C,M,R,k,B,G,U,Y,ee){let se=[],le=new s.P(u.anchorX,u.anchorY),ae=this.getPerspectiveRatio(le.x,le.y,C,ee),fe=(k?E*this.transform.getPitchedTextCorrection(u.anchorX,u.anchorY,C)/ae:E*ae)/s.aM,xe={getElevation:ee,pitchedLabelPlaneMatrix:M,lineVertexArray:p,pitchWithMap:k,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:le,unwrappedTileID:C,width:this.transform.width,height:this.transform.height,translation:Y},de=Qs(fe,g,u.lineOffsetX*fe,u.lineOffsetY*fe,!1,u,!1,xe),ye=!1,Ee=!1,_e=!0;if(de){let Ce=.5*G*ae+U,je=new s.P(-100,-100),Ne=new s.P(this.screenRightBoundary,this.screenBottomBoundary),ze=new ht,Be=de.first,lt=de.last,ct=[];for(let nn=Be.path.length-1;nn>=1;nn--)ct.push(Be.path[nn]);for(let nn=1;nn<lt.path.length;nn++)ct.push(lt.path[nn]);let Ye=2.5*Ce;if(k){let nn=this.projectPathToScreenSpace(ct,xe);ct=nn.some(oi=>oi.signedDistanceFromCamera<=0)?[]:nn.map(oi=>oi.point)}let mt=[];if(ct.length>0){let nn=ct[0].clone(),oi=ct[0].clone();for(let Ii=1;Ii<ct.length;Ii++)nn.x=Math.min(nn.x,ct[Ii].x),nn.y=Math.min(nn.y,ct[Ii].y),oi.x=Math.max(oi.x,ct[Ii].x),oi.y=Math.max(oi.y,ct[Ii].y);mt=nn.x>=je.x&&oi.x<=Ne.x&&nn.y>=je.y&&oi.y<=Ne.y?[ct]:oi.x<je.x||nn.x>Ne.x||oi.y<je.y||nn.y>Ne.y?[]:s.aJ([ct],je.x,je.y,Ne.x,Ne.y)}for(let nn of mt){ze.reset(nn,.25*Ce);let oi=0;oi=ze.length<=.5*Ce?1:Math.ceil(ze.paddedLength/Ye)+1;for(let Ii=0;Ii<oi;Ii++){let gi=Ii/Math.max(oi-1,1),Ri=ze.lerp(gi),_i=Ri.x+ai,Yi=Ri.y+ai;se.push(_i,Yi,Ce,0);let Li=_i-Ce,Mr=Yi-Ce,or=_i+Ce,tr=Yi+Ce;if(_e=_e&&this.isOffscreen(Li,Mr,or,tr),Ee=Ee||this.isInsideGrid(Li,Mr,or,tr),r!=="always"&&this.grid.hitTestCircle(_i,Yi,Ce,r,B)&&(ye=!0,!R))return{circles:[],offscreen:!1,collisionDetected:ye}}}}return{circles:!R&&ye||!Ee||ae<this.perspectiveRatioCutoff?[]:se,offscreen:_e,collisionDetected:ye}}projectPathToScreenSpace(r,u){let p=(function(g,E){let C=s.N();return s.aB(C,E.pitchedLabelPlaneMatrix),g.map(M=>{let R=on(M.x,M.y,C,E.getElevation),k=E.transform.projectTileCoordinates(R.point.x,R.point.y,E.unwrappedTileID,E.getElevation);return k.point.x=(.5*k.point.x+.5)*E.width,k.point.y=(.5*-k.point.y+.5)*E.height,k})})(r,u);return(function(g){let E=0,C=0,M=0,R=0;for(let k=0;k<g.length;k++)g[k].isOccluded?(M=k+1,R=0):(R++,R>C&&(C=R,E=M));return g.slice(E,E+C)})(p)}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let u=[],p=new s.aa;for(let G of r){let U=new s.P(G.x+ai,G.y+ai);p.extend(U),u.push(U)}let{minX:g,minY:E,maxX:C,maxY:M}=p,R=this.grid.query(g,E,C,M).concat(this.ignoredGrid.query(g,E,C,M)),k={},B={};for(let G of R){let U=G.key;if(k[U.bucketInstanceId]===void 0&&(k[U.bucketInstanceId]={}),k[U.bucketInstanceId][U.featureIndex])continue;let Y=[new s.P(G.x1,G.y1),new s.P(G.x2,G.y1),new s.P(G.x2,G.y2),new s.P(G.x1,G.y2)];s.aK(u,Y)&&(k[U.bucketInstanceId][U.featureIndex]=!0,B[U.bucketInstanceId]===void 0&&(B[U.bucketInstanceId]=[]),B[U.bucketInstanceId].push(U.featureIndex))}return B}insertCollisionBox(r,u,p,g,E,C){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:E,collisionGroupID:C,overlapMode:u},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,u,p,g,E,C){let M=p?this.ignoredGrid:this.grid,R={bucketInstanceId:g,featureIndex:E,collisionGroupID:C,overlapMode:u};for(let k=0;k<r.length;k+=4)M.insertCircle(R,r[k],r[k+1],r[k+2])}projectAndGetPerspectiveRatio(r,u,p,g,E){if(E){let C;g?(C=[r,u,g(r,u),1],s.aH(C,C,E)):(C=[r,u,0,1],sl(C,C,E));let M=C[3];return{x:(C[0]/M+1)/2*this.transform.width+ai,y:(-C[1]/M+1)/2*this.transform.height+ai,perspectiveRatio:.5+this.transform.cameraToCenterDistance/M*.5,isOccluded:!1,signedDistanceFromCamera:M}}{let C=this.transform.projectTileCoordinates(r,u,p,g);return{x:(C.point.x+1)/2*this.transform.width+ai,y:(1-C.point.y)/2*this.transform.height+ai,perspectiveRatio:.5+this.transform.cameraToCenterDistance/C.signedDistanceFromCamera*.5,isOccluded:C.isOccluded,signedDistanceFromCamera:C.signedDistanceFromCamera}}}getPerspectiveRatio(r,u,p,g){let E=this.transform.projectTileCoordinates(r,u,p,g);return .5+this.transform.cameraToCenterDistance/E.signedDistanceFromCamera*.5}isOffscreen(r,u,p,g){return p<ai||r>=this.screenRightBoundary||g<ai||u>this.screenBottomBoundary}isInsideGrid(r,u,p,g){return p>=0&&r<this.gridRightBoundary&&g>=0&&u<this.gridBottomBoundary}getViewportMatrix(){let r=s.ar([]);return s.O(r,r,[-100,-100,0]),r}_projectCollisionBox(r,u,p,g,E,C,M,R,k,B,G){let U=1,Y=0,ee=0,se=1,le=r.anchorPointX+M[0],ae=r.anchorPointY+M[1];if(C&&!E){let ct=this.projectAndGetPerspectiveRatio(le+1,ae,g,k,G),Ye=ct.x-R.x,mt=Math.atan((ct.y-R.y)/Ye)+(Ye<0?Math.PI:0),nn=Math.sin(mt),oi=Math.cos(mt);U=oi,Y=nn,ee=-nn,se=oi}else if(!C&&E){let ct=Js(this.transform);U=ct.vecEast[0],Y=ct.vecEast[1],ee=ct.vecSouth[0],se=ct.vecSouth[1]}let fe=R.x,xe=R.y,de=u;E&&(fe=le,xe=ae,de=Math.pow(2,-(this.transform.zoom-p.overscaledZ)),de*=this.transform.getPitchedTextCorrection(le,ae,g),B||(de*=s.an(.5+R.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),B&&(fe+=U*B.x*de+ee*B.y*de,xe+=Y*B.x*de+se*B.y*de);let ye=r.x1*de,Ee=r.x2*de,_e=(ye+Ee)/2,Ce=r.y1*de,je=r.y2*de,Ne=(Ce+je)/2,ze=[{offsetX:ye,offsetY:Ce},{offsetX:_e,offsetY:Ce},{offsetX:Ee,offsetY:Ce},{offsetX:Ee,offsetY:Ne},{offsetX:Ee,offsetY:je},{offsetX:_e,offsetY:je},{offsetX:ye,offsetY:je},{offsetX:ye,offsetY:Ne}],Be=[];for(let{offsetX:ct,offsetY:Ye}of ze)Be.push(new s.P(fe+U*ct+ee*Ye,xe+Y*ct+se*Ye));let lt=!1;if(E){let ct=Be.map(Ye=>this.projectAndGetPerspectiveRatio(Ye.x,Ye.y,g,k,G));lt=ct.some(Ye=>!Ye.isOccluded),Be=ct.map(Ye=>new s.P(Ye.x,Ye.y))}else lt=!0;return{box:s.aL(Be),allPointsOccluded:!lt}}}class hh{constructor(r,u,p,g){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?u:-u))):g&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class cn{constructor(r,u,p,g,E){this.text=new hh(r?r.text:null,u,p,E),this.icon=new hh(r?r.icon:null,u,g,E)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Bi{constructor(r,u,p){this.text=r,this.icon=u,this.skipFade=p}}class dh{constructor(r,u,p,g,E){this.bucketInstanceId=r,this.featureIndex=u,this.sourceLayerIndex=p,this.bucketIndex=g,this.tileID=E}}class eu{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){let u=++this.maxGroupID;this.collisionGroups[r]={ID:u,predicate:p=>p.collisionGroupID===u}}return this.collisionGroups[r]}}function qr(x,r,u,p,g){let{horizontalAlign:E,verticalAlign:C}=s.aS(x);return new s.P(-(E-.5)*r+p[0]*g,-(C-.5)*u+p[1]*g)}class Cd{constructor(r,u,p,g,E){this.transform=r.clone(),this.terrain=u,this.collisionIndex=new al(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new eu(g),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(r){let u=this.terrain;return u?(p,g)=>u.getElevation(r,p,g):null}getBucketParts(r,u,p,g){let E=p.getBucket(u),C=p.latestFeatureIndex;if(!E||!C||u.id!==E.layerIds[0])return;let M=p.collisionBoxArray,R=E.layers[0].layout,k=E.layers[0].paint,B=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),G=p.tileSize/s.a5,U=p.tileID.toUnwrapped(),Y=R.get("text-rotation-alignment")==="map",ee=s.aN(p,1,this.transform.zoom),se=s.aO(this.collisionIndex.transform,p,k.get("text-translate"),k.get("text-translate-anchor")),le=s.aO(this.collisionIndex.transform,p,k.get("icon-translate"),k.get("icon-translate-anchor")),ae=so(Y,this.transform,ee);this.retainedQueryData[E.bucketInstanceId]=new dh(E.bucketInstanceId,C,E.sourceLayerIndex,E.index,p.tileID);let fe={bucket:E,layout:R,translationText:se,translationIcon:le,unwrappedTileID:U,pitchedLabelPlaneMatrix:ae,scale:B,textPixelRatio:G,holdingForFade:p.holdingForSymbolFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:s.ay(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(g)for(let xe of E.sortKeyRanges){let{sortKey:de,symbolInstanceStart:ye,symbolInstanceEnd:Ee}=xe;r.push({sortKey:de,symbolInstanceStart:ye,symbolInstanceEnd:Ee,parameters:fe})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:fe})}attemptAnchorPlacement(r,u,p,g,E,C,M,R,k,B,G,U,Y,ee,se,le,ae,fe,xe,de){let ye=s.aP[r.textAnchor],Ee=[r.textOffset0,r.textOffset1],_e=qr(ye,p,g,Ee,E),Ce=this.collisionIndex.placeCollisionBox(u,U,R,k,B,M,C,le,G.predicate,xe,_e,de);if((!fe||this.collisionIndex.placeCollisionBox(fe,U,R,k,B,M,C,ae,G.predicate,xe,_e,de).placeable)&&Ce.placeable){let je;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID].text&&(je=this.prevPlacement.variableOffsets[Y.crossTileID].anchor),Y.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Y.crossTileID]={textOffset:Ee,width:p,height:g,anchor:ye,textBoxScale:E,prevAnchor:je},this.markUsedJustification(ee,ye,Y,se),ee.allowVerticalPlacement&&(this.markUsedOrientation(ee,se,Y),this.placedOrientations[Y.crossTileID]=se),{shift:_e,placedGlyphBoxes:Ce}}}placeLayerBucketPart(r,u,p){let{bucket:g,layout:E,translationText:C,translationIcon:M,unwrappedTileID:R,pitchedLabelPlaneMatrix:k,textPixelRatio:B,holdingForFade:G,collisionBoxArray:U,partiallyEvaluatedTextSize:Y,collisionGroup:ee}=r.parameters,se=E.get("text-optional"),le=E.get("icon-optional"),ae=s.aQ(E,"text-overlap","text-allow-overlap"),fe=ae==="always",xe=s.aQ(E,"icon-overlap","icon-allow-overlap"),de=xe==="always",ye=E.get("text-rotation-alignment")==="map",Ee=E.get("text-pitch-alignment")==="map",_e=E.get("icon-text-fit")!=="none",Ce=E.get("symbol-z-order")==="viewport-y",je=fe&&(de||!g.hasIconData()||le),Ne=de&&(fe||!g.hasTextData()||se);!g.collisionArrays&&U&&g.deserializeCollisionBoxes(U);let ze=this.retainedQueryData[g.bucketInstanceId].tileID,Be=this._getTerrainElevationFunc(ze),lt=this.transform.getFastPathSimpleProjectionMatrix(ze),ct=(Ye,mt,nn)=>{var oi,Ii;if(u[Ye.crossTileID])return;if(G)return void(this.placements[Ye.crossTileID]=new Bi(!1,!1,!1));let gi=!1,Ri=!1,_i=!0,Yi=null,Li={box:null,placeable:!1,offscreen:null,occluded:!1},Mr={placeable:!1},or=null,tr=null,Yr=null,wc=0,bl=0,Ha=0;mt.textFeatureIndex?wc=mt.textFeatureIndex:Ye.useRuntimeCollisionCircles&&(wc=Ye.featureIndex),mt.verticalTextFeatureIndex&&(bl=mt.verticalTextFeatureIndex);let Yo=mt.textBox;if(Yo){let As=bi=>{let yi=s.az.horizontal;if(g.allowVerticalPlacement&&!bi&&this.prevPlacement){let br=this.prevPlacement.placedOrientations[Ye.crossTileID];br&&(this.placedOrientations[Ye.crossTileID]=br,yi=br,this.markUsedOrientation(g,yi,Ye))}return yi},Za=(bi,yi)=>{if(g.allowVerticalPlacement&&Ye.numVerticalGlyphVertices>0&&mt.verticalTextBox){for(let br of g.writingModes)if(br===s.az.vertical?(Li=yi(),Mr=Li):Li=bi(),Li&&Li.placeable)break}else Li=bi()},ma=Ye.textAnchorOffsetStartIndex,ga=Ye.textAnchorOffsetEndIndex;if(ga===ma){let bi=(yi,br)=>{let wr=this.collisionIndex.placeCollisionBox(yi,ae,B,ze,R,Ee,ye,C,ee.predicate,Be,void 0,lt);return wr&&wr.placeable&&(this.markUsedOrientation(g,br,Ye),this.placedOrientations[Ye.crossTileID]=br),wr};Za(()=>bi(Yo,s.az.horizontal),()=>{let yi=mt.verticalTextBox;return g.allowVerticalPlacement&&Ye.numVerticalGlyphVertices>0&&yi?bi(yi,s.az.vertical):{box:null,offscreen:null}}),As(Li&&Li.placeable)}else{let bi=s.aP[(Ii=(oi=this.prevPlacement)===null||oi===void 0?void 0:oi.variableOffsets[Ye.crossTileID])===null||Ii===void 0?void 0:Ii.anchor],yi=(wr,y0,v0)=>{let vu=wr.x2-wr.x1,iE=wr.y2-wr.y1,x0=Ye.textBoxScale,T_=_e&&xe==="never"?y0:null,Ec=null,Tc=ae==="never"?1:2,Cc="never";bi&&Tc++;for(let C_=0;C_<Tc;C_++){for(let I_=ma;I_<ga;I_++){let Zp=g.textAnchorOffsets.get(I_);if(bi&&Zp.textAnchor!==bi)continue;let qp=this.attemptAnchorPlacement(Zp,wr,vu,iE,x0,ye,Ee,B,ze,R,ee,Cc,Ye,g,v0,C,M,T_,Be);if(qp&&(Ec=qp.placedGlyphBoxes,Ec&&Ec.placeable))return gi=!0,Yi=qp.shift,Ec}bi?bi=null:Cc=ae}return p&&!Ec&&(Ec={box:this.collisionIndex.placeCollisionBox(Yo,"always",B,ze,R,Ee,ye,C,ee.predicate,Be,void 0,lt).box,offscreen:!1,placeable:!1,occluded:!1}),Ec};Za(()=>yi(Yo,mt.iconBox,s.az.horizontal),()=>{let wr=mt.verticalTextBox;return g.allowVerticalPlacement&&(!Li||!Li.placeable)&&Ye.numVerticalGlyphVertices>0&&wr?yi(wr,mt.verticalIconBox,s.az.vertical):{box:null,occluded:!0,offscreen:null}}),Li&&(gi=Li.placeable,_i=Li.offscreen);let br=As(Li&&Li.placeable);if(!gi&&this.prevPlacement){let wr=this.prevPlacement.variableOffsets[Ye.crossTileID];wr&&(this.variableOffsets[Ye.crossTileID]=wr,this.markUsedJustification(g,wr.anchor,Ye,br))}}}if(or=Li,gi=or&&or.placeable,_i=or&&or.offscreen,Ye.useRuntimeCollisionCircles&&Ye.centerJustifiedTextSymbolIndex>=0){let As=g.text.placedSymbolArray.get(Ye.centerJustifiedTextSymbolIndex),Za=s.aA(g.textSizeData,Y,As),ma=E.get("text-padding");tr=this.collisionIndex.placeCollisionCircles(ae,As,g.lineVertexArray,g.glyphOffsetArray,Za,R,k,p,Ee,ee.predicate,Ye.collisionCircleDiameter,ma,C,Be),tr.circles.length&&tr.collisionDetected&&!p&&s.w("Collisions detected, but collision boxes are not shown"),gi=fe||tr.circles.length>0&&!tr.collisionDetected,_i=_i&&tr.offscreen}if(mt.iconFeatureIndex&&(Ha=mt.iconFeatureIndex),mt.iconBox){let As=Za=>this.collisionIndex.placeCollisionBox(Za,xe,B,ze,R,Ee,ye,M,ee.predicate,Be,_e&&Yi?Yi:void 0,lt);Mr&&Mr.placeable&&mt.verticalIconBox?(Yr=As(mt.verticalIconBox),Ri=Yr.placeable):(Yr=As(mt.iconBox),Ri=Yr.placeable),_i=_i&&Yr.offscreen}let _u=se||Ye.numHorizontalGlyphVertices===0&&Ye.numVerticalGlyphVertices===0,Xd=le||Ye.numIconVertices===0;_u||Xd?Xd?_u||(Ri=Ri&&gi):gi=Ri&&gi:Ri=gi=Ri&&gi;let yu=Ri&&Yr.placeable;if(gi&&or.placeable&&this.collisionIndex.insertCollisionBox(or.box,ae,E.get("text-ignore-placement"),g.bucketInstanceId,Mr&&Mr.placeable&&bl?bl:wc,ee.ID),yu&&this.collisionIndex.insertCollisionBox(Yr.box,xe,E.get("icon-ignore-placement"),g.bucketInstanceId,Ha,ee.ID),tr&&gi&&this.collisionIndex.insertCollisionCircles(tr.circles,ae,E.get("text-ignore-placement"),g.bucketInstanceId,wc,ee.ID),p&&this.storeCollisionData(g.bucketInstanceId,nn,mt,or,Yr,tr),Ye.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ye.crossTileID]=new Bi((gi||je)&&!or?.occluded,(Ri||Ne)&&!Yr?.occluded,_i||g.justReloaded),u[Ye.crossTileID]=!0};if(Ce){if(r.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let Ye=g.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let mt=Ye.length-1;mt>=0;--mt){let nn=Ye[mt];ct(g.symbolInstances.get(nn),g.collisionArrays[nn],nn)}}else for(let Ye=r.symbolInstanceStart;Ye<r.symbolInstanceEnd;Ye++)ct(g.symbolInstances.get(Ye),g.collisionArrays[Ye],Ye);g.justReloaded=!1}storeCollisionData(r,u,p,g,E,C){if(p.textBox||p.iconBox){let M,R;this.collisionBoxArrays.has(r)?M=this.collisionBoxArrays.get(r):(M=new Map,this.collisionBoxArrays.set(r,M)),M.has(u)?R=M.get(u):(R={text:null,icon:null},M.set(u,R)),p.textBox&&(R.text=g.box),p.iconBox&&(R.icon=E.box)}if(C){let M=this.collisionCircleArrays[r];M===void 0&&(M=this.collisionCircleArrays[r]=[]);for(let R=0;R<C.circles.length;R+=4)M.push(C.circles[R+0]-ai),M.push(C.circles[R+1]-ai),M.push(C.circles[R+2]),M.push(C.collisionDetected?1:0)}}markUsedJustification(r,u,p,g){let E;E=g===s.az.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[s.aR(u)];let C=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(let M of C)M>=0&&(r.text.placedSymbolArray.get(M).crossTileID=E>=0&&M!==E?0:p.crossTileID)}markUsedOrientation(r,u,p){let g=u===s.az.horizontal||u===s.az.horizontalOnly?u:0,E=u===s.az.vertical?u:0,C=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(let M of C)r.text.placedSymbolArray.get(M).placedOrientation=g;p.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=E)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;let u=this.prevPlacement,p=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;let g=u?u.symbolFadeChange(r):1,E=u?u.opacities:{},C=u?u.variableOffsets:{},M=u?u.placedOrientations:{};for(let R in this.placements){let k=this.placements[R],B=E[R];B?(this.opacities[R]=new cn(B,g,k.text,k.icon),p=p||k.text!==B.text.placed||k.icon!==B.icon.placed):(this.opacities[R]=new cn(null,g,k.text,k.icon,k.skipFade),p=p||k.text||k.icon)}for(let R in E){let k=E[R];if(!this.opacities[R]){let B=new cn(k,g,!1,!1);B.isHidden()||(this.opacities[R]=B,p=p||k.text.placed||k.icon.placed)}}for(let R in C)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=C[R]);for(let R in M)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=M[R]);if(u&&u.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:r)}updateLayerOpacities(r,u){let p={};for(let g of u){let E=g.getBucket(r);E&&g.latestFeatureIndex&&r.id===E.layerIds[0]&&this.updateBucketOpacities(E,g.tileID,p,g.collisionBoxArray)}}updateBucketOpacities(r,u,p,g){r.hasTextData()&&(r.text.opacityVertexArray.clear(),r.text.hasVisibleVertices=!1),r.hasIconData()&&(r.icon.opacityVertexArray.clear(),r.icon.hasVisibleVertices=!1),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();let E=r.layers[0],C=E.layout,M=new cn(null,0,!1,!1,!0),R=C.get("text-allow-overlap"),k=C.get("icon-allow-overlap"),B=E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"),G=C.get("text-rotation-alignment")==="map",U=C.get("text-pitch-alignment")==="map",Y=C.get("icon-text-fit")!=="none",ee=new cn(null,0,R&&(k||!r.hasIconData()||C.get("icon-optional")),k&&(R||!r.hasTextData()||C.get("text-optional")),!0);!r.collisionArrays&&g&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(g);let se=(ae,fe,xe)=>{for(let de=0;de<fe/4;de++)ae.opacityVertexArray.emplaceBack(xe);ae.hasVisibleVertices=ae.hasVisibleVertices||xe!==cl},le=this.collisionBoxArrays.get(r.bucketInstanceId);for(let ae=0;ae<r.symbolInstances.length;ae++){let fe=r.symbolInstances.get(ae),{numHorizontalGlyphVertices:xe,numVerticalGlyphVertices:de,crossTileID:ye}=fe,Ee=this.opacities[ye];p[ye]?Ee=M:Ee||(Ee=ee,this.opacities[ye]=Ee),p[ye]=!0;let _e=fe.numIconVertices>0,Ce=this.placedOrientations[fe.crossTileID],je=Ce===s.az.vertical,Ne=Ce===s.az.horizontal||Ce===s.az.horizontalOnly;if(xe>0||de>0){let Be=tu(Ee.text);se(r.text,xe,je?cl:Be),se(r.text,de,Ne?cl:Be);let lt=Ee.text.isHidden();[fe.rightJustifiedTextSymbolIndex,fe.centerJustifiedTextSymbolIndex,fe.leftJustifiedTextSymbolIndex].forEach(mt=>{mt>=0&&(r.text.placedSymbolArray.get(mt).hidden=lt||je?1:0)}),fe.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(fe.verticalPlacedTextSymbolIndex).hidden=lt||Ne?1:0);let ct=this.variableOffsets[fe.crossTileID];ct&&this.markUsedJustification(r,ct.anchor,fe,Ce);let Ye=this.placedOrientations[fe.crossTileID];Ye&&(this.markUsedJustification(r,"left",fe,Ye),this.markUsedOrientation(r,Ye,fe))}if(_e){let Be=tu(Ee.icon),lt=!(Y&&fe.verticalPlacedIconSymbolIndex&&je);fe.placedIconSymbolIndex>=0&&(se(r.icon,fe.numIconVertices,lt?Be:cl),r.icon.placedSymbolArray.get(fe.placedIconSymbolIndex).hidden=Ee.icon.isHidden()),fe.verticalPlacedIconSymbolIndex>=0&&(se(r.icon,fe.numVerticalIconVertices,lt?cl:Be),r.icon.placedSymbolArray.get(fe.verticalPlacedIconSymbolIndex).hidden=Ee.icon.isHidden())}let ze=le&&le.has(ae)?le.get(ae):{text:null,icon:null};if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){let Be=r.collisionArrays[ae];if(Be){let lt=new s.P(0,0);if(Be.textBox||Be.verticalTextBox){let ct=!0;if(B){let Ye=this.variableOffsets[ye];Ye?(lt=qr(Ye.anchor,Ye.width,Ye.height,Ye.textOffset,Ye.textBoxScale),G&&lt._rotate(U?-this.transform.bearingInRadians:this.transform.bearingInRadians)):ct=!1}if(Be.textBox||Be.verticalTextBox){let Ye;Be.textBox&&(Ye=je),Be.verticalTextBox&&(Ye=Ne),ec(r.textCollisionBox.collisionVertexArray,Ee.text.placed,!ct||Ye,ze.text,lt.x,lt.y)}}if(Be.iconBox||Be.verticalIconBox){let ct=!!(!Ne&&Be.verticalIconBox),Ye;Be.iconBox&&(Ye=ct),Be.verticalIconBox&&(Ye=!ct),ec(r.iconCollisionBox.collisionVertexArray,Ee.icon.placed,Ye,ze.icon,Y?lt.x:0,Y?lt.y:0)}}}}if(r.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.text.opacityVertexArray.length!==r.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${r.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${r.text.layoutVertexArray.length}) / 4`);if(r.icon.opacityVertexArray.length!==r.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${r.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${r.icon.layoutVertexArray.length}) / 4`);r.bucketInstanceId in this.collisionCircleArrays&&(r.collisionCircleArray=this.collisionCircleArrays[r.bucketInstanceId],delete this.collisionCircleArrays[r.bucketInstanceId])}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,u){let p=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function ec(x,r,u,p,g,E){p&&p.length!==0||(p=[0,0,0,0]);let C=p[0]-ai,M=p[1]-ai,R=p[2]-ai,k=p[3]-ai;x.emplaceBack(r?1:0,u?1:0,g||0,E||0,C,M),x.emplaceBack(r?1:0,u?1:0,g||0,E||0,R,M),x.emplaceBack(r?1:0,u?1:0,g||0,E||0,R,k),x.emplaceBack(r?1:0,u?1:0,g||0,E||0,C,k)}let ea=Math.pow(2,25),ji=Math.pow(2,24),ll=Math.pow(2,17),ta=Math.pow(2,16),ka=Math.pow(2,9),fh=Math.pow(2,8),ws=Math.pow(2,1);function tu(x){if(x.opacity===0&&!x.placed)return 0;if(x.opacity===1&&x.placed)return 4294967295;let r=x.placed?1:0,u=Math.floor(127*x.opacity);return u*ea+r*ji+u*ll+r*ta+u*ka+r*fh+u*ws+r}let cl=0;class ls{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&!r.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,u,p,g,E){let C=this._bucketParts;for(;this._currentTileIndex<r.length;)if(u.getBucketParts(C,g,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((M,R)=>M.sortKey-R.sortKey));this._currentPartIndex<C.length;)if(u.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,E())return!0;return!1}}class Fa{constructor(r,u,p,g,E,C,M,R){this.placement=new Cd(r,u,C,M,R),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=E,this._done=!1}isDone(){return this._done}continuePlacement(r,u,p){let g=q(),E=()=>!this._forceFullPlacement&&q()-g>2;for(;this._currentPlacementIndex>=0;){let C=u[r[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=M)&&(!C.maxzoom||C.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new ls(C)),this._inProgressLayer.continuePlacement(p[C.source],this.placement,this._showCollisionBoxes,C,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}let sn=512/s.a5/2;class tc{constructor(r,u,p){this.tileID=r,this.bucketInstanceId=p,this._symbolsByKey={};let g=new Map;for(let E=0;E<u.length;E++){let C=u.get(E),M=C.key,R=g.get(M);R?R.push(C):g.set(M,[C])}for(let[E,C]of g){let M={positions:C.map(R=>({x:Math.floor(R.anchorX*sn),y:Math.floor(R.anchorY*sn)})),crossTileIDs:C.map(R=>R.crossTileID)};if(M.positions.length>128){let R=new s.aT(M.positions.length,16,Uint16Array);for(let{x:k,y:B}of M.positions)R.add(k,B);R.finish(),delete M.positions,M.index=R}this._symbolsByKey[E]=M}}getScaledCoordinates(r,u){let{x:p,y:g,z:E}=this.tileID.canonical,{x:C,y:M,z:R}=u.canonical,k=sn/Math.pow(2,R-E),B=(M*s.a5+r.anchorY)*k,G=g*s.a5*sn;return{x:Math.floor((C*s.a5+r.anchorX)*k-p*s.a5*sn),y:Math.floor(B-G)}}findMatches(r,u,p){let g=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let E=0;E<r.length;E++){let C=r.get(E);if(C.crossTileID)continue;let M=this._symbolsByKey[C.key];if(!M)continue;let R=this.getScaledCoordinates(C,u);if(M.index){let k=M.index.range(R.x-g,R.y-g,R.x+g,R.y+g).sort();for(let B of k){let G=M.crossTileIDs[B];if(!p[G]){p[G]=!0,C.crossTileID=G;break}}}else if(M.positions)for(let k=0;k<M.positions.length;k++){let B=M.positions[k],G=M.crossTileIDs[k];if(Math.abs(B.x-R.x)<=g&&Math.abs(B.y-R.y)<=g&&!p[G]){p[G]=!0,C.crossTileID=G;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:r})=>r)}}class hp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class nu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){let u=Math.round((r-this.lng)/360);if(u!==0)for(let p in this.indexes){let g=this.indexes[p],E={};for(let C in g){let M=g[C];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+u),E[M.tileID.key]=M}this.indexes[p]=E}this.lng=r}addBucket(r,u,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let E=0;E<u.symbolInstances.length;E++)u.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});let g=this.usedCrossTileIDs[r.overscaledZ];for(let E in this.indexes){let C=this.indexes[E];if(Number(E)>r.overscaledZ)for(let M in C){let R=C[M];R.tileID.isChildOf(r)&&R.findMatches(u.symbolInstances,r,g)}else{let M=C[r.scaledTo(Number(E)).key];M&&M.findMatches(u.symbolInstances,r,g)}}for(let E=0;E<u.symbolInstances.length;E++){let C=u.symbolInstances.get(E);C.crossTileID||(C.crossTileID=p.generate(),g[C.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new tc(r,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(r,u){for(let p of u.getCrossTileIDsLists())for(let g of p)delete this.usedCrossTileIDs[r][g]}removeStaleBuckets(r){let u=!1;for(let p in this.indexes){let g=this.indexes[p];for(let E in g)r[g[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,g[E]),delete g[E],u=!0)}return u}}class ao{constructor(){this.layerIndexes={},this.crossTileIDs=new hp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,u,p){let g=this.layerIndexes[r.id];g===void 0&&(g=this.layerIndexes[r.id]=new nu);let E=!1,C={};g.handleWrapJump(p);for(let M of u){let R=M.getBucket(r);R&&r.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(M.tileID,R,this.crossTileIDs)&&(E=!0),C[R.bucketInstanceId]=!0)}return g.removeStaleBuckets(C)&&(E=!0),E}pruneUnusedLayers(r){let u={};r.forEach(p=>{u[p]=!0});for(let p in this.layerIndexes)u[p]||delete this.layerIndexes[p]}}var Bt="void main() {fragColor=vec4(1.0);}";let Vn={prelude:bt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:bt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:bt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:bt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:bt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:bt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:bt(Bt,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:bt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:bt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:bt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:bt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:bt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:bt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:bt(Bt,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:bt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:bt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:bt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:bt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:bt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:bt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:bt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:bt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:bt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:bt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:bt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:bt(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:bt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:bt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:bt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:bt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:bt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:bt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:bt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:bt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:bt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:bt(`#ifdef GL_ES
precision highp float;
#endif
in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:bt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function bt(x,r){let u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=r.match(/in ([\w]+) ([\w]+)/g),g=x.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=r.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=E?E.concat(g):g,M={};return{fragmentSource:x=x.replace(u,(R,k,B,G,U)=>(M[U]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${U}
in ${B} ${G} ${U};
#else
uniform ${B} ${G} u_${U};
#endif
`:`
#ifdef HAS_UNIFORM_u_${U}
    ${B} ${G} ${U} = u_${U};
#endif
`)),vertexSource:r=r.replace(u,(R,k,B,G,U)=>{let Y=G==="float"?"vec2":"vec4",ee=U.match(/color/)?"color":Y;return M[U]?k==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
in ${B} ${Y} a_${U};
out ${B} ${G} ${U};
#else
uniform ${B} ${G} u_${U};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${B} ${G} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = unpack_mix_${ee}(a_${U}, u_${U}_t);
#else
    ${B} ${G} ${U} = u_${U};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
in ${B} ${Y} a_${U};
#else
uniform ${B} ${G} u_${U};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${B} ${G} ${U} = a_${U};
#else
    ${B} ${G} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${B} ${G} ${U} = unpack_mix_${ee}(a_${U}, u_${U}_t);
#else
    ${B} ${G} ${U} = u_${U};
#endif
`}),staticAttributes:p,staticUniforms:C}}class ri{constructor(r,u,p){this.vertexBuffer=r,this.indexBuffer=u,this.segments=p}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Es=s.aU([{name:"a_pos",type:"Int16",components:2}]);let vr="#define PROJECTION_MERCATOR",Wr="mercator";class qi{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Wr}get shaderDefine(){return vr}get shaderPreludeCode(){return Vn.projectionMercator}get vertexShaderPreludeCode(){return Vn.projectionMercator.vertexSource}get subdivisionGranularity(){return s.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(r){}getMeshFromTileID(r,u,p,g,E){if(this._cachedMesh)return this._cachedMesh;let C=new s.aW;C.emplaceBack(0,0),C.emplaceBack(s.a5,0),C.emplaceBack(0,s.a5),C.emplaceBack(s.a5,s.a5);let M=r.createVertexBuffer(C,Es.members),R=s.aX.simpleSegment(0,0,4,2),k=new s.aY;k.emplaceBack(1,0,2),k.emplaceBack(1,2,3);let B=r.createIndexBuffer(k);return this._cachedMesh=new ri(M,B,R),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(r){}}class Na{constructor(r=0,u=0,p=0,g=0){if(isNaN(r)||r<0||isNaN(u)||u<0||isNaN(p)||p<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=u,this.left=p,this.right=g}interpolate(r,u,p){return u.top!=null&&r.top!=null&&(this.top=s.G.number(r.top,u.top,p)),u.bottom!=null&&r.bottom!=null&&(this.bottom=s.G.number(r.bottom,u.bottom,p)),u.left!=null&&r.left!=null&&(this.left=s.G.number(r.left,u.left,p)),u.right!=null&&r.right!=null&&(this.right=s.G.number(r.right,u.right,p)),this}getCenter(r,u){let p=s.an((this.left+r-this.right)/2,0,r),g=s.an((this.top+u-this.bottom)/2,0,u);return new s.P(p,g)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Na(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function qo(x,r){if(!x.renderWorldCopies||x.lngRange)return;let u=r.lng-x.center.lng;r.lng+=u>180?-360:u<-180?360:0}function Pn(x){return Math.max(0,Math.floor(x))}class Po{constructor(r,u){var p;this.applyConstrain=(g,E)=>this._constrainOverride!==null?this._constrainOverride(g,E):this._callbacks.defaultConstrain(g,E),this._callbacks=r,this._tileSize=512,this._renderWorldCopies=u?.renderWorldCopies===void 0||!!u?.renderWorldCopies,this._minZoom=u?.minZoom||0,this._maxZoom=u?.maxZoom||22,this._minPitch=u?.minPitch==null?0:u?.minPitch,this._maxPitch=u?.maxPitch==null?60:u?.maxPitch,this._constrainOverride=(p=u?.constrainOverride)!==null&&p!==void 0?p:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new s.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Pn(this._zoom),this._scale=s.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Na,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(r,u,p){this._constrainOverride=r.constrainOverride,this._latRange=r.latRange,this._lngRange=r.lngRange,this._width=r.width,this._height=r.height,this._center=r.center,this._elevation=r.elevation,this._minElevationForCurrentTile=r.minElevationForCurrentTile,this._zoom=r.zoom,this._tileZoom=Pn(this._zoom),this._scale=s.aq(this._zoom),this._bearingInRadians=r.bearingInRadians,this._fovInRadians=r.fovInRadians,this._pitchInRadians=r.pitchInRadians,this._rollInRadians=r.rollInRadians,this._unmodified=r.unmodified,this._edgeInsets=new Na(r.padding.top,r.padding.bottom,r.padding.left,r.padding.right),this._minZoom=r.minZoom,this._maxZoom=r.maxZoom,this._minPitch=r.minPitch,this._maxPitch=r.maxPitch,this._renderWorldCopies=r.renderWorldCopies,this._cameraToCenterDistance=r.cameraToCenterDistance,this._nearZ=r.nearZ,this._farZ=r.farZ,this._autoCalculateNearFarZ=!p&&r.autoCalculateNearFarZ,u&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(r){this._minElevationForCurrentTile=r}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(r){this._minZoom!==r&&(this._minZoom=r,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(r){this._minPitch!==r&&(this._minPitch=r,this.setPitch(Math.max(this.pitch,r)))}get maxPitch(){return this._maxPitch}setMaxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.setPitch(Math.min(this.pitch,r)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get constrainOverride(){return this._constrainOverride}setConstrainOverride(r){r===void 0&&(r=null),this._constrainOverride!==r&&(this._constrainOverride=r,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(r){let u=s.W(r,-180,180)*Math.PI/180;var p,g,E,C,M,R,k,B,G;this._bearingInRadians!==u&&(this._unmodified=!1,this._bearingInRadians=u,this._calcMatrices(),this._rotationMatrix=v(),p=this._rotationMatrix,E=-this._bearingInRadians,C=(g=this._rotationMatrix)[0],M=g[1],R=g[2],k=g[3],B=Math.sin(E),G=Math.cos(E),p[0]=C*G+R*B,p[1]=M*G+k*B,p[2]=C*-B+R*G,p[3]=M*-B+k*G)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(r){let u=s.an(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==u&&(this._unmodified=!1,this._pitchInRadians=u,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(r){let u=r/180*Math.PI;this._rollInRadians!==u&&(this._unmodified=!1,this._rollInRadians=u,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return s.aZ(this._fovInRadians)}setFov(r){r=s.an(r,.1,150),this.fov!==r&&(this._unmodified=!1,this._fovInRadians=s.ap(r),this._calcMatrices())}get zoom(){return this._zoom}setZoom(r){let u=this.applyConstrain(this._center,r).zoom;this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this._tileZoom=Math.max(0,Math.floor(u)),this._scale=s.aq(u),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(r){r!==this._elevation&&(this._elevation=r,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(r,u){this._autoCalculateNearFarZ=!1,this._nearZ=r,this._farZ=u,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,u,p){this._unmodified=!1,this._edgeInsets.interpolate(r,u,p),this.constrainInternal(),this._calcMatrices()}resize(r,u,p=!0){this._width=r,this._height=u,p&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new bn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(r){r?(this._lngRange=[r.getWest(),r.getEast()],this._latRange=[r.getSouth(),r.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-s.ao,s.ao])}getCameraQueryGeometry(r,u){if(u.length===1)return[u[0],r];{let{minX:p,minY:g,maxX:E,maxY:C}=s.aa.fromPoints(u).extend(r);return[new s.P(p,g),new s.P(E,g),new s.P(E,C),new s.P(p,C),new s.P(p,g)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;let r=this._unmodified,{center:u,zoom:p}=this.applyConstrain(this.center,this.zoom);this.setCenter(u),this.setZoom(p),this._unmodified=r,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let r=s.ar(new Float64Array(16));s.Q(r,r,[this._width/2,-this._height/2,1]),s.O(r,r,[1,-1,0]),this._clipSpaceToPixelsMatrix=r,r=s.ar(new Float64Array(16)),s.Q(r,r,[1,-1,1]),s.O(r,r,[-1,-1,0]),s.Q(r,r,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=r,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(r,u,p,g){let E=p!==void 0?p:this.bearing,C=g=g!==void 0?g:this.pitch,{distanceToCenter:M,clampedElevation:R}=this._distanceToCenterFromAltElevationPitch(u,this.elevation,C),{x:k,y:B}=Ut(C,E),G=s.a9.fromLngLat(r,u),U,Y,ee=s.a_(1,G.y),se=0;do{if(se+=1,se>10)break;Y=M/ee,U=new s.a9(G.x+k*Y,G.y+B*Y),ee=1/U.meterInMercatorCoordinateUnits()}while(Math.abs(M-Y*ee)>1e-12);return{center:U.toLngLat(),elevation:R,zoom:s.at(this.height/2/Math.tan(this.fovInRadians/2)/Y/this.tileSize)}}recalculateZoomAndCenter(r){if(this.elevation-r==0)return;let u=1/this.worldSize,p=s.as(1,this.center.lat)*this.worldSize,g=s.a9.fromLngLat(this.center,this.elevation),E=g.x/u,C=g.y/u,M=g.z/u,R=this.pitch,k=this.bearing,{x:B,y:G,z:U}=Ut(R,k),Y=this.cameraToCenterDistance,ee=E+Y*-B,se=C+Y*-G,le=M+Y*U,{distanceToCenter:ae,clampedElevation:fe}=this._distanceToCenterFromAltElevationPitch(le/p,r,R),xe=ae*p,de=new s.a9((ee+B*xe)*u,(se+G*xe)*u,0).toLngLat(),ye=s.as(1,de.lat),Ee=s.at(this.height/2/Math.tan(this.fovInRadians/2)/ae/ye/this.tileSize);this._elevation=fe,this._center=de,this.setZoom(Ee)}_distanceToCenterFromAltElevationPitch(r,u,p){let g=-Math.cos(s.ap(p)),E=r-u,C,M=u;return g*E>=0||Math.abs(g)<.1?(C=1e4,M=r+C*g):C=-E/g,{distanceToCenter:C,clampedElevation:M}}getCameraPoint(){let r=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(r*Math.sin(this.rollInRadians),r*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){let r=s.as(1,this.center.lat)*this.worldSize;return Te(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/r).toLngLat()}getMercatorTileCoordinates(r){if(!r)return[0,0,1,1];let u=r.canonical.z>=0?1<<r.canonical.z:Math.pow(2,r.canonical.z);return[r.canonical.x/u,r.canonical.y/u,1/u/s.a5,1/u/s.a5]}}class cs{constructor(r,u){this.min=r,this.max=u,this.center=s.a$([],s.b0([],this.min,this.max),.5)}quadrant(r){let u=[r%2==0,r<2],p=s.b1(this.min),g=s.b1(this.max);for(let E=0;E<u.length;E++)p[E]=u[E]?this.min[E]:this.center[E],g[E]=u[E]?this.center[E]:this.max[E];return g[2]=this.max[2],new cs(p,g)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}intersectsFrustum(r){let u=!0;for(let p=0;p<r.planes.length;p++){let g=this.intersectsPlane(r.planes[p]);if(g===0)return 0;g===1&&(u=!1)}return u?2:r.aabb.min[0]>this.max[0]||r.aabb.min[1]>this.max[1]||r.aabb.min[2]>this.max[2]||r.aabb.max[0]<this.min[0]||r.aabb.max[1]<this.min[1]||r.aabb.max[2]<this.min[2]?0:1}intersectsPlane(r){let u=r[3],p=r[3];for(let g=0;g<3;g++)r[g]>0?(u+=r[g]*this.min[g],p+=r[g]*this.max[g]):(p+=r[g]*this.min[g],u+=r[g]*this.max[g]);return u>=0?2:p<0?0:1}}class iu{distanceToTile2d(r,u,p,g){let E=g.distanceX([r,u]),C=g.distanceY([r,u]);return Math.hypot(E,C)}getWrap(r,u,p){return p}getTileBoundingVolume(r,u,p,g){var E,C;let M=0,R=0;if(g?.terrain){let B=new s.a2(r.z,u,r.z,r.x,r.y),G=g.terrain.getMinMaxElevation(B);M=(E=G.minElevation)!==null&&E!==void 0?E:Math.min(0,p),R=(C=G.maxElevation)!==null&&C!==void 0?C:Math.max(0,p)}let k=1<<r.z;return new cs([u+r.x/k,r.y/k,M],[u+(r.x+1)/k,(r.y+1)/k,R])}allowVariableZoom(r,u){let p=r.fov*(Math.abs(Math.cos(r.rollInRadians))*r.height+Math.abs(Math.sin(r.rollInRadians))*r.width)/r.height,g=s.an(78.5-p/2,0,60);return!!u.terrain||r.pitch>g}allowWorldCopies(){return!0}prepareNextFrame(){}}class lo{constructor(r,u,p){this.points=r,this.planes=u,this.aabb=p}static fromInvProjectionMatrix(r,u=1,p=0,g,E){let C=E?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],M=Math.pow(2,p),R=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(U=>(function(Y,ee,se,le){let ae=s.aH([],Y,ee),fe=1/ae[3]/se*le;return s.b6(ae,ae,[fe,fe,1/ae[3],fe])})(U,r,u,M));g&&(function(U,Y,ee,se){let le=se?4:0,ae=se?0:4,fe=0,xe=[],de=[];for(let _e=0;_e<4;_e++){let Ce=s.b2([],U[_e+ae],U[_e+le]),je=s.b7(Ce);s.a$(Ce,Ce,1/je),xe.push(je),de.push(Ce)}for(let _e=0;_e<4;_e++){let Ce=s.b8(U[_e+le],de[_e],ee);fe=Ce!==null&&Ce>=0?Math.max(fe,Ce):Math.max(fe,xe[_e])}let ye=(function(_e,Ce){let je=s.b2([],_e[Ce[0]],_e[Ce[1]]),Ne=s.b2([],_e[Ce[2]],_e[Ce[1]]),ze=[0,0,0,0];return s.b3(ze,s.b4([],je,Ne)),ze[3]=-s.b5(ze,_e[Ce[0]]),ze})(U,Y),Ee=(function(_e,Ce){let je=s.b9(_e),Ne=s.ba([],_e,1/je),ze=s.b2([],Ce,s.a$([],Ne,s.b5(Ce,Ne))),Be=s.b9(ze);if(Be>0){let lt=Math.sqrt(1-Ne[3]*Ne[3]),ct=s.a$([],Ne,-Ne[3]),Ye=s.b0([],ct,s.a$([],ze,lt/Be));return s.bb(Ce,Ye)}return null})(ee,ye);if(Ee!==null){let _e=Ee/s.b5(de[0],ye);fe=Math.min(fe,_e)}for(let _e=0;_e<4;_e++){let Ce=Math.min(fe,xe[_e]);U[_e+ae]=[U[_e+le][0]+de[_e][0]*Ce,U[_e+le][1]+de[_e][1]*Ce,U[_e+le][2]+de[_e][2]*Ce,1]}})(R,C[0],g,E);let k=C.map(U=>{let Y=s.b2([],R[U[0]],R[U[1]]),ee=s.b2([],R[U[2]],R[U[1]]),se=s.b3([],s.b4([],Y,ee)),le=-s.b5(se,R[U[1]]);return se.concat(le)}),B=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],G=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(let U of R)for(let Y=0;Y<3;Y++)B[Y]=Math.min(B[Y],U[Y]),G[Y]=Math.max(G[Y],U[Y]);return new lo(R,k,new cs(B,G))}}class za{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(r){this._helper.setMinZoom(r)}setMaxZoom(r){this._helper.setMaxZoom(r)}setMinPitch(r){this._helper.setMinPitch(r)}setMaxPitch(r){this._helper.setMaxPitch(r)}setRenderWorldCopies(r){this._helper.setRenderWorldCopies(r)}setBearing(r){this._helper.setBearing(r)}setPitch(r){this._helper.setPitch(r)}setRoll(r){this._helper.setRoll(r)}setFov(r){this._helper.setFov(r)}setZoom(r){this._helper.setZoom(r)}setCenter(r){this._helper.setCenter(r)}setElevation(r){this._helper.setElevation(r)}setMinElevationForCurrentTile(r){this._helper.setMinElevationForCurrentTile(r)}setPadding(r){this._helper.setPadding(r)}interpolatePadding(r,u,p){return this._helper.interpolatePadding(r,u,p)}isPaddingEqual(r){return this._helper.isPaddingEqual(r)}resize(r,u,p=!0){this._helper.resize(r,u,p)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(r){this._helper.setMaxBounds(r)}setConstrainOverride(r){this._helper.setConstrainOverride(r)}overrideNearFarZ(r,u){this._helper.overrideNearFarZ(r,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(r){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),r)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(r,u){}constructor(r){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(u,p)=>{p=s.an(+p,this.minZoom,this.maxZoom);let g={center:new s.V(u.lng,u.lat),zoom:p},E=this._helper._lngRange;if(!this._helper._renderWorldCopies&&E===null){let de=179.9999999999;E=[-de,de]}let C=this.tileSize*s.aq(g.zoom),M=0,R=C,k=0,B=C,G=0,U=0,{x:Y,y:ee}=this.size;if(this._helper._latRange){let de=this._helper._latRange;M=s.X(de[1])*C,R=s.X(de[0])*C,R-M<ee&&(G=ee/(R-M))}E&&(k=s.W(s.Y(E[0])*C,0,C),B=s.W(s.Y(E[1])*C,0,C),B<k&&(B+=C),B-k<Y&&(U=Y/(B-k)));let{x:se,y:le}=Re(C,u),ae,fe,xe=Math.max(U||0,G||0);if(xe){let de=new s.P(U?(B+k)/2:se,G?(R+M)/2:le);return g.center=Xe(C,de).wrap(),g.zoom+=s.at(xe),g}if(this._helper._latRange){let de=ee/2;le-de<M&&(fe=M+de),le+de>R&&(fe=R-de)}if(E){let de=(k+B)/2,ye=se;this._helper._renderWorldCopies&&(ye=s.W(se,de-C/2,de+C/2));let Ee=Y/2;ye-Ee<k&&(ae=k+Ee),ye+Ee>B&&(ae=B-Ee)}if(ae!==void 0||fe!==void 0){let de=new s.P(ae??se,fe??le);g.center=Xe(C,de).wrap()}return g},this.applyConstrain=(u,p)=>this._helper.applyConstrain(u,p),this._helper=new Po({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(u,p)=>this.defaultConstrain(u,p)},r),this._coveringTilesDetailsProvider=new iu}clone(){let r=new za;return r.apply(this,!1),r}apply(r,u,p){this._helper.apply(r,u,p)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(r){let u=[new s.bc(0,r)];if(this._helper._renderWorldCopies){let p=this.screenPointToMercatorCoordinate(new s.P(0,0)),g=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,0)),E=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,this._helper._height)),C=this.screenPointToMercatorCoordinate(new s.P(0,this._helper._height)),M=Math.floor(Math.min(p.x,g.x,E.x,C.x)),R=Math.floor(Math.max(p.x,g.x,E.x,C.x)),k=1;for(let B=M-k;B<=R+k;B++)B!==0&&u.push(new s.bc(B,r))}return u}getCameraFrustum(){return lo.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(r){let u=this.screenPointToLocation(this.centerPoint,r),p=r?r.getElevationForLngLatZoom(u,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(p)}setLocationAtPoint(r,u){let p=s.as(this.elevation,this.center.lat),g=this.screenPointToMercatorCoordinateAtZ(u,p),E=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,p),C=s.a9.fromLngLat(r),M=new s.a9(C.x-(g.x-E.x),C.y-(g.y-E.y));this.setCenter(M?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(r,u){return u?this.coordinatePoint(s.a9.fromLngLat(r),u.getElevationForLngLat(r,this),this._pixelMatrix3D):this.coordinatePoint(s.a9.fromLngLat(r))}screenPointToLocation(r,u){var p;return(p=this.screenPointToMercatorCoordinate(r,u))===null||p===void 0?void 0:p.toLngLat()}screenPointToMercatorCoordinate(r,u){if(u){let p=u.pointCoordinate(r);if(p!=null)return p}return this.screenPointToMercatorCoordinateAtZ(r)}screenPointToMercatorCoordinateAtZ(r,u){let p=u||0,g=[r.x,r.y,0,1],E=[r.x,r.y,1,1];s.aH(g,g,this._pixelMatrixInverse),s.aH(E,E,this._pixelMatrixInverse);let C=g[3],M=E[3],R=g[1]/C,k=E[1]/M,B=g[2]/C,G=E[2]/M,U=B===G?0:(p-B)/(G-B);return new s.a9(s.G.number(g[0]/C,E[0]/M,U)/this.worldSize,s.G.number(R,k,U)/this.worldSize,p)}coordinatePoint(r,u=0,p=this._pixelMatrix){let g=[r.x*this.worldSize,r.y*this.worldSize,u,1];return s.aH(g,g,p),new s.P(g[0]/g[3],g[1]/g[3])}getBounds(){let r=Math.max(0,this._helper._height/2-Ge(this));return new bn().extend(this.screenPointToLocation(new s.P(0,r))).extend(this.screenPointToLocation(new s.P(this._helper._width,r))).extend(this.screenPointToLocation(new s.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new s.P(0,this._helper._height)))}isPointOnMapSurface(r,u){return u?u.pointCoordinate(r)!=null:r.y>this.height/2-Ge(this)}calculatePosMatrix(r,u=!1,p){var g;let E=(g=r.key)!==null&&g!==void 0?g:s.bd(r.wrap,r.canonical.z,r.canonical.z,r.canonical.x,r.canonical.y),C=u?this._alignedPosMatrixCache:this._posMatrixCache;if(C.has(E)){let k=C.get(E);return p?k.f32:k.f64}let M=Ke(r,this.worldSize);s.S(M,u?this._alignedProjMatrix:this._viewProjMatrix,M);let R={f64:M,f32:new Float32Array(M)};return C.set(E,R),p?R.f32:R.f64}calculateFogMatrix(r){let u=r.key,p=this._fogMatrixCacheF32;if(p.has(u))return p.get(u);let g=Ke(r,this.worldSize);return s.S(g,this._fogMatrix,g),p.set(u,new Float32Array(g)),p.get(u)}calculateCenterFromCameraLngLatAlt(r,u,p,g){return this._helper.calculateCenterFromCameraLngLatAlt(r,u,p,g)}_calculateNearFarZIfNeeded(r,u,p){if(!this._helper.autoCalculateNearFarZ)return;let g=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),E=r-g*this._helper._pixelPerMeter/Math.cos(u),C=g<0?E:r,M=Math.PI/2+this.pitchInRadians,R=s.ap(this.fov)*(Math.abs(Math.cos(s.ap(this.roll)))*this.height+Math.abs(Math.sin(s.ap(this.roll)))*this.width)/this.height*(.5+p.y/this.height),k=Math.sin(R)*C/Math.sin(s.an(Math.PI-M-R,.01,Math.PI-.01)),B=Ge(this),G=Math.atan(B/this._helper.cameraToCenterDistance),U=s.ap(.75),Y=G>U?2*G*(.5+p.y/(2*B)):U,ee=Math.sin(Y)*C/Math.sin(s.an(Math.PI-M-Y,.01,Math.PI-.01)),se=Math.min(k,ee);this._helper._farZ=1.01*(Math.cos(Math.PI/2-u)*se+C),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;let r=this.centerOffset,u=Re(this.worldSize,this.center),p=u.x,g=u.y;this._helper._pixelPerMeter=s.as(1,this.center.lat)*this.worldSize;let E=s.ap(Math.min(this.pitch,Se)),C=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(E)),M;this._calculateNearFarZIfNeeded(C,E,r),M=new Float64Array(16),s.be(M,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),s.aB(this._invProjMatrix,M),M[8]=2*-r.x/this._helper._width,M[9]=2*r.y/this._helper._height,this._projectionMatrix=s.bf(M),s.Q(M,M,[1,-1,1]),s.O(M,M,[0,0,-this._helper.cameraToCenterDistance]),s.bg(M,M,-this.rollInRadians),s.bh(M,M,this.pitchInRadians),s.bg(M,M,-this.bearingInRadians),s.O(M,M,[-p,-g,0]),this._mercatorMatrix=s.Q([],M,[this.worldSize,this.worldSize,this.worldSize]),s.Q(M,M,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=s.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,M),s.O(M,M,[0,0,-this.elevation]),this._viewProjMatrix=M,this._invViewProjMatrix=s.aB([],M);let R=[0,0,-1,1];s.aH(R,R,this._invViewProjMatrix),this._cameraPosition=[R[0]/R[3],R[1]/R[3],R[2]/R[3]],this._fogMatrix=new Float64Array(16),s.be(this._fogMatrix,this.fovInRadians,this.width/this.height,C,this._helper._farZ),this._fogMatrix[8]=2*-r.x/this.width,this._fogMatrix[9]=2*r.y/this.height,s.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),s.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),s.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),s.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),s.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),s.O(this._fogMatrix,this._fogMatrix,[-p,-g,0]),s.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),s.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=s.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,M);let k=this._helper._width%2/2,B=this._helper._height%2/2,G=Math.cos(this.bearingInRadians),U=Math.sin(-this.bearingInRadians),Y=p-Math.round(p)+G*k+U*B,ee=g-Math.round(g)+G*B+U*k,se=new Float64Array(M);if(s.O(se,se,[Y>.5?Y-1:Y,ee>.5?ee-1:ee,0]),this._alignedProjMatrix=se,M=s.aB(new Float64Array(16),this._pixelMatrix),!M)throw new Error("failed to invert matrix");this._pixelMatrixInverse=M,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;let r=this.screenPointToMercatorCoordinate(new s.P(0,0)),u=[r.x*this.worldSize,r.y*this.worldSize,0,1];return s.aH(u,u,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){let r=s.as(1,this.center.lat)*this.worldSize;return Te(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/r).toLngLat()}lngLatToCameraDepth(r,u){let p=s.a9.fromLngLat(r),g=[p.x*this.worldSize,p.y*this.worldSize,u,1];return s.aH(g,g,this._viewProjMatrix),g[2]/g[3]}getProjectionData(r){let{overscaledTileID:u,aligned:p,applyTerrainMatrix:g}=r,E=this._helper.getMercatorTileCoordinates(u),C=u?this.calculatePosMatrix(u,p,!0):null,M;return M=u&&u.terrainRttPosMatrix32f&&g?u.terrainRttPosMatrix32f:C||s.bi(),{mainMatrix:M,tileMercatorCoords:E,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:M}}isLocationOccluded(r){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(r,u,p){return 1}transformLightDirection(r){return s.b1(r)}getRayDirectionFromPixel(r){throw new Error("Not implemented.")}projectTileCoordinates(r,u,p,g){let E=this.calculatePosMatrix(p),C;g?(C=[r,u,g(r,u),1],s.aH(C,C,E)):(C=[r,u,0,1],sl(C,C,E));let M=C[3];return{point:new s.P(C[0]/M,C[1]/M),signedDistanceFromCamera:M,isOccluded:!1}}populateCache(r){for(let u of r)this.calculatePosMatrix(u)}getMatrixForModel(r,u){let p=s.a9.fromLngLat(r,u),g=p.meterInMercatorCoordinateUnits(),E=s.bj();return s.O(E,E,[p.x,p.y,p.z]),s.bg(E,E,Math.PI),s.bh(E,E,Math.PI/2),s.Q(E,E,[-g,g,g]),E}getProjectionDataForCustomLayer(r=!0){let u=new s.a2(0,0,0,0,0),p=this.getProjectionData({overscaledTileID:u,applyGlobeMatrix:r}),g=Ke(u,this.worldSize);s.S(g,this._viewProjMatrix,g),p.tileMercatorCoords=[0,0,1,1];let E=[s.a5,s.a5,this.worldSize/this._helper.pixelsPerMeter],C=s.bk();return s.Q(C,g,E),p.fallbackMatrix=C,p.mainMatrix=C,p}getFastPathSimpleProjectionMatrix(r){return this.calculatePosMatrix(r)}}function us(){s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function dp(x){if(x.useSlerp)if(x.k<1){let r=s.bl(x.startEulerAngles.roll,x.startEulerAngles.pitch,x.startEulerAngles.bearing),u=s.bl(x.endEulerAngles.roll,x.endEulerAngles.pitch,x.endEulerAngles.bearing),p=new Float64Array(4);s.bm(p,r,u,x.k);let g=s.bn(p);x.tr.setRoll(g.roll),x.tr.setPitch(g.pitch),x.tr.setBearing(g.bearing)}else x.tr.setRoll(x.endEulerAngles.roll),x.tr.setPitch(x.endEulerAngles.pitch),x.tr.setBearing(x.endEulerAngles.bearing);else x.tr.setRoll(s.G.number(x.startEulerAngles.roll,x.endEulerAngles.roll,x.k)),x.tr.setPitch(s.G.number(x.startEulerAngles.pitch,x.endEulerAngles.pitch,x.k)),x.tr.setBearing(s.G.number(x.startEulerAngles.bearing,x.endEulerAngles.bearing,x.k))}function ph(x,r,u,p,g){let E=g.padding,C=Re(g.worldSize,u.getNorthWest()),M=Re(g.worldSize,u.getNorthEast()),R=Re(g.worldSize,u.getSouthEast()),k=Re(g.worldSize,u.getSouthWest()),B=s.ap(-p),G=C.rotate(B),U=M.rotate(B),Y=R.rotate(B),ee=k.rotate(B),se=new s.P(Math.max(G.x,U.x,ee.x,Y.x),Math.max(G.y,U.y,ee.y,Y.y)),le=new s.P(Math.min(G.x,U.x,ee.x,Y.x),Math.min(G.y,U.y,ee.y,Y.y)),ae=se.sub(le),fe=(g.width-(E.left+E.right+r.left+r.right))/ae.x,xe=(g.height-(E.top+E.bottom+r.top+r.bottom))/ae.y;if(xe<0||fe<0)return void us();let de=Math.min(s.at(g.scale*Math.min(fe,xe)),x.maxZoom),ye=s.P.convert(x.offset),Ee=new s.P((r.left-r.right)/2,(r.top-r.bottom)/2).rotate(s.ap(p)),_e=ye.add(Ee).mult(g.scale/s.aq(de));return{center:Xe(g.worldSize,C.add(R).div(2).sub(_e)),zoom:de,bearing:p}}class yn{get useGlobeControls(){return!1}handlePanInertia(r,u){let p=r.mag(),g=Math.abs(Ge(u));return{easingOffset:r.mult(Math.min(.75*g/p,1)),easingCenter:u.center}}handleMapControlsRollPitchBearingZoom(r,u){r.bearingDelta&&u.setBearing(u.bearing+r.bearingDelta),r.pitchDelta&&u.setPitch(u.pitch+r.pitchDelta),r.rollDelta&&u.setRoll(u.roll+r.rollDelta),r.zoomDelta&&u.setZoom(u.zoom+r.zoomDelta)}handleMapControlsPan(r,u,p){r.around.distSqr(u.centerPoint)<.01||u.setLocationAtPoint(p,r.around)}cameraForBoxAndBearing(r,u,p,g,E){return ph(r,u,p,g,E)}handleJumpToCenterZoom(r,u){r.zoom!==(u.zoom!==void 0?+u.zoom:r.zoom)&&r.setZoom(+u.zoom),u.center!==void 0&&r.setCenter(s.V.convert(u.center))}handleEaseTo(r,u){let p=r.zoom,g=r.padding,E={roll:r.roll,pitch:r.pitch,bearing:r.bearing},C={roll:u.roll===void 0?r.roll:u.roll,pitch:u.pitch===void 0?r.pitch:u.pitch,bearing:u.bearing===void 0?r.bearing:u.bearing},M=u.zoom!==void 0,R=!r.isPaddingEqual(u.padding),k=!1,B=M?+u.zoom:r.zoom,G=r.centerPoint.add(u.offsetAsPoint),U=r.screenPointToLocation(G),{center:Y,zoom:ee}=r.applyConstrain(s.V.convert(u.center||U),B??p);qo(r,Y);let se=Re(r.worldSize,U),le=Re(r.worldSize,Y).sub(se),ae=s.aq(ee-p);return k=ee!==p,{easeFunc:fe=>{if(k&&r.setZoom(s.G.number(p,ee,fe)),s.bo(E,C)||dp({startEulerAngles:E,endEulerAngles:C,tr:r,k:fe,useSlerp:E.roll!=C.roll}),R&&(r.interpolatePadding(g,u.padding,fe),G=r.centerPoint.add(u.offsetAsPoint)),u.around)r.setLocationAtPoint(u.around,u.aroundPoint);else{let xe=s.aq(r.zoom-p),de=ee>p?Math.min(2,ae):Math.max(.5,ae),ye=Math.pow(de,1-fe),Ee=Xe(r.worldSize,se.add(le.mult(fe*ye)).mult(xe));r.setLocationAtPoint(r.renderWorldCopies?Ee.wrap():Ee,G)}},isZooming:k,elevationCenter:Y}}handleFlyTo(r,u){let p=u.zoom!==void 0,g=r.zoom,E=r.applyConstrain(s.V.convert(u.center||u.locationAtOffset),p?+u.zoom:g),C=E.center,M=E.zoom;qo(r,C);let R=Re(r.worldSize,u.locationAtOffset),k=Re(r.worldSize,C).sub(R),B=k.mag(),G=s.aq(M-g),U;if(u.minZoom!==void 0){let Y=Math.min(+u.minZoom,g,M),ee=r.applyConstrain(C,Y).zoom;U=s.aq(ee-g)}return{easeFunc:(Y,ee,se,le)=>{r.setZoom(Y===1?M:g+s.at(ee));let ae=Y===1?C:Xe(r.worldSize,R.add(k.mult(se)).mult(ee));r.setLocationAtPoint(r.renderWorldCopies?ae.wrap():ae,le)},scaleOfZoom:G,targetCenter:C,scaleOfMinZoom:U,pixelPathLength:B}}}class li{constructor(r,u,p){this.blendFunction=r,this.blendColor=u,this.mask=p}}li.Replace=[1,0],li.disabled=new li(li.Replace,s.bp.transparent,[!1,!1,!1,!1]),li.unblended=new li(li.Replace,s.bp.transparent,[!0,!0,!0,!0]),li.alphaBlended=new li([1,771],s.bp.transparent,[!0,!0,!0,!0]);let Ir=2305;class mn{constructor(r,u,p){this.enable=r,this.mode=u,this.frontFace=p}}mn.disabled=new mn(!1,1029,Ir),mn.backCCW=new mn(!0,1029,Ir),mn.frontCCW=new mn(!0,1028,Ir);class rn{constructor(r,u,p){this.func=r,this.mask=u,this.range=p}}rn.ReadOnly=!1,rn.ReadWrite=!0,rn.disabled=new rn(519,rn.ReadOnly,[0,1]);let nc=7680;class An{constructor(r,u,p,g,E,C){this.test=r,this.ref=u,this.mask=p,this.fail=g,this.depthFail=E,this.pass=C}}An.disabled=new An({func:519,mask:0},0,0,nc,nc,nc);let ru=new WeakMap;function Ao(x){var r;if(ru.has(x))return ru.get(x);{let u=(r=x.getParameter(x.VERSION))===null||r===void 0?void 0:r.startsWith("WebGL 2.0");return ru.set(x,u),u}}class ic{get awaitingQuery(){return!!this._readbackQueue}constructor(r){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=r;let u=r.context,p=u.gl;this._texFormat=p.RGBA,this._texType=p.UNSIGNED_BYTE;let g=new s.aW;g.emplaceBack(-1,-1),g.emplaceBack(2,-1),g.emplaceBack(-1,2);let E=new s.aY;E.emplaceBack(0,1,2),this._fullscreenTriangle=new ri(u.createVertexBuffer(g,Es.members),u.createIndexBuffer(E),s.aX.simpleSegment(0,0,g.length,E.length)),this._resultBuffer=new Uint8Array(4),u.activeTexture.set(p.TEXTURE1);let C=p.createTexture();p.bindTexture(p.TEXTURE_2D,C),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texImage2D(p.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=u.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(C),Ao(p)&&(this._pbo=p.createBuffer(),p.bindBuffer(p.PIXEL_PACK_BUFFER,this._pbo),p.bufferData(p.PIXEL_PACK_BUFFER,4,p.STREAM_READ),p.bindBuffer(p.PIXEL_PACK_BUFFER,null))}destroy(){let r=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),r.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(r,u){let p=this._updateCount;return this._readbackQueue?p>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():p>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(r,u),this._updateCount++,this._measuredError}_bindFramebuffer(){let r=this._cachedRenderContext.context,u=r.gl;r.activeTexture.set(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,this._fbo.colorAttachment.get()),r.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(r,u){let p=this._cachedRenderContext.context,g=p.gl;if(this._bindFramebuffer(),p.viewport.set([0,0,this._texWidth,this._texHeight]),p.clear({color:s.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(p,g.TRIANGLES,rn.disabled,An.disabled,li.unblended,mn.disabled,((E,C)=>({u_input:E,u_output_expected:C}))(r,u),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Ao(g)){g.bindBuffer(g.PIXEL_PACK_BUFFER,this._pbo),g.readBuffer(g.COLOR_ATTACHMENT0),g.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),g.bindBuffer(g.PIXEL_PACK_BUFFER,null);let E=g.fenceSync(g.SYNC_GPU_COMMANDS_COMPLETE,0);g.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:E}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){let r=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Ao(r)){let u=r.clientWaitSync(this._readbackQueue.sync,0,0);if(u===r.WAIT_FAILED)return s.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(u===r.TIMEOUT_EXPIRED)return;r.bindBuffer(r.PIXEL_PACK_BUFFER,this._pbo),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),r.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=ic._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(r){let u=0;return u+=r[0]/256,u+=r[1]/65536,u+=r[2]/16777216,r[3]<127&&(u=-u),u/128}}let Ba=s.a5/128;function mh(x,r){let u=x.granularity!==void 0?Math.max(x.granularity,1):1,p=u+(x.generateBorders?2:0),g=u+(x.extendToNorthPole||x.generateBorders?1:0)+(x.extendToSouthPole||x.generateBorders?1:0),E=p+1,C=g+1,M=x.generateBorders?-1:0,R=x.generateBorders||x.extendToNorthPole?-1:0,k=u+(x.generateBorders?1:0),B=u+(x.generateBorders||x.extendToSouthPole?1:0),G=E*C,U=p*g*6,Y=E*C>65536;if(Y&&r==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");let ee=Y||r==="32bit",se=new Int16Array(2*G),le=0;for(let xe=R;xe<=B;xe++)for(let de=M;de<=k;de++){let ye=de/u*s.a5;de===-1&&(ye=-Ba),de===u+1&&(ye=s.a5+Ba);let Ee=xe/u*s.a5;xe===-1&&(Ee=x.extendToNorthPole?s.br:-Ba),xe===u+1&&(Ee=x.extendToSouthPole?s.bs:s.a5+Ba),se[le++]=ye,se[le++]=Ee}let ae=ee?new Uint32Array(U):new Uint16Array(U),fe=0;for(let xe=0;xe<g;xe++)for(let de=0;de<p;de++){let ye=de+1+xe*E,Ee=de+(xe+1)*E,_e=de+1+(xe+1)*E;ae[fe++]=de+xe*E,ae[fe++]=Ee,ae[fe++]=ye,ae[fe++]=ye,ae[fe++]=Ee,ae[fe++]=_e}return{vertices:se.buffer.slice(0),indices:ae.buffer.slice(0),uses32bitIndices:ee}}let ou=new s.aV({fill:new s.bt(128,2),line:new s.bt(512,0),tile:new s.bt(128,32),stencil:new s.bt(128,1),circle:3});class Wo{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Vn.projectionGlobe}get vertexShaderPreludeCode(){return Vn.projectionMercator.vertexSource}get subdivisionGranularity(){return ou}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(r){this._errorMeasurement||(this._errorMeasurement=new ic(r));let u=s.X(this._errorQueryLatitudeDegrees),p=2*Math.atan(Math.exp(Math.PI-u*Math.PI*2))-.5*Math.PI,g=this._errorMeasurement.updateErrorLoop(u,p),E=q();g!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=g,this._errorMeasurementLastChangeTime=E);let C=Math.min(Math.max((E-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=s.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,s.bv(C))}_getMeshKey(r){return`${r.granularity.toString(36)}_${r.generateBorders?"b":""}${r.extendToNorthPole?"n":""}${r.extendToSouthPole?"s":""}`}getMeshFromTileID(r,u,p,g,E){let C=(E==="stencil"?ou.stencil:ou.tile).getGranularityForZoomLevel(u.z);return this._getMesh(r,{granularity:C,generateBorders:p,extendToNorthPole:u.y===0&&g,extendToSouthPole:u.y===(1<<u.z)-1&&g})}_getMesh(r,u){let p=this._getMeshKey(u);if(p in this._tileMeshCache)return this._tileMeshCache[p];let g=(function(E,C){let M=mh(C,"16bit"),R=s.aW.deserialize({arrayBuffer:M.vertices,length:M.vertices.byteLength/2/2}),k=s.aY.deserialize({arrayBuffer:M.indices,length:M.indices.byteLength/2/3});return new ri(E.createVertexBuffer(R,Es.members),E.createIndexBuffer(k),s.aX.simpleSegment(0,0,R.length,k.length))})(r,u);return this._tileMeshCache[p]=g,g}recalculate(r){}hasTransition(){let r=q(),u=!1;return u=u||(r-this._errorMeasurementLastChangeTime)/1e3<.7,u=u||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,u}setErrorQueryLatitudeDegrees(r){this._errorQueryLatitudeDegrees=r}}let Jg=new s.t({type:new s.D(s.u.projection.type)});class Id extends s.E{constructor(r){super(),this._transitionable=new s.x(Jg,void 0),this.setProjection(r),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.H(0)),this._mercatorProjection=new qi,this._verticalPerspectiveProjection=new Wo}get transitionState(){let r=this.properties.get("type");if(typeof r=="string"&&r==="mercator")return 0;if(typeof r=="string"&&r==="vertical-perspective")return 1;if(r instanceof s.bw){if(r.from==="vertical-perspective"&&r.to==="mercator")return 1-r.transition;if(r.from==="mercator"&&r.to==="vertical-perspective")return r.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(r){this._mercatorProjection.updateGPUdependent(r),this._verticalPerspectiveProjection.updateGPUdependent(r)}getMeshFromTileID(r,u,p,g,E){return this.currentProjection.getMeshFromTileID(r,u,p,g,E)}setProjection(r){this._transitionable.setValue("type",r?.type||"mercator")}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}setErrorQueryLatitudeDegrees(r){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(r),this._mercatorProjection.setErrorQueryLatitudeDegrees(r)}}function Vi(x){let r=na(x.worldSize,x.center.lat);return 2*Math.PI*r}function hs(x,r,u,p,g){let E=1/(1<<g),C=r/s.a5*E+p*E,M=s.bz((x/s.a5*E+u*E)*Math.PI*2+Math.PI,2*Math.PI),R=2*Math.atan(Math.exp(Math.PI-C*Math.PI*2))-.5*Math.PI,k=Math.cos(R),B=new Float64Array(3);return B[0]=Math.sin(M)*k,B[1]=Math.sin(R),B[2]=Math.cos(M)*k,B}function mi(x){return(function(r,u){let p=Math.cos(u),g=new Float64Array(3);return g[0]=Math.sin(r)*p,g[1]=Math.sin(u),g[2]=Math.cos(r)*p,g})(x.lng*Math.PI/180,x.lat*Math.PI/180)}function na(x,r){return x/(2*Math.PI)/Math.cos(r*Math.PI/180)}function Sd(x){let r=Math.asin(x[1])/Math.PI*180,u=Math.sqrt(x[0]*x[0]+x[2]*x[2]);if(u>1e-6){let p=x[0]/u,g=Math.acos(x[2]/u),E=(p>0?g:-g)/Math.PI*180;return new s.V(s.W(E,-180,180),r)}return new s.V(0,r)}function rc(x){return Math.cos(x*Math.PI/180)}function Ci(x,r){let u=rc(x),p=rc(r);return s.at(p/u)}function fp(x,r){let u=x.rotate(r.bearingInRadians),p=r.zoom+Ci(r.center.lat,0),g=s.bu(1/rc(r.center.lat),1/rc(Math.min(Math.abs(r.center.lat),60)),s.bx(p,7,3,0,1)),E=360/Vi({worldSize:r.worldSize,center:{lat:r.center.lat}});return new s.V(r.center.lng-u.x*E*g,s.an(r.center.lat+u.y*E,-s.ao,s.ao))}function Dd(x){let r=.5*x,u=Math.sin(r),p=Math.cos(r);return Math.log(u+p)-Math.log(p-u)}function gh(x,r,u,p){let g=x.lat+u*p;if(Math.abs(u)>1){let E=(Math.sign(x.lat+u)!==Math.sign(x.lat)?-Math.abs(x.lat):Math.abs(x.lat))*Math.PI/180,C=Math.abs(x.lat+u)*Math.PI/180,M=Dd(E+p*(C-E)),R=Dd(E),k=Dd(C);return new s.V(x.lng+r*((M-R)/(k-R)),g)}return new s.V(x.lng+r*p,g)}class Qg{constructor(r){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=r}swapBuffers(){if(!this._hadAnyChanges)return;let r=this._cachePrevious;this._cachePrevious=this._cache,this._cache=r,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(r,u,p,g){let E=`${r.z}_${r.x}_${r.y}_${g?.terrain?"t":""}`,C=this._cache.get(E);if(C)return C;let M=this._cachePrevious.get(E);if(M)return this._cache.set(E,M),M;let R=this._boundingVolumeFactory(r,u,p,g);return this._cache.set(E,R),this._hadAnyChanges=!0,R}}class ul{constructor(r,u,p,g){this.min=p,this.max=g,this.points=r,this.planes=u}static fromAabb(r,u){let p=[];for(let g=0;g<8;g++)p.push([1&~g?r[0]:u[0],(g>>1&1)==1?u[1]:r[1],(g>>2&1)==1?u[2]:r[2]]);return new ul(p,[[-1,0,0,u[0]],[1,0,0,-r[0]],[0,-1,0,u[1]],[0,1,0,-r[1]],[0,0,-1,u[2]],[0,0,1,-r[2]]],r,u)}static fromCenterSizeAngles(r,u,p){let g=s.bB([],p[0],p[1],p[2]),E=s.bC([],[u[0],0,0],g),C=s.bC([],[0,u[1],0],g),M=s.bC([],[0,0,u[2]],g),R=[...r],k=[...r];for(let G=0;G<8;G++)for(let U=0;U<3;U++){let Y=r[U]+E[U]*(1&~G?-1:1)+C[U]*((G>>1&1)==1?1:-1)+M[U]*((G>>2&1)==1?1:-1);R[U]=Math.min(R[U],Y),k[U]=Math.max(k[U],Y)}let B=[];for(let G=0;G<8;G++){let U=[...r];s.b0(U,U,s.a$([],E,1&~G?-1:1)),s.b0(U,U,s.a$([],C,(G>>1&1)==1?1:-1)),s.b0(U,U,s.a$([],M,(G>>2&1)==1?1:-1)),B.push(U)}return new ul(B,[[...E,-s.b5(E,B[0])],[...C,-s.b5(C,B[0])],[...M,-s.b5(M,B[0])],[-E[0],-E[1],-E[2],-s.b5(E,B[7])],[-C[0],-C[1],-C[2],-s.b5(C,B[7])],[-M[0],-M[1],-M[2],-s.b5(M,B[7])]],R,k)}intersectsFrustum(r){let u=!0,p=this.points.length,g=this.planes.length,E=r.planes.length,C=r.points.length;for(let M=0;M<E;M++){let R=r.planes[M],k=0;for(let B=0;B<p;B++){let G=this.points[B];R[0]*G[0]+R[1]*G[1]+R[2]*G[2]+R[3]>=0&&k++}if(k===0)return 0;k<p&&(u=!1)}if(u)return 2;for(let M=0;M<g;M++){let R=this.planes[M],k=0;for(let B=0;B<C;B++){let G=r.points[B];R[0]*G[0]+R[1]*G[1]+R[2]*G[2]+R[3]>=0&&k++}if(k===0)return 0}return 1}intersectsPlane(r){let u=this.points.length,p=0;for(let g=0;g<u;g++){let E=this.points[g];r[0]*E[0]+r[1]*E[1]+r[2]*E[2]+r[3]>=0&&p++}return p===u?2:p===0?0:1}}function su(x,r,u){let p=x-r;return p<0?-p:Math.max(0,p-u)}function ia(x,r,u,p,g){let E=x-u,C;return C=E<0?Math.min(-E,1+E-g):E>1?Math.min(Math.max(E-g,0),1-E):0,Math.max(C,su(r,p,g))}class ra{constructor(){this._boundingVolumeCache=new Qg(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(r,u,p,g){let E=1<<p.z,C=1/E,M=p.x/E,R=p.y/E,k=2;return k=Math.min(k,ia(r,u,M,R,C)),k=Math.min(k,ia(r,u,M+.5,-R-C,C)),k=Math.min(k,ia(r,u,M+.5,2-R-C,C)),k}getWrap(r,u,p){let g=1<<u.z,E=1/g,C=u.x/g,M=su(r.x,C,E),R=su(r.x,C-1,E),k=su(r.x,C+1,E),B=Math.min(M,R,k);return B===k?1:B===R?-1:0}allowVariableZoom(r,u){return Dn(r,u)>4}allowWorldCopies(){return!1}getTileBoundingVolume(r,u,p,g){return this._boundingVolumeCache.getTileBoundingVolume(r,u,p,g)}_computeTileBoundingVolume(r,u,p,g){var E,C;let M=0,R=0;if(g?.terrain){let k=new s.a2(r.z,u,r.z,r.x,r.y),B=g.terrain.getMinMaxElevation(k);M=(E=B.minElevation)!==null&&E!==void 0?E:Math.min(0,p),R=(C=B.maxElevation)!==null&&C!==void 0?C:Math.max(0,p)}if(M/=s.bE,R/=s.bE,M+=1,R+=1,r.z<=0)return ul.fromAabb([-R,-R,-R],[R,R,R]);if(r.z===1)return ul.fromAabb([r.x===0?-R:0,r.y===0?0:-R,-R],[r.x===0?0:R,r.y===0?R:0,R]);{let k=[hs(0,0,r.x,r.y,r.z),hs(s.a5,0,r.x,r.y,r.z),hs(s.a5,s.a5,r.x,r.y,r.z),hs(0,s.a5,r.x,r.y,r.z)],B=[];for(let ze of k)B.push(s.a$([],ze,R));if(R!==M)for(let ze of k)B.push(s.a$([],ze,M));r.y===0&&B.push([0,1,0]),r.y===(1<<r.z)-1&&B.push([0,-1,0]);let G=[1,1,1],U=[-1,-1,-1];for(let ze of B)for(let Be=0;Be<3;Be++)G[Be]=Math.min(G[Be],ze[Be]),U[Be]=Math.max(U[Be],ze[Be]);let Y=hs(s.a5/2,s.a5/2,r.x,r.y,r.z),ee=s.b4([],[0,1,0],Y);s.b3(ee,ee);let se=s.b4([],Y,ee);s.b3(se,se);let le=s.b4([],k[2],k[1]);s.b3(le,le);let ae=s.b4([],k[0],k[3]);s.b3(ae,ae),B.push(s.a$([],Y,R)),r.y>=(1<<r.z)/2&&B.push(s.a$([],hs(s.a5/2,0,r.x,r.y,r.z),R)),r.y<(1<<r.z)/2&&B.push(s.a$([],hs(s.a5/2,s.a5,r.x,r.y,r.z),R));let fe=au(Y,B),xe=au(se,B),de=[-Y[0],-Y[1],-Y[2],fe.max],ye=[Y[0],Y[1],Y[2],-fe.min],Ee=[-se[0],-se[1],-se[2],xe.max],_e=[se[0],se[1],se[2],-xe.min],Ce=[...le,0],je=[...ae,0],Ne=[];return r.y===0?Ne.push(s.bD(je,Ce,de),s.bD(je,Ce,ye)):Ne.push(s.bD(Ee,Ce,de),s.bD(Ee,Ce,ye),s.bD(Ee,je,de),s.bD(Ee,je,ye)),r.y===(1<<r.z)-1?Ne.push(s.bD(je,Ce,de),s.bD(je,Ce,ye)):Ne.push(s.bD(_e,Ce,de),s.bD(_e,Ce,ye),s.bD(_e,je,de),s.bD(_e,je,ye)),new ul(Ne,[de,ye,Ee,_e,Ce,je],G,U)}}}function au(x,r){let u=1/0,p=-1/0;for(let g of r){let E=s.b5(x,g);u=Math.min(u,E),p=Math.max(p,E)}return{min:u,max:p}}class Ts{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(r){this._helper.setMinZoom(r)}setMaxZoom(r){this._helper.setMaxZoom(r)}setMinPitch(r){this._helper.setMinPitch(r)}setMaxPitch(r){this._helper.setMaxPitch(r)}setRenderWorldCopies(r){this._helper.setRenderWorldCopies(r)}setBearing(r){this._helper.setBearing(r)}setPitch(r){this._helper.setPitch(r)}setRoll(r){this._helper.setRoll(r)}setFov(r){this._helper.setFov(r)}setZoom(r){this._helper.setZoom(r)}setCenter(r){this._helper.setCenter(r)}setElevation(r){this._helper.setElevation(r)}setMinElevationForCurrentTile(r){this._helper.setMinElevationForCurrentTile(r)}setPadding(r){this._helper.setPadding(r)}interpolatePadding(r,u,p){return this._helper.interpolatePadding(r,u,p)}isPaddingEqual(r){return this._helper.isPaddingEqual(r)}resize(r,u){this._helper.resize(r,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(r){this._helper.setMaxBounds(r)}setConstrainOverride(r){this._helper.setConstrainOverride(r)}overrideNearFarZ(r,u){this._helper.overrideNearFarZ(r,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(r){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),r)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(r){}constructor(r){this._cachedClippingPlane=s.bF(),this._projectionMatrix=s.bj(),this._globeViewProjMatrix32f=s.bi(),this._globeViewProjMatrixNoCorrection=s.bj(),this._globeViewProjMatrixNoCorrectionInverted=s.bj(),this._globeProjMatrixInverted=s.bj(),this._cameraPosition=s.bA(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(u,p)=>{let g=s.an(u.lat,-s.ao,s.ao),E=s.an(+p,this.minZoom+Ci(0,g),this.maxZoom);return{center:new s.V(u.lng,g),zoom:E}},this.applyConstrain=(u,p)=>this._helper.applyConstrain(u,p),this._helper=new Po({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(u,p)=>this.defaultConstrain(u,p)},r),this._coveringTilesDetailsProvider=new ra}clone(){let r=new Ts;return r.apply(this,!1),r}apply(r,u,p){this._globeLatitudeErrorCorrectionRadians=p||0,this._helper.apply(r,u)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){let r=s.bA();return r[0]=this._cameraPosition[0],r[1]=this._cameraPosition[1],r[2]=this._cameraPosition[2],r}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(r){let{overscaledTileID:u,applyGlobeMatrix:p}=r,g=this._helper.getMercatorTileCoordinates(u);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:g,clippingPlane:this._cachedClippingPlane,projectionTransition:p?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(r){let u=this.pitchInRadians,p=this.cameraToCenterDistance/r,g=Math.sin(u)*p,E=Math.cos(u)*p+1,C=1/Math.sqrt(g*g+E*E)*1,M=-g,R=E,k=Math.sqrt(M*M+R*R);M/=k,R/=k;let B=[0,M,R];s.bG(B,B,[0,0,0],-this.bearingInRadians),s.bH(B,B,[0,0,0],-1*this.center.lat*Math.PI/180),s.bI(B,B,[0,0,0],this.center.lng*Math.PI/180);let G=1/s.b7(B);return s.a$(B,B,G),[...B,-C*G]}isLocationOccluded(r){return!this.isSurfacePointVisible(mi(r))}transformLightDirection(r){let u=this._helper._center.lng*Math.PI/180,p=this._helper._center.lat*Math.PI/180,g=Math.cos(p),E=[Math.sin(u)*g,Math.sin(p),Math.cos(u)*g],C=[E[2],0,-E[0]],M=[0,0,0];s.b4(M,C,E),s.b3(C,C),s.b3(M,M);let R=[0,0,0];return s.b3(R,[C[0]*r[0]+M[0]*r[1]+E[0]*r[2],C[1]*r[0]+M[1]*r[1]+E[1]*r[2],C[2]*r[0]+M[2]*r[1]+E[2]*r[2]]),R}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(r,u,p){let g=(function(M,R,k){let B=1/(1<<k.z);return new s.a9(M/s.a5*B+k.x*B,R/s.a5*B+k.y*B)})(r,u,p.canonical),E=(C=g.y,[s.bz(g.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-C*Math.PI*2))-.5*Math.PI]);var C;return this.getCircleRadiusCorrection()/Math.cos(E[1])}projectTileCoordinates(r,u,p,g){let E=p.canonical,C=hs(r,u,E.x,E.y,E.z),M=1+(g?g(r,u):0)/s.bE,R=[C[0]*M,C[1]*M,C[2]*M,1];s.aH(R,R,this._globeViewProjMatrixNoCorrection);let k=this._cachedClippingPlane,B=k[0]*C[0]+k[1]*C[1]+k[2]*C[2]+k[3]<0;return{point:new s.P(R[0]/R[3],R[1]/R[3]),signedDistanceFromCamera:R[3],isOccluded:B}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;let r=na(this.worldSize,this.center.lat),u=s.bk(),p=s.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*r),s.be(u,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);let g=this.centerOffset;u[8]=2*-g.x/this._helper._width,u[9]=2*g.y/this._helper._height,this._projectionMatrix=s.bf(u),this._globeProjMatrixInverted=s.bk(),s.aB(this._globeProjMatrixInverted,u),s.O(u,u,[0,0,-this.cameraToCenterDistance]),s.bg(u,u,this.rollInRadians),s.bh(u,u,-this.pitchInRadians),s.bg(u,u,this.bearingInRadians),s.O(u,u,[0,0,-r]);let E=s.bA();E[0]=r,E[1]=r,E[2]=r,s.bh(p,u,this.center.lat*Math.PI/180),s.bJ(p,p,-this.center.lng*Math.PI/180),s.Q(p,p,E),this._globeViewProjMatrixNoCorrection=p,s.bh(u,u,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),s.bJ(u,u,-this.center.lng*Math.PI/180),s.Q(u,u,E),this._globeViewProjMatrix32f=new Float32Array(u),this._globeViewProjMatrixNoCorrectionInverted=s.bk(),s.aB(this._globeViewProjMatrixNoCorrectionInverted,p);let C=s.bA();this._cameraPosition=s.bA(),this._cameraPosition[2]=this.cameraToCenterDistance/r,s.bG(this._cameraPosition,this._cameraPosition,C,-this.rollInRadians),s.bH(this._cameraPosition,this._cameraPosition,C,this.pitchInRadians),s.bG(this._cameraPosition,this._cameraPosition,C,-this.bearingInRadians),s.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),s.bH(this._cameraPosition,this._cameraPosition,C,-this.center.lat*Math.PI/180),s.bI(this._cameraPosition,this._cameraPosition,C,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(r);let M=s.bf(this._globeViewProjMatrixNoCorrectionInverted);s.Q(M,M,[1,1,-1]),this._cachedFrustum=lo.fromInvProjectionMatrix(M,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(r){s.w("calculateFogMatrix is not supported on globe projection.");let u=s.bk();return s.ar(u),u}getVisibleUnwrappedCoordinates(r){return[new s.bc(0,r)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(r){r&&s.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(r,u){if(!this._globeViewProjMatrixNoCorrection)return 1;let p=mi(r);s.a$(p,p,1+u/s.bE);let g=s.bF();return s.aH(g,[p[0],p[1],p[2],1],this._globeViewProjMatrixNoCorrection),g[2]/g[3]}populateCache(r){}getBounds(){let r=.5*this.width,u=.5*this.height,p=[new s.P(0,0),new s.P(r,0),new s.P(this.width,0),new s.P(this.width,u),new s.P(this.width,this.height),new s.P(r,this.height),new s.P(0,this.height),new s.P(0,u)],g=[];for(let G of p)g.push(this.unprojectScreenPoint(G));let E=0,C=0,M=0,R=0,k=this.center;for(let G of g){let U=s.bK(k.lng,G.lng),Y=s.bK(k.lat,G.lat);U<C&&(C=U),U>E&&(E=U),Y<R&&(R=Y),Y>M&&(M=Y)}let B=[k.lng+C,k.lat+R,k.lng+E,k.lat+M];return this.isSurfacePointOnScreen([0,1,0])&&(B[3]=90,B[0]=-180,B[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(B[1]=-90,B[0]=-180,B[2]=180),new bn(B)}calculateCenterFromCameraLngLatAlt(r,u,p,g){return this._helper.calculateCenterFromCameraLngLatAlt(r,u,p,g)}setLocationAtPoint(r,u){let p=mi(this.unprojectScreenPoint(u)),g=mi(r),E=s.bA();s.bL(E);let C=s.bA();s.bI(C,p,E,-this.center.lng*Math.PI/180),s.bH(C,C,E,this.center.lat*Math.PI/180);let M=g[0]*g[0]+g[2]*g[2],R=C[0]*C[0];if(M<R)return;let k=Math.sqrt(M-R),B=-k,G=s.bM(g[0],g[2],C[0],k),U=s.bM(g[0],g[2],C[0],B),Y=s.bA();s.bI(Y,g,E,-G);let ee=s.bM(Y[1],Y[2],C[1],C[2]),se=s.bA();s.bI(se,g,E,-U);let le=s.bM(se[1],se[2],C[1],C[2]),ae=.5*Math.PI,fe=ee>=-ae&&ee<=ae,xe=le>=-ae&&le<=ae,de,ye;if(fe&&xe){let je=this.center.lng*Math.PI/180,Ne=this.center.lat*Math.PI/180;s.bN(G,je)+s.bN(ee,Ne)<s.bN(U,je)+s.bN(le,Ne)?(de=G,ye=ee):(de=U,ye=le)}else if(fe)de=G,ye=ee;else{if(!xe)return;de=U,ye=le}let Ee=de/Math.PI*180,_e=ye/Math.PI*180,Ce=this.center.lat;this.setCenter(new s.V(Ee,s.an(_e,-90,90))),this.setZoom(this.zoom+Ci(Ce,this.center.lat))}locationToScreenPoint(r,u){let p=mi(r);if(u){let g=u.getElevationForLngLatZoom(r,this._helper._tileZoom);s.a$(p,p,1+g/s.bE)}return this._projectSurfacePointToScreen(p)}_projectSurfacePointToScreen(r){let u=s.bF();return s.aH(u,[...r,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],new s.P((.5*u[0]+.5)*this.width,(.5*-u[1]+.5)*this.height)}screenPointToMercatorCoordinate(r,u){if(u){let p=u.pointCoordinate(r);if(p)return p}return s.a9.fromLngLat(this.unprojectScreenPoint(r))}screenPointToLocation(r,u){var p;return(p=this.screenPointToMercatorCoordinate(r,u))===null||p===void 0?void 0:p.toLngLat()}isPointOnMapSurface(r,u){let p=this._cameraPosition,g=this.getRayDirectionFromPixel(r);return!!this.rayPlanetIntersection(p,g)}getRayDirectionFromPixel(r){let u=s.bF();u[0]=r.x/this.width*2-1,u[1]=-1*(r.y/this.height*2-1),u[2]=1,u[3]=1,s.aH(u,u,this._globeViewProjMatrixNoCorrectionInverted),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3];let p=s.bA();p[0]=u[0]-this._cameraPosition[0],p[1]=u[1]-this._cameraPosition[1],p[2]=u[2]-this._cameraPosition[2];let g=s.bA();return s.b3(g,p),g}isSurfacePointVisible(r){let u=this._cachedClippingPlane;return u[0]*r[0]+u[1]*r[1]+u[2]*r[2]+u[3]>=0}isSurfacePointOnScreen(r){if(!this.isSurfacePointVisible(r))return!1;let u=s.bF();return s.aH(u,[...r,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3],u[0]>-1&&u[0]<1&&u[1]>-1&&u[1]<1&&u[2]>-1&&u[2]<1}rayPlanetIntersection(r,u){let p=s.b5(r,u),g=s.bA(),E=s.bA();s.a$(E,u,p),s.b2(g,r,E);let C=1-s.b5(g,g);if(C<0)return null;let M=s.b5(r,r)-1,R=-p+(p<0?1:-1)*Math.sqrt(C),k=M/R,B=R;return{tMin:Math.min(k,B),tMax:Math.max(k,B)}}unprojectScreenPoint(r){let u=this._cameraPosition,p=this.getRayDirectionFromPixel(r),g=this.rayPlanetIntersection(u,p);if(g){let B=s.bA();s.b0(B,u,[p[0]*g.tMin,p[1]*g.tMin,p[2]*g.tMin]);let G=s.bA();return s.b3(G,B),Sd(G)}let E=this._cachedClippingPlane,C=E[0]*p[0]+E[1]*p[1]+E[2]*p[2],M=-s.bb(E,u)/C,R=s.bA();if(M>0)s.b0(R,u,[p[0]*M,p[1]*M,p[2]*M]);else{let B=s.bA();s.b0(B,u,[2*p[0],2*p[1],2*p[2]]);let G=s.bb(this._cachedClippingPlane,B);s.b2(R,B,[this._cachedClippingPlane[0]*G,this._cachedClippingPlane[1]*G,this._cachedClippingPlane[2]*G])}let k=(function(B){let G=s.bA();return G[0]=B[0]*-B[3],G[1]=B[1]*-B[3],G[2]=B[2]*-B[3],{center:G,radius:Math.sqrt(1-B[3]*B[3])}})(E);return Sd((function(B,G,U){let Y=s.bA();s.b2(Y,U,B);let ee=s.bA();return s.by(ee,B,Y,G/s.b9(Y)),ee})(k.center,k.radius,R))}getMatrixForModel(r,u){let p=s.V.convert(r),g=1/s.bE,E=s.bj();return s.bJ(E,E,p.lng/180*Math.PI),s.bh(E,E,-p.lat/180*Math.PI),s.O(E,E,[0,0,1+u/s.bE]),s.bh(E,E,.5*Math.PI),s.Q(E,E,[g,g,g]),E}getProjectionDataForCustomLayer(r=!0){let u=this.getProjectionData({overscaledTileID:new s.a2(0,0,0,0,0),applyGlobeMatrix:r});return u.tileMercatorCoords=[0,0,1,1],u}getFastPathSimpleProjectionMatrix(r){}}class xr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(r){this._helper.setMinZoom(r)}setMaxZoom(r){this._helper.setMaxZoom(r)}setMinPitch(r){this._helper.setMinPitch(r)}setMaxPitch(r){this._helper.setMaxPitch(r)}setRenderWorldCopies(r){this._helper.setRenderWorldCopies(r)}setBearing(r){this._helper.setBearing(r)}setPitch(r){this._helper.setPitch(r)}setRoll(r){this._helper.setRoll(r)}setFov(r){this._helper.setFov(r)}setZoom(r){this._helper.setZoom(r)}setCenter(r){this._helper.setCenter(r)}setElevation(r){this._helper.setElevation(r)}setMinElevationForCurrentTile(r){this._helper.setMinElevationForCurrentTile(r)}setPadding(r){this._helper.setPadding(r)}interpolatePadding(r,u,p){return this._helper.interpolatePadding(r,u,p)}isPaddingEqual(r){return this._helper.isPaddingEqual(r)}resize(r,u,p=!0){this._helper.resize(r,u,p)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(r){this._helper.setMaxBounds(r)}setConstrainOverride(r){this._helper.setConstrainOverride(r)}overrideNearFarZ(r,u){this._helper.overrideNearFarZ(r,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(r){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),r)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(r,u){this._globeness=r,this._globeLatitudeErrorCorrectionRadians=u,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(r){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(u,p)=>this.currentTransform.defaultConstrain(u,p),this.applyConstrain=(u,p)=>this._helper.applyConstrain(u,p),this._helper=new Po({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(u,p)=>this.defaultConstrain(u,p)},r),this._globeness=1,this._mercatorTransform=new za,this._verticalPerspectiveTransform=new Ts}clone(){let r=new xr;return r._globeness=this._globeness,r._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,r.apply(this,!1),r}apply(r,u){this._helper.apply(r,u),this._mercatorTransform.apply(this,!1),this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(r){let u=this._mercatorTransform.getProjectionData(r),p=this._verticalPerspectiveTransform.getProjectionData(r);return{mainMatrix:this.isGlobeRendering?p.mainMatrix:u.mainMatrix,clippingPlane:p.clippingPlane,tileMercatorCoords:p.tileMercatorCoords,projectionTransition:r.applyGlobeMatrix?this._globeness:0,fallbackMatrix:u.fallbackMatrix}}isLocationOccluded(r){return this.currentTransform.isLocationOccluded(r)}transformLightDirection(r){return this.currentTransform.transformLightDirection(r)}getPixelScale(){return s.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return s.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(r,u,p){let g=this._mercatorTransform.getPitchedTextCorrection(r,u,p),E=this._verticalPerspectiveTransform.getPitchedTextCorrection(r,u,p);return s.bu(g,E,this._globeness)}projectTileCoordinates(r,u,p,g){return this.currentTransform.projectTileCoordinates(r,u,p,g)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(r){return this.currentTransform.calculateFogMatrix(r)}getVisibleUnwrappedCoordinates(r){return this.currentTransform.getVisibleUnwrappedCoordinates(r)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(r){this._mercatorTransform.recalculateZoomAndCenter(r),this._verticalPerspectiveTransform.recalculateZoomAndCenter(r)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(r,u){return this.currentTransform.lngLatToCameraDepth(r,u)}populateCache(r){this._mercatorTransform.populateCache(r),this._verticalPerspectiveTransform.populateCache(r)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(r,u,p,g){return this._helper.calculateCenterFromCameraLngLatAlt(r,u,p,g)}setLocationAtPoint(r,u){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(r,u),void this.apply(this._mercatorTransform,!1);this._verticalPerspectiveTransform.setLocationAtPoint(r,u),this.apply(this._verticalPerspectiveTransform,!1)}locationToScreenPoint(r,u){return this.currentTransform.locationToScreenPoint(r,u)}screenPointToMercatorCoordinate(r,u){return this.currentTransform.screenPointToMercatorCoordinate(r,u)}screenPointToLocation(r,u){return this.currentTransform.screenPointToLocation(r,u)}isPointOnMapSurface(r,u){return this.currentTransform.isPointOnMapSurface(r,u)}getRayDirectionFromPixel(r){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(r)}getMatrixForModel(r,u){return this.currentTransform.getMatrixForModel(r,u)}getProjectionDataForCustomLayer(r=!0){let u=this._mercatorTransform.getProjectionDataForCustomLayer(r);if(!this.isGlobeRendering)return u;let p=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(r);return p.fallbackMatrix=u.mainMatrix,p}getFastPathSimpleProjectionMatrix(r){return this.currentTransform.getFastPathSimpleProjectionMatrix(r)}}class Wi{get useGlobeControls(){return!0}handlePanInertia(r,u){let p=fp(r,u);return Math.abs(p.lng-u.center.lng)>180&&(p.lng=u.center.lng+179.5*Math.sign(p.lng-u.center.lng)),{easingCenter:p,easingOffset:new s.P(0,0)}}handleMapControlsRollPitchBearingZoom(r,u){let p=r.around,g=u.screenPointToLocation(p);r.bearingDelta&&u.setBearing(u.bearing+r.bearingDelta),r.pitchDelta&&u.setPitch(u.pitch+r.pitchDelta),r.rollDelta&&u.setRoll(u.roll+r.rollDelta);let E=u.zoom;r.zoomDelta&&u.setZoom(u.zoom+r.zoomDelta);let C=u.zoom-E;if(C===0)return;let M=s.bK(u.center.lng,g.lng),R=M/(Math.abs(M/180)+1),k=s.bK(u.center.lat,g.lat),B=u.getRayDirectionFromPixel(p),G=u.cameraPosition,U=-1*s.b5(G,B),Y=s.bA();s.b0(Y,G,[B[0]*U,B[1]*U,B[2]*U]);let ee=s.b7(Y)-1,se=Math.exp(.5*-Math.max(ee-.3,0)),le=na(u.worldSize,u.center.lat)/Math.min(u.width,u.height),ae=s.bx(le,.9,.5,1,.25),fe=(1-s.aq(-C))*Math.min(se,ae),xe=u.center.lat,de=u.zoom,ye=new s.V(u.center.lng+R*fe,s.an(u.center.lat+k*fe,-s.ao,s.ao));u.setLocationAtPoint(g,p);let Ee=u.center,_e=s.bx(Math.abs(M),45,85,0,1),Ce=s.bx(le,.75,.35,0,1),je=Math.pow(Math.max(_e,Ce),.25),Ne=s.bK(Ee.lng,ye.lng),ze=s.bK(Ee.lat,ye.lat);u.setCenter(new s.V(Ee.lng+Ne*je,Ee.lat+ze*je).wrap()),u.setZoom(de+Ci(xe,u.center.lat))}handleMapControlsPan(r,u,p){if(!r.panDelta)return;let g=u.center.lat,E=u.zoom;u.setCenter(fp(r.panDelta,u).wrap()),u.setZoom(E+Ci(g,u.center.lat))}cameraForBoxAndBearing(r,u,p,g,E){let C=ph(r,u,p,g,E),M=u.left/E.width*2-1,R=(E.width-u.right)/E.width*2-1,k=u.top/E.height*-2+1,B=(E.height-u.bottom)/E.height*-2+1,G=s.bK(p.getWest(),p.getEast())<0,U=G?p.getEast():p.getWest(),Y=G?p.getWest():p.getEast(),ee=Math.max(p.getNorth(),p.getSouth()),se=Math.min(p.getNorth(),p.getSouth()),le=U+.5*s.bK(U,Y),ae=ee+.5*s.bK(ee,se),fe=E.clone();fe.setCenter(C.center),fe.setBearing(C.bearing),fe.setPitch(0),fe.setRoll(0),fe.setZoom(C.zoom);let xe=fe.modelViewProjectionMatrix,de=[mi(p.getNorthWest()),mi(p.getNorthEast()),mi(p.getSouthWest()),mi(p.getSouthEast()),mi(new s.V(Y,ae)),mi(new s.V(U,ae)),mi(new s.V(le,ee)),mi(new s.V(le,se))],ye=mi(C.center),Ee=Number.POSITIVE_INFINITY;for(let _e of de)M<0&&(Ee=Wi.getLesserNonNegativeNonNull(Ee,Wi.solveVectorScale(_e,ye,xe,"x",M))),R>0&&(Ee=Wi.getLesserNonNegativeNonNull(Ee,Wi.solveVectorScale(_e,ye,xe,"x",R))),k>0&&(Ee=Wi.getLesserNonNegativeNonNull(Ee,Wi.solveVectorScale(_e,ye,xe,"y",k))),B<0&&(Ee=Wi.getLesserNonNegativeNonNull(Ee,Wi.solveVectorScale(_e,ye,xe,"y",B)));if(Number.isFinite(Ee)&&Ee!==0)return C.zoom=fe.zoom+s.at(Ee),C;us()}handleJumpToCenterZoom(r,u){let p=r.center.lat,g=r.applyConstrain(u.center?s.V.convert(u.center):r.center,r.zoom).center;r.setCenter(g.wrap());let E=u.zoom!==void 0?+u.zoom:r.zoom+Ci(p,g.lat);r.zoom!==E&&r.setZoom(E)}handleEaseTo(r,u){let p=r.zoom,g=r.center,E=r.padding,C={roll:r.roll,pitch:r.pitch,bearing:r.bearing},M={roll:u.roll===void 0?r.roll:u.roll,pitch:u.pitch===void 0?r.pitch:u.pitch,bearing:u.bearing===void 0?r.bearing:u.bearing},R=u.zoom!==void 0,k=!r.isPaddingEqual(u.padding),B=!1,G=u.center?s.V.convert(u.center):g,U=r.applyConstrain(G,p).center;qo(r,U);let Y=r.clone();Y.setCenter(U),Y.setZoom(R?+u.zoom:p+Ci(g.lat,G.lat)),Y.setBearing(u.bearing);let ee=new s.P(s.an(r.centerPoint.x+u.offsetAsPoint.x,0,r.width),s.an(r.centerPoint.y+u.offsetAsPoint.y,0,r.height));Y.setLocationAtPoint(U,ee);let se=(u.offset&&u.offsetAsPoint.mag())>0?Y.center:U,le=R?+u.zoom:p+Ci(g.lat,se.lat),ae=p+Ci(g.lat,0),fe=le+Ci(se.lat,0),xe=s.bK(g.lng,se.lng),de=s.bK(g.lat,se.lat),ye=s.aq(fe-ae);return B=le!==p,{easeFunc:Ee=>{if(s.bo(C,M)||dp({startEulerAngles:C,endEulerAngles:M,tr:r,k:Ee,useSlerp:C.roll!=M.roll}),k&&r.interpolatePadding(E,u.padding,Ee),u.around)s.w("Easing around a point is not supported under globe projection."),r.setLocationAtPoint(u.around,u.aroundPoint);else{let _e=fe>ae?Math.min(2,ye):Math.max(.5,ye),Ce=Math.pow(_e,1-Ee),je=gh(g,xe,de,Ee*Ce);r.setCenter(je.wrap())}if(B){let _e=s.G.number(ae,fe,Ee)+Ci(0,r.center.lat);r.setZoom(_e)}},isZooming:B,elevationCenter:se}}handleFlyTo(r,u){let p=u.zoom!==void 0,g=r.center,E=r.zoom,C=r.padding,M=!r.isPaddingEqual(u.padding),R=r.applyConstrain(s.V.convert(u.center||u.locationAtOffset),E).center,k=p?+u.zoom:r.zoom+Ci(r.center.lat,R.lat),B=r.clone();B.setCenter(R),B.setZoom(k),B.setBearing(u.bearing);let G=new s.P(s.an(r.centerPoint.x+u.offsetAsPoint.x,0,r.width),s.an(r.centerPoint.y+u.offsetAsPoint.y,0,r.height));B.setLocationAtPoint(R,G);let U=B.center;qo(r,U);let Y=(function(de,ye,Ee){let _e=mi(ye),Ce=mi(Ee),je=s.b5(_e,Ce),Ne=Math.acos(je),ze=Vi(de);return Ne/(2*Math.PI)*ze})(r,g,U),ee=E+Ci(g.lat,0),se=k+Ci(U.lat,0),le=s.aq(se-ee),ae;if(typeof u.minZoom=="number"){let de=+u.minZoom+Ci(U.lat,0),ye=Math.min(de,ee,se)+Ci(0,U.lat),Ee=r.applyConstrain(U,ye).zoom+Ci(U.lat,0);ae=s.aq(Ee-ee)}let fe=s.bK(g.lng,U.lng),xe=s.bK(g.lat,U.lat);return{easeFunc:(de,ye,Ee,_e)=>{let Ce=gh(g,fe,xe,Ee);M&&r.interpolatePadding(C,u.padding,de);let je=de===1?U:Ce;r.setCenter(je.wrap());let Ne=ee+s.at(ye);r.setZoom(de===1?k:Ne+Ci(0,je.lat))},scaleOfZoom:le,targetCenter:U,scaleOfMinZoom:ae,pixelPathLength:Y}}static solveVectorScale(r,u,p,g,E){let C=g==="x"?[p[0],p[4],p[8],p[12]]:[p[1],p[5],p[9],p[13]],M=[p[3],p[7],p[11],p[15]],R=r[0]*C[0]+r[1]*C[1]+r[2]*C[2],k=r[0]*M[0]+r[1]*M[1]+r[2]*M[2],B=u[0]*C[0]+u[1]*C[1]+u[2]*C[2],G=u[0]*M[0]+u[1]*M[1]+u[2]*M[2];return B+E*k===R+E*G||M[3]*(R-B)+C[3]*(G-k)+R*G==B*k?null:(B+C[3]-E*G-E*M[3])/(B-R-E*G+E*k)}static getLesserNonNegativeNonNull(r,u){return u!==null&&u>=0&&u<r?u:r}}class Md{constructor(r){this._globe=r,this._mercatorCameraHelper=new yn,this._verticalPerspectiveCameraHelper=new Wi}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(r,u){return this.currentHelper.handlePanInertia(r,u)}handleMapControlsRollPitchBearingZoom(r,u){return this.currentHelper.handleMapControlsRollPitchBearingZoom(r,u)}handleMapControlsPan(r,u,p){this.currentHelper.handleMapControlsPan(r,u,p)}cameraForBoxAndBearing(r,u,p,g,E){return this.currentHelper.cameraForBoxAndBearing(r,u,p,g,E)}handleJumpToCenterZoom(r,u){this.currentHelper.handleJumpToCenterZoom(r,u)}handleEaseTo(r,u){return this.currentHelper.handleEaseTo(r,u)}handleFlyTo(r,u){return this.currentHelper.handleFlyTo(r,u)}}let oc=(x,r)=>s.B(x,r&&r.filter(u=>u.identifier!=="source.canvas")),hl=s.bO();class oa extends s.E{constructor(r,u={}){var p,g;super(),this._rtlPluginLoaded=()=>{for(let C in this.tileManagers){let M=this.tileManagers[C].getSource().type;M!=="vector"&&M!=="geojson"||this.tileManagers[C].reload()}},this.map=r,this.dispatcher=new Zi(Ei(),r._getMapId()),this.dispatcher.registerMessageHandler("GG",(C,M)=>this.getGlyphs(C,M)),this.dispatcher.registerMessageHandler("GI",(C,M)=>this.getImages(C,M)),this.dispatcher.registerMessageHandler("GDA",(C,M)=>this.getDashes(C,M)),this.imageManager=new pt,this.imageManager.setEventedParent(this);let E=((p=r._container)===null||p===void 0?void 0:p.lang)||typeof document<"u"&&((g=document.documentElement)===null||g===void 0?void 0:g.lang)||void 0;this.glyphManager=new yt(r._requestManager,u.localIdeographFontFamily,E),this.lineAtlas=new Qt(256,512),this.crossTileSymbolIndex=new ao,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",s.bP()),te().on(Ie,this._rtlPluginLoaded),this.on("data",C=>{if(C.dataType!=="source"||C.sourceDataType!=="metadata")return;let M=this.tileManagers[C.sourceId];if(!M)return;let R=M.getSource();if(R&&R.vectorLayerIds)for(let k in this._layers){let B=this._layers[k];B.source===R.id&&this._validateLayer(B)}})}_setInitialValues(){var r;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new s.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((r=this.crossTileSymbolIndex)===null||r===void 0?void 0:r.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(r,u){var p,g,E;this._checkLoaded();let C=u===null?(E=(g=(p=this.stylesheet.state)===null||p===void 0?void 0:p[r])===null||g===void 0?void 0:g.default)!==null&&E!==void 0?E:null:u;if(s.bR(C,this._globalState[r]))return this;this._globalState[r]=C,this._applyGlobalStateChanges([r])}getGlobalState(){return this._globalState}setGlobalState(r){this._checkLoaded();let u=[];for(let p in r)!s.bR(this._globalState[p],r[p].default)&&(u.push(p),this._globalState[p]=r[p].default);this._applyGlobalStateChanges(u)}_applyGlobalStateChanges(r){if(r.length===0)return;let u=new Set,p={};for(let g of r){p[g]=this._globalState[g];for(let E in this._layers){let C=this._layers[E],M=C.getLayoutAffectingGlobalStateRefs(),R=C.getPaintAffectingGlobalStateRefs(),k=C.getVisibilityAffectingGlobalStateRefs();if(M.has(g)&&u.add(C.source),R.has(g))for(let{name:B,value:G}of R.get(g))this._updatePaintProperty(C,B,G);k?.has(g)&&(C.recalculateVisibility(),this._updateLayer(C))}}this.dispatcher.broadcast("UGS",p);for(let g in this.tileManagers)u.has(g)&&(this._reloadSource(g),this._changed=!0)}loadURL(r,u={},p){this.fire(new s.l("dataloading",{dataType:"style"})),u.validate=typeof u.validate!="boolean"||u.validate;let g=this.map._requestManager.transformRequest(r,"Style");this._loadStyleRequest=new AbortController;let E=this._loadStyleRequest;s.j(g,this._loadStyleRequest).then(C=>{this._loadStyleRequest=null,this._load(C.data,u,p)}).catch(C=>{this._loadStyleRequest=null,C&&!E.signal.aborted&&this.fire(new s.k(C))})}loadJSON(r,u={},p){this.fire(new s.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,z.frameAsync(this._frameRequest,this.map._ownerWindow).then(()=>{this._frameRequest=null,u.validate=u.validate!==!1,this._load(r,u,p)}).catch(()=>{})}loadEmpty(){this.fire(new s.l("dataloading",{dataType:"style"})),this._load(hl,{validate:!1})}_load(r,u,p){var g,E;let C=u.transformStyle?u.transformStyle(p,r):r;if(!u.validate||!oc(this,s.C(C))){C=Object.assign({},C),this._loaded=!0,this.stylesheet=C;for(let M in C.sources)this.addSource(M,C.sources[M],{validate:!1});C.sprite?this._loadSprite(C.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(C.glyphs),this._createLayers(),this.light=new rt(this.stylesheet.light),this._setProjectionInternal(((g=this.stylesheet.projection)===null||g===void 0?void 0:g.type)||"mercator"),this.sky=new $t(this.stylesheet.sky),this.map.setTerrain((E=this.stylesheet.terrain)!==null&&E!==void 0?E:null),this.fire(new s.l("data",{dataType:"style"})),this.fire(new s.l("style.load"))}}_createLayers(){var r,u,p;let g=s.bS(this.stylesheet.layers);this.setGlobalState((r=this.stylesheet.state)!==null&&r!==void 0?r:null),this.dispatcher.broadcast("SL",g),this._order=g.map(E=>E.id),this._layers={},this._serializedLayers=null;for(let E of g){let C=s.bT(E,this._globalState);if(C.setEventedParent(this,{layer:{id:E.id}}),this._layers[E.id]=C,s.bU(C)&&this.tileManagers[C.source]){let M=(p=(u=E.paint)===null||u===void 0?void 0:u["raster-fade-duration"])!==null&&p!==void 0?p:C.paint.get("raster-fade-duration");this.tileManagers[C.source].setRasterFadeDuration(M)}}}_loadSprite(r,u=!1,p=void 0){this.imageManager.setLoaded(!1);let g=new AbortController,E;this._spriteRequest=g,(function(C,M,R,k){return s._(this,void 0,void 0,function*(){let B=ot(C),G=R>1?"@2x":"",U={},Y={};for(let{id:ee,url:se}of B){let le=M.transformRequest(st(se,G,".json"),"SpriteJSON");U[ee]=s.j(le,k);let ae=M.transformRequest(st(se,G,".png"),"SpriteImage");Y[ee]=ke.getImage(ae,k)}return yield Promise.all([...Object.values(U),...Object.values(Y)]),(function(ee,se){return s._(this,void 0,void 0,function*(){let le={};for(let ae in ee){le[ae]={};let fe=z.getImageCanvasContext((yield se[ae]).data),xe=(yield ee[ae]).data;for(let de in xe){let{width:ye,height:Ee,x:_e,y:Ce,sdf:je,pixelRatio:Ne,stretchX:ze,stretchY:Be,content:lt,textFitWidth:ct,textFitHeight:Ye}=xe[de];le[ae][de]={data:null,pixelRatio:Ne,sdf:je,stretchX:ze,stretchY:Be,content:lt,textFitWidth:ct,textFitHeight:Ye,spriteData:{width:ye,height:Ee,x:_e,y:Ce,context:fe}}}}return le})})(U,Y)})})(r,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(C=>{if(this._spriteRequest=null,C)for(let M in C){this._spritesImagesIds[M]=[];let R=this._spritesImagesIds[M]?this._spritesImagesIds[M].filter(k=>!(k in C)):[];for(let k of R)this.imageManager.removeImage(k),this._changedImages[k]=!0;for(let k in C[M]){let B=M==="default"?k:`${M}:${k}`;this._spritesImagesIds[M].push(B),B in this.imageManager.images?this.imageManager.updateImage(B,C[M][k],!1):this.imageManager.addImage(B,C[M][k]),u&&(this._changedImages[B]=!0)}}}).catch(C=>{this._spriteRequest=null,E=C,g.signal.aborted||this.fire(new s.k(E))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),u&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"})),p&&p(E)})}_unloadSprite(){for(let r of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(r),this._changedImages[r]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}_validateLayer(r){let u=this.tileManagers[r.source];if(!u)return;let p=r.sourceLayer;if(!p)return;let g=u.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(p)===-1)&&this.fire(new s.k(new Error(`Source layer "${p}" does not exist on source "${g.id}" as specified by style layer "${r.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let r in this.tileManagers)if(!this.tileManagers[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(r,u=!1){let p=this._serializedAllLayers();if(!r||r.length===0)return Object.values(u?s.bV(p):p);let g=[];for(let E of r)if(p[E]){let C=u?s.bV(p[E]):p[E];g.push(C)}return g}_serializedAllLayers(){let r=this._serializedLayers;if(r)return r;r=this._serializedLayers={};let u=Object.keys(this._layers);for(let p of u){let g=this._layers[p];g.type!=="custom"&&(r[p]=g.serialize())}return r}hasTransitions(){var r,u,p;if(!((r=this.light)===null||r===void 0)&&r.hasTransition()||!((u=this.sky)===null||u===void 0)&&u.hasTransition()||!((p=this.projection)===null||p===void 0)&&p.hasTransition())return!0;for(let g in this.tileManagers)if(this.tileManagers[g].hasTransition())return!0;for(let g in this._layers)if(this._layers[g].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(r){if(!this._loaded)return;let u=this._changed;if(u){let g=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);(g.length||E.length)&&this._updateWorkerLayers(g,E);for(let C in this._updatedSources){let M=this._updatedSources[C];if(M==="reload")this._reloadSource(C);else{if(M!=="clear")throw new Error(`Invalid action ${M}`);this._clearSource(C)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let C in this._updatedPaintProps)this._layers[C].updateTransitions(r);this.light.updateTransitions(r),this.sky.updateTransitions(r),this._resetUpdates()}let p={};for(let g in this.tileManagers){let E=this.tileManagers[g];p[g]=E.used,E.used=!1}for(let g of this._order){let E=this._layers[g];E.recalculate(r,this._availableImages),!E.isHidden(r.zoom)&&E.source&&(this.tileManagers[E.source].used=!0)}for(let g in p){let E=this.tileManagers[g];!!p[g]!=!!E.used&&E.fire(new s.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(r),this.sky.recalculate(r),this.projection.recalculate(r),this.z=r.zoom,u&&this.fire(new s.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){let r=Object.keys(this._changedImages);if(r.length){for(let u in this.tileManagers)this.tileManagers[u].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let r in this.tileManagers)this.tileManagers[r].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(r,u){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(r,!1),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(r,u={}){var p;this._checkLoaded();let g=this.serialize();if(r=u.transformStyle?u.transformStyle(g,r):r,((p=u.validate)===null||p===void 0||p)&&oc(this,s.C(r)))return!1;(r=s.bV(r)).layers=s.bS(r.layers);let E=s.bW(g,r),C=this._getOperationsToPerform(E);if(C.unimplemented.length>0)throw new Error(`Unimplemented: ${C.unimplemented.join(", ")}.`);if(C.operations.length===0)return!1;for(let M of C.operations)M();return this.stylesheet=r,this._serializedLayers=null,this.fire(new s.l("style.load",{style:this})),!0}_getOperationsToPerform(r){let u=[],p=[];for(let g of r)switch(g.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":u.push(()=>this.addLayer.apply(this,g.args));break;case"removeLayer":u.push(()=>this.removeLayer.apply(this,g.args));break;case"setPaintProperty":u.push(()=>this.setPaintProperty.apply(this,g.args));break;case"setLayoutProperty":u.push(()=>this.setLayoutProperty.apply(this,g.args));break;case"setFilter":u.push(()=>this.setFilter.apply(this,g.args));break;case"addSource":u.push(()=>this.addSource.apply(this,g.args));break;case"removeSource":u.push(()=>this.removeSource.apply(this,g.args));break;case"setLayerZoomRange":u.push(()=>this.setLayerZoomRange.apply(this,g.args));break;case"setLight":u.push(()=>this.setLight.apply(this,g.args));break;case"setGeoJSONSourceData":u.push(()=>this.setGeoJSONSourceData.apply(this,g.args));break;case"setGlyphs":u.push(()=>this.setGlyphs.apply(this,g.args));break;case"setSprite":u.push(()=>this.setSprite.apply(this,g.args));break;case"setTerrain":u.push(()=>this.map.setTerrain.apply(this,g.args));break;case"setSky":u.push(()=>this.setSky.apply(this,g.args));break;case"setProjection":this.setProjection.apply(this,g.args);break;case"setGlobalState":u.push(()=>this.setGlobalState.apply(this,g.args));break;case"setTransition":u.push(()=>{});break;default:p.push(g.command)}return{operations:u,unimplemented:p}}addImage(r,u){if(this.getImage(r))return this.fire(new s.k(new Error(`An image named "${r}" already exists.`)));this.imageManager.addImage(r,u),this._afterImageUpdated(r)}updateImage(r,u){this.imageManager.updateImage(r,u)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new s.k(new Error(`An image named "${r}" does not exist.`)));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,u,p={}){if(this._checkLoaded(),this.tileManagers[r]!==void 0)throw new Error(`Source "${r}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(s.C.source,`sources.${r}`,u,null,p))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);let g=this.tileManagers[r]=new Mi(r,u,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:r})),g.onAdd(this.map),this._changed=!0}removeSource(r){if(this._checkLoaded(),this.tileManagers[r]===void 0)throw new Error("There is no source with this ID");for(let p in this._layers)if(this._layers[p].source===r)return this.fire(new s.k(new Error(`Source "${r}" cannot be removed while layer "${p}" is using it.`)));let u=this.tileManagers[r];delete this.tileManagers[r],delete this._updatedSources[r],u.fire(new s.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:r})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,u){if(this._checkLoaded(),this.tileManagers[r]===void 0)throw new Error(`There is no source with this ID=${r}`);let p=this.tileManagers[r].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(u),this._changed=!0}getSource(r){return this.tileManagers[r]&&this.tileManagers[r].getSource()}addLayer(r,u,p={}){this._checkLoaded();let g=r.id;if(this.getLayer(g))return void this.fire(new s.k(new Error(`Layer "${g}" already exists on this map.`)));let E;if(r.type==="custom"){if(oc(this,s.bX(r)))return;E=s.bT(r,this._globalState)}else{if("source"in r&&typeof r.source=="object"&&(this.addSource(g,r.source),r=s.bV(r),r=s.e(r,{source:g})),this._validate(s.C.layer,`layers.${g}`,r,{arrayIndex:-1},p))return;E=s.bT(r,this._globalState),this._validateLayer(E),E.setEventedParent(this,{layer:{id:g}})}let C=u?this._order.indexOf(u):this._order.length;if(u&&C===-1)this.fire(new s.k(new Error(`Cannot add layer "${g}" before non-existing layer "${u}".`)));else{if(this._order.splice(C,0,g),this._layerOrderChanged=!0,this._layers[g]=E,this._removedLayers[g]&&E.source&&E.type!=="custom"){let M=this._removedLayers[g];delete this._removedLayers[g],M.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",this.tileManagers[E.source].pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map)}}moveLayer(r,u){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new s.k(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===u)return;let p=this._order.indexOf(r);this._order.splice(p,1);let g=u?this._order.indexOf(u):this._order.length;u&&g===-1?this.fire(new s.k(new Error(`Cannot move layer "${r}" before non-existing layer "${u}".`))):(this._order.splice(g,0,r),this._layerOrderChanged=!0)}removeLayer(r){this._checkLoaded();let u=this._layers[r];if(!u)return void this.fire(new s.k(new Error(`Cannot remove non-existing layer "${r}".`)));u.setEventedParent(null);let p=this._order.indexOf(r);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=u,delete this._layers[r],this._serializedLayers&&delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],u.onRemove&&u.onRemove(this.map)}getLayer(r){return this._layers[r]}getLayersOrder(){return[...this._order]}hasLayer(r){return r in this._layers}setLayerZoomRange(r,u,p){this._checkLoaded();let g=this.getLayer(r);g?g.minzoom===u&&g.maxzoom===p||(u!=null&&(g.minzoom=u),p!=null&&(g.maxzoom=p),this._updateLayer(g)):this.fire(new s.k(new Error(`Cannot set the zoom range of non-existing layer "${r}".`)))}setFilter(r,u,p={}){this._checkLoaded();let g=this.getLayer(r);if(g){if(!s.bR(g.filter,u))return u==null?(g.setFilter(void 0),void this._updateLayer(g)):void(this._validate(s.C.filter,`layers.${g.id}.filter`,u,null,p)||(g.setFilter(s.bV(u)),this._updateLayer(g)))}else this.fire(new s.k(new Error(`Cannot filter non-existing layer "${r}".`)))}getFilter(r){return s.bV(this.getLayer(r).filter)}setLayoutProperty(r,u,p,g={}){this._checkLoaded();let E=this.getLayer(r);E?s.bR(E.getLayoutProperty(u),p)||(E.setLayoutProperty(u,p,g),this._updateLayer(E)):this.fire(new s.k(new Error(`Cannot style non-existing layer "${r}".`)))}getLayoutProperty(r,u){let p=this.getLayer(r);if(p)return p.getLayoutProperty(u);this.fire(new s.k(new Error(`Cannot get style of non-existing layer "${r}".`)))}setPaintProperty(r,u,p,g={}){this._checkLoaded();let E=this.getLayer(r);E?s.bR(E.getPaintProperty(u),p)||this._updatePaintProperty(E,u,p,g):this.fire(new s.k(new Error(`Cannot style non-existing layer "${r}".`)))}_updatePaintProperty(r,u,p,g={}){r.setPaintProperty(u,p,g)&&this._updateLayer(r),s.bU(r)&&u==="raster-fade-duration"&&this.tileManagers[r.source].setRasterFadeDuration(p),this._changed=!0,this._updatedPaintProps[r.id]=!0,this._serializedLayers=null}getPaintProperty(r,u){return this.getLayer(r).getPaintProperty(u)}setFeatureState(r,u){this._checkLoaded();let p=r.source,g=r.sourceLayer,E=this.tileManagers[p];if(E===void 0)return void this.fire(new s.k(new Error(`The source '${p}' does not exist in the map's style.`)));let C=E.getSource().type;C==="geojson"&&g?this.fire(new s.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):C!=="vector"||g?(r.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),E.setFeatureState(g,r.id,u)):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(r,u){this._checkLoaded();let p=r.source,g=this.tileManagers[p];if(g===void 0)return void this.fire(new s.k(new Error(`The source '${p}' does not exist in the map's style.`)));let E=g.getSource().type,C=E==="vector"?r.sourceLayer:void 0;E!=="vector"||C?u&&typeof r.id!="string"&&typeof r.id!="number"?this.fire(new s.k(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(C,r.id,u):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(r){this._checkLoaded();let u=r.source,p=r.sourceLayer,g=this.tileManagers[u];if(g!==void 0)return g.getSource().type!=="vector"||p?(r.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),g.getFeatureState(p,r.id)):void this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.k(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let r=s.bY(this.tileManagers,E=>E.serialize()),u=this._serializeByIds(this._order,!0),p=this.map.getTerrain()||void 0,g=this.stylesheet;return s.bZ({version:g.version,name:g.name,metadata:g.metadata,light:g.light,sky:g.sky,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,projection:g.projection,sources:r,layers:u,terrain:p},E=>E!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0,r.source&&!this._updatedSources[r.source]&&this.tileManagers[r.source].getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",this.tileManagers[r.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(r){let u=C=>this._layers[C].type==="fill-extrusion",p={},g=[];for(let C=this._order.length-1;C>=0;C--){let M=this._order[C];if(u(M)){p[M]=C;for(let R of r){let k=R[M];if(k)for(let B of k)g.push(B)}}}g.sort((C,M)=>M.intersectionZ-C.intersectionZ);let E=[];for(let C=this._order.length-1;C>=0;C--){let M=this._order[C];if(u(M))for(let R=g.length-1;R>=0;R--){let k=g[R].feature;if(p[k.layer.id]<C)break;E.push(k),g.pop()}else for(let R of r){let k=R[M];if(k)for(let B of k)E.push(B.feature)}}return E}queryRenderedFeatures(r,u,p){u&&u.filter&&this._validate(s.C.filter,"queryRenderedFeatures.filter",u.filter,null,u);let g={};if(u&&u.layers){if(!(Array.isArray(u.layers)||u.layers instanceof Set))return this.fire(new s.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(let k of u.layers){let B=this._layers[k];if(!B)return this.fire(new s.k(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];g[B.source]=!0}}let E=[];u.availableImages=this._availableImages;let C=this._serializedAllLayers(),M=u.layers instanceof Set?u.layers:Array.isArray(u.layers)?new Set(u.layers):null,R=Object.assign(Object.assign({},u),{layers:M,globalState:this._globalState});for(let k in this.tileManagers)u.layers&&!g[k]||E.push(ss(this.tileManagers[k],this._layers,C,r,R,p,this.map.terrain?(B,G,U)=>this.map.terrain.getElevation(B,G,U):void 0));return this.placement&&E.push((function(k,B,G,U,Y,ee,se){let le={},ae=ee.queryRenderedSymbols(U),fe=[];for(let xe of Object.keys(ae).map(Number))fe.push(se[xe]);fe.sort(zi);for(let xe of fe){let de=xe.featureIndex.lookupSymbolFeatures(ae[xe.bucketInstanceId],B,xe.bucketIndex,xe.sourceLayerIndex,{filterSpec:Y.filter,globalState:Y.globalState},Y.layers,Y.availableImages,k);for(let ye in de){let Ee=le[ye]=le[ye]||[],_e=de[ye];_e.sort((Ce,je)=>{let Ne=xe.featureSortOrder;if(Ne){let ze=Ne.indexOf(Ce.featureIndex);return Ne.indexOf(je.featureIndex)-ze}return je.featureIndex-Ce.featureIndex});for(let Ce of _e)Ee.push(Ce)}}return(function(xe,de,ye){for(let Ee in xe)for(let _e of xe[Ee])ir(_e,ye[de[Ee].source]);return xe})(le,k,G)})(this._layers,C,this.tileManagers,r,R,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(E)}querySourceFeatures(r,u){u?.filter&&this._validate(s.C.filter,"querySourceFeatures.filter",u.filter,null,u);let p=this.tileManagers[r];return p?(function(g,E){let C=g.getRenderableIds().map(k=>g.getTileByID(k)),M=[],R={};for(let k=0;k<C.length;k++){let B=C[k],G=B.tileID.canonical.key;R[G]||(R[G]=!0,B.querySourceFeatures(M,E))}return M})(p,u?Object.assign(Object.assign({},u),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(r,u={}){this._checkLoaded();let p=this.light.getLight(),g=!1;for(let C in r)if(!s.bR(r[C],p[C])){g=!0;break}if(!g)return;let E={now:q(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,u),this.light.updateTransitions(E)}getProjection(){var r;return(r=this.stylesheet)===null||r===void 0?void 0:r.projection}setProjection(r){if(this._checkLoaded(),this.projection){if(this.projection.name===r.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=r,this._setProjectionInternal(r.type)}getSky(){var r;return(r=this.stylesheet)===null||r===void 0?void 0:r.sky}setSky(r,u={}){this._checkLoaded();let p=this.getSky(),g=!1;if(!r&&!p)return;if(r&&!p)g=!0;else if(!r&&p)g=!0;else for(let C in r)if(!s.bR(r[C],p[C])){g=!0;break}if(!g)return;let E={now:q(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=r,this.sky.setSky(r,u),this.sky.updateTransitions(E)}_setProjectionInternal(r){let u=(function(p,g){let E={constrainOverride:g};if(Array.isArray(p)){let C=new Id({type:p});return{projection:C,transform:new xr(E),cameraHelper:new Md(C)}}switch(p){case"mercator":return{projection:new qi,transform:new za(E),cameraHelper:new yn};case"globe":{let C=new Id({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:C,transform:new xr(E),cameraHelper:new Md(C)}}case"vertical-perspective":return{projection:new Wo,transform:new Ts(E),cameraHelper:new Wi};default:return s.w(`Unknown projection name: ${p}. Falling back to mercator projection.`),{projection:new qi,transform:new za(E),cameraHelper:new yn}}})(r,this.map.transformConstrain);this.projection=u.projection,this.map.migrateProjection(u.transform,u.cameraHelper);for(let p in this.tileManagers)this.tileManagers[p].reload()}_validate(r,u,p,g,E={}){return(!E||E.validate!==!1)&&oc(this,r.call(s.C,s.e({key:u,style:this.serialize(),value:p,styleSpec:s.u},g)))}_remove(r=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),te().off(Ie,this._rtlPluginLoaded);for(let u in this._layers)this._layers[u].setEventedParent(null);for(let u in this.tileManagers){let p=this.tileManagers[u];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),r&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(r)}_clearSource(r){this.tileManagers[r].clearTiles()}_reloadSource(r){this.tileManagers[r].resume(),this.tileManagers[r].reload()}_updateSources(r){for(let u in this.tileManagers)this.tileManagers[u].update(r,this.map.terrain)}_generateCollisionBoxes(){for(let r in this.tileManagers)this._reloadSource(r)}_updatePlacement(r,u,p,g,E=!1){let C=!1,M=!1,R={};for(let k of this._order){let B=this._layers[k];if(B.type!=="symbol")continue;if(!R[B.source]){let U=this.tileManagers[B.source];R[B.source]=U.getRenderableIds(!0).map(Y=>U.getTileByID(Y)).sort((Y,ee)=>ee.tileID.overscaledZ-Y.tileID.overscaledZ||(Y.tileID.isLessThan(ee.tileID)?-1:1))}let G=this.crossTileSymbolIndex.addLayer(B,R[B.source],r.center.lng);C=C||G}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((E=E||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(q(),r.zoom))&&(this.pauseablePlacement=new Fa(r,this.map.terrain,this._order,E,u,p,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,R),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(q()),M=!0),C&&this.pauseablePlacement.placement.setStale()),M||C)for(let k of this._order){let B=this._layers[k];B.type==="symbol"&&this.placement.updateLayerOpacities(B,R[B.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(q())}_releaseSymbolFadeTiles(){for(let r in this.tileManagers)this.tileManagers[r].releaseSymbolFadeTiles()}getImages(r,u){return s._(this,void 0,void 0,function*(){let p=yield this.imageManager.getImages(u.icons);this._updateTilesForChangedImages();let g=this.tileManagers[u.source];return g&&g.setDependencies(u.tileID.key,u.type,u.icons),p})}getGlyphs(r,u){return s._(this,void 0,void 0,function*(){let p=yield this.glyphManager.getGlyphs(u.stacks),g=this.tileManagers[u.source];return g&&g.setDependencies(u.tileID.key,u.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(r,u={}){this._checkLoaded(),r&&this._validate(s.C.glyphs,"glyphs",r,null,u)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=r,this.glyphManager.entries={},this.glyphManager.setURL(r))}getDashes(r,u){return s._(this,void 0,void 0,function*(){let p={};for(let[g,E]of Object.entries(u.dashes))p[g]=this.lineAtlas.getDash(E.dasharray,E.round);return p})}addSprite(r,u,p={},g){this._checkLoaded();let E=[{id:r,url:u}],C=[...ot(this.stylesheet.sprite),...E];this._validate(s.C.sprite,"sprite",C,null,p)||(this.stylesheet.sprite=C,this._loadSprite(E,!0,g))}removeSprite(r){this._checkLoaded();let u=ot(this.stylesheet.sprite);if(u.find(p=>p.id===r)){if(this._spritesImagesIds[r])for(let p of this._spritesImagesIds[r])this.imageManager.removeImage(p),this._changedImages[p]=!0;u.splice(u.findIndex(p=>p.id===r),1),this.stylesheet.sprite=u.length>0?u:void 0,delete this._spritesImagesIds[r],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}else this.fire(new s.k(new Error(`Sprite "${r}" doesn't exists on this map.`)))}getSprite(){return ot(this.stylesheet.sprite)}setSprite(r,u={},p){this._checkLoaded(),r&&this._validate(s.C.sprite,"sprite",r,null,u)||(this.stylesheet.sprite=r,r?this._loadSprite(r,!0,p):(this._unloadSprite(),p&&p(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(let r in this.tileManagers){let u=this.tileManagers[r];u.setEventedParent(null),u.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(let r in this._layers){let u=this._layers[r];u.setEventedParent(null),u.onRemove&&u.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var e_=s.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class _h{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,u,p,g,E,C,M,R,k){this.context=r;let B=this.boundPaintVertexBuffers.length!==g.length;for(let G=0;!B&&G<g.length;G++)this.boundPaintVertexBuffers[G]!==g[G]&&(B=!0);!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==p||B||this.boundIndexBuffer!==E||this.boundVertexOffset!==C||this.boundDynamicVertexBuffer!==M||this.boundDynamicVertexBuffer2!==R||this.boundDynamicVertexBuffer3!==k?this.freshBind(u,p,g,E,C,M,R,k):(r.bindVertexArray.set(this.vao),M&&M.bind(),E&&E.dynamicDraw&&E.bind(),R&&R.bind(),k&&k.bind())}freshBind(r,u,p,g,E,C,M,R){let k=r.numAttributes,B=this.context,G=B.gl;this.vao&&this.destroy(),this.vao=B.createVertexArray(),B.bindVertexArray.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=g,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=R,u.enableAttributes(G,r);for(let U of p)U.enableAttributes(G,r);C&&C.enableAttributes(G,r),M&&M.enableAttributes(G,r),R&&R.enableAttributes(G,r),u.bind(),u.setVertexAttribPointers(G,r,E);for(let U of p)U.bind(),U.setVertexAttribPointers(G,r,E);C&&(C.bind(),C.setVertexAttribPointers(G,r,E)),g&&g.bind(),M&&(M.bind(),M.setVertexAttribPointers(G,r,E)),R&&(R.bind(),R.setVertexAttribPointers(G,r,E)),B.currentNumAttributes=k}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}let pp=(x,r,u,p,g)=>({u_texture:0,u_ele_delta:x,u_fog_matrix:r,u_fog_color:u?u.properties.get("fog-color"):s.bp.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:g?0:u?u.calculateFogBlendOpacity(p):0,u_horizon_color:u?u.properties.get("horizon-color"):s.bp.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1,u_is_globe_mode:g?1:0}),sc={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function co(x){let r=[];for(let u=0;u<x.length;u++){if(x[u]===null)continue;let p=x[u].split(" ");r.push(p.pop())}return r}class dl{constructor(r,u,p,g,E,C,M,R,k=[]){let B=r.gl;this.program=B.createProgram();let G=co(u.staticAttributes),U=p?p.getBinderAttributes():[],Y=G.concat(U),ee=Vn.prelude.staticUniforms?co(Vn.prelude.staticUniforms):[],se=M.staticUniforms?co(M.staticUniforms):[],le=u.staticUniforms?co(u.staticUniforms):[],ae=p?p.getBinderUniforms():[],fe=ee.concat(se).concat(le).concat(ae),xe=[];for(let Ne of fe)xe.indexOf(Ne)<0&&xe.push(Ne);let de=p?p.defines():[];Ao(B)&&de.unshift("#version 300 es"),E&&de.push("#define OVERDRAW_INSPECTOR;"),C&&de.push("#define TERRAIN3D;"),R&&de.push(R),k&&de.push(...k);let ye=de.concat(Vn.prelude.fragmentSource,M.fragmentSource,u.fragmentSource).join(`
`),Ee=de.concat(Vn.prelude.vertexSource,M.vertexSource,u.vertexSource).join(`
`);Ao(B)||(ye=(function(Ne){return Ne.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(ye),Ee=(function(Ne){return Ne.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Ee));let _e=B.createShader(B.FRAGMENT_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(_e,ye),B.compileShader(_e),!B.getShaderParameter(_e,B.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${B.getShaderInfoLog(_e)}`);B.attachShader(this.program,_e);let Ce=B.createShader(B.VERTEX_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(Ce,Ee),B.compileShader(Ce),!B.getShaderParameter(Ce,B.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${B.getShaderInfoLog(Ce)}`);B.attachShader(this.program,Ce),this.attributes={};let je={};this.numAttributes=Y.length;for(let Ne=0;Ne<this.numAttributes;Ne++)Y[Ne]&&(B.bindAttribLocation(this.program,Ne,Y[Ne]),this.attributes[Y[Ne]]=Ne);if(B.linkProgram(this.program),!B.getProgramParameter(this.program,B.LINK_STATUS))throw new Error(`Program failed to link: ${B.getProgramInfoLog(this.program)}`);B.deleteShader(Ce),B.deleteShader(_e);for(let Ne=0;Ne<xe.length;Ne++){let ze=xe[Ne];if(ze&&!je[ze]){let Be=B.getUniformLocation(this.program,ze);Be&&(je[ze]=Be)}}this.fixedUniforms=g(r,je),this.terrainUniforms=((Ne,ze)=>({u_depth:new s.b_(Ne,ze.u_depth),u_terrain:new s.b_(Ne,ze.u_terrain),u_terrain_dim:new s.bq(Ne,ze.u_terrain_dim),u_terrain_matrix:new s.c0(Ne,ze.u_terrain_matrix),u_terrain_unpack:new s.c1(Ne,ze.u_terrain_unpack),u_terrain_exaggeration:new s.bq(Ne,ze.u_terrain_exaggeration)}))(r,je),this.projectionUniforms=((Ne,ze)=>({u_projection_matrix:new s.c0(Ne,ze.u_projection_matrix),u_projection_tile_mercator_coords:new s.c1(Ne,ze.u_projection_tile_mercator_coords),u_projection_clipping_plane:new s.c1(Ne,ze.u_projection_clipping_plane),u_projection_transition:new s.bq(Ne,ze.u_projection_transition),u_projection_fallback_matrix:new s.c0(Ne,ze.u_projection_fallback_matrix)}))(r,je),this.binderUniforms=p?p.getUniforms(r,je):[]}draw(r,u,p,g,E,C,M,R,k,B,G,U,Y,ee,se,le,ae,fe,xe){let de=r.gl;if(this.failedToCreate)return;if(r.program.set(this.program),r.setDepthMode(p),r.setStencilMode(g),r.setColorMode(E),r.setCullFace(C),R){r.activeTexture.set(de.TEXTURE2),de.bindTexture(de.TEXTURE_2D,R.depthTexture),r.activeTexture.set(de.TEXTURE3),de.bindTexture(de.TEXTURE_2D,R.texture);for(let Ee in this.terrainUniforms)this.terrainUniforms[Ee].set(R[Ee])}if(k)for(let Ee in k)this.projectionUniforms[sc[Ee]].set(k[Ee]);if(M)for(let Ee in this.fixedUniforms)this.fixedUniforms[Ee].set(M[Ee]);le&&le.setUniforms(r,this.binderUniforms,ee,{zoom:se});let ye=0;switch(u){case de.LINES:ye=2;break;case de.TRIANGLES:ye=3;break;case de.LINE_STRIP:ye=1}for(let Ee of Y.get()){let _e=Ee.vaos||(Ee.vaos={});(_e[B]||(_e[B]=new _h)).bind(r,this,G,le?le.getPaintVertexBuffers():[],U,Ee.vertexOffset,ae,fe,xe),de.drawElements(u,Ee.primitiveLength*ye,de.UNSIGNED_SHORT,Ee.primitiveOffset*ye*2)}}}function mp(x,r,u){let p=1/s.aN(u,1,r.transform.tileZoom),g=Math.pow(2,u.tileID.overscaledZ),E=u.tileSize*Math.pow(2,r.transform.tileZoom)/g,C=E*(u.tileID.canonical.x+u.tileID.wrap*g),M=E*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[p,x.fromScale,x.toScale],u_fade:x.t,u_pixel_coord_upper:[C>>16,M>>16],u_pixel_coord_lower:[65535&C,65535&M]}}let ds=(x,r,u,p)=>{let g=x.style.light,E=g.properties.get("position"),C=[E.x,E.y,E.z],M=s.c4();g.properties.get("anchor")==="viewport"&&s.c5(M,x.transform.bearingInRadians),s.c6(C,C,M);let R=x.transform.transformLightDirection(C),k=g.properties.get("color");return{u_lightpos:C,u_lightpos_globe:R,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+r,u_opacity:u,u_fill_translate:p}},Pd=(x,r,u,p,g,E,C)=>s.e(ds(x,r,u,p),mp(E,x,C),{u_height_factor:-Math.pow(2,g.overscaledZ)/C.tileSize/8}),ja=(x,r,u,p)=>s.e(mp(r,x,u),{u_fill_translate:p}),gp=(x,r)=>({u_world:x,u_fill_translate:r}),ac=(x,r,u,p,g)=>s.e(ja(x,r,u,g),{u_world:p}),Ad=(x,r,u,p,g)=>{let E=x.transform,C,M,R=0;if(u.paint.get("circle-pitch-alignment")==="map"){let k=s.aN(r,1,E.zoom);C=!0,M=[k,k],R=k/(s.a5*Math.pow(2,r.tileID.overscaledZ))*2*Math.PI*g}else C=!1,M=E.pixelsToGLUnits;return{u_camera_to_center_distance:E.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+C,u_device_pixel_ratio:x.pixelRatio,u_extrude_scale:M,u_globe_extrude_scale:R,u_translate:p}},Cs=x=>({u_pixel_extrude_scale:[1/x.width,1/x.height]}),_p=x=>({u_viewport_size:[x.width,x.height]}),Is=(x,r=1)=>({u_color:x,u_overlay:0,u_overlay_scale:r}),sa=(x,r,u,p)=>{let g=s.aN(x,1,r)/(s.a5*Math.pow(2,x.tileID.overscaledZ))*2*Math.PI*p;return{u_extrude_scale:s.aN(x,1,r),u_intensity:u,u_globe_extrude_scale:g}},yp=(x,r,u,p)=>{let g=s.N();s.c7(g,0,x.width,x.height,0,0,1);let E=x.context.gl;return{u_matrix:g,u_world:[E.drawingBufferWidth,E.drawingBufferHeight],u_image:u,u_color_ramp:p,u_opacity:r.paint.get("heatmap-opacity")}},lc=(x,r,u)=>{let p=u.paint.get("hillshade-accent-color"),g;switch(u.paint.get("hillshade-method")){case"basic":g=4;break;case"combined":g=1;break;case"igor":g=2;break;case"multidirectional":g=3;break;default:g=0}let E=u.getIlluminationProperties();for(let C=0;C<E.directionRadians.length;C++)u.paint.get("hillshade-illumination-anchor")==="viewport"&&(E.directionRadians[C]+=x.transform.bearingInRadians);return{u_image:0,u_latrange:aa(0,r.tileID),u_exaggeration:u.paint.get("hillshade-exaggeration"),u_altitudes:E.altitudeRadians,u_azimuths:E.directionRadians,u_accent:p,u_method:g,u_highlights:E.highlightColor,u_shadows:E.shadowColor}},t_=(x,r)=>{let u=r.stride,p=s.N();return s.c7(p,0,s.a5,-s.a5,0,0,1),s.O(p,p,[0,-s.a5,0]),{u_matrix:p,u_image:1,u_dimension:[u,u],u_zoom:x.overscaledZ,u_unpack:r.getUnpackVector()}};function aa(x,r){let u=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new s.a9(0,p/u).toLngLat().lat,new s.a9(0,(p+1)/u).toLngLat().lat]}let vp=(x,r,u=0)=>({u_image:0,u_unpack:r.getUnpackVector(),u_dimension:[r.stride,r.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:u,u_opacity:x.paint.get("color-relief-opacity")}),Ss=(x,r,u,p)=>{let g=x.transform;return{u_translation:fl(x,r,u),u_ratio:p/s.aN(r,1,g.zoom),u_device_pixel_ratio:x.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},xp=(x,r,u,p,g)=>s.e(Ss(x,r,u,p),{u_image:0,u_image_height:g}),fs=(x,r,u,p,g)=>{let E=x.transform,C=Ro(r,E);return{u_translation:fl(x,r,u),u_texsize:r.imageAtlasTexture.size,u_ratio:p/s.aN(r,1,E.zoom),u_device_pixel_ratio:x.pixelRatio,u_image:0,u_scale:[C,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},lu=(x,r,u,p,g)=>{let E=Ro(r,x.transform);return s.e(Ss(x,r,u,p),{u_tileratio:E,u_crossfade_from:g.fromScale,u_crossfade_to:g.toScale,u_image:0,u_mix:g.t,u_lineatlas_width:x.lineAtlas.width,u_lineatlas_height:x.lineAtlas.height})},cu=(x,r,u,p,g,E)=>{let C=Ro(r,x.transform);return s.e(Ss(x,r,u,p),{u_image:0,u_image_height:E,u_tileratio:C,u_crossfade_from:g.fromScale,u_crossfade_to:g.toScale,u_image_dash:1,u_mix:g.t,u_lineatlas_width:x.lineAtlas.width,u_lineatlas_height:x.lineAtlas.height})};function Ro(x,r){return 1/s.aN(x,1,r.tileZoom)}function fl(x,r,u){return s.aO(x.transform,r,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}let uu=(x,r,u,p,g)=>{return{u_tl_parent:x,u_scale_parent:r,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(C=p.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(E=p.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:cc(p.paint.get("raster-hue-rotate")),u_coords_top:[g[0].x,g[0].y,g[1].x,g[1].y],u_coords_bottom:[g[3].x,g[3].y,g[2].x,g[2].y]};var E,C};function cc(x){x*=Math.PI/180;let r=Math.sin(x),u=Math.cos(x);return[(2*u+1)/3,(-Math.sqrt(3)*r-u+1)/3,(Math.sqrt(3)*r-u+1)/3]}let Va=(x,r,u,p,g,E,C,M,R,k,B,G,U)=>{let Y=C.transform;return{u_is_size_zoom_constant:+(x==="constant"||x==="source"),u_is_size_feature_constant:+(x==="constant"||x==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:Y.cameraToCenterDistance,u_pitch:Y.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:Y.width/Y.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_label_plane_matrix:M,u_coord_matrix:R,u_is_text:+B,u_pitch_with_map:+p,u_is_along_line:g,u_is_variable_anchor:E,u_texsize:G,u_texture:0,u_translation:k,u_pitched_scale:U}},pl=(x,r,u,p,g,E,C,M,R,k,B,G,U,Y)=>{let ee=C.transform;return s.e(Va(x,r,u,p,g,E,C,M,R,k,B,G,Y),{u_gamma_scale:p?Math.cos(ee.pitch*Math.PI/180)*ee.cameraToCenterDistance:1,u_device_pixel_ratio:C.pixelRatio,u_is_halo:1})},la=(x,r,u,p,g,E,C,M,R,k,B,G,U)=>s.e(pl(x,r,u,p,g,E,C,M,R,k,!0,B,0,U),{u_texsize_icon:G,u_texture_icon:1}),yh=(x,r)=>({u_opacity:x,u_color:r}),n_=(x,r,u,p,g)=>s.e((function(E,C,M,R){let k=M.imageManager.getPattern(E.from.toString()),B=M.imageManager.getPattern(E.to.toString()),{width:G,height:U}=M.imageManager.getPixelSize(),Y=Math.pow(2,R.tileID.overscaledZ),ee=R.tileSize*Math.pow(2,M.transform.tileZoom)/Y,se=ee*(R.tileID.canonical.x+R.tileID.wrap*Y),le=ee*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:k.tl,u_pattern_br_a:k.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[G,U],u_mix:C.t,u_pattern_size_a:k.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/s.aN(R,1,M.transform.tileZoom),u_pixel_coord_upper:[se>>16,le>>16],u_pixel_coord_lower:[65535&se,65535&le]}})(u,g,r,p),{u_opacity:x}),hu=(x,r)=>{},i_={fillExtrusion:(x,r)=>({u_lightpos:new s.c2(x,r.u_lightpos),u_lightpos_globe:new s.c2(x,r.u_lightpos_globe),u_lightintensity:new s.bq(x,r.u_lightintensity),u_lightcolor:new s.c2(x,r.u_lightcolor),u_vertical_gradient:new s.bq(x,r.u_vertical_gradient),u_opacity:new s.bq(x,r.u_opacity),u_fill_translate:new s.c3(x,r.u_fill_translate)}),fillExtrusionPattern:(x,r)=>({u_lightpos:new s.c2(x,r.u_lightpos),u_lightpos_globe:new s.c2(x,r.u_lightpos_globe),u_lightintensity:new s.bq(x,r.u_lightintensity),u_lightcolor:new s.c2(x,r.u_lightcolor),u_vertical_gradient:new s.bq(x,r.u_vertical_gradient),u_height_factor:new s.bq(x,r.u_height_factor),u_opacity:new s.bq(x,r.u_opacity),u_fill_translate:new s.c3(x,r.u_fill_translate),u_image:new s.b_(x,r.u_image),u_texsize:new s.c3(x,r.u_texsize),u_pixel_coord_upper:new s.c3(x,r.u_pixel_coord_upper),u_pixel_coord_lower:new s.c3(x,r.u_pixel_coord_lower),u_scale:new s.c2(x,r.u_scale),u_fade:new s.bq(x,r.u_fade)}),fill:(x,r)=>({u_fill_translate:new s.c3(x,r.u_fill_translate)}),fillPattern:(x,r)=>({u_image:new s.b_(x,r.u_image),u_texsize:new s.c3(x,r.u_texsize),u_pixel_coord_upper:new s.c3(x,r.u_pixel_coord_upper),u_pixel_coord_lower:new s.c3(x,r.u_pixel_coord_lower),u_scale:new s.c2(x,r.u_scale),u_fade:new s.bq(x,r.u_fade),u_fill_translate:new s.c3(x,r.u_fill_translate)}),fillOutline:(x,r)=>({u_world:new s.c3(x,r.u_world),u_fill_translate:new s.c3(x,r.u_fill_translate)}),fillOutlinePattern:(x,r)=>({u_world:new s.c3(x,r.u_world),u_image:new s.b_(x,r.u_image),u_texsize:new s.c3(x,r.u_texsize),u_pixel_coord_upper:new s.c3(x,r.u_pixel_coord_upper),u_pixel_coord_lower:new s.c3(x,r.u_pixel_coord_lower),u_scale:new s.c2(x,r.u_scale),u_fade:new s.bq(x,r.u_fade),u_fill_translate:new s.c3(x,r.u_fill_translate)}),circle:(x,r)=>({u_camera_to_center_distance:new s.bq(x,r.u_camera_to_center_distance),u_scale_with_map:new s.b_(x,r.u_scale_with_map),u_pitch_with_map:new s.b_(x,r.u_pitch_with_map),u_extrude_scale:new s.c3(x,r.u_extrude_scale),u_device_pixel_ratio:new s.bq(x,r.u_device_pixel_ratio),u_globe_extrude_scale:new s.bq(x,r.u_globe_extrude_scale),u_translate:new s.c3(x,r.u_translate)}),collisionBox:(x,r)=>({u_pixel_extrude_scale:new s.c3(x,r.u_pixel_extrude_scale)}),collisionCircle:(x,r)=>({u_viewport_size:new s.c3(x,r.u_viewport_size)}),debug:(x,r)=>({u_color:new s.b$(x,r.u_color),u_overlay:new s.b_(x,r.u_overlay),u_overlay_scale:new s.bq(x,r.u_overlay_scale)}),depth:hu,clippingMask:hu,heatmap:(x,r)=>({u_extrude_scale:new s.bq(x,r.u_extrude_scale),u_intensity:new s.bq(x,r.u_intensity),u_globe_extrude_scale:new s.bq(x,r.u_globe_extrude_scale)}),heatmapTexture:(x,r)=>({u_matrix:new s.c0(x,r.u_matrix),u_world:new s.c3(x,r.u_world),u_image:new s.b_(x,r.u_image),u_color_ramp:new s.b_(x,r.u_color_ramp),u_opacity:new s.bq(x,r.u_opacity)}),hillshade:(x,r)=>({u_image:new s.b_(x,r.u_image),u_latrange:new s.c3(x,r.u_latrange),u_exaggeration:new s.bq(x,r.u_exaggeration),u_altitudes:new s.c9(x,r.u_altitudes),u_azimuths:new s.c9(x,r.u_azimuths),u_accent:new s.b$(x,r.u_accent),u_method:new s.b_(x,r.u_method),u_shadows:new s.c8(x,r.u_shadows),u_highlights:new s.c8(x,r.u_highlights)}),hillshadePrepare:(x,r)=>({u_matrix:new s.c0(x,r.u_matrix),u_image:new s.b_(x,r.u_image),u_dimension:new s.c3(x,r.u_dimension),u_zoom:new s.bq(x,r.u_zoom),u_unpack:new s.c1(x,r.u_unpack)}),colorRelief:(x,r)=>({u_image:new s.b_(x,r.u_image),u_unpack:new s.c1(x,r.u_unpack),u_dimension:new s.c3(x,r.u_dimension),u_elevation_stops:new s.b_(x,r.u_elevation_stops),u_color_stops:new s.b_(x,r.u_color_stops),u_color_ramp_size:new s.b_(x,r.u_color_ramp_size),u_opacity:new s.bq(x,r.u_opacity)}),line:(x,r)=>({u_translation:new s.c3(x,r.u_translation),u_ratio:new s.bq(x,r.u_ratio),u_device_pixel_ratio:new s.bq(x,r.u_device_pixel_ratio),u_units_to_pixels:new s.c3(x,r.u_units_to_pixels)}),lineGradient:(x,r)=>({u_translation:new s.c3(x,r.u_translation),u_ratio:new s.bq(x,r.u_ratio),u_device_pixel_ratio:new s.bq(x,r.u_device_pixel_ratio),u_units_to_pixels:new s.c3(x,r.u_units_to_pixels),u_image:new s.b_(x,r.u_image),u_image_height:new s.bq(x,r.u_image_height)}),linePattern:(x,r)=>({u_translation:new s.c3(x,r.u_translation),u_texsize:new s.c3(x,r.u_texsize),u_ratio:new s.bq(x,r.u_ratio),u_device_pixel_ratio:new s.bq(x,r.u_device_pixel_ratio),u_image:new s.b_(x,r.u_image),u_units_to_pixels:new s.c3(x,r.u_units_to_pixels),u_scale:new s.c2(x,r.u_scale),u_fade:new s.bq(x,r.u_fade)}),lineSDF:(x,r)=>({u_translation:new s.c3(x,r.u_translation),u_ratio:new s.bq(x,r.u_ratio),u_device_pixel_ratio:new s.bq(x,r.u_device_pixel_ratio),u_units_to_pixels:new s.c3(x,r.u_units_to_pixels),u_image:new s.b_(x,r.u_image),u_mix:new s.bq(x,r.u_mix),u_tileratio:new s.bq(x,r.u_tileratio),u_crossfade_from:new s.bq(x,r.u_crossfade_from),u_crossfade_to:new s.bq(x,r.u_crossfade_to),u_lineatlas_width:new s.bq(x,r.u_lineatlas_width),u_lineatlas_height:new s.bq(x,r.u_lineatlas_height)}),lineGradientSDF:(x,r)=>({u_translation:new s.c3(x,r.u_translation),u_ratio:new s.bq(x,r.u_ratio),u_device_pixel_ratio:new s.bq(x,r.u_device_pixel_ratio),u_units_to_pixels:new s.c3(x,r.u_units_to_pixels),u_image:new s.b_(x,r.u_image),u_image_height:new s.bq(x,r.u_image_height),u_tileratio:new s.bq(x,r.u_tileratio),u_crossfade_from:new s.bq(x,r.u_crossfade_from),u_crossfade_to:new s.bq(x,r.u_crossfade_to),u_image_dash:new s.b_(x,r.u_image_dash),u_mix:new s.bq(x,r.u_mix),u_lineatlas_width:new s.bq(x,r.u_lineatlas_width),u_lineatlas_height:new s.bq(x,r.u_lineatlas_height)}),raster:(x,r)=>({u_tl_parent:new s.c3(x,r.u_tl_parent),u_scale_parent:new s.bq(x,r.u_scale_parent),u_buffer_scale:new s.bq(x,r.u_buffer_scale),u_fade_t:new s.bq(x,r.u_fade_t),u_opacity:new s.bq(x,r.u_opacity),u_image0:new s.b_(x,r.u_image0),u_image1:new s.b_(x,r.u_image1),u_brightness_low:new s.bq(x,r.u_brightness_low),u_brightness_high:new s.bq(x,r.u_brightness_high),u_saturation_factor:new s.bq(x,r.u_saturation_factor),u_contrast_factor:new s.bq(x,r.u_contrast_factor),u_spin_weights:new s.c2(x,r.u_spin_weights),u_coords_top:new s.c1(x,r.u_coords_top),u_coords_bottom:new s.c1(x,r.u_coords_bottom)}),symbolIcon:(x,r)=>({u_is_size_zoom_constant:new s.b_(x,r.u_is_size_zoom_constant),u_is_size_feature_constant:new s.b_(x,r.u_is_size_feature_constant),u_size_t:new s.bq(x,r.u_size_t),u_size:new s.bq(x,r.u_size),u_camera_to_center_distance:new s.bq(x,r.u_camera_to_center_distance),u_pitch:new s.bq(x,r.u_pitch),u_rotate_symbol:new s.b_(x,r.u_rotate_symbol),u_aspect_ratio:new s.bq(x,r.u_aspect_ratio),u_fade_change:new s.bq(x,r.u_fade_change),u_label_plane_matrix:new s.c0(x,r.u_label_plane_matrix),u_coord_matrix:new s.c0(x,r.u_coord_matrix),u_is_text:new s.b_(x,r.u_is_text),u_pitch_with_map:new s.b_(x,r.u_pitch_with_map),u_is_along_line:new s.b_(x,r.u_is_along_line),u_is_variable_anchor:new s.b_(x,r.u_is_variable_anchor),u_texsize:new s.c3(x,r.u_texsize),u_texture:new s.b_(x,r.u_texture),u_translation:new s.c3(x,r.u_translation),u_pitched_scale:new s.bq(x,r.u_pitched_scale)}),symbolSDF:(x,r)=>({u_is_size_zoom_constant:new s.b_(x,r.u_is_size_zoom_constant),u_is_size_feature_constant:new s.b_(x,r.u_is_size_feature_constant),u_size_t:new s.bq(x,r.u_size_t),u_size:new s.bq(x,r.u_size),u_camera_to_center_distance:new s.bq(x,r.u_camera_to_center_distance),u_pitch:new s.bq(x,r.u_pitch),u_rotate_symbol:new s.b_(x,r.u_rotate_symbol),u_aspect_ratio:new s.bq(x,r.u_aspect_ratio),u_fade_change:new s.bq(x,r.u_fade_change),u_label_plane_matrix:new s.c0(x,r.u_label_plane_matrix),u_coord_matrix:new s.c0(x,r.u_coord_matrix),u_is_text:new s.b_(x,r.u_is_text),u_pitch_with_map:new s.b_(x,r.u_pitch_with_map),u_is_along_line:new s.b_(x,r.u_is_along_line),u_is_variable_anchor:new s.b_(x,r.u_is_variable_anchor),u_texsize:new s.c3(x,r.u_texsize),u_texture:new s.b_(x,r.u_texture),u_gamma_scale:new s.bq(x,r.u_gamma_scale),u_device_pixel_ratio:new s.bq(x,r.u_device_pixel_ratio),u_is_halo:new s.b_(x,r.u_is_halo),u_translation:new s.c3(x,r.u_translation),u_pitched_scale:new s.bq(x,r.u_pitched_scale)}),symbolTextAndIcon:(x,r)=>({u_is_size_zoom_constant:new s.b_(x,r.u_is_size_zoom_constant),u_is_size_feature_constant:new s.b_(x,r.u_is_size_feature_constant),u_size_t:new s.bq(x,r.u_size_t),u_size:new s.bq(x,r.u_size),u_camera_to_center_distance:new s.bq(x,r.u_camera_to_center_distance),u_pitch:new s.bq(x,r.u_pitch),u_rotate_symbol:new s.b_(x,r.u_rotate_symbol),u_aspect_ratio:new s.bq(x,r.u_aspect_ratio),u_fade_change:new s.bq(x,r.u_fade_change),u_label_plane_matrix:new s.c0(x,r.u_label_plane_matrix),u_coord_matrix:new s.c0(x,r.u_coord_matrix),u_is_text:new s.b_(x,r.u_is_text),u_pitch_with_map:new s.b_(x,r.u_pitch_with_map),u_is_along_line:new s.b_(x,r.u_is_along_line),u_is_variable_anchor:new s.b_(x,r.u_is_variable_anchor),u_texsize:new s.c3(x,r.u_texsize),u_texsize_icon:new s.c3(x,r.u_texsize_icon),u_texture:new s.b_(x,r.u_texture),u_texture_icon:new s.b_(x,r.u_texture_icon),u_gamma_scale:new s.bq(x,r.u_gamma_scale),u_device_pixel_ratio:new s.bq(x,r.u_device_pixel_ratio),u_is_halo:new s.b_(x,r.u_is_halo),u_translation:new s.c3(x,r.u_translation),u_pitched_scale:new s.bq(x,r.u_pitched_scale)}),background:(x,r)=>({u_opacity:new s.bq(x,r.u_opacity),u_color:new s.b$(x,r.u_color)}),backgroundPattern:(x,r)=>({u_opacity:new s.bq(x,r.u_opacity),u_image:new s.b_(x,r.u_image),u_pattern_tl_a:new s.c3(x,r.u_pattern_tl_a),u_pattern_br_a:new s.c3(x,r.u_pattern_br_a),u_pattern_tl_b:new s.c3(x,r.u_pattern_tl_b),u_pattern_br_b:new s.c3(x,r.u_pattern_br_b),u_texsize:new s.c3(x,r.u_texsize),u_mix:new s.bq(x,r.u_mix),u_pattern_size_a:new s.c3(x,r.u_pattern_size_a),u_pattern_size_b:new s.c3(x,r.u_pattern_size_b),u_scale_a:new s.bq(x,r.u_scale_a),u_scale_b:new s.bq(x,r.u_scale_b),u_pixel_coord_upper:new s.c3(x,r.u_pixel_coord_upper),u_pixel_coord_lower:new s.c3(x,r.u_pixel_coord_lower),u_tile_units_to_pixels:new s.bq(x,r.u_tile_units_to_pixels)}),terrain:(x,r)=>({u_texture:new s.b_(x,r.u_texture),u_ele_delta:new s.bq(x,r.u_ele_delta),u_fog_matrix:new s.c0(x,r.u_fog_matrix),u_fog_color:new s.b$(x,r.u_fog_color),u_fog_ground_blend:new s.bq(x,r.u_fog_ground_blend),u_fog_ground_blend_opacity:new s.bq(x,r.u_fog_ground_blend_opacity),u_horizon_color:new s.b$(x,r.u_horizon_color),u_horizon_fog_blend:new s.bq(x,r.u_horizon_fog_blend),u_is_globe_mode:new s.bq(x,r.u_is_globe_mode)}),terrainDepth:(x,r)=>({u_ele_delta:new s.bq(x,r.u_ele_delta)}),terrainCoords:(x,r)=>({u_texture:new s.b_(x,r.u_texture),u_terrain_coords_id:new s.bq(x,r.u_terrain_coords_id),u_ele_delta:new s.bq(x,r.u_ele_delta)}),projectionErrorMeasurement:(x,r)=>({u_input:new s.bq(x,r.u_input),u_output_expected:new s.bq(x,r.u_output_expected)}),atmosphere:(x,r)=>({u_sun_pos:new s.c2(x,r.u_sun_pos),u_atmosphere_blend:new s.bq(x,r.u_atmosphere_blend),u_globe_position:new s.c2(x,r.u_globe_position),u_globe_radius:new s.bq(x,r.u_globe_radius),u_inv_proj_matrix:new s.c0(x,r.u_inv_proj_matrix)}),sky:(x,r)=>({u_sky_color:new s.b$(x,r.u_sky_color),u_horizon_color:new s.b$(x,r.u_horizon_color),u_horizon:new s.c3(x,r.u_horizon),u_horizon_normal:new s.c3(x,r.u_horizon_normal),u_sky_horizon_blend:new s.bq(x,r.u_sky_horizon_blend),u_sky_blend:new s.bq(x,r.u_sky_blend)})};class bp{constructor(r,u,p){this.context=r;let g=r.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){let u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let wp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ep{constructor(r,u,p,g){this.length=u.length,this.attributes=p,this.itemSize=u.bytesPerElement,this.dynamicDraw=g,this.context=r;let E=r.gl;this.buffer=E.createBuffer(),r.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){if(r.length!==this.length)throw new Error(`Length of new data is ${r.length}, which doesn't match current length of ${this.length}`);let u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,u){for(let p=0;p<this.attributes.length;p++){let g=u.attributes[this.attributes[p].name];g!==void 0&&r.enableVertexAttribArray(g)}}setVertexAttribPointers(r,u,p){for(let g=0;g<this.attributes.length;g++){let E=this.attributes[g],C=u.attributes[E.name];C!==void 0&&r.vertexAttribPointer(C,E.components,r[wp[E.type]],!1,this.itemSize,E.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Un{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Lo extends Un{getDefault(){return s.bp.transparent}set(r){let u=this.current;(r.r!==u.r||r.g!==u.g||r.b!==u.b||r.a!==u.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class ml extends Un{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class vh extends Un{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class uc extends Un{getDefault(){return[!0,!0,!0,!0]}set(r){let u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||r[3]!==u[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class gl extends Un{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class hc extends Un{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class dc extends Un{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){let u=this.current;(r.func!==u.func||r.ref!==u.ref||r.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Sr extends Un{getDefault(){let r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){let u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Tp extends Un{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let u=this.gl;r?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=r,this.dirty=!1}}class _l extends Un{getDefault(){return[0,1]}set(r){let u=this.current;(r[0]!==u[0]||r[1]!==u[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class xh extends Un{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let u=this.gl;r?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=r,this.dirty=!1}}class Ua extends Un{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class bh extends Un{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let u=this.gl;r?u.enable(u.BLEND):u.disable(u.BLEND),this.current=r,this.dirty=!1}}class Xo extends Un{getDefault(){let r=this.gl;return[r.ONE,r.ZERO]}set(r){let u=this.current;(r[0]!==u[0]||r[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class fc extends Un{getDefault(){return s.bp.transparent}set(r){let u=this.current;(r.r!==u.r||r.g!==u.g||r.b!==u.b||r.a!==u.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class du extends Un{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class pc extends Un{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let u=this.gl;r?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=r,this.dirty=!1}}class mc extends Un{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class ca extends Un{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class gc extends Un{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class wh extends Un{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class hn extends Un{getDefault(){let r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){let u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||r[3]!==u[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Eh extends Un{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Cp extends Un{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Rd extends Un{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let u=this.gl;u.bindTexture(u.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class _c extends Un{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Ip extends Un{getDefault(){return null}set(r){let u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Sp extends Un{getDefault(){return null}set(r){var u;if(r===this.current&&!this.dirty)return;let p=this.gl;Ao(p)?p.bindVertexArray(r):(u=p.getExtension("OES_vertex_array_object"))===null||u===void 0||u.bindVertexArrayOES(r),this.current=r,this.dirty=!1}}class Dp extends Un{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Mp extends Un{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Th extends Un{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class yc extends Un{constructor(r,u){super(r),this.context=r,this.parent=u}getDefault(){return null}}class d extends yc{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class b extends yc{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class S extends yc{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,r),this.current=r,this.dirty=!1}}let F="Framebuffer is not complete";class ${constructor(r,u,p,g,E){this.context=r,this.width=u,this.height=p;let C=r.gl,M=this.framebuffer=C.createFramebuffer();if(this.colorAttachment=new d(r,M),g)this.depthAttachment=E?new S(r,M):new b(r,M);else if(E)throw new Error("Stencil cannot be set without depth");if(C.checkFramebufferStatus(C.FRAMEBUFFER)!==C.FRAMEBUFFER_COMPLETE)throw new Error(F)}destroy(){let r=this.context.gl,u=this.colorAttachment.get();if(u&&r.deleteTexture(u),this.depthAttachment){let p=this.depthAttachment.get();p&&r.deleteRenderbuffer(p)}r.deleteFramebuffer(this.framebuffer)}}class ie{constructor(r){var u,p;if(this.gl=r,this.clearColor=new Lo(this),this.clearDepth=new ml(this),this.clearStencil=new vh(this),this.colorMask=new uc(this),this.depthMask=new gl(this),this.stencilMask=new hc(this),this.stencilFunc=new dc(this),this.stencilOp=new Sr(this),this.stencilTest=new Tp(this),this.depthRange=new _l(this),this.depthTest=new xh(this),this.depthFunc=new Ua(this),this.blend=new bh(this),this.blendFunc=new Xo(this),this.blendColor=new fc(this),this.blendEquation=new du(this),this.cullFace=new pc(this),this.cullFaceSide=new mc(this),this.frontFace=new ca(this),this.program=new gc(this),this.activeTexture=new wh(this),this.viewport=new hn(this),this.bindFramebuffer=new Eh(this),this.bindRenderbuffer=new Cp(this),this.bindTexture=new Rd(this),this.bindVertexBuffer=new _c(this),this.bindElementBuffer=new Ip(this),this.bindVertexArray=new Sp(this),this.pixelStoreUnpack=new Dp(this),this.pixelStoreUnpackPremultiplyAlpha=new Mp(this),this.pixelStoreUnpackFlipY=new Th(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),Ao(r)){this.HALF_FLOAT=r.HALF_FLOAT;let g=r.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(u=r.RGBA16F)!==null&&u!==void 0?u:g?.RGBA16F_EXT,this.RGB16F=(p=r.RGB16F)!==null&&p!==void 0?p:g?.RGB16F_EXT,r.getExtension("EXT_color_buffer_float")}else{r.getExtension("EXT_color_buffer_half_float"),r.getExtension("OES_texture_half_float_linear");let g=r.getExtension("OES_texture_half_float");this.HALF_FLOAT=g?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,u){return new bp(this,r,u)}createVertexBuffer(r,u,p){return new Ep(this,r,u,p)}createRenderbuffer(r,u,p){let g=this.gl,E=g.createRenderbuffer();return this.bindRenderbuffer.set(E),g.renderbufferStorage(g.RENDERBUFFER,r,u,p),this.bindRenderbuffer.set(null),E}createFramebuffer(r,u,p,g){return new $(this,r,u,p,g)}clear({color:r,depth:u,stencil:p}){let g=this.gl,E=0;r&&(E|=g.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(E|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),p!==void 0&&(E|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),g.clear(E)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){s.bR(r.blendFunction,li.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}createVertexArray(){var r;return Ao(this.gl)?this.gl.createVertexArray():(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.createVertexArrayOES()}deleteVertexArray(r){var u;return Ao(this.gl)?this.gl.deleteVertexArray(r):(u=this.gl.getExtension("OES_vertex_array_object"))===null||u===void 0?void 0:u.deleteVertexArrayOES(r)}unbindVAO(){this.bindVertexArray.set(null)}}let we;function Fe(x,r,u,p,g){let E=x.context,C=x.transform,M=E.gl,R=x.useProgram("collisionBox"),k=[],B=0,G=0;for(let ae=0;ae<p.length;ae++){let fe=p[ae],xe=r.getTile(fe).getBucket(u);if(!xe)continue;let de=g?xe.textCollisionBox:xe.iconCollisionBox,ye=xe.collisionCircleArray;ye.length>0&&(k.push({circleArray:ye,circleOffset:G,coord:fe}),B+=ye.length/4,G=B),de&&R.draw(E,M.LINES,rn.disabled,An.disabled,x.colorModeForRenderPass(),mn.disabled,Cs(x.transform),x.style.map.terrain&&x.style.map.terrain.getTerrainData(fe),C.getProjectionData({overscaledTileID:fe,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),u.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,null,x.transform.zoom,null,null,de.collisionVertexBuffer)}if(!g||!k.length)return;let U=x.useProgram("collisionCircle"),Y=new s.ca;Y.resize(4*B),Y._trim();let ee=0;for(let ae of k)for(let fe=0;fe<ae.circleArray.length/4;fe++){let xe=4*fe,de=ae.circleArray[xe+0],ye=ae.circleArray[xe+1],Ee=ae.circleArray[xe+2],_e=ae.circleArray[xe+3];Y.emplace(ee++,de,ye,Ee,_e,0),Y.emplace(ee++,de,ye,Ee,_e,1),Y.emplace(ee++,de,ye,Ee,_e,2),Y.emplace(ee++,de,ye,Ee,_e,3)}(!we||we.length<2*B)&&(we=(function(ae){let fe=2*ae,xe=new s.cc;xe.resize(fe),xe._trim();for(let de=0;de<fe;de++){let ye=6*de;xe.uint16[ye+0]=4*de+0,xe.uint16[ye+1]=4*de+1,xe.uint16[ye+2]=4*de+2,xe.uint16[ye+3]=4*de+2,xe.uint16[ye+4]=4*de+3,xe.uint16[ye+5]=4*de+0}return xe})(B));let se=E.createIndexBuffer(we,!0),le=E.createVertexBuffer(Y,s.cb.members,!0);for(let ae of k){let fe=_p(x.transform);U.draw(E,M.TRIANGLES,rn.disabled,An.disabled,x.colorModeForRenderPass(),mn.disabled,fe,x.style.map.terrain&&x.style.map.terrain.getTerrainData(ae.coord),null,u.id,le,se,s.aX.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,x.transform.zoom,null,null,null)}le.destroy(),se.destroy()}let He=s.ar(new Float32Array(16));function at(x,r,u,p,g,E){let{horizontalAlign:C,verticalAlign:M}=s.aS(x);return new s.P((-(C-.5)*r/g+p[0])*E,(-(M-.5)*u/g+p[1])*E)}function It(x,r,u,p,g,E){let C=r.tileAnchorPoint.add(new s.P(r.translation[0],r.translation[1]));if(r.pitchWithMap){let M=p.mult(E);u||(M=M.rotate(-g));let R=C.add(M);return on(R.x,R.y,r.pitchedLabelPlaneMatrix,r.getElevation).point}if(u){let M=Kn(r.tileAnchorPoint.x+1,r.tileAnchorPoint.y,r).point.sub(x),R=Math.atan(M.y/M.x)+(M.x<0?Math.PI:0);return x.add(p.rotate(R))}return x.add(p)}function Jt(x,r,u,p,g,E,C,M,R,k,B,G){let U=x.text.placedSymbolArray,Y=x.text.dynamicLayoutVertexArray,ee=x.icon.dynamicLayoutVertexArray,se={};Y.clear();for(let le=0;le<U.length;le++){let ae=U.get(le),fe=ae.hidden||!ae.crossTileID||x.allowVerticalPlacement&&!ae.placedOrientation?null:p[ae.crossTileID];if(fe){let xe=new s.P(ae.anchorX,ae.anchorY),de={getElevation:G,width:g.width,height:g.height,pitchedLabelPlaneMatrix:E,pitchWithMap:u,transform:g,tileAnchorPoint:xe,translation:k,unwrappedTileID:B},ye=u?bs(xe.x,xe.y,de):Kn(xe.x,xe.y,de),Ee=Kc(g.cameraToCenterDistance,ye.signedDistanceFromCamera),_e=s.aA(x.textSizeData,M,ae)*Ee/s.aM;u&&(_e*=x.tilePixelRatio/C);let{width:Ce,height:je,anchor:Ne,textOffset:ze,textBoxScale:Be}=fe,lt=at(Ne,Ce,je,ze,Be,_e),ct=g.getPitchedTextCorrection(xe.x+k[0],xe.y+k[1],B),Ye=It(ye.point,de,r,lt,-g.bearingInRadians,ct),mt=x.allowVerticalPlacement&&ae.placedOrientation===s.az.vertical?Math.PI/2:0;for(let nn=0;nn<ae.numGlyphs;nn++)s.aG(Y,Ye,mt);R&&ae.associatedIconIndex>=0&&(se[ae.associatedIconIndex]={shiftedAnchor:Ye,angle:mt})}else ii(ae.numGlyphs,Y)}if(R){ee.clear();let le=x.icon.placedSymbolArray;for(let ae=0;ae<le.length;ae++){let fe=le.get(ae);if(fe.hidden)ii(fe.numGlyphs,ee);else{let xe=se[ae];if(xe)for(let de=0;de<fe.numGlyphs;de++)s.aG(ee,xe.shiftedAnchor,xe.angle);else ii(fe.numGlyphs,ee)}}x.icon.dynamicLayoutVertexBuffer.updateData(ee)}x.text.dynamicLayoutVertexBuffer.updateData(Y)}function wn(x,r,u){return u.iconsInText&&r?"symbolTextAndIcon":x?"symbolSDF":"symbolIcon"}function rr(x,r,u,p,g,E,C,M,R,k,B,G,U){let Y=x.context,ee=Y.gl,se=x.transform,le=M==="map",ae=R==="map",fe=M!=="viewport"&&u.layout.get("symbol-placement")!=="point",xe=le&&!ae&&!fe,de=!u.layout.get("symbol-sort-key").isConstant(),ye=!1,Ee=x.getDepthModeForSublayer(0,rn.ReadOnly),_e=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ce=[],je=se.getCircleRadiusCorrection();for(let Ne of p){let ze=r.getTile(Ne),Be=ze.getBucket(u);if(!Be)continue;let lt=g?Be.text:Be.icon;if(!lt||!lt.segments.get().length||!lt.hasVisibleVertices)continue;let ct=lt.programConfigurations.get(u.id),Ye=g||Be.sdfIcons,mt=g?Be.textSizeData:Be.iconSizeData,nn=ae||se.pitch!==0,oi=x.useProgram(wn(Ye,g,Be),ct),Ii=s.ay(mt,se.zoom),gi=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Ne),Ri,_i,Yi,Li,Mr=[0,0],or=null;if(g)_i=ze.glyphAtlasTexture,Yi=ee.LINEAR,Ri=ze.glyphAtlasTexture.size,Be.iconsInText&&(Mr=ze.imageAtlasTexture.size,or=ze.imageAtlasTexture,Li=nn||x.options.rotating||x.options.zooming||mt.kind==="composite"||mt.kind==="camera"?ee.LINEAR:ee.NEAREST);else{let bi=u.layout.get("icon-size").constantOr(0)!==1||Be.iconsNeedLinear;_i=ze.imageAtlasTexture,Yi=Ye||x.options.rotating||x.options.zooming||bi||nn?ee.LINEAR:ee.NEAREST,Ri=ze.imageAtlasTexture.size}let tr=s.aN(ze,1,x.transform.zoom),Yr=so(le,x.transform,tr),wc=s.N();s.aB(wc,Yr);let bl=ch(ae,le,x.transform,tr),Ha=s.aO(se,ze,E,C),Yo=se.getProjectionData({overscaledTileID:Ne,applyGlobeMatrix:!U,applyTerrainMatrix:!0}),_u=_e&&Be.hasTextData(),Xd=u.layout.get("icon-text-fit")!=="none"&&_u&&Be.hasIconData();if(fe){let bi=x.style.map.terrain?(br,wr)=>x.style.map.terrain.getElevation(Ne,br,wr):null,yi=u.layout.get("text-rotation-alignment")==="map";uh(Be,x,g,Yr,wc,ae,k,yi,Ne.toUnwrapped(),se.width,se.height,Ha,bi)}let yu=g&&_e||Xd,As=fe||yu?He:ae?Yr:x.transform.clipSpaceToPixelsMatrix,Za=Ye&&u.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0,ma;ma=Ye?Be.iconsInText?la(mt.kind,Ii,xe,ae,fe,yu,x,As,bl,Ha,Ri,Mr,je):pl(mt.kind,Ii,xe,ae,fe,yu,x,As,bl,Ha,g,Ri,0,je):Va(mt.kind,Ii,xe,ae,fe,yu,x,As,bl,Ha,g,Ri,je);let ga={program:oi,buffers:lt,uniformValues:ma,projectionData:Yo,atlasTexture:_i,atlasTextureIcon:or,atlasInterpolation:Yi,atlasInterpolationIcon:Li,isSDF:Ye,hasHalo:Za};if(de&&Be.canOverlap){ye=!0;let bi=lt.segments.get();for(let yi of bi)Ce.push({segments:new s.aX([yi]),sortKey:yi.sortKey,state:ga,terrainData:gi})}else Ce.push({segments:lt.segments,sortKey:0,state:ga,terrainData:gi})}ye&&Ce.sort((Ne,ze)=>Ne.sortKey-ze.sortKey);for(let Ne of Ce){let ze=Ne.state;if(Y.activeTexture.set(ee.TEXTURE0),ze.atlasTexture.bind(ze.atlasInterpolation,ee.CLAMP_TO_EDGE),ze.atlasTextureIcon&&(Y.activeTexture.set(ee.TEXTURE1),ze.atlasTextureIcon&&ze.atlasTextureIcon.bind(ze.atlasInterpolationIcon,ee.CLAMP_TO_EDGE)),ze.isSDF){let Be=ze.uniformValues;ze.hasHalo&&(Be.u_is_halo=1,Xi(ze.buffers,Ne.segments,u,x,ze.program,Ee,B,G,Be,ze.projectionData,Ne.terrainData)),Be.u_is_halo=0}Xi(ze.buffers,Ne.segments,u,x,ze.program,Ee,B,G,ze.uniformValues,ze.projectionData,Ne.terrainData)}}function Xi(x,r,u,p,g,E,C,M,R,k,B){let G=p.context;g.draw(G,G.gl.TRIANGLES,E,C,M,mn.backCCW,R,B,k,u.id,x.layoutVertexBuffer,x.indexBuffer,r,u.paint,p.transform.zoom,x.programConfigurations.get(u.id),x.dynamicLayoutVertexBuffer,x.opacityVertexBuffer)}function Oo(x,r,u,p,g){let E=x.context,C=E.gl,M=An.disabled,R=new li([C.ONE,C.ONE],s.bp.transparent,[!0,!0,!0,!0]),k=r.getBucket(u);if(!k)return;let B=p.key,G=u.heatmapFbos.get(B);G||(G=Ds(E,r.tileSize,r.tileSize),u.heatmapFbos.set(B,G)),E.bindFramebuffer.set(G.framebuffer),E.viewport.set([0,0,r.tileSize,r.tileSize]),E.clear({color:s.bp.transparent});let U=k.programConfigurations.get(u.id),Y=x.useProgram("heatmap",U,!g),ee=x.transform.getProjectionData({overscaledTileID:r.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),se=x.style.map.terrain.getTerrainData(p);Y.draw(E,C.TRIANGLES,rn.disabled,M,R,mn.disabled,sa(r,x.transform.zoom,u.paint.get("heatmap-intensity"),1),se,ee,u.id,k.layoutVertexBuffer,k.indexBuffer,k.segments,u.paint,x.transform.zoom,U)}function Xr(x,r,u,p,g){let E=x.context,C=E.gl,M=x.transform;E.setColorMode(x.colorModeForRenderPass());let R=Ch(E,r),k=u.key,B=r.heatmapFbos.get(k);if(!B)return;E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,B.colorAttachment.get()),E.activeTexture.set(C.TEXTURE1),R.bind(C.LINEAR,C.CLAMP_TO_EDGE);let G=M.getProjectionData({overscaledTileID:u,applyTerrainMatrix:g,applyGlobeMatrix:!p});x.useProgram("heatmapTexture").draw(E,C.TRIANGLES,rn.disabled,An.disabled,x.colorModeForRenderPass(),mn.disabled,yp(x,r,0,1),null,G,r.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments,r.paint,M.zoom),B.destroy(),r.heatmapFbos.delete(k)}function Ds(x,r,u){var p,g;let E=x.gl,C=E.createTexture();E.bindTexture(E.TEXTURE_2D,C),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,E.LINEAR),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,E.LINEAR);let M=(p=x.HALF_FLOAT)!==null&&p!==void 0?p:E.UNSIGNED_BYTE,R=(g=x.RGBA16F)!==null&&g!==void 0?g:E.RGBA;E.texImage2D(E.TEXTURE_2D,0,R,r,u,0,E.RGBA,M,null);let k=x.createFramebuffer(r,u,!1,!1);return k.colorAttachment.set(C),k}function Ch(x,r){return r.colorRampTexture||(r.colorRampTexture=new s.T(x,r.colorRamp,x.gl.RGBA)),r.colorRampTexture}function Pp(x,r,u,p,g,E,C,M){let R=256;if(g.stepInterpolant){let k=r.getSource().maxzoom,B=C.canonical.z===k?Math.ceil(1<<x.transform.maxZoom-C.canonical.z):1;R=s.an(s.ce(E.maxLineLength/s.a5*1024*B),256,u.maxTextureSize)}return M.gradient=s.cf({expression:g.gradientExpression(),evaluationKey:"lineProgress",resolution:R,image:M.gradient||void 0,clips:E.lineClipsArray}),M.texture?M.texture.update(M.gradient):M.texture=new s.T(u,M.gradient,p.RGBA),M.version=g.gradientVersion,M.texture}function Ap(x,r,u,p,g){x.activeTexture.set(r.TEXTURE0),u.imageAtlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE),p.updatePaintBuffers(g)}function Pi(x,r,u,p,g,E){(g||x.lineAtlas.dirty)&&(r.activeTexture.set(u.TEXTURE0),x.lineAtlas.bind(r)),p.updatePaintBuffers(E)}function yl(x,r,u,p,g,E,C){let M=E.gradients[g.id],R=M.texture;g.gradientVersion!==M.version&&(R=Pp(x,r,u,p,g,E,C,M)),u.activeTexture.set(p.TEXTURE0),R.bind(g.stepInterpolant?p.NEAREST:p.LINEAR,p.CLAMP_TO_EDGE)}function uo(x,r,u,p,g,E,C,M,R){let k=E.gradients[g.id],B=k.texture;g.gradientVersion!==k.version&&(B=Pp(x,r,u,p,g,E,C,k)),u.activeTexture.set(p.TEXTURE0),B.bind(g.stepInterpolant?p.NEAREST:p.LINEAR,p.CLAMP_TO_EDGE),u.activeTexture.set(p.TEXTURE1),x.lineAtlas.bind(u),M.updatePaintBuffers(R)}function Ai(x,r,u,p,g){if(!u||!p||!p.imageAtlas)return;let E=p.imageAtlas.patternPositions,C=E[u.to.toString()],M=E[u.from.toString()];if(!C&&M&&(C=M),!M&&C&&(M=C),!C||!M){let R=g.getPaintProperty(r);C=E[R],M=E[R]}C&&M&&x.setConstantPatternPositions(C,M)}function Ga(x,r,u,p,g,E,C,M){let R=x.context.gl,k="fill-pattern",B=u.paint.get(k),G=B&&B.constantOr(1),U=u.getCrossfadeParameters(),Y,ee,se,le,ae,fe=x.transform,xe=u.paint.get("fill-translate"),de=u.paint.get("fill-translate-anchor");C?(ee=G&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Y=R.LINES):(ee=G?"fillPattern":"fill",Y=R.TRIANGLES);let ye=B.constantOr(null);for(let Ee of p){let _e=r.getTile(Ee);if(G&&!_e.patternsLoaded())continue;let Ce=_e.getBucket(u);if(!Ce)continue;let je=Ce.programConfigurations.get(u.id),Ne=x.useProgram(ee,je),ze=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Ee);G&&(x.context.activeTexture.set(R.TEXTURE0),_e.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),je.updatePaintBuffers(U)),Ai(je,k,ye,_e,u);let Be=fe.getProjectionData({overscaledTileID:Ee,applyGlobeMatrix:!M,applyTerrainMatrix:!0}),lt=s.aO(fe,_e,xe,de);if(C){le=Ce.indexBuffer2,ae=Ce.segments2;let Ye=[R.drawingBufferWidth,R.drawingBufferHeight];se=ee==="fillOutlinePattern"&&G?ac(x,U,_e,Ye,lt):gp(Ye,lt)}else le=Ce.indexBuffer,ae=Ce.segments,se=G?ja(x,U,_e,lt):{u_fill_translate:lt};let ct=x.stencilModeForClipping(Ee);Ne.draw(x.context,Y,g,ct,E,mn.backCCW,se,ze,Be,u.id,Ce.layoutVertexBuffer,le,ae,u.paint,x.transform.zoom,je)}}function Ih(x,r,u,p,g,E,C,M){let R=x.context,k=R.gl,B="fill-extrusion-pattern",G=u.paint.get(B),U=G.constantOr(1),Y=u.getCrossfadeParameters(),ee=u.paint.get("fill-extrusion-opacity"),se=G.constantOr(null),le=x.transform;for(let ae of p){let fe=r.getTile(ae),xe=fe.getBucket(u);if(!xe)continue;let de=x.style.map.terrain&&x.style.map.terrain.getTerrainData(ae),ye=xe.programConfigurations.get(u.id),Ee=x.useProgram(U?"fillExtrusionPattern":"fillExtrusion",ye);U&&(x.context.activeTexture.set(k.TEXTURE0),fe.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ye.updatePaintBuffers(Y));let _e=le.getProjectionData({overscaledTileID:ae,applyGlobeMatrix:!M,applyTerrainMatrix:!0});Ai(ye,B,se,fe,u);let Ce=s.aO(le,fe,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),je=u.paint.get("fill-extrusion-vertical-gradient"),Ne=U?Pd(x,je,ee,Ce,ae,Y,fe):ds(x,je,ee,Ce);Ee.draw(R,R.gl.TRIANGLES,g,E,C,mn.backCCW,Ne,de,_e,u.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,u.paint,x.transform.zoom,ye,x.style.map.terrain&&xe.centroidVertexBuffer)}}function $a(x,r,u,p,g,E,C,M,R){var k;let B=x.style.projection,G=x.context,U=x.transform,Y=G.gl,ee=[`#define NUM_ILLUMINATION_SOURCES ${u.paint.get("hillshade-highlight-color").values.length}`],se=x.useProgram("hillshade",null,!1,ee),le=!x.options.moving;for(let ae of p){let fe=r.getTile(ae),xe=fe.fbo;if(!xe)continue;let de=B.getMeshFromTileID(G,ae.canonical,M,!0,"raster"),ye=(k=x.style.map.terrain)===null||k===void 0?void 0:k.getTerrainData(ae);G.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,xe.colorAttachment.get());let Ee=U.getProjectionData({overscaledTileID:ae,aligned:le,applyGlobeMatrix:!R,applyTerrainMatrix:!0});se.draw(G,Y.TRIANGLES,E,g[ae.overscaledZ],C,mn.backCCW,lc(x,fe,u),ye,Ee,u.id,de.vertexBuffer,de.indexBuffer,de.segments)}}function fu(x,r,u,p,g,E,C,M,R){var k;let B=x.style.projection,G=x.context,U=x.transform,Y=G.gl,ee=x.useProgram("colorRelief"),se=!x.options.moving,le=!0,ae=0;for(let fe of p){let xe=r.getTile(fe),de=xe.dem;if(le){let Ne=Y.getParameter(Y.MAX_TEXTURE_SIZE),{elevationTexture:ze,colorTexture:Be}=u.getColorRampTextures(G,Ne,de.getUnpackVector());G.activeTexture.set(Y.TEXTURE1),ze.bind(Y.NEAREST,Y.CLAMP_TO_EDGE),G.activeTexture.set(Y.TEXTURE4),Be.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),le=!1,ae=ze.size[0]}if(!de||!de.data)continue;let ye=de.stride,Ee=de.getPixels();if(G.activeTexture.set(Y.TEXTURE0),G.pixelStoreUnpackPremultiplyAlpha.set(!1),xe.demTexture=xe.demTexture||x.getTileTexture(ye),xe.demTexture){let Ne=xe.demTexture;Ne.update(Ee,{premultiply:!1}),Ne.bind(Y.LINEAR,Y.CLAMP_TO_EDGE)}else xe.demTexture=new s.T(G,Ee,Y.RGBA,{premultiply:!1}),xe.demTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let _e=B.getMeshFromTileID(G,fe.canonical,M,!0,"raster"),Ce=(k=x.style.map.terrain)===null||k===void 0?void 0:k.getTerrainData(fe),je=U.getProjectionData({overscaledTileID:fe,aligned:se,applyGlobeMatrix:!R,applyTerrainMatrix:!0});ee.draw(G,Y.TRIANGLES,E,g[fe.overscaledZ],C,mn.backCCW,vp(u,xe.dem,ae),Ce,je,u.id,_e.vertexBuffer,_e.indexBuffer,_e.segments)}}let ua=[new s.P(0,0),new s.P(s.a5,0),new s.P(s.a5,s.a5),new s.P(0,s.a5)];function vl(x,r,u,p,g,E,C,M,R=!1,k=!1){let B=p[p.length-1].overscaledZ,G=x.context,U=G.gl,Y=x.useProgram("raster"),ee=x.transform,se=x.style.projection,le=x.colorModeForRenderPass(),ae=!x.options.moving,fe=u.paint.get("raster-opacity"),xe=u.paint.get("raster-resampling"),de=u.paint.get("raster-fade-duration"),ye=!!x.style.map.terrain;for(let Ee of p){let _e=x.getDepthModeForSublayer(Ee.overscaledZ-B,fe===1?rn.ReadWrite:rn.ReadOnly,U.LESS),Ce=r.getTile(Ee),je=xe==="nearest"?U.NEAREST:U.LINEAR;G.activeTexture.set(U.TEXTURE0),Ce.texture.bind(je,U.CLAMP_TO_EDGE,U.LINEAR_MIPMAP_NEAREST),G.activeTexture.set(U.TEXTURE1);let{parentTile:Ne,parentScaleBy:ze,parentTopLeft:Be,fadeValues:lt}=Rp(Ce,r,de,ye);Ce.fadeOpacity=lt.tileOpacity,Ne?(Ne.fadeOpacity=lt.parentTileOpacity,Ne.texture.bind(je,U.CLAMP_TO_EDGE,U.LINEAR_MIPMAP_NEAREST)):Ce.texture.bind(je,U.CLAMP_TO_EDGE,U.LINEAR_MIPMAP_NEAREST),Ce.texture.useMipmap&&G.extTextureFilterAnisotropic&&x.transform.pitch>20&&U.texParameterf(U.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax);let ct=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Ee),Ye=ee.getProjectionData({overscaledTileID:Ee,aligned:ae,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),mt=uu(Be,ze,lt.fadeMix,u,M),nn=se.getMeshFromTileID(G,Ee.canonical,E,C,"raster");Y.draw(G,U.TRIANGLES,_e,g?g[Ee.overscaledZ]:An.disabled,le,R?mn.frontCCW:mn.backCCW,mt,ct,Ye,u.id,nn.vertexBuffer,nn.indexBuffer,nn.segments)}}function Rp(x,r,u,p){let g={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(u===0||p)return g;if(x.fadingParentID){let E=r.getLoadedTile(x.fadingParentID);if(!E)return g;let C=Math.pow(2,E.tileID.overscaledZ-x.tileID.overscaledZ),M=[x.tileID.canonical.x*C%1,x.tileID.canonical.y*C%1],R=(function(k,B,G){let U=q(),Y=(U-B.timeAdded)/G,ee=k.fadingDirection===be.Incoming,se=s.an((U-k.timeAdded)/G,0,1),le=s.an(1-Y,0,1),ae=ee?se:le;return{tileOpacity:ae,parentTileOpacity:ee?le:se,fadeMix:{opacity:1,mix:1-ae}}})(x,E,u);return{parentTile:E,parentScaleBy:C,parentTopLeft:M,fadeValues:R}}if(x.selfFading){let E=(function(C,M){let R=(q()-C.timeAdded)/M,k=s.an(R,0,1);return{tileOpacity:k,fadeMix:{opacity:k,mix:0}}})(x,u);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:E}}return g}let t0=new s.bp(1,0,0,1),n0=new s.bp(0,1,0,1),i0=new s.bp(0,0,1,1),r0=new s.bp(1,0,1,1),vc=new s.bp(0,1,1,1);function r_(x,r,u,p){Ld(x,0,r+u/2,x.transform.width,u,p)}function o_(x,r,u,p){Ld(x,r-u/2,0,u,x.transform.height,p)}function Ld(x,r,u,p,g,E){let C=x.context,M=C.gl;M.enable(M.SCISSOR_TEST),M.scissor(r*x.pixelRatio,u*x.pixelRatio,p*x.pixelRatio,g*x.pixelRatio),C.clear({color:E}),M.disable(M.SCISSOR_TEST)}function o0(x,r,u){let p=x.context,g=p.gl,E=x.useProgram("debug"),C=rn.disabled,M=An.disabled,R=x.colorModeForRenderPass(),k="$debug",B=x.style.map.terrain&&x.style.map.terrain.getTerrainData(u);p.activeTexture.set(g.TEXTURE0);let G=r.getTileByID(u.key).latestRawTileData,U=Math.floor((G&&G.byteLength||0)/1024),Y=r.getTile(u).tileSize,ee=512/Math.min(Y,512)*(u.overscaledZ/x.transform.zoom)*.5,se=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(se+=` => ${u.overscaledZ}`),(function(ae,fe){ae.initDebugOverlayCanvas();let xe=ae.debugOverlayCanvas,de=ae.context.gl,ye=ae.debugOverlayCanvas.getContext("2d");ye.clearRect(0,0,xe.width,xe.height),ye.shadowColor="white",ye.shadowBlur=2,ye.lineWidth=1.5,ye.strokeStyle="white",ye.textBaseline="top",ye.font="bold 36px Open Sans, sans-serif",ye.fillText(fe,5,5),ye.strokeText(fe,5,5),ae.debugOverlayTexture.update(xe),ae.debugOverlayTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE)})(x,`${se} ${U}kB`);let le=x.transform.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!0});E.draw(p,g.TRIANGLES,C,M,li.alphaBlended,mn.disabled,Is(s.bp.transparent,ee),null,le,k,x.debugBuffer,x.quadTriangleIndexBuffer,x.debugSegments),E.draw(p,g.LINE_STRIP,C,M,R,mn.disabled,Is(s.bp.red),B,le,k,x.debugBuffer,x.tileBorderIndexBuffer,x.debugSegments)}function s_(x,r,u,p){let{isRenderingGlobe:g}=p,E=x.context,C=E.gl,M=x.transform,R=x.colorModeForRenderPass(),k=x.getDepthModeFor3D(),B=x.useProgram("terrain");E.bindFramebuffer.set(null),E.viewport.set([0,0,x.width,x.height]);for(let G of u){let U=r.getTerrainMesh(G.tileID),Y=x.renderToTexture.getTexture(G),ee=r.getTerrainData(G.tileID);E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,Y.texture);let se=r.getMeshFrameDelta(M.zoom),le=M.calculateFogMatrix(G.tileID.toUnwrapped()),ae=pp(se,le,x.style.sky,M.pitch,g),fe=M.getProjectionData({overscaledTileID:G.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});B.draw(E,C.TRIANGLES,k,An.disabled,R,mn.backCCW,ae,ee,fe,"terrain",U.vertexBuffer,U.indexBuffer,U.segments)}}function a_(x,r){if(!r.mesh){let u=new s.aW;u.emplaceBack(-1,-1),u.emplaceBack(1,-1),u.emplaceBack(1,1),u.emplaceBack(-1,1);let p=new s.aY;p.emplaceBack(0,1,2),p.emplaceBack(0,2,3),r.mesh=new ri(x.createVertexBuffer(u,Es.members),x.createIndexBuffer(p),s.aX.simpleSegment(0,0,u.length,p.length))}return r.mesh}class s0{constructor(r,u){this.context=new ie(r),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Mi.maxOverzooming+Mi.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ao}resize(r,u,p){if(this.width=Math.floor(r*p),this.height=Math.floor(u*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let g of this.style._order)this.style._layers[g].resize()}setup(){let r=this.context,u=new s.aW;u.emplaceBack(0,0),u.emplaceBack(s.a5,0),u.emplaceBack(0,s.a5),u.emplaceBack(s.a5,s.a5),this.tileExtentBuffer=r.createVertexBuffer(u,Es.members),this.tileExtentSegments=s.aX.simpleSegment(0,0,4,2);let p=new s.aW;p.emplaceBack(0,0),p.emplaceBack(s.a5,0),p.emplaceBack(0,s.a5),p.emplaceBack(s.a5,s.a5),this.debugBuffer=r.createVertexBuffer(p,Es.members),this.debugSegments=s.aX.simpleSegment(0,0,4,5);let g=new s.ch;g.emplaceBack(0,0,0,0),g.emplaceBack(s.a5,0,s.a5,0),g.emplaceBack(0,s.a5,0,s.a5),g.emplaceBack(s.a5,s.a5,s.a5,s.a5),this.rasterBoundsBuffer=r.createVertexBuffer(g,e_.members),this.rasterBoundsSegments=s.aX.simpleSegment(0,0,4,2);let E=new s.aW;E.emplaceBack(0,0),E.emplaceBack(s.a5,0),E.emplaceBack(0,s.a5),E.emplaceBack(s.a5,s.a5),this.rasterBoundsBufferPosOnly=r.createVertexBuffer(E,Es.members),this.rasterBoundsSegmentsPosOnly=s.aX.simpleSegment(0,0,4,5);let C=new s.aW;C.emplaceBack(0,0),C.emplaceBack(1,0),C.emplaceBack(0,1),C.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(C,Es.members),this.viewportSegments=s.aX.simpleSegment(0,0,4,2);let M=new s.ci;M.emplaceBack(0),M.emplaceBack(1),M.emplaceBack(3),M.emplaceBack(2),M.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(M);let R=new s.aY;R.emplaceBack(1,0,2),R.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(R);let k=this.context.gl;this.stencilClearMode=new An({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.tileExtentMesh=new ri(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){let r=this.context,u=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let p=s.N();s.c7(p,0,this.width,this.height,0,0,1),s.Q(p,p,[u.drawingBufferWidth,u.drawingBufferHeight,0]);let g={mainMatrix:p,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:p};this.useProgram("clippingMask",null,!0).draw(r,u.TRIANGLES,rn.disabled,this.stencilClearMode,li.disabled,mn.disabled,null,null,g,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,u,p){if(this.currentStencilSource===r.source||!r.isTileClipped()||!u||!u.length)return;this.currentStencilSource=r.source,this.nextStencilID+u.length>256&&this.clearStencil();let g=this.context;g.setColorMode(li.disabled),g.setDepthMode(rn.disabled);let E={};for(let C of u)E[C.key]=this.nextStencilID++;this._renderTileMasks(E,u,p,!0),this._renderTileMasks(E,u,p,!1),this._tileClippingMaskIDs=E}_renderTileMasks(r,u,p,g){let E=this.context,C=E.gl,M=this.style.projection,R=this.transform,k=this.useProgram("clippingMask");for(let B of u){let G=r[B.key],U=this.style.map.terrain&&this.style.map.terrain.getTerrainData(B),Y=M.getMeshFromTileID(this.context,B.canonical,g,!0,"stencil"),ee=R.getProjectionData({overscaledTileID:B,applyGlobeMatrix:!p,applyTerrainMatrix:!0});k.draw(E,C.TRIANGLES,rn.disabled,new An({func:C.ALWAYS,mask:0},G,255,C.KEEP,C.KEEP,C.REPLACE),li.disabled,p?mn.disabled:mn.backCCW,null,U,ee,"$clipping",Y.vertexBuffer,Y.indexBuffer,Y.segments)}}_renderTilesDepthBuffer(){let r=this.context,u=r.gl,p=this.style.projection,g=this.transform,E=this.useProgram("depth"),C=this.getDepthModeFor3D(),M=Mn(g,{tileSize:g.tileSize});for(let R of M){let k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(R),B=p.getMeshFromTileID(this.context,R.canonical,!0,!0,"raster"),G=g.getProjectionData({overscaledTileID:R,applyGlobeMatrix:!0,applyTerrainMatrix:!0});E.draw(r,u.TRIANGLES,C,An.disabled,li.disabled,mn.backCCW,null,k,G,"$clipping",B.vertexBuffer,B.indexBuffer,B.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let r=this.nextStencilID++,u=this.context.gl;return new An({func:u.NOTEQUAL,mask:255},r,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(r){let u=this.context.gl;return new An({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,u.KEEP,u.KEEP,u.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(r){let u=this.context.gl,p=r.sort((C,M)=>M.overscaledZ-C.overscaledZ),g=p[p.length-1].overscaledZ,E=p[0].overscaledZ-g+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();let C={};for(let M=0;M<E;M++)C[M+g]=new An({func:u.GEQUAL,mask:255},M+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=E,[C,p]}return[{[g]:An.disabled},p]}stencilConfigForOverlapTwoPass(r){let u=this.context.gl,p=r.sort((C,M)=>M.overscaledZ-C.overscaledZ),g=p[p.length-1].overscaledZ,E=p[0].overscaledZ-g+1;if(this.clearStencil(),E>1){let C={},M={};for(let R=0;R<E;R++)C[R+g]=new An({func:u.GREATER,mask:255},E+1+R,255,u.KEEP,u.KEEP,u.REPLACE),M[R+g]=new An({func:u.GREATER,mask:255},1+R,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID=2*E+1,[C,M,p]}return this.nextStencilID=3,[{[g]:new An({func:u.GREATER,mask:255},2,255,u.KEEP,u.KEEP,u.REPLACE)},{[g]:new An({func:u.GREATER,mask:255},1,255,u.KEEP,u.KEEP,u.REPLACE)},p]}colorModeForRenderPass(){let r=this.context.gl;return this._showOverdrawInspector?new li([r.CONSTANT_COLOR,r.ONE],new s.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?li.unblended:li.alphaBlended}getDepthModeForSublayer(r,u,p){if(!this.opaquePassEnabledForLayer())return rn.disabled;let g=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new rn(p||this.context.gl.LEQUAL,u,[g,g])}getDepthModeFor3D(){return new rn(this.context.gl.LEQUAL,rn.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,u){var p,g;this.style=r,this.options=u,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(q()),this.imageManager.beginFrame();let E=this.style._order,C=this.style.tileManagers,M={},R={},k={},B={isRenderingToTexture:!1,isRenderingGlobe:((p=r.projection)===null||p===void 0?void 0:p.transitionState)>0};for(let U in C){let Y=C[U];Y.used&&Y.prepare(this.context),M[U]=Y.getVisibleCoordinates(!1),R[U]=M[U].slice().reverse(),k[U]=Y.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let U=0;U<E.length;U++)if(this.style._layers[E[U]].is3D()){this.opaquePassCutoff=U;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(let U of E){let Y=this.style._layers[U];if(!Y.hasOffscreenPass()||Y.isHidden(this.transform.zoom))continue;let ee=R[Y.source];(Y.type==="custom"||ee.length)&&this.renderLayer(this,C[Y.source],Y,ee,B)}if((g=this.style.projection)===null||g===void 0||g.updateGPUdependent({context:this.context,useProgram:U=>this.useProgram(U)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?s.bp.black:s.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(U,Y){let ee=U.context,se=ee.gl,le=((Ee,_e,Ce)=>{let je=Math.cos(_e.rollInRadians),Ne=Math.sin(_e.rollInRadians),ze=Ge(_e),Be=_e.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Ee.properties.get("sky-color"),u_horizon_color:Ee.properties.get("horizon-color"),u_horizon:[(_e.width/2-ze*Ne)*Ce,(_e.height/2+ze*je)*Ce],u_horizon_normal:[-Ne,je],u_sky_horizon_blend:Ee.properties.get("sky-horizon-blend")*_e.height/2*Ce,u_sky_blend:Be}})(Y,U.style.map.transform,U.pixelRatio),ae=new rn(se.LEQUAL,rn.ReadWrite,[0,1]),fe=An.disabled,xe=U.colorModeForRenderPass(),de=U.useProgram("sky"),ye=a_(ee,Y);de.draw(ee,se.TRIANGLES,ae,fe,xe,mn.disabled,le,null,void 0,"sky",ye.vertexBuffer,ye.indexBuffer,ye.segments)})(this,this.style.sky),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(r._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=E.length-1;this.currentLayer>=0;this.currentLayer--){let U=this.style._layers[E[this.currentLayer]],Y=C[U.source],ee=M[U.source];this._renderTileClippingMasks(U,ee,!1),this.renderLayer(this,Y,U,ee,B)}this.renderPass="translucent";let G=!1;for(this.currentLayer=0;this.currentLayer<E.length;this.currentLayer++){let U=this.style._layers[E[this.currentLayer]],Y=C[U.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(U,B))continue;this.opaquePassEnabledForLayer()||G||(G=!0,B.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());let ee=(U.type==="symbol"?k:R)[U.source];this._renderTileClippingMasks(U,M[U.source],!!this.renderToTexture),this.renderLayer(this,Y,U,ee,B)}if(B.isRenderingGlobe&&(function(U,Y,ee){let se=U.context,le=se.gl,ae=U.useProgram("atmosphere"),fe=new rn(le.LEQUAL,rn.ReadOnly,[0,1]),xe=U.transform,de=(function(Be,lt){let ct=Be.properties.get("position"),Ye=[-ct.x,-ct.y,-ct.z],mt=s.ar(new Float64Array(16));return Be.properties.get("anchor")==="map"&&(s.bg(mt,mt,lt.rollInRadians),s.bh(mt,mt,-lt.pitchInRadians),s.bg(mt,mt,lt.bearingInRadians),s.bh(mt,mt,lt.center.lat*Math.PI/180),s.bJ(mt,mt,-lt.center.lng*Math.PI/180)),s.cg(Ye,Ye,mt),Ye})(ee,U.transform),ye=xe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ee=Y.properties.get("atmosphere-blend")*ye.projectionTransition;if(Ee===0)return;let _e=na(xe.worldSize,xe.center.lat),Ce=xe.inverseProjectionMatrix,je=new Float64Array(4);je[3]=1,s.aH(je,je,xe.modelViewProjectionMatrix),je[0]/=je[3],je[1]/=je[3],je[2]/=je[3],je[3]=1,s.aH(je,je,Ce),je[0]/=je[3],je[1]/=je[3],je[2]/=je[3],je[3]=1;let Ne=((Be,lt,ct,Ye,mt)=>({u_sun_pos:Be,u_atmosphere_blend:lt,u_globe_position:ct,u_globe_radius:Ye,u_inv_proj_matrix:mt}))(de,Ee,[je[0],je[1],je[2]],_e,Ce),ze=a_(se,Y);ae.draw(se,le.TRIANGLES,fe,An.disabled,li.alphaBlended,mn.disabled,Ne,null,null,"atmosphere",ze.vertexBuffer,ze.indexBuffer,ze.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){let U=(function(Y,ee){let se=null,le=Object.values(Y._layers).flatMap(de=>de.source&&!de.isHidden(ee)?[Y.tileManagers[de.source]]:[]),ae=le.filter(de=>de.getSource().type==="vector"),fe=le.filter(de=>de.getSource().type!=="vector"),xe=de=>{(!se||se.getSource().maxzoom<de.getSource().maxzoom)&&(se=de)};return ae.forEach(de=>xe(de)),se||fe.forEach(de=>xe(de)),se})(this.style,this.transform.zoom);U&&(function(Y,ee,se){for(let le=0;le<se.length;le++)o0(Y,ee,se[le])})(this,U,U.getVisibleCoordinates())}this.options.showPadding&&(function(U){let Y=U.transform.padding;r_(U,U.transform.height-(Y.top||0),3,t0),r_(U,Y.bottom||0,3,n0),o_(U,Y.left||0,3,i0),o_(U,U.transform.width-(Y.right||0),3,r0);let ee=U.transform.centerPoint;(function(se,le,ae,fe){Ld(se,le-1,ae-10,2,20,fe),Ld(se,le-10,ae-1,20,2,fe)})(U,ee.x,U.transform.height-ee.y,vc)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(r){if(!this.style||!this.style.map||!this.style.map.terrain)return;let u=this.terrainFacilitator.matrix,p=this.transform.modelViewProjectionMatrix,g=this.terrainFacilitator.dirty;g||(g=r?!s.cj(u,p):!s.ck(u,p)),g||(g=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),g&&(s.cl(u,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(E,C){let M=E.context,R=M.gl,k=E.transform,B=li.unblended,G=new rn(R.LEQUAL,rn.ReadWrite,[0,1]),U=C.tileManager.getRenderableTiles(),Y=E.useProgram("terrainDepth");M.bindFramebuffer.set(C.getFramebuffer("depth").framebuffer),M.viewport.set([0,0,E.width/devicePixelRatio,E.height/devicePixelRatio]),M.clear({color:s.bp.transparent,depth:1});for(let ee of U){let se=C.getTerrainMesh(ee.tileID),le=C.getTerrainData(ee.tileID),ae=k.getProjectionData({overscaledTileID:ee.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),fe={u_ele_delta:C.getMeshFrameDelta(k.zoom)};Y.draw(M,R.TRIANGLES,G,An.disabled,B,mn.backCCW,fe,le,ae,"terrain",se.vertexBuffer,se.indexBuffer,se.segments)}M.bindFramebuffer.set(null),M.viewport.set([0,0,E.width,E.height])})(this,this.style.map.terrain),(function(E,C){let M=E.context,R=M.gl,k=E.transform,B=li.unblended,G=new rn(R.LEQUAL,rn.ReadWrite,[0,1]),U=C.getCoordsTexture(),Y=C.tileManager.getRenderableTiles(),ee=E.useProgram("terrainCoords");M.bindFramebuffer.set(C.getFramebuffer("coords").framebuffer),M.viewport.set([0,0,E.width/devicePixelRatio,E.height/devicePixelRatio]),M.clear({color:s.bp.transparent,depth:1}),C.coordsIndex=[];for(let se of Y){let le=C.getTerrainMesh(se.tileID),ae=C.getTerrainData(se.tileID);M.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,U.texture);let fe={u_terrain_coords_id:(255-C.coordsIndex.length)/255,u_texture:0,u_ele_delta:C.getMeshFrameDelta(k.zoom)},xe=k.getProjectionData({overscaledTileID:se.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});ee.draw(M,R.TRIANGLES,G,An.disabled,B,mn.backCCW,fe,ae,xe,"terrain",le.vertexBuffer,le.indexBuffer,le.segments),C.coordsIndex.push(se.tileID.key)}M.bindFramebuffer.set(null),M.viewport.set([0,0,E.width,E.height])})(this,this.style.map.terrain))}renderLayer(r,u,p,g,E){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||(g||[]).length)&&(this.id=p.id,s.cm(p)?(function(C,M,R,k,B,G){if(C.renderPass!=="translucent")return;let{isRenderingToTexture:U}=G,Y=An.disabled,ee=C.colorModeForRenderPass();(R._unevaluatedLayout.hasValue("text-variable-anchor")||R._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(se,le,ae,fe,xe,de,ye,Ee,_e){let Ce=le.transform,je=le.style.map.terrain,Ne=xe==="map",ze=de==="map";for(let Be of se){let lt=fe.getTile(Be),ct=lt.getBucket(ae);if(!ct||!ct.text||!ct.text.segments.get().length)continue;let Ye=s.ay(ct.textSizeData,Ce.zoom),mt=s.aN(lt,1,le.transform.zoom),nn=so(Ne,le.transform,mt),oi=ae.layout.get("icon-text-fit")!=="none"&&ct.hasIconData();if(Ye){let Ii=Math.pow(2,Ce.zoom-lt.tileID.overscaledZ),gi=je?(Ri,_i)=>je.getElevation(Be,Ri,_i):null;Jt(ct,Ne,ze,_e,Ce,nn,Ii,Ye,oi,s.aO(Ce,lt,ye,Ee),Be.toUnwrapped(),gi)}}})(k,C,R,M,R.layout.get("text-rotation-alignment"),R.layout.get("text-pitch-alignment"),R.paint.get("text-translate"),R.paint.get("text-translate-anchor"),B),R.paint.get("icon-opacity").constantOr(1)!==0&&rr(C,M,R,k,!1,R.paint.get("icon-translate"),R.paint.get("icon-translate-anchor"),R.layout.get("icon-rotation-alignment"),R.layout.get("icon-pitch-alignment"),R.layout.get("icon-keep-upright"),Y,ee,U),R.paint.get("text-opacity").constantOr(1)!==0&&rr(C,M,R,k,!0,R.paint.get("text-translate"),R.paint.get("text-translate-anchor"),R.layout.get("text-rotation-alignment"),R.layout.get("text-pitch-alignment"),R.layout.get("text-keep-upright"),Y,ee,U),M.map.showCollisionBoxes&&(Fe(C,M,R,k,!0),Fe(C,M,R,k,!1))})(r,u,p,g,this.style.placement.variableOffsets,E):s.cn(p)?(function(C,M,R,k,B){if(C.renderPass!=="translucent")return;let{isRenderingToTexture:G}=B,U=R.paint.get("circle-opacity"),Y=R.paint.get("circle-stroke-width"),ee=R.paint.get("circle-stroke-opacity"),se=!R.layout.get("circle-sort-key").isConstant();if(U.constantOr(1)===0&&(Y.constantOr(1)===0||ee.constantOr(1)===0))return;let le=C.context,ae=le.gl,fe=C.transform,xe=C.getDepthModeForSublayer(0,rn.ReadOnly),de=An.disabled,ye=C.colorModeForRenderPass(),Ee=[],_e=fe.getCircleRadiusCorrection();for(let Ce=0;Ce<k.length;Ce++){let je=k[Ce],Ne=M.getTile(je),ze=Ne.getBucket(R);if(!ze)continue;let Be=R.paint.get("circle-translate"),lt=R.paint.get("circle-translate-anchor"),ct=s.aO(fe,Ne,Be,lt),Ye=ze.programConfigurations.get(R.id),mt=C.useProgram("circle",Ye),nn=ze.layoutVertexBuffer,oi=ze.indexBuffer,Ii=C.style.map.terrain&&C.style.map.terrain.getTerrainData(je),gi={programConfiguration:Ye,program:mt,layoutVertexBuffer:nn,indexBuffer:oi,uniformValues:Ad(C,Ne,R,ct,_e),terrainData:Ii,projectionData:fe.getProjectionData({overscaledTileID:je,applyGlobeMatrix:!G,applyTerrainMatrix:!0})};if(se){let Ri=ze.segments.get();for(let _i of Ri)Ee.push({segments:new s.aX([_i]),sortKey:_i.sortKey,state:gi})}else Ee.push({segments:ze.segments,sortKey:0,state:gi})}se&&Ee.sort((Ce,je)=>Ce.sortKey-je.sortKey);for(let Ce of Ee){let{programConfiguration:je,program:Ne,layoutVertexBuffer:ze,indexBuffer:Be,uniformValues:lt,terrainData:ct,projectionData:Ye}=Ce.state;Ne.draw(le,ae.TRIANGLES,xe,de,ye,mn.backCCW,lt,ct,Ye,R.id,ze,Be,Ce.segments,R.paint,C.transform.zoom,je)}})(r,u,p,g,E):s.co(p)?(function(C,M,R,k,B){if(R.paint.get("heatmap-opacity")===0)return;let G=C.context,{isRenderingToTexture:U,isRenderingGlobe:Y}=B;if(C.style.map.terrain){for(let ee of k){let se=M.getTile(ee);M.hasRenderableParent(ee)||(C.renderPass==="offscreen"?Oo(C,se,R,ee,Y):C.renderPass==="translucent"&&Xr(C,R,ee,U,Y))}G.viewport.set([0,0,C.width,C.height])}else C.renderPass==="offscreen"?(function(ee,se,le,ae){let fe=ee.context,xe=fe.gl,de=ee.transform,ye=An.disabled,Ee=new li([xe.ONE,xe.ONE],s.bp.transparent,[!0,!0,!0,!0]);(function(_e,Ce,je){let Ne=_e.gl;_e.activeTexture.set(Ne.TEXTURE1),_e.viewport.set([0,0,Ce.width/4,Ce.height/4]);let ze=je.heatmapFbos.get(s.cd);ze?(Ne.bindTexture(Ne.TEXTURE_2D,ze.colorAttachment.get()),_e.bindFramebuffer.set(ze.framebuffer)):(ze=Ds(_e,Ce.width/4,Ce.height/4),je.heatmapFbos.set(s.cd,ze))})(fe,ee,le),fe.clear({color:s.bp.transparent});for(let _e=0;_e<ae.length;_e++){let Ce=ae[_e];if(se.hasRenderableParent(Ce))continue;let je=se.getTile(Ce),Ne=je.getBucket(le);if(!Ne)continue;let ze=Ne.programConfigurations.get(le.id),Be=ee.useProgram("heatmap",ze),lt=de.getProjectionData({overscaledTileID:Ce,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),ct=de.getCircleRadiusCorrection();Be.draw(fe,xe.TRIANGLES,rn.disabled,ye,Ee,mn.backCCW,sa(je,de.zoom,le.paint.get("heatmap-intensity"),ct),null,lt,le.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,le.paint,de.zoom,ze)}fe.viewport.set([0,0,ee.width,ee.height])})(C,M,R,k):C.renderPass==="translucent"&&(function(ee,se){let le=ee.context,ae=le.gl;le.setColorMode(ee.colorModeForRenderPass());let fe=se.heatmapFbos.get(s.cd);fe&&(le.activeTexture.set(ae.TEXTURE0),ae.bindTexture(ae.TEXTURE_2D,fe.colorAttachment.get()),le.activeTexture.set(ae.TEXTURE1),Ch(le,se).bind(ae.LINEAR,ae.CLAMP_TO_EDGE),ee.useProgram("heatmapTexture").draw(le,ae.TRIANGLES,rn.disabled,An.disabled,ee.colorModeForRenderPass(),mn.disabled,yp(ee,se,0,1),null,null,se.id,ee.viewportBuffer,ee.quadTriangleIndexBuffer,ee.viewportSegments,se.paint,ee.transform.zoom))})(C,R)})(r,u,p,g,E):s.cp(p)?(function(C,M,R,k,B){if(C.renderPass!=="translucent")return;let{isRenderingToTexture:G}=B,U=R.paint.get("line-opacity"),Y=R.paint.get("line-width");if(U.constantOr(1)===0||Y.constantOr(1)===0)return;let ee=C.getDepthModeForSublayer(0,rn.ReadOnly),se=C.colorModeForRenderPass(),le=R.paint.get("line-dasharray"),ae=le.constantOr(1),fe=R.paint.get("line-pattern"),xe=fe.constantOr(1),de=R.paint.get("line-gradient"),ye=R.getCrossfadeParameters(),Ee;Ee=xe?"linePattern":ae&&de?"lineGradientSDF":ae?"lineSDF":de?"lineGradient":"line";let _e=C.context,Ce=_e.gl,je=C.transform,Ne=!0;for(let ze of k){let Be=M.getTile(ze);if(xe&&!Be.patternsLoaded())continue;let lt=Be.getBucket(R);if(!lt)continue;let ct=lt.programConfigurations.get(R.id),Ye=C.context.program.get(),mt=C.useProgram(Ee,ct),nn=Ne||mt.program!==Ye,oi=C.style.map.terrain&&C.style.map.terrain.getTerrainData(ze),Ii=fe.constantOr(null),gi=le&&le.constantOr(null);if(Ii&&Be.imageAtlas){let Mr=Be.imageAtlas,or=Mr.patternPositions[Ii.to.toString()],tr=Mr.patternPositions[Ii.from.toString()];or&&tr&&ct.setConstantPatternPositions(or,tr)}else if(gi){let Mr=R.layout.get("line-cap")==="round",or=C.lineAtlas.getDash(gi.to,Mr),tr=C.lineAtlas.getDash(gi.from,Mr);ct.setConstantDashPositions(or,tr)}let Ri=je.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!G,applyTerrainMatrix:!0}),_i=je.getPixelScale(),Yi;xe?(Yi=fs(C,Be,R,_i,ye),Ap(_e,Ce,Be,ct,ye)):ae&&de?(Yi=cu(C,Be,R,_i,ye,lt.lineClipsArray.length),uo(C,M,_e,Ce,R,lt,ze,ct,ye)):ae?(Yi=lu(C,Be,R,_i,ye),Pi(C,_e,Ce,ct,nn,ye)):de?(Yi=xp(C,Be,R,_i,lt.lineClipsArray.length),yl(C,M,_e,Ce,R,lt,ze)):Yi=Ss(C,Be,R,_i);let Li=C.stencilModeForClipping(ze);mt.draw(_e,Ce.TRIANGLES,ee,Li,se,mn.disabled,Yi,oi,Ri,R.id,lt.layoutVertexBuffer,lt.indexBuffer,lt.segments,R.paint,C.transform.zoom,ct,lt.layoutVertexBuffer2),Ne=!1}})(r,u,p,g,E):s.cq(p)?(function(C,M,R,k,B){let G=R.paint.get("fill-color"),U=R.paint.get("fill-opacity");if(U.constantOr(1)===0)return;let{isRenderingToTexture:Y}=B,ee=C.colorModeForRenderPass(),se=R.paint.get("fill-pattern"),le=C.opaquePassEnabledForLayer()&&!se.constantOr(1)&&G.constantOr(s.bp.transparent).a===1&&U.constantOr(0)===1?"opaque":"translucent";if(C.renderPass===le){let ae=C.getDepthModeForSublayer(1,C.renderPass==="opaque"?rn.ReadWrite:rn.ReadOnly);Ga(C,M,R,k,ae,ee,!1,Y)}if(C.renderPass==="translucent"&&R.paint.get("fill-antialias")){let ae=C.getDepthModeForSublayer(R.getPaintProperty("fill-outline-color")?2:0,rn.ReadOnly);Ga(C,M,R,k,ae,ee,!0,Y)}})(r,u,p,g,E):s.cr(p)?(function(C,M,R,k,B){let G=R.paint.get("fill-extrusion-opacity");if(G===0)return;let{isRenderingToTexture:U}=B;if(C.renderPass==="translucent"){let Y=new rn(C.context.gl.LEQUAL,rn.ReadWrite,C.depthRangeFor3D);if(G!==1||R.paint.get("fill-extrusion-pattern").constantOr(1))Ih(C,M,R,k,Y,An.disabled,li.disabled,U),Ih(C,M,R,k,Y,C.stencilModeFor3D(),C.colorModeForRenderPass(),U);else{let ee=C.colorModeForRenderPass();Ih(C,M,R,k,Y,An.disabled,ee,U)}}})(r,u,p,g,E):s.cs(p)?(function(C,M,R,k,B){if(C.renderPass!=="offscreen"&&C.renderPass!=="translucent")return;let{isRenderingToTexture:G}=B,U=C.context,Y=C.style.projection.useSubdivision,ee=C.getDepthModeForSublayer(0,rn.ReadOnly),se=C.colorModeForRenderPass();if(C.renderPass==="offscreen")(function(le,ae,fe,xe,de,ye,Ee){let _e=le.context,Ce=_e.gl;for(let je of fe){let Ne=ae.getTile(je),ze=Ne.dem;if(!ze||!ze.data||!Ne.needsHillshadePrepare)continue;let Be=ze.dim,lt=ze.stride,ct=ze.getPixels();if(_e.activeTexture.set(Ce.TEXTURE1),_e.pixelStoreUnpackPremultiplyAlpha.set(!1),Ne.demTexture=Ne.demTexture||le.getTileTexture(lt),Ne.demTexture){let mt=Ne.demTexture;mt.update(ct,{premultiply:!1}),mt.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE)}else Ne.demTexture=new s.T(_e,ct,Ce.RGBA,{premultiply:!1}),Ne.demTexture.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE);_e.activeTexture.set(Ce.TEXTURE0);let Ye=Ne.fbo;if(!Ye){let mt=new s.T(_e,{width:Be,height:Be,data:null},Ce.RGBA);mt.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),Ye=Ne.fbo=_e.createFramebuffer(Be,Be,!0,!1),Ye.colorAttachment.set(mt.texture)}_e.bindFramebuffer.set(Ye.framebuffer),_e.viewport.set([0,0,Be,Be]),le.useProgram("hillshadePrepare").draw(_e,Ce.TRIANGLES,de,ye,Ee,mn.disabled,t_(Ne.tileID,ze),null,null,xe.id,le.rasterBoundsBuffer,le.quadTriangleIndexBuffer,le.rasterBoundsSegments),Ne.needsHillshadePrepare=!1}})(C,M,k,R,ee,An.disabled,se),U.viewport.set([0,0,C.width,C.height]);else if(C.renderPass==="translucent")if(Y){let[le,ae,fe]=C.stencilConfigForOverlapTwoPass(k);$a(C,M,R,fe,le,ee,se,!1,G),$a(C,M,R,fe,ae,ee,se,!0,G)}else{let[le,ae]=C.getStencilConfigForOverlapAndUpdateStencilID(k);$a(C,M,R,ae,le,ee,se,!1,G)}})(r,u,p,g,E):s.ct(p)?(function(C,M,R,k,B){if(C.renderPass!=="translucent"||!k.length)return;let{isRenderingToTexture:G}=B,U=C.style.projection.useSubdivision,Y=C.getDepthModeForSublayer(0,rn.ReadOnly),ee=C.colorModeForRenderPass();if(U){let[se,le,ae]=C.stencilConfigForOverlapTwoPass(k);fu(C,M,R,ae,se,Y,ee,!1,G),fu(C,M,R,ae,le,Y,ee,!0,G)}else{let[se,le]=C.getStencilConfigForOverlapAndUpdateStencilID(k);fu(C,M,R,le,se,Y,ee,!1,G)}})(r,u,p,g,E):s.bU(p)?(function(C,M,R,k,B){if(C.renderPass!=="translucent"||R.paint.get("raster-opacity")===0||!k.length)return;let{isRenderingToTexture:G}=B,U=M.getSource(),Y=C.style.projection.useSubdivision;if(U instanceof $n)vl(C,M,R,k,null,!1,!1,U.tileCoords,U.flippedWindingOrder,G);else if(Y){let[ee,se,le]=C.stencilConfigForOverlapTwoPass(k);vl(C,M,R,le,ee,!1,!0,ua,!1,G),vl(C,M,R,le,se,!0,!0,ua,!1,G)}else{let[ee,se]=C.getStencilConfigForOverlapAndUpdateStencilID(k);vl(C,M,R,se,ee,!1,!0,ua,!1,G)}})(r,u,p,g,E):s.cu(p)?(function(C,M,R,k,B){let G=R.paint.get("background-color"),U=R.paint.get("background-opacity");if(U===0)return;let{isRenderingToTexture:Y}=B,ee=C.context,se=ee.gl,le=C.style.projection,ae=C.transform,fe=ae.tileSize,xe=R.paint.get("background-pattern");if(C.isPatternMissing(xe))return;let de=!xe&&G.a===1&&U===1&&C.opaquePassEnabledForLayer()?"opaque":"translucent";if(C.renderPass!==de)return;let ye=An.disabled,Ee=C.getDepthModeForSublayer(0,de==="opaque"?rn.ReadWrite:rn.ReadOnly),_e=C.colorModeForRenderPass(),Ce=C.useProgram(xe?"backgroundPattern":"background"),je=k||Mn(ae,{tileSize:fe,terrain:C.style.map.terrain});xe&&(ee.activeTexture.set(se.TEXTURE0),C.imageManager.bind(C.context));let Ne=R.getCrossfadeParameters();for(let ze of je){let Be=ae.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!Y,applyTerrainMatrix:!0}),lt=xe?n_(U,C,xe,{tileID:ze,tileSize:fe},Ne):yh(U,G),ct=C.style.map.terrain&&C.style.map.terrain.getTerrainData(ze),Ye=le.getMeshFromTileID(ee,ze.canonical,!1,!0,"raster");Ce.draw(ee,se.TRIANGLES,Ee,ye,_e,mn.backCCW,lt,ct,Be,R.id,Ye.vertexBuffer,Ye.indexBuffer,Ye.segments)}})(r,0,p,g,E):s.cv(p)&&(function(C,M,R,k){let{isRenderingGlobe:B}=k,G=C.context,U=R.implementation,Y=C.style.projection,ee=C.transform,se=ee.getProjectionDataForCustomLayer(B),le={farZ:ee.farZ,nearZ:ee.nearZ,fov:ee.fov*Math.PI/180,modelViewProjectionMatrix:ee.modelViewProjectionMatrix,projectionMatrix:ee.projectionMatrix,shaderData:{variantName:Y.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${Y.shaderPreludeCode.vertexSource}`,define:Y.shaderDefine},defaultProjectionData:se},ae=U.renderingMode?U.renderingMode:"2d";if(C.renderPass==="offscreen"){let fe=U.prerender;fe&&(C.setCustomLayerDefaults(),G.setColorMode(C.colorModeForRenderPass()),fe.call(U,G.gl,le),G.setDirty(),C.setBaseState())}else if(C.renderPass==="translucent"){C.setCustomLayerDefaults(),G.setColorMode(C.colorModeForRenderPass()),G.setStencilMode(An.disabled);let fe=ae==="3d"?C.getDepthModeFor3D():C.getDepthModeForSublayer(0,rn.ReadOnly);G.setDepthMode(fe),U.render(G.gl,le),G.setDirty(),C.setBaseState(),G.bindFramebuffer.set(null)}})(r,0,p,E))}saveTileTexture(r){let u=this._tileTextures[r.size[0]];u?u.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){let u=this._tileTextures[r];return u&&u.length>0?u.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;let u=this.imageManager.getPattern(r.from.toString()),p=this.imageManager.getPattern(r.to.toString());return!u||!p}useProgram(r,u,p=!1,g=[]){this.cache=this.cache||{};let E=!!this.style.map.terrain,C=this.style.projection,M=p?Vn.projectionMercator:C.shaderPreludeCode,R=p?vr:C.shaderDefine,k=r+(u?u.cacheKey:"")+`/${p?Wr:C.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(E?"/terrain":"")+(g?`/${g.join("/")}`:"");return this.cache[k]||(this.cache[k]=new dl(this.context,Vn[r],u,i_[r],this._showOverdrawInspector,E,M,R,g)),this.cache[k]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var r,u;if(this._tileTextures){for(let p in this._tileTextures){let g=this._tileTextures[p];if(g)for(let E of g)E.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((r=this.tileExtentMesh.vertexBuffer)===null||r===void 0||r.destroy()),this.tileExtentMesh&&((u=this.tileExtentMesh.indexBuffer)===null||u===void 0||u.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(let p in this.cache){let g=this.cache[p];g&&g.program&&this.context.gl.deleteProgram(g.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){let{drawingBufferWidth:r,drawingBufferHeight:u}=this.context.gl;return this.width!==r||this.height!==u}}function l_(x,r){let u,p=!1,g=null,E=null,C=()=>{g=null,p&&(x.apply(E,u),g=setTimeout(C,r),p=!1)};return(...M)=>(p=!0,E=this,u=M,g||C(),g)}class c_{constructor(r){this._getCurrentHash=()=>{let u=window.location.hash.replace("#","");if(this._hashName){let p;return u.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(p=g)}),(p&&p[1]||"").split("/")}return u.split("/")},this._onHashChange=()=>{let u=this._getCurrentHash();if(!this._isValidHash(u))return!1;let p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:p,pitch:+(u[4]||0)}),!0},this._updateHashUnthrottled=()=>{let u=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,u)},this._removeHash=()=>{let u=this._getCurrentHash();if(u.length===0)return;let p=u.join("/"),g=p;g.split("&").length>0&&(g=g.split("&")[0]),this._hashName&&(g=`${this._hashName}=${p}`);let E=window.location.hash.replace(g,"");E.startsWith("#&")?E=E.slice(0,1)+E.slice(2):E==="#"&&(E="");let C=window.location.href.replace(/(#.+)?$/,E);C=C.replace("&&","&"),window.history.replaceState(window.history.state,null,C)},this._updateHash=l_(this._updateHashUnthrottled,300),this._hashName=r&&encodeURIComponent(r)}addTo(r){return this._map=r,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(r){let u=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,g=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,g),C=Math.round(u.lng*E)/E,M=Math.round(u.lat*E)/E,R=this._map.getBearing(),k=this._map.getPitch(),B="";if(B+=r?`/${C}/${M}/${p}`:`${p}/${M}/${C}`,(R||k)&&(B+="/"+Math.round(10*R)/10),k&&(B+=`/${Math.round(k)}`),this._hashName){let G=this._hashName,U=!1,Y=window.location.hash.slice(1).split("&").map(ee=>{let se=ee.split("=")[0];return se===G?(U=!0,`${se}=${B}`):ee}).filter(ee=>ee);return U||Y.push(`${G}=${B}`),`#${Y.join("&")}`}return`#${B}`}_isValidHash(r){if(r.length<3||r.some(isNaN))return!1;try{new s.V(+r[2],+r[1])}catch{return!1}let u=+r[0],p=+(r[3]||0),g=+(r[4]||0);return u>=this._map.getMinZoom()&&u<=this._map.getMaxZoom()&&p>=-180&&p<=180&&g>=this._map.getMinPitch()&&g<=this._map.getMaxPitch()}}let xc={linearity:.3,easing:s.cw(0,0,.3,1)},a0=s.e({deceleration:2500,maxSpeed:1400},xc),Ms=s.e({deceleration:20,maxSpeed:1400},xc),ha=s.e({deceleration:1e3,maxSpeed:360},xc),l0=s.e({deceleration:1e3,maxSpeed:90},xc),da=s.e({deceleration:1e3,maxSpeed:360},xc);class Y1{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:q(),settings:r})}_drainInertiaBuffer(){let r=this._inertiaBuffer,u=q();for(;r.length>0&&u-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let u={zoom:0,bearing:0,pitch:0,roll:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:E}of this._inertiaBuffer)u.zoom+=E.zoomDelta||0,u.bearing+=E.bearingDelta||0,u.pitch+=E.pitchDelta||0,u.roll+=E.rollDelta||0,E.panDelta&&u.pan._add(E.panDelta),E.around&&(u.around=E.around),E.pinchAround&&(u.pinchAround=E.pinchAround);let p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(u.pan.mag()){let E=kd(u.pan.mag(),p,s.e({},a0,r||{})),C=u.pan.mult(E.amount/u.pan.mag()),M=this._map.cameraHelper.handlePanInertia(C,this._map.transform);g.center=M.easingCenter,g.offset=M.easingOffset,Od(g,E)}if(u.zoom){let E=kd(u.zoom,p,Ms),C=s.cx(this._map.transform.zoom+E.amount,this._map.getZoomSnap(),E.amount);g.zoom=C,Od(g,E)}if(u.bearing){let E=kd(u.bearing,p,ha);g.bearing=this._map.transform.bearing+s.an(E.amount,-179,179),Od(g,E)}if(u.pitch){let E=kd(u.pitch,p,l0);g.pitch=this._map.transform.pitch+E.amount,Od(g,E)}if(u.roll){let E=kd(u.roll,p,da);g.roll=this._map.transform.roll+s.an(E.amount,-179,179),Od(g,E)}if(g.zoom||g.bearing){let E=u.pinchAround===void 0?u.around:u.pinchAround;g.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),s.e(g,{noMoveStart:!0})}}function Od(x,r){(!x.duration||x.duration<r.duration)&&(x.duration=r.duration,x.easing=r.easing)}function kd(x,r,u){let{maxSpeed:p,linearity:g,deceleration:E}=u,C=s.an(x*g/(r/1e3),-p,p),M=Math.abs(C)/(E*g);return{easing:u.easing,duration:1e3*M,amount:C*(M/2)}}class Dr extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u,p,g={}){p=p instanceof MouseEvent?p:new MouseEvent(r,p);let E=W.mousePos(u.getCanvas(),p),C=u.unproject(E);super(r,s.e({point:E,lngLat:C,originalEvent:p},g)),this._defaultPrevented=!1,this.target=u}}class Fd extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u,p){let g=r==="touchend"?p.changedTouches:p.touches,E=W.touchPos(u.getCanvasContainer(),g),C=E.map(R=>u.unproject(R)),M=E.reduce((R,k,B,G)=>R.add(k.div(G.length)),new s.P(0,0));super(r,{points:E,point:M,lngLats:C,lngLat:u.unproject(M),originalEvent:p}),this._defaultPrevented=!1}}class c0 extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u,p){super(r,{originalEvent:p}),this._defaultPrevented=!1}}class K1{constructor(r,u){this._map=r,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new c0(r.type,this._map,r))}mousedown(r,u){return this._mousedownPos=u,this._firePreventable(new Dr(r.type,this._map,r))}mouseup(r){this._map.fire(new Dr(r.type,this._map,r))}click(r,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new Dr(r.type,this._map,r))}dblclick(r){return this._firePreventable(new Dr(r.type,this._map,r))}mouseover(r){this._map.fire(new Dr(r.type,this._map,r))}mouseout(r){this._map.fire(new Dr(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Fd(r.type,this._map,r))}touchmove(r){this._map.fire(new Fd(r.type,this._map,r))}touchend(r){this._map.fire(new Fd(r.type,this._map,r))}touchcancel(r){this._map.fire(new Fd(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class J1{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(r){this._map.fire(new Dr(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Dr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._ignoreContextMenu||this._map.fire(new Dr(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sh{constructor(r){this._map=r}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(r){return this.transform.screenPointToLocation(s.P.convert(r),this._map.terrain)}}class Dh{constructor(r,u){this._map=r,this._tr=new Sh(r),this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,u){this.isEnabled()&&r.shiftKey&&r.button===0&&(W.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(r,u){if(!this._active)return;let p=u;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;let g=this._startPos;this._lastPos=p,this._box||(this._box=W.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",r));let E=Math.min(g.x,p.x),C=Math.max(g.x,p.x),M=Math.min(g.y,p.y),R=Math.max(g.y,p.y);W.setTransform(this._box,`translate(${E}px,${M}px)`),this._box.style.width=C-E+"px",this._box.style.height=R-M+"px"}mouseupWindow(r,u){if(!this._active||r.button!==0)return;let p=this._startPos,g=u;if(this.reset(),W.suppressClick(),p.x!==g.x||p.y!==g.y)return this._map.fire(new s.l("boxzoomend",{originalEvent:r})),{cameraAnimation:E=>E.fitScreenCoordinates(p,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(W.remove(this._box),this._box=null),W.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,u){return this._map.fire(new s.l(r,{originalEvent:u}))}}function fa(x,r){if(x.length!==r.length)throw new Error(`The number of touches and points are not equal - touches ${x.length}, points ${r.length}`);let u={};for(let p=0;p<x.length;p++)u[x[p].identifier]=r[p];return u}class wt{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,u,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=(function(g){let E=new s.P(0,0);for(let C of g)E._add(C);return E.div(g.length)})(u),this.touches=fa(p,u)))}touchmove(r,u,p){if(this.aborted||!this.centroid)return;let g=fa(p,u);for(let E in this.touches){let C=g[E];(!C||C.dist(this.touches[E])>30)&&(this.aborted=!0)}}touchend(r,u,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){let g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Lp{constructor(r){this.singleTap=new wt(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,u,p){this.singleTap.touchstart(r,u,p)}touchmove(r,u,p){this.singleTap.touchmove(r,u,p)}touchend(r,u,p){let g=this.singleTap.touchend(r,u,p);if(g){let E=r.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(g)<30;if(E&&C||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class u_{constructor(r){this._tr=new Sh(r),this._zoomIn=new Lp({numTouches:1,numTaps:2}),this._zoomOut=new Lp({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,u,p){this._zoomIn.touchstart(r,u,p),this._zoomOut.touchstart(r,u,p)}touchmove(r,u,p){this._zoomIn.touchmove(r,u,p),this._zoomOut.touchmove(r,u,p)}touchend(r,u,p){let g=this._zoomIn.touchend(r,u,p),E=this._zoomOut.touchend(r,u,p),C=this._tr;return g?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:s.cx(C.zoom+1,M.getZoomSnap()),around:C.unproject(g)},{originalEvent:r})}):E?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:s.cx(C.zoom-1,M.getZoomSnap()),around:C.unproject(E)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mh{constructor(r){this._enabled=!!r.enable,this._moveStateManager=r.moveStateManager,this._clickTolerance=r.clickTolerance||1,this._moveFunction=r.move,this._activateOnStart=!!r.activateOnStart,r.assignEvents(this),this.reset()}reset(r){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(r)}_move(...r){let u=this._moveFunction(...r);if(u.bearingDelta||u.pitchDelta||u.rollDelta||u.around||u.panDelta)return this._active=!0,u}dragStart(r,u){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(r)&&(this._moveStateManager.startMove(r),this._lastPoint=Array.isArray(u)?u[0]:u,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(r,u){if(!this.isEnabled())return;let p=this._lastPoint;if(!p)return;if(r.preventDefault(),!this._moveStateManager.isValidMoveEvent(r))return void this.reset(r);let g=Array.isArray(u)?u[0]:u;return!this._moved&&g.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(p,g))}dragEnd(r){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(r)&&(this._moved&&W.suppressClick(),this.reset(r))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let Nd=0,zd=2,h_={[Nd]:1,[zd]:2};class Bd{constructor(r){this._correctEvent=r.checkCorrectEvent}startMove(r){let u=W.mouseButton(r);this._eventButton=u}endMove(r){delete this._eventButton}isValidStartEvent(r){return this._correctEvent(r)}isValidMoveEvent(r){return!(function(u,p){let g=h_[p];return u.buttons===void 0||(u.buttons&g)!==g})(r,this._eventButton)}isValidEndEvent(r){return W.mouseButton(r)===this._eventButton}}class d_{constructor(){this._firstTouch=void 0}_isOneFingerTouch(r){return r.targetTouches.length===1}_isSameTouchEvent(r){return r.targetTouches[0].identifier===this._firstTouch}startMove(r){this._firstTouch=r.targetTouches[0].identifier}endMove(r){delete this._firstTouch}isValidStartEvent(r){return this._isOneFingerTouch(r)}isValidMoveEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}isValidEndEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}}class u0{constructor(r=new Bd({checkCorrectEvent:()=>!0}),u=new d_){this.mouseMoveStateManager=r,this.oneFingerTouchMoveStateManager=u}_executeRelevantHandler(r,u,p){return r instanceof MouseEvent?u(r):typeof TouchEvent<"u"&&r instanceof TouchEvent?p(r):void 0}startMove(r){this._executeRelevantHandler(r,u=>this.mouseMoveStateManager.startMove(u),u=>this.oneFingerTouchMoveStateManager.startMove(u))}endMove(r){this._executeRelevantHandler(r,u=>this.mouseMoveStateManager.endMove(u),u=>this.oneFingerTouchMoveStateManager.endMove(u))}isValidStartEvent(r){return this._executeRelevantHandler(r,u=>this.mouseMoveStateManager.isValidStartEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidStartEvent(u))}isValidMoveEvent(r){return this._executeRelevantHandler(r,u=>this.mouseMoveStateManager.isValidMoveEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(u))}isValidEndEvent(r){return this._executeRelevantHandler(r,u=>this.mouseMoveStateManager.isValidEndEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidEndEvent(u))}}let Ph=x=>{x.mousedown=x.dragStart,x.mousemoveWindow=x.dragMove,x.mouseup=x.dragEnd,x.contextmenu=r=>{r.preventDefault()}};class Q1{constructor(r,u){this._clickTolerance=r.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}_shouldBePrevented(r){return r<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(r,u,p){return this._calculateTransform(r,u,p)}touchmove(r,u,p){if(this._active){if(!this._shouldBePrevented(p.length))return r.preventDefault(),this._calculateTransform(r,u,p);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",r)}}touchend(r,u,p){this._calculateTransform(r,u,p),this._active&&this._shouldBePrevented(p.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,u,p){p.length>0&&(this._active=!0);let g=fa(p,u),E=new s.P(0,0),C=new s.P(0,0),M=0;for(let k in g){let B=g[k],G=this._touches[k];G&&(E._add(B),C._add(B.sub(G)),M++,g[k]=B)}if(this._touches=g,this._shouldBePrevented(M)||!C.mag())return;let R=C.div(M);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(M),panDelta:R}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Op{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(r,u,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([u[0],u[1]]))}touchmove(r,u,p){if(!this._firstTwoTouches)return;r.preventDefault();let[g,E]=this._firstTwoTouches,C=kp(p,u,g),M=kp(p,u,E);if(!C||!M)return;let R=this._aroundCenter?null:C.add(M).div(2);return this._move([C,M],R,r)}touchend(r,u,p){if(!this._firstTwoTouches)return;let[g,E]=this._firstTwoTouches,C=kp(p,u,g),M=kp(p,u,E);C&&M||(this._active&&W.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function kp(x,r,u){for(let p=0;p<x.length;p++)if(x[p].identifier===u)return r[p]}function h0(x,r){return Math.log(x/r)/Math.LN2}class f_ extends Op{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,u){let p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(h0(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:h0(this._distance,p),pinchAround:u}}}function d0(x,r){return 180*x.angleWith(r)/Math.PI}class p_ extends Op{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,u,p){let g=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:d0(this._vector,g),pinchAround:u}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());let u=25/(Math.PI*this._minDiameter)*360,p=d0(r,this._startVector);return Math.abs(p)<u}}function m_(x){return Math.abs(x.y)>Math.abs(x.x)}class f0 extends Op{constructor(r){super(),this._currentTouchCount=0,this._map=r}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(r,u,p){super.touchstart(r,u,p),this._currentTouchCount=p.length}_start(r){this._lastPoints=r,m_(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,u,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let g=r[0].sub(this._lastPoints[0]),E=r[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,E,p.timeStamp),this._valid?(this._lastPoints=r,this._active=!0,{pitchDelta:(g.y+E.y)/2*-.5}):void 0}gestureBeginsVertically(r,u,p){if(this._valid!==void 0)return this._valid;let g=r.mag()>=2,E=u.mag()>=2;if(!g&&!E)return;if(!g||!E)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;let C=r.y>0==u.y>0;return m_(r)&&m_(u)&&C}}let bc={panStep:100,bearingStep:15,pitchStep:10};class ui{constructor(r){this._tr=new Sh(r);let u=bc;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let u=0,p=0,g=0,E=0,C=0;switch(r.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),E=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),E=1);break;case 38:r.shiftKey?g=1:(r.preventDefault(),C=-1);break;case 40:r.shiftKey?g=-1:(r.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(p=0,g=0),{cameraAnimation:M=>{let R=this._tr;M.easeTo({duration:300,easeId:"keyboardHandler",easing:eE,zoom:u?s.cx(R.zoom+u*(r.shiftKey?2:1),M.getZoomSnap()):R.zoom,bearing:R.bearing+p*this._bearingStep,pitch:R.pitch+g*this._pitchStep,offset:[-E*this._panStep,-C*this._panStep],center:R.center},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function eE(x){return x*(2-x)}let jd=4.000244140625,Fp=1/450;class Np{constructor(r,u){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=r,this._tr=new Sh(r),this._triggerRenderFrame=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Fp}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(r){return!!this._map.cooperativeGestures.isEnabled()&&!(r.ctrlKey||this._map.cooperativeGestures.isBypassed(r))}wheel(r){if(!this.isEnabled())return;if(this._shouldBePrevented(r))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",r);let u=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY,p=q(),g=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,u!==0&&u%jd==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(g*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),r.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=r,this._delta-=u,this._active||this._start(r)),r.preventDefault()}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let u=W.mousePos(this._map.getCanvas(),r),p=this._tr;this._aroundPoint=this._aroundCenter?p.transform.locationToScreenPoint(s.V.convert(p.center)):u,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let r=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){let M=r.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=M),typeof this._targetZoom=="number"&&(this._targetZoom+=M)}if(this._delta!==0){let M=this._type==="wheel"&&Math.abs(this._delta)>jd?this._wheelZoomRate:this._defaultZoomRate,R=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&R!==0&&(R=1/R);let k=typeof this._targetZoom!="number"?r.scale:s.aq(this._targetZoom),B=r.applyConstrain(r.getCameraLngLat(),s.at(k*R)).zoom,G=this._map.getZoomSnap();if(this._type==="wheel"&&G>0){let U=s.cx(r.zoom,G);this._targetZoom=s.cx(B,G,B-U)}else this._targetZoom=B;this._type==="wheel"&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let u=typeof this._targetZoom!="number"?r.zoom:this._targetZoom,p=this._startZoom,g=this._easing,E,C=!1;if(this._type==="wheel"&&p&&g){let M=q()-this._lastWheelEventTime,R=Math.min((M+5)/200,1),k=g(R);E=s.G.number(p,u,k),R<1?this._frameId||(this._frameId=!0):C=!0}else E=u,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=E,{noInertia:!0,needsRenderFrame:!C,zoomDelta:E-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let u=s.cz;if(this._prevEase){let p=this._prevEase,g=(q()-p.start)/p.duration,E=p.easing(g+.01)-p.easing(g),C=.27/Math.sqrt(E*E+1e-4)*.01,M=Math.sqrt(.0729-C*C);u=s.cw(C,M,.25,1)}return this._prevEase={start:q(),duration:r,easing:u},u}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class g_{constructor(r,u){this._clickZoom=r,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class p0{constructor(r){this._tr=new Sh(r),this.reset()}reset(){this._active=!1}dblclick(r,u){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:s.cx(this._tr.zoom+(r.shiftKey?-1:1),p.getZoomSnap()),around:this._tr.unproject(u)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class m0{constructor(){this._tap=new Lp({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(r,u,p){if(!this._swipePoint)if(this._tapTime){let g=u[0],E=r.timeStamp-this._tapTime<500,C=this._tapPoint.dist(g)<30;E&&C?p.length>0&&(this._swipePoint=g,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(r,u,p)}touchmove(r,u,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;let g=u[0],E=g.y-this._swipePoint.y;return this._swipePoint=g,r.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(r,u,p)}touchend(r,u,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{let g=this._tap.touchend(r,u,p);g&&(this._tapTime=r.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class g0{constructor(r,u,p){this._el=r,this._mousePan=u,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class pa{constructor(r,u,p,g){this._pitchWithRotate=r.pitchWithRotate,this._rollEnabled=r.rollEnabled,this._mouseRotate=u,this._mousePitch=p,this._mouseRoll=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Vd{constructor(r,u,p,g){this._el=r,this._touchZoom=u,this._touchRotate=p,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Lt{constructor(r,u){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=r,this._options=u,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let r=this._map.getCanvasContainer();r.classList.add("maplibregl-cooperative-gestures"),this._container=W.create("div","maplibregl-cooperative-gesture-screen",r);let u=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(u=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));let p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),g=document.createElement("div");g.className="maplibregl-desktop-message",g.textContent=u,this._container.appendChild(g);let E=document.createElement("div");E.className="maplibregl-mobile-message",E.textContent=p,this._container.appendChild(E),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(W.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(r){return r[this._bypassKey]}notifyGestureBlocked(r,u){this._enabled&&(this._map.fire(new s.l("cooperativegestureprevented",{gestureType:r,originalEvent:u})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}let zt=x=>x.zoom||x.drag||x.roll||x.pitch||x.rotate;class Ud extends s.l{}function zp(x){return x.panDelta&&x.panDelta.mag()||x.zoomDelta||x.bearingDelta||x.pitchDelta||x.rollDelta}class Bp{get _ownerDocument(){var r;return((r=this._el)===null||r===void 0?void 0:r.ownerDocument)||document}get _ownerWindow(){var r,u;return((u=(r=this._el)===null||r===void 0?void 0:r.ownerDocument)===null||u===void 0?void 0:u.defaultView)||window}constructor(r,u){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,E)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let C=g.type==="renderFrame"?void 0:g,M={needsRenderFrame:!1},R={},k={};for(let{handlerName:U,handler:Y,allowed:ee}of this._handlers){if(!Y.isEnabled())continue;let se;if(this._blockedByActive(k,ee,U))Y.reset();else if(Y[E||g.type]){if(s.cA(g,E||g.type)){let le=W.mousePos(this._map.getCanvas(),g);se=Y[E||g.type](g,le)}else if(s.cB(g,E||g.type)){let le=this._getMapTouches(g.touches),ae=W.touchPos(this._map.getCanvas(),le);se=Y[E||g.type](g,ae,le)}else s.cC(E||g.type)||(se=Y[E||g.type](g));this.mergeHandlerResult(M,R,se,U,C),se&&se.needsRenderFrame&&this._triggerRenderFrame()}(se||Y.isActive())&&(k[U]=Y)}let B={};for(let U in this._previousActiveHandlers)k[U]||(B[U]=C);this._previousActiveHandlers=k,(Object.keys(B).length||zp(M))&&(this._changes.push([M,R,B]),this._triggerRenderFrame()),(Object.keys(k).length||zp(M))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:G}=M;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))},this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Y1(r),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u);let p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[this._ownerDocument,"mousemove",{capture:!0}],[this._ownerDocument,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[this._ownerWindow,"blur",void 0]];for(let[g,E,C]of this._listeners)W.addEventListener(g,E,g===this._ownerDocument?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(let[r,u,p]of this._listeners)W.removeEventListener(r,u,r===this._ownerDocument?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(r){let u=this._map,p=u.getCanvasContainer();this._add("mapEvent",new K1(u,r));let g=u.boxZoom=new Dh(u,r);this._add("boxZoom",g),r.interactive&&r.boxZoom&&g.enable();let E=u.cooperativeGestures=new Lt(u,r.cooperativeGestures);this._add("cooperativeGestures",E),r.cooperativeGestures&&E.enable();let C=new u_(u),M=new p0(u);u.doubleClickZoom=new g_(M,C),this._add("tapZoom",C),this._add("clickZoom",M),r.interactive&&r.doubleClickZoom&&u.doubleClickZoom.enable();let R=new m0;this._add("tapDragZoom",R);let k=u.touchPitch=new f0(u);this._add("touchPitch",k),r.interactive&&r.touchPitch&&u.touchPitch.enable(r.touchPitch);let B=()=>u.project(u.getCenter()),G=(function({enable:de,clickTolerance:ye,aroundCenter:Ee=!0,minPixelCenterThreshold:_e=100,rotateDegreesPerPixelMoved:Ce=.8},je){let Ne=new Bd({checkCorrectEvent:ze=>W.mouseButton(ze)===0&&ze.ctrlKey||W.mouseButton(ze)===2&&!ze.ctrlKey});return new Mh({clickTolerance:ye,move:(ze,Be)=>{let lt=je();if(Ee&&Math.abs(lt.y-ze.y)>_e)return{bearingDelta:s.cy(new s.P(ze.x,Be.y),Be,lt)};let ct=(Be.x-ze.x)*Ce;return Ee&&Be.y<lt.y&&(ct=-ct),{bearingDelta:ct}},moveStateManager:Ne,enable:de,assignEvents:Ph})})(r,B),U=(function({enable:de,clickTolerance:ye,pitchDegreesPerPixelMoved:Ee=-.5}){let _e=new Bd({checkCorrectEvent:Ce=>W.mouseButton(Ce)===0&&Ce.ctrlKey||W.mouseButton(Ce)===2});return new Mh({clickTolerance:ye,move:(Ce,je)=>({pitchDelta:(je.y-Ce.y)*Ee}),moveStateManager:_e,enable:de,assignEvents:Ph})})(r),Y=(function({enable:de,clickTolerance:ye,rollDegreesPerPixelMoved:Ee=.3},_e){let Ce=new Bd({checkCorrectEvent:je=>W.mouseButton(je)===2&&je.ctrlKey});return new Mh({clickTolerance:ye,move:(je,Ne)=>{let ze=_e(),Be=(Ne.x-je.x)*Ee;return Ne.y<ze.y&&(Be=-Be),{rollDelta:Be}},moveStateManager:Ce,enable:de,assignEvents:Ph})})(r,B);u.dragRotate=new pa(r,G,U,Y),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",U,["mouseRotate","mouseRoll"]),this._add("mouseRoll",Y,["mousePitch"]),r.interactive&&r.dragRotate&&u.dragRotate.enable();let ee=(function({enable:de,clickTolerance:ye}){let Ee=new Bd({checkCorrectEvent:_e=>W.mouseButton(_e)===0&&!_e.ctrlKey});return new Mh({clickTolerance:ye,move:(_e,Ce)=>({around:Ce,panDelta:Ce.sub(_e)}),activateOnStart:!0,moveStateManager:Ee,enable:de,assignEvents:Ph})})(r),se=new Q1(r,u);u.dragPan=new g0(p,ee,se),this._add("mousePan",ee),this._add("touchPan",se,["touchZoom","touchRotate"]),r.interactive&&r.dragPan&&u.dragPan.enable(r.dragPan);let le=new p_,ae=new f_;u.touchZoomRotate=new Vd(p,ae,le,R),this._add("touchRotate",le,["touchPan","touchZoom"]),this._add("touchZoom",ae,["touchPan","touchRotate"]),r.interactive&&r.touchZoomRotate&&u.touchZoomRotate.enable(r.touchZoomRotate),this._add("blockableMapEvent",new J1(u));let fe=u.scrollZoom=new Np(u,()=>this._triggerRenderFrame());this._add("scrollZoom",fe,["mousePan"]),r.interactive&&r.scrollZoom&&u.scrollZoom.enable(r.scrollZoom);let xe=u.keyboard=new ui(u);this._add("keyboard",xe),r.interactive&&r.keyboard&&u.keyboard.enable()}_add(r,u,p){this._handlers.push({handlerName:r,handler:u,allowed:p}),this._handlersById[r]=u}stop(r){if(!this._updatingCamera){for(let{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(let{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!zt(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,u,p){for(let g in r)if(g!==p&&(!u||u.indexOf(g)<0))return!0;return!1}_getMapTouches(r){let u=[];for(let p of r)this._el.contains(p.target)&&u.push(p);return u}mergeHandlerResult(r,u,p,g,E){if(!p)return;s.e(r,p);let C={handlerName:g,originalEvent:p.originalEvent||E};p.zoomDelta!==void 0&&(u.zoom=C),p.panDelta!==void 0&&(u.drag=C),p.rollDelta!==void 0&&(u.roll=C),p.pitchDelta!==void 0&&(u.pitch=C),p.bearingDelta!==void 0&&(u.rotate=C)}_applyChanges(){let r={},u={},p={};for(let[g,E,C]of this._changes)g.panDelta&&(r.panDelta=(r.panDelta||new s.P(0,0))._add(g.panDelta)),g.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+g.pitchDelta),g.rollDelta&&(r.rollDelta=(r.rollDelta||0)+g.rollDelta),g.around!==void 0&&(r.around=g.around),g.pinchAround!==void 0&&(r.pinchAround=g.pinchAround),g.noInertia&&(r.noInertia=g.noInertia),s.e(u,E),s.e(p,C);this._updateMapTransform(r,u,p),this._changes=[]}_updateMapTransform(r,u,p){let g=this._map,E=g._getTransformForUpdate(),C=g.terrain;if(!(zp(r)||C&&this._terrainMovement))return this._fireEvents(u,p,!0);g._stop(!0);let{panDelta:M,zoomDelta:R,bearingDelta:k,pitchDelta:B,rollDelta:G,around:U,pinchAround:Y}=r;Y!==void 0&&(U=Y),U=U||g.transform.centerPoint,C&&!E.isPointOnMapSurface(U)&&(U=E.centerPoint);let ee={panDelta:M,zoomDelta:R,rollDelta:G,pitchDelta:B,bearingDelta:k,around:U};this._map.cameraHelper.useGlobeControls&&!E.isPointOnMapSurface(U)&&(U=E.centerPoint);let se=U.distSqr(E.centerPoint)<.01?E.center:E.screenPointToLocation(M?U.sub(M):U);this._handleMapControls({terrain:C,tr:E,deltasForHelper:ee,preZoomAroundLoc:se,combinedEventsInProgress:u,panDelta:M}),g._applyUpdatedTransform(E),this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(u,p,!0)}_handleMapControls({terrain:r,tr:u,deltasForHelper:p,preZoomAroundLoc:g,combinedEventsInProgress:E,panDelta:C}){let M=this._map.cameraHelper;if(M.handleMapControlsRollPitchBearingZoom(p,u),r)return M.useGlobeControls?(this._terrainMovement||!E.drag&&!E.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void M.handleMapControlsPan(p,u,g)):this._terrainMovement||!E.drag&&!E.zoom?void(E.drag&&this._terrainMovement&&C?u.setCenter(u.screenPointToLocation(u.centerPoint.sub(C))):M.handleMapControlsPan(p,u,g)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void M.handleMapControlsPan(p,u,g));M.handleMapControlsPan(p,u,g)}_fireEvents(r,u,p){let g=zt(this._eventsInProgress),E=zt(r),C={};for(let G in r){let{originalEvent:U}=r[G];this._eventsInProgress[G]||(C[`${G}start`]=U),this._eventsInProgress[G]=r[G]}!g&&E&&this._fireEvent("movestart",E.originalEvent);for(let G in C)this._fireEvent(G,C[G]);E&&this._fireEvent("move",E.originalEvent);for(let G in r){let{originalEvent:U}=r[G];this._fireEvent(G,U)}let M={},R;for(let G in this._eventsInProgress){let{handlerName:U,originalEvent:Y}=this._eventsInProgress[G];this._handlersById[U].isActive()||(delete this._eventsInProgress[G],R=u[U]||Y,M[`${G}end`]=R)}for(let G in M)this._fireEvent(G,M[G]);let k=zt(this._eventsInProgress),B=(g||E)&&!k;if(B&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;let G=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&G.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(G)}if(p&&B){this._updatingCamera=!0;let G=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=Y=>Y!==0&&-this._bearingSnap<Y&&Y<this._bearingSnap;!G||!G.essential&&z.prefersReducedMotion?(this._map.fire(new s.l("moveend",{originalEvent:R})),U(this._map.getBearing())&&this._map.resetNorth()):(U(G.bearing||this._map.getBearing())&&(G.bearing=0),G.freezeElevation=!0,this._map.easeTo(G,{originalEvent:R})),this._updatingCamera=!1}}_fireEvent(r,u){this._map.fire(new s.l(r,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new Ud("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ko extends s.E{constructor(r,u,p){super(),this._renderFrameCallback=()=>{let g=Math.min((q()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(g)),g<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=p.bearingSnap,this._zoomSnap=p.zoomSnap,this.cameraHelper=u,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(r,u){r.apply(this.transform,!0),this.transform=r,this.cameraHelper=u}getCenter(){return new s.V(this.transform.center.lng,this.transform.center.lat)}setCenter(r,u){return this.jumpTo({center:r},u)}getCenterElevation(){return this.transform.elevation}setCenterElevation(r,u){return this.jumpTo({elevation:r},u),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(r){this._centerClampedToGround=r}panBy(r,u,p){return r=s.P.convert(r).mult(-1),this.panTo(this.transform.center,s.e({offset:r},u),p)}panTo(r,u,p){return this.easeTo(s.e({center:r},u),p)}getZoom(){return this.transform.zoom}setZoom(r,u){return this.jumpTo({zoom:r},u),this}zoomTo(r,u,p){return this.easeTo(s.e({zoom:r},u),p)}zoomIn(r,u){return this.zoomTo(s.cx(this.getZoom()+1,this._zoomSnap),r,u),this}zoomOut(r,u){return this.zoomTo(s.cx(this.getZoom()-1,this._zoomSnap),r,u),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(r,u){return r!=this.transform.fov&&(this.transform.setFov(r),this.fire(new s.l("movestart",u)).fire(new s.l("move",u)).fire(new s.l("moveend",u))),this}getBearing(){return this.transform.bearing}setZoomSnap(r){return this._zoomSnap=r,this}getZoomSnap(){return this._zoomSnap}setBearing(r,u){return this.jumpTo({bearing:r},u),this}getPadding(){return this.transform.padding}setPadding(r,u){return this.jumpTo({padding:r},u),this}rotateTo(r,u,p){return this.easeTo(s.e({bearing:r},u),p)}resetNorth(r,u){return this.rotateTo(0,s.e({duration:1e3},r),u),this}resetNorthPitch(r,u){return this.easeTo(s.e({bearing:0,pitch:0,roll:0,duration:1e3},r),u),this}snapToNorth(r,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,u):this}getPitch(){return this.transform.pitch}setPitch(r,u){return this.jumpTo({pitch:r},u),this}getRoll(){return this.transform.roll}setRoll(r,u){return this.jumpTo({roll:r},u),this}cameraForBounds(r,u){r=bn.convert(r).adjustAntiMeridian();let p=u&&u.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),p,u)}_cameraForBoxAndBearing(r,u,p,g){let E={top:0,bottom:0,right:0,left:0};if(typeof(g=s.e({padding:E,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){let k=g.padding;g.padding={top:k,bottom:k,right:k,left:k}}let C=s.e(E,g.padding);g.padding=C;let M=this.transform,R=new bn(r,u);return this.cameraHelper.cameraForBoxAndBearing(g,C,R,p,M)}fitBounds(r,u,p){return this._fitInternal(this.cameraForBounds(r,u),u,p)}fitScreenCoordinates(r,u,p,g,E){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(s.P.convert(r)),this.transform.screenPointToLocation(s.P.convert(u)),p,g),g,E)}_fitInternal(r,u,p){return r?(delete(u=s.e(r,u)).padding,u.linear?this.easeTo(u,p):this.flyTo(u,p)):this}jumpTo(r,u){this.stop();let p=this._getTransformForUpdate(),g=!1,E=!1,C=!1,M=p.zoom;this.cameraHelper.handleJumpToCenterZoom(p,r);let R=p.zoom!==M;return"elevation"in r&&p.elevation!==+r.elevation&&p.setElevation(+r.elevation),"bearing"in r&&p.bearing!==+r.bearing&&(g=!0,p.setBearing(+r.bearing)),"pitch"in r&&p.pitch!==+r.pitch&&(E=!0,p.setPitch(+r.pitch)),"roll"in r&&p.roll!==+r.roll&&(C=!0,p.setRoll(+r.roll)),r.padding==null||p.isPaddingEqual(r.padding)||p.setPadding(r.padding),this._applyUpdatedTransform(p),this.fire(new s.l("movestart",u)).fire(new s.l("move",u)),R&&this.fire(new s.l("zoomstart",u)).fire(new s.l("zoom",u)).fire(new s.l("zoomend",u)),g&&this.fire(new s.l("rotatestart",u)).fire(new s.l("rotate",u)).fire(new s.l("rotateend",u)),E&&this.fire(new s.l("pitchstart",u)).fire(new s.l("pitch",u)).fire(new s.l("pitchend",u)),C&&this.fire(new s.l("rollstart",u)).fire(new s.l("roll",u)).fire(new s.l("rollend",u)),this.fire(new s.l("moveend",u))}calculateCameraOptionsFromTo(r,u,p,g=0){let E=s.a9.fromLngLat(r,u),C=s.a9.fromLngLat(p,g),M=C.x-E.x,R=C.y-E.y,k=C.z-E.z,B=Math.hypot(M,R,k);if(B===0)throw new Error("Can't calculate camera options with same From and To");let G=Math.hypot(M,R),U=s.at(this.transform.cameraToCenterDistance/B/this.transform.tileSize),Y=180*Math.atan2(M,-R)/Math.PI,ee=180*Math.acos(G/B)/Math.PI;return ee=k<0?90-ee:90+ee,{center:C.toLngLat(),elevation:g,zoom:U,pitch:ee,bearing:Y}}calculateCameraOptionsFromCameraLngLatAltRotation(r,u,p,g,E){let C=this.transform.calculateCenterFromCameraLngLatAlt(r,u,p,g);return{center:C.center,elevation:C.elevation,zoom:C.zoom,bearing:p,pitch:g,roll:E}}easeTo(r,u){this._stop(!1,r.easeId),((r=s.e({offset:[0,0],duration:500,easing:s.cz},r)).animate===!1||!r.essential&&z.prefersReducedMotion)&&(r.duration=0);let p=this._getTransformForUpdate(),g=this.getBearing(),E=p.pitch,C=p.roll,M="bearing"in r?this._normalizeBearing(r.bearing,g):g,R="pitch"in r?+r.pitch:E,k="roll"in r?this._normalizeBearing(r.roll,C):C,B="padding"in r?r.padding:p.padding,G=s.P.convert(r.offset),U,Y;r.around&&(U=s.V.convert(r.around),Y=p.locationToScreenPoint(U));let ee={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},se=this.cameraHelper.handleEaseTo(p,{bearing:M,pitch:R,roll:k,padding:B,around:U,aroundPoint:Y,offsetAsPoint:G,offset:r.offset,zoom:r.zoom,center:r.center});return this._rotating=this._rotating||g!==M,this._pitching=this._pitching||R!==E,this._rolling=this._rolling||k!==C,this._padding=!p.isPaddingEqual(B),this._zooming=this._zooming||se.isZooming,this._easeId=r.easeId,this._prepareEase(u,r.noMoveStart,ee),this.terrain&&this._prepareElevation(se.elevationCenter),this._ease(le=>{se.easeFunc(le),this.terrain&&!r.freezeElevation&&this._updateElevation(le),this._applyUpdatedTransform(p),this._fireMoveEvents(u)},le=>{this.terrain&&r.freezeElevation&&this._finalizeElevation(),this._afterEase(u,le)},r),this}_prepareEase(r,u,p={}){this._moving=!0,u||p.moving||this.fire(new s.l("movestart",r)),this._zooming&&!p.zooming&&this.fire(new s.l("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new s.l("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new s.l("pitchstart",r)),this._rolling&&!p.rolling&&this.fire(new s.l("rollstart",r))}_prepareElevation(r){this._elevationCenter=r,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(r){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));let u=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(r<1&&u!==this._elevationTarget){let p=this._elevationTarget-this._elevationStart;this._elevationStart+=r*(p-(u-(p*r+this._elevationStart))/(1-r)),this._elevationTarget=u}this.transform.setElevation(s.G.number(this._elevationStart,this._elevationTarget,r))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(r){if(!this.terrain&&r.elevation>=0&&r.pitch<=90)return{};let u=r.getCameraLngLat(),p=r.getCameraAltitude(),g=this.terrain?this.terrain.getElevationForLngLatZoom(u,r.zoom):0;if(p<g){let E=this.calculateCameraOptionsFromTo(u,g,r.center,r.elevation);return{pitch:E.pitch,zoom:E.zoom}}return{}}_applyUpdatedTransform(r){let u=[];if(u.push(g=>this._elevateCameraIfInsideTerrain(g)),this.transformCameraUpdate&&u.push(g=>this.transformCameraUpdate(g)),!u.length)return;let p=r.clone();for(let g of u){let E=p.clone(),{center:C,zoom:M,roll:R,pitch:k,bearing:B,elevation:G}=g(E);C&&E.setCenter(C),G!==void 0&&E.setElevation(G),M!==void 0&&E.setZoom(M),R!==void 0&&E.setRoll(R),k!==void 0&&E.setPitch(k),B!==void 0&&E.setBearing(B),p.apply(E,!1)}this.transform.apply(p,!1)}_fireMoveEvents(r){this.fire(new s.l("move",r)),this._zooming&&this.fire(new s.l("zoom",r)),this._rotating&&this.fire(new s.l("rotate",r)),this._pitching&&this.fire(new s.l("pitch",r)),this._rolling&&this.fire(new s.l("roll",r))}_afterEase(r,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId;let p=this._zooming,g=this._rotating,E=this._pitching,C=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,p&&this.fire(new s.l("zoomend",r)),g&&this.fire(new s.l("rotateend",r)),E&&this.fire(new s.l("pitchend",r)),C&&this.fire(new s.l("rollend",r)),this.fire(new s.l("moveend",r))}flyTo(r,u){if(!r.essential&&z.prefersReducedMotion){let Be=s.U(r,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Be,u)}this.stop(),r=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.cz},r);let p=this._getTransformForUpdate(),g=p.bearing,E=p.pitch,C=p.roll,M=p.padding,R="bearing"in r?this._normalizeBearing(r.bearing,g):g,k="pitch"in r?+r.pitch:E,B="roll"in r?this._normalizeBearing(r.roll,C):C,G="padding"in r?r.padding:p.padding,U=s.P.convert(r.offset),Y=p.centerPoint.add(U),ee=p.screenPointToLocation(Y),se=this.cameraHelper.handleFlyTo(p,{bearing:R,pitch:k,roll:B,padding:G,locationAtOffset:ee,offsetAsPoint:U,center:r.center,minZoom:r.minZoom,zoom:r.zoom}),le=r.curve,ae=Math.max(p.width,p.height),fe=ae/se.scaleOfZoom,xe=se.pixelPathLength;typeof se.scaleOfMinZoom=="number"&&(le=Math.sqrt(ae/se.scaleOfMinZoom/xe*2));let de=le*le;function ye(Be){let lt=(fe*fe-ae*ae+(Be?-1:1)*de*de*xe*xe)/(2*(Be?fe:ae)*de*xe);return Math.log(Math.sqrt(lt*lt+1)-lt)}function Ee(Be){return(Math.exp(Be)-Math.exp(-Be))/2}function _e(Be){return(Math.exp(Be)+Math.exp(-Be))/2}let Ce=ye(!1),je=function(Be){return _e(Ce)/_e(Ce+le*Be)},Ne=function(Be){return ae*((_e(Ce)*(Ee(lt=Ce+le*Be)/_e(lt))-Ee(Ce))/de)/xe;var lt},ze=(ye(!0)-Ce)/le;if(Math.abs(xe)<2e-6||!isFinite(ze)){if(Math.abs(ae-fe)<1e-6)return this.easeTo(r,u);let Be=fe<ae?-1:1;ze=Math.abs(Math.log(fe/ae))/le,Ne=()=>0,je=lt=>Math.exp(Be*le*lt)}return r.duration="duration"in r?+r.duration:1e3*ze/("screenSpeed"in r?+r.screenSpeed/le:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=g!==R,this._pitching=k!==E,this._rolling=B!==C,this._padding=!p.isPaddingEqual(G),this._prepareEase(u,!1),this.terrain&&this._prepareElevation(se.targetCenter),this._ease(Be=>{let lt=Be*ze,ct=1/je(lt),Ye=Ne(lt);this._rotating&&p.setBearing(s.G.number(g,R,Be)),this._pitching&&p.setPitch(s.G.number(E,k,Be)),this._rolling&&p.setRoll(s.G.number(C,B,Be)),this._padding&&(p.interpolatePadding(M,G,Be),Y=p.centerPoint.add(U)),se.easeFunc(Be,ct,Ye,Y),this.terrain&&!r.freezeElevation&&this._updateElevation(Be),this._applyUpdatedTransform(p),this._fireMoveEvents(u)},()=>{this.terrain&&r.freezeElevation&&this._finalizeElevation(),this._afterEase(u)},r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,u){var p;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,u)}return r||(p=this.handlers)===null||p===void 0||p.stop(!1),this}_ease(r,u,p){p.animate===!1||p.duration===0?(r(1),u()):(this._easeStart=q(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(r,u){r=s.W(r,-180,180);let p=Math.abs(r-u);return Math.abs(r-360-u)<p&&(r-=360),Math.abs(r+360-u)<p&&(r+=360),r}queryTerrainElevation(r){return this.terrain?this.terrain.getElevationForLngLat(s.V.convert(r),this.transform):null}}let Ps={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class __{constructor(r=Ps){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=u=>{!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"&&u.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=r}getDefaultPosition(){return"bottom-right"}onAdd(r){return this._map=r,this._compact=this.options.compact,this._container=W.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=W.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=W.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){W.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(r,u){let p=this._map._getUIString(`AttributionControl.${u}`);r.title=p,r.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&r.push(this.options.customAttribution)),this._map.style.stylesheet){let g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}let u=this._map.style.tileManagers;for(let g in u){let E=u[g];if(E.used||E.usedForTerrain){let C=E.getSource();C.attribution&&r.indexOf(C.attribution)<0&&r.push(C.attribution)}}r=r.filter(g=>String(g).trim()),r.sort((g,E)=>g.length-E.length),r=r.filter((g,E)=>{for(let C=E+1;C<r.length;C++)if(r[C].indexOf(g)>=0)return!1;return!0});let p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=W.sanitize(p),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class _0{constructor(r={}){this._updateCompact=()=>{let u=this._container.children;if(u.length){let p=u[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=r}getDefaultPosition(){return"bottom-left"}onAdd(r){this._map=r,this._compact=this.options&&this.options.compact,this._container=W.create("div","maplibregl-ctrl");let u=W.create("a","maplibregl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){W.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class tE{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){let u=++this._id;return this._queue.push({callback:r,id:u,cancelled:!1}),u}remove(r){let u=this._currentlyRunning,p=u?this._queue.concat(u):this._queue;for(let g of p)if(g.id===r)return void(g.cancelled=!0)}run(r=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let u=this._currentlyRunning=this._queue;this._queue=[];for(let p of u)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var nE=s.aU([{name:"a_pos3d",type:"Int16",components:3}]);class Gd extends s.E{constructor(r){super(),this._lastTilesetChange=q(),this.tileManager=r,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=r._source.tileSize*2**this.deltaZoom,r.usedForTerrain=!0,r.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(r,u){this.tileManager.update(r,u),this._renderableTilesKeys=[];let p={};for(let g of Mn(r,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u,calculateTileZoom:this.tileManager._source.calculateTileZoom}))p[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.terrainRttPosMatrix32f=new Float64Array(16),s.c7(g.terrainRttPosMatrix32f,0,s.a5,s.a5,0,0,1),this._tiles[g.key]=new Le(g,this.tileSize),this._lastTilesetChange=q());for(let g in this._tiles)p[g]||delete this._tiles[g]}freeRtt(r){for(let u in this._tiles){let p=this._tiles[u];(!r||p.tileID.equals(r)||p.tileID.isChildOf(r)||r.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(r=>this.getTileByID(r))}getTileByID(r){return this._tiles[r]}getTerrainCoords(r,u){return u?this._getTerrainCoordsForTileRanges(r,u):this._getTerrainCoordsForRegularTile(r)}_getTerrainCoordsForRegularTile(r){let u={};for(let p of this._renderableTilesKeys){let g=this._tiles[p].tileID,E=r.clone(),C=s.bk();if(g.canonical.equals(r.canonical))s.c7(C,0,s.a5,s.a5,0,0,1);else if(g.canonical.isChildOf(r.canonical)){let M=g.canonical.z-r.canonical.z,R=g.canonical.x-(g.canonical.x>>M<<M),k=g.canonical.y-(g.canonical.y>>M<<M),B=s.a5>>M;s.c7(C,0,B,B,0,0,1),s.O(C,C,[-R*B,-k*B,0])}else{if(!r.canonical.isChildOf(g.canonical))continue;{let M=r.canonical.z-g.canonical.z,R=r.canonical.x-(r.canonical.x>>M<<M),k=r.canonical.y-(r.canonical.y>>M<<M),B=s.a5>>M;s.c7(C,0,s.a5,s.a5,0,0,1),s.O(C,C,[R*B,k*B,0]),s.Q(C,C,[1/2**M,1/2**M,0])}}E.terrainRttPosMatrix32f=new Float32Array(C),u[p]=E}return u}_getTerrainCoordsForTileRanges(r,u){let p={};for(let g of this._renderableTilesKeys){let E=this._tiles[g].tileID;if(!this._isWithinTileRanges(E,u))continue;let C=r.clone(),M=s.bk();if(E.canonical.z===r.canonical.z){let R=r.canonical.x-E.canonical.x+r.wrap*(1<<r.canonical.z),k=r.canonical.y-E.canonical.y;s.c7(M,0,s.a5,s.a5,0,0,1),s.O(M,M,[R*s.a5,k*s.a5,0])}else if(E.canonical.z>r.canonical.z){let R=E.canonical.z-r.canonical.z,k=E.canonical.x-(E.canonical.x>>R<<R)+r.wrap*(1<<E.canonical.z),B=E.canonical.y-(E.canonical.y>>R<<R),G=r.canonical.x-(E.canonical.x>>R),U=r.canonical.y-(E.canonical.y>>R),Y=s.a5>>R;s.c7(M,0,Y,Y,0,0,1),s.O(M,M,[-k*Y+G*s.a5,-B*Y+U*s.a5,0])}else{let R=r.canonical.z-E.canonical.z,k=r.canonical.x-(r.canonical.x>>R<<R)+r.wrap*(1<<r.canonical.z),B=r.canonical.y-(r.canonical.y>>R<<R),G=(r.canonical.x>>R)-E.canonical.x,U=(r.canonical.y>>R)-E.canonical.y,Y=s.a5<<R;s.c7(M,0,Y,Y,0,0,1),s.O(M,M,[k*s.a5+G*Y,B*s.a5+U*Y,0])}C.terrainRttPosMatrix32f=new Float32Array(M),p[g]=C}return p}getSourceTile(r,u){let p=this.tileManager._source,g=r.overscaledZ-this.deltaZoom;if(g>p.maxzoom&&(g=p.maxzoom),g<p.minzoom)return;this._sourceTileCache[r.key]||(this._sourceTileCache[r.key]=r.scaledTo(g).key);let E=this.findTileInCaches(this._sourceTileCache[r.key]);if(!E?.dem&&u)for(;g>=p.minzoom&&!E?.dem;)E=this.findTileInCaches(r.scaledTo(g--).key);return E}findTileInCaches(r){let u=this.tileManager.getTileByID(r);return u||(u=this.tileManager._outOfViewCache.getByKey(r),u)}anyTilesAfterTime(r=Date.now()){return this._lastTilesetChange>=r}_isWithinTileRanges(r,u){let p=u[r.canonical.z];return!!p&&(r.wrap>p.minWrap||r.wrap<p.maxWrap||r.canonical.x>=p.minTileXWrapped&&r.canonical.x<=p.maxTileXWrapped&&r.canonical.y>=p.minTileY&&r.canonical.y<=p.maxTileY)}}class Ui{constructor(r,u,p){this._meshCache={},this.painter=r,this.tileManager=new Gd(u),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(r,u,p,g=s.a5){var E;if(!(u>=0&&u<g&&p>=0&&p<g))return 0;let C=this.getTerrainData(r),M=(E=C.tile)===null||E===void 0?void 0:E.dem;if(!M)return 0;let R=s.cD([],[u/g*s.a5,p/g*s.a5],C.u_terrain_matrix),k=[R[0]*M.dim,R[1]*M.dim],B=Math.floor(k[0]),G=Math.floor(k[1]),U=k[0]-B,Y=k[1]-G;return M.get(B,G)*(1-U)*(1-Y)+M.get(B+1,G)*U*(1-Y)+M.get(B,G+1)*(1-U)*Y+M.get(B+1,G+1)*U*Y}getElevationForLngLatZoom(r,u){if(!s.cE(u,r.wrap()))return 0;let{tileID:p,mercatorX:g,mercatorY:E}=this._getOverscaledTileIDFromLngLatZoom(r,u);return this.getElevation(p,g%s.a5,E%s.a5,s.a5)}getElevationForLngLat(r,u){let p=Mn(u,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this}),g=0;for(let E of p)E.canonical.z>g&&(g=Math.min(E.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(r,g)}getElevation(r,u,p,g=s.a5){return this.getDEMElevation(r,u,p,g)*this.exaggeration}getTerrainData(r){if(!this._emptyDemTexture){let g=this.painter.context,E=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new s.T(g,E,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new s.T(g,new s.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.ar([])}let u=this.tileManager.getSourceTile(r,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){let g=this.painter.context;u.demTexture=this.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new s.T(g,u.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),u.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}let p=u&&u.toString()+u.tileID.key+r.key;if(p&&!this._demMatrixCache[p]){let g=this.tileManager.getSource().maxzoom,E=r.canonical.z-u.tileID.canonical.z;r.overscaledZ>r.canonical.z&&(r.canonical.z>=g?E=r.canonical.z-g:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let C=r.canonical.x-(r.canonical.x>>E<<E),M=r.canonical.y-(r.canonical.y>>E<<E),R=s.cF(new Float64Array(16),[1/(s.a5<<E),1/(s.a5<<E),0]);s.O(R,R,[C*s.a5,M*s.a5,0]),this._demMatrixCache[r.key]={matrix:R,coord:r}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[r.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getFramebuffer(r){let u=this.painter,p=u.width/devicePixelRatio,g=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new s.T(u.context,{width:p,height:g,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new s.T(u.context,{width:p,height:g,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(p,g,!0,!1),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,p,g))),this._fbo.colorAttachment.set(r==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let r=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let E=0,C=0;E<this._coordsTextureSize;E++)for(let M=0;M<this._coordsTextureSize;M++,C+=4)u[C+0]=255&M,u[C+1]=255&E,u[C+2]=M>>8<<4|E>>8,u[C+3]=0;let p=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),g=new s.T(r,p,r.gl.RGBA,{premultiply:!1});return g.bind(r.gl.NEAREST,r.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(r){this.painter.maybeDrawDepthAndCoords(!0);let u=new Uint8Array(4),p=this.painter.context,g=p.gl,E=Math.round(r.x*this.painter.pixelRatio/devicePixelRatio),C=Math.round(r.y*this.painter.pixelRatio/devicePixelRatio),M=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(E,M-C-1,1,1,g.RGBA,g.UNSIGNED_BYTE,u),p.bindFramebuffer.set(null);let R=u[0]+(u[2]>>4<<8),k=u[1]+((15&u[2])<<8),B=this.coordsIndex[255-u[3]],G=B&&this.tileManager.getTileByID(B);if(!G)return null;let U=this._coordsTextureSize,Y=(1<<G.tileID.canonical.z)*U;return new s.a9((G.tileID.canonical.x*U+R)/Y+G.tileID.wrap,(G.tileID.canonical.y*U+k)/Y,this.getElevation(G.tileID,R,k,U))}depthAtPoint(r){let u=new Uint8Array(4),p=this.painter.context,g=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),g.readPixels(r.x,this.painter.height/devicePixelRatio-r.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,u),p.bindFramebuffer.set(null),(u[0]/16777216+u[1]/65536+u[2]/256+u[3])/256}getTerrainMesh(r){var u;let p=((u=this.painter.style.projection)===null||u===void 0?void 0:u.transitionState)>0,g=p&&r.canonical.y===0,E=p&&r.canonical.y===(1<<r.canonical.z)-1,C=`m_${g?"n":""}_${E?"s":""}`;if(this._meshCache[C])return this._meshCache[C];let M=this.painter.context,R=new s.cG,k=new s.aY,B=this.meshSize,G=s.a5/B,U=B*B;for(let _e=0;_e<=B;_e++)for(let Ce=0;Ce<=B;Ce++)R.emplaceBack(Ce*G,_e*G,0);for(let _e=0;_e<U;_e+=B+1)for(let Ce=0;Ce<B;Ce++)k.emplaceBack(Ce+_e,B+Ce+_e+1,B+Ce+_e+2),k.emplaceBack(Ce+_e,B+Ce+_e+2,Ce+_e+1);let Y=R.length,ee=Y+(B+1),se=(B+1)*B,le=g?s.br:0,ae=g?0:1,fe=E?s.bs:s.a5,xe=E?0:1;for(let _e=0;_e<=B;_e++)R.emplaceBack(_e*G,le,ae);for(let _e=0;_e<=B;_e++)R.emplaceBack(_e*G,fe,xe);for(let _e=0;_e<B;_e++)k.emplaceBack(se+_e,ee+_e,ee+_e+1),k.emplaceBack(se+_e,ee+_e+1,se+_e+1),k.emplaceBack(0+_e,Y+_e+1,Y+_e),k.emplaceBack(0+_e,0+_e+1,Y+_e+1);let de=R.length,ye=de+2*(B+1);for(let _e of[0,1])for(let Ce=0;Ce<=B;Ce++)for(let je of[0,1])R.emplaceBack(_e*s.a5,Ce*G,je);for(let _e=0;_e<2*B;_e+=2)k.emplaceBack(de+_e,de+_e+1,de+_e+3),k.emplaceBack(de+_e,de+_e+3,de+_e+2),k.emplaceBack(ye+_e,ye+_e+3,ye+_e+1),k.emplaceBack(ye+_e,ye+_e+2,ye+_e+3);let Ee=new ri(M.createVertexBuffer(R,nE.members),M.createIndexBuffer(k),s.aX.simpleSegment(0,0,R.length,k.length));return this._meshCache[C]=Ee,Ee}getMeshFrameDelta(r){return 2*Math.PI*s.bE/Math.pow(2,Math.max(r,0))/5}getMinTileElevationForLngLatZoom(r,u){var p;if(!s.cE(u,r.wrap()))return 0;let{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(r,u);return(p=this.getMinMaxElevation(g).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(r){let u=this.getTerrainData(r).tile,p={minElevation:null,maxElevation:null};return u&&u.dem&&(p.minElevation=u.dem.min*this.exaggeration,p.maxElevation=u.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(r,u){let p=s.a9.fromLngLat(r.wrap()),g=(1<<u)*s.a5,E=p.x*g,C=p.y*g,M=Math.floor(E/s.a5),R=Math.floor(C/s.a5);return{tileID:new s.a2(u,0,u,M,R),mercatorX:E,mercatorY:C}}}class er{constructor(r,u,p){this._context=r,this._size=u,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let r of this._objects)r.texture.destroy(),r.fbo.destroy()}_createObject(r){let u=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new s.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),u.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),u.colorAttachment.set(p.texture),{id:r,fbo:u,texture:p,stamp:-1,inUse:!1}}getObjectForId(r){return this._objects[r]}useObject(r){r.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(u=>r.id!==u),this._recentlyUsed.push(r.id)}stampObject(r){r.stamp=++this._stamp}getOrCreateFreeObject(){for(let u of this._recentlyUsed)if(!this._objects[u].inUse)return this._objects[u];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let r=this._createObject(this._objects.length);return this._objects.push(r),r}freeObject(r){r.inUse=!1}freeAllObjects(){for(let r of this._objects)this.freeObject(r)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(r=>!r.inUse)===!1}}let pu={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class $d{constructor(r,u){this.painter=r,this.terrain=u,this.pool=new er(r.context,30,u.tileManager.tileSize*u.qualityFactor)}destruct(){this.pool.destruct()}getTexture(r){return this.pool.getObjectForId(r.rtt[this._stacks.length-1].id).texture}prepareForRender(r,u){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=r._order.filter(p=>!r._layers[p].isHidden(u)),this._coordsAscending={};for(let p in r.tileManagers){this._coordsAscending[p]={};let g=r.tileManagers[p].getVisibleCoordinates(),E=r.tileManagers[p].getSource(),C=E instanceof $n?E.terrainTileRanges:null;for(let M of g){let R=this.terrain.tileManager.getTerrainCoords(M,C);for(let k in R)this._coordsAscending[p][k]||(this._coordsAscending[p][k]=[]),this._coordsAscending[p][k].push(R[k])}}this._coordsAscendingStr={};for(let p of r._order){let g=r._layers[p],E=g.source;if(pu[g.type]&&!this._coordsAscendingStr[E]){this._coordsAscendingStr[E]={};for(let C in this._coordsAscending[E])this._coordsAscendingStr[E][C]=this._coordsAscending[E][C].map(M=>M.key).sort().join()}}for(let p of this._renderableTiles)for(let g in this._coordsAscendingStr){let E=this._coordsAscendingStr[g][p.tileID.key];E&&E!==p.rttCoords[g]&&(p.rtt=[])}}renderLayer(r,u){if(r.isHidden(this.painter.transform.zoom))return!1;let p=Object.assign(Object.assign({},u),{isRenderingToTexture:!0}),g=r.type,E=this.painter,C=this._renderableLayerIds[this._renderableLayerIds.length-1]===r.id;if(pu[g]&&(this._prevType&&pu[this._prevType]||this._stacks.push([]),this._prevType=g,this._stacks[this._stacks.length-1].push(r.id),!C))return!0;if(pu[this._prevType]||pu[g]&&C){this._prevType=g;let M=this._stacks.length-1,R=this._stacks[M]||[];for(let k of this._renderableTiles){if(this.pool.isFull()&&(s_(this.painter,this.terrain,this._rttTiles,p),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(k),k.rtt[M]){let G=this.pool.getObjectForId(k.rtt[M].id);if(G.stamp===k.rtt[M].stamp){this.pool.useObject(G);continue}}let B=this.pool.getOrCreateFreeObject();this.pool.useObject(B),this.pool.stampObject(B),k.rtt[M]={id:B.id,stamp:B.stamp},E.context.bindFramebuffer.set(B.fbo.framebuffer),E.context.clear({color:s.bp.transparent,stencil:0}),E.currentStencilSource=void 0;for(let G=0;G<R.length;G++){let U=E.style._layers[R[G]],Y=U.source?this._coordsAscending[U.source][k.tileID.key]:[k.tileID];E.context.viewport.set([0,0,B.fbo.width,B.fbo.height]),E._renderTileClippingMasks(U,Y,!0),E.renderLayer(E,E.style.tileManagers[U.source],U,Y,p),U.source&&(k.rttCoords[U.source]=this._coordsAscendingStr[U.source][k.tileID.key])}}return s_(this.painter,this.terrain,this._rttTiles,p),this._rttTiles=[],this.pool.freeAllObjects(),pu[g]}return!1}}let jp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},y_=f,Vp={hash:!1,interactive:!0,bearingSnap:7,zoomSnap:0,attributionControl:Ps,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},v_={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Hd{constructor(r,u,p=!1){this.mousedown=E=>{this.startMove(E,W.mousePos(this.element,E)),W.addEventListener(window,"mousemove",this.mousemove),W.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=E=>{this.move(E,W.mousePos(this.element,E))},this.mouseup=E=>{this._rotatePitchHandler.dragEnd(E),this.offTemp()},this.touchstart=E=>{E.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=W.touchPos(this.element,E.targetTouches)[0],this.startMove(E,this._startPos),W.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),W.addEventListener(window,"touchend",this.touchend))},this.touchmove=E=>{E.targetTouches.length!==1?this.reset():(this._lastPos=W.touchPos(this.element,E.targetTouches)[0],this.move(E,this._lastPos))},this.touchend=E=>{E.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=u;let g=new u0;this._rotatePitchHandler=new Mh({clickTolerance:3,move:(E,C)=>{let M=u.getBoundingClientRect(),R=new s.P((M.bottom-M.top)/2,(M.right-M.left)/2);return{bearingDelta:s.cy(new s.P(E.x,C.y),C,R),pitchDelta:p?-.5*(C.y-E.y):void 0}},moveStateManager:g,enable:!0,assignEvents:()=>{}}),this.map=r,W.addEventListener(u,"mousedown",this.mousedown),W.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),W.addEventListener(u,"touchcancel",this.reset)}startMove(r,u){this._rotatePitchHandler.dragStart(r,u),W.disableDrag()}move(r,u){let p=this.map,{bearingDelta:g,pitchDelta:E}=this._rotatePitchHandler.dragMove(r,u)||{};g&&p.setBearing(p.getBearing()+g),E&&p.setPitch(p.getPitch()+E)}off(){let r=this.element;W.removeEventListener(r,"mousedown",this.mousedown),W.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),W.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),W.removeEventListener(window,"touchend",this.touchend),W.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){W.enableDrag(),W.removeEventListener(window,"mousemove",this.mousemove),W.removeEventListener(window,"mouseup",this.mouseup),W.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),W.removeEventListener(window,"touchend",this.touchend)}}let xl;function Up(x,r,u,p=!1){if(p||!u.getCoveringTilesDetailsProvider().allowWorldCopies())return x?.wrap();let g=new s.V(x.lng,x.lat);if(x=new s.V(x.lng,x.lat),r){let E=new s.V(x.lng-360,x.lat),C=new s.V(x.lng+360,x.lat),M=u.locationToScreenPoint(x).distSqr(r);u.locationToScreenPoint(E).distSqr(r)<M?x=E:u.locationToScreenPoint(C).distSqr(r)<M&&(x=C)}for(;Math.abs(x.lng-u.center.lng)>180;){let E=u.locationToScreenPoint(x);if(E.x>=0&&E.y>=0&&E.x<=u.width&&E.y<=u.height)break;x.lng>u.center.lng?x.lng-=360:x.lng+=360}return x.lng!==g.lng&&u.isPointOnMapSurface(u.locationToScreenPoint(x))?x:g}let Zd={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Gp(x,r,u){let p=x.classList;for(let g in Zd)p.remove(`maplibregl-${u}-anchor-${g}`);p.add(`maplibregl-${u}-anchor-${r}`)}class qd extends s.E{constructor(r){if(super(),this._onKeyPress=u=>{let p=u.code,g=u.charCode||u.keyCode;p!=="Space"&&p!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=u=>{let p=u.originalEvent.target,g=this._element;this._popup&&(p===g||g.contains(p))&&this.togglePopup()},this._update=u=>{if(!this._map)return;let p=this._map.loaded()&&!this._map.isMoving();(u?.type==="terrain"||u?.type==="render"&&!p)&&this._map.once("render",this._update),this._lngLat=Up(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(g=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||u&&u.type!=="moveend"||(this._pos=this._pos.round()),W.setTransform(this._element,`${Zd[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${E} ${g}`),z.frameAsync(new AbortController,this._map._ownerWindow).then(()=>{this._updateOpacity(u&&u.type==="moveend")}).catch(()=>{})},this._onMove=u=>{if(!this._isDragging){let p=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.l("dragstart"))),this.fire(new s.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.l("dragend")),this._state="inactive"},this._addDragHandler=u=>{this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._subpixelPositioning=r&&r.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment!=="auto"?r.pitchAlignment:this._rotationAlignment,this.setOpacity(r?.opacity,r?.opacityWhenCovered),r&&r.element)this._element=r.element,this._offset=s.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=W.create("div");let u=W.createNS("http://www.w3.org/2000/svg","svg"),p=41,g=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${p}px`),u.setAttributeNS(null,"width",`${g}px`),u.setAttributeNS(null,"viewBox",`0 0 ${g} ${p}`);let E=W.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"stroke","none"),E.setAttributeNS(null,"stroke-width","1"),E.setAttributeNS(null,"fill","none"),E.setAttributeNS(null,"fill-rule","evenodd");let C=W.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");let M=W.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");let R=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let ae of R){let fe=W.createNS("http://www.w3.org/2000/svg","ellipse");fe.setAttributeNS(null,"opacity","0.04"),fe.setAttributeNS(null,"cx","10.5"),fe.setAttributeNS(null,"cy","5.80029008"),fe.setAttributeNS(null,"rx",ae.rx),fe.setAttributeNS(null,"ry",ae.ry),M.appendChild(fe)}let k=W.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill",this._color);let B=W.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),k.appendChild(B);let G=W.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"opacity","0.25"),G.setAttributeNS(null,"fill","#000000");let U=W.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),G.appendChild(U);let Y=W.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Y.setAttributeNS(null,"fill","#FFFFFF");let ee=W.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"transform","translate(8.0, 8.0)");let se=W.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#000000"),se.setAttributeNS(null,"opacity","0.25"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962");let le=W.createNS("http://www.w3.org/2000/svg","circle");le.setAttributeNS(null,"fill","#FFFFFF"),le.setAttributeNS(null,"cx","5.5"),le.setAttributeNS(null,"cy","5.5"),le.setAttributeNS(null,"r","5.4999962"),ee.appendChild(se),ee.appendChild(le),C.appendChild(M),C.appendChild(k),C.appendChild(G),C.appendChild(Y),C.appendChild(ee),u.appendChild(C),u.setAttributeNS(null,"height",p*this._scale+"px"),u.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(u),this._offset=s.P.convert(r&&r.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()}),Gp(this._element,this._anchor,"marker"),r&&r.className)for(let u of r.className.split(" "))this._element.classList.add(u);this._popup=null}addTo(r){return this.remove(),this._map=r,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",r._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),r.on("terrain",this._update),r.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),W.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=s.V.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){let g=Math.abs(13.5)/Math.SQRT2;r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(r){return this._subpixelPositioning=r,this}getPopup(){return this._popup}togglePopup(){let r=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:r?(r.isOpen()?r.remove():(r.setLngLat(this._lngLat),r.addTo(this._map)),this):this}_updateOpacity(r=!1){var u,p;let g=(u=this._map)===null||u===void 0?void 0:u.terrain,E=this._map.transform.isLocationOccluded(this._lngLat);if(!g||E){let Y=E?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==Y&&(this._element.style.opacity=Y))}if(r)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}let C=this._map,M=C.terrain.depthAtPoint(this._pos),R=C.terrain.getElevationForLngLat(this._lngLat,C.transform);if(C.transform.lngLatToCameraDepth(this._lngLat,R)-M<.006)return void(this._element.style.opacity=this._opacity);let k=-this._offset.y/C.transform.pixelsPerMeter,B=Math.sin(C.getPitch()*Math.PI/180)*k,G=C.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),U=C.transform.lngLatToCameraDepth(this._lngLat,R+B)-G>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&U&&this._popup.remove(),this._element.style.opacity=U?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(r){return this._offset=s.P.convert(r),this._update(),this}addClassName(r){this._element.classList.add(r)}removeClassName(r){this._element.classList.remove(r)}toggleClassName(r){return this._element.classList.toggle(r)}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&r!=="auto"?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(r,u){return(this._opacity===void 0||r===void 0&&u===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),r!==void 0&&(this._opacity=r),u!==void 0&&(this._opacityWhenCovered=u),this._map&&this._updateOpacity(!0),this}}let x_={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Ah=0,mu=!1,b_={maxWidth:100,unit:"metric"};function Wd(x,r,u){let p=u&&u.maxWidth||100,g=x._container.clientHeight/2,E=x._container.clientWidth/2,C=x.unproject([E-p/2,g]),M=x.unproject([E+p/2,g]),R=Math.round(x.project(M).x-x.project(C).x),k=Math.min(p,R,x._container.clientWidth),B=C.distanceTo(M);if(u&&u.unit==="imperial"){let G=3.2808*B;G>5280?gu(r,k,G/5280,x._getUIString("ScaleControl.Miles")):gu(r,k,G,x._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?gu(r,k,B/1852,x._getUIString("ScaleControl.NauticalMiles")):B>=1e3?gu(r,k,B/1e3,x._getUIString("ScaleControl.Kilometers")):gu(r,k,B,x._getUIString("ScaleControl.Meters"))}function gu(x,r,u,p){let g=(function(E){let C=Math.pow(10,`${Math.floor(E)}`.length-1),M=E/C;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:(function(R){let k=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*k)/k})(M),C*M})(u);x.style.width=r*(g/u)+"px",x.innerHTML=`${g}&nbsp;${p}`}let w_={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0,padding:void 0},$p=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Hp(x){if(x){if(typeof x=="number"){let r=Math.round(Math.abs(x)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,x),"top-left":new s.P(r,r),"top-right":new s.P(-r,r),bottom:new s.P(0,-x),"bottom-left":new s.P(r,-r),"bottom-right":new s.P(-r,-r),left:new s.P(x,0),right:new s.P(-x,0)}}if(x instanceof s.P||Array.isArray(x)){let r=s.P.convert(x);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:s.P.convert(x.center||[0,0]),top:s.P.convert(x.top||[0,0]),"top-left":s.P.convert(x["top-left"]||[0,0]),"top-right":s.P.convert(x["top-right"]||[0,0]),bottom:s.P.convert(x.bottom||[0,0]),"bottom-left":s.P.convert(x["bottom-left"]||[0,0]),"bottom-right":s.P.convert(x["bottom-right"]||[0,0]),left:s.P.convert(x.left||[0,0]),right:s.P.convert(x.right||[0,0])}}return Hp(new s.P(0,0))}let E_=f;a.AJAXError=s.cJ,a.Event=s.l,a.Evented=s.E,a.LngLat=s.V,a.MercatorCoordinate=s.a9,a.Point=s.P,a.addProtocol=s.cK,a.config=s.c,a.removeProtocol=s.cL,a.AttributionControl=__,a.BoxZoomHandler=Dh,a.CanvasSource=xs,a.CooperativeGesturesHandler=Lt,a.DoubleClickZoomHandler=g_,a.DragPanHandler=g0,a.DragRotateHandler=pa,a.EdgeInsets=Na,a.FullscreenControl=class extends s.E{constructor(x={}){super(),this._onFullscreenChange=()=>{var r;let u=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((r=u?.shadowRoot)===null||r===void 0)&&r.fullscreenElement;)u=u.shadowRoot.fullscreenElement;u===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,x&&x.container&&(x.container instanceof HTMLElement?this._container=x.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(x){return this._map=x,this._container||(this._container=this._map.getContainer()),this._controlContainer=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){W.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let x=this._fullscreenButton=W.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);W.create("span","maplibregl-ctrl-icon",x).setAttribute("aria-hidden","true"),x.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let x=this._getTitle();this._fullscreenButton.setAttribute("aria-label",x),this._fullscreenButton.title=x}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},a.GeoJSONSource=Mo,a.GeolocateControl=class extends s.E{constructor(x){super(),this._onSuccess=r=>{if(this._map){if(this._isOutOfMapMaxBounds(r))return this._setErrorState(),this.fire(new s.l("outofmaxbounds",r)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=r,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(r),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(r),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.l("geolocate",r)),this._finish()}},this._updateCamera=r=>{let u=new s.V(r.coords.longitude,r.coords.latitude),p=r.coords.accuracy,g=this._map.getBearing(),E=s.e({bearing:g},this.options.fitBoundsOptions),C=bn.fromLngLat(u,p);this._map.fitBounds(C,E,{geolocateSource:!0})},this._updateMarker=r=>{if(r){let u=new s.V(r.coords.longitude,r.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=r.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=r=>{if(this._map){if(r.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(r.code===3&&mu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.l("error",r)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=W.create("button","maplibregl-ctrl-geolocate",this._container),W.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=r=>{if(this._map){if(r===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");let u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{let u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new qd({element:this._dotElement}),this._circleElement=W.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new qd({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",u=>{let p=u?.[0]instanceof ResizeObserverEntry;u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||p||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.l("trackuserlocationend")),this.fire(new s.l("userlocationlostfocus")))})}},this.options=s.e({},x_,x)}onAdd(x){return this._map=x,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return s._(this,arguments,void 0,function*(r=!1){if(xl!==void 0&&!r)return xl;if(window.navigator.permissions===void 0)return xl=!!window.navigator.geolocation,xl;try{xl=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{xl=!!window.navigator.geolocation}return xl})})().then(r=>this._finishSetupUI(r)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),W.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Ah=0,mu=!1}_isOutOfMapMaxBounds(x){let r=this._map.getMaxBounds(),u=x.coords;return r&&(u.longitude<r.getWest()||u.longitude>r.getEast()||u.latitude<r.getSouth()||u.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){let x=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&x))return;let r=this._map.project(x),u=this._map.unproject([r.x+100,r.y]),p=x.distanceTo(u)/100,g=2*this._accuracy/p;this._circleElement.style.width=`${g.toFixed(2)}px`,this._circleElement.style.height=`${g.toFixed(2)}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ah--,mu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.l("trackuserlocationstart")),this.fire(new s.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let x;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ah++,Ah>1?(x={maximumAge:6e5,timeout:0},mu=!0):(x=this.options.positionOptions,mu=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,x)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},a.GlobeControl=class{constructor(){this._toggleProjection=()=>{var x;let r=(x=this._map.getProjection())===null||x===void 0?void 0:x.type;this._map.setProjection(r!=="mercator"&&r?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var x;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((x=this._map.getProjection())===null||x===void 0?void 0:x.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(x){return this._map=x,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=W.create("button","maplibregl-ctrl-globe",this._container),W.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){W.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},a.Hash=c_,a.ImageSource=$n,a.KeyboardHandler=ui,a.LngLatBounds=bn,a.LogoControl=_0,a.Map=class extends ko{get _ownerWindow(){var x,r;return((r=(x=this._container)===null||x===void 0?void 0:x.ownerDocument)===null||r===void 0?void 0:r.defaultView)||window}constructor(x){var r,u;s.cH.mark(s.cI.create);let p=Object.assign(Object.assign(Object.assign({},Vp),x),{canvasContextAttributes:Object.assign(Object.assign({},Vp.canvasContextAttributes),x.canvasContextAttributes)});if(p.minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");let g=new za,E=new yn;p.minZoom!==void 0&&g.setMinZoom(p.minZoom),p.maxZoom!==void 0&&g.setMaxZoom(p.maxZoom),p.minPitch!==void 0&&g.setMinPitch(p.minPitch),p.maxPitch!==void 0&&g.setMaxPitch(p.maxPitch),p.renderWorldCopies!==void 0&&g.setRenderWorldCopies(p.renderWorldCopies),p.transformConstrain!==null&&g.setConstrainOverride(p.transformConstrain),super(g,E,{bearingSnap:p.bearingSnap,zoomSnap:p.zoomSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new tE,this._controls=[],this._mapId=s.af(),this._lostContextStyle={style:null,images:null},this._contextLost=M=>{M.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(let R of Object.values(this.style._layers))if(R.type==="custom"&&console.warn(`Custom layer with id '${R.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),R._listeners)for(let[k]of Object.entries(R._listeners))console.warn(`Custom layer with id '${R.id}' had event listeners for event '${k}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new s.l("webglcontextlost",{originalEvent:M}))},this._contextRestored=M=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._lostContextStyle={style:null,images:null},this._setupPainter(),this.resize(),this._update(),this._resizeInternal(),this.fire(new s.l("webglcontextrestored",{originalEvent:M}))},this._onMapScroll=M=>{if(M.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._maxTileCacheZoomLevels=p.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},p.canvasContextAttributes),this._trackResize=p.trackResize===!0,this._bearingSnap=p.bearingSnap,this._zoomSnap=p.zoomSnap,this._centerClampedToGround=p.centerClampedToGround,this._refreshExpiredTiles=p.refreshExpiredTiles===!0,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions===!0,this._collectResourceTiming=p.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},jp),p.locale),this._clickTolerance=p.clickTolerance,this._overridePixelRatio=p.pixelRatio,this._maxCanvasSize=p.maxCanvasSize,this._zoomLevelsToOverscale=p.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=p.transformCameraUpdate,this.transformConstrain=p.transformConstrain,this.cancelPendingTileRequestsWhileZooming=p.cancelPendingTileRequestsWhileZooming===!0,p.reduceMotion!==void 0&&(z.prefersReducedMotion=p.reduceMotion),this._imageQueueHandle=ke.addThrottleControl(()=>this.isMoving()),this._requestManager=new Qe(p.transformRequest),this._container=this._resolveContainer(p.container),p.maxBounds&&this.setMaxBounds(p.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"&&(this._ownerWindow.addEventListener("online",this._onWindowOnline,!1),this._setupResizeObserver()),this.handlers=new Bp(this,p),this._hash=p.hash&&new c_(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,elevation:p.elevation,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,roll:p.roll}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,s.e({},p.fitBoundsOptions,{duration:0}))));let C=typeof p.style=="string"||((u=(r=p.style)===null||r===void 0?void 0:r.projection)===null||u===void 0?void 0:u.type)!=="globe";this.resize(null,C),this._localIdeographFontFamily=p.localIdeographFontFamily,this._validateStyle=p.validateStyle,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new __(typeof p.attributionControl=="boolean"?void 0:p.attributionControl)),p.maplibreLogo&&this.addControl(new _0,p.logoPosition),this.on("style.load",()=>{if(C||this._resizeTransform(),this.transform.unmodified){let M=s.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(M)}}),this.on("data",M=>{this._update(M.dataType==="style"),this.fire(new s.l(`${M.dataType}data`,M))}),this.on("dataloading",M=>{this.fire(new s.l(`${M.dataType}dataloading`,M))}),this.on("dataabort",M=>{this.fire(new s.l("sourcedataabort",M))})}_getMapId(){return this._mapId}setGlobalStateProperty(x,r){return this.style.setGlobalStateProperty(x,r),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(x,r){if(r===void 0&&(r=x.getDefaultPosition?x.getDefaultPosition():"top-right"),!x||!x.onAdd)return this.fire(new s.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let u=x.onAdd(this);this._controls.push(x);let p=this._controlPositions[r];return r.indexOf("bottom")!==-1?p.insertBefore(u,p.firstChild):p.appendChild(u),this}removeControl(x){if(!x||!x.onRemove)return this.fire(new s.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let r=this._controls.indexOf(x);return r>-1&&this._controls.splice(r,1),x.onRemove(this),this}hasControl(x){return this._controls.indexOf(x)>-1}coveringTiles(x){return Mn(this.transform,x)}calculateCameraOptionsFromTo(x,r,u,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLat(u,this.transform)),super.calculateCameraOptionsFromTo(x,r,u,p)}resize(x,r=!0){if(this._lostContextStyle.style!==null)return this;this._resizeInternal(r);let u=!this._moving;return u&&(this.stop(),this.fire(new s.l("movestart",x)).fire(new s.l("move",x))),this.fire(new s.l("resize",x)),u&&this.fire(new s.l("moveend",x)),this}_resizeInternal(x=!0){let[r,u]=this._containerDimensions(),p=this._getClampedPixelRatio(r,u);if(this._resizeCanvas(r,u,p),this.painter.resize(r,u,p),this.painter.overLimit()){let g=this.painter.context.gl;this._maxCanvasSize=[g.drawingBufferWidth,g.drawingBufferHeight];let E=this._getClampedPixelRatio(r,u);this._resizeCanvas(r,u,E),this.painter.resize(r,u,E)}this._resizeTransform(x)}_resizeTransform(x=!0){var r;let[u,p]=this._containerDimensions();this.transform.resize(u,p,x),(r=this._requestedCameraState)===null||r===void 0||r.resize(u,p,x)}_getClampedPixelRatio(x,r){let{0:u,1:p}=this._maxCanvasSize,g=this.getPixelRatio(),E=x*g,C=r*g;return Math.min(E>u?u/E:1,C>p?p/C:1)*g}getPixelRatio(){var x;return(x=this._overridePixelRatio)!==null&&x!==void 0?x:devicePixelRatio}setPixelRatio(x){this._overridePixelRatio=x,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(x){return this.transform.setMaxBounds(bn.convert(x)),this._update()}setMinZoom(x){if((x=x??-2)>=-2&&x<=this.transform.maxZoom){let r=this.transform.zoom,u=this._getTransformForUpdate();return u.setMinZoom(x),this._applyUpdatedTransform(u),this._update(),r!==this.transform.zoom&&this.fire(new s.l("zoomstart")).fire(new s.l("zoom")).fire(new s.l("zoomend")).fire(new s.l("movestart")).fire(new s.l("move")).fire(new s.l("moveend")),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(x){if((x=x??22)>=this.transform.minZoom){let r=this.transform.zoom,u=this._getTransformForUpdate();return u.setMaxZoom(x),this._applyUpdatedTransform(u),this._update(),r!==this.transform.zoom&&this.fire(new s.l("zoomstart")).fire(new s.l("zoom")).fire(new s.l("zoomend")).fire(new s.l("movestart")).fire(new s.l("move")).fire(new s.l("moveend")),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(x){if((x=x??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(x>=0&&x<=this.transform.maxPitch){let r=this.transform.pitch,u=this._getTransformForUpdate();return u.setMinPitch(x),this._applyUpdatedTransform(u),this._update(),r!==this.transform.pitch&&this.fire(new s.l("pitchstart")).fire(new s.l("pitch")).fire(new s.l("pitchend")).fire(new s.l("movestart")).fire(new s.l("move")).fire(new s.l("moveend")),this}throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(x){if((x=x??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(x>=this.transform.minPitch){let r=this.transform.pitch,u=this._getTransformForUpdate();return u.setMaxPitch(x),this._applyUpdatedTransform(u),this._update(),r!==this.transform.pitch&&this.fire(new s.l("pitchstart")).fire(new s.l("pitch")).fire(new s.l("pitchend")).fire(new s.l("movestart")).fire(new s.l("move")).fire(new s.l("moveend")),this}throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(x){return this.transform.setRenderWorldCopies(x),this._update()}setTransformConstrain(x){return this.transform.setConstrainOverride(x),this._update()}project(x){return this.transform.locationToScreenPoint(s.V.convert(x),this.style&&this.terrain)}unproject(x){return this.transform.screenPointToLocation(s.P.convert(x),this.terrain)}isMoving(){var x;return this._moving||((x=this.handlers)===null||x===void 0?void 0:x.isMoving())}isZooming(){var x;return this._zooming||((x=this.handlers)===null||x===void 0?void 0:x.isZooming())}isRotating(){var x;return this._rotating||((x=this.handlers)===null||x===void 0?void 0:x.isRotating())}_createDelegatedListener(x,r,u){if(x==="mouseenter"||x==="mouseover"){let p=!1;return{layers:r,listener:u,delegates:{mousemove:E=>{let C=r.filter(R=>this.getLayer(R)),M=C.length!==0?this.queryRenderedFeatures(E.point,{layers:C}):[];M.length?p||(p=!0,u.call(this,new Dr(x,this,E.originalEvent,{features:M}))):p=!1},mouseout:()=>{p=!1}}}}if(x==="mouseleave"||x==="mouseout"){let p=!1;return{layers:r,listener:u,delegates:{mousemove:C=>{let M=r.filter(R=>this.getLayer(R));(M.length!==0?this.queryRenderedFeatures(C.point,{layers:M}):[]).length?p=!0:p&&(p=!1,u.call(this,new Dr(x,this,C.originalEvent)))},mouseout:C=>{p&&(p=!1,u.call(this,new Dr(x,this,C.originalEvent)))}}}}{let p=g=>{let E=r.filter(M=>this.getLayer(M)),C=E.length!==0?this.queryRenderedFeatures(g.point,{layers:E}):[];C.length&&(g.features=C,u.call(this,g),delete g.features)};return{layers:r,listener:u,delegates:{[x]:p}}}}_saveDelegatedListener(x,r){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[x]=this._delegatedListeners[x]||[],this._delegatedListeners[x].push(r)}_removeDelegatedListener(x,r,u){if(!this._delegatedListeners||!this._delegatedListeners[x])return;let p=this._delegatedListeners[x];for(let g=0;g<p.length;g++){let E=p[g];if(E.listener===u&&E.layers.length===r.length&&E.layers.every(C=>r.includes(C))){for(let C in E.delegates)this.off(C,E.delegates[C]);return void p.splice(g,1)}}}on(x,r,u){if(u===void 0)return super.on(x,r);let p=typeof r=="string"?[r]:r,g=this._createDelegatedListener(x,p,u);this._saveDelegatedListener(x,g);for(let E in g.delegates)this.on(E,g.delegates[E]);return{unsubscribe:()=>{this._removeDelegatedListener(x,p,u)}}}once(x,r,u){if(u===void 0)return super.once(x,r);let p=typeof r=="string"?[r]:r,g=this._createDelegatedListener(x,p,u);for(let E in g.delegates){let C=g.delegates[E];g.delegates[E]=(...M)=>{this._removeDelegatedListener(x,p,u),C(...M)}}this._saveDelegatedListener(x,g);for(let E in g.delegates)this.once(E,g.delegates[E]);return this}off(x,r,u){return u===void 0?super.off(x,r):(this._removeDelegatedListener(x,typeof r=="string"?[r]:r,u),this)}queryRenderedFeatures(x,r){if(!this.style)return[];let u,p=x instanceof s.P||Array.isArray(x),g=p?x:[[0,0],[this.transform.width,this.transform.height]];if(r=r||(p?{}:x)||{},g instanceof s.P||typeof g[0]=="number")u=[s.P.convert(g)];else{let E=s.P.convert(g[0]),C=s.P.convert(g[1]);u=[E,new s.P(C.x,E.y),C,new s.P(E.x,C.y),E]}return this.style.queryRenderedFeatures(u,r,this.transform)}querySourceFeatures(x,r){return this.style.querySourceFeatures(x,r)}setStyle(x,r){return(r=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&x?(this._diffStyle(x,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(x,r))}setTransformRequest(x){return this._requestManager.setTransformRequest(x),this}_getUIString(x){let r=this._locale[x];if(r==null)throw new Error(`Missing UI string '${x}'`);return r}_updateStyle(x,r){var u,p;if(r.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(x,r));let g=this.style&&r.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!x)),x?(this.style=new oa(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof x=="string"?this.style.loadURL(x,r,g):this.style.loadJSON(x,r,g),this):((p=(u=this.style)===null||u===void 0?void 0:u.projection)===null||p===void 0||p.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new oa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(x,r){if(typeof x=="string"){let u=this._requestManager.transformRequest(x,"Style");s.j(u,new AbortController).then(p=>{this._updateDiff(p.data,r)}).catch(p=>{p&&this.fire(new s.k(p))})}else typeof x=="object"&&this._updateDiff(x,r)}_updateDiff(x,r){try{this.style.setState(x,r)&&this._update(!0)}catch(u){s.w(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(x,r)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(x,r){return this._lazyInitEmptyStyle(),this.style.addSource(x,r),this._update(!0)}isSourceLoaded(x){let r=this.style&&this.style.tileManagers[x];if(r!==void 0)return r.loaded();this.fire(new s.k(new Error(`There is no tile manager with ID '${x}'`)))}setTerrain(x){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),x){let r=this.style.tileManagers[x.source];if(!r)throw new Error(`cannot load terrain, because there exists no source with ID: ${x.source}`);this.terrain===null&&r.reload();for(let u in this.style._layers){let p=this.style._layers[u];p.type==="hillshade"&&p.source===x.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),p.type==="color-relief"&&p.source===x.source&&s.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ui(this.painter,r,x),this.painter.renderToTexture=new $d(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=u=>{var p;u.dataType==="style"?this.terrain.tileManager.freeRtt():u.dataType==="source"&&u.tile&&(u.sourceId!==x.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((p=u.source)===null||p===void 0?void 0:p.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(u.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new s.l("terrain",{terrain:x})),this}getTerrain(){var x,r;return(r=(x=this.terrain)===null||x===void 0?void 0:x.options)!==null&&r!==void 0?r:null}areTilesLoaded(){let x=this.style&&this.style.tileManagers;for(let r of Object.values(x))if(!r.areTilesLoaded())return!1;return!0}removeSource(x){return this.style.removeSource(x),this._update(!0)}getSource(x){return this.style.getSource(x)}setSourceTileLodParams(x,r,u){if(u){let p=this.getSource(u);if(!p)throw new Error(`There is no source with ID "${u}", cannot set LOD parameters`);p.calculateTileZoom=xt(Math.max(1,x),Math.max(1,r))}else for(let p in this.style.tileManagers)this.style.tileManagers[p].getSource().calculateTileZoom=xt(Math.max(1,x),Math.max(1,r));return this._update(!0),this}refreshTiles(x,r){let u=this.style.tileManagers[x];if(!u)throw new Error(`There is no tile manager with ID "${x}", cannot refresh tile`);r===void 0?u.reload(!0):u.refreshTiles(r.map(p=>new s.ac(p.z,p.x,p.y)))}addImage(x,r,u={}){let{pixelRatio:p=1,sdf:g=!1,stretchX:E,stretchY:C,content:M,textFitWidth:R,textFitHeight:k}=u;if(this._lazyInitEmptyStyle(),!(r instanceof HTMLImageElement||s.b(r))){if(r.width===void 0||r.height===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:B,height:G,data:U}=r,Y=r;return this.style.addImage(x,{data:new s.R({width:B,height:G},new Uint8Array(U)),pixelRatio:p,stretchX:E,stretchY:C,content:M,textFitWidth:R,textFitHeight:k,sdf:g,version:0,userImage:Y}),Y.onAdd&&Y.onAdd(this,x),this}}{let{width:B,height:G,data:U}=z.getImageData(r);this.style.addImage(x,{data:new s.R({width:B,height:G},U),pixelRatio:p,stretchX:E,stretchY:C,content:M,textFitWidth:R,textFitHeight:k,sdf:g,version:0})}}updateImage(x,r){let u=this.style.getImage(x);if(!u)return this.fire(new s.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let p=r instanceof HTMLImageElement||s.b(r)?z.getImageData(r):r,{width:g,height:E,data:C}=p;if(g===void 0||E===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==u.data.width||E!==u.data.height)return this.fire(new s.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));let M=!(r instanceof HTMLImageElement||s.b(r));return u.data.replace(C,M),this.style.updateImage(x,u),this}getImage(x){return this.style.getImage(x)}hasImage(x){return x?!!this.style.getImage(x):(this.fire(new s.k(new Error("Missing required image id"))),!1)}removeImage(x){this.style.removeImage(x)}loadImage(x){return ke.getImage(this._requestManager.transformRequest(x,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(x,r){return this._lazyInitEmptyStyle(),this.style.addLayer(x,r),this._update(!0)}moveLayer(x,r){return this.style.moveLayer(x,r),this._update(!0)}removeLayer(x){return this.style.removeLayer(x),this._update(!0)}getLayer(x){return this.style.getLayer(x)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(x,r,u){return this.style.setLayerZoomRange(x,r,u),this._update(!0)}setFilter(x,r,u={}){return this.style.setFilter(x,r,u),this._update(!0)}getFilter(x){return this.style.getFilter(x)}setPaintProperty(x,r,u,p={}){return this.style.setPaintProperty(x,r,u,p),this._update(!0)}getPaintProperty(x,r){return this.style.getPaintProperty(x,r)}setLayoutProperty(x,r,u,p={}){return this.style.setLayoutProperty(x,r,u,p),this._update(!0)}getLayoutProperty(x,r){return this.style.getLayoutProperty(x,r)}setGlyphs(x,r={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(x,r),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(x,r,u={}){return this._lazyInitEmptyStyle(),this.style.addSprite(x,r,u,p=>{p||this._update(!0)}),this}removeSprite(x){return this._lazyInitEmptyStyle(),this.style.removeSprite(x),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(x,r={}){return this._lazyInitEmptyStyle(),this.style.setSprite(x,r,u=>{u||this._update(!0)}),this}setLight(x,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(x,r),this._update(!0)}getLight(){return this.style.getLight()}setSky(x,r={}){return this._lazyInitEmptyStyle(),this.style.setSky(x,r),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(x,r){return this.style.setFeatureState(x,r),this._update()}removeFeatureState(x,r){return this.style.removeFeatureState(x,r),this._update()}getFeatureState(x){return this.style.getFeatureState(x)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let x=0,r=0;return this._container&&(x=this._container.clientWidth||400,r=this._container.clientHeight||300),[x,r]}_setupResizeObserver(){var x;let r=!1,u=l_(g=>{this._trackResize&&!this._removed&&(this.resize(g),this.redraw())},50),p=(x=this._ownerWindow.ResizeObserver)!==null&&x!==void 0?x:ResizeObserver;this._resizeObserver=new p(g=>{r?u(g):r=!0}),this._resizeObserver.observe(this._container)}_resolveContainer(x){if(typeof x=="string"){let r=document.getElementById(x);if(!r)throw new Error(`Container '${x}' not found.`);return r}if(x instanceof HTMLElement||x&&typeof x=="object"&&x.nodeType===1)return x;throw new Error("Invalid type: 'container' must be a String or HTMLElement.")}_setupContainer(){let x=this._container;x.classList.add("maplibregl-map");let r=this._canvasContainer=W.create("div","maplibregl-canvas-container",x);this._interactive&&r.classList.add("maplibregl-interactive"),this._canvas=W.create("canvas","maplibregl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");let u=this._containerDimensions(),p=this._getClampedPixelRatio(u[0],u[1]);this._resizeCanvas(u[0],u[1],p);let g=this._controlContainer=W.create("div","maplibregl-control-container",x),E=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(C=>{E[C]=W.create("div",`maplibregl-ctrl-${C} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(x,r,u){this._canvas.width=Math.floor(u*x),this._canvas.height=Math.floor(u*r),this._canvas.style.width=`${x}px`,this._canvas.style.height=`${r}px`}_setupPainter(){let x=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0}),r=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{r={requestedAttributes:x},p&&(r.statusMessage=p.statusMessage,r.type=p.type)},{once:!0});let u=null;if(u=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,x):this._canvas.getContext("webgl2",x)||this._canvas.getContext("webgl",x),!u){let p="Failed to initialize WebGL";throw r?(r.message=p,new Error(JSON.stringify(r))):new Error(p)}this.painter=new s0(u,this.transform),me.testSupport(u)}migrateProjection(x,r){super.migrateProjection(x,r),this.painter.transform=x,this.fire(new s.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(x){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||x,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(x){return this._update(),this._renderTaskQueue.add(x)}_cancelRenderFrame(x){this._renderTaskQueue.remove(x)}_render(x){var r,u,p,g,E;let C=this._idleTriggered?this._fadeDuration:0,M=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(x),this._removed)return;let R=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let G=this.transform.zoom,U=q();this.style.zoomHistory.update(G,U);let Y=new s.H(G,{now:U,fadeDuration:C,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ee=Y.crossFadingFactor();ee===1&&ee===this._crossFadingFactor||(R=!0,this._crossFadingFactor=ee),this.style.update(Y)}let k=((u=this.style.projection)===null||u===void 0?void 0:u.transitionState)>0!==M;(p=this.style.projection)===null||p===void 0||p.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((g=this.style.projection)===null||g===void 0?void 0:g.transitionState,(E=this.style.projection)===null||E===void 0?void 0:E.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||k)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,C,this._crossSourceCollisions,k),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,showPadding:this.showPadding}),this.fire(new s.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.cH.mark(s.cI.load),this.fire(new s.l("load"))),this.style&&(this.style.hasTransitions()||R)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let B=this._sourcesDirty||this._styleDirty||this._placementDirty;return B||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.l("idle")),!this._loaded||this._fullyLoaded||B||(this._fullyLoaded=!0,s.cH.mark(s.cI.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var x;this._hash&&this._hash.remove();for(let u of this._controls)u.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&this._ownerWindow.removeEventListener("online",this._onWindowOnline,!1),ke.removeThrottleControl(this._imageQueueHandle),(x=this._resizeObserver)===null||x===void 0||x.disconnect();let r=this.painter.context.gl.getExtension("WEBGL_lose_context");r?.loseContext&&r.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),W.remove(this._canvasContainer),W.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),s.cH.clearMetrics(),this._removed=!0,this.fire(new s.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,z.frame(this._frameRequest,x=>{s.cH.frame(x),this._frameRequest=null;try{this._render(x)}catch(r){if(!s.Z(r)&&!(function(u){return u.message===F})(r))throw r}},()=>{},this._ownerWindow))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(x){this._showTileBoundaries!==x&&(this._showTileBoundaries=x,this._update())}get showPadding(){return!!this._showPadding}set showPadding(x){this._showPadding!==x&&(this._showPadding=x,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(x){this._showCollisionBoxes!==x&&(this._showCollisionBoxes=x,x?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(x){this._showOverdrawInspector!==x&&(this._showOverdrawInspector=x,this._update())}get repaint(){return!!this._repaint}set repaint(x){this._repaint!==x&&(this._repaint=x,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(x){this._vertices=x,this._update()}get version(){return y_}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(x){return this._lazyInitEmptyStyle(),this.style.setProjection(x),this._update(!0)}},a.MapMouseEvent=Dr,a.MapTouchEvent=Fd,a.MapWheelEvent=c0,a.Marker=qd,a.NavigationControl=class{constructor(x){this._updateZoomButtons=()=>{let r=this._map.getZoom(),u=r===this._map.getMaxZoom(),p=r===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(r,u)=>{let p=this._map._getUIString(`NavigationControl.${u}`);r.title=p,r.setAttribute("aria-label",p)},this.options=s.e({},v_,x),this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),W.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),W.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=W.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(x){return this._map=x,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Hd(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){W.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(x,r){let u=W.create("button",x,this._container);return u.type="button",u.addEventListener("click",r),u}},a.Popup=class extends s.E{constructor(x){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&W.remove(this._content),this._container&&(W.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.l("close"))),this),this._onMouseUp=r=>{this._update(r.point)},this._onMouseMove=r=>{this._update(r.point)},this._onDrag=r=>{this._update(r.point)},this._update=r=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=W.create("div","maplibregl-popup",this._map.getContainer()),this._tip=W.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let C of this.options.className.split(" "))this._container.classList.add(C);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Up(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!r)return;let u=this._flatPos=this._pos=this._trackPointer&&r?r:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&r?r:this._map.transform.locationToScreenPoint(this._lngLat));let p=this.options.anchor,g=Hp(this.options.offset);if(!p){let C=this._container.offsetWidth,M=this._container.offsetHeight,R=(function(B){var G,U,Y,ee;return B?{top:(G=B.top)!==null&&G!==void 0?G:0,right:(U=B.right)!==null&&U!==void 0?U:0,bottom:(Y=B.bottom)!==null&&Y!==void 0?Y:0,left:(ee=B.left)!==null&&ee!==void 0?ee:0}:{top:0,right:0,bottom:0,left:0}})(this.options.padding),k;k=u.y+g.bottom.y<M+R.top?["top"]:u.y>this._map.transform.height-M-R.bottom?["bottom"]:[],u.x<C/2+R.left?k.push("left"):u.x>this._map.transform.width-C/2-R.right&&k.push("right"),p=k.length===0?"bottom":k.join("-")}let E=u.add(g[p]);this.options.subpixelPositioning||(E=E.round()),W.setTransform(this._container,`${Zd[p]} translate(${E.x}px,${E.y}px)`),Gp(this._container,p,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(w_),x)}addTo(x){return this._map&&this.remove(),this._map=x,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(x){return this._lngLat=s.V.convert(x),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(x){return this.setDOMContent(document.createTextNode(x))}setHTML(x){let r=document.createDocumentFragment(),u=document.createElement("body"),p;for(u.innerHTML=x;p=u.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){var x;return(x=this._container)===null||x===void 0?void 0:x.style.maxWidth}setMaxWidth(x){return this.options.maxWidth=x,this._update(),this}setDOMContent(x){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=W.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(x),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(x){return this._container&&this._container.classList.add(x),this}removeClassName(x){return this._container&&this._container.classList.remove(x),this}setOffset(x){return this.options.offset=x,this._update(),this}toggleClassName(x){if(this._container)return this._container.classList.toggle(x)}setSubpixelPositioning(x){this.options.subpixelPositioning=x}setPadding(x){this.options.padding=x,this._update()}_createCloseButton(){this.options.closeButton&&(this._closeButton=W.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let x=this._container.querySelector($p);x&&x.focus()}},a.RasterDEMTileSource=ur,a.RasterTileSource=ro,a.ScaleControl=class{constructor(x){this._onMove=()=>{Wd(this._map,this._container,this.options)},this.setUnit=r=>{this.options.unit=r,Wd(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},b_),x)}getDefaultPosition(){return"bottom-left"}onAdd(x){return this._map=x,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-scale",x.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){W.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},a.ScrollZoomHandler=Np,a.Style=oa,a.TerrainControl=class{constructor(x){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=x}onAdd(x){return this._map=x,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=W.create("button","maplibregl-ctrl-terrain",this._container),W.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){W.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},a.TwoFingersTouchPitchHandler=f0,a.TwoFingersTouchRotateHandler=p_,a.TwoFingersTouchZoomHandler=f_,a.TwoFingersTouchZoomRotateHandler=Vd,a.VectorTileSource=Do,a.VideoSource=oo,a.addSourceType=(x,r)=>s._(void 0,void 0,void 0,function*(){if(as(x))throw new Error(`A source type called "${x}" already exists.`);((u,p)=>{Zo[u]=p})(x,r)}),a.clearPrewarmedResources=function(){let x=Sn;x&&(x.isPreloaded()&&x.numActive()===1?(x.release(et),Sn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.createTileMesh=mh,a.getMaxParallelImageRequests=function(){return s.c.MAX_PARALLEL_IMAGE_REQUESTS},a.getRTLTextPluginStatus=function(){return te().getRTLTextPluginStatus()},a.getVersion=function(){return E_},a.getWorkerCount=function(){return Zt.workerCount},a.getWorkerUrl=function(){return s.c.WORKER_URL},a.importScriptInWorkers=function(x){return Ti().broadcast("IS",x)},a.isTimeFrozen=function(){return H.isFrozen()},a.now=q,a.prewarm=function(){Ei().acquire(et)},a.restoreNow=function(){H.restoreNow()},a.setMaxParallelImageRequests=function(x){s.c.MAX_PARALLEL_IMAGE_REQUESTS=x},a.setNow=function(x){H.setNow(x)},a.setRTLTextPlugin=function(x,r){return te().setRTLTextPlugin(x,r)},a.setWorkerCount=function(x){Zt.workerCount=x},a.setWorkerUrl=function(x){s.c.WORKER_URL=x}});var o=n;return o})});var nT;function q0(){return nT}function Sc(n){let e=nT;return nT=n,e}var h2=Symbol("NotFound");function hm(n){return n===h2||n?.name==="\u0275NotFound"}var Qo=null,W0=!1,iT=1,mU=null,Ls=Symbol("SIGNAL");function pn(n){let e=Qo;return Qo=n,e}function Y0(){return Qo}var dm={version:0,lastCleanEpoch:0,dirty:!1,producers:void 0,producersTail:void 0,consumers:void 0,consumersTail:void 0,recomputing:!1,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function H_(n){if(W0)throw new Error("");if(Qo===null)return;Qo.consumerOnSignalRead(n);let e=Qo.producersTail;if(e!==void 0&&e.producer===n)return;let t,o=Qo.recomputing;if(o&&(t=e!==void 0?e.nextProducer:Qo.producers,t!==void 0&&t.producer===n)){Qo.producersTail=t,t.lastReadVersion=n.version;return}let a=n.consumersTail;if(a!==void 0&&a.consumer===Qo&&(!o||_U(a,Qo)))return;let s=mm(Qo),f={producer:n,consumer:Qo,nextProducer:t,prevConsumer:a,lastReadVersion:n.version,nextConsumer:void 0};Qo.producersTail=f,e!==void 0?e.nextProducer=f:Qo.producers=f,s&&m2(n,f)}function d2(){iT++}function rT(n){if(!(mm(n)&&!n.dirty)&&!(!n.dirty&&n.lastCleanEpoch===iT)){if(!n.producerMustRecompute(n)&&!pm(n)){X0(n);return}n.producerRecomputeValue(n),X0(n)}}function oT(n){if(n.consumers===void 0)return;let e=W0;W0=!0;try{for(let t=n.consumers;t!==void 0;t=t.nextConsumer){let o=t.consumer;o.dirty||gU(o)}}finally{W0=e}}function sT(){return Qo?.consumerAllowSignalWrites!==!1}function gU(n){n.dirty=!0,oT(n),n.consumerMarkedDirty?.(n)}function X0(n){n.dirty=!1,n.lastCleanEpoch=iT}function fm(n){return n&&f2(n),pn(n)}function f2(n){n.producersTail=void 0,n.recomputing=!0}function Z_(n,e){pn(e),n&&p2(n)}function p2(n){n.recomputing=!1;let e=n.producersTail,t=e!==void 0?e.nextProducer:n.producers;if(t!==void 0){if(mm(n))do t=aT(t);while(t!==void 0);e!==void 0?e.nextProducer=void 0:n.producers=void 0}}function pm(n){for(let e=n.producers;e!==void 0;e=e.nextProducer){let t=e.producer,o=e.lastReadVersion;if(o!==t.version||(rT(t),o!==t.version))return!0}return!1}function of(n){if(mm(n)){let e=n.producers;for(;e!==void 0;)e=aT(e)}n.producers=void 0,n.producersTail=void 0,n.consumers=void 0,n.consumersTail=void 0}function m2(n,e){let t=n.consumersTail,o=mm(n);if(t!==void 0?(e.nextConsumer=t.nextConsumer,t.nextConsumer=e):(e.nextConsumer=void 0,n.consumers=e),e.prevConsumer=t,n.consumersTail=e,!o)for(let a=n.producers;a!==void 0;a=a.nextProducer)m2(a.producer,a)}function aT(n){let e=n.producer,t=n.nextProducer,o=n.nextConsumer,a=n.prevConsumer;if(n.nextConsumer=void 0,n.prevConsumer=void 0,o!==void 0?o.prevConsumer=a:e.consumersTail=a,a!==void 0)a.nextConsumer=o;else if(e.consumers=o,!mm(e)){let s=e.producers;for(;s!==void 0;)s=aT(s)}return t}function mm(n){return n.consumerIsAlwaysLive||n.consumers!==void 0}function lT(n){mU?.(n)}function _U(n,e){let t=e.producersTail;if(t!==void 0){let o=e.producers;do{if(o===n)return!0;if(o===t)break;o=o.nextProducer}while(o!==void 0)}return!1}function cT(n,e){return Object.is(n,e)}function yU(){throw new Error}var g2=yU;function _2(n){g2(n)}function uT(n){g2=n}var vU=null;function hT(n,e){let t=Object.create(K0);t.value=n,e!==void 0&&(t.equal=e);let o=()=>y2(t);return o[Ls]=t,lT(t),[o,f=>gm(t,f),f=>dT(t,f)]}function y2(n){return H_(n),n.value}function gm(n,e){sT()||_2(n),n.equal(n.value,e)||(n.value=e,xU(n))}function dT(n,e){sT()||_2(n),gm(n,e(n.value))}var K0=Xn(St({},dm),{equal:cT,value:void 0,kind:"signal"});function xU(n){n.version++,d2(),oT(n),vU?.(n)}function Tn(n){return typeof n=="function"}function _m(n){let t=n(o=>{Error.call(o),o.stack=new Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var J0=_m(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:
${t.map((o,a)=>`${a+1}) ${o.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=t});function q_(n,e){if(n){let t=n.indexOf(e);0<=t&&n.splice(t,1)}}var Fr=class n{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;let{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(let s of t)s.remove(this);else t.remove(this);let{initialTeardown:o}=this;if(Tn(o))try{o()}catch(s){e=s instanceof J0?s.errors:[s]}let{_finalizers:a}=this;if(a){this._finalizers=null;for(let s of a)try{v2(s)}catch(f){e=e??[],f instanceof J0?e=[...e,...f.errors]:e.push(f)}}if(e)throw new J0(e)}}add(e){var t;if(e&&e!==this)if(this.closed)v2(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}}_hasParent(e){let{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){let{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){let{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&q_(t,e)}remove(e){let{_finalizers:t}=this;t&&q_(t,e),e instanceof n&&e._removeParent(this)}};Fr.EMPTY=(()=>{let n=new Fr;return n.closed=!0,n})();var fT=Fr.EMPTY;function Q0(n){return n instanceof Fr||n&&"closed"in n&&Tn(n.remove)&&Tn(n.add)&&Tn(n.unsubscribe)}function v2(n){Tn(n)?n():n.unsubscribe()}var Sl={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var ym={setTimeout(n,e,...t){let{delegate:o}=ym;return o?.setTimeout?o.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){let{delegate:e}=ym;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function ex(n){ym.setTimeout(()=>{let{onUnhandledError:e}=Sl;if(e)e(n);else throw n})}function W_(){}var x2=pT("C",void 0,void 0);function b2(n){return pT("E",void 0,n)}function w2(n){return pT("N",n,void 0)}function pT(n,e,t){return{kind:n,value:e,error:t}}var sf=null;function vm(n){if(Sl.useDeprecatedSynchronousErrorHandling){let e=!sf;if(e&&(sf={errorThrown:!1,error:null}),n(),e){let{errorThrown:t,error:o}=sf;if(sf=null,t)throw o}}else n()}function E2(n){Sl.useDeprecatedSynchronousErrorHandling&&sf&&(sf.errorThrown=!0,sf.error=n)}var af=class extends Fr{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,Q0(e)&&e.add(this)):this.destination=EU}static create(e,t,o){return new xm(e,t,o)}next(e){this.isStopped?gT(w2(e),this):this._next(e)}error(e){this.isStopped?gT(b2(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?gT(x2,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},bU=Function.prototype.bind;function mT(n,e){return bU.call(n,e)}var _T=class{constructor(e){this.partialObserver=e}next(e){let{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(o){tx(o)}}error(e){let{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(o){tx(o)}else tx(e)}complete(){let{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){tx(t)}}},xm=class extends af{constructor(e,t,o){super();let a;if(Tn(e)||!e)a={next:e??void 0,error:t??void 0,complete:o??void 0};else{let s;this&&Sl.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),a={next:e.next&&mT(e.next,s),error:e.error&&mT(e.error,s),complete:e.complete&&mT(e.complete,s)}):a=e}this.destination=new _T(a)}};function tx(n){Sl.useDeprecatedSynchronousErrorHandling?E2(n):ex(n)}function wU(n){throw n}function gT(n,e){let{onStoppedNotification:t}=Sl;t&&ym.setTimeout(()=>t(n,e))}var EU={closed:!0,next:W_,error:wU,complete:W_};var bm=typeof Symbol=="function"&&Symbol.observable||"@@observable";function xa(n){return n}function yT(...n){return vT(n)}function vT(n){return n.length===0?xa:n.length===1?n[0]:function(t){return n.reduce((o,a)=>a(o),t)}}var Yn=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){let o=new n;return o.source=this,o.operator=t,o}subscribe(t,o,a){let s=CU(t)?t:new xm(t,o,a);return vm(()=>{let{operator:f,source:v}=this;s.add(f?f.call(s,v):v?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(o){t.error(o)}}forEach(t,o){return o=T2(o),new o((a,s)=>{let f=new xm({next:v=>{try{t(v)}catch(w){s(w),f.unsubscribe()}},error:s,complete:a});this.subscribe(f)})}_subscribe(t){var o;return(o=this.source)===null||o===void 0?void 0:o.subscribe(t)}[bm](){return this}pipe(...t){return vT(t)(this)}toPromise(t){return t=T2(t),new t((o,a)=>{let s;this.subscribe(f=>s=f,f=>a(f),()=>o(s))})}}return n.create=e=>new n(e),n})();function T2(n){var e;return(e=n??Sl.Promise)!==null&&e!==void 0?e:Promise}function TU(n){return n&&Tn(n.next)&&Tn(n.error)&&Tn(n.complete)}function CU(n){return n&&n instanceof af||TU(n)&&Q0(n)}function xT(n){return Tn(n?.lift)}function Qn(n){return e=>{if(xT(e))return e.lift(function(t){try{return n(t,this)}catch(o){this.error(o)}});throw new TypeError("Unable to lift unknown Observable type")}}function ei(n,e,t,o,a){return new bT(n,e,t,o,a)}var bT=class extends af{constructor(e,t,o,a,s,f){super(e),this.onFinalize=s,this.shouldUnsubscribe=f,this._next=t?function(v){try{t(v)}catch(w){e.error(w)}}:super._next,this._error=a?function(v){try{a(v)}catch(w){e.error(w)}finally{this.unsubscribe()}}:super._error,this._complete=o?function(){try{o()}catch(v){e.error(v)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:t}=this;super.unsubscribe(),!t&&((e=this.onFinalize)===null||e===void 0||e.call(this))}}};function wm(){return Qn((n,e)=>{let t=null;n._refCount++;let o=ei(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount){t=null;return}let a=n._connection,s=t;t=null,a&&(!s||a===s)&&a.unsubscribe(),e.unsubscribe()});n.subscribe(o),o.closed||(t=n.connect())})}var Em=class extends Yn{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,xT(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){let e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new Fr;let t=this.getSubject();e.add(this.source.subscribe(ei(t,void 0,()=>{this._teardown(),t.complete()},o=>{this._teardown(),t.error(o)},()=>this._teardown()))),e.closed&&(this._connection=null,e=Fr.EMPTY)}return e}refCount(){return wm()(this)}};var C2=_m(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var No=(()=>{class n extends Yn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){let o=new nx(this,this);return o.operator=t,o}_throwIfClosed(){if(this.closed)throw new C2}next(t){vm(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let o of this.currentObservers)o.next(t)}})}error(t){vm(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;let{observers:o}=this;for(;o.length;)o.shift().error(t)}})}complete(){vm(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){let{hasError:o,isStopped:a,observers:s}=this;return o||a?fT:(this.currentObservers=null,s.push(t),new Fr(()=>{this.currentObservers=null,q_(s,t)}))}_checkFinalizedStatuses(t){let{hasError:o,thrownError:a,isStopped:s}=this;o?t.error(a):s&&t.complete()}asObservable(){let t=new Yn;return t.source=this,t}}return n.create=(e,t)=>new nx(e,t),n})(),nx=class extends No{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,o;(o=(t=this.destination)===null||t===void 0?void 0:t.next)===null||o===void 0||o.call(t,e)}error(e){var t,o;(o=(t=this.destination)===null||t===void 0?void 0:t.error)===null||o===void 0||o.call(t,e)}complete(){var e,t;(t=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||t===void 0||t.call(e)}_subscribe(e){var t,o;return(o=(t=this.source)===null||t===void 0?void 0:t.subscribe(e))!==null&&o!==void 0?o:fT}};var zo=class extends No{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){let t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){let{hasError:e,thrownError:t,_value:o}=this;if(e)throw t;return this._throwIfClosed(),o}next(e){super.next(this._value=e)}};var Os=new Yn(n=>n.complete());function I2(n){return n&&Tn(n.schedule)}function S2(n){return n[n.length-1]}function D2(n){return Tn(S2(n))?n.pop():void 0}function zh(n){return I2(S2(n))?n.pop():void 0}function P2(n,e,t,o){function a(s){return s instanceof t?s:new t(function(f){f(s)})}return new(t||(t=Promise))(function(s,f){function v(A){try{D(o.next(A))}catch(z){f(z)}}function w(A){try{D(o.throw(A))}catch(z){f(z)}}function D(A){A.done?s(A.value):a(A.value).then(v,w)}D((o=o.apply(n,e||[])).next())})}function M2(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],o=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&o>=n.length&&(n=void 0),{value:n&&n[o++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function lf(n){return this instanceof lf?(this.v=n,this):new lf(n)}function A2(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=t.apply(n,e||[]),a,s=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),v("next"),v("throw"),v("return",f),a[Symbol.asyncIterator]=function(){return this},a;function f(q){return function(W){return Promise.resolve(W).then(q,z)}}function v(q,W){o[q]&&(a[q]=function(me){return new Promise(function(ce,ue){s.push([q,me,ce,ue])>1||w(q,me)})},W&&(a[q]=W(a[q])))}function w(q,W){try{D(o[q](W))}catch(me){H(s[0][3],me)}}function D(q){q.value instanceof lf?Promise.resolve(q.value.v).then(A,z):H(s[0][2],q)}function A(q){w("next",q)}function z(q){w("throw",q)}function H(q,W){q(W),s.shift(),s.length&&w(s[0][0],s[0][1])}}function R2(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof M2=="function"?M2(n):n[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(s){t[s]=n[s]&&function(f){return new Promise(function(v,w){f=n[s](f),a(v,w,f.done,f.value)})}}function a(s,f,v,w){Promise.resolve(w).then(function(D){s({value:D,done:v})},f)}}var ix=n=>n&&typeof n.length=="number"&&typeof n!="function";function rx(n){return Tn(n?.then)}function ox(n){return Tn(n[bm])}function sx(n){return Symbol.asyncIterator&&Tn(n?.[Symbol.asyncIterator])}function ax(n){return new TypeError(`You provided ${n!==null&&typeof n=="object"?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function IU(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var lx=IU();function cx(n){return Tn(n?.[lx])}function ux(n){return A2(this,arguments,function*(){let t=n.getReader();try{for(;;){let{value:o,done:a}=yield lf(t.read());if(a)return yield lf(void 0);yield yield lf(o)}}finally{t.releaseLock()}})}function hx(n){return Tn(n?.getReader)}function go(n){if(n instanceof Yn)return n;if(n!=null){if(ox(n))return SU(n);if(ix(n))return DU(n);if(rx(n))return MU(n);if(sx(n))return L2(n);if(cx(n))return PU(n);if(hx(n))return AU(n)}throw ax(n)}function SU(n){return new Yn(e=>{let t=n[bm]();if(Tn(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function DU(n){return new Yn(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function MU(n){return new Yn(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,ex)})}function PU(n){return new Yn(e=>{for(let t of n)if(e.next(t),e.closed)return;e.complete()})}function L2(n){return new Yn(e=>{RU(n,e).catch(t=>e.error(t))})}function AU(n){return L2(ux(n))}function RU(n,e){var t,o,a,s;return P2(this,void 0,void 0,function*(){try{for(t=R2(n);o=yield t.next(),!o.done;){let f=o.value;if(e.next(f),e.closed)return}}catch(f){a={error:f}}finally{try{o&&!o.done&&(s=t.return)&&(yield s.call(t))}finally{if(a)throw a.error}}e.complete()})}function ks(n,e,t,o=0,a=!1){let s=e.schedule(function(){t(),a?n.add(this.schedule(null,o)):this.unsubscribe()},o);if(n.add(s),!a)return s}function dx(n,e=0){return Qn((t,o)=>{t.subscribe(ei(o,a=>ks(o,n,()=>o.next(a),e),()=>ks(o,n,()=>o.complete(),e),a=>ks(o,n,()=>o.error(a),e)))})}function fx(n,e=0){return Qn((t,o)=>{o.add(n.schedule(()=>t.subscribe(o),e))})}function O2(n,e){return go(n).pipe(fx(e),dx(e))}function k2(n,e){return go(n).pipe(fx(e),dx(e))}function F2(n,e){return new Yn(t=>{let o=0;return e.schedule(function(){o===n.length?t.complete():(t.next(n[o++]),t.closed||this.schedule())})})}function N2(n,e){return new Yn(t=>{let o;return ks(t,e,()=>{o=n[lx](),ks(t,e,()=>{let a,s;try{({value:a,done:s}=o.next())}catch(f){t.error(f);return}s?t.complete():t.next(a)},0,!0)}),()=>Tn(o?.return)&&o.return()})}function px(n,e){if(!n)throw new Error("Iterable cannot be null");return new Yn(t=>{ks(t,e,()=>{let o=n[Symbol.asyncIterator]();ks(t,e,()=>{o.next().then(a=>{a.done?t.complete():t.next(a.value)})},0,!0)})})}function z2(n,e){return px(ux(n),e)}function B2(n,e){if(n!=null){if(ox(n))return O2(n,e);if(ix(n))return F2(n,e);if(rx(n))return k2(n,e);if(sx(n))return px(n,e);if(cx(n))return N2(n,e);if(hx(n))return z2(n,e)}throw ax(n)}function Nr(n,e){return e?B2(n,e):go(n)}function un(...n){let e=zh(n);return Nr(n,e)}function Tm(n,e){let t=Tn(n)?n:()=>n,o=a=>a.error(t());return new Yn(e?a=>e.schedule(o,0,a):o)}function wT(n){return!!n&&(n instanceof Yn||Tn(n.lift)&&Tn(n.subscribe))}var Tu=_m(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function Fn(n,e){return Qn((t,o)=>{let a=0;t.subscribe(ei(o,s=>{o.next(n.call(e,s,a++))}))})}var{isArray:LU}=Array;function OU(n,e){return LU(e)?n(...e):n(e)}function j2(n){return Fn(e=>OU(n,e))}var{isArray:kU}=Array,{getPrototypeOf:FU,prototype:NU,keys:zU}=Object;function V2(n){if(n.length===1){let e=n[0];if(kU(e))return{args:e,keys:null};if(BU(e)){let t=zU(e);return{args:t.map(o=>e[o]),keys:t}}}return{args:n,keys:null}}function BU(n){return n&&typeof n=="object"&&FU(n)===NU}function U2(n,e){return n.reduce((t,o,a)=>(t[o]=e[a],t),{})}function mx(...n){let e=zh(n),t=D2(n),{args:o,keys:a}=V2(n);if(o.length===0)return Nr([],e);let s=new Yn(jU(o,e,a?f=>U2(a,f):xa));return t?s.pipe(j2(t)):s}function jU(n,e,t=xa){return o=>{G2(e,()=>{let{length:a}=n,s=new Array(a),f=a,v=a;for(let w=0;w<a;w++)G2(e,()=>{let D=Nr(n[w],e),A=!1;D.subscribe(ei(o,z=>{s[w]=z,A||(A=!0,v--),v||o.next(t(s.slice()))},()=>{--f||o.complete()}))},o)},o)}}function G2(n,e,t){n?ks(t,n,e):e()}function $2(n,e,t,o,a,s,f,v){let w=[],D=0,A=0,z=!1,H=()=>{z&&!w.length&&!D&&e.complete()},q=me=>D<o?W(me):w.push(me),W=me=>{s&&e.next(me),D++;let ce=!1;go(t(me,A++)).subscribe(ei(e,ue=>{a?.(ue),s?q(ue):e.next(ue)},()=>{ce=!0},void 0,()=>{if(ce)try{for(D--;w.length&&D<o;){let ue=w.shift();f?ks(e,f,()=>W(ue)):W(ue)}H()}catch(ue){e.error(ue)}}))};return n.subscribe(ei(e,q,()=>{z=!0,H()})),()=>{v?.()}}function Jr(n,e,t=1/0){return Tn(e)?Jr((o,a)=>Fn((s,f)=>e(o,s,a,f))(go(n(o,a))),t):(typeof e=="number"&&(t=e),Qn((o,a)=>$2(o,a,n,t)))}function H2(n=1/0){return Jr(xa,n)}function Z2(){return H2(1)}function Cm(...n){return Z2()(Nr(n,zh(n)))}function X_(n){return new Yn(e=>{go(n()).subscribe(e)})}function Fs(n,e){return Qn((t,o)=>{let a=0;t.subscribe(ei(o,s=>n.call(e,s,a++)&&o.next(s)))})}function Bh(n){return Qn((e,t)=>{let o=null,a=!1,s;o=e.subscribe(ei(t,void 0,void 0,f=>{s=go(n(f,Bh(n)(e))),o?(o.unsubscribe(),o=null,s.subscribe(t)):a=!0})),a&&(o.unsubscribe(),o=null,s.subscribe(t))})}function q2(n,e,t,o,a){return(s,f)=>{let v=t,w=e,D=0;s.subscribe(ei(f,A=>{let z=D++;w=v?n(w,A,z):(v=!0,A),o&&f.next(w)},a&&(()=>{v&&f.next(w),f.complete()})))}}function jh(n,e){return Tn(e)?Jr(n,e,1):Jr(n,1)}function Vh(n){return Qn((e,t)=>{let o=!1;e.subscribe(ei(t,a=>{o=!0,t.next(a)},()=>{o||t.next(n),t.complete()}))})}function Cu(n){return n<=0?()=>Os:Qn((e,t)=>{let o=0;e.subscribe(ei(t,a=>{++o<=n&&(t.next(a),n<=o&&t.complete())}))})}function gx(n=VU){return Qn((e,t)=>{let o=!1;e.subscribe(ei(t,a=>{o=!0,t.next(a)},()=>o?t.complete():t.error(n())))})}function VU(){return new Tu}function cf(n){return Qn((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}function Iu(n,e){let t=arguments.length>=2;return o=>o.pipe(n?Fs((a,s)=>n(a,s,o)):xa,Cu(1),t?Vh(e):gx(()=>new Tu))}function Im(n){return n<=0?()=>Os:Qn((e,t)=>{let o=[];e.subscribe(ei(t,a=>{o.push(a),n<o.length&&o.shift()},()=>{for(let a of o)t.next(a);t.complete()},void 0,()=>{o=null}))})}function ET(n,e){let t=arguments.length>=2;return o=>o.pipe(n?Fs((a,s)=>n(a,s,o)):xa,Im(1),t?Vh(e):gx(()=>new Tu))}function TT(n,e){return Qn(q2(n,e,arguments.length>=2,!0))}function CT(...n){let e=zh(n);return Qn((t,o)=>{(e?Cm(n,t,e):Cm(n,t)).subscribe(o)})}function es(n,e){return Qn((t,o)=>{let a=null,s=0,f=!1,v=()=>f&&!a&&o.complete();t.subscribe(ei(o,w=>{a?.unsubscribe();let D=0,A=s++;go(n(w,A)).subscribe(a=ei(o,z=>o.next(e?e(w,z,A,D++):z),()=>{a=null,v()}))},()=>{f=!0,v()}))})}function _x(n){return Qn((e,t)=>{go(n).subscribe(ei(t,()=>t.complete(),W_)),!t.closed&&e.subscribe(t)})}function _o(n,e,t){let o=Tn(n)||e||t?{next:n,error:e,complete:t}:n;return o?Qn((a,s)=>{var f;(f=o.subscribe)===null||f===void 0||f.call(o);let v=!0;a.subscribe(ei(s,w=>{var D;(D=o.next)===null||D===void 0||D.call(o,w),s.next(w)},()=>{var w;v=!1,(w=o.complete)===null||w===void 0||w.call(o),s.complete()},w=>{var D;v=!1,(D=o.error)===null||D===void 0||D.call(o,w),s.error(w)},()=>{var w,D;v&&((w=o.unsubscribe)===null||w===void 0||w.call(o)),(D=o.finalize)===null||D===void 0||D.call(o)}))}):xa}function W2(n){let e=pn(null);try{return n()}finally{pn(e)}}var X2=Xn(St({},dm),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!0,dirty:!0,kind:"effect"});function Y2(n){if(n.dirty=!1,n.version>0&&!pm(n))return;n.version++;let e=fm(n);try{n.cleanup(),n.fn()}finally{Z_(n,e)}}var FT="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss",Nt=class extends Error{code;constructor(e,t){super(Gh(e,t)),this.code=e}};function UU(n){return`NG0${Math.abs(n)}`}function Gh(n,e){return`${UU(n)}${e?": "+e:""}`}function vi(n){for(let e in n)if(n[e]===vi)return e;throw Error("")}function Du(n){if(typeof n=="string")return n;if(Array.isArray(n))return`[${n.map(Du).join(", ")}]`;if(n==null)return""+n;let e=n.overriddenName||n.name;if(e)return`${e}`;let t=n.toString();if(t==null)return""+t;let o=t.indexOf(`
`);return o>=0?t.slice(0,o):t}function wx(n,e){return n?e?`${n} ${e}`:n:e||""}var GU=vi({__forward_ref__:vi});function Ex(n){return n.__forward_ref__=Ex,n.toString=function(){return Du(this())},n}function Ns(n){return NT(n)?n():n}function NT(n){return typeof n=="function"&&n.hasOwnProperty(GU)&&n.__forward_ref__===Ex}function Ht(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function pf(n){return{providers:n.providers||[],imports:n.imports||[]}}function ey(n){return $U(n,Tx)}function zT(n){return ey(n)!==null}function $U(n,e){return n.hasOwnProperty(e)&&n[e]||null}function HU(n){let e=n?.[Tx]??null;return e||null}function ST(n){return n&&n.hasOwnProperty(vx)?n[vx]:null}var Tx=vi({\u0275prov:vi}),vx=vi({\u0275inj:vi}),Wt=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(e,t){this._desc=e,this.\u0275prov=void 0,typeof t=="number"?this.__NG_ELEMENT_ID__=t:t!==void 0&&(this.\u0275prov=Ht({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function BT(n){return n&&!!n.\u0275providers}var jT=vi({\u0275cmp:vi}),VT=vi({\u0275dir:vi}),UT=vi({\u0275pipe:vi}),GT=vi({\u0275mod:vi}),K_=vi({\u0275fac:vi}),mf=vi({__NG_ELEMENT_ID__:vi}),J2=vi({__NG_ENV_ID__:vi});function Cx(n){return typeof n=="string"?n:n==null?"":String(n)}function eL(n){return typeof n=="function"?n.name||n.toString():typeof n=="object"&&n!=null&&typeof n.type=="function"?n.type.name||n.type.toString():Cx(n)}var tL=vi({ngErrorCode:vi}),ZU=vi({ngErrorMessage:vi}),qU=vi({ngTokenPath:vi});function $T(n,e){return nL("",-200,e)}function Ix(n,e){throw new Nt(-201,!1)}function nL(n,e,t){let o=new Nt(e,n);return o[tL]=e,o[ZU]=n,t&&(o[qU]=t),o}function WU(n){return n[tL]}var DT;function iL(){return DT}function ba(n){let e=DT;return DT=n,e}function HT(n,e,t){let o=ey(n);if(o&&o.providedIn=="root")return o.value===void 0?o.value=o.factory():o.value;if(t&8)return null;if(e!==void 0)return e;Ix(n,"Injector")}var XU={},uf=XU,YU="__NG_DI_FLAG__",MT=class{injector;constructor(e){this.injector=e}retrieve(e,t){let o=hf(t)||0;try{return this.injector.get(e,o&8?null:uf,o)}catch(a){if(hm(a))return a;throw a}}};function KU(n,e=0){let t=q0();if(t===void 0)throw new Nt(-203,!1);if(t===null)return HT(n,void 0,e);{let o=JU(e),a=t.retrieve(n,o);if(hm(a)){if(o.optional)return null;throw a}return a}}function an(n,e=0){return(iL()||KU)(Ns(n),e)}function tt(n,e){return an(n,hf(e))}function hf(n){return typeof n>"u"||typeof n=="number"?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function JU(n){return{optional:!!(n&8),host:!!(n&1),self:!!(n&2),skipSelf:!!(n&4)}}function PT(n){let e=[];for(let t=0;t<n.length;t++){let o=Ns(n[t]);if(Array.isArray(o)){if(o.length===0)throw new Nt(900,!1);let a,s=0;for(let f=0;f<o.length;f++){let v=o[f],w=QU(v);typeof w=="number"?w===-1?a=v.token:s|=w:a=v}e.push(an(a,s))}else e.push(an(o))}return e}function QU(n){return n[YU]}function df(n,e){let t=n.hasOwnProperty(K_);return t?n[K_]:null}function Sx(n,e){n.forEach(t=>Array.isArray(t)?Sx(t,e):e(t))}function ZT(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function ty(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function rL(n,e,t,o){let a=n.length;if(a==e)n.push(t,o);else if(a===1)n.push(o,n[0]),n[0]=t;else{for(a--,n.push(n[a-1],n[a]);a>e;){let s=a-2;n[a]=n[s],a--}n[e]=t,n[e+1]=o}}function Dx(n,e,t){let o=Dm(n,e);return o>=0?n[o|1]=t:(o=~o,rL(n,o,e,t)),o}function Mx(n,e){let t=Dm(n,e);if(t>=0)return n[t|1]}function Dm(n,e){return e5(n,e,1)}function e5(n,e,t){let o=0,a=n.length>>t;for(;a!==o;){let s=o+(a-o>>1),f=n[s<<t];if(e===f)return s<<t;f>e?a=s:o=s+1}return~(a<<t)}var gf={},zs=[],Mu=new Wt(""),qT=new Wt("",-1),WT=new Wt(""),J_=class{get(e,t=uf){if(t===uf){let a=nL("",-201);throw a.name="\u0275NotFound",a}return t}};function XT(n){return n[GT]||null}function $h(n){return n[jT]||null}function YT(n){return n[VT]||null}function oL(n){return n[UT]||null}function Pu(n){return{\u0275providers:n}}function sL(n){return Pu([{provide:Mu,multi:!0,useValue:n}])}function aL(...n){return{\u0275providers:KT(!0,n),\u0275fromNgModule:!0}}function KT(n,...e){let t=[],o=new Set,a,s=f=>{t.push(f)};return Sx(e,f=>{let v=f;xx(v,s,[],o)&&(a||=[],a.push(v))}),a!==void 0&&lL(a,s),t}function lL(n,e){for(let t=0;t<n.length;t++){let{ngModule:o,providers:a}=n[t];JT(a,s=>{e(s,o)})}}function xx(n,e,t,o){if(n=Ns(n),!n)return!1;let a=null,s=ST(n),f=!s&&$h(n);if(!s&&!f){let w=n.ngModule;if(s=ST(w),s)a=w;else return!1}else{if(f&&!f.standalone)return!1;a=n}let v=o.has(a);if(f){if(v)return!1;if(o.add(a),f.dependencies){let w=typeof f.dependencies=="function"?f.dependencies():f.dependencies;for(let D of w)xx(D,e,t,o)}}else if(s){if(s.imports!=null&&!v){o.add(a);let D;try{Sx(s.imports,A=>{xx(A,e,t,o)&&(D||=[],D.push(A))})}finally{}D!==void 0&&lL(D,e)}if(!v){let D=df(a)||(()=>new a);e({provide:a,useFactory:D,deps:zs},a),e({provide:WT,useValue:a,multi:!0},a),e({provide:Mu,useValue:()=>an(a),multi:!0},a)}let w=s.providers;if(w!=null&&!v){let D=n;JT(w,A=>{e(A,D)})}}else return!1;return a!==n&&n.providers!==void 0}function JT(n,e){for(let t of n)BT(t)&&(t=t.\u0275providers),Array.isArray(t)?JT(t,e):e(t)}var t5=vi({provide:String,useValue:vi});function cL(n){return n!==null&&typeof n=="object"&&t5 in n}function n5(n){return!!(n&&n.useExisting)}function i5(n){return!!(n&&n.useFactory)}function bx(n){return typeof n=="function"}var ny=new Wt(""),yx={},Q2={},IT;function iy(){return IT===void 0&&(IT=new J_),IT}var Qr=class{},ff=class extends Qr{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(e,t,o,a){super(),this.parent=t,this.source=o,this.scopes=a,RT(e,f=>this.processProvider(f)),this.records.set(qT,Sm(void 0,this)),a.has("environment")&&this.records.set(Qr,Sm(void 0,this));let s=this.records.get(ny);s!=null&&typeof s.value=="string"&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(WT,zs,{self:!0}))}retrieve(e,t){let o=hf(t)||0;try{return this.get(e,uf,o)}catch(a){if(hm(a))return a;throw a}}destroy(){Y_(this),this._destroyed=!0;let e=pn(null);try{for(let o of this._ngOnDestroyHooks)o.ngOnDestroy();let t=this._onDestroyHooks;this._onDestroyHooks=[];for(let o of t)o()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),pn(e)}}onDestroy(e){return Y_(this),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){Y_(this);let t=Sc(this),o=ba(void 0),a;try{return e()}finally{Sc(t),ba(o)}}get(e,t=uf,o){if(Y_(this),e.hasOwnProperty(J2))return e[J2](this);let a=hf(o),s,f=Sc(this),v=ba(void 0);try{if(!(a&4)){let D=this.records.get(e);if(D===void 0){let A=l5(e)&&ey(e);A&&this.injectableDefInScope(A)?D=Sm(AT(e),yx):D=null,this.records.set(e,D)}if(D!=null)return this.hydrate(e,D,a)}let w=a&2?iy():this.parent;return t=a&8&&t===uf?null:t,w.get(e,t)}catch(w){let D=WU(w);throw D===-200||D===-201?new Nt(D,null):w}finally{ba(v),Sc(f)}}resolveInjectorInitializers(){let e=pn(null),t=Sc(this),o=ba(void 0),a;try{let s=this.get(Mu,zs,{self:!0});for(let f of s)f()}finally{Sc(t),ba(o),pn(e)}}toString(){let e=[],t=this.records;for(let o of t.keys())e.push(Du(o));return`R3Injector[${e.join(", ")}]`}processProvider(e){e=Ns(e);let t=bx(e)?e:Ns(e&&e.provide),o=o5(e);if(!bx(e)&&e.multi===!0){let a=this.records.get(t);a||(a=Sm(void 0,yx,!0),a.factory=()=>PT(a.multi),this.records.set(t,a)),t=e,a.multi.push(e)}this.records.set(t,o)}hydrate(e,t,o){let a=pn(null);try{if(t.value===Q2)throw $T(Du(e));return t.value===yx&&(t.value=Q2,t.value=t.factory(void 0,o)),typeof t.value=="object"&&t.value&&a5(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{pn(a)}}injectableDefInScope(e){if(!e.providedIn)return!1;let t=Ns(e.providedIn);return typeof t=="string"?t==="any"||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(e){let t=this._onDestroyHooks.indexOf(e);t!==-1&&this._onDestroyHooks.splice(t,1)}};function AT(n){let e=ey(n),t=e!==null?e.factory:df(n);if(t!==null)return t;if(n instanceof Wt)throw new Nt(204,!1);if(n instanceof Function)return r5(n);throw new Nt(204,!1)}function r5(n){if(n.length>0)throw new Nt(204,!1);let t=HU(n);return t!==null?()=>t.factory(n):()=>new n}function o5(n){if(cL(n))return Sm(void 0,n.useValue);{let e=uL(n);return Sm(e,yx)}}function uL(n,e,t){let o;if(bx(n)){let a=Ns(n);return df(a)||AT(a)}else if(cL(n))o=()=>Ns(n.useValue);else if(i5(n))o=()=>n.useFactory(...PT(n.deps||[]));else if(n5(n))o=(a,s)=>an(Ns(n.useExisting),s!==void 0&&s&8?8:void 0);else{let a=Ns(n&&(n.useClass||n.provide));if(s5(n))o=()=>new a(...PT(n.deps));else return df(a)||AT(a)}return o}function Y_(n){if(n.destroyed)throw new Nt(205,!1)}function Sm(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function s5(n){return!!n.deps}function a5(n){return n!==null&&typeof n=="object"&&typeof n.ngOnDestroy=="function"}function l5(n){return typeof n=="function"||typeof n=="object"&&n.ngMetadataName==="InjectionToken"}function RT(n,e){for(let t of n)Array.isArray(t)?RT(t,e):t&&BT(t)?RT(t.\u0275providers,e):e(t)}function Bo(n,e){let t;n instanceof ff?(Y_(n),t=n):t=new MT(n);let o,a=Sc(t),s=ba(void 0);try{return e()}finally{Sc(a),ba(s)}}function hL(){return iL()!==void 0||q0()!=null}var Ml=0,_n=1,gn=2,yo=3,Xa=4,Ya=5,Mm=6,Pm=7,Er=8,Au=9,Ru=10,pr=11,Am=12,QT=13,_f=14,wa=15,yf=16,vf=17,xf=18,ry=19,eC=20,Su=21,Px=22,Lu=23,Ea=24,Ax=25,bf=26,vo=27,dL=1,tC=6,Hh=7,oy=8,sy=9,Tr=10;function Ou(n){return Array.isArray(n)&&typeof n[dL]=="object"}function Pl(n){return Array.isArray(n)&&n[dL]===!0}function nC(n){return(n.flags&4)!==0}function Zh(n){return n.componentOffset>-1}function ay(n){return(n.flags&1)===1}function wf(n){return!!n.template}function Rm(n){return(n[gn]&512)!==0}function Ef(n){return(n[gn]&256)===256}var iC="svg",fL="math";function Ka(n){for(;Array.isArray(n);)n=n[Ml];return n}function rC(n,e){return Ka(e[n])}function Al(n,e){return Ka(e[n.index])}function ly(n,e){return n.data[e]}function Rl(n,e){let t=e[n];return Ou(t)?t:t[Ml]}function Rx(n){return(n[gn]&128)===128}function pL(n){return Pl(n[yo])}function Ja(n,e){return e==null?null:n[e]}function oC(n){n[vf]=0}function sC(n){n[gn]&1024||(n[gn]|=1024,Rx(n)&&Tf(n))}function mL(n,e){for(;n>0;)e=e[_f],n--;return e}function cy(n){return!!(n[gn]&9216||n[Ea]?.dirty)}function Lx(n){n[Ru].changeDetectionScheduler?.notify(8),n[gn]&64&&(n[gn]|=1024),cy(n)&&Tf(n)}function Tf(n){n[Ru].changeDetectionScheduler?.notify(0);let e=Uh(n);for(;e!==null&&!(e[gn]&8192||(e[gn]|=8192,!Rx(e)));)e=Uh(e)}function aC(n,e){if(Ef(n))throw new Nt(911,!1);n[Su]===null&&(n[Su]=[]),n[Su].push(e)}function gL(n,e){if(n[Su]===null)return;let t=n[Su].indexOf(e);t!==-1&&n[Su].splice(t,1)}function Uh(n){let e=n[yo];return Pl(e)?e[yo]:e}function _L(n){return n[Pm]??=[]}function yL(n){return n.cleanup??=[]}var zn={lFrame:PL(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var LT=!1;function vL(){return zn.lFrame.elementDepthCount}function xL(){zn.lFrame.elementDepthCount++}function lC(){zn.lFrame.elementDepthCount--}function cC(){return zn.bindingsEnabled}function bL(){return zn.skipHydrationRootTNode!==null}function uC(n){return zn.skipHydrationRootTNode===n}function hC(){zn.skipHydrationRootTNode=null}function hi(){return zn.lFrame.lView}function Bs(){return zn.lFrame.tView}function Ta(n){return zn.lFrame.contextLView=n,n[Er]}function Ca(n){return zn.lFrame.contextLView=null,n}function js(){let n=dC();for(;n!==null&&n.type===64;)n=n.parent;return n}function dC(){return zn.lFrame.currentTNode}function wL(){let n=zn.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}function Lm(n,e){let t=zn.lFrame;t.currentTNode=n,t.isParent=e}function fC(){return zn.lFrame.isParent}function EL(){zn.lFrame.isParent=!1}function pC(){return LT}function Om(n){let e=LT;return LT=n,e}function TL(n){return zn.lFrame.bindingIndex=n}function km(){return zn.lFrame.bindingIndex++}function mC(n){let e=zn.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}function CL(){return zn.lFrame.inI18n}function IL(n,e){let t=zn.lFrame;t.bindingIndex=t.bindingRootIndex=n,Ox(e)}function SL(){return zn.lFrame.currentDirectiveIndex}function Ox(n){zn.lFrame.currentDirectiveIndex=n}function DL(n){let e=zn.lFrame.currentDirectiveIndex;return e===-1?null:n[e]}function gC(n){zn.lFrame.currentQueryIndex=n}function c5(n){let e=n[_n];return e.type===2?e.declTNode:e.type===1?n[Ya]:null}function _C(n,e,t){if(t&4){let a=e,s=n;for(;a=a.parent,a===null&&!(t&1);)if(a=c5(s),a===null||(s=s[_f],a.type&10))break;if(a===null)return!1;e=a,n=s}let o=zn.lFrame=ML();return o.currentTNode=e,o.lView=n,!0}function kx(n){let e=ML(),t=n[_n];zn.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function ML(){let n=zn.lFrame,e=n===null?null:n.child;return e===null?PL(n):e}function PL(n){let e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return n!==null&&(n.child=e),e}function AL(){let n=zn.lFrame;return zn.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}var yC=AL;function Fx(){let n=AL();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function RL(n){return(zn.lFrame.contextLView=mL(n,zn.lFrame.contextLView))[Er]}function ku(){return zn.lFrame.selectedIndex}function qh(n){zn.lFrame.selectedIndex=n}function vC(){let n=zn.lFrame;return ly(n.tView,n.selectedIndex)}function Fm(){zn.lFrame.currentNamespace=iC}function Nm(){u5()}function u5(){zn.lFrame.currentNamespace=null}function LL(){return zn.lFrame.currentNamespace}var OL=!0;function Nx(){return OL}function zx(n){OL=n}function OT(n,e=null,t=null,o){let a=xC(n,e,t,o);return a.resolveInjectorInitializers(),a}function xC(n,e=null,t=null,o,a=new Set){let s=[t||zs,aL(n)];return o=o||(typeof n=="object"?void 0:Du(n)),new ff(s,e||iy(),o||null,a)}var Wa=class n{static THROW_IF_NOT_FOUND=uf;static NULL=new J_;static create(e,t){if(Array.isArray(e))return OT({name:""},t,e,"");{let o=e.name??"";return OT({name:o},e.parent,e.providers,o)}}static \u0275prov=Ht({token:n,providedIn:"any",factory:()=>an(qT)});static __NG_ELEMENT_ID__=-1},zr=new Wt(""),Mc=(()=>{class n{static __NG_ELEMENT_ID__=h5;static __NG_ENV_ID__=t=>t}return n})(),Q_=class extends Mc{_lView;constructor(e){super(),this._lView=e}get destroyed(){return Ef(this._lView)}onDestroy(e){let t=this._lView;return aC(t,e),()=>gL(t,e)}};function h5(){return new Q_(hi())}var Dl=class{_console=console;handleError(e){this._console.error("ERROR",e)}},Vs=new Wt("",{providedIn:"root",factory:()=>{let n=tt(Qr),e;return t=>{n.destroyed&&!e?setTimeout(()=>{throw t}):(e??=n.get(Dl),e.handleError(t))}}}),kL={provide:Mu,useValue:()=>void tt(Dl),multi:!0},d5=new Wt("",{providedIn:"root",factory:()=>{let n=tt(zr).defaultView;if(!n)return;let e=tt(Vs),t=s=>{e(s.reason),s.preventDefault()},o=s=>{s.error?e(s.error):e(new Error(s.message,{cause:s})),s.preventDefault()},a=()=>{n.addEventListener("unhandledrejection",t),n.addEventListener("error",o)};typeof Zone<"u"?Zone.root.run(a):a(),tt(Mc).onDestroy(()=>{n.removeEventListener("error",o),n.removeEventListener("unhandledrejection",t)})}});function bC(){return Pu([sL(()=>void tt(d5))])}function Fi(n,e){let[t,o,a]=hT(n,e?.equal),s=t,f=s[Ls];return s.set=o,s.update=a,s.asReadonly=wC.bind(s),s}function wC(){let n=this[Ls];if(n.readonlyFn===void 0){let e=()=>this();e[Ls]=n,n.readonlyFn=e}return n.readonlyFn}var uy=(()=>{class n{view;node;constructor(t,o){this.view=t,this.node=o}static __NG_ELEMENT_ID__=f5}return n})();function f5(){return new uy(hi(),js())}var Dc=class{},hy=new Wt("",{providedIn:"root",factory:()=>!1});var EC=new Wt(""),TC=new Wt(""),Pc=(()=>{class n{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new zo(!1);get hasPendingTasks(){return this.destroyed?!1:this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new Yn(t=>{t.next(!1),t.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);let t=this.taskId++;return this.pendingTasks.add(t),t}has(t){return this.pendingTasks.has(t)}remove(t){this.pendingTasks.delete(t),this.pendingTasks.size===0&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=Ht({token:n,providedIn:"root",factory:()=>new n})}return n})(),dy=(()=>{class n{internalPendingTasks=tt(Pc);scheduler=tt(Dc);errorHandler=tt(Vs);add(){let t=this.internalPendingTasks.add();return()=>{this.internalPendingTasks.has(t)&&(this.scheduler.notify(11),this.internalPendingTasks.remove(t))}}run(t){let o=this.add();t().catch(this.errorHandler).finally(o)}static \u0275prov=Ht({token:n,providedIn:"root",factory:()=>new n})}return n})();function Cf(...n){}var fy=(()=>{class n{static \u0275prov=Ht({token:n,providedIn:"root",factory:()=>new kT})}return n})(),kT=class{dirtyEffectCount=0;queues=new Map;add(e){this.enqueue(e),this.schedule(e)}schedule(e){e.dirty&&this.dirtyEffectCount++}remove(e){let t=e.zone,o=this.queues.get(t);o.has(e)&&(o.delete(e),e.dirty&&this.dirtyEffectCount--)}enqueue(e){let t=e.zone;this.queues.has(t)||this.queues.set(t,new Set);let o=this.queues.get(t);o.has(e)||o.add(e)}flush(){for(;this.dirtyEffectCount>0;){let e=!1;for(let[t,o]of this.queues)t===null?e||=this.flushQueue(o):e||=t.run(()=>this.flushQueue(o));e||(this.dirtyEffectCount=0)}}flushQueue(e){let t=!1;for(let o of e)o.dirty&&(this.dirtyEffectCount--,t=!0,o.run());return t}};function wy(n){return{toString:n}.toString()}function b5(n){return typeof n=="function"}var $x=class{previousValue;currentValue;firstChange;constructor(e,t,o){this.previousValue=e,this.currentValue=t,this.firstChange=o}isFirstChange(){return this.firstChange}};function dO(n,e,t,o){e!==null?e.applyValueToInputSignal(e,o):n[t]=o}var sb=(()=>{let n=()=>fO;return n.ngInherit=!0,n})();function fO(n){return n.type.prototype.ngOnChanges&&(n.setInput=E5),w5}function w5(){let n=mO(this),e=n?.current;if(e){let t=n.previous;if(t===gf)n.previous=e;else for(let o in e)t[o]=e[o];n.current=null,this.ngOnChanges(e)}}function E5(n,e,t,o,a){let s=this.declaredInputs[o],f=mO(n)||T5(n,{previous:gf,current:null}),v=f.current||(f.current={}),w=f.previous,D=w[s];v[s]=new $x(D&&D.currentValue,t,w===gf),dO(n,e,a,t)}var pO="__ngSimpleChanges__";function mO(n){return n[pO]||null}function T5(n,e){return n[pO]=e}var FL=[];var Ni=function(n,e=null,t){for(let o=0;o<FL.length;o++){let a=FL[o];a(n,e,t)}};function C5(n,e,t){let{ngOnChanges:o,ngOnInit:a,ngDoCheck:s}=e.type.prototype;if(o){let f=fO(e);(t.preOrderHooks??=[]).push(n,f),(t.preOrderCheckHooks??=[]).push(n,f)}a&&(t.preOrderHooks??=[]).push(0-n,a),s&&((t.preOrderHooks??=[]).push(n,s),(t.preOrderCheckHooks??=[]).push(n,s))}function gO(n,e){for(let t=e.directiveStart,o=e.directiveEnd;t<o;t++){let s=n.data[t].type.prototype,{ngAfterContentInit:f,ngAfterContentChecked:v,ngAfterViewInit:w,ngAfterViewChecked:D,ngOnDestroy:A}=s;f&&(n.contentHooks??=[]).push(-t,f),v&&((n.contentHooks??=[]).push(t,v),(n.contentCheckHooks??=[]).push(t,v)),w&&(n.viewHooks??=[]).push(-t,w),D&&((n.viewHooks??=[]).push(t,D),(n.viewCheckHooks??=[]).push(t,D)),A!=null&&(n.destroyHooks??=[]).push(t,A)}}function jx(n,e,t){_O(n,e,3,t)}function Vx(n,e,t,o){(n[gn]&3)===t&&_O(n,e,t,o)}function CC(n,e){let t=n[gn];(t&3)===e&&(t&=16383,t+=1,n[gn]=t)}function _O(n,e,t,o){let a=o!==void 0?n[vf]&65535:0,s=o??-1,f=e.length-1,v=0;for(let w=a;w<f;w++)if(typeof e[w+1]=="number"){if(v=e[w],o!=null&&v>=o)break}else e[w]<0&&(n[vf]+=65536),(v<s||s==-1)&&(I5(n,t,e,w),n[vf]=(n[vf]&4294901760)+w+2),w++}function NL(n,e){Ni(4,n,e);let t=pn(null);try{e.call(n)}finally{pn(t),Ni(5,n,e)}}function I5(n,e,t,o){let a=t[o]<0,s=t[o+1],f=a?-t[o]:t[o],v=n[f];a?n[gn]>>14<n[vf]>>16&&(n[gn]&3)===e&&(n[gn]+=16384,NL(v,s)):NL(v,s)}var Bm=-1,gy=class{factory;name;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(e,t,o,a){this.factory=e,this.name=a,this.canSeeViewProviders=t,this.injectImpl=o}};function S5(n){return(n.flags&8)!==0}function D5(n){return(n.flags&16)!==0}function M5(n,e,t){let o=0;for(;o<t.length;){let a=t[o];if(typeof a=="number"){if(a!==0)break;o++;let s=t[o++],f=t[o++],v=t[o++];n.setAttribute(e,f,v,s)}else{let s=a,f=t[++o];A5(s)?n.setProperty(e,s,f):n.setAttribute(e,s,f),o++}}return o}function P5(n){return n===3||n===4||n===6}function A5(n){return n.charCodeAt(0)===64}function ab(n,e){if(!(e===null||e.length===0))if(n===null||n.length===0)n=e.slice();else{let t=-1;for(let o=0;o<e.length;o++){let a=e[o];typeof a=="number"?t=a:t===0||(t===-1||t===2?zL(n,t,a,null,e[++o]):zL(n,t,a,null,null))}}return n}function zL(n,e,t,o,a){let s=0,f=n.length;if(e===-1)f=-1;else for(;s<n.length;){let v=n[s++];if(typeof v=="number"){if(v===e){f=-1;break}else if(v>e){f=s-1;break}}}for(;s<n.length;){let v=n[s];if(typeof v=="number")break;if(v===t){a!==null&&(n[s+1]=a);return}s++,a!==null&&s++}f!==-1&&(n.splice(f,0,e),s=f+1),n.splice(s++,0,t),a!==null&&n.splice(s++,0,a)}function yO(n){return n!==Bm}function Hx(n){return n&32767}function R5(n){return n>>16}function Zx(n,e){let t=R5(n),o=e;for(;t>0;)o=o[_f],t--;return o}var RC=!0;function BL(n){let e=RC;return RC=n,e}var L5=256,vO=L5-1,xO=5,O5=0,Ac={};function k5(n,e,t){let o;typeof t=="string"?o=t.charCodeAt(0)||0:t.hasOwnProperty(mf)&&(o=t[mf]),o==null&&(o=t[mf]=O5++);let a=o&vO,s=1<<a;e.data[n+(a>>xO)]|=s}function bO(n,e){let t=wO(n,e);if(t!==-1)return t;let o=e[_n];o.firstCreatePass&&(n.injectorIndex=e.length,IC(o.data,n),IC(e,null),IC(o.blueprint,null));let a=iI(n,e),s=n.injectorIndex;if(yO(a)){let f=Hx(a),v=Zx(a,e),w=v[_n].data;for(let D=0;D<8;D++)e[s+D]=v[f+D]|w[f+D]}return e[s+8]=a,s}function IC(n,e){n.push(0,0,0,0,0,0,0,0,e)}function wO(n,e){return n.injectorIndex===-1||n.parent&&n.parent.injectorIndex===n.injectorIndex||e[n.injectorIndex+8]===null?-1:n.injectorIndex}function iI(n,e){if(n.parent&&n.parent.injectorIndex!==-1)return n.parent.injectorIndex;let t=0,o=null,a=e;for(;a!==null;){if(o=SO(a),o===null)return Bm;if(t++,a=a[_f],o.injectorIndex!==-1)return o.injectorIndex|t<<16}return Bm}function F5(n,e,t){k5(n,e,t)}function EO(n,e,t){if(t&8||n!==void 0)return n;Ix(e,"NodeInjector")}function TO(n,e,t,o){if(t&8&&o===void 0&&(o=null),(t&3)===0){let a=n[Au],s=ba(void 0);try{return a?a.get(e,o,t&8):HT(e,o,t&8)}finally{ba(s)}}return EO(o,e,t)}function CO(n,e,t,o=0,a){if(n!==null){if(e[gn]&2048&&!(o&2)){let f=V5(n,e,t,o,Ac);if(f!==Ac)return f}let s=IO(n,e,t,o,Ac);if(s!==Ac)return s}return TO(e,t,o,a)}function IO(n,e,t,o,a){let s=B5(t);if(typeof s=="function"){if(!_C(e,n,o))return o&1?EO(a,t,o):TO(e,t,o,a);try{let f;if(f=s(o),f==null&&!(o&8))Ix(t);else return f}finally{yC()}}else if(typeof s=="number"){let f=null,v=wO(n,e),w=Bm,D=o&1?e[wa][Ya]:null;for((v===-1||o&4)&&(w=v===-1?iI(n,e):e[v+8],w===Bm||!VL(o,!1)?v=-1:(f=e[_n],v=Hx(w),e=Zx(w,e)));v!==-1;){let A=e[_n];if(jL(s,v,A.data)){let z=N5(v,e,t,f,o,D);if(z!==Ac)return z}w=e[v+8],w!==Bm&&VL(o,e[_n].data[v+8]===D)&&jL(s,v,e)?(f=A,v=Hx(w),e=Zx(w,e)):v=-1}}return a}function N5(n,e,t,o,a,s){let f=e[_n],v=f.data[n+8],w=o==null?Zh(v)&&RC:o!=f&&(v.type&3)!==0,D=a&1&&s===v,A=z5(v,f,t,w,D);return A!==null?LC(e,f,A,v,a):Ac}function z5(n,e,t,o,a){let s=n.providerIndexes,f=e.data,v=s&1048575,w=n.directiveStart,D=n.directiveEnd,A=s>>20,z=o?v:v+A,H=a?v+A:D;for(let q=z;q<H;q++){let W=f[q];if(q<w&&t===W||q>=w&&W.type===t)return q}if(a){let q=f[w];if(q&&wf(q)&&q.type===t)return w}return null}function LC(n,e,t,o,a){let s=n[t],f=e.data;if(s instanceof gy){let v=s;if(v.resolving){let q=eL(f[t]);throw $T(q)}let w=BL(v.canSeeViewProviders);v.resolving=!0;let D=f[t].type||f[t],A,z=v.injectImpl?ba(v.injectImpl):null,H=_C(n,o,0);try{s=n[t]=v.factory(void 0,a,f,n,o),e.firstCreatePass&&t>=o.directiveStart&&C5(t,f[t],e)}finally{z!==null&&ba(z),BL(w),v.resolving=!1,yC()}}return s}function B5(n){if(typeof n=="string")return n.charCodeAt(0)||0;let e=n.hasOwnProperty(mf)?n[mf]:void 0;return typeof e=="number"?e>=0?e&vO:j5:e}function jL(n,e,t){let o=1<<n;return!!(t[e+(n>>xO)]&o)}function VL(n,e){return!(n&2)&&!(n&1&&e)}var If=class{_tNode;_lView;constructor(e,t){this._tNode=e,this._lView=t}get(e,t,o){return CO(this._tNode,this._lView,e,hf(o),t)}};function j5(){return new If(js(),hi())}function lb(n){return wy(()=>{let e=n.prototype.constructor,t=e[K_]||OC(e),o=Object.prototype,a=Object.getPrototypeOf(n.prototype).constructor;for(;a&&a!==o;){let s=a[K_]||OC(a);if(s&&s!==t)return s;a=Object.getPrototypeOf(a)}return s=>new s})}function OC(n){return NT(n)?()=>{let e=OC(Ns(n));return e&&e()}:df(n)}function V5(n,e,t,o,a){let s=n,f=e;for(;s!==null&&f!==null&&f[gn]&2048&&!Rm(f);){let v=IO(s,f,t,o|2,Ac);if(v!==Ac)return v;let w=s.parent;if(!w){let D=f[eC];if(D){let A=D.get(t,Ac,o);if(A!==Ac)return A}w=SO(f),f=f[_f]}s=w}return a}function SO(n){let e=n[_n],t=e.type;return t===2?e.declTNode:t===1?n[Ya]:null}function U5(){return cb(js(),hi())}function cb(n,e){return new rI(Al(n,e))}var rI=(()=>{class n{nativeElement;constructor(t){this.nativeElement=t}static __NG_ELEMENT_ID__=U5}return n})();function DO(n){return(n.flags&128)===128}var oI=(function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n})(oI||{}),MO=new Map,G5=0;function $5(){return G5++}function H5(n){MO.set(n[ry],n)}function kC(n){MO.delete(n[ry])}var UL="__ngContext__";function jm(n,e){Ou(e)?(n[UL]=e[ry],H5(e)):n[UL]=e}function PO(n){return RO(n[Am])}function AO(n){return RO(n[Xa])}function RO(n){for(;n!==null&&!Pl(n);)n=n[Xa];return n}var FC;function sI(n){FC=n}function LO(){if(FC!==void 0)return FC;if(typeof document<"u")return document;throw new Nt(210,!1)}var ub=new Wt("",{providedIn:"root",factory:()=>Z5}),Z5="ng",hb=new Wt(""),Ey=new Wt("",{providedIn:"platform",factory:()=>"unknown"});var db=new Wt("",{providedIn:"root",factory:()=>LO().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var q5="h",W5="b";var OO="r";var kO="di";var FO=!1,NO=new Wt("",{providedIn:"root",factory:()=>FO});var X5=(n,e,t,o)=>{};function Y5(n,e,t,o){X5(n,e,t,o)}function aI(n){return(n.flags&32)===32}var K5=()=>null;function zO(n,e,t=!1){return K5(n,e,t)}function BO(n,e){let t=n.contentQueries;if(t!==null){let o=pn(null);try{for(let a=0;a<t.length;a+=2){let s=t[a],f=t[a+1];if(f!==-1){let v=n.data[f];gC(s),v.contentQueries(2,e[f],f)}}}finally{pn(o)}}}function NC(n,e,t){gC(0);let o=pn(null);try{e(n,t)}finally{pn(o)}}function jO(n,e,t){if(nC(e)){let o=pn(null);try{let a=e.directiveStart,s=e.directiveEnd;for(let f=a;f<s;f++){let v=n.data[f];if(v.contentQueries){let w=t[f];v.contentQueries(1,w,f)}}}finally{pn(o)}}}var Fu=(function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n})(Fu||{});var zC=class{changingThisBreaksApplicationSecurity;constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${FT})`}};function lI(n){return n instanceof zC?n.changingThisBreaksApplicationSecurity:n}function J5(n,e){return n.createText(e)}function Q5(n,e,t){n.setValue(e,t)}function VO(n,e,t){return n.createElement(e,t)}function qx(n,e,t,o,a){n.insertBefore(e,t,o,a)}function UO(n,e,t){n.appendChild(e,t)}function GL(n,e,t,o,a){o!==null?qx(n,e,t,o,a):UO(n,e,t)}function GO(n,e,t,o){n.removeChild(null,e,t,o)}function eG(n,e,t){n.setAttribute(e,"style",t)}function tG(n,e,t){t===""?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}function $O(n,e,t){let{mergedAttrs:o,classes:a,styles:s}=t;o!==null&&M5(n,e,o),a!==null&&tG(n,e,a),s!==null&&eG(n,e,s)}function HO(n){return n instanceof Function?n():n}function nG(n,e,t){let o=n.length;for(;;){let a=n.indexOf(e,t);if(a===-1)return a;if(a===0||n.charCodeAt(a-1)<=32){let s=e.length;if(a+s===o||n.charCodeAt(a+s)<=32)return a}t=a+1}}var ZO="ng-template";function iG(n,e,t,o){let a=0;if(o){for(;a<e.length&&typeof e[a]=="string";a+=2)if(e[a]==="class"&&nG(e[a+1].toLowerCase(),t,0)!==-1)return!0}else if(cI(n))return!1;if(a=e.indexOf(1,a),a>-1){let s;for(;++a<e.length&&typeof(s=e[a])=="string";)if(s.toLowerCase()===t)return!0}return!1}function cI(n){return n.type===4&&n.value!==ZO}function rG(n,e,t){let o=n.type===4&&!t?ZO:n.value;return e===o}function oG(n,e,t){let o=4,a=n.attrs,s=a!==null?lG(a):0,f=!1;for(let v=0;v<e.length;v++){let w=e[v];if(typeof w=="number"){if(!f&&!Ll(o)&&!Ll(w))return!1;if(f&&Ll(w))continue;f=!1,o=w|o&1;continue}if(!f)if(o&4){if(o=2|o&1,w!==""&&!rG(n,w,t)||w===""&&e.length===1){if(Ll(o))return!1;f=!0}}else if(o&8){if(a===null||!iG(n,a,w,t)){if(Ll(o))return!1;f=!0}}else{let D=e[++v],A=sG(w,a,cI(n),t);if(A===-1){if(Ll(o))return!1;f=!0;continue}if(D!==""){let z;if(A>s?z="":z=a[A+1].toLowerCase(),o&2&&D!==z){if(Ll(o))return!1;f=!0}}}}return Ll(o)||f}function Ll(n){return(n&1)===0}function sG(n,e,t,o){if(e===null)return-1;let a=0;if(o||!t){let s=!1;for(;a<e.length;){let f=e[a];if(f===n)return a;if(f===3||f===6)s=!0;else if(f===1||f===2){let v=e[++a];for(;typeof v=="string";)v=e[++a];continue}else{if(f===4)break;if(f===0){a+=4;continue}}a+=s?1:2}return-1}else return cG(e,n)}function aG(n,e,t=!1){for(let o=0;o<e.length;o++)if(oG(n,e[o],t))return!0;return!1}function lG(n){for(let e=0;e<n.length;e++){let t=n[e];if(P5(t))return e}return n.length}function cG(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){let o=n[t];if(typeof o=="number")return-1;if(o===e)return t;t++}return-1}function $L(n,e){return n?":not("+e.trim()+")":e}function uG(n){let e=n[0],t=1,o=2,a="",s=!1;for(;t<n.length;){let f=n[t];if(typeof f=="string")if(o&2){let v=n[++t];a+="["+f+(v.length>0?'="'+v+'"':"")+"]"}else o&8?a+="."+f:o&4&&(a+=" "+f);else a!==""&&!Ll(f)&&(e+=$L(s,a),a=""),o=f,s=s||!Ll(o);t++}return a!==""&&(e+=$L(s,a)),e}function hG(n){return n.map(uG).join(",")}function dG(n){let e=[],t=[],o=1,a=2;for(;o<n.length;){let s=n[o];if(typeof s=="string")a===2?s!==""&&e.push(s,n[++o]):a===8&&t.push(s);else{if(!Ll(a))break;a=s}o++}return t.length&&e.push(1,...t),e}var kl={};function uI(n,e,t,o,a,s,f,v,w,D,A){let z=vo+o,H=z+a,q=fG(z,H),W=typeof D=="function"?D():D;return q[_n]={type:n,blueprint:q,template:t,queries:null,viewQuery:v,declTNode:e,data:q.slice().fill(null,z),bindingStartIndex:z,expandoStartIndex:H,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof s=="function"?s():s,pipeRegistry:typeof f=="function"?f():f,firstChild:null,schemas:w,consts:W,incompleteFirstPass:!1,ssrId:A}}function fG(n,e){let t=[];for(let o=0;o<e;o++)t.push(o<n?null:kl);return t}function pG(n){let e=n.tView;return e===null||e.incompleteFirstPass?n.tView=uI(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):e}function hI(n,e,t,o,a,s,f,v,w,D,A){let z=e.blueprint.slice();return z[Ml]=a,z[gn]=o|4|128|8|64|1024,(D!==null||n&&n[gn]&2048)&&(z[gn]|=2048),oC(z),z[yo]=z[_f]=n,z[Er]=t,z[Ru]=f||n&&n[Ru],z[pr]=v||n&&n[pr],z[Au]=w||n&&n[Au]||null,z[Ya]=s,z[ry]=$5(),z[Mm]=A,z[eC]=D,z[wa]=e.type==2?n[wa]:z,z}function mG(n,e,t){let o=Al(e,n),a=pG(t),s=n[Ru].rendererFactory,f=dI(n,hI(n,a,null,qO(t),o,e,null,s.createRenderer(o,t),null,null,null));return n[e.index]=f}function qO(n){let e=16;return n.signals?e=4096:n.onPush&&(e=64),e}function WO(n,e,t,o){if(t===0)return-1;let a=e.length;for(let s=0;s<t;s++)e.push(o),n.blueprint.push(o),n.data.push(null);return a}function dI(n,e){return n[Am]?n[QT][Xa]=e:n[Am]=e,n[QT]=e,e}function Ln(n=1){XO(Bs(),hi(),ku()+n,!1)}function XO(n,e,t,o){if(!o)if((e[gn]&3)===3){let s=n.preOrderCheckHooks;s!==null&&jx(e,s,t)}else{let s=n.preOrderHooks;s!==null&&Vx(e,s,0,t)}qh(t)}var fb=(function(n){return n[n.None=0]="None",n[n.SignalBased=1]="SignalBased",n[n.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",n})(fb||{});function BC(n,e,t,o){let a=pn(null);try{let[s,f,v]=n.inputs[t],w=null;(f&fb.SignalBased)!==0&&(w=e[s][Ls]),w!==null&&w.transformFn!==void 0?o=w.transformFn(o):v!==null&&(o=v.call(e,o)),n.setInput!==null?n.setInput(e,w,o,t,s):dO(e,w,s,o)}finally{pn(a)}}var Rc=(function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n})(Rc||{}),gG;function fI(n,e){return gG(n,e)}var Sf=new Set,pI=(function(n){return n[n.CHANGE_DETECTION=0]="CHANGE_DETECTION",n[n.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",n})(pI||{}),Ty=new Wt(""),HL=new Set;function Xh(n){HL.has(n)||(HL.add(n),performance?.mark?.("mark_feature_usage",{detail:{feature:n}}))}var YO=!1,jC=class extends No{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(e=!1){super(),this.__isAsync=e,hL()&&(this.destroyRef=tt(Mc,{optional:!0})??void 0,this.pendingTasks=tt(Pc,{optional:!0})??void 0)}emit(e){let t=pn(null);try{super.next(e)}finally{pn(t)}}subscribe(e,t,o){let a=e,s=t||(()=>null),f=o;if(e&&typeof e=="object"){let w=e;a=w.next?.bind(w),s=w.error?.bind(w),f=w.complete?.bind(w)}this.__isAsync&&(s=this.wrapInTimeout(s),a&&(a=this.wrapInTimeout(a)),f&&(f=this.wrapInTimeout(f)));let v=super.subscribe({next:a,error:s,complete:f});return e instanceof Fr&&e.add(v),v}wrapInTimeout(e){return t=>{let o=this.pendingTasks?.add();setTimeout(()=>{try{e(t)}finally{o!==void 0&&this.pendingTasks?.remove(o)}})}}},_s=jC;function KO(n){let e,t;function o(){n=Cf;try{t!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(t),e!==void 0&&clearTimeout(e)}catch{}}return e=setTimeout(()=>{n(),o()}),typeof requestAnimationFrame=="function"&&(t=requestAnimationFrame(()=>{n(),o()})),()=>o()}function ZL(n){return queueMicrotask(()=>n()),()=>{n=Cf}}var mI="isAngularZone",Wx=mI+"_ID",_G=0,Br=class n{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new _s(!1);onMicrotaskEmpty=new _s(!1);onStable=new _s(!1);onError=new _s(!1);constructor(e){let{enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:o=!1,shouldCoalesceRunChangeDetection:a=!1,scheduleInRootZone:s=YO}=e;if(typeof Zone>"u")throw new Nt(908,!1);Zone.assertZonePatched();let f=this;f._nesting=0,f._outer=f._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(f._inner=f._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(f._inner=f._inner.fork(Zone.longStackTraceZoneSpec)),f.shouldCoalesceEventChangeDetection=!a&&o,f.shouldCoalesceRunChangeDetection=a,f.callbackScheduled=!1,f.scheduleInRootZone=s,xG(f)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(mI)===!0}static assertInAngularZone(){if(!n.isInAngularZone())throw new Nt(909,!1)}static assertNotInAngularZone(){if(n.isInAngularZone())throw new Nt(909,!1)}run(e,t,o){return this._inner.run(e,t,o)}runTask(e,t,o,a){let s=this._inner,f=s.scheduleEventTask("NgZoneEvent: "+a,e,yG,Cf,Cf);try{return s.runTask(f,t,o)}finally{s.cancelTask(f)}}runGuarded(e,t,o){return this._inner.runGuarded(e,t,o)}runOutsideAngular(e){return this._outer.run(e)}},yG={};function gI(n){if(n._nesting==0&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function vG(n){if(n.isCheckStableRunning||n.callbackScheduled)return;n.callbackScheduled=!0;function e(){KO(()=>{n.callbackScheduled=!1,VC(n),n.isCheckStableRunning=!0,gI(n),n.isCheckStableRunning=!1})}n.scheduleInRootZone?Zone.root.run(()=>{e()}):n._outer.run(()=>{e()}),VC(n)}function xG(n){let e=()=>{vG(n)},t=_G++;n._inner=n._inner.fork({name:"angular",properties:{[mI]:!0,[Wx]:t,[Wx+t]:!0},onInvokeTask:(o,a,s,f,v,w)=>{if(bG(w))return o.invokeTask(s,f,v,w);try{return qL(n),o.invokeTask(s,f,v,w)}finally{(n.shouldCoalesceEventChangeDetection&&f.type==="eventTask"||n.shouldCoalesceRunChangeDetection)&&e(),WL(n)}},onInvoke:(o,a,s,f,v,w,D)=>{try{return qL(n),o.invoke(s,f,v,w,D)}finally{n.shouldCoalesceRunChangeDetection&&!n.callbackScheduled&&!wG(w)&&e(),WL(n)}},onHasTask:(o,a,s,f)=>{o.hasTask(s,f),a===s&&(f.change=="microTask"?(n._hasPendingMicrotasks=f.microTask,VC(n),gI(n)):f.change=="macroTask"&&(n.hasPendingMacrotasks=f.macroTask))},onHandleError:(o,a,s,f)=>(o.handleError(s,f),n.runOutsideAngular(()=>n.onError.emit(f)),!1)})}function VC(n){n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&n.callbackScheduled===!0?n.hasPendingMicrotasks=!0:n.hasPendingMicrotasks=!1}function qL(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function WL(n){n._nesting--,gI(n)}var Xx=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new _s;onMicrotaskEmpty=new _s;onStable=new _s;onError=new _s;run(e,t,o){return e.apply(t,o)}runGuarded(e,t,o){return e.apply(t,o)}runOutsideAngular(e){return e()}runTask(e,t,o,a){return e.apply(t,o)}};function bG(n){return JO(n,"__ignore_ng_zone__")}function wG(n){return JO(n,"__scheduler_tick__")}function JO(n,e){return!Array.isArray(n)||n.length!==1?!1:n[0]?.data?.[e]===!0}var QO=(()=>{class n{impl=null;execute(){this.impl?.execute()}static \u0275prov=Ht({token:n,providedIn:"root",factory:()=>new n})}return n})();var ek=new Wt("",{providedIn:"root",factory:()=>({queue:new Set,isScheduled:!1,scheduler:null})});function tk(n,e,t){let o=n.get(ek);if(Array.isArray(e))for(let a of e)o.queue.add(a),t?.detachedLeaveAnimationFns?.push(a);else o.queue.add(e),t?.detachedLeaveAnimationFns?.push(e);o.scheduler&&o.scheduler(n)}function EG(n,e){let t=n.get(ek);if(e.detachedLeaveAnimationFns){for(let o of e.detachedLeaveAnimationFns)t.queue.delete(o);e.detachedLeaveAnimationFns=void 0}}function TG(n,e){for(let[t,o]of e)tk(n,o.animateFns)}function XL(n,e,t,o){let a=n?.[bf]?.enter;e!==null&&a&&a.has(t.index)&&TG(o,a)}function zm(n,e,t,o,a,s,f,v){if(a!=null){let w,D=!1;Pl(a)?w=a:Ou(a)&&(D=!0,a=a[Ml]);let A=Ka(a);n===0&&o!==null?(XL(v,o,s,t),f==null?UO(e,o,A):qx(e,o,A,f||null,!0)):n===1&&o!==null?(XL(v,o,s,t),qx(e,o,A,f||null,!0)):n===2?YL(v,s,t,z=>{GO(e,A,D,z)}):n===3&&YL(v,s,t,()=>{e.destroyNode(A)}),w!=null&&NG(e,n,t,w,s,o,f)}}function CG(n,e){nk(n,e),e[Ml]=null,e[Ya]=null}function IG(n,e,t,o,a,s){o[Ml]=a,o[Ya]=e,mb(n,o,t,1,a,s)}function nk(n,e){e[Ru].changeDetectionScheduler?.notify(9),mb(n,e,e[pr],2,null,null)}function SG(n){let e=n[Am];if(!e)return SC(n[_n],n);for(;e;){let t=null;if(Ou(e))t=e[Am];else{let o=e[Tr];o&&(t=o)}if(!t){for(;e&&!e[Xa]&&e!==n;)Ou(e)&&SC(e[_n],e),e=e[yo];e===null&&(e=n),Ou(e)&&SC(e[_n],e),t=e&&e[Xa]}e=t}}function _I(n,e){let t=n[sy],o=t.indexOf(e);t.splice(o,1)}function pb(n,e){if(Ef(e))return;let t=e[pr];t.destroyNode&&mb(n,e,t,3,null,null),SG(e)}function SC(n,e){if(Ef(e))return;let t=pn(null);try{e[gn]&=-129,e[gn]|=256,e[Ea]&&of(e[Ea]),PG(n,e),MG(n,e),e[_n].type===1&&e[pr].destroy();let o=e[yf];if(o!==null&&Pl(e[yo])){o!==e[yo]&&_I(o,e);let a=e[xf];a!==null&&a.detachView(n)}kC(e)}finally{pn(t)}}function YL(n,e,t,o){let a=n?.[bf];if(a==null||a.leave==null||!a.leave.has(e.index))return o(!1);n&&Sf.add(n),tk(t,()=>{if(a.leave&&a.leave.has(e.index)){let f=a.leave.get(e.index),v=[];if(f){for(let w=0;w<f.animateFns.length;w++){let D=f.animateFns[w],{promise:A}=D();v.push(A)}a.detachedLeaveAnimationFns=void 0}a.running=Promise.allSettled(v),DG(n,o)}else n&&Sf.delete(n),o(!1)},a)}function DG(n,e){let t=n[bf]?.running;if(t){t.then(()=>{n[bf].running=void 0,Sf.delete(n),e(!0)});return}e(!1)}function MG(n,e){let t=n.cleanup,o=e[Pm];if(t!==null)for(let f=0;f<t.length-1;f+=2)if(typeof t[f]=="string"){let v=t[f+3];v>=0?o[v]():o[-v].unsubscribe(),f+=2}else{let v=o[t[f+1]];t[f].call(v)}o!==null&&(e[Pm]=null);let a=e[Su];if(a!==null){e[Su]=null;for(let f=0;f<a.length;f++){let v=a[f];v()}}let s=e[Lu];if(s!==null){e[Lu]=null;for(let f of s)f.destroy()}}function PG(n,e){let t;if(n!=null&&(t=n.destroyHooks)!=null)for(let o=0;o<t.length;o+=2){let a=e[t[o]];if(!(a instanceof gy)){let s=t[o+1];if(Array.isArray(s))for(let f=0;f<s.length;f+=2){let v=a[s[f]],w=s[f+1];Ni(4,v,w);try{w.call(v)}finally{Ni(5,v,w)}}else{Ni(4,a,s);try{s.call(a)}finally{Ni(5,a,s)}}}}}function AG(n,e,t){return RG(n,e.parent,t)}function RG(n,e,t){let o=e;for(;o!==null&&o.type&168;)e=o,o=e.parent;if(o===null)return t[Ml];if(Zh(o)){let{encapsulation:a}=n.data[o.directiveStart+o.componentOffset];if(a===Fu.None||a===Fu.Emulated)return null}return Al(o,t)}function LG(n,e,t){return kG(n,e,t)}function OG(n,e,t){return n.type&40?Al(n,t):null}var kG=OG,KL;function yI(n,e,t,o){let a=AG(n,o,e),s=e[pr],f=o.parent||e[Ya],v=LG(f,o,e);if(a!=null)if(Array.isArray(t))for(let w=0;w<t.length;w++)GL(s,a,t[w],v,!1);else GL(s,a,t,v,!1);KL!==void 0&&KL(s,o,e,t,a)}function py(n,e){if(e!==null){let t=e.type;if(t&3)return Al(e,n);if(t&4)return UC(-1,n[e.index]);if(t&8){let o=e.child;if(o!==null)return py(n,o);{let a=n[e.index];return Pl(a)?UC(-1,a):Ka(a)}}else{if(t&128)return py(n,e.next);if(t&32)return fI(e,n)()||Ka(n[e.index]);{let o=ik(n,e);if(o!==null){if(Array.isArray(o))return o[0];let a=Uh(n[wa]);return py(a,o)}else return py(n,e.next)}}}return null}function ik(n,e){if(e!==null){let o=n[wa][Ya],a=e.projection;return o.projection[a]}return null}function UC(n,e){let t=Tr+n+1;if(t<e.length){let o=e[t],a=o[_n].firstChild;if(a!==null)return py(o,a)}return e[Hh]}function vI(n,e,t,o,a,s,f){for(;t!=null;){let v=o[Au];if(t.type===128){t=t.next;continue}let w=o[t.index],D=t.type;if(f&&e===0&&(w&&jm(Ka(w),o),t.flags|=2),!aI(t))if(D&8)vI(n,e,t.child,o,a,s,!1),zm(e,n,v,a,w,t,s,o);else if(D&32){let A=fI(t,o),z;for(;z=A();)zm(e,n,v,a,z,t,s,o);zm(e,n,v,a,w,t,s,o)}else D&16?FG(n,e,o,t,a,s):zm(e,n,v,a,w,t,s,o);t=f?t.projectionNext:t.next}}function mb(n,e,t,o,a,s){vI(t,o,n.firstChild,e,a,s,!1)}function FG(n,e,t,o,a,s){let f=t[wa],w=f[Ya].projection[o.projection];if(Array.isArray(w))for(let D=0;D<w.length;D++){let A=w[D];zm(e,n,t[Au],a,A,o,s,t)}else{let D=w,A=f[yo];DO(o)&&(D.flags|=128),vI(n,e,D,A,a,s,!0)}}function NG(n,e,t,o,a,s,f){let v=o[Hh],w=Ka(o);v!==w&&zm(e,n,t,s,v,a,f);for(let D=Tr;D<o.length;D++){let A=o[D];mb(A[_n],A,n,e,s,v)}}function zG(n,e,t,o,a){if(e)a?n.addClass(t,o):n.removeClass(t,o);else{let s=o.indexOf("-")===-1?void 0:Rc.DashCase;a==null?n.removeStyle(t,o,s):(typeof a=="string"&&a.endsWith("!important")&&(a=a.slice(0,-10),s|=Rc.Important),n.setStyle(t,o,a,s))}}function rk(n,e,t,o,a){let s=ku(),f=o&2;try{qh(-1),f&&e.length>vo&&XO(n,e,vo,!1),Ni(f?2:0,a,t),t(o,a)}finally{qh(s),Ni(f?3:1,a,t)}}function xI(n,e,t){ZG(n,e,t),(t.flags&64)===64&&qG(n,e,t)}function gb(n,e,t=Al){let o=e.localNames;if(o!==null){let a=e.index+1;for(let s=0;s<o.length;s+=2){let f=o[s+1],v=f===-1?t(e,n):n[f];n[a++]=v}}}function BG(n,e,t,o){let s=o.get(NO,FO)||t===Fu.ShadowDom,f=n.selectRootElement(e,s);return jG(f),f}function jG(n){VG(n)}var VG=()=>null;function UG(n){return n==="class"?"className":n==="for"?"htmlFor":n==="formaction"?"formAction":n==="innerHtml"?"innerHTML":n==="readonly"?"readOnly":n==="tabindex"?"tabIndex":n}function GG(n,e,t,o,a,s){let f=e[_n];if(bI(n,f,e,t,o)){Zh(n)&&HG(e,n.index);return}n.type&3&&(t=UG(t)),$G(n,e,t,o,a,s)}function $G(n,e,t,o,a,s){if(n.type&3){let f=Al(n,e);o=s!=null?s(o,n.value||"",t):o,a.setProperty(f,t,o)}else n.type&12}function HG(n,e){let t=Rl(e,n);t[gn]&16||(t[gn]|=64)}function ZG(n,e,t){let o=t.directiveStart,a=t.directiveEnd;Zh(t)&&mG(e,t,n.data[o+t.componentOffset]),n.firstCreatePass||bO(t,e);let s=t.initialInputs;for(let f=o;f<a;f++){let v=n.data[f],w=LC(e,n,f,t);if(jm(w,e),s!==null&&KG(e,f-o,w,v,t,s),wf(v)){let D=Rl(t.index,e);D[Er]=LC(e,n,f,t)}}}function qG(n,e,t){let o=t.directiveStart,a=t.directiveEnd,s=t.index,f=SL();try{qh(s);for(let v=o;v<a;v++){let w=n.data[v],D=e[v];Ox(v),(w.hostBindings!==null||w.hostVars!==0||w.hostAttrs!==null)&&WG(w,D)}}finally{qh(-1),Ox(f)}}function WG(n,e){n.hostBindings!==null&&n.hostBindings(1,e)}function ok(n,e){let t=n.directiveRegistry,o=null;if(t)for(let a=0;a<t.length;a++){let s=t[a];aG(e,s.selectors,!1)&&(o??=[],wf(s)?o.unshift(s):o.push(s))}return o}function XG(n,e,t,o,a,s){let f=Al(n,e);YG(e[pr],f,s,n.value,t,o,a)}function YG(n,e,t,o,a,s,f){if(s==null)n.removeAttribute(e,a,t);else{let v=f==null?Cx(s):f(s,o||"",a);n.setAttribute(e,a,v,t)}}function KG(n,e,t,o,a,s){let f=s[e];if(f!==null)for(let v=0;v<f.length;v+=2){let w=f[v],D=f[v+1];BC(o,t,w,D)}}function sk(n,e,t,o,a){let s=vo+t,f=e[_n],v=a(f,e,n,o,t);e[s]=v,Lm(n,!0);let w=n.type===2;return w?($O(e[pr],v,n),(vL()===0||ay(n))&&jm(v,e),xL()):jm(v,e),Nx()&&(!w||!aI(n))&&yI(f,e,v,n),n}function ak(n){let e=n;return fC()?EL():(e=e.parent,Lm(e,!1)),e}function JG(n,e){let t=n[Au];if(!t)return;let o;try{o=t.get(Vs,null)}catch{o=null}o?.(e)}function bI(n,e,t,o,a){let s=n.inputs?.[o],f=n.hostDirectiveInputs?.[o],v=!1;if(f)for(let w=0;w<f.length;w+=2){let D=f[w],A=f[w+1],z=e.data[D];BC(z,t[D],A,a),v=!0}if(s)for(let w of s){let D=t[w],A=e.data[w];BC(A,D,o,a),v=!0}return v}function QG(n,e){let t=Rl(e,n),o=t[_n];e4(o,t);let a=t[Ml];a!==null&&t[Mm]===null&&(t[Mm]=zO(a,t[Au])),Ni(18),wI(o,t,t[Er]),Ni(19,t[Er])}function e4(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])}function wI(n,e,t){kx(e);try{let o=n.viewQuery;o!==null&&NC(1,o,t);let a=n.template;a!==null&&rk(n,e,a,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),e[xf]?.finishViewCreation(n),n.staticContentQueries&&BO(n,e),n.staticViewQueries&&NC(2,n.viewQuery,t);let s=n.components;s!==null&&t4(e,s)}catch(o){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),o}finally{e[gn]&=-5,Fx()}}function t4(n,e){for(let t=0;t<e.length;t++)QG(n,e[t])}function _b(n,e,t,o){let a=pn(null);try{let s=e.tView,v=n[gn]&4096?4096:16,w=hI(n,s,t,v,null,e,null,null,o?.injector??null,o?.embeddedViewInjector??null,o?.dehydratedView??null),D=n[e.index];w[yf]=D;let A=n[xf];return A!==null&&(w[xf]=A.createEmbeddedView(s)),wI(s,w,t),w}finally{pn(a)}}function _y(n,e){return!e||e.firstChild===null||DO(n)}function yy(n,e,t,o,a=!1){for(;t!==null;){if(t.type===128){t=a?t.projectionNext:t.next;continue}let s=e[t.index];s!==null&&o.push(Ka(s)),Pl(s)&&lk(s,o);let f=t.type;if(f&8)yy(n,e,t.child,o);else if(f&32){let v=fI(t,e),w;for(;w=v();)o.push(w)}else if(f&16){let v=ik(e,t);if(Array.isArray(v))o.push(...v);else{let w=Uh(e[wa]);yy(w[_n],w,v,o,!0)}}t=a?t.projectionNext:t.next}return o}function lk(n,e){for(let t=Tr;t<n.length;t++){let o=n[t],a=o[_n].firstChild;a!==null&&yy(o[_n],o,a,e)}n[Hh]!==n[Ml]&&e.push(n[Hh])}function ck(n){if(n[Ax]!==null){for(let e of n[Ax])e.impl.addSequence(e);n[Ax].length=0}}var uk=[];function n4(n){return n[Ea]??i4(n)}function i4(n){let e=uk.pop()??Object.create(o4);return e.lView=n,e}function r4(n){n.lView[Ea]!==n&&(n.lView=null,uk.push(n))}var o4=Xn(St({},dm),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{Tf(n.lView)},consumerOnSignalRead(){this.lView[Ea]=this}});function s4(n){let e=n[Ea]??Object.create(a4);return e.lView=n,e}var a4=Xn(St({},dm),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{let e=Uh(n.lView);for(;e&&!hk(e[_n]);)e=Uh(e);e&&sC(e)},consumerOnSignalRead(){this.lView[Ea]=this}});function hk(n){return n.type!==2}function dk(n){if(n[Lu]===null)return;let e=!0;for(;e;){let t=!1;for(let o of n[Lu])o.dirty&&(t=!0,o.zone===null||Zone.current===o.zone?o.run():o.zone.run(()=>o.run()));e=t&&!!(n[gn]&8192)}}var l4=100;function fk(n,e=0){let o=n[Ru].rendererFactory,a=!1;a||o.begin?.();try{c4(n,e)}finally{a||o.end?.()}}function c4(n,e){let t=pC();try{Om(!0),GC(n,e);let o=0;for(;cy(n);){if(o===l4)throw new Nt(103,!1);o++,GC(n,1)}}finally{Om(t)}}function u4(n,e,t,o){if(Ef(e))return;let a=e[gn],s=!1,f=!1;kx(e);let v=!0,w=null,D=null;s||(hk(n)?(D=n4(e),w=fm(D)):Y0()===null?(v=!1,D=s4(e),w=fm(D)):e[Ea]&&(of(e[Ea]),e[Ea]=null));try{oC(e),TL(n.bindingStartIndex),t!==null&&rk(n,e,t,2,o);let A=(a&3)===3;if(!s)if(A){let q=n.preOrderCheckHooks;q!==null&&jx(e,q,null)}else{let q=n.preOrderHooks;q!==null&&Vx(e,q,0,null),CC(e,0)}if(f||h4(e),dk(e),pk(e,0),n.contentQueries!==null&&BO(n,e),!s)if(A){let q=n.contentCheckHooks;q!==null&&jx(e,q)}else{let q=n.contentHooks;q!==null&&Vx(e,q,1),CC(e,1)}f4(n,e);let z=n.components;z!==null&&gk(e,z,0);let H=n.viewQuery;if(H!==null&&NC(2,H,o),!s)if(A){let q=n.viewCheckHooks;q!==null&&jx(e,q)}else{let q=n.viewHooks;q!==null&&Vx(e,q,2),CC(e,2)}if(n.firstUpdatePass===!0&&(n.firstUpdatePass=!1),e[Px]){for(let q of e[Px])q();e[Px]=null}s||(ck(e),e[gn]&=-73)}catch(A){throw s||Tf(e),A}finally{D!==null&&(Z_(D,w),v&&r4(D)),Fx()}}function pk(n,e){for(let t=PO(n);t!==null;t=AO(t))for(let o=Tr;o<t.length;o++){let a=t[o];mk(a,e)}}function h4(n){for(let e=PO(n);e!==null;e=AO(e)){if(!(e[gn]&2))continue;let t=e[sy];for(let o=0;o<t.length;o++){let a=t[o];sC(a)}}}function d4(n,e,t){Ni(18);let o=Rl(e,n);mk(o,t),Ni(19,o[Er])}function mk(n,e){Rx(n)&&GC(n,e)}function GC(n,e){let o=n[_n],a=n[gn],s=n[Ea],f=!!(e===0&&a&16);if(f||=!!(a&64&&e===0),f||=!!(a&1024),f||=!!(s?.dirty&&pm(s)),f||=!1,s&&(s.dirty=!1),n[gn]&=-9217,f)u4(o,n,o.template,n[Er]);else if(a&8192){let v=pn(null);try{dk(n),pk(n,1);let w=o.components;w!==null&&gk(n,w,1),ck(n)}finally{pn(v)}}}function gk(n,e,t){for(let o=0;o<e.length;o++)d4(n,e[o],t)}function f4(n,e){let t=n.hostBindingOpCodes;if(t!==null)try{for(let o=0;o<t.length;o++){let a=t[o];if(a<0)qh(~a);else{let s=a,f=t[++o],v=t[++o];IL(f,s);let w=e[s];Ni(24,w),v(2,w),Ni(25,w)}}}finally{qh(-1)}}function EI(n,e){let t=pC()?64:1088;for(n[Ru].changeDetectionScheduler?.notify(e);n;){n[gn]|=t;let o=Uh(n);if(Rm(n)&&!o)return n;n=o}return null}function _k(n,e,t,o){return[n,!0,0,e,null,o,null,t,null,null]}function yk(n,e){let t=Tr+e;if(t<n.length)return n[t]}function yb(n,e,t,o=!0){let a=e[_n];if(p4(a,e,n,t),o){let f=UC(t,n),v=e[pr],w=v.parentNode(n[Hh]);w!==null&&IG(a,n[Ya],v,e,w,f)}let s=e[Mm];s!==null&&s.firstChild!==null&&(s.firstChild=null)}function vk(n,e){let t=vy(n,e);return t!==void 0&&pb(t[_n],t),t}function vy(n,e){if(n.length<=Tr)return;let t=Tr+e,o=n[t];if(o){let a=o[yf];a!==null&&a!==n&&_I(a,o),e>0&&(n[t-1][Xa]=o[Xa]);let s=ty(n,Tr+e);CG(o[_n],o);let f=s[xf];f!==null&&f.detachView(s[_n]),o[yo]=null,o[Xa]=null,o[gn]&=-129}return o}function p4(n,e,t,o){let a=Tr+o,s=t.length;o>0&&(t[a-1][Xa]=e),o<s-Tr?(e[Xa]=t[a],ZT(t,Tr+o,e)):(t.push(e),e[Xa]=null),e[yo]=t;let f=e[yf];f!==null&&t!==f&&xk(f,e);let v=e[xf];v!==null&&v.insertView(n),Lx(e),e[gn]|=128}function xk(n,e){let t=n[sy],o=e[yo];if(Ou(o))n[gn]|=2;else{let a=o[yo][wa];e[wa]!==a&&(n[gn]|=2)}t===null?n[sy]=[e]:t.push(e)}var Wh=class{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){let e=this._lView,t=e[_n];return yy(t,e,t.firstChild,[])}constructor(e,t){this._lView=e,this._cdRefInjectingView=t}get context(){return this._lView[Er]}set context(e){this._lView[Er]=e}get destroyed(){return Ef(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let e=this._lView[yo];if(Pl(e)){let t=e[oy],o=t?t.indexOf(this):-1;o>-1&&(vy(e,o),ty(t,o))}this._attachedToViewContainer=!1}pb(this._lView[_n],this._lView)}onDestroy(e){aC(this._lView,e)}markForCheck(){EI(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[gn]&=-129}reattach(){Lx(this._lView),this._lView[gn]|=128}detectChanges(){this._lView[gn]|=1024,fk(this._lView)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Nt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let e=Rm(this._lView),t=this._lView[yf];t!==null&&!e&&_I(t,this._lView),nk(this._lView[_n],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Nt(902,!1);this._appRef=e;let t=Rm(this._lView),o=this._lView[yf];o!==null&&!t&&xk(o,this._lView),Lx(this._lView)}};var vb=(()=>{class n{_declarationLView;_declarationTContainer;elementRef;static __NG_ELEMENT_ID__=m4;constructor(t,o,a){this._declarationLView=t,this._declarationTContainer=o,this.elementRef=a}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,o){return this.createEmbeddedViewImpl(t,o)}createEmbeddedViewImpl(t,o,a){let s=_b(this._declarationLView,this._declarationTContainer,t,{embeddedViewInjector:o,dehydratedView:a});return new Wh(s)}}return n})();function m4(){return g4(js(),hi())}function g4(n,e){return n.type&4?new vb(e,n,cb(n,e)):null}function Cy(n,e,t,o,a){let s=n.data[e];if(s===null)s=_4(n,e,t,o,a),CL()&&(s.flags|=32);else if(s.type&64){s.type=t,s.value=o,s.attrs=a;let f=wL();s.injectorIndex=f===null?-1:f.injectorIndex}return Lm(s,!0),s}function _4(n,e,t,o,a){let s=dC(),f=fC(),v=f?s:s&&s.parent,w=n.data[e]=v4(n,v,t,e,o,a);return y4(n,w,s,f),w}function y4(n,e,t,o){n.firstChild===null&&(n.firstChild=e),t!==null&&(o?t.child==null&&e.parent!==null&&(t.child=e):t.next===null&&(t.next=e,e.prev=t))}function v4(n,e,t,o,a,s){let f=e?e.injectorIndex:-1,v=0;return bL()&&(v|=128),{type:t,index:o,insertBeforeIndex:null,injectorIndex:f,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:v,providerIndexes:0,value:a,attrs:s,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var pee=new RegExp(`^(\\d+)*(${W5}|${q5})*(.*)`);function x4(n){let e=n[tC]??[],o=n[yo][pr],a=[];for(let s of e)s.data[kO]!==void 0?a.push(s):b4(s,o);n[tC]=a}function b4(n,e){let t=0,o=n.firstChild;if(o){let a=n.data[OO];for(;t<a;){let s=o.nextSibling;GO(e,o,!1),o=s,t++}}}var w4=()=>null,E4=()=>null;function $C(n,e){return w4(n,e)}function bk(n,e,t){return E4(n,e,t)}var wk=class{},xb=class{},HC=class{resolveComponentFactory(e){throw new Nt(917,!1)}},Iy=class{static NULL=new HC},Df=class{};var Ek=(()=>{class n{static \u0275prov=Ht({token:n,providedIn:"root",factory:()=>null})}return n})();var Ux={},ZC=class{injector;parentInjector;constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,o){let a=this.injector.get(e,Ux,o);return a!==Ux||t===Ux?a:this.parentInjector.get(e,t,o)}};function Yx(n,e,t){let o=t?n.styles:null,a=t?n.classes:null,s=0;if(e!==null)for(let f=0;f<e.length;f++){let v=e[f];if(typeof v=="number")s=v;else if(s==1)a=wx(a,v);else if(s==2){let w=v,D=e[++f];o=wx(o,w+": "+D+";")}}t?n.styles=o:n.stylesWithoutHost=o,t?n.classes=a:n.classesWithoutHost=a}function Sy(n,e=0){let t=hi();if(t===null)return an(n,e);let o=js();return CO(o,t,Ns(n),e)}function Tk(n,e,t,o,a){let s=o===null?null:{"":-1},f=a(n,t);if(f!==null){let v=f,w=null,D=null;for(let A of f)if(A.resolveHostDirectives!==null){[v,w,D]=A.resolveHostDirectives(f);break}I4(n,e,t,v,s,w,D)}s!==null&&o!==null&&T4(t,o,s)}function T4(n,e,t){let o=n.localNames=[];for(let a=0;a<e.length;a+=2){let s=t[e[a+1]];if(s==null)throw new Nt(-301,!1);o.push(e[a],s)}}function C4(n,e,t){e.componentOffset=t,(n.components??=[]).push(e.index)}function I4(n,e,t,o,a,s,f){let v=o.length,w=!1;for(let H=0;H<v;H++){let q=o[H];!w&&wf(q)&&(w=!0,C4(n,t,H)),F5(bO(t,e),n,q.type)}R4(t,n.data.length,v);for(let H=0;H<v;H++){let q=o[H];q.providersResolver&&q.providersResolver(q)}let D=!1,A=!1,z=WO(n,e,v,null);v>0&&(t.directiveToIndex=new Map);for(let H=0;H<v;H++){let q=o[H];if(t.mergedAttrs=ab(t.mergedAttrs,q.hostAttrs),D4(n,t,e,z,q),A4(z,q,a),f!==null&&f.has(q)){let[me,ce]=f.get(q);t.directiveToIndex.set(q.type,[z,me+t.directiveStart,ce+t.directiveStart])}else(s===null||!s.has(q))&&t.directiveToIndex.set(q.type,z);q.contentQueries!==null&&(t.flags|=4),(q.hostBindings!==null||q.hostAttrs!==null||q.hostVars!==0)&&(t.flags|=64);let W=q.type.prototype;!D&&(W.ngOnChanges||W.ngOnInit||W.ngDoCheck)&&((n.preOrderHooks??=[]).push(t.index),D=!0),!A&&(W.ngOnChanges||W.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(t.index),A=!0),z++}S4(n,t,s)}function S4(n,e,t){for(let o=e.directiveStart;o<e.directiveEnd;o++){let a=n.data[o];if(t===null||!t.has(a))JL(0,e,a,o),JL(1,e,a,o),eO(e,o,!1);else{let s=t.get(a);QL(0,e,s,o),QL(1,e,s,o),eO(e,o,!0)}}}function JL(n,e,t,o){let a=n===0?t.inputs:t.outputs;for(let s in a)if(a.hasOwnProperty(s)){let f;n===0?f=e.inputs??={}:f=e.outputs??={},f[s]??=[],f[s].push(o),Ck(e,s)}}function QL(n,e,t,o){let a=n===0?t.inputs:t.outputs;for(let s in a)if(a.hasOwnProperty(s)){let f=a[s],v;n===0?v=e.hostDirectiveInputs??={}:v=e.hostDirectiveOutputs??={},v[f]??=[],v[f].push(o,s),Ck(e,f)}}function Ck(n,e){e==="class"?n.flags|=8:e==="style"&&(n.flags|=16)}function eO(n,e,t){let{attrs:o,inputs:a,hostDirectiveInputs:s}=n;if(o===null||!t&&a===null||t&&s===null||cI(n)){n.initialInputs??=[],n.initialInputs.push(null);return}let f=null,v=0;for(;v<o.length;){let w=o[v];if(w===0){v+=4;continue}else if(w===5){v+=2;continue}else if(typeof w=="number")break;if(!t&&a.hasOwnProperty(w)){let D=a[w];for(let A of D)if(A===e){f??=[],f.push(w,o[v+1]);break}}else if(t&&s.hasOwnProperty(w)){let D=s[w];for(let A=0;A<D.length;A+=2)if(D[A]===e){f??=[],f.push(D[A+1],o[v+1]);break}}v+=2}n.initialInputs??=[],n.initialInputs.push(f)}function D4(n,e,t,o,a){n.data[o]=a;let s=a.factory||(a.factory=df(a.type,!0)),f=new gy(s,wf(a),Sy,null);n.blueprint[o]=f,t[o]=f,M4(n,e,o,WO(n,t,a.hostVars,kl),a)}function M4(n,e,t,o,a){let s=a.hostBindings;if(s){let f=n.hostBindingOpCodes;f===null&&(f=n.hostBindingOpCodes=[]);let v=~e.index;P4(f)!=v&&f.push(v),f.push(t,o,s)}}function P4(n){let e=n.length;for(;e>0;){let t=n[--e];if(typeof t=="number"&&t<0)return t}return 0}function A4(n,e,t){if(t){if(e.exportAs)for(let o=0;o<e.exportAs.length;o++)t[e.exportAs[o]]=n;wf(e)&&(t[""]=n)}}function R4(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}function Ik(n,e,t,o,a,s,f,v){let w=e[_n],D=w.consts,A=Ja(D,f),z=Cy(w,n,t,o,A);return s&&Tk(w,e,z,Ja(D,v),a),z.mergedAttrs=ab(z.mergedAttrs,z.attrs),z.attrs!==null&&Yx(z,z.attrs,!1),z.mergedAttrs!==null&&Yx(z,z.mergedAttrs,!0),w.queries!==null&&w.queries.elementStart(w,z),z}function Sk(n,e){gO(n,e),nC(e)&&n.queries.elementEnd(e)}function L4(n,e,t,o,a,s){let f=e.consts,v=Ja(f,a),w=Cy(e,n,t,o,v);if(w.mergedAttrs=ab(w.mergedAttrs,w.attrs),s!=null){let D=Ja(f,s);w.localNames=[];for(let A=0;A<D.length;A+=2)w.localNames.push(D[A],-1)}return w.attrs!==null&&Yx(w,w.attrs,!1),w.mergedAttrs!==null&&Yx(w,w.mergedAttrs,!0),e.queries!==null&&e.queries.elementStart(e,w),w}function Af(n,e,t){if(t===kl)return!1;let o=n[e];return Object.is(o,t)?!1:(n[e]=t,!0)}function Gx(n,e,t){return function o(a){let s=Zh(n)?Rl(n.index,e):e;EI(s,5);let f=e[Er],v=tO(e,f,t,a),w=o.__ngNextListenerFn__;for(;w;)v=tO(e,f,w,a)&&v,w=w.__ngNextListenerFn__;return v}}function tO(n,e,t,o){let a=pn(null);try{return Ni(6,e,t),t(o)!==!1}catch(s){return JG(n,s),!1}finally{Ni(7,e,t),pn(a)}}function Dk(n,e,t,o,a,s,f,v){let w=ay(n),D=!1,A=null;if(!o&&w&&(A=k4(e,t,s,n.index)),A!==null){let z=A.__ngLastListenerFn__||A;z.__ngNextListenerFn__=f,A.__ngLastListenerFn__=f,D=!0}else{let z=Al(n,t),H=o?o(z):z;Y5(t,H,s,v);let q=a.listen(H,s,v);if(!O4(s)){let W=o?me=>o(Ka(me[n.index])):n.index;Mk(W,e,t,s,v,q,!1)}}return D}function O4(n){return n.startsWith("animation")||n.startsWith("transition")}function k4(n,e,t,o){let a=n.cleanup;if(a!=null)for(let s=0;s<a.length-1;s+=2){let f=a[s];if(f===t&&a[s+1]===o){let v=e[Pm],w=a[s+2];return v&&v.length>w?v[w]:null}typeof f=="string"&&(s+=2)}return null}function Mk(n,e,t,o,a,s,f){let v=e.firstCreatePass?yL(e):null,w=_L(t),D=w.length;w.push(a,s),v&&v.push(o,n,D,(D+1)*(f?-1:1))}function nO(n,e,t,o,a,s){let f=e[t],v=e[_n],D=v.data[t].outputs[o],z=f[D].subscribe(s);Mk(n.index,v,e,a,s,z,!0)}var qC=Symbol("BINDING");var Kx=class extends Iy{ngModule;constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){let t=$h(e);return new Vm(t,this.ngModule)}};function F4(n){return Object.keys(n).map(e=>{let[t,o,a]=n[e],s={propName:t,templateName:e,isSignal:(o&fb.SignalBased)!==0};return a&&(s.transform=a),s})}function N4(n){return Object.keys(n).map(e=>({propName:n[e],templateName:e}))}function z4(n,e,t){let o=e instanceof Qr?e:e?.injector;return o&&n.getStandaloneInjector!==null&&(o=n.getStandaloneInjector(o)||o),o?new ZC(t,o):t}function B4(n){let e=n.get(Df,null);if(e===null)throw new Nt(407,!1);let t=n.get(Ek,null),o=n.get(Dc,null);return{rendererFactory:e,sanitizer:t,changeDetectionScheduler:o,ngReflect:!1}}function j4(n,e){let t=Pk(n);return VO(e,t,t==="svg"?iC:t==="math"?fL:null)}function Pk(n){return(n.selectors[0][0]||"div").toLowerCase()}var Vm=class extends xb{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=F4(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=N4(this.componentDef.outputs),this.cachedOutputs}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=hG(e.selectors),this.ngContentSelectors=e.ngContentSelectors??[],this.isBoundToModule=!!t}create(e,t,o,a,s,f){Ni(22);let v=pn(null);try{let w=this.componentDef,D=V4(o,w,f,s),A=z4(w,a||this.ngModule,e),z=B4(A),H=z.rendererFactory.createRenderer(null,w),q=o?BG(H,o,w.encapsulation,A):j4(w,H),W=f?.some(iO)||s?.some(ue=>typeof ue!="function"&&ue.bindings.some(iO)),me=hI(null,D,null,512|qO(w),null,null,z,H,A,null,zO(q,A,!0));me[vo]=q,kx(me);let ce=null;try{let ue=Ik(vo,me,2,"#host",()=>D.directiveRegistry,!0,0);$O(H,q,ue),jm(q,me),xI(D,me,ue),jO(D,ue,me),Sk(D,ue),t!==void 0&&G4(ue,this.ngContentSelectors,t),ce=Rl(ue.index,me),me[Er]=ce[Er],wI(D,me,null)}catch(ue){throw ce!==null&&kC(ce),kC(me),ue}finally{Ni(23),Fx()}return new Jx(this.componentType,me,!!W)}finally{pn(v)}}};function V4(n,e,t,o){let a=n?["ng-version","20.3.16"]:dG(e.selectors[0]),s=null,f=null,v=0;if(t)for(let A of t)v+=A[qC].requiredVars,A.create&&(A.targetIdx=0,(s??=[]).push(A)),A.update&&(A.targetIdx=0,(f??=[]).push(A));if(o)for(let A=0;A<o.length;A++){let z=o[A];if(typeof z!="function")for(let H of z.bindings){v+=H[qC].requiredVars;let q=A+1;H.create&&(H.targetIdx=q,(s??=[]).push(H)),H.update&&(H.targetIdx=q,(f??=[]).push(H))}}let w=[e];if(o)for(let A of o){let z=typeof A=="function"?A:A.type,H=YT(z);w.push(H)}return uI(0,null,U4(s,f),1,v,w,null,null,null,[a],null)}function U4(n,e){return!n&&!e?null:t=>{if(t&1&&n)for(let o of n)o.create();if(t&2&&e)for(let o of e)o.update()}}function iO(n){let e=n[qC].kind;return e==="input"||e==="twoWay"}var Jx=class extends wk{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(e,t,o){super(),this._rootLView=t,this._hasInputBindings=o,this._tNode=ly(t[_n],vo),this.location=cb(this._tNode,t),this.instance=Rl(this._tNode.index,t)[Er],this.hostView=this.changeDetectorRef=new Wh(t,void 0),this.componentType=e}setInput(e,t){this._hasInputBindings;let o=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),t))return;let a=this._rootLView,s=bI(o,a[_n],a,e,t);this.previousInputValues.set(e,t);let f=Rl(o.index,a);EI(f,1)}get injector(){return new If(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}};function G4(n,e,t){let o=n.projection=[];for(let a=0;a<e.length;a++){let s=t[a];o.push(s!=null&&s.length?Array.from(s):null)}}var Gm=(()=>{class n{static __NG_ELEMENT_ID__=$4}return n})();function $4(){let n=js();return Z4(n,hi())}var H4=Gm,Ak=class extends H4{_lContainer;_hostTNode;_hostLView;constructor(e,t,o){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=o}get element(){return cb(this._hostTNode,this._hostLView)}get injector(){return new If(this._hostTNode,this._hostLView)}get parentInjector(){let e=iI(this._hostTNode,this._hostLView);if(yO(e)){let t=Zx(e,this._hostLView),o=Hx(e),a=t[_n].data[o+8];return new If(a,t)}else return new If(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){let t=rO(this._lContainer);return t!==null&&t[e]||null}get length(){return this._lContainer.length-Tr}createEmbeddedView(e,t,o){let a,s;typeof o=="number"?a=o:o!=null&&(a=o.index,s=o.injector);let f=$C(this._lContainer,e.ssrId),v=e.createEmbeddedViewImpl(t||{},s,f);return this.insertImpl(v,a,_y(this._hostTNode,f)),v}createComponent(e,t,o,a,s,f,v){let w=e&&!b5(e),D;if(w)D=t;else{let ce=t||{};D=ce.index,o=ce.injector,a=ce.projectableNodes,s=ce.environmentInjector||ce.ngModuleRef,f=ce.directives,v=ce.bindings}let A=w?e:new Vm($h(e)),z=o||this.parentInjector;if(!s&&A.ngModule==null){let ue=(w?z:this.parentInjector).get(Qr,null);ue&&(s=ue)}let H=$h(A.componentType??{}),q=$C(this._lContainer,H?.id??null),W=q?.firstChild??null,me=A.create(z,a,W,s,f,v);return this.insertImpl(me.hostView,D,_y(this._hostTNode,q)),me}insert(e,t){return this.insertImpl(e,t,!0)}insertImpl(e,t,o){let a=e._lView;if(pL(a)){let v=this.indexOf(e);if(v!==-1)this.detach(v);else{let w=a[yo],D=new Ak(w,w[Ya],w[yo]);D.detach(D.indexOf(e))}}let s=this._adjustIndex(t),f=this._lContainer;return yb(f,a,s,o),e.attachToViewContainerRef(),ZT(DC(f),s,e),e}move(e,t){return this.insert(e,t)}indexOf(e){let t=rO(this._lContainer);return t!==null?t.indexOf(e):-1}remove(e){let t=this._adjustIndex(e,-1),o=vy(this._lContainer,t);o&&(ty(DC(this._lContainer),t),pb(o[_n],o))}detach(e){let t=this._adjustIndex(e,-1),o=vy(this._lContainer,t);return o&&ty(DC(this._lContainer),t)!=null?new Wh(o):null}_adjustIndex(e,t=0){return e??this.length+t}};function rO(n){return n[oy]}function DC(n){return n[oy]||(n[oy]=[])}function Z4(n,e){let t,o=e[n.index];return Pl(o)?t=o:(t=_k(o,e,null,n),e[n.index]=t,dI(e,t)),W4(t,e,n,o),new Ak(t,n,e)}function q4(n,e){let t=n[pr],o=t.createComment(""),a=Al(e,n),s=t.parentNode(a);return qx(t,s,o,t.nextSibling(a),!1),o}var W4=K4,X4=()=>!1;function Y4(n,e,t){return X4(n,e,t)}function K4(n,e,t,o){if(n[Hh])return;let a;t.type&8?a=Ka(o):a=q4(e,t),n[Hh]=a}var Mf=class{},bb=class{};var Qx=class extends Mf{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new Kx(this);constructor(e,t,o,a=!0){super(),this.ngModuleType=e,this._parent=t;let s=XT(e);this._bootstrapComponents=HO(s.bootstrap),this._r3Injector=xC(e,t,[{provide:Mf,useValue:this},{provide:Iy,useValue:this.componentFactoryResolver},...o],Du(e),new Set(["environment"])),a&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}},eb=class extends bb{moduleType;constructor(e){super(),this.moduleType=e}create(e){return new Qx(this.moduleType,e,[])}};var xy=class extends Mf{injector;componentFactoryResolver=new Kx(this);instance=null;constructor(e){super();let t=new ff([...e.providers,{provide:Mf,useValue:this},{provide:Iy,useValue:this.componentFactoryResolver}],e.parent||iy(),e.debugName,new Set(["environment"]));this.injector=t,e.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}};function Dy(n,e,t=null){return new xy({providers:n,parent:e,debugName:t,runEnvironmentInitializers:!0}).injector}var J4=(()=>{class n{_injector;cachedInjectors=new Map;constructor(t){this._injector=t}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){let o=KT(!1,t.type),a=o.length>0?Dy([o],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,a)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(let t of this.cachedInjectors.values())t!==null&&t.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=Ht({token:n,providedIn:"environment",factory:()=>new n(an(Qr))})}return n})();function eo(n){return wy(()=>{let e=Rk(n),t=Xn(St({},e),{decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===oI.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&n.dependencies||null,getStandaloneInjector:e.standalone?a=>a.get(J4).getOrCreateStandaloneInjector(t):null,getExternalStyles:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||Fu.Emulated,styles:n.styles||zs,_:null,schemas:n.schemas||null,tView:null,id:""});e.standalone&&Xh("NgStandalone"),Lk(t);let o=n.dependencies;return t.directiveDefs=oO(o,Q4),t.pipeDefs=oO(o,oL),t.id=n6(t),t})}function Q4(n){return $h(n)||YT(n)}function $m(n){return wy(()=>({type:n.type,bootstrap:n.bootstrap||zs,declarations:n.declarations||zs,imports:n.imports||zs,exports:n.exports||zs,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function e6(n,e){if(n==null)return gf;let t={};for(let o in n)if(n.hasOwnProperty(o)){let a=n[o],s,f,v,w;Array.isArray(a)?(v=a[0],s=a[1],f=a[2]??s,w=a[3]||null):(s=a,f=a,v=fb.None,w=null),t[s]=[o,v,w],e[s]=f}return t}function t6(n){if(n==null)return gf;let e={};for(let t in n)n.hasOwnProperty(t)&&(e[n[t]]=t);return e}function My(n){return wy(()=>{let e=Rk(n);return Lk(e),e})}function Rk(n){let e={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,inputConfig:n.inputs||gf,exportAs:n.exportAs||null,standalone:n.standalone??!0,signals:n.signals===!0,selectors:n.selectors||zs,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:e6(n.inputs,e),outputs:t6(n.outputs),debugInfo:null}}function Lk(n){n.features?.forEach(e=>e(n))}function oO(n,e){return n?()=>{let t=typeof n=="function"?n():n,o=[];for(let a of t){let s=e(a);s!==null&&o.push(s)}return o}:null}function n6(n){let e=0,t=typeof n.consts=="function"?"":n.consts,o=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,t,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery];for(let s of o.join("|"))e=Math.imul(31,e)+s.charCodeAt(0)<<0;return e+=2147483648,"c"+e}function Ok(n,e,t,o,a,s,f,v){if(t.firstCreatePass){n.mergedAttrs=ab(n.mergedAttrs,n.attrs);let A=n.tView=uI(2,n,a,s,f,t.directiveRegistry,t.pipeRegistry,null,t.schemas,t.consts,null);t.queries!==null&&(t.queries.template(t,n),A.queries=t.queries.embeddedTView(n))}v&&(n.flags|=v),Lm(n,!1);let w=r6(t,e,n,o);Nx()&&yI(t,e,w,n),jm(w,e);let D=_k(w,e,w,n);e[o+vo]=D,dI(e,D),Y4(D,n,e)}function i6(n,e,t,o,a,s,f,v,w,D,A){let z=t+vo,H;return e.firstCreatePass?(H=Cy(e,z,4,f||null,v||null),cC()&&Tk(e,n,H,Ja(e.consts,D),ok),gO(e,H)):H=e.data[z],Ok(H,n,e,t,o,a,s,w),ay(H)&&xI(e,n,H),D!=null&&gb(n,H,A),H}function tb(n,e,t,o,a,s,f,v,w,D,A){let z=t+vo,H;if(e.firstCreatePass){if(H=Cy(e,z,4,f||null,v||null),D!=null){let q=Ja(e.consts,D);H.localNames=[];for(let W=0;W<q.length;W+=2)H.localNames.push(q[W],-1)}}else H=e.data[z];return Ok(H,n,e,t,o,a,s,w),D!=null&&gb(n,H,A),H}function Hm(n,e,t,o,a,s,f,v){let w=hi(),D=Bs(),A=Ja(D.consts,s);return i6(w,D,n,e,t,o,a,A,void 0,f,v),Hm}var r6=o6;function o6(n,e,t,o){return zx(!0),e[pr].createComment("")}var TI=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Ht({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})();var CI=new Wt("");function Zm(n){return!!n&&typeof n.then=="function"}function II(n){return!!n&&typeof n.subscribe=="function"}var kk=new Wt("");var SI=(()=>{class n{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((t,o)=>{this.resolve=t,this.reject=o});appInits=tt(kk,{optional:!0})??[];injector=tt(Wa);constructor(){}runInitializers(){if(this.initialized)return;let t=[];for(let a of this.appInits){let s=Bo(this.injector,a);if(Zm(s))t.push(s);else if(II(s)){let f=new Promise((v,w)=>{s.subscribe({complete:v,error:w})});t.push(f)}}let o=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{o()}).catch(a=>{this.reject(a)}),t.length===0&&o(),this.initialized=!0}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Ht({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),wb=new Wt("");function Fk(){uT(()=>{let n="";throw new Nt(600,n)})}function Nk(n){return n.isBoundToModule}var s6=10;var Rf=(()=>{class n{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=tt(Vs);afterRenderManager=tt(QO);zonelessEnabled=tt(hy);rootEffectScheduler=tt(fy);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new No;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=tt(Pc);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(Fn(t=>!t))}constructor(){tt(Ty,{optional:!0})}whenStable(){let t;return new Promise(o=>{t=this.isStable.subscribe({next:a=>{a&&o()}})}).finally(()=>{t.unsubscribe()})}_injector=tt(Qr);_rendererFactory=null;get injector(){return this._injector}bootstrap(t,o){return this.bootstrapImpl(t,o)}bootstrapImpl(t,o,a=Wa.NULL){return this._injector.get(Br).run(()=>{Ni(10);let f=t instanceof xb;if(!this._injector.get(SI).done){let W="";throw new Nt(405,W)}let w;f?w=t:w=this._injector.get(Iy).resolveComponentFactory(t),this.componentTypes.push(w.componentType);let D=Nk(w)?void 0:this._injector.get(Mf),A=o||w.selector,z=w.create(a,[],A,D),H=z.location.nativeElement,q=z.injector.get(CI,null);return q?.registerApplication(H),z.onDestroy(()=>{this.detachView(z.hostView),my(this.components,z),q?.unregisterApplication(H)}),this._loadComponent(z),Ni(11,z),z})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){Ni(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(pI.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new Nt(101,!1);let t=pn(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,pn(t),this.afterTick.next(),Ni(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(Df,null,{optional:!0}));let t=0;for(;this.dirtyFlags!==0&&t++<s6;)Ni(14),this.synchronizeOnce(),Ni(15)}synchronizeOnce(){this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let t=!1;if(this.dirtyFlags&7){let o=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:a}of this.allViews){if(!o&&!cy(a))continue;let s=o&&!this.zonelessEnabled?0:1;fk(a,s),t=!0}if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}t||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:t})=>cy(t))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(t){let o=t;this._views.push(o),o.attachToAppRef(this)}detachView(t){let o=t;my(this._views,o),o.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView);try{this.tick()}catch(a){this.internalErrorHandler(a)}this.components.push(t),this._injector.get(wb,[]).forEach(a=>a(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>my(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new Nt(406,!1);let t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Ht({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function my(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function ts(n,e,t,o){let a=hi(),s=km();if(Af(a,s,e)){let f=Bs(),v=vC();XG(v,a,n,e,t,o)}return ts}var bee=typeof document<"u"&&typeof document?.documentElement?.getAnimations=="function";var WC=class{destroy(e){}updateValue(e,t){}swap(e,t){let o=Math.min(e,t),a=Math.max(e,t),s=this.detach(a);if(a-o>1){let f=this.detach(o);this.attach(o,s),this.attach(a,f)}else this.attach(o,s)}move(e,t){this.attach(t,this.detach(e))}};function MC(n,e,t,o,a){return n===t&&Object.is(e,o)?1:Object.is(a(n,e),a(t,o))?-1:0}function a6(n,e,t){let o,a,s=0,f=n.length-1,v=void 0;if(Array.isArray(e)){let w=e.length-1;for(;s<=f&&s<=w;){let D=n.at(s),A=e[s],z=MC(s,D,s,A,t);if(z!==0){z<0&&n.updateValue(s,A),s++;continue}let H=n.at(f),q=e[w],W=MC(f,H,w,q,t);if(W!==0){W<0&&n.updateValue(f,q),f--,w--;continue}let me=t(s,D),ce=t(f,H),ue=t(s,A);if(Object.is(ue,ce)){let Me=t(w,q);Object.is(Me,me)?(n.swap(s,f),n.updateValue(f,q),w--,f--):n.move(f,s),n.updateValue(s,A),s++;continue}if(o??=new nb,a??=aO(n,s,f,t),XC(n,o,s,ue))n.updateValue(s,A),s++,f++;else if(a.has(ue))o.set(me,n.detach(s)),f--;else{let Me=n.create(s,e[s]);n.attach(s,Me),s++,f++}}for(;s<=w;)sO(n,o,t,s,e[s]),s++}else if(e!=null){let w=e[Symbol.iterator](),D=w.next();for(;!D.done&&s<=f;){let A=n.at(s),z=D.value,H=MC(s,A,s,z,t);if(H!==0)H<0&&n.updateValue(s,z),s++,D=w.next();else{o??=new nb,a??=aO(n,s,f,t);let q=t(s,z);if(XC(n,o,s,q))n.updateValue(s,z),s++,f++,D=w.next();else if(!a.has(q))n.attach(s,n.create(s,z)),s++,f++,D=w.next();else{let W=t(s,A);o.set(W,n.detach(s)),f--}}}for(;!D.done;)sO(n,o,t,n.length,D.value),D=w.next()}for(;s<=f;)n.destroy(n.detach(f--));o?.forEach(w=>{n.destroy(w)})}function XC(n,e,t,o){return e!==void 0&&e.has(o)?(n.attach(t,e.get(o)),e.delete(o),!0):!1}function sO(n,e,t,o,a){if(XC(n,e,o,t(o,a)))n.updateValue(o,a);else{let s=n.create(o,a);n.attach(o,s)}}function aO(n,e,t,o){let a=new Set;for(let s=e;s<=t;s++)a.add(o(s,n.at(s)));return a}var nb=class{kvMap=new Map;_vMap=void 0;has(e){return this.kvMap.has(e)}delete(e){if(!this.has(e))return!1;let t=this.kvMap.get(e);return this._vMap!==void 0&&this._vMap.has(t)?(this.kvMap.set(e,this._vMap.get(t)),this._vMap.delete(t)):this.kvMap.delete(e),!0}get(e){return this.kvMap.get(e)}set(e,t){if(this.kvMap.has(e)){let o=this.kvMap.get(e);this._vMap===void 0&&(this._vMap=new Map);let a=this._vMap;for(;a.has(o);)o=a.get(o);a.set(o,t)}else this.kvMap.set(e,t)}forEach(e){for(let[t,o]of this.kvMap)if(e(o,t),this._vMap!==void 0){let a=this._vMap;for(;a.has(o);)o=a.get(o),e(o,t)}}};function qm(n,e,t,o,a,s,f,v){Xh("NgControlFlow");let w=hi(),D=Bs(),A=Ja(D.consts,s);return tb(w,D,n,e,t,o,a,A,256,f,v),DI}function DI(n,e,t,o,a,s,f,v){Xh("NgControlFlow");let w=hi(),D=Bs(),A=Ja(D.consts,s);return tb(w,D,n,e,t,o,a,A,512,f,v),DI}function Wm(n,e){Xh("NgControlFlow");let t=hi(),o=km(),a=t[o]!==kl?t[o]:-1,s=a!==-1?ib(t,vo+a):void 0,f=0;if(Af(t,o,n)){let v=pn(null);try{if(s!==void 0&&vk(s,f),n!==-1){let w=vo+n,D=ib(t,w),A=QC(t[_n],w),z=bk(D,A,t),H=_b(t,A,e,{dehydratedView:z});yb(D,H,f,_y(A,z))}}finally{pn(v)}}else if(s!==void 0){let v=yk(s,f);v!==void 0&&(v[Er]=e)}}var YC=class{lContainer;$implicit;$index;constructor(e,t,o){this.lContainer=e,this.$implicit=t,this.$index=o}get $count(){return this.lContainer.length-Tr}};var KC=class{hasEmptyBlock;trackByFn;liveCollection;constructor(e,t,o){this.hasEmptyBlock=e,this.trackByFn=t,this.liveCollection=o}};function MI(n,e,t,o,a,s,f,v,w,D,A,z,H){Xh("NgControlFlow");let q=hi(),W=Bs(),me=w!==void 0,ce=hi(),ue=v?f.bind(ce[wa][Er]):f,Me=new KC(me,ue);ce[vo+n]=Me,tb(q,W,n+1,e,t,o,a,Ja(W.consts,s),256),me&&tb(q,W,n+2,w,D,A,z,Ja(W.consts,H),512)}var JC=class extends WC{lContainer;hostLView;templateTNode;operationsCounter=void 0;needsIndexUpdate=!1;constructor(e,t,o){super(),this.lContainer=e,this.hostLView=t,this.templateTNode=o}get length(){return this.lContainer.length-Tr}at(e){return this.getLView(e)[Er].$implicit}attach(e,t){let o=t[Mm];this.needsIndexUpdate||=e!==this.length,yb(this.lContainer,t,e,_y(this.templateTNode,o)),l6(this.lContainer,e)}detach(e){return this.needsIndexUpdate||=e!==this.length-1,c6(this.lContainer,e),u6(this.lContainer,e)}create(e,t){let o=$C(this.lContainer,this.templateTNode.tView.ssrId),a=_b(this.hostLView,this.templateTNode,new YC(this.lContainer,t,e),{dehydratedView:o});return this.operationsCounter?.recordCreate(),a}destroy(e){pb(e[_n],e),this.operationsCounter?.recordDestroy()}updateValue(e,t){this.getLView(e)[Er].$implicit=t}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let e=0;e<this.length;e++)this.getLView(e)[Er].$index=e}getLView(e){return h6(this.lContainer,e)}};function PI(n){let e=pn(null),t=ku();try{let o=hi(),a=o[_n],s=o[t],f=t+1,v=ib(o,f);if(s.liveCollection===void 0){let D=QC(a,f);s.liveCollection=new JC(v,o,D)}else s.liveCollection.reset();let w=s.liveCollection;if(a6(w,n,s.trackByFn),w.updateIndexes(),s.hasEmptyBlock){let D=km(),A=w.length===0;if(Af(o,D,A)){let z=t+2,H=ib(o,z);if(A){let q=QC(a,z),W=bk(H,q,o),me=_b(o,q,void 0,{dehydratedView:W});yb(H,me,0,_y(q,W))}else a.firstUpdatePass&&x4(H),vk(H,0)}}}finally{pn(e)}}function ib(n,e){return n[e]}function l6(n,e){if(n.length<=Tr)return;let t=Tr+e,o=n[t],a=o?o[bf]:void 0;if(o&&a&&a.detachedLeaveAnimationFns&&a.detachedLeaveAnimationFns.length>0){let s=o[Au];EG(s,a),Sf.delete(o),a.detachedLeaveAnimationFns=void 0}}function c6(n,e){if(n.length<=Tr)return;let t=Tr+e,o=n[t],a=o?o[bf]:void 0;a&&a.leave&&a.leave.size>0&&(a.detachedLeaveAnimationFns=[])}function u6(n,e){return vy(n,e)}function h6(n,e){return yk(n,e)}function QC(n,e){return ly(n,e)}function Nu(n,e,t){let o=hi(),a=km();if(Af(o,a,e)){let s=Bs(),f=vC();GG(f,o,n,e,o[pr],t)}return Nu}function eI(n,e,t,o,a){bI(e,n,t,a?"class":"style",o)}function Mt(n,e,t,o){let a=hi(),s=a[_n],f=n+vo,v=s.firstCreatePass?Ik(f,a,2,e,ok,cC(),t,o):s.data[f];if(sk(v,a,n,e,zk),ay(v)){let w=a[_n];xI(w,a,v),jO(w,v,a)}return o!=null&&gb(a,v),Mt}function Ot(){let n=Bs(),e=js(),t=ak(e);return n.firstCreatePass&&Sk(n,t),uC(t)&&hC(),lC(),t.classesWithoutHost!=null&&S5(t)&&eI(n,t,hi(),t.classesWithoutHost,!0),t.stylesWithoutHost!=null&&D5(t)&&eI(n,t,hi(),t.stylesWithoutHost,!1),Ot}function xo(n,e,t,o){return Mt(n,e,t,o),Ot(),xo}function Cr(n,e,t,o){let a=hi(),s=a[_n],f=n+vo,v=s.firstCreatePass?L4(f,s,2,e,t,o):s.data[f];return sk(v,a,n,e,zk),o!=null&&gb(a,v),Cr}function mr(){let n=js(),e=ak(n);return uC(e)&&hC(),lC(),mr}function Eb(n,e,t,o){return Cr(n,e,t,o),mr(),Eb}var zk=(n,e,t,o,a)=>(zx(!0),VO(e[pr],o,LL()));function Lf(){return hi()}var Py="en-US";var d6=Py;function Bk(n){typeof n=="string"&&(d6=n.toLowerCase().replace(/_/g,"-"))}function jr(n,e,t){let o=hi(),a=Bs(),s=js();return f6(a,o,o[pr],s,n,e,t),jr}function Yh(n,e,t){let o=hi(),a=Bs(),s=js();return(s.type&3||t)&&Dk(s,a,o,t,o[pr],n,e,Gx(s,o,e)),Yh}function f6(n,e,t,o,a,s,f){let v=!0,w=null;if((o.type&3||f)&&(w??=Gx(o,e,s),Dk(o,n,e,f,t,a,s,w)&&(v=!1)),v){let D=o.outputs?.[a],A=o.hostDirectiveOutputs?.[a];if(A&&A.length)for(let z=0;z<A.length;z+=2){let H=A[z],q=A[z+1];w??=Gx(o,e,s),nO(o,e,H,q,a,w)}if(D&&D.length)for(let z of D)w??=Gx(o,e,s),nO(o,e,z,a,a,w)}}function Us(n=1){return RL(n)}function Bx(n,e){return n<<17|e<<2}function Pf(n){return n>>17&32767}function p6(n){return(n&2)==2}function m6(n,e){return n&131071|e<<17}function tI(n){return n|2}function Um(n){return(n&131068)>>2}function PC(n,e){return n&-131069|e<<2}function g6(n){return(n&1)===1}function nI(n){return n|1}function _6(n,e,t,o,a,s){let f=s?e.classBindings:e.styleBindings,v=Pf(f),w=Um(f);n[o]=t;let D=!1,A;if(Array.isArray(t)){let z=t;A=z[1],(A===null||Dm(z,A)>0)&&(D=!0)}else A=t;if(a)if(w!==0){let H=Pf(n[v+1]);n[o+1]=Bx(H,v),H!==0&&(n[H+1]=PC(n[H+1],o)),n[v+1]=m6(n[v+1],o)}else n[o+1]=Bx(v,0),v!==0&&(n[v+1]=PC(n[v+1],o)),v=o;else n[o+1]=Bx(w,0),v===0?v=o:n[w+1]=PC(n[w+1],o),w=o;D&&(n[o+1]=tI(n[o+1])),lO(n,A,o,!0),lO(n,A,o,!1),y6(e,A,n,o,s),f=Bx(v,w),s?e.classBindings=f:e.styleBindings=f}function y6(n,e,t,o,a){let s=a?n.residualClasses:n.residualStyles;s!=null&&typeof e=="string"&&Dm(s,e)>=0&&(t[o+1]=nI(t[o+1]))}function lO(n,e,t,o){let a=n[t+1],s=e===null,f=o?Pf(a):Um(a),v=!1;for(;f!==0&&(v===!1||s);){let w=n[f],D=n[f+1];v6(w,e)&&(v=!0,n[f+1]=o?nI(D):tI(D)),f=o?Pf(D):Um(D)}v&&(n[t+1]=o?tI(a):nI(a))}function v6(n,e){return n===null||e==null||(Array.isArray(n)?n[1]:n)===e?!0:Array.isArray(n)&&typeof e=="string"?Dm(n,e)>=0:!1}var Ol={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function x6(n){return n.substring(Ol.key,Ol.keyEnd)}function b6(n){return w6(n),jk(n,Vk(n,0,Ol.textEnd))}function jk(n,e){let t=Ol.textEnd;return t===e?-1:(e=Ol.keyEnd=E6(n,Ol.key=e,t),Vk(n,e,t))}function w6(n){Ol.key=0,Ol.keyEnd=0,Ol.value=0,Ol.valueEnd=0,Ol.textEnd=n.length}function Vk(n,e,t){for(;e<t&&n.charCodeAt(e)<=32;)e++;return e}function E6(n,e,t){for(;e<t&&n.charCodeAt(e)>32;)e++;return e}function ns(n,e){return C6(n,e,null,!0),ns}function AI(n){I6(R6,T6,n,!0)}function T6(n,e){for(let t=b6(e);t>=0;t=jk(e,t))Dx(n,x6(e),!0)}function C6(n,e,t,o){let a=hi(),s=Bs(),f=mC(2);if(s.firstUpdatePass&&Gk(s,n,f,o),e!==kl&&Af(a,f,e)){let v=s.data[ku()];$k(s,v,a,a[pr],n,a[f+1]=O6(e,t),o,f)}}function I6(n,e,t,o){let a=Bs(),s=mC(2);a.firstUpdatePass&&Gk(a,null,s,o);let f=hi();if(t!==kl&&Af(f,s,t)){let v=a.data[ku()];if(Hk(v,o)&&!Uk(a,s)){let w=o?v.classesWithoutHost:v.stylesWithoutHost;w!==null&&(t=wx(w,t||"")),eI(a,v,f,t,o)}else L6(a,v,f,f[pr],f[s+1],f[s+1]=A6(n,e,t),o,s)}}function Uk(n,e){return e>=n.expandoStartIndex}function Gk(n,e,t,o){let a=n.data;if(a[t+1]===null){let s=a[ku()],f=Uk(n,t);Hk(s,o)&&e===null&&!f&&(e=!1),e=S6(a,s,e,o),_6(a,s,e,t,f,o)}}function S6(n,e,t,o){let a=DL(n),s=o?e.residualClasses:e.residualStyles;if(a===null)(o?e.classBindings:e.styleBindings)===0&&(t=AC(null,n,e,t,o),t=by(t,e.attrs,o),s=null);else{let f=e.directiveStylingLast;if(f===-1||n[f]!==a)if(t=AC(a,n,e,t,o),s===null){let w=D6(n,e,o);w!==void 0&&Array.isArray(w)&&(w=AC(null,n,e,w[1],o),w=by(w,e.attrs,o),M6(n,e,o,w))}else s=P6(n,e,o)}return s!==void 0&&(o?e.residualClasses=s:e.residualStyles=s),t}function D6(n,e,t){let o=t?e.classBindings:e.styleBindings;if(Um(o)!==0)return n[Pf(o)]}function M6(n,e,t,o){let a=t?e.classBindings:e.styleBindings;n[Pf(a)]=o}function P6(n,e,t){let o,a=e.directiveEnd;for(let s=1+e.directiveStylingLast;s<a;s++){let f=n[s].hostAttrs;o=by(o,f,t)}return by(o,e.attrs,t)}function AC(n,e,t,o,a){let s=null,f=t.directiveEnd,v=t.directiveStylingLast;for(v===-1?v=t.directiveStart:v++;v<f&&(s=e[v],o=by(o,s.hostAttrs,a),s!==n);)v++;return n!==null&&(t.directiveStylingLast=v),o}function by(n,e,t){let o=t?1:2,a=-1;if(e!==null)for(let s=0;s<e.length;s++){let f=e[s];typeof f=="number"?a=f:a===o&&(Array.isArray(n)||(n=n===void 0?[]:["",n]),Dx(n,f,t?!0:e[++s]))}return n===void 0?null:n}function A6(n,e,t){if(t==null||t==="")return zs;let o=[],a=lI(t);if(Array.isArray(a))for(let s=0;s<a.length;s++)n(o,a[s],!0);else if(typeof a=="object")for(let s in a)a.hasOwnProperty(s)&&n(o,s,a[s]);else typeof a=="string"&&e(o,a);return o}function R6(n,e,t){let o=String(e);o!==""&&!o.includes(" ")&&Dx(n,o,t)}function L6(n,e,t,o,a,s,f,v){a===kl&&(a=zs);let w=0,D=0,A=0<a.length?a[0]:null,z=0<s.length?s[0]:null;for(;A!==null||z!==null;){let H=w<a.length?a[w+1]:void 0,q=D<s.length?s[D+1]:void 0,W=null,me;A===z?(w+=2,D+=2,H!==q&&(W=z,me=q)):z===null||A!==null&&A<z?(w+=2,W=A):(D+=2,W=z,me=q),W!==null&&$k(n,e,t,o,W,me,f,v),A=w<a.length?a[w]:null,z=D<s.length?s[D]:null}}function $k(n,e,t,o,a,s,f,v){if(!(e.type&3))return;let w=n.data,D=w[v+1],A=g6(D)?cO(w,e,t,a,Um(D),f):void 0;if(!rb(A)){rb(s)||p6(D)&&(s=cO(w,null,t,a,v,f));let z=rC(ku(),t);zG(o,f,z,a,s)}}function cO(n,e,t,o,a,s){let f=e===null,v;for(;a>0;){let w=n[a],D=Array.isArray(w),A=D?w[1]:w,z=A===null,H=t[a+1];H===kl&&(H=z?zs:void 0);let q=z?Mx(H,o):A===o?H:void 0;if(D&&!rb(q)&&(q=Mx(w,o)),rb(q)&&(v=q,f))return v;let W=n[a+1];a=f?Pf(W):Um(W)}if(e!==null){let w=s?e.residualClasses:e.residualStyles;w!=null&&(v=Mx(w,o))}return v}function rb(n){return n!==void 0}function O6(n,e){return n==null||n===""||(typeof e=="string"?n=n+e:typeof n=="object"&&(n=Du(lI(n)))),n}function Hk(n,e){return(n.flags&(e?8:16))!==0}function Ct(n,e=""){let t=hi(),o=Bs(),a=n+vo,s=o.firstCreatePass?Cy(o,a,1,e,null):o.data[a],f=k6(o,t,s,e,n);t[a]=f,Nx()&&yI(o,t,f,s),Lm(s,!1)}var k6=(n,e,t,o,a)=>(zx(!0),J5(e[pr],o));function F6(n,e,t,o=""){return Af(n,km(),t)?e+Cx(t)+o:kl}function Ay(n){return Vr("",n),Ay}function Vr(n,e,t){let o=hi(),a=F6(o,n,e,t);return a!==kl&&N6(o,ku(),a),Vr}function N6(n,e,t){let o=rC(e,n);Q5(n[pr],o,t)}var ob=class{ngModuleFactory;componentFactories;constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}},RI=(()=>{class n{compileModuleSync(t){return new eb(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){let o=this.compileModuleSync(t),a=XT(t),s=HO(a.declarations).reduce((f,v)=>{let w=$h(v);return w&&f.push(new Vm(w)),f},[]);return new ob(o,s)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Ht({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var z6=(()=>{class n{zone=tt(Br);changeDetectionScheduler=tt(Dc);applicationRef=tt(Rf);applicationErrorHandler=tt(Vs);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{try{this.applicationRef.dirtyFlags|=1,this.applicationRef._tick()}catch(t){this.applicationErrorHandler(t)}})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Ht({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Zk=new Wt("",{factory:()=>!1});function LI({ngZoneFactory:n,ignoreChangesOutsideZone:e,scheduleInRootZone:t}){return n??=()=>new Br(Xn(St({},kI()),{scheduleInRootZone:t})),[{provide:Br,useFactory:n},{provide:Mu,multi:!0,useFactory:()=>{let o=tt(z6,{optional:!0});return()=>o.initialize()}},{provide:Mu,multi:!0,useFactory:()=>{let o=tt(B6);return()=>{o.initialize()}}},e===!0?{provide:EC,useValue:!0}:[],{provide:TC,useValue:t??YO},{provide:Vs,useFactory:()=>{let o=tt(Br),a=tt(Qr),s;return f=>{o.runOutsideAngular(()=>{a.destroyed&&!s?setTimeout(()=>{throw f}):(s??=a.get(Dl),s.handleError(f))})}}}]}function OI(n){let e=n?.ignoreChangesOutsideZone,t=n?.scheduleInRootZone,o=LI({ngZoneFactory:()=>{let a=kI(n);return a.scheduleInRootZone=t,a.shouldCoalesceEventChangeDetection&&Xh("NgZone_CoalesceEvent"),new Br(a)},ignoreChangesOutsideZone:e,scheduleInRootZone:t});return Pu([{provide:Zk,useValue:!0},{provide:hy,useValue:!1},o])}function kI(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}var B6=(()=>{class n{subscription=new Fr;initialized=!1;zone=tt(Br);pendingTasks=tt(Pc);initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Br.assertNotInAngularZone(),queueMicrotask(()=>{t!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Br.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Ht({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var qk=(()=>{class n{applicationErrorHandler=tt(Vs);appRef=tt(Rf);taskService=tt(Pc);ngZone=tt(Br);zonelessEnabled=tt(hy);tracing=tt(Ty,{optional:!0});disableScheduling=tt(EC,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Fr;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(Wx):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(tt(TC,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof Xx||!this.zoneIsDefined)}notify(t){if(!this.zonelessEnabled&&t===5)return;let o=!1;switch(t){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2,o=!0;break}case 12:{this.appRef.dirtyFlags|=16,o=!0;break}case 13:{this.appRef.dirtyFlags|=2,o=!0;break}case 11:{o=!0;break}case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(o))return;let a=this.useMicrotaskScheduler?ZL:KO;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>a(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>a(()=>this.tick()))}shouldScheduleTick(t){return!(this.disableScheduling&&!t||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(Wx+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let t=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(o){this.taskService.remove(t),this.applicationErrorHandler(o)}finally{this.cleanup()}this.useMicrotaskScheduler=!0,ZL(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(t)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let t=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(t)}}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Ht({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function j6(){return typeof $localize<"u"&&$localize.locale||Py}var Tb=new Wt("",{providedIn:"root",factory:()=>tt(Tb,{optional:!0,skipSelf:!0})||j6()});function zu(n){return W2(n)}var FI=class{[Ls];constructor(e){this[Ls]=e}destroy(){this[Ls].destroy()}};function Ry(n,e){let t=e?.injector??tt(Wa),o=e?.manualCleanup!==!0?t.get(Mc):null,a,s=t.get(uy,null,{optional:!0}),f=t.get(Dc);return s!==null?(a=G6(s.view,f,n),o instanceof Q_&&o._lView===s.view&&(o=null)):a=$6(n,t.get(fy),f),a.injector=t,o!==null&&(a.onDestroyFn=o.onDestroy(()=>a.destroy())),new FI(a)}var Wk=Xn(St({},X2),{cleanupFns:void 0,zone:null,onDestroyFn:Cf,run(){let n=Om(!1);try{Y2(this)}finally{Om(n)}},cleanup(){if(!this.cleanupFns?.length)return;let n=pn(null);try{for(;this.cleanupFns.length;)this.cleanupFns.pop()()}finally{this.cleanupFns=[],pn(n)}}}),V6=Xn(St({},Wk),{consumerMarkedDirty(){this.scheduler.schedule(this),this.notifier.notify(12)},destroy(){of(this),this.onDestroyFn(),this.cleanup(),this.scheduler.remove(this)}}),U6=Xn(St({},Wk),{consumerMarkedDirty(){this.view[gn]|=8192,Tf(this.view),this.notifier.notify(13)},destroy(){of(this),this.onDestroyFn(),this.cleanup(),this.view[Lu]?.delete(this)}});function G6(n,e,t){let o=Object.create(U6);return o.view=n,o.zone=typeof Zone<"u"?Zone.current:null,o.notifier=e,o.fn=Xk(o,t),n[Lu]??=new Set,n[Lu].add(o),o.consumerMarkedDirty(o),o}function $6(n,e,t){let o=Object.create(V6);return o.fn=Xk(o,n),o.scheduler=e,o.notifier=t,o.zone=typeof Zone<"u"?Zone.current:null,o.scheduler.add(o),o.notifier.notify(12),o}function Xk(n,e){return()=>{e(t=>(n.cleanupFns??=[]).push(t))}}var Kk=Symbol("InputSignalNode#UNSET"),c$=Xn(St({},K0),{transformFn:void 0,applyValueToInputSignal(n,e){gm(n,e)}});function Jk(n,e){let t=Object.create(c$);t.value=n,t.transformFn=e?.transform;function o(){if(H_(t),t.value===Kk){let a=null;throw new Nt(-950,a)}return t.value}return o[Ls]=t,o}var u$=new Wt("");u$.__NG_ELEMENT_ID__=n=>{let e=js();if(e===null)throw new Nt(204,!1);if(e.type&2)return e.value;if(n&8)return null;throw new Nt(204,!1)};function Yk(n,e){return Jk(n,e)}function h$(n){return Jk(Kk,n)}var Qk=(Yk.required=h$,Yk);var NI=new Wt(""),d$=new Wt("");function Ly(n){return!n.moduleRef}function f$(n){let e=Ly(n)?n.r3Injector:n.moduleRef.injector,t=e.get(Br);return t.run(()=>{Ly(n)?n.r3Injector.resolveInjectorInitializers():n.moduleRef.resolveInjectorInitializers();let o=e.get(Vs),a;if(t.runOutsideAngular(()=>{a=t.onError.subscribe({next:o})}),Ly(n)){let s=()=>e.destroy(),f=n.platformInjector.get(NI);f.add(s),e.onDestroy(()=>{a.unsubscribe(),f.delete(s)})}else{let s=()=>n.moduleRef.destroy(),f=n.platformInjector.get(NI);f.add(s),n.moduleRef.onDestroy(()=>{my(n.allPlatformModules,n.moduleRef),a.unsubscribe(),f.delete(s)})}return m$(o,t,()=>{let s=e.get(Pc),f=s.add(),v=e.get(SI);return v.runInitializers(),v.donePromise.then(()=>{let w=e.get(Tb,Py);if(Bk(w||Py),!e.get(d$,!0))return Ly(n)?e.get(Rf):(n.allPlatformModules.push(n.moduleRef),n.moduleRef);if(Ly(n)){let A=e.get(Rf);return n.rootComponent!==void 0&&A.bootstrap(n.rootComponent),A}else return p$?.(n.moduleRef,n.allPlatformModules),n.moduleRef}).finally(()=>void s.remove(f))})})}var p$;function m$(n,e,t){try{let o=t();return Zm(o)?o.catch(a=>{throw e.runOutsideAngular(()=>n(a)),a}):o}catch(o){throw e.runOutsideAngular(()=>n(o)),o}}var Cb=null;function g$(n=[],e){return Wa.create({name:e,providers:[{provide:ny,useValue:"platform"},{provide:NI,useValue:new Set([()=>Cb=null])},...n]})}function _$(n=[]){if(Cb)return Cb;let e=g$(n);return Cb=e,Fk(),y$(e),e}function y$(n){let e=n.get(hb,null);Bo(n,()=>{e?.forEach(t=>t())})}var zI=(()=>{class n{static __NG_ELEMENT_ID__=v$}return n})();function v$(n){return x$(js(),hi(),(n&16)===16)}function x$(n,e,t){if(Zh(n)&&!t){let o=Rl(n.index,e);return new Wh(o,o)}else if(n.type&175){let o=e[wa];return new Wh(o,e)}return null}function eF(n){let{rootComponent:e,appProviders:t,platformProviders:o,platformRef:a}=n;Ni(8);try{let s=a?.injector??_$(o),f=[LI({}),{provide:Dc,useExisting:qk},kL,...t||[]],v=new xy({providers:f,parent:s,debugName:"",runEnvironmentInitializers:!1});return f$({r3Injector:v.injector,platformInjector:s,rootComponent:e})}catch(s){return Promise.reject(s)}finally{Ni(9)}}var iF=null;function Bu(){return iF}function BI(n){iF??=n}var Oy=class{},jI=(()=>{class n{historyGo(t){throw new Error("")}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Ht({token:n,factory:()=>tt(rF),providedIn:"platform"})}return n})();var rF=(()=>{class n extends jI{_location;_history;_doc=tt(zr);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Bu().getBaseHref(this._doc)}onPopState(t){let o=Bu().getGlobalEventTarget(this._doc,"window");return o.addEventListener("popstate",t,!1),()=>o.removeEventListener("popstate",t)}onHashChange(t){let o=Bu().getGlobalEventTarget(this._doc,"window");return o.addEventListener("hashchange",t,!1),()=>o.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,o,a){this._history.pushState(t,o,a)}replaceState(t,o,a){this._history.replaceState(t,o,a)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Ht({token:n,factory:()=>new n,providedIn:"platform"})}return n})();function oF(n,e){return n?e?n.endsWith("/")?e.startsWith("/")?n+e.slice(1):n+e:e.startsWith("/")?n+e:`${n}/${e}`:n:e}function tF(n){let e=n.search(/#|\?|$/);return n[e-1]==="/"?n.slice(0,e-1)+n.slice(e):n}function Jh(n){return n&&n[0]!=="?"?`?${n}`:n}var Ib=(()=>{class n{historyGo(t){throw new Error("")}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Ht({token:n,factory:()=>tt(aF),providedIn:"root"})}return n})(),sF=new Wt(""),aF=(()=>{class n extends Ib{_platformLocation;_baseHref;_removeListenerFns=[];constructor(t,o){super(),this._platformLocation=t,this._baseHref=o??this._platformLocation.getBaseHrefFromDOM()??tt(zr).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return oF(this._baseHref,t)}path(t=!1){let o=this._platformLocation.pathname+Jh(this._platformLocation.search),a=this._platformLocation.hash;return a&&t?`${o}${a}`:o}pushState(t,o,a,s){let f=this.prepareExternalUrl(a+Jh(s));this._platformLocation.pushState(t,o,f)}replaceState(t,o,a,s){let f=this.prepareExternalUrl(a+Jh(s));this._platformLocation.replaceState(t,o,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static \u0275fac=function(o){return new(o||n)(an(jI),an(sF,8))};static \u0275prov=Ht({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Xm=(()=>{class n{_subject=new No;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(t){this._locationStrategy=t;let o=this._locationStrategy.getBaseHref();this._basePath=E$(tF(nF(o))),this._locationStrategy.onPopState(a=>{this._subject.next({url:this.path(!0),pop:!0,state:a.state,type:a.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,o=""){return this.path()==this.normalize(t+Jh(o))}normalize(t){return n.stripTrailingSlash(w$(this._basePath,nF(t)))}prepareExternalUrl(t){return t&&t[0]!=="/"&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,o="",a=null){this._locationStrategy.pushState(a,"",t,o),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Jh(o)),a)}replaceState(t,o="",a=null){this._locationStrategy.replaceState(a,"",t,o),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Jh(o)),a)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(o=>{this._notifyUrlChangeListeners(o.url,o.state)}),()=>{let o=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(o,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",o){this._urlChangeListeners.forEach(a=>a(t,o))}subscribe(t,o,a){return this._subject.subscribe({next:t,error:o??void 0,complete:a??void 0})}static normalizeQueryParams=Jh;static joinWithSlash=oF;static stripTrailingSlash=tF;static \u0275fac=function(o){return new(o||n)(an(Ib))};static \u0275prov=Ht({token:n,factory:()=>b$(),providedIn:"root"})}return n})();function b$(){return new Xm(an(Ib))}function w$(n,e){if(!n||!e.startsWith(n))return e;let t=e.substring(n.length);return t===""||["/",";","?","#"].includes(t[0])?t:e}function nF(n){return n.replace(/\/index.html$/,"")}function E$(n){if(new RegExp("^(https?:)?//").test(n)){let[,t]=n.split(/\/\/[^\/]+/);return t}return n}var ky=(()=>{class n{_viewContainer;_context=new Sb;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(t,o){this._viewContainer=t,this._thenTemplateRef=o}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){lF(t,!1),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){lF(t,!1),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(t,o){return!0}static \u0275fac=function(o){return new(o||n)(Sy(Gm),Sy(vb))};static \u0275dir=My({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return n})(),Sb=class{$implicit=null;ngIf=null};function lF(n,e){if(n&&!n.createEmbeddedView)throw new Nt(2020,!1)}var wo=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=$m({type:n});static \u0275inj=pf({})}return n})();function Fy(n,e){e=encodeURIComponent(e);for(let t of n.split(";")){let o=t.indexOf("="),[a,s]=o==-1?[t,""]:[t.slice(0,o),t.slice(o+1)];if(a.trim()===e)return decodeURIComponent(s)}return null}var Of=class{};var cF="browser";var Ny=class{_doc;constructor(e){this._doc=e}manager},Db=(()=>{class n extends Ny{constructor(t){super(t)}supports(t){return!0}addEventListener(t,o,a,s){return t.addEventListener(o,a,s),()=>this.removeEventListener(t,o,a,s)}removeEventListener(t,o,a,s){return t.removeEventListener(o,a,s)}static \u0275fac=function(o){return new(o||n)(an(zr))};static \u0275prov=Ht({token:n,factory:n.\u0275fac})}return n})(),Pb=new Wt(""),HI=(()=>{class n{_zone;_plugins;_eventNameToPlugin=new Map;constructor(t,o){this._zone=o,t.forEach(f=>{f.manager=this});let a=t.filter(f=>!(f instanceof Db));this._plugins=a.slice().reverse();let s=t.find(f=>f instanceof Db);s&&this._plugins.push(s)}addEventListener(t,o,a,s){return this._findPluginFor(o).addEventListener(t,o,a,s)}getZone(){return this._zone}_findPluginFor(t){let o=this._eventNameToPlugin.get(t);if(o)return o;if(o=this._plugins.find(s=>s.supports(t)),!o)throw new Nt(5101,!1);return this._eventNameToPlugin.set(t,o),o}static \u0275fac=function(o){return new(o||n)(an(Pb),an(Br))};static \u0275prov=Ht({token:n,factory:n.\u0275fac})}return n})(),VI="ng-app-id";function hF(n){for(let e of n)e.remove()}function dF(n,e){let t=e.createElement("style");return t.textContent=n,t}function C$(n,e,t,o){let a=n.head?.querySelectorAll(`style[${VI}="${e}"],link[${VI}="${e}"]`);if(a)for(let s of a)s.removeAttribute(VI),s instanceof HTMLLinkElement?o.set(s.href.slice(s.href.lastIndexOf("/")+1),{usage:0,elements:[s]}):s.textContent&&t.set(s.textContent,{usage:0,elements:[s]})}function GI(n,e){let t=e.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("href",n),t}var ZI=(()=>{class n{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;constructor(t,o,a,s={}){this.doc=t,this.appId=o,this.nonce=a,C$(t,o,this.inline,this.external),this.hosts.add(t.head)}addStyles(t,o){for(let a of t)this.addUsage(a,this.inline,dF);o?.forEach(a=>this.addUsage(a,this.external,GI))}removeStyles(t,o){for(let a of t)this.removeUsage(a,this.inline);o?.forEach(a=>this.removeUsage(a,this.external))}addUsage(t,o,a){let s=o.get(t);s?s.usage++:o.set(t,{usage:1,elements:[...this.hosts].map(f=>this.addElement(f,a(t,this.doc)))})}removeUsage(t,o){let a=o.get(t);a&&(a.usage--,a.usage<=0&&(hF(a.elements),o.delete(t)))}ngOnDestroy(){for(let[,{elements:t}]of[...this.inline,...this.external])hF(t);this.hosts.clear()}addHost(t){this.hosts.add(t);for(let[o,{elements:a}]of this.inline)a.push(this.addElement(t,dF(o,this.doc)));for(let[o,{elements:a}]of this.external)a.push(this.addElement(t,GI(o,this.doc)))}removeHost(t){this.hosts.delete(t)}addElement(t,o){return this.nonce&&o.setAttribute("nonce",this.nonce),t.appendChild(o)}static \u0275fac=function(o){return new(o||n)(an(zr),an(ub),an(db,8),an(Ey))};static \u0275prov=Ht({token:n,factory:n.\u0275fac})}return n})(),UI={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},qI=/%COMP%/g;var pF="%COMP%",I$=`_nghost-${pF}`,S$=`_ngcontent-${pF}`,D$=!0,M$=new Wt("",{providedIn:"root",factory:()=>D$});function P$(n){return S$.replace(qI,n)}function A$(n){return I$.replace(qI,n)}function mF(n,e){return e.map(t=>t.replace(qI,n))}var WI=(()=>{class n{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(t,o,a,s,f,v,w=null,D=null){this.eventManager=t,this.sharedStylesHost=o,this.appId=a,this.removeStylesOnCompDestroy=s,this.doc=f,this.ngZone=v,this.nonce=w,this.tracingService=D,this.platformIsServer=!1,this.defaultRenderer=new zy(t,f,v,this.platformIsServer,this.tracingService)}createRenderer(t,o){if(!t||!o)return this.defaultRenderer;let a=this.getOrCreateRenderer(t,o);return a instanceof Mb?a.applyToHost(t):a instanceof By&&a.applyStyles(),a}getOrCreateRenderer(t,o){let a=this.rendererByCompId,s=a.get(o.id);if(!s){let f=this.doc,v=this.ngZone,w=this.eventManager,D=this.sharedStylesHost,A=this.removeStylesOnCompDestroy,z=this.platformIsServer,H=this.tracingService;switch(o.encapsulation){case Fu.Emulated:s=new Mb(w,D,o,this.appId,A,f,v,z,H);break;case Fu.ShadowDom:return new $I(w,D,t,o,f,v,this.nonce,z,H);default:s=new By(w,D,o,A,f,v,z,H);break}a.set(o.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(t){this.rendererByCompId.delete(t)}static \u0275fac=function(o){return new(o||n)(an(HI),an(ZI),an(ub),an(M$),an(zr),an(Br),an(db),an(Ty,8))};static \u0275prov=Ht({token:n,factory:n.\u0275fac})}return n})(),zy=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(e,t,o,a,s){this.eventManager=e,this.doc=t,this.ngZone=o,this.platformIsServer=a,this.tracingService=s}destroy(){}destroyNode=null;createElement(e,t){return t?this.doc.createElementNS(UI[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(fF(e)?e.content:e).appendChild(t)}insertBefore(e,t,o){e&&(fF(e)?e.content:e).insertBefore(t,o)}removeChild(e,t){t.remove()}selectRootElement(e,t){let o=typeof e=="string"?this.doc.querySelector(e):e;if(!o)throw new Nt(-5104,!1);return t||(o.textContent=""),o}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,o,a){if(a){t=a+":"+t;let s=UI[a];s?e.setAttributeNS(s,t,o):e.setAttribute(t,o)}else e.setAttribute(t,o)}removeAttribute(e,t,o){if(o){let a=UI[o];a?e.removeAttributeNS(a,t):e.removeAttribute(`${o}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,o,a){a&(Rc.DashCase|Rc.Important)?e.style.setProperty(t,o,a&Rc.Important?"important":""):e.style[t]=o}removeStyle(e,t,o){o&Rc.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,o){e!=null&&(e[t]=o)}setValue(e,t){e.nodeValue=t}listen(e,t,o,a){if(typeof e=="string"&&(e=Bu().getGlobalEventTarget(this.doc,e),!e))throw new Nt(5102,!1);let s=this.decoratePreventDefault(o);return this.tracingService?.wrapEventListener&&(s=this.tracingService.wrapEventListener(e,t,s)),this.eventManager.addEventListener(e,t,s,a)}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;e(t)===!1&&t.preventDefault()}}};function fF(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var $I=class extends zy{sharedStylesHost;hostEl;shadowRoot;constructor(e,t,o,a,s,f,v,w,D){super(e,s,f,w,D),this.sharedStylesHost=t,this.hostEl=o,this.shadowRoot=o.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let A=a.styles;A=mF(a.id,A);for(let H of A){let q=document.createElement("style");v&&q.setAttribute("nonce",v),q.textContent=H,this.shadowRoot.appendChild(q)}let z=a.getExternalStyles?.();if(z)for(let H of z){let q=GI(H,s);v&&q.setAttribute("nonce",v),this.shadowRoot.appendChild(q)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,o){return super.insertBefore(this.nodeOrShadowRoot(e),t,o)}removeChild(e,t){return super.removeChild(null,t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},By=class extends zy{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(e,t,o,a,s,f,v,w,D){super(e,s,f,v,w),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=a;let A=o.styles;this.styles=D?mF(D,A):A,this.styleUrls=o.getExternalStyles?.(D)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&Sf.size===0&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},Mb=class extends By{contentAttr;hostAttr;constructor(e,t,o,a,s,f,v,w,D){let A=a+"-"+o.id;super(e,t,o,s,f,v,w,D,A),this.contentAttr=P$(A),this.hostAttr=A$(A)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let o=super.createElement(e,t);return super.setAttribute(o,this.contentAttr,""),o}};var Ab=class n extends Oy{supportsDOMEvents=!0;static makeCurrent(){BI(new n)}onAndCancel(e,t,o,a){return e.addEventListener(t,o,a),()=>{e.removeEventListener(t,o,a)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.remove()}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=R$();return t==null?null:L$(t)}resetBaseElement(){jy=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return Fy(document.cookie,e)}},jy=null;function R$(){return jy=jy||document.head.querySelector("base"),jy?jy.getAttribute("href"):null}function L$(n){return new URL(n,document.baseURI).pathname}var O$=(()=>{class n{build(){return new XMLHttpRequest}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Ht({token:n,factory:n.\u0275fac})}return n})(),gF=["alt","control","meta","shift"],k$={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},F$={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},_F=(()=>{class n extends Ny{constructor(t){super(t)}supports(t){return n.parseEventName(t)!=null}addEventListener(t,o,a,s){let f=n.parseEventName(o),v=n.eventCallback(f.fullKey,a,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Bu().onAndCancel(t,f.domEventName,v,s))}static parseEventName(t){let o=t.toLowerCase().split("."),a=o.shift();if(o.length===0||!(a==="keydown"||a==="keyup"))return null;let s=n._normalizeKey(o.pop()),f="",v=o.indexOf("code");if(v>-1&&(o.splice(v,1),f="code."),gF.forEach(D=>{let A=o.indexOf(D);A>-1&&(o.splice(A,1),f+=D+".")}),f+=s,o.length!=0||s.length===0)return null;let w={};return w.domEventName=a,w.fullKey=f,w}static matchEventFullKeyCode(t,o){let a=k$[t.key]||t.key,s="";return o.indexOf("code.")>-1&&(a=t.code,s="code."),a==null||!a?!1:(a=a.toLowerCase(),a===" "?a="space":a==="."&&(a="dot"),gF.forEach(f=>{if(f!==a){let v=F$[f];v(t)&&(s+=f+".")}}),s+=a,s===o)}static eventCallback(t,o,a){return s=>{n.matchEventFullKeyCode(s,t)&&a.runGuarded(()=>o(s))}}static _normalizeKey(t){return t==="esc"?"escape":t}static \u0275fac=function(o){return new(o||n)(an(zr))};static \u0275prov=Ht({token:n,factory:n.\u0275fac})}return n})();function XI(n,e,t){let o=St({rootComponent:n,platformRef:t?.platformRef},N$(e));return eF(o)}function N$(n){return{appProviders:[...U$,...n?.providers??[]],platformProviders:V$}}function z$(){Ab.makeCurrent()}function B$(){return new Dl}function j$(){return sI(document),document}var V$=[{provide:Ey,useValue:cF},{provide:hb,useValue:z$,multi:!0},{provide:zr,useFactory:j$}];var U$=[{provide:ny,useValue:"root"},{provide:Dl,useFactory:B$},{provide:Pb,useClass:Db,multi:!0,deps:[zr]},{provide:Pb,useClass:_F,multi:!0,deps:[zr]},WI,ZI,HI,{provide:Df,useExisting:WI},{provide:Of,useClass:O$},[]];var Jm=class{},Vy=class{},Qh=class n{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(e){e?typeof e=="string"?this.lazyInit=()=>{this.headers=new Map,e.split(`
`).forEach(t=>{let o=t.indexOf(":");if(o>0){let a=t.slice(0,o),s=t.slice(o+1).trim();this.addHeaderEntry(a,s)}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((t,o)=>{this.addHeaderEntry(o,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([t,o])=>{this.setHeaderEntries(t,o)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();let t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof n?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){let t=new n;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof n?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){let t=e.name.toLowerCase();switch(e.op){case"a":case"s":let o=e.value;if(typeof o=="string"&&(o=[o]),o.length===0)return;this.maybeSetNormalizedName(e.name,t);let a=(e.op==="a"?this.headers.get(t):void 0)||[];a.push(...o),this.headers.set(t,a);break;case"d":let s=e.value;if(!s)this.headers.delete(t),this.normalizedNames.delete(t);else{let f=this.headers.get(t);if(!f)return;f=f.filter(v=>s.indexOf(v)===-1),f.length===0?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,f)}break}}addHeaderEntry(e,t){let o=e.toLowerCase();this.maybeSetNormalizedName(e,o),this.headers.has(o)?this.headers.get(o).push(t):this.headers.set(o,[t])}setHeaderEntries(e,t){let o=(Array.isArray(t)?t:[t]).map(s=>s.toString()),a=e.toLowerCase();this.headers.set(a,o),this.maybeSetNormalizedName(e,a)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}};var Lb=class{encodeKey(e){return yF(e)}encodeValue(e){return yF(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}};function G$(n,e){let t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(a=>{let s=a.indexOf("="),[f,v]=s==-1?[e.decodeKey(a),""]:[e.decodeKey(a.slice(0,s)),e.decodeValue(a.slice(s+1))],w=t.get(f)||[];w.push(v),t.set(f,w)}),t}var $$=/%(\d[a-f0-9])/gi,H$={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function yF(n){return encodeURIComponent(n).replace($$,(e,t)=>H$[t]??e)}function Rb(n){return`${n}`}var ju=class n{map;encoder;updates=null;cloneFrom=null;constructor(e={}){if(this.encoder=e.encoder||new Lb,e.fromString){if(e.fromObject)throw new Nt(2805,!1);this.map=G$(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{let o=e.fromObject[t],a=Array.isArray(o)?o.map(Rb):[Rb(o)];this.map.set(t,a)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();let t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){let t=[];return Object.keys(e).forEach(o=>{let a=e[o];Array.isArray(a)?a.forEach(s=>{t.push({param:o,value:s,op:"a"})}):t.push({param:o,value:a,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{let t=this.encoder.encodeKey(e);return this.map.get(e).map(o=>t+"="+this.encoder.encodeValue(o)).join("&")}).filter(e=>e!=="").join("&")}clone(e){let t=new n({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":let t=(e.op==="a"?this.map.get(e.param):void 0)||[];t.push(Rb(e.value)),this.map.set(e.param,t);break;case"d":if(e.value!==void 0){let o=this.map.get(e.param)||[],a=o.indexOf(Rb(e.value));a!==-1&&o.splice(a,1),o.length>0?this.map.set(e.param,o):this.map.delete(e.param)}else{this.map.delete(e.param);break}}}),this.cloneFrom=this.updates=null)}};var Ob=class{map=new Map;set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}};function Z$(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function vF(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function xF(n){return typeof Blob<"u"&&n instanceof Blob}function bF(n){return typeof FormData<"u"&&n instanceof FormData}function q$(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}var wF="Content-Type",EF="Accept",TF="X-Request-URL",CF="text/plain",IF="application/json",W$=`${IF}, ${CF}, */*`,Ym=class n{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;credentials;keepalive=!1;cache;priority;mode;redirect;referrer;integrity;responseType="json";method;params;urlWithParams;transferCache;timeout;constructor(e,t,o,a){this.url=t,this.method=e.toUpperCase();let s;if(Z$(this.method)||a?(this.body=o!==void 0?o:null,s=a):s=o,s){if(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,this.keepalive=!!s.keepalive,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params),s.priority&&(this.priority=s.priority),s.cache&&(this.cache=s.cache),s.credentials&&(this.credentials=s.credentials),typeof s.timeout=="number"){if(s.timeout<1||!Number.isInteger(s.timeout))throw new Nt(2822,"");this.timeout=s.timeout}s.mode&&(this.mode=s.mode),s.redirect&&(this.redirect=s.redirect),s.integrity&&(this.integrity=s.integrity),s.referrer&&(this.referrer=s.referrer),this.transferCache=s.transferCache}if(this.headers??=new Qh,this.context??=new Ob,!this.params)this.params=new ju,this.urlWithParams=t;else{let f=this.params.toString();if(f.length===0)this.urlWithParams=t;else{let v=t.indexOf("?"),w=v===-1?"?":v<t.length-1?"&":"";this.urlWithParams=t+w+f}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||vF(this.body)||xF(this.body)||bF(this.body)||q$(this.body)?this.body:this.body instanceof ju?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||bF(this.body)?null:xF(this.body)?this.body.type||null:vF(this.body)?null:typeof this.body=="string"?CF:this.body instanceof ju?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?IF:null}clone(e={}){let t=e.method||this.method,o=e.url||this.url,a=e.responseType||this.responseType,s=e.keepalive??this.keepalive,f=e.priority||this.priority,v=e.cache||this.cache,w=e.mode||this.mode,D=e.redirect||this.redirect,A=e.credentials||this.credentials,z=e.referrer||this.referrer,H=e.integrity||this.integrity,q=e.transferCache??this.transferCache,W=e.timeout??this.timeout,me=e.body!==void 0?e.body:this.body,ce=e.withCredentials??this.withCredentials,ue=e.reportProgress??this.reportProgress,Me=e.headers||this.headers,Ue=e.params||this.params,Pe=e.context??this.context;return e.setHeaders!==void 0&&(Me=Object.keys(e.setHeaders).reduce((ke,Qe)=>ke.set(Qe,e.setHeaders[Qe]),Me)),e.setParams&&(Ue=Object.keys(e.setParams).reduce((ke,Qe)=>ke.set(Qe,e.setParams[Qe]),Ue)),new n(t,o,me,{params:Ue,headers:Me,context:Pe,reportProgress:ue,responseType:a,withCredentials:ce,transferCache:q,keepalive:s,cache:v,priority:f,timeout:W,mode:w,redirect:D,credentials:A,referrer:z,integrity:H})}},kf=(function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n})(kf||{}),Qm=class{headers;status;statusText;url;ok;type;redirected;constructor(e,t=200,o="OK"){this.headers=e.headers||new Qh,this.status=e.status!==void 0?e.status:t,this.statusText=e.statusText||o,this.url=e.url||null,this.redirected=e.redirected,this.ok=this.status>=200&&this.status<300}},kb=class n extends Qm{constructor(e={}){super(e)}type=kf.ResponseHeader;clone(e={}){return new n({headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},Uy=class n extends Qm{body;constructor(e={}){super(e),this.body=e.body!==void 0?e.body:null}type=kf.Response;clone(e={}){return new n({body:e.body!==void 0?e.body:this.body,headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0,redirected:e.redirected??this.redirected})}},Km=class extends Qm{name="HttpErrorResponse";message;error;ok=!1;constructor(e){super(e,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${e.url||"(unknown url)"}`:this.message=`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}},X$=200,Y$=204;function YI(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,credentials:n.credentials,transferCache:n.transferCache,timeout:n.timeout,keepalive:n.keepalive,priority:n.priority,cache:n.cache,mode:n.mode,redirect:n.redirect,integrity:n.integrity,referrer:n.referrer}}var Nb=(()=>{class n{handler;constructor(t){this.handler=t}request(t,o,a={}){let s;if(t instanceof Ym)s=t;else{let w;a.headers instanceof Qh?w=a.headers:w=new Qh(a.headers);let D;a.params&&(a.params instanceof ju?D=a.params:D=new ju({fromObject:a.params})),s=new Ym(t,o,a.body!==void 0?a.body:null,{headers:w,context:a.context,params:D,reportProgress:a.reportProgress,responseType:a.responseType||"json",withCredentials:a.withCredentials,transferCache:a.transferCache,keepalive:a.keepalive,priority:a.priority,cache:a.cache,mode:a.mode,redirect:a.redirect,credentials:a.credentials,referrer:a.referrer,integrity:a.integrity,timeout:a.timeout})}let f=un(s).pipe(jh(w=>this.handler.handle(w)));if(t instanceof Ym||a.observe==="events")return f;let v=f.pipe(Fs(w=>w instanceof Uy));switch(a.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return v.pipe(Fn(w=>{if(w.body!==null&&!(w.body instanceof ArrayBuffer))throw new Nt(2806,!1);return w.body}));case"blob":return v.pipe(Fn(w=>{if(w.body!==null&&!(w.body instanceof Blob))throw new Nt(2807,!1);return w.body}));case"text":return v.pipe(Fn(w=>{if(w.body!==null&&typeof w.body!="string")throw new Nt(2808,!1);return w.body}));case"json":default:return v.pipe(Fn(w=>w.body))}case"response":return v;default:throw new Nt(2809,!1)}}delete(t,o={}){return this.request("DELETE",t,o)}get(t,o={}){return this.request("GET",t,o)}head(t,o={}){return this.request("HEAD",t,o)}jsonp(t,o){return this.request("JSONP",t,{params:new ju().append(o,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,o={}){return this.request("OPTIONS",t,o)}patch(t,o,a={}){return this.request("PATCH",t,YI(a,o))}post(t,o,a={}){return this.request("POST",t,YI(a,o))}put(t,o,a={}){return this.request("PUT",t,YI(a,o))}static \u0275fac=function(o){return new(o||n)(an(Jm))};static \u0275prov=Ht({token:n,factory:n.\u0275fac})}return n})();var K$=new Wt("");function J$(n,e){return e(n)}function Q$(n,e,t){return(o,a)=>Bo(t,()=>e(o,s=>n(s,a)))}var SF=new Wt(""),DF=new Wt(""),MF=new Wt("",{providedIn:"root",factory:()=>!0});var Fb=(()=>{class n extends Jm{backend;injector;chain=null;pendingTasks=tt(dy);contributeToStability=tt(MF);constructor(t,o){super(),this.backend=t,this.injector=o}handle(t){if(this.chain===null){let o=Array.from(new Set([...this.injector.get(SF),...this.injector.get(DF,[])]));this.chain=o.reduceRight((a,s)=>Q$(a,s,this.injector),J$)}if(this.contributeToStability){let o=this.pendingTasks.add();return this.chain(t,a=>this.backend.handle(a)).pipe(cf(o))}else return this.chain(t,o=>this.backend.handle(o))}static \u0275fac=function(o){return new(o||n)(an(Vy),an(Qr))};static \u0275prov=Ht({token:n,factory:n.\u0275fac})}return n})();var e8=/^\)\]\}',?\n/,t8=RegExp(`^${TF}:`,"m");function n8(n){return"responseURL"in n&&n.responseURL?n.responseURL:t8.test(n.getAllResponseHeaders())?n.getResponseHeader(TF):null}var KI=(()=>{class n{xhrFactory;constructor(t){this.xhrFactory=t}handle(t){if(t.method==="JSONP")throw new Nt(-2800,!1);let o=this.xhrFactory;return un(null).pipe(es(()=>new Yn(s=>{let f=o.build();if(f.open(t.method,t.urlWithParams),t.withCredentials&&(f.withCredentials=!0),t.headers.forEach((ce,ue)=>f.setRequestHeader(ce,ue.join(","))),t.headers.has(EF)||f.setRequestHeader(EF,W$),!t.headers.has(wF)){let ce=t.detectContentTypeHeader();ce!==null&&f.setRequestHeader(wF,ce)}if(t.timeout&&(f.timeout=t.timeout),t.responseType){let ce=t.responseType.toLowerCase();f.responseType=ce!=="json"?ce:"text"}let v=t.serializeBody(),w=null,D=()=>{if(w!==null)return w;let ce=f.statusText||"OK",ue=new Qh(f.getAllResponseHeaders()),Me=n8(f)||t.url;return w=new kb({headers:ue,status:f.status,statusText:ce,url:Me}),w},A=()=>{let{headers:ce,status:ue,statusText:Me,url:Ue}=D(),Pe=null;ue!==Y$&&(Pe=typeof f.response>"u"?f.responseText:f.response),ue===0&&(ue=Pe?X$:0);let ke=ue>=200&&ue<300;if(t.responseType==="json"&&typeof Pe=="string"){let Qe=Pe;Pe=Pe.replace(e8,"");try{Pe=Pe!==""?JSON.parse(Pe):null}catch(ot){Pe=Qe,ke&&(ke=!1,Pe={error:ot,text:Pe})}}ke?(s.next(new Uy({body:Pe,headers:ce,status:ue,statusText:Me,url:Ue||void 0})),s.complete()):s.error(new Km({error:Pe,headers:ce,status:ue,statusText:Me,url:Ue||void 0}))},z=ce=>{let{url:ue}=D(),Me=new Km({error:ce,status:f.status||0,statusText:f.statusText||"Unknown Error",url:ue||void 0});s.error(Me)},H=z;t.timeout&&(H=ce=>{let{url:ue}=D(),Me=new Km({error:new DOMException("Request timed out","TimeoutError"),status:f.status||0,statusText:f.statusText||"Request timeout",url:ue||void 0});s.error(Me)});let q=!1,W=ce=>{q||(s.next(D()),q=!0);let ue={type:kf.DownloadProgress,loaded:ce.loaded};ce.lengthComputable&&(ue.total=ce.total),t.responseType==="text"&&f.responseText&&(ue.partialText=f.responseText),s.next(ue)},me=ce=>{let ue={type:kf.UploadProgress,loaded:ce.loaded};ce.lengthComputable&&(ue.total=ce.total),s.next(ue)};return f.addEventListener("load",A),f.addEventListener("error",z),f.addEventListener("timeout",H),f.addEventListener("abort",z),t.reportProgress&&(f.addEventListener("progress",W),v!==null&&f.upload&&f.upload.addEventListener("progress",me)),f.send(v),s.next({type:kf.Sent}),()=>{f.removeEventListener("error",z),f.removeEventListener("abort",z),f.removeEventListener("load",A),f.removeEventListener("timeout",H),t.reportProgress&&(f.removeEventListener("progress",W),v!==null&&f.upload&&f.upload.removeEventListener("progress",me)),f.readyState!==f.DONE&&f.abort()}})))}static \u0275fac=function(o){return new(o||n)(an(Of))};static \u0275prov=Ht({token:n,factory:n.\u0275fac})}return n})(),PF=new Wt(""),i8="XSRF-TOKEN",r8=new Wt("",{providedIn:"root",factory:()=>i8}),o8="X-XSRF-TOKEN",s8=new Wt("",{providedIn:"root",factory:()=>o8}),Gy=class{},a8=(()=>{class n{doc;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(t,o){this.doc=t,this.cookieName=o}getToken(){let t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=Fy(t,this.cookieName),this.lastCookieString=t),this.lastToken}static \u0275fac=function(o){return new(o||n)(an(zr),an(r8))};static \u0275prov=Ht({token:n,factory:n.\u0275fac})}return n})(),l8=/^(?:https?:)?\/\//i;function c8(n,e){if(!tt(PF)||n.method==="GET"||n.method==="HEAD"||l8.test(n.url))return e(n);let t=tt(Gy).getToken(),o=tt(s8);return t!=null&&!n.headers.has(o)&&(n=n.clone({headers:n.headers.set(o,t)})),e(n)}function JI(...n){let e=[Nb,KI,Fb,{provide:Jm,useExisting:Fb},{provide:Vy,useFactory:()=>tt(K$,{optional:!0})??tt(KI)},{provide:SF,useValue:c8,multi:!0},{provide:PF,useValue:!0},{provide:Gy,useClass:a8}];for(let t of n)e.push(...t.\u0275providers);return Pu(e)}var AF=(()=>{class n{_doc;constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static \u0275fac=function(o){return new(o||n)(an(zr))};static \u0275prov=Ht({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var vn="primary",rv=Symbol("RouteTitle"),iS=class{params;constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function zf(n){return new iS(n)}function BF(n,e,t){let o=t.path.split("/");if(o.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||o.length<n.length))return null;let a={};for(let s=0;s<o.length;s++){let f=o[s],v=n[s];if(f[0]===":")a[f.substring(1)]=v;else if(f!==v.path)return null}return{consumed:n.slice(0,o.length),posParams:a}}function d8(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!Lc(n[t],e[t]))return!1;return!0}function Lc(n,e){let t=n?rS(n):void 0,o=e?rS(e):void 0;if(!t||!o||t.length!=o.length)return!1;let a;for(let s=0;s<t.length;s++)if(a=t[s],!jF(n[a],e[a]))return!1;return!0}function rS(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function jF(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),o=[...e].sort();return t.every((a,s)=>o[s]===a)}else return n===e}function VF(n){return n.length>0?n[n.length-1]:null}function Gu(n){return wT(n)?n:Zm(n)?Nr(Promise.resolve(n)):un(n)}var f8={exact:GF,subset:$F},UF={exact:p8,subset:m8,ignored:()=>!0};function RF(n,e,t){return f8[t.paths](n.root,e.root,t.matrixParams)&&UF[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function p8(n,e){return Lc(n,e)}function GF(n,e,t){if(!Ff(n.segments,e.segments)||!jb(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let o in e.children)if(!n.children[o]||!GF(n.children[o],e.children[o],t))return!1;return!0}function m8(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>jF(n[t],e[t]))}function $F(n,e,t){return HF(n,e,e.segments,t)}function HF(n,e,t,o){if(n.segments.length>t.length){let a=n.segments.slice(0,t.length);return!(!Ff(a,t)||e.hasChildren()||!jb(a,t,o))}else if(n.segments.length===t.length){if(!Ff(n.segments,t)||!jb(n.segments,t,o))return!1;for(let a in e.children)if(!n.children[a]||!$F(n.children[a],e.children[a],o))return!1;return!0}else{let a=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!Ff(n.segments,a)||!jb(n.segments,a,o)||!n.children[vn]?!1:HF(n.children[vn],e,s,o)}}function jb(n,e,t){return e.every((o,a)=>UF[t](n[a].parameters,o.parameters))}var kc=class{root;queryParams;fragment;_queryParamMap;constructor(e=new di([],{}),t={},o=null){this.root=e,this.queryParams=t,this.fragment=o}get queryParamMap(){return this._queryParamMap??=zf(this.queryParams),this._queryParamMap}toString(){return y8.serialize(this)}},di=class{segments;children;parent=null;constructor(e,t){this.segments=e,this.children=t,Object.values(t).forEach(o=>o.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Vb(this)}},ed=class{path;parameters;_parameterMap;constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=zf(this.parameters),this._parameterMap}toString(){return qF(this)}};function g8(n,e){return Ff(n,e)&&n.every((t,o)=>Lc(t.parameters,e[o].parameters))}function Ff(n,e){return n.length!==e.length?!1:n.every((t,o)=>t.path===e[o].path)}function _8(n,e){let t=[];return Object.entries(n.children).forEach(([o,a])=>{o===vn&&(t=t.concat(e(a,o)))}),Object.entries(n.children).forEach(([o,a])=>{o!==vn&&(t=t.concat(e(a,o)))}),t}var ov=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275prov=Ht({token:n,factory:()=>new Bf,providedIn:"root"})}return n})(),Bf=class{parse(e){let t=new sS(e);return new kc(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${$y(e.root,!0)}`,o=b8(e.queryParams),a=typeof e.fragment=="string"?`#${v8(e.fragment)}`:"";return`${t}${o}${a}`}},y8=new Bf;function Vb(n){return n.segments.map(e=>qF(e)).join("/")}function $y(n,e){if(!n.hasChildren())return Vb(n);if(e){let t=n.children[vn]?$y(n.children[vn],!1):"",o=[];return Object.entries(n.children).forEach(([a,s])=>{a!==vn&&o.push(`${a}:${$y(s,!1)}`)}),o.length>0?`${t}(${o.join("//")})`:t}else{let t=_8(n,(o,a)=>a===vn?[$y(n.children[vn],!1)]:[`${a}:${$y(o,!1)}`]);return Object.keys(n.children).length===1&&n.children[vn]!=null?`${Vb(n)}/${t[0]}`:`${Vb(n)}/(${t.join("//")})`}}function ZF(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function zb(n){return ZF(n).replace(/%3B/gi,";")}function v8(n){return encodeURI(n)}function oS(n){return ZF(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Ub(n){return decodeURIComponent(n)}function LF(n){return Ub(n.replace(/\+/g,"%20"))}function qF(n){return`${oS(n.path)}${x8(n.parameters)}`}function x8(n){return Object.entries(n).map(([e,t])=>`;${oS(e)}=${oS(t)}`).join("")}function b8(n){let e=Object.entries(n).map(([t,o])=>Array.isArray(o)?o.map(a=>`${zb(t)}=${zb(a)}`).join("&"):`${zb(t)}=${zb(o)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var w8=/^[^\/()?;#]+/;function QI(n){let e=n.match(w8);return e?e[0]:""}var E8=/^[^\/()?;=#]+/;function T8(n){let e=n.match(E8);return e?e[0]:""}var C8=/^[^=?&#]+/;function I8(n){let e=n.match(C8);return e?e[0]:""}var S8=/^[^&#]+/;function D8(n){let e=n.match(S8);return e?e[0]:""}var sS=class{url;remaining;constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new di([],{}):new di([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let o={};return this.peekStartsWith("(")&&(o=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(o[vn]=new di(e,t)),o}parseSegment(){let e=QI(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new Nt(4009,!1);return this.capture(e),new ed(Ub(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=T8(this.remaining);if(!t)return;this.capture(t);let o="";if(this.consumeOptional("=")){let a=QI(this.remaining);a&&(o=a,this.capture(o))}e[Ub(t)]=Ub(o)}parseQueryParam(e){let t=I8(this.remaining);if(!t)return;this.capture(t);let o="";if(this.consumeOptional("=")){let f=D8(this.remaining);f&&(o=f,this.capture(o))}let a=LF(t),s=LF(o);if(e.hasOwnProperty(a)){let f=e[a];Array.isArray(f)||(f=[f],e[a]=f),f.push(s)}else e[a]=s}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let o=QI(this.remaining),a=this.remaining[o.length];if(a!=="/"&&a!==")"&&a!==";")throw new Nt(4010,!1);let s;o.indexOf(":")>-1?(s=o.slice(0,o.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=vn);let f=this.parseChildren();t[s??vn]=Object.keys(f).length===1&&f[vn]?f[vn]:new di([],f),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new Nt(4011,!1)}};function WF(n){return n.segments.length>0?new di([],{[vn]:n}):n}function XF(n){let e={};for(let[o,a]of Object.entries(n.children)){let s=XF(a);if(o===vn&&s.segments.length===0&&s.hasChildren())for(let[f,v]of Object.entries(s.children))e[f]=v;else(s.segments.length>0||s.hasChildren())&&(e[o]=s)}let t=new di(n.segments,e);return M8(t)}function M8(n){if(n.numberOfChildren===1&&n.children[vn]){let e=n.children[vn];return new di(n.segments.concat(e.segments),e.children)}return n}function rg(n){return n instanceof kc}function YF(n,e,t=null,o=null){let a=KF(n);return JF(a,e,t,o)}function KF(n){let e;function t(s){let f={};for(let w of s.children){let D=t(w);f[w.outlet]=D}let v=new di(s.url,f);return s===n&&(e=v),v}let o=t(n.root),a=WF(o);return e??a}function JF(n,e,t,o){let a=n;for(;a.parent;)a=a.parent;if(e.length===0)return eS(a,a,a,t,o);let s=P8(e);if(s.toRoot())return eS(a,a,new di([],{}),t,o);let f=A8(s,a,n),v=f.processChildren?Zy(f.segmentGroup,f.index,s.commands):eN(f.segmentGroup,f.index,s.commands);return eS(a,f.segmentGroup,v,t,o)}function Gb(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function Xy(n){return typeof n=="object"&&n!=null&&n.outlets}function eS(n,e,t,o,a){let s={};o&&Object.entries(o).forEach(([w,D])=>{s[w]=Array.isArray(D)?D.map(A=>`${A}`):`${D}`});let f;n===e?f=t:f=QF(n,e,t);let v=WF(XF(f));return new kc(v,s,a)}function QF(n,e,t){let o={};return Object.entries(n.children).forEach(([a,s])=>{s===e?o[a]=t:o[a]=QF(s,e,t)}),new di(n.segments,o)}var $b=class{isAbsolute;numberOfDoubleDots;commands;constructor(e,t,o){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=o,e&&o.length>0&&Gb(o[0]))throw new Nt(4003,!1);let a=o.find(Xy);if(a&&a!==VF(o))throw new Nt(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function P8(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new $b(!0,0,n);let e=0,t=!1,o=n.reduce((a,s,f)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let v={};return Object.entries(s.outlets).forEach(([w,D])=>{v[w]=typeof D=="string"?D.split("/"):D}),[...a,{outlets:v}]}if(s.segmentPath)return[...a,s.segmentPath]}return typeof s!="string"?[...a,s]:f===0?(s.split("/").forEach((v,w)=>{w==0&&v==="."||(w==0&&v===""?t=!0:v===".."?e++:v!=""&&a.push(v))}),a):[...a,s]},[]);return new $b(t,e,o)}var ng=class{segmentGroup;processChildren;index;constructor(e,t,o){this.segmentGroup=e,this.processChildren=t,this.index=o}};function A8(n,e,t){if(n.isAbsolute)return new ng(e,!0,0);if(!t)return new ng(e,!1,NaN);if(t.parent===null)return new ng(t,!0,0);let o=Gb(n.commands[0])?0:1,a=t.segments.length-1+o;return R8(t,a,n.numberOfDoubleDots)}function R8(n,e,t){let o=n,a=e,s=t;for(;s>a;){if(s-=a,o=o.parent,!o)throw new Nt(4005,!1);a=o.segments.length}return new ng(o,!1,a-s)}function L8(n){return Xy(n[0])?n[0].outlets:{[vn]:n}}function eN(n,e,t){if(n??=new di([],{}),n.segments.length===0&&n.hasChildren())return Zy(n,e,t);let o=O8(n,e,t),a=t.slice(o.commandIndex);if(o.match&&o.pathIndex<n.segments.length){let s=new di(n.segments.slice(0,o.pathIndex),{});return s.children[vn]=new di(n.segments.slice(o.pathIndex),n.children),Zy(s,0,a)}else return o.match&&a.length===0?new di(n.segments,{}):o.match&&!n.hasChildren()?aS(n,e,t):o.match?Zy(n,0,a):aS(n,e,t)}function Zy(n,e,t){if(t.length===0)return new di(n.segments,{});{let o=L8(t),a={};if(Object.keys(o).some(s=>s!==vn)&&n.children[vn]&&n.numberOfChildren===1&&n.children[vn].segments.length===0){let s=Zy(n.children[vn],e,t);return new di(n.segments,s.children)}return Object.entries(o).forEach(([s,f])=>{typeof f=="string"&&(f=[f]),f!==null&&(a[s]=eN(n.children[s],e,f))}),Object.entries(n.children).forEach(([s,f])=>{o[s]===void 0&&(a[s]=f)}),new di(n.segments,a)}}function O8(n,e,t){let o=0,a=e,s={match:!1,pathIndex:0,commandIndex:0};for(;a<n.segments.length;){if(o>=t.length)return s;let f=n.segments[a],v=t[o];if(Xy(v))break;let w=`${v}`,D=o<t.length-1?t[o+1]:null;if(a>0&&w===void 0)break;if(w&&D&&typeof D=="object"&&D.outlets===void 0){if(!kF(w,D,f))return s;o+=2}else{if(!kF(w,{},f))return s;o++}a++}return{match:!0,pathIndex:a,commandIndex:o}}function aS(n,e,t){let o=n.segments.slice(0,e),a=0;for(;a<t.length;){let s=t[a];if(Xy(s)){let w=k8(s.outlets);return new di(o,w)}if(a===0&&Gb(t[0])){let w=n.segments[e];o.push(new ed(w.path,OF(t[0]))),a++;continue}let f=Xy(s)?s.outlets[vn]:`${s}`,v=a<t.length-1?t[a+1]:null;f&&v&&Gb(v)?(o.push(new ed(f,OF(v))),a+=2):(o.push(new ed(f,{})),a++)}return new di(o,{})}function k8(n){let e={};return Object.entries(n).forEach(([t,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(e[t]=aS(new di([],{}),0,o))}),e}function OF(n){let e={};return Object.entries(n).forEach(([t,o])=>e[t]=`${o}`),e}function kF(n,e,t){return n==t.path&&Lc(e,t.parameters)}var qy="imperative",Eo=(function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n})(Eo||{}),Sa=class{id;url;constructor(e,t){this.id=e,this.url=t}},jf=class extends Sa{type=Eo.NavigationStart;navigationTrigger;restoredState;constructor(e,t,o="imperative",a=null){super(e,t),this.navigationTrigger=o,this.restoredState=a}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Vu=class extends Sa{urlAfterRedirects;type=Eo.NavigationEnd;constructor(e,t,o){super(e,t),this.urlAfterRedirects=o}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},ys=(function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n[n.Aborted=4]="Aborted",n})(ys||{}),Yy=(function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n})(Yy||{}),Oc=class extends Sa{reason;code;type=Eo.NavigationCancel;constructor(e,t,o,a){super(e,t),this.reason=o,this.code=a}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Uu=class extends Sa{reason;code;type=Eo.NavigationSkipped;constructor(e,t,o,a){super(e,t),this.reason=o,this.code=a}},og=class extends Sa{error;target;type=Eo.NavigationError;constructor(e,t,o,a){super(e,t),this.error=o,this.target=a}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Ky=class extends Sa{urlAfterRedirects;state;type=Eo.RoutesRecognized;constructor(e,t,o,a){super(e,t),this.urlAfterRedirects=o,this.state=a}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Hb=class extends Sa{urlAfterRedirects;state;type=Eo.GuardsCheckStart;constructor(e,t,o,a){super(e,t),this.urlAfterRedirects=o,this.state=a}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Zb=class extends Sa{urlAfterRedirects;state;shouldActivate;type=Eo.GuardsCheckEnd;constructor(e,t,o,a,s){super(e,t),this.urlAfterRedirects=o,this.state=a,this.shouldActivate=s}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},qb=class extends Sa{urlAfterRedirects;state;type=Eo.ResolveStart;constructor(e,t,o,a){super(e,t),this.urlAfterRedirects=o,this.state=a}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Wb=class extends Sa{urlAfterRedirects;state;type=Eo.ResolveEnd;constructor(e,t,o,a){super(e,t),this.urlAfterRedirects=o,this.state=a}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Xb=class{route;type=Eo.RouteConfigLoadStart;constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},Yb=class{route;type=Eo.RouteConfigLoadEnd;constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Kb=class{snapshot;type=Eo.ChildActivationStart;constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Jb=class{snapshot;type=Eo.ChildActivationEnd;constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Qb=class{snapshot;type=Eo.ActivationStart;constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},ew=class{snapshot;type=Eo.ActivationEnd;constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var Jy=class{},sg=class{url;navigationBehaviorOptions;constructor(e,t){this.url=e,this.navigationBehaviorOptions=t}};function F8(n){return!(n instanceof Jy)&&!(n instanceof sg)}function N8(n,e){return n.providers&&!n._injector&&(n._injector=Dy(n.providers,e,`Route: ${n.path}`)),n._injector??e}function Fl(n){return n.outlet||vn}function z8(n,e){let t=n.filter(o=>Fl(o)===e);return t.push(...n.filter(o=>Fl(o)!==e)),t}function cg(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var tw=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return cg(this.route?.snapshot)??this.rootInjector}constructor(e){this.rootInjector=e,this.children=new ug(this.rootInjector)}},ug=(()=>{class n{rootInjector;contexts=new Map;constructor(t){this.rootInjector=t}onChildOutletCreated(t,o){let a=this.getOrCreateContext(t);a.outlet=o,this.contexts.set(t,a)}onChildOutletDestroyed(t){let o=this.getContext(t);o&&(o.outlet=null,o.attachRef=null)}onOutletDeactivated(){let t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let o=this.getContext(t);return o||(o=new tw(this.rootInjector),this.contexts.set(t,o)),o}getContext(t){return this.contexts.get(t)||null}static \u0275fac=function(o){return new(o||n)(an(Qr))};static \u0275prov=Ht({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),nw=class{_root;constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=lS(e,this._root);return t?t.children.map(o=>o.value):[]}firstChild(e){let t=lS(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=cS(e,this._root);return t.length<2?[]:t[t.length-2].children.map(a=>a.value).filter(a=>a!==e)}pathFromRoot(e){return cS(e,this._root).map(t=>t.value)}};function lS(n,e){if(n===e.value)return e;for(let t of e.children){let o=lS(n,t);if(o)return o}return null}function cS(n,e){if(n===e.value)return[e];for(let t of e.children){let o=cS(n,t);if(o.length)return o.unshift(e),o}return[]}var Ia=class{value;children;constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function tg(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var Qy=class extends nw{snapshot;constructor(e,t){super(e),this.snapshot=t,_S(this,e)}toString(){return this.snapshot.toString()}};function tN(n){let e=B8(n),t=new zo([new ed("",{})]),o=new zo({}),a=new zo({}),s=new zo({}),f=new zo(""),v=new Fc(t,o,s,f,a,vn,n,e.root);return v.snapshot=e.root,new Qy(new Ia(v,[]),e)}function B8(n){let e={},t={},o={},s=new Nf([],e,o,"",t,vn,n,null,{});return new ev("",new Ia(s,[]))}var Fc=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(e,t,o,a,s,f,v,w){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=o,this.fragmentSubject=a,this.dataSubject=s,this.outlet=f,this.component=v,this._futureSnapshot=w,this.title=this.dataSubject?.pipe(Fn(D=>D[rv]))??un(void 0),this.url=e,this.params=t,this.queryParams=o,this.fragment=a,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Fn(e=>zf(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Fn(e=>zf(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function iw(n,e,t="emptyOnly"){let o,{routeConfig:a}=n;return e!==null&&(t==="always"||a?.path===""||!e.component&&!e.routeConfig?.loadComponent)?o={params:St(St({},e.params),n.params),data:St(St({},e.data),n.data),resolve:St(St(St(St({},n.data),e.data),a?.data),n._resolvedData)}:o={params:St({},n.params),data:St({},n.data),resolve:St(St({},n.data),n._resolvedData??{})},a&&iN(a)&&(o.resolve[rv]=a.title),o}var Nf=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[rv]}constructor(e,t,o,a,s,f,v,w,D){this.url=e,this.params=t,this.queryParams=o,this.fragment=a,this.data=s,this.outlet=f,this.component=v,this.routeConfig=w,this._resolve=D}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=zf(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=zf(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(o=>o.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},ev=class extends nw{url;constructor(e,t){super(t),this.url=e,_S(this,t)}toString(){return nN(this._root)}};function _S(n,e){e.value._routerState=n,e.children.forEach(t=>_S(n,t))}function nN(n){let e=n.children.length>0?` { ${n.children.map(nN).join(", ")} } `:"";return`${n.value}${e}`}function tS(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,Lc(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),Lc(e.params,t.params)||n.paramsSubject.next(t.params),d8(e.url,t.url)||n.urlSubject.next(t.url),Lc(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function uS(n,e){let t=Lc(n.params,e.params)&&g8(n.url,e.url),o=!n.parent!=!e.parent;return t&&!o&&(!n.parent||uS(n.parent,e.parent))}function iN(n){return typeof n.title=="string"||n.title===null}var rN=new Wt(""),sv=(()=>{class n{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=vn;activateEvents=new _s;deactivateEvents=new _s;attachEvents=new _s;detachEvents=new _s;routerOutletData=Qk();parentContexts=tt(ug);location=tt(Gm);changeDetector=tt(zI);inputBinder=tt(aw,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(t){if(t.name){let{firstChange:o,previousValue:a}=t.name;if(o)return;this.isTrackedInParentContexts(a)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(a)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Nt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Nt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Nt(4012,!1);this.location.detach();let t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,o){this.activated=t,this._activatedRoute=o,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){let t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,o){if(this.isActivated)throw new Nt(4013,!1);this._activatedRoute=t;let a=this.location,f=t.snapshot.component,v=this.parentContexts.getOrCreateContext(this.name).children,w=new hS(t,v,a.injector,this.routerOutletData);this.activated=a.createComponent(f,{index:a.length,injector:w,environmentInjector:o}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(o){return new(o||n)};static \u0275dir=My({type:n,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[sb]})}return n})(),hS=class{route;childContexts;parent;outletData;constructor(e,t,o,a){this.route=e,this.childContexts=t,this.parent=o,this.outletData=a}get(e,t){return e===Fc?this.route:e===ug?this.childContexts:e===rN?this.outletData:this.parent.get(e,t)}},aw=new Wt("");var yS=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275cmp=eo({type:n,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(o,a){o&1&&xo(0,"router-outlet")},dependencies:[sv],encapsulation:2})}return n})();function vS(n){let e=n.children&&n.children.map(vS),t=e?Xn(St({},n),{children:e}):St({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==vn&&(t.component=yS),t}function j8(n,e,t){let o=tv(n,e._root,t?t._root:void 0);return new Qy(o,e)}function tv(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let o=t.value;o._futureSnapshot=e.value;let a=V8(n,e,t);return new Ia(o,a)}else{if(n.shouldAttach(e.value)){let s=n.retrieve(e.value);if(s!==null){let f=s.route;return f.value._futureSnapshot=e.value,f.children=e.children.map(v=>tv(n,v)),f}}let o=U8(e.value),a=e.children.map(s=>tv(n,s));return new Ia(o,a)}}function V8(n,e,t){return e.children.map(o=>{for(let a of t.children)if(n.shouldReuseRoute(o.value,a.value.snapshot))return tv(n,o,a);return tv(n,o)})}function U8(n){return new Fc(new zo(n.url),new zo(n.params),new zo(n.queryParams),new zo(n.fragment),new zo(n.data),n.outlet,n.component,n)}var ag=class{redirectTo;navigationBehaviorOptions;constructor(e,t){this.redirectTo=e,this.navigationBehaviorOptions=t}},oN="ngNavigationCancelingError";function rw(n,e){let{redirectTo:t,navigationBehaviorOptions:o}=rg(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,a=sN(!1,ys.Redirect);return a.url=t,a.navigationBehaviorOptions=o,a}function sN(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[oN]=!0,t.cancellationCode=e,t}function G8(n){return aN(n)&&rg(n.url)}function aN(n){return!!n&&n[oN]}var $8=(n,e,t,o)=>Fn(a=>(new dS(e,a.targetRouterState,a.currentRouterState,t,o).activate(n),a)),dS=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(e,t,o,a,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=o,this.forwardEvent=a,this.inputBindingEnabled=s}activate(e){let t=this.futureState._root,o=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,o,e),tS(this.futureState.root),this.activateChildRoutes(t,o,e)}deactivateChildRoutes(e,t,o){let a=tg(t);e.children.forEach(s=>{let f=s.value.outlet;this.deactivateRoutes(s,a[f],o),delete a[f]}),Object.values(a).forEach(s=>{this.deactivateRouteAndItsChildren(s,o)})}deactivateRoutes(e,t,o){let a=e.value,s=t?t.value:null;if(a===s)if(a.component){let f=o.getContext(a.outlet);f&&this.deactivateChildRoutes(e,t,f.children)}else this.deactivateChildRoutes(e,t,o);else s&&this.deactivateRouteAndItsChildren(t,o)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let o=t.getContext(e.value.outlet),a=o&&e.value.component?o.children:t,s=tg(e);for(let f of Object.values(s))this.deactivateRouteAndItsChildren(f,a);if(o&&o.outlet){let f=o.outlet.detach(),v=o.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:f,route:e,contexts:v})}}deactivateRouteAndOutlet(e,t){let o=t.getContext(e.value.outlet),a=o&&e.value.component?o.children:t,s=tg(e);for(let f of Object.values(s))this.deactivateRouteAndItsChildren(f,a);o&&(o.outlet&&(o.outlet.deactivate(),o.children.onOutletDeactivated()),o.attachRef=null,o.route=null)}activateChildRoutes(e,t,o){let a=tg(t);e.children.forEach(s=>{this.activateRoutes(s,a[s.value.outlet],o),this.forwardEvent(new ew(s.value.snapshot))}),e.children.length&&this.forwardEvent(new Jb(e.value.snapshot))}activateRoutes(e,t,o){let a=e.value,s=t?t.value:null;if(tS(a),a===s)if(a.component){let f=o.getOrCreateContext(a.outlet);this.activateChildRoutes(e,t,f.children)}else this.activateChildRoutes(e,t,o);else if(a.component){let f=o.getOrCreateContext(a.outlet);if(this.routeReuseStrategy.shouldAttach(a.snapshot)){let v=this.routeReuseStrategy.retrieve(a.snapshot);this.routeReuseStrategy.store(a.snapshot,null),f.children.onOutletReAttached(v.contexts),f.attachRef=v.componentRef,f.route=v.route.value,f.outlet&&f.outlet.attach(v.componentRef,v.route.value),tS(v.route.value),this.activateChildRoutes(e,null,f.children)}else f.attachRef=null,f.route=a,f.outlet&&f.outlet.activateWith(a,f.injector),this.activateChildRoutes(e,null,f.children)}else this.activateChildRoutes(e,null,o)}},ow=class{path;route;constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},ig=class{component;route;constructor(e,t){this.component=e,this.route=t}};function H8(n,e,t){let o=n._root,a=e?e._root:null;return Hy(o,a,t,[o.value])}function Z8(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function hg(n,e){let t=Symbol(),o=e.get(n,t);return o===t?typeof n=="function"&&!zT(n)?n:e.get(n):o}function Hy(n,e,t,o,a={canDeactivateChecks:[],canActivateChecks:[]}){let s=tg(e);return n.children.forEach(f=>{q8(f,s[f.value.outlet],t,o.concat([f.value]),a),delete s[f.value.outlet]}),Object.entries(s).forEach(([f,v])=>Wy(v,t.getContext(f),a)),a}function q8(n,e,t,o,a={canDeactivateChecks:[],canActivateChecks:[]}){let s=n.value,f=e?e.value:null,v=t?t.getContext(n.value.outlet):null;if(f&&s.routeConfig===f.routeConfig){let w=W8(f,s,s.routeConfig.runGuardsAndResolvers);w?a.canActivateChecks.push(new ow(o)):(s.data=f.data,s._resolvedData=f._resolvedData),s.component?Hy(n,e,v?v.children:null,o,a):Hy(n,e,t,o,a),w&&v&&v.outlet&&v.outlet.isActivated&&a.canDeactivateChecks.push(new ig(v.outlet.component,f))}else f&&Wy(e,v,a),a.canActivateChecks.push(new ow(o)),s.component?Hy(n,null,v?v.children:null,o,a):Hy(n,null,t,o,a);return a}function W8(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!Ff(n.url,e.url);case"pathParamsOrQueryParamsChange":return!Ff(n.url,e.url)||!Lc(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!uS(n,e)||!Lc(n.queryParams,e.queryParams);case"paramsChange":default:return!uS(n,e)}}function Wy(n,e,t){let o=tg(n),a=n.value;Object.entries(o).forEach(([s,f])=>{a.component?e?Wy(f,e.children.getContext(s),t):Wy(f,null,t):Wy(f,e,t)}),a.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new ig(e.outlet.component,a)):t.canDeactivateChecks.push(new ig(null,a)):t.canDeactivateChecks.push(new ig(null,a))}function av(n){return typeof n=="function"}function X8(n){return typeof n=="boolean"}function Y8(n){return n&&av(n.canLoad)}function K8(n){return n&&av(n.canActivate)}function J8(n){return n&&av(n.canActivateChild)}function Q8(n){return n&&av(n.canDeactivate)}function eH(n){return n&&av(n.canMatch)}function lN(n){return n instanceof Tu||n?.name==="EmptyError"}var Bb=Symbol("INITIAL_VALUE");function lg(){return es(n=>mx(n.map(e=>e.pipe(Cu(1),CT(Bb)))).pipe(Fn(e=>{for(let t of e)if(t!==!0){if(t===Bb)return Bb;if(t===!1||tH(t))return t}return!0}),Fs(e=>e!==Bb),Cu(1)))}function tH(n){return rg(n)||n instanceof ag}function nH(n,e){return Jr(t=>{let{targetSnapshot:o,currentSnapshot:a,guards:{canActivateChecks:s,canDeactivateChecks:f}}=t;return f.length===0&&s.length===0?un(Xn(St({},t),{guardsResult:!0})):iH(f,o,a,n).pipe(Jr(v=>v&&X8(v)?rH(o,s,n,e):un(v)),Fn(v=>Xn(St({},t),{guardsResult:v})))})}function iH(n,e,t,o){return Nr(n).pipe(Jr(a=>cH(a.component,a.route,t,e,o)),Iu(a=>a!==!0,!0))}function rH(n,e,t,o){return Nr(e).pipe(jh(a=>Cm(sH(a.route.parent,o),oH(a.route,o),lH(n,a.path,t),aH(n,a.route,t))),Iu(a=>a!==!0,!0))}function oH(n,e){return n!==null&&e&&e(new Qb(n)),un(!0)}function sH(n,e){return n!==null&&e&&e(new Kb(n)),un(!0)}function aH(n,e,t){let o=e.routeConfig?e.routeConfig.canActivate:null;if(!o||o.length===0)return un(!0);let a=o.map(s=>X_(()=>{let f=cg(e)??t,v=hg(s,f),w=K8(v)?v.canActivate(e,n):Bo(f,()=>v(e,n));return Gu(w).pipe(Iu())}));return un(a).pipe(lg())}function lH(n,e,t){let o=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(f=>Z8(f)).filter(f=>f!==null).map(f=>X_(()=>{let v=f.guards.map(w=>{let D=cg(f.node)??t,A=hg(w,D),z=J8(A)?A.canActivateChild(o,n):Bo(D,()=>A(o,n));return Gu(z).pipe(Iu())});return un(v).pipe(lg())}));return un(s).pipe(lg())}function cH(n,e,t,o,a){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return un(!0);let f=s.map(v=>{let w=cg(e)??a,D=hg(v,w),A=Q8(D)?D.canDeactivate(n,e,t,o):Bo(w,()=>D(n,e,t,o));return Gu(A).pipe(Iu())});return un(f).pipe(lg())}function uH(n,e,t,o){let a=e.canLoad;if(a===void 0||a.length===0)return un(!0);let s=a.map(f=>{let v=hg(f,n),w=Y8(v)?v.canLoad(e,t):Bo(n,()=>v(e,t));return Gu(w)});return un(s).pipe(lg(),cN(o))}function cN(n){return yT(_o(e=>{if(typeof e!="boolean")throw rw(n,e)}),Fn(e=>e===!0))}function hH(n,e,t,o){let a=e.canMatch;if(!a||a.length===0)return un(!0);let s=a.map(f=>{let v=hg(f,n),w=eH(v)?v.canMatch(e,t):Bo(n,()=>v(e,t));return Gu(w)});return un(s).pipe(lg(),cN(o))}var nv=class{segmentGroup;constructor(e){this.segmentGroup=e||null}},iv=class extends Error{urlTree;constructor(e){super(),this.urlTree=e}};function eg(n){return Tm(new nv(n))}function dH(n){return Tm(new Nt(4e3,!1))}function fH(n){return Tm(sN(!1,ys.GuardRejected))}var fS=class{urlSerializer;urlTree;constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let o=[],a=t.root;for(;;){if(o=o.concat(a.segments),a.numberOfChildren===0)return un(o);if(a.numberOfChildren>1||!a.children[vn])return dH(`${e.redirectTo}`);a=a.children[vn]}}applyRedirectCommands(e,t,o,a,s){return pH(t,a,s).pipe(Fn(f=>{if(f instanceof kc)throw new iv(f);let v=this.applyRedirectCreateUrlTree(f,this.urlSerializer.parse(f),e,o);if(f[0]==="/")throw new iv(v);return v}))}applyRedirectCreateUrlTree(e,t,o,a){let s=this.createSegmentGroup(e,t.root,o,a);return new kc(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let o={};return Object.entries(e).forEach(([a,s])=>{if(typeof s=="string"&&s[0]===":"){let v=s.substring(1);o[a]=t[v]}else o[a]=s}),o}createSegmentGroup(e,t,o,a){let s=this.createSegments(e,t.segments,o,a),f={};return Object.entries(t.children).forEach(([v,w])=>{f[v]=this.createSegmentGroup(e,w,o,a)}),new di(s,f)}createSegments(e,t,o,a){return t.map(s=>s.path[0]===":"?this.findPosParam(e,s,a):this.findOrReturn(s,o))}findPosParam(e,t,o){let a=o[t.path.substring(1)];if(!a)throw new Nt(4001,!1);return a}findOrReturn(e,t){let o=0;for(let a of t){if(a.path===e.path)return t.splice(o),a;o++}return e}};function pH(n,e,t){if(typeof n=="string")return un(n);let o=n,{queryParams:a,fragment:s,routeConfig:f,url:v,outlet:w,params:D,data:A,title:z}=e;return Gu(Bo(t,()=>o({params:D,data:A,queryParams:a,fragment:s,routeConfig:f,url:v,outlet:w,title:z})))}var pS={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function mH(n,e,t,o,a){let s=uN(n,e,t);return s.matched?(o=N8(e,o),hH(o,e,t,a).pipe(Fn(f=>f===!0?s:St({},pS)))):un(s)}function uN(n,e,t){if(e.path==="**")return gH(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?St({},pS):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let a=(e.matcher||BF)(t,n,e);if(!a)return St({},pS);let s={};Object.entries(a.posParams??{}).forEach(([v,w])=>{s[v]=w.path});let f=a.consumed.length>0?St(St({},s),a.consumed[a.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:a.consumed,remainingSegments:t.slice(a.consumed.length),parameters:f,positionalParamSegments:a.posParams??{}}}function gH(n){return{matched:!0,parameters:n.length>0?VF(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function FF(n,e,t,o){return t.length>0&&vH(n,t,o)?{segmentGroup:new di(e,yH(o,new di(t,n.children))),slicedSegments:[]}:t.length===0&&xH(n,t,o)?{segmentGroup:new di(n.segments,_H(n,t,o,n.children)),slicedSegments:t}:{segmentGroup:new di(n.segments,n.children),slicedSegments:t}}function _H(n,e,t,o){let a={};for(let s of t)if(lw(n,e,s)&&!o[Fl(s)]){let f=new di([],{});a[Fl(s)]=f}return St(St({},o),a)}function yH(n,e){let t={};t[vn]=e;for(let o of n)if(o.path===""&&Fl(o)!==vn){let a=new di([],{});t[Fl(o)]=a}return t}function vH(n,e,t){return t.some(o=>lw(n,e,o)&&Fl(o)!==vn)}function xH(n,e,t){return t.some(o=>lw(n,e,o))}function lw(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function bH(n,e,t){return e.length===0&&!n.children[t]}var mS=class{};function wH(n,e,t,o,a,s,f="emptyOnly"){return new gS(n,e,t,o,a,f,s).recognize()}var EH=31,gS=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(e,t,o,a,s,f,v){this.injector=e,this.configLoader=t,this.rootComponentType=o,this.config=a,this.urlTree=s,this.paramsInheritanceStrategy=f,this.urlSerializer=v,this.applyRedirects=new fS(this.urlSerializer,this.urlTree)}noMatchError(e){return new Nt(4002,`'${e.segmentGroup}'`)}recognize(){let e=FF(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(Fn(({children:t,rootSnapshot:o})=>{let a=new Ia(o,t),s=new ev("",a),f=YF(o,[],this.urlTree.queryParams,this.urlTree.fragment);return f.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(f),{state:s,tree:f}}))}match(e){let t=new Nf([],Object.freeze({}),Object.freeze(St({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),vn,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,e,vn,t).pipe(Fn(o=>({children:o,rootSnapshot:t})),Bh(o=>{if(o instanceof iv)return this.urlTree=o.urlTree,this.match(o.urlTree.root);throw o instanceof nv?this.noMatchError(o):o}))}processSegmentGroup(e,t,o,a,s){return o.segments.length===0&&o.hasChildren()?this.processChildren(e,t,o,s):this.processSegment(e,t,o,o.segments,a,!0,s).pipe(Fn(f=>f instanceof Ia?[f]:[]))}processChildren(e,t,o,a){let s=[];for(let f of Object.keys(o.children))f==="primary"?s.unshift(f):s.push(f);return Nr(s).pipe(jh(f=>{let v=o.children[f],w=z8(t,f);return this.processSegmentGroup(e,w,v,f,a)}),TT((f,v)=>(f.push(...v),f)),Vh(null),ET(),Jr(f=>{if(f===null)return eg(o);let v=hN(f);return TH(v),un(v)}))}processSegment(e,t,o,a,s,f,v){return Nr(t).pipe(jh(w=>this.processSegmentAgainstRoute(w._injector??e,t,w,o,a,s,f,v).pipe(Bh(D=>{if(D instanceof nv)return un(null);throw D}))),Iu(w=>!!w),Bh(w=>{if(lN(w))return bH(o,a,s)?un(new mS):eg(o);throw w}))}processSegmentAgainstRoute(e,t,o,a,s,f,v,w){return Fl(o)!==f&&(f===vn||!lw(a,s,o))?eg(a):o.redirectTo===void 0?this.matchSegmentAgainstRoute(e,a,o,s,f,w):this.allowRedirects&&v?this.expandSegmentAgainstRouteUsingRedirect(e,a,t,o,s,f,w):eg(a)}expandSegmentAgainstRouteUsingRedirect(e,t,o,a,s,f,v){let{matched:w,parameters:D,consumedSegments:A,positionalParamSegments:z,remainingSegments:H}=uN(t,a,s);if(!w)return eg(t);typeof a.redirectTo=="string"&&a.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>EH&&(this.allowRedirects=!1));let q=new Nf(s,D,Object.freeze(St({},this.urlTree.queryParams)),this.urlTree.fragment,NF(a),Fl(a),a.component??a._loadedComponent??null,a,zF(a)),W=iw(q,v,this.paramsInheritanceStrategy);return q.params=Object.freeze(W.params),q.data=Object.freeze(W.data),this.applyRedirects.applyRedirectCommands(A,a.redirectTo,z,q,e).pipe(es(ce=>this.applyRedirects.lineralizeSegments(a,ce)),Jr(ce=>this.processSegment(e,o,t,ce.concat(H),f,!1,v)))}matchSegmentAgainstRoute(e,t,o,a,s,f){let v=mH(t,o,a,e,this.urlSerializer);return o.path==="**"&&(t.children={}),v.pipe(es(w=>w.matched?(e=o._injector??e,this.getChildConfig(e,o,a).pipe(es(({routes:D})=>{let A=o._loadedInjector??e,{parameters:z,consumedSegments:H,remainingSegments:q}=w,W=new Nf(H,z,Object.freeze(St({},this.urlTree.queryParams)),this.urlTree.fragment,NF(o),Fl(o),o.component??o._loadedComponent??null,o,zF(o)),me=iw(W,f,this.paramsInheritanceStrategy);W.params=Object.freeze(me.params),W.data=Object.freeze(me.data);let{segmentGroup:ce,slicedSegments:ue}=FF(t,H,q,D);if(ue.length===0&&ce.hasChildren())return this.processChildren(A,D,ce,W).pipe(Fn(Ue=>new Ia(W,Ue)));if(D.length===0&&ue.length===0)return un(new Ia(W,[]));let Me=Fl(o)===s;return this.processSegment(A,D,ce,ue,Me?vn:s,!0,W).pipe(Fn(Ue=>new Ia(W,Ue instanceof Ia?[Ue]:[])))}))):eg(t)))}getChildConfig(e,t,o){return t.children?un({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?un({routes:t._loadedRoutes,injector:t._loadedInjector}):uH(e,t,o,this.urlSerializer).pipe(Jr(a=>a?this.configLoader.loadChildren(e,t).pipe(_o(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):fH(t))):un({routes:[],injector:e})}};function TH(n){n.sort((e,t)=>e.value.outlet===vn?-1:t.value.outlet===vn?1:e.value.outlet.localeCompare(t.value.outlet))}function CH(n){let e=n.value.routeConfig;return e&&e.path===""}function hN(n){let e=[],t=new Set;for(let o of n){if(!CH(o)){e.push(o);continue}let a=e.find(s=>o.value.routeConfig===s.value.routeConfig);a!==void 0?(a.children.push(...o.children),t.add(a)):e.push(o)}for(let o of t){let a=hN(o.children);e.push(new Ia(o.value,a))}return e.filter(o=>!t.has(o))}function NF(n){return n.data||{}}function zF(n){return n.resolve||{}}function IH(n,e,t,o,a,s){return Jr(f=>wH(n,e,t,o,f.extractedUrl,a,s).pipe(Fn(({state:v,tree:w})=>Xn(St({},f),{targetSnapshot:v,urlAfterRedirects:w}))))}function SH(n,e){return Jr(t=>{let{targetSnapshot:o,guards:{canActivateChecks:a}}=t;if(!a.length)return un(t);let s=new Set(a.map(w=>w.route)),f=new Set;for(let w of s)if(!f.has(w))for(let D of dN(w))f.add(D);let v=0;return Nr(f).pipe(jh(w=>s.has(w)?DH(w,o,n,e):(w.data=iw(w,w.parent,n).resolve,un(void 0))),_o(()=>v++),Im(1),Jr(w=>v===f.size?un(t):Os))})}function dN(n){let e=n.children.map(t=>dN(t)).flat();return[n,...e]}function DH(n,e,t,o){let a=n.routeConfig,s=n._resolve;return a?.title!==void 0&&!iN(a)&&(s[rv]=a.title),X_(()=>(n.data=iw(n,n.parent,t).resolve,MH(s,n,e,o).pipe(Fn(f=>(n._resolvedData=f,n.data=St(St({},n.data),f),null)))))}function MH(n,e,t,o){let a=rS(n);if(a.length===0)return un({});let s={};return Nr(a).pipe(Jr(f=>PH(n[f],e,t,o).pipe(Iu(),_o(v=>{if(v instanceof ag)throw rw(new Bf,v);s[f]=v}))),Im(1),Fn(()=>s),Bh(f=>lN(f)?Os:Tm(f)))}function PH(n,e,t,o){let a=cg(e)??o,s=hg(n,a),f=s.resolve?s.resolve(e,t):Bo(a,()=>s(e,t));return Gu(f)}function nS(n){return es(e=>{let t=n(e);return t?Nr(t).pipe(Fn(()=>e)):un(e)})}var xS=(()=>{class n{buildTitle(t){let o,a=t.root;for(;a!==void 0;)o=this.getResolvedTitleForRoute(a)??o,a=a.children.find(s=>s.outlet===vn);return o}getResolvedTitleForRoute(t){return t.data[rv]}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Ht({token:n,factory:()=>tt(fN),providedIn:"root"})}return n})(),fN=(()=>{class n extends xS{title;constructor(t){super(),this.title=t}updateTitle(t){let o=this.buildTitle(t);o!==void 0&&this.title.setTitle(o)}static \u0275fac=function(o){return new(o||n)(an(AF))};static \u0275prov=Ht({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),lv=new Wt("",{providedIn:"root",factory:()=>({})}),cv=new Wt(""),pN=(()=>{class n{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=tt(RI);loadComponent(t,o){if(this.componentLoaders.get(o))return this.componentLoaders.get(o);if(o._loadedComponent)return un(o._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(o);let a=Gu(Bo(t,()=>o.loadComponent())).pipe(Fn(gN),es(_N),_o(f=>{this.onLoadEndListener&&this.onLoadEndListener(o),o._loadedComponent=f}),cf(()=>{this.componentLoaders.delete(o)})),s=new Em(a,()=>new No).pipe(wm());return this.componentLoaders.set(o,s),s}loadChildren(t,o){if(this.childrenLoaders.get(o))return this.childrenLoaders.get(o);if(o._loadedRoutes)return un({routes:o._loadedRoutes,injector:o._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(o);let s=mN(o,this.compiler,t,this.onLoadEndListener).pipe(cf(()=>{this.childrenLoaders.delete(o)})),f=new Em(s,()=>new No).pipe(wm());return this.childrenLoaders.set(o,f),f}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Ht({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function mN(n,e,t,o){return Gu(Bo(t,()=>n.loadChildren())).pipe(Fn(gN),es(_N),Jr(a=>a instanceof bb||Array.isArray(a)?un(a):Nr(e.compileModuleAsync(a))),Fn(a=>{o&&o(n);let s,f,v=!1;return Array.isArray(a)?(f=a,v=!0):(s=a.create(t).injector,f=s.get(cv,[],{optional:!0,self:!0}).flat()),{routes:f.map(vS),injector:s}}))}function AH(n){return n&&typeof n=="object"&&"default"in n}function gN(n){return AH(n)?n.default:n}function _N(n){return un(n)}var cw=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275prov=Ht({token:n,factory:()=>tt(RH),providedIn:"root"})}return n})(),RH=(()=>{class n{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,o){return t}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Ht({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),yN=new Wt("");var vN=new Wt(""),xN=(()=>{class n{currentNavigation=Fi(null,{equal:()=>!1});currentTransition=null;lastSuccessfulNavigation=null;events=new No;transitionAbortWithErrorSubject=new No;configLoader=tt(pN);environmentInjector=tt(Qr);destroyRef=tt(Mc);urlSerializer=tt(ov);rootContexts=tt(ug);location=tt(Xm);inputBindingEnabled=tt(aw,{optional:!0})!==null;titleStrategy=tt(xS);options=tt(lv,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=tt(cw);createViewTransition=tt(yN,{optional:!0});navigationErrorHandler=tt(vN,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>un(void 0);rootComponentType=null;destroyed=!1;constructor(){let t=a=>this.events.next(new Xb(a)),o=a=>this.events.next(new Yb(a));this.configLoader.onLoadEndListener=o,this.configLoader.onLoadStartListener=t,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(t){let o=++this.navigationId;zu(()=>{this.transitions?.next(Xn(St({},t),{extractedUrl:this.urlHandlingStrategy.extract(t.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,abortController:new AbortController,id:o}))})}setupNavigations(t){return this.transitions=new zo(null),this.transitions.pipe(Fs(o=>o!==null),es(o=>{let a=!1;return un(o).pipe(es(s=>{if(this.navigationId>o.id)return this.cancelNavigationTransition(o,"",ys.SupersededByNewNavigation),Os;this.currentTransition=o,this.currentNavigation.set({id:s.id,initialUrl:s.rawUrl,extractedUrl:s.extractedUrl,targetBrowserUrl:typeof s.extras.browserUrl=="string"?this.urlSerializer.parse(s.extras.browserUrl):s.extras.browserUrl,trigger:s.source,extras:s.extras,previousNavigation:this.lastSuccessfulNavigation?Xn(St({},this.lastSuccessfulNavigation),{previousNavigation:null}):null,abort:()=>s.abortController.abort()});let f=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),v=s.extras.onSameUrlNavigation??t.onSameUrlNavigation;if(!f&&v!=="reload")return this.events.next(new Uu(s.id,this.urlSerializer.serialize(s.rawUrl),"",Yy.IgnoredSameUrlNavigation)),s.resolve(!1),Os;if(this.urlHandlingStrategy.shouldProcessUrl(s.rawUrl))return un(s).pipe(es(w=>(this.events.next(new jf(w.id,this.urlSerializer.serialize(w.extractedUrl),w.source,w.restoredState)),w.id!==this.navigationId?Os:Promise.resolve(w))),IH(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),_o(w=>{o.targetSnapshot=w.targetSnapshot,o.urlAfterRedirects=w.urlAfterRedirects,this.currentNavigation.update(A=>(A.finalUrl=w.urlAfterRedirects,A));let D=new Ky(w.id,this.urlSerializer.serialize(w.extractedUrl),this.urlSerializer.serialize(w.urlAfterRedirects),w.targetSnapshot);this.events.next(D)}));if(f&&this.urlHandlingStrategy.shouldProcessUrl(s.currentRawUrl)){let{id:w,extractedUrl:D,source:A,restoredState:z,extras:H}=s,q=new jf(w,this.urlSerializer.serialize(D),A,z);this.events.next(q);let W=tN(this.rootComponentType).snapshot;return this.currentTransition=o=Xn(St({},s),{targetSnapshot:W,urlAfterRedirects:D,extras:Xn(St({},H),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.update(me=>(me.finalUrl=D,me)),un(o)}else return this.events.next(new Uu(s.id,this.urlSerializer.serialize(s.extractedUrl),"",Yy.IgnoredByUrlHandlingStrategy)),s.resolve(!1),Os}),_o(s=>{let f=new Hb(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(f)}),Fn(s=>(this.currentTransition=o=Xn(St({},s),{guards:H8(s.targetSnapshot,s.currentSnapshot,this.rootContexts)}),o)),nH(this.environmentInjector,s=>this.events.next(s)),_o(s=>{if(o.guardsResult=s.guardsResult,s.guardsResult&&typeof s.guardsResult!="boolean")throw rw(this.urlSerializer,s.guardsResult);let f=new Zb(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot,!!s.guardsResult);this.events.next(f)}),Fs(s=>s.guardsResult?!0:(this.cancelNavigationTransition(s,"",ys.GuardRejected),!1)),nS(s=>{if(s.guards.canActivateChecks.length!==0)return un(s).pipe(_o(f=>{let v=new qb(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot);this.events.next(v)}),es(f=>{let v=!1;return un(f).pipe(SH(this.paramsInheritanceStrategy,this.environmentInjector),_o({next:()=>v=!0,complete:()=>{v||this.cancelNavigationTransition(f,"",ys.NoDataFromResolver)}}))}),_o(f=>{let v=new Wb(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot);this.events.next(v)}))}),nS(s=>{let f=v=>{let w=[];if(v.routeConfig?.loadComponent){let D=cg(v)??this.environmentInjector;w.push(this.configLoader.loadComponent(D,v.routeConfig).pipe(_o(A=>{v.component=A}),Fn(()=>{})))}for(let D of v.children)w.push(...f(D));return w};return mx(f(s.targetSnapshot.root)).pipe(Vh(null),Cu(1))}),nS(()=>this.afterPreactivation()),es(()=>{let{currentSnapshot:s,targetSnapshot:f}=o,v=this.createViewTransition?.(this.environmentInjector,s.root,f.root);return v?Nr(v).pipe(Fn(()=>o)):un(o)}),Fn(s=>{let f=j8(t.routeReuseStrategy,s.targetSnapshot,s.currentRouterState);return this.currentTransition=o=Xn(St({},s),{targetRouterState:f}),this.currentNavigation.update(v=>(v.targetRouterState=f,v)),o}),_o(()=>{this.events.next(new Jy)}),$8(this.rootContexts,t.routeReuseStrategy,s=>this.events.next(s),this.inputBindingEnabled),Cu(1),_x(new Yn(s=>{let f=o.abortController.signal,v=()=>s.next();return f.addEventListener("abort",v),()=>f.removeEventListener("abort",v)}).pipe(Fs(()=>!a&&!o.targetRouterState),_o(()=>{this.cancelNavigationTransition(o,o.abortController.signal.reason+"",ys.Aborted)}))),_o({next:s=>{a=!0,this.lastSuccessfulNavigation=zu(this.currentNavigation),this.events.next(new Vu(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects))),this.titleStrategy?.updateTitle(s.targetRouterState.snapshot),s.resolve(!0)},complete:()=>{a=!0}}),_x(this.transitionAbortWithErrorSubject.pipe(_o(s=>{throw s}))),cf(()=>{a||this.cancelNavigationTransition(o,"",ys.SupersededByNewNavigation),this.currentTransition?.id===o.id&&(this.currentNavigation.set(null),this.currentTransition=null)}),Bh(s=>{if(this.destroyed)return o.resolve(!1),Os;if(a=!0,aN(s))this.events.next(new Oc(o.id,this.urlSerializer.serialize(o.extractedUrl),s.message,s.cancellationCode)),G8(s)?this.events.next(new sg(s.url,s.navigationBehaviorOptions)):o.resolve(!1);else{let f=new og(o.id,this.urlSerializer.serialize(o.extractedUrl),s,o.targetSnapshot??void 0);try{let v=Bo(this.environmentInjector,()=>this.navigationErrorHandler?.(f));if(v instanceof ag){let{message:w,cancellationCode:D}=rw(this.urlSerializer,v);this.events.next(new Oc(o.id,this.urlSerializer.serialize(o.extractedUrl),w,D)),this.events.next(new sg(v.redirectTo,v.navigationBehaviorOptions))}else throw this.events.next(f),s}catch(v){this.options.resolveNavigationPromiseOnError?o.resolve(!1):o.reject(v)}}return Os}))}))}cancelNavigationTransition(t,o,a){let s=new Oc(t.id,this.urlSerializer.serialize(t.extractedUrl),o,a);this.events.next(s),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),o=zu(this.currentNavigation),a=o?.targetBrowserUrl??o?.extractedUrl;return t.toString()!==a?.toString()&&!o?.extras.skipLocationChange}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Ht({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function LH(n){return n!==qy}var bN=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275prov=Ht({token:n,factory:()=>tt(OH),providedIn:"root"})}return n})(),sw=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},OH=(()=>{class n extends sw{static \u0275fac=(()=>{let t;return function(a){return(t||(t=lb(n)))(a||n)}})();static \u0275prov=Ht({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),wN=(()=>{class n{urlSerializer=tt(ov);options=tt(lv,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=tt(Xm);urlHandlingStrategy=tt(cw);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new kc;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:t,initialUrl:o,targetBrowserUrl:a}){let s=t!==void 0?this.urlHandlingStrategy.merge(t,o):o,f=a??s;return f instanceof kc?this.urlSerializer.serialize(f):f}commitTransition({targetRouterState:t,finalUrl:o,initialUrl:a}){o&&t?(this.currentUrlTree=o,this.rawUrlTree=this.urlHandlingStrategy.merge(o,a),this.routerState=t):this.rawUrlTree=a}routerState=tN(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:t}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t??this.rawUrlTree)}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Ht({token:n,factory:()=>tt(kH),providedIn:"root"})}return n})(),kH=(()=>{class n extends wN{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(o=>{o.type==="popstate"&&setTimeout(()=>{t(o.url,o.state,"popstate")})})}handleRouterEvent(t,o){t instanceof jf?this.updateStateMemento():t instanceof Uu?this.commitTransition(o):t instanceof Ky?this.urlUpdateStrategy==="eager"&&(o.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(o),o)):t instanceof Jy?(this.commitTransition(o),this.urlUpdateStrategy==="deferred"&&!o.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(o),o)):t instanceof Oc&&t.code!==ys.SupersededByNewNavigation&&t.code!==ys.Redirect?this.restoreHistory(o):t instanceof og?this.restoreHistory(o,!0):t instanceof Vu&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,{extras:o,id:a}){let{replaceUrl:s,state:f}=o;if(this.location.isCurrentPathEqualTo(t)||s){let v=this.browserPageId,w=St(St({},f),this.generateNgRouterState(a,v));this.location.replaceState(t,"",w)}else{let v=St(St({},f),this.generateNgRouterState(a,this.browserPageId+1));this.location.go(t,"",v)}}restoreHistory(t,o=!1){if(this.canceledNavigationResolution==="computed"){let a=this.browserPageId,s=this.currentPageId-a;s!==0?this.location.historyGo(s):this.getCurrentUrlTree()===t.finalUrl&&s===0&&(this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(o&&this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,o){return this.canceledNavigationResolution==="computed"?{navigationId:t,\u0275routerPageId:o}:{navigationId:t}}static \u0275fac=(()=>{let t;return function(a){return(t||(t=lb(n)))(a||n)}})();static \u0275prov=Ht({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function bS(n,e){n.events.pipe(Fs(t=>t instanceof Vu||t instanceof Oc||t instanceof og||t instanceof Uu),Fn(t=>t instanceof Vu||t instanceof Uu?0:(t instanceof Oc?t.code===ys.Redirect||t.code===ys.SupersededByNewNavigation:!1)?2:1),Fs(t=>t!==2),Cu(1)).subscribe(()=>{e()})}var FH={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},NH={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},dg=(()=>{class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=tt(TI);stateManager=tt(wN);options=tt(lv,{optional:!0})||{};pendingTasks=tt(Pc);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=tt(xN);urlSerializer=tt(ov);location=tt(Xm);urlHandlingStrategy=tt(cw);injector=tt(Qr);_events=new No;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=tt(bN);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=tt(cv,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!tt(aw,{optional:!0});currentNavigation=this.navigationTransitions.currentNavigation.asReadonly();constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Fr;subscribeToNavigationEvents(){let t=this.navigationTransitions.events.subscribe(o=>{try{let a=this.navigationTransitions.currentTransition,s=zu(this.navigationTransitions.currentNavigation);if(a!==null&&s!==null){if(this.stateManager.handleRouterEvent(o,s),o instanceof Oc&&o.code!==ys.Redirect&&o.code!==ys.SupersededByNewNavigation)this.navigated=!0;else if(o instanceof Vu)this.navigated=!0;else if(o instanceof sg){let f=o.navigationBehaviorOptions,v=this.urlHandlingStrategy.merge(o.url,a.currentRawUrl),w=St({browserUrl:a.extras.browserUrl,info:a.extras.info,skipLocationChange:a.extras.skipLocationChange,replaceUrl:a.extras.replaceUrl||this.urlUpdateStrategy==="eager"||LH(a.source)},f);this.scheduleNavigation(v,qy,null,w,{resolve:a.resolve,reject:a.reject,promise:a.promise})}}F8(o)&&this._events.next(o)}catch(a){this.navigationTransitions.transitionAbortWithErrorSubject.next(a)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),qy,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,o,a)=>{this.navigateToSyncWithBrowser(t,a,o)})}navigateToSyncWithBrowser(t,o,a){let s={replaceUrl:!0},f=a?.navigationId?a:null;if(a){let w=St({},a);delete w.navigationId,delete w.\u0275routerPageId,Object.keys(w).length!==0&&(s.state=w)}let v=this.parseUrl(t);this.scheduleNavigation(v,o,f,s).catch(w=>{this.disposed||this.injector.get(Vs)(w)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return zu(this.navigationTransitions.currentNavigation)}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(vS),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,o={}){let{relativeTo:a,queryParams:s,fragment:f,queryParamsHandling:v,preserveFragment:w}=o,D=w?this.currentUrlTree.fragment:f,A=null;switch(v??this.options.defaultQueryParamsHandling){case"merge":A=St(St({},this.currentUrlTree.queryParams),s);break;case"preserve":A=this.currentUrlTree.queryParams;break;default:A=s||null}A!==null&&(A=this.removeEmptyProps(A));let z;try{let H=a?a.snapshot:this.routerState.snapshot.root;z=KF(H)}catch{(typeof t[0]!="string"||t[0][0]!=="/")&&(t=[]),z=this.currentUrlTree.root}return JF(z,t,A,D??null)}navigateByUrl(t,o={skipLocationChange:!1}){let a=rg(t)?t:this.parseUrl(t),s=this.urlHandlingStrategy.merge(a,this.rawUrlTree);return this.scheduleNavigation(s,qy,null,o)}navigate(t,o={skipLocationChange:!1}){return zH(t),this.navigateByUrl(this.createUrlTree(t,o),o)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.console.warn(Gh(4018,!1)),this.urlSerializer.parse("/")}}isActive(t,o){let a;if(o===!0?a=St({},FH):o===!1?a=St({},NH):a=o,rg(t))return RF(this.currentUrlTree,t,a);let s=this.parseUrl(t);return RF(this.currentUrlTree,s,a)}removeEmptyProps(t){return Object.entries(t).reduce((o,[a,s])=>(s!=null&&(o[a]=s),o),{})}scheduleNavigation(t,o,a,s,f){if(this.disposed)return Promise.resolve(!1);let v,w,D;f?(v=f.resolve,w=f.reject,D=f.promise):D=new Promise((z,H)=>{v=z,w=H});let A=this.pendingTasks.add();return bS(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(A))}),this.navigationTransitions.handleNavigationRequest({source:o,restoredState:a,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:s,resolve:v,reject:w,promise:D,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),D.catch(z=>Promise.reject(z))}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Ht({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function zH(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new Nt(4008,!1)}var jH=new Wt("");function wS(n,...e){return Pu([{provide:cv,multi:!0,useValue:n},[],{provide:Fc,useFactory:VH,deps:[dg]},{provide:wb,multi:!0,useFactory:UH},e.map(t=>t.\u0275providers)])}function VH(n){return n.routerState.root}function UH(){let n=tt(Wa);return e=>{let t=n.get(Rf);if(e!==t.components[0])return;let o=n.get(dg),a=n.get(GH);n.get($H)===1&&o.initialNavigation(),n.get(HH,null,{optional:!0})?.setUpPreloading(),n.get(jH,null,{optional:!0})?.init(),o.resetRootComponentType(t.componentTypes[0]),a.closed||(a.next(),a.complete(),a.unsubscribe())}}var GH=new Wt("",{factory:()=>new No}),$H=new Wt("",{providedIn:"root",factory:()=>1});var HH=new Wt("");var EN=[];var TN={providers:[bC(),OI({eventCoalescing:!0}),wS(EN),JI()]};var Vf={production:!1,geoserverUrl:"https://geoserver.citiwattsdev.hevs.ch",mapTilerApiKey:"get_your_own_OpIi9ZULNHzrESv6T2vL"};var Qa=class n{constructor(e){this.http=e;Ry(()=>{let t=this.layers();this.mapProvider&&t.forEach(o=>{o.enabled&&!o.isActive?this.addLayerToMap(o):!o.enabled&&o.isActive&&this.removeLayerFromMap(o)})})}gsApiUrl=`${Vf.geoserverUrl}/geoserver/wms?request=GetCapabilities&service=WMS&version=1.3.0`;mapProvider;layers=Fi([]);setMapProvider(e){this.mapProvider=e;let t=this.layers();if(t.length>0){let o=t.map(a=>Xn(St({},a),{isActive:!1,enabled:!1}));this.layers.set(o)}}getMapProvider(){return this.mapProvider}fetchLayers(){this.http.get(this.gsApiUrl,{responseType:"text"}).subscribe({next:e=>{let t=this.parseWMSCapabilities(e);this.layers.set(t)},error:e=>{console.error("Error fetching layers:",e),this.layers.set([])}})}parseWMSCapabilities(e){let o=new DOMParser().parseFromString(e,"text/xml"),a=new Map,s=o.getElementsByTagName("Layer");for(let f=0;f<s.length;f++){let v=s[f],w=Array.from(v.children),D=w.find(W=>W.tagName==="Name");if(!D||!D.textContent)continue;let A=D.textContent;if(a.has(A))continue;let z=w.find(W=>W.tagName==="Title"),H=w.find(W=>W.tagName==="Abstract"),q=this.detectLayerType(v);a.set(A,{name:A,title:z?.textContent||A,abstract:H?.textContent||"",enabled:!1,type:q,isActive:!1})}return Array.from(a.values())}detectLayerType(e){let t=e.getElementsByTagName("Keyword");for(let s=0;s<t.length;s++)if(t[s].textContent==="features")return"vector";let o=e.getElementsByTagName("Style");for(let s=0;s<o.length;s++){let f=o[s].getElementsByTagName("Name")[0]?.textContent?.toLowerCase();if(f&&(f.includes("point")||f.includes("line")||f.includes("polygon")||f==="generic"))return"vector"}let a=e.getElementsByTagName("LegendURL")[0];if(a){let s=parseInt(a.getAttribute("width")||"0");if(parseInt(a.getAttribute("height")||"0")>100)return"raster"}return"unknown"}toggleLayer(e){let o=[...this.layers()];o[e]=Xn(St({},o[e]),{enabled:!o[e].enabled}),this.layers.set(o)}addLayerToMap(e){this.mapProvider&&(e.name.toLowerCase().includes("pantagruel")?this.addGeoJsonLayer(e):(this.mapProvider.addWMSLayer(e.name,{url:`${Vf.geoserverUrl}/geoserver/wms`,layers:e.name,format:"image/png",transparent:!0,version:"1.3.0",attribution:e.title}),this.updateLayerStatus(e.name,!0)))}removeLayerFromMap(e){this.mapProvider&&(e.name.toLowerCase().includes("pantagruel")?this.mapProvider.removeGeoJSONLayer(e.name):this.mapProvider.removeWMSLayer(e.name),this.updateLayerStatus(e.name,!1))}updateLayerStatus(e,t){let o=this.layers(),a=o.findIndex(s=>s.name===e);if(a!==-1){let s=[...o];s[a]=Xn(St({},s[a]),{isActive:t}),this.layers.set(s)}}addGeoJsonLayer(e){if(!this.mapProvider)return;let[t,o]=e.name.includes(":")?e.name.split(":"):["",e.name],a=`${Vf.geoserverUrl}/geoserver/wfs?service=WFS&version=2.0.0&request=GetFeature&typeName=${e.name}&outputFormat=application/json`;this.http.get(a).subscribe({next:s=>{this.mapProvider&&(this.mapProvider.addGeoJSONLayer(e.name,s,{style:()=>({color:"#3388ff",weight:2,opacity:.8,fillOpacity:.4}),onEachFeature:(f,v)=>{if(f.properties){let w=Object.entries(f.properties).map(([D,A])=>`<strong>${D}:</strong> ${A}`).join("<br>");console.log("Feature clicked:",w)}}}),this.updateLayerStatus(e.name,!0))},error:s=>{console.error(`Error fetching GeoJSON for layer ${e.name}:`,s)}})}static \u0275fac=function(t){return new(t||n)(an(Nb))};static \u0275prov=Ht({token:n,factory:n.\u0275fac,providedIn:"root"})};var Uf=l2(IN()),Gf=class{map;layers=new Map;initialize(e,t,o){this.map=Uf.map(e,{center:t,zoom:o}),Uf.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan"}).addTo(this.map)}destroy(){this.map&&(this.map.remove(),this.map=void 0),this.layers.clear()}addWMSLayer(e,t){if(!this.map)return;let o=Uf.tileLayer.wms(t.url,{layers:t.layers,format:t.format||"image/png",transparent:t.transparent!==!1,version:t.version||"1.3.0",attribution:t.attribution||""});o.addTo(this.map),this.layers.set(e,o)}removeWMSLayer(e){let t=this.layers.get(e);t&&this.map&&(this.map.removeLayer(t),this.layers.delete(e))}addGeoJSONLayer(e,t,o){if(!this.map)return;let a=Uf.geoJSON(t,{style:o?.style||(()=>({color:"#3388ff",weight:2,opacity:.8,fillOpacity:.4})),onEachFeature:o?.onEachFeature});a.addTo(this.map),this.layers.set(e,a)}removeGeoJSONLayer(e){let t=this.layers.get(e);t&&this.map&&(this.map.removeLayer(t),this.layers.delete(e))}setView(e,t){this.map&&this.map.setView(e,t)}getMapInstance(){return this.map}};var MN=l2(DN()),fg=class{map;layers=new Map;initialize(e,t,o){this.map=new MN.default.Map({container:e,style:{version:8,sources:{"satellite-tiles":{type:"raster",tiles:["https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"Tiles \xA9 Esri \u2014 Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan"}},layers:[{id:"satellite-tiles-layer",type:"raster",source:"satellite-tiles",minzoom:0,maxzoom:19}]},center:[t[1],t[0]],zoom:o})}destroy(){this.map&&(this.map.remove(),this.map=void 0),this.layers.clear()}addWMSLayer(e,t){if(!this.map)return;let o=`${e}-source`,a=`${e}-layer`,f=`${t.url}?SERVICE=WMS&VERSION=${t.version||"1.3.0"}&REQUEST=GetMap&LAYERS=${t.layers}&BBOX={bbox-epsg-3857}&WIDTH=256&HEIGHT=256&FORMAT=${t.format||"image/png"}&TRANSPARENT=${t.transparent!==!1}&CRS=EPSG:3857`;this.map.addSource(o,{type:"raster",tiles:[f],tileSize:256}),this.map.addLayer({id:a,type:"raster",source:o}),this.layers.set(e,a)}removeWMSLayer(e){let t=this.layers.get(e);if(t&&this.map){let o=`${e}-source`;this.map.getLayer(t)&&this.map.removeLayer(t),this.map.getSource(o)&&this.map.removeSource(o),this.layers.delete(e)}}addGeoJSONLayer(e,t,o){if(!this.map)return;let a=`${e}-source`,s=`${e}-layer`;this.map.addSource(a,{type:"geojson",data:t});let v=t.features?.[0]?.geometry?.type;v==="Point"||v==="MultiPoint"?this.map.addLayer({id:s,type:"circle",source:a,paint:{"circle-radius":6,"circle-color":"#3388ff","circle-opacity":.8}}):v==="LineString"||v==="MultiLineString"?this.map.addLayer({id:s,type:"line",source:a,paint:{"line-color":"#3388ff","line-width":2,"line-opacity":.8}}):(this.map.addLayer({id:s,type:"fill",source:a,paint:{"fill-color":"#3388ff","fill-opacity":.4}}),this.map.addLayer({id:`${s}-outline`,type:"line",source:a,paint:{"line-color":"#3388ff","line-width":2,"line-opacity":.8}})),this.layers.set(e,s),o?.onEachFeature&&this.map.on("click",s,w=>{if(w.features&&w.features.length>0){let D=w.features[0];o.onEachFeature(D,null)}})}removeGeoJSONLayer(e){let t=this.layers.get(e);if(t&&this.map){let o=`${e}-source`;this.map.getLayer(t)&&this.map.removeLayer(t);let a=`${t}-outline`;this.map.getLayer(a)&&this.map.removeLayer(a),this.map.getSource(o)&&this.map.removeSource(o),this.layers.delete(e)}}setView(e,t){this.map&&(this.map.setCenter([e[1],e[0]]),this.map.setZoom(t))}getMapInstance(){return this.map}};var To={ADD:"add",REMOVE:"remove"};var Nl={PROPERTYCHANGE:"propertychange"};var Ft={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};var CS=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}},td=CS;function PN(n,e,t){let o,a;t=t||Gs;let s=0,f=n.length,v=!1;for(;s<f;)o=s+(f-s>>1),a=+t(n[o],e),a<0?s=o+1:(f=o,v=!a);return v?s:~s}function Gs(n,e){return n>e?1:n<e?-1:0}function AN(n,e){return n<e?1:n>e?-1:0}function pg(n,e,t){if(n[0]<=e)return 0;let o=n.length;if(e<=n[o-1])return o-1;if(typeof t=="function"){for(let a=1;a<o;++a){let s=n[a];if(s===e)return a;if(s<e)return t(e,n[a-1],s)>0?a-1:a}return o-1}if(t>0){for(let a=1;a<o;++a)if(n[a]<e)return a-1;return o-1}if(t<0){for(let a=1;a<o;++a)if(n[a]<=e)return a;return o-1}for(let a=1;a<o;++a){if(n[a]==e)return a;if(n[a]<e)return n[a-1]-e<e-n[a]?a-1:a}return o-1}function RN(n,e,t){for(;e<t;){let o=n[e];n[e]=n[t],n[t]=o,++e,--t}}function jo(n,e){let t=Array.isArray(e)?e:[e],o=t.length;for(let a=0;a<o;a++)n[n.length]=t[a]}function is(n,e){let t=n.length;if(t!==e.length)return!1;for(let o=0;o<t;o++)if(n[o]!==e[o])return!1;return!0}function LN(n,e,t){let o=e||Gs;return n.every(function(a,s){if(s===0)return!0;let f=o(n[s-1],a);return!(f>0||t&&f===0)})}function $u(){return!0}function Hu(){return!1}function Zu(){}function hw(n){let e,t,o;return function(){let a=Array.prototype.slice.call(arguments);return(!t||this!==o||!is(a,t))&&(o=this,t=a,e=n.apply(this,arguments)),e}}function ON(n){function e(){let t;try{t=n()}catch(o){return Promise.reject(o)}return t instanceof Promise?t:Promise.resolve(t)}return e()}function Nc(n){for(let e in n)delete n[e]}function Da(n){let e;for(e in n)return!1;return!e}var IS=class{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}};var Co=IS;var SS=class extends td{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;let o=this.listeners_||(this.listeners_={}),a=o[e]||(o[e]=[]);a.includes(t)||a.push(t)}dispatchEvent(e){let t=typeof e=="string",o=t?e:e.type,a=this.listeners_&&this.listeners_[o];if(!a)return;let s=t?new Co(e):e;s.target||(s.target=this.eventTarget_||this);let f=this.dispatching_||(this.dispatching_={}),v=this.pendingRemovals_||(this.pendingRemovals_={});o in f||(f[o]=0,v[o]=0),++f[o];let w;for(let D=0,A=a.length;D<A;++D)if("handleEvent"in a[D]?w=a[D].handleEvent(s):w=a[D].call(this,s),w===!1||s.propagationStopped){w=!1;break}if(--f[o]===0){let D=v[o];for(delete v[o];D--;)this.removeEventListener(o,Zu);delete f[o]}return w}disposeInternal(){this.listeners_&&Nc(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){if(!this.listeners_)return;let o=this.listeners_[e];if(!o)return;let a=o.indexOf(t);a!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(o[a]=Zu,++this.pendingRemovals_[e]):(o.splice(a,1),o.length===0&&delete this.listeners_[e]))}},nd=SS;function xn(n,e,t,o,a){if(a){let f=t;t=function(v){return n.removeEventListener(e,t),f.call(o??this,v)}}else o&&o!==n&&(t=t.bind(o));let s={target:n,type:e,listener:t};return n.addEventListener(e,t),s}function mg(n,e,t,o){return xn(n,e,t,o,!0)}function Gn(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),Nc(n))}var gg=class extends nd{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(Ft.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){let o=e.length,a=new Array(o);for(let s=0;s<o;++s)a[s]=xn(this,e[s],t);return a}return xn(this,e,t)}onceInternal(e,t){let o;if(Array.isArray(e)){let a=e.length;o=new Array(a);for(let s=0;s<a;++s)o[s]=mg(this,e[s],t)}else o=mg(this,e,t);return t.ol_key=o,o}unInternal(e,t){let o=t.ol_key;if(o)qH(o);else if(Array.isArray(e))for(let a=0,s=e.length;a<s;++a)this.removeEventListener(e[a],t);else this.removeEventListener(e,t)}};gg.prototype.on;gg.prototype.once;gg.prototype.un;function qH(n){if(Array.isArray(n))for(let e=0,t=n.length;e<t;++e)Gn(n[e]);else Gn(n)}var dw=gg;function Xt(){throw new Error("Unimplemented abstract method.")}var WH=0;function dn(n){return n.ol_uid||(n.ol_uid=String(++WH))}var fw=class extends Co{constructor(e,t,o){super(e),this.key=t,this.oldValue=o}},DS=class extends dw{constructor(e){super(),this.on,this.once,this.un,dn(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let o;o=`change:${e}`,this.hasListener(o)&&this.dispatchEvent(new fw(o,e,t)),o=Nl.PROPERTYCHANGE,this.hasListener(o)&&this.dispatchEvent(new fw(o,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,o){let a=this.values_||(this.values_={});if(o)a[e]=t;else{let s=a[e];a[e]=t,s!==t&&this.notify(e,s)}}setProperties(e,t){for(let o in e)this.set(o,e[o],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){let o=this.values_[e];delete this.values_[e],Da(this.values_)&&(this.values_=null),t||this.notify(e,o)}}},Ur=DS;var kN={LENGTH:"length"},_g=class extends Co{constructor(e,t,o){super(e),this.element=t,this.index=o}},MS=class extends Ur{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e??[],this.unique_)for(let o=1,a=this.array_.length;o<a;++o)this.assertUnique_(this.array_[o],o);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,o=e.length;t<o;++t)this.push(e[t]);return this}forEach(e){let t=this.array_;for(let o=0,a=t.length;o<a;++o)e(t[o],o,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(kN.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new _g(To.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){let t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){let t=this.array_;for(let o=0,a=t.length;o<a;++o)if(t[o]===e)return this.removeAt(o)}removeAt(e){if(e<0||e>=this.getLength())return;let t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new _g(To.REMOVE,t,e)),t}setAt(e,t){let o=this.getLength();if(e>=o){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);let a=this.array_[e];this.array_[e]=t,this.dispatchEvent(new _g(To.REMOVE,a,e)),this.dispatchEvent(new _g(To.ADD,t,e))}updateLength_(){this.set(kN.LENGTH,this.array_.length)}assertUnique_(e,t){let o=this.array_;for(let a=0,s=o.length;a<s;++a)if(o[a]===e&&a!==t)throw new Error("Duplicate item added to a unique collection")}},Vo=MS;var PS=class extends Co{constructor(e,t,o){super(e),this.map=t,this.frameState=o!==void 0?o:null}},id=PS;var AS=class extends id{constructor(e,t,o,a,s,f){super(e,t,s),this.originalEvent=o,this.pixel_=null,this.coordinate_=null,this.dragging=a!==void 0?a:!1,this.activePointers=f}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}},zc=AS;var $i={SINGLECLICK:"singleclick",CLICK:Ft.CLICK,DBLCLICK:Ft.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var $f=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",XH=$f.includes("safari")&&!$f.includes("chrom"),kde=XH&&($f.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test($f)),FN=$f.includes("webkit")&&!$f.includes("edge"),RS=$f.includes("macintosh"),NN=typeof devicePixelRatio<"u"?devicePixelRatio:1,to=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,LS=typeof Image<"u"&&Image.prototype.decode;var pw=(function(){let n=!1;try{let e=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return n})();var uv={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var OS=class extends nd{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;let o=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=o,this.pointerdownListenerKey_=xn(o,uv.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=xn(o,uv.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(Ft.TOUCHMOVE,this.boundHandleTouchMove_,pw?{passive:!1}:!1)}emulateClick_(e){let t=new zc($i.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new zc($i.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;let o=new zc($i.SINGLECLICK,this.map_,e);this.dispatchEvent(o)},250)}updateActivePointers_(e){let t=e,o=t.pointerId;if(t.type==$i.POINTERUP||t.type==$i.POINTERCANCEL){delete this.trackedTouches_[o];for(let a in this.trackedTouches_)if(this.trackedTouches_[a].target!==t.target){delete this.trackedTouches_[a];break}}else(t.type==$i.POINTERDOWN||t.type==$i.POINTERMOVE)&&(this.trackedTouches_[o]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);let t=new zc($i.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(Gn),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);let t=new zc($i.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){let o=this.map_.getOwnerDocument();this.dragListenerKeys_.push(xn(o,$i.POINTERMOVE,this.handlePointerMove_,this),xn(o,$i.POINTERUP,this.handlePointerUp_,this),xn(this.element_,$i.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==o&&this.dragListenerKeys_.push(xn(this.element_.getRootNode(),$i.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;let t=new zc($i.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;let t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new zc($i.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){let t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Gn(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(Ft.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Gn(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Gn),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},zN=OS;var Bc={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"};var Uo={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"};var jt={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Cn(n,e){if(!n)throw new Error(e)}var hv=1/0,kS=class{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Nc(this.queuedElements_)}dequeue(){let e=this.elements_,t=this.priorities_,o=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));let a=this.keyFunction_(o);return delete this.queuedElements_[a],o}enqueue(e){Cn(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");let t=this.priorityFunction_(e);return t!=hv?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){let t=this.elements_,o=this.priorities_,a=t.length,s=t[e],f=o[e],v=e;for(;e<a>>1;){let w=this.getLeftChildIndex_(e),D=this.getRightChildIndex_(e),A=D<a&&o[D]<o[w]?D:w;t[e]=t[A],o[e]=o[A],e=A}t[e]=s,o[e]=f,this.siftDown_(v,e)}siftDown_(e,t){let o=this.elements_,a=this.priorities_,s=o[t],f=a[t];for(;t>e;){let v=this.getParentIndex_(t);if(a[v]>f)o[t]=o[v],a[t]=a[v],t=v;else break}o[t]=s,a[t]=f}reprioritize(){let e=this.priorityFunction_,t=this.elements_,o=this.priorities_,a=0,s=t.length,f,v,w;for(v=0;v<s;++v)f=t[v],w=e(f),w==hv?delete this.queuedElements_[this.keyFunction_(f)]:(o[a]=w,t[a++]=f);t.length=a,o.length=a,this.heapify_()}},BN=kS;var FS=class extends BN{constructor(e,t){super(o=>e.apply(null,o),o=>o[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){let t=super.enqueue(e);return t&&e[0].addEventListener(Ft.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){let t=e.target,o=t.getState();if(o===jt.LOADED||o===jt.ERROR||o===jt.EMPTY){o!==jt.ERROR&&t.removeEventListener(Ft.CHANGE,this.boundHandleTileChange_);let a=t.getKey();a in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[a],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let o=0;for(;this.tilesLoading_<e&&o<t&&this.getCount()>0;){let a=this.dequeue()[0],s=a.getKey();a.getState()===jt.IDLE&&!(s in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[s]=!0,++this.tilesLoading_,++o,a.load())}}},jN=FS;function VN(n,e,t,o,a){if(!n||!(t in n.wantedTiles))return hv;if(!n.wantedTiles[t][e.getKey()])return hv;let s=n.viewState.center,f=o[0]-s[0],v=o[1]-s[1];return 65536*Math.log(a)+Math.sqrt(f*f+v*v)/a}var no={ANIMATING:0,INTERACTING:1};var el={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function ci(n,e,t){return Math.min(Math.max(n,e),t)}function UN(n,e,t,o,a,s){let f=a-t,v=s-o;if(f!==0||v!==0){let w=((n-t)*f+(e-o)*v)/(f*f+v*v);w>1?(t=a,o=s):w>0&&(t+=f*w,o+=v*w)}return zl(n,e,t,o)}function zl(n,e,t,o){let a=t-n,s=o-e;return a*a+s*s}function GN(n){let e=n.length;for(let o=0;o<e;o++){let a=o,s=Math.abs(n[o][o]);for(let v=o+1;v<e;v++){let w=Math.abs(n[v][o]);w>s&&(s=w,a=v)}if(s===0)return null;let f=n[a];n[a]=n[o],n[o]=f;for(let v=o+1;v<e;v++){let w=-n[v][o]/n[o][o];for(let D=o;D<e+1;D++)o==D?n[v][D]=0:n[v][D]+=w*n[o][D]}}let t=new Array(e);for(let o=e-1;o>=0;o--){t[o]=n[o][e]/n[o][o];for(let a=o-1;a>=0;a--)n[a][e]-=n[a][o]*t[o]}return t}function mw(n){return n*180/Math.PI}function Bl(n){return n*Math.PI/180}function jl(n,e){let t=n%e;return t*e<0?t+e:t}function Go(n,e,t){return n+t*(e-n)}function Hf(n,e){let t=Math.pow(10,e);return Math.round(n*t)/t}function NS(n,e){return Math.round(Hf(n,e))}function yg(n,e){return Math.floor(Hf(n,e))}function dv(n,e){return Math.ceil(Hf(n,e))}function gw(n,e,t){if(n>=e&&n<t)return n;let o=t-e;return((n-e)%o+o)%o+e}function zS(n,e,t){return(function(o,a,s,f,v){if(!o)return;if(!a&&!e)return o;let w=e?0:s[0]*a,D=e?0:s[1]*a,A=v?v[0]:0,z=v?v[1]:0,H=n[0]+w/2+A,q=n[2]-w/2+A,W=n[1]+D/2+z,me=n[3]-D/2+z;H>q&&(H=(q+H)/2,q=H),W>me&&(W=(me+W)/2,me=W);let ce=ci(o[0],H,q),ue=ci(o[1],W,me);if(f&&t&&a){let Me=30*a;ce+=-Me*Math.log(1+Math.max(0,H-o[0])/Me)+Me*Math.log(1+Math.max(0,o[0]-q)/Me),ue+=-Me*Math.log(1+Math.max(0,W-o[1])/Me)+Me*Math.log(1+Math.max(0,o[1]-me)/Me)}return[ce,ue]})}function $N(n){return n}var Gr={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function BS(n){let e=ar();for(let t=0,o=n.length;t<o;++t)qf(e,n[t]);return e}function YH(n,e,t){let o=Math.min.apply(null,n),a=Math.min.apply(null,e),s=Math.max.apply(null,n),f=Math.max.apply(null,e);return Ma(o,a,s,f,t)}function qu(n,e,t){return t?(t[0]=n[0]-e,t[1]=n[1]-e,t[2]=n[2]+e,t[3]=n[3]+e,t):[n[0]-e,n[1]-e,n[2]+e,n[3]+e]}function yw(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n.slice()}function $s(n,e,t){let o,a;return e<n[0]?o=n[0]-e:n[2]<e?o=e-n[2]:o=0,t<n[1]?a=n[1]-t:n[3]<t?a=t-n[3]:a=0,o*o+a*a}function Vl(n,e){return fv(n,e[0],e[1])}function Zf(n,e){return n[0]<=e[0]&&e[2]<=n[2]&&n[1]<=e[1]&&e[3]<=n[3]}function fv(n,e,t){return n[0]<=e&&e<=n[2]&&n[1]<=t&&t<=n[3]}function _w(n,e){let t=n[0],o=n[1],a=n[2],s=n[3],f=e[0],v=e[1],w=Gr.UNKNOWN;return f<t?w=w|Gr.LEFT:f>a&&(w=w|Gr.RIGHT),v<o?w=w|Gr.BELOW:v>s&&(w=w|Gr.ABOVE),w===Gr.UNKNOWN&&(w=Gr.INTERSECTING),w}function ar(){return[1/0,1/0,-1/0,-1/0]}function Ma(n,e,t,o,a){return a?(a[0]=n,a[1]=e,a[2]=t,a[3]=o,a):[n,e,t,o]}function Wu(n){return Ma(1/0,1/0,-1/0,-1/0,n)}function vw(n,e){let t=n[0],o=n[1];return Ma(t,o,t,o,e)}function vg(n,e,t,o,a){let s=Wu(a);return jS(s,n,e,t,o)}function Xu(n,e){return n[0]==e[0]&&n[2]==e[2]&&n[1]==e[1]&&n[3]==e[3]}function xw(n,e){return e[0]<n[0]&&(n[0]=e[0]),e[2]>n[2]&&(n[2]=e[2]),e[1]<n[1]&&(n[1]=e[1]),e[3]>n[3]&&(n[3]=e[3]),n}function qf(n,e){e[0]<n[0]&&(n[0]=e[0]),e[0]>n[2]&&(n[2]=e[0]),e[1]<n[1]&&(n[1]=e[1]),e[1]>n[3]&&(n[3]=e[1])}function jS(n,e,t,o,a){for(;t<o;t+=a)KH(n,e[t],e[t+1]);return n}function KH(n,e,t){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}function bw(n,e){let t;return t=e(xg(n)),t||(t=e(bg(n)),t)||(t=e(Eg(n)),t)||(t=e(tl(n)),t)?t:!1}function pv(n){let e=0;return rd(n)||(e=In(n)*Hi(n)),e}function xg(n){return[n[0],n[1]]}function bg(n){return[n[2],n[1]]}function Hs(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function HN(n,e){let t;if(e==="bottom-left")t=xg(n);else if(e==="bottom-right")t=bg(n);else if(e==="top-left")t=tl(n);else if(e==="top-right")t=Eg(n);else throw new Error("Invalid corner");return t}function wg(n,e,t,o,a){let[s,f,v,w,D,A,z,H]=VS(n,e,t,o);return Ma(Math.min(s,v,D,z),Math.min(f,w,A,H),Math.max(s,v,D,z),Math.max(f,w,A,H),a)}function VS(n,e,t,o){let a=e*o[0]/2,s=e*o[1]/2,f=Math.cos(t),v=Math.sin(t),w=a*f,D=a*v,A=s*f,z=s*v,H=n[0],q=n[1];return[H-w+z,q-D-A,H-w-z,q-D+A,H+w-z,q+D+A,H+w+z,q+D-A,H-w+z,q-D-A]}function Hi(n){return n[3]-n[1]}function jc(n,e,t){let o=t||ar();return lr(n,e)?(n[0]>e[0]?o[0]=n[0]:o[0]=e[0],n[1]>e[1]?o[1]=n[1]:o[1]=e[1],n[2]<e[2]?o[2]=n[2]:o[2]=e[2],n[3]<e[3]?o[3]=n[3]:o[3]=e[3]):Wu(o),o}function tl(n){return[n[0],n[3]]}function Eg(n){return[n[2],n[3]]}function In(n){return n[2]-n[0]}function lr(n,e){return n[0]<=e[2]&&n[2]>=e[0]&&n[1]<=e[3]&&n[3]>=e[1]}function rd(n){return n[2]<n[0]||n[3]<n[1]}function ZN(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n}function qN(n,e,t){let o=!1,a=_w(n,e),s=_w(n,t);if(a===Gr.INTERSECTING||s===Gr.INTERSECTING)o=!0;else{let f=n[0],v=n[1],w=n[2],D=n[3],A=e[0],z=e[1],H=t[0],q=t[1],W=(q-z)/(H-A),me,ce;s&Gr.ABOVE&&!(a&Gr.ABOVE)&&(me=H-(q-D)/W,o=me>=f&&me<=w),!o&&s&Gr.RIGHT&&!(a&Gr.RIGHT)&&(ce=q-(H-w)*W,o=ce>=v&&ce<=D),!o&&s&Gr.BELOW&&!(a&Gr.BELOW)&&(me=H-(q-v)/W,o=me>=f&&me<=w),!o&&s&Gr.LEFT&&!(a&Gr.LEFT)&&(ce=q-(H-f)*W,o=ce>=v&&ce<=D)}return o}function WN(n,e,t,o){if(rd(n))return Wu(t);let a=[];if(o>1){let v=n[2]-n[0],w=n[3]-n[1];for(let D=0;D<o;++D)a.push(n[0]+v*D/o,n[1],n[2],n[1]+w*D/o,n[2]-v*D/o,n[3],n[0],n[3]-w*D/o)}else a=[n[0],n[1],n[2],n[1],n[2],n[3],n[0],n[3]];e(a,a,2);let s=[],f=[];for(let v=0,w=a.length;v<w;v+=2)s.push(a[v]),f.push(a[v+1]);return YH(s,f,t)}function US(n,e){let t=e.getExtent(),o=Hs(n);if(e.canWrapX()&&(o[0]<t[0]||o[0]>=t[2])){let a=In(t),f=Math.floor((o[0]-t[0])/a)*a;n[0]-=f,n[2]-=f}return n}function ww(n,e,t){if(e.canWrapX()){let o=e.getExtent();if(!isFinite(n[0])||!isFinite(n[2]))return[[o[0],n[1],o[2],n[3]]];US(n,e);let a=In(o);if(In(n)>a&&!t)return[[o[0],n[1],o[2],n[3]]];if(n[0]<o[0])return[[n[0]+a,n[1],o[2],n[3]],[o[0],n[1],n[2],n[3]]];if(n[2]>o[2])return[[n[0],n[1],o[2],n[3]],[o[0],n[1],n[2]-a,n[3]]]}return[n]}function Ew(n,e){let t=(""+n).split("."),o=(""+e).split(".");for(let a=0;a<Math.max(t.length,o.length);a++){let s=parseInt(t[a]||"0",10),f=parseInt(o[a]||"0",10);if(s>f)return 1;if(f>s)return-1}return 0}function XN(n,e){return n[0]+=+e[0],n[1]+=+e[1],n}function Wf(n,e){let t=!0;for(let o=n.length-1;o>=0;--o)if(n[o]!=e[o]){t=!1;break}return t}function Tg(n,e){let t=Math.cos(e),o=Math.sin(e),a=n[0]*t-n[1]*o,s=n[1]*t+n[0]*o;return n[0]=a,n[1]=s,n}function YN(n,e){return n[0]*=e,n[1]*=e,n}function Tw(n,e){if(e.canWrapX()){let t=In(e.getExtent()),o=KN(n,e,t);o&&(n[0]-=o*t)}return n}function KN(n,e,t){let o=e.getExtent(),a=0;return e.canWrapX()&&(n[0]<o[0]||n[0]>o[2])&&(t=t||In(o),a=Math.floor((n[0]-o[0])/t)),a}function GS(n){return Math.pow(n,3)}function nl(n){return 1-GS(1-n)}function JN(n){return 3*n*n-2*n*n*n}function QN(n){return n}var JH=63710088e-1;function $S(n,e,t){t=t||JH;let o=Bl(n[1]),a=Bl(e[1]),s=(a-o)/2,f=Bl(e[0]-n[0])/2,v=Math.sin(s)*Math.sin(s)+Math.sin(f)*Math.sin(f)*Math.cos(o)*Math.cos(a);return 2*t*Math.atan2(Math.sqrt(v),Math.sqrt(1-v))}var ez={info:1,warn:2,error:3,none:4},QH=ez.info;function Cw(...n){QH>ez.warn||console.warn(...n)}var Yu={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};var HS=class{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Yu[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}},Cg=HS;var mv=6378137,Ig=Math.PI*mv,eZ=[-Ig,-Ig,Ig,Ig],tZ=[-180,-85,180,85],Iw=mv*Math.log(Math.tan(Math.PI/2)),od=class extends Cg{constructor(e){super({code:e,units:"m",extent:eZ,global:!0,worldExtent:tZ,getPointResolution:function(t,o){return t/Math.cosh(o[1]/mv)}})}},ZS=[new od("EPSG:3857"),new od("EPSG:102100"),new od("EPSG:102113"),new od("EPSG:900913"),new od("http://www.opengis.net/def/crs/EPSG/0/3857"),new od("http://www.opengis.net/gml/srs/epsg.xml#3857")];function tz(n,e,t,o){let a=n.length;t=t>1?t:2,o=o??t,e===void 0&&(t>2?e=n.slice():e=new Array(a));for(let s=0;s<a;s+=o){e[s]=Ig*n[s]/180;let f=mv*Math.log(Math.tan(Math.PI*(+n[s+1]+90)/360));f>Iw?f=Iw:f<-Iw&&(f=-Iw),e[s+1]=f}return e}function nz(n,e,t,o){let a=n.length;t=t>1?t:2,o=o??t,e===void 0&&(t>2?e=n.slice():e=new Array(a));for(let s=0;s<a;s+=o)e[s]=180*n[s]/Ig,e[s+1]=360*Math.atan(Math.exp(n[s+1]/mv))/Math.PI-90;return e}var nZ=6378137,iz=[-180,-90,180,90],iZ=Math.PI*nZ/180,Ku=class extends Cg{constructor(e,t){super({code:e,units:"degrees",extent:iz,axisOrientation:t,global:!0,metersPerUnit:iZ,worldExtent:iz})}},qS=[new Ku("CRS:84"),new Ku("EPSG:4326","neu"),new Ku("urn:ogc:def:crs:OGC:1.3:CRS84"),new Ku("urn:ogc:def:crs:OGC:2:84"),new Ku("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Ku("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Ku("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];var WS={};function rz(n){return WS[n]||WS[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function oz(n,e){WS[n]=e}var Sg={};function Dg(n,e,t){let o=n.getCode(),a=e.getCode();o in Sg||(Sg[o]={}),Sg[o][a]=t}function Sw(n,e){return n in Sg&&e in Sg[n]?Sg[n][e]:null}var Dw=.9996,il=.00669438,Pw=il*il,Aw=Pw*il,Xf=il/(1-il),sz=Math.sqrt(1-il),Mg=(1-sz)/(1+sz),uz=Mg*Mg,XS=uz*Mg,YS=XS*Mg,hz=YS*Mg,dz=1-il/4-3*Pw/64-5*Aw/256,rZ=3*il/8+3*Pw/32+45*Aw/1024,oZ=15*Pw/256+45*Aw/1024,sZ=35*Aw/3072,aZ=3/2*Mg-27/32*XS+269/512*hz,lZ=21/16*uz-55/32*YS,cZ=151/96*XS-417/128*hz,uZ=1097/512*YS,Mw=6378137;function hZ(n,e,t){let o=n-5e5,f=(t.north?e:e-1e7)/Dw/(Mw*dz),v=f+aZ*Math.sin(2*f)+lZ*Math.sin(4*f)+cZ*Math.sin(6*f)+uZ*Math.sin(8*f),w=Math.sin(v),D=w*w,A=Math.cos(v),z=w/A,H=z*z,q=H*H,W=1-il*D,me=Math.sqrt(1-il*D),ce=Mw/me,ue=(1-il)/W,Me=Xf*A**2,Ue=Me*Me,Pe=o/(ce*Dw),ke=Pe*Pe,Qe=ke*Pe,ot=Qe*Pe,st=ot*Pe,it=st*Pe,pt=v-z/ue*(ke/2-ot/24*(5+3*H+10*Me-4*Ue-9*Xf))+it/720*(61+90*H+298*Me+45*q-252*Xf-3*Ue),Vt=(Pe-Qe/6*(1+2*H+Me)+st/120*(5-2*Me+28*H-3*Ue+8*Xf+24*q))/A;return Vt=gw(Vt+Bl(fz(t.number)),-Math.PI,Math.PI),[mw(Vt),mw(pt)]}var az=-80,lz=84,dZ=-180,fZ=180;function pZ(n,e,t){n=gw(n,dZ,fZ),e<az?e=az:e>lz&&(e=lz);let o=Bl(e),a=Math.sin(o),s=Math.cos(o),f=a/s,v=f*f,w=v*v,D=Bl(n),A=fz(t.number),z=Bl(A),H=Mw/Math.sqrt(1-il*a**2),q=Xf*s**2,W=s*gw(D-z,-Math.PI,Math.PI),me=W*W,ce=me*W,ue=ce*W,Me=ue*W,Ue=Me*W,Pe=Mw*(dz*o-rZ*Math.sin(2*o)+oZ*Math.sin(4*o)-sZ*Math.sin(6*o)),ke=Dw*H*(W+ce/6*(1-v+q)+Me/120*(5-18*v+w+72*q-58*Xf))+5e5,Qe=Dw*(Pe+H*f*(me/2+ue/24*(5-v+9*q+4*q**2)+Ue/720*(61-58*v+w+600*q-330*Xf)));return t.north||(Qe+=1e7),[ke,Qe]}function fz(n){return(n-1)*6-180+3}var mZ=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function pz(n){let e=0;for(let a of mZ){let s=n.match(a);if(s){e=parseInt(s[1]);break}}if(!e)return null;let t=0,o=!1;return e>32700&&e<32761?t=e-32700:e>32600&&e<32661&&(o=!0,t=e-32600),t?{number:t,north:o}:null}function cz(n,e){return function(t,o,a,s){let f=t.length;a=a>1?a:2,s=s??a,o||(a>2?o=t.slice():o=new Array(f));for(let v=0;v<f;v+=s){let w=t[v],D=t[v+1],A=n(w,D,e);o[v]=A[0],o[v+1]=A[1]}return o}}function mz(n){return pz(n)?new Cg({code:n,units:"m"}):null}function gz(n){let e=pz(n.getCode());return e?{forward:cz(pZ,e),inverse:cz(hZ,e)}:null}var gZ=[gz],_Z=[mz];var JS=!0;function eD(n){JS=!(n===void 0?!0:n)}function tD(n,e){if(e!==void 0){for(let t=0,o=n.length;t<o;++t)e[t]=n[t];e=e}else e=n.slice();return e}function QS(n){oz(n.getCode(),n),Dg(n,n,tD)}function yZ(n){n.forEach(QS)}function si(n){if(typeof n!="string")return n;let e=rz(n);if(e)return e;for(let t of _Z){let o=t(n);if(o)return o}return null}function nD(n,e,t,o){n=si(n);let a,s=n.getPointResolutionFunc();if(s){if(a=s(e,t),o&&o!==n.getUnits()){let f=n.getMetersPerUnit();f&&(a=a*f/Yu[o])}}else{let f=n.getUnits();if(f=="degrees"&&!o||o=="degrees")a=e;else{let v=Yf(n,si("EPSG:4326"));if(!v&&f!=="degrees")a=e*n.getMetersPerUnit();else{let D=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];D=v(D,D,2);let A=$S(D.slice(0,2),D.slice(2,4)),z=$S(D.slice(4,6),D.slice(6,8));a=(A+z)/2}let w=o?Yu[o]:n.getMetersPerUnit();w!==void 0&&(a/=w)}}return a}function _z(n){yZ(n),n.forEach(function(e){n.forEach(function(t){e!==t&&Dg(e,t,tD)})})}function vZ(n,e,t,o){n.forEach(function(a){e.forEach(function(s){Dg(a,s,t),Dg(s,a,o)})})}function Rw(n,e){return n?typeof n=="string"?si(n):n:si(e)}function yz(n){return(function(e,t,o,a){let s=e.length;o=o!==void 0?o:2,a=a??o,t=t!==void 0?t:new Array(s);for(let f=0;f<s;f+=a){let v=n(e.slice(f,f+o)),w=v.length;for(let D=0,A=a;D<A;++D)t[f+D]=D>=w?e[f+D]:v[D]}return t})}function iD(n,e){return eD(),Qu(n,"EPSG:4326",e!==void 0?e:"EPSG:3857")}function sd(n,e){if(n===e)return!0;let t=n.getUnits()===e.getUnits();return(n.getCode()===e.getCode()||Yf(n,e)===tD)&&t}function Yf(n,e){let t=n.getCode(),o=e.getCode(),a=Sw(t,o);if(a)return a;let s=null,f=null;for(let w of gZ)s||(s=w(n)),f||(f=w(e));if(!s&&!f)return null;let v="EPSG:4326";if(f)if(s)a=KS(s.inverse,f.forward);else{let w=Sw(t,v);w&&(a=KS(w,f.forward))}else{let w=Sw(v,o);w&&(a=KS(s.inverse,w))}return a&&(QS(n),QS(e),Dg(n,e,a)),a}function KS(n,e){return function(t,o,a,s){return o=n(t,o,a,s),e(o,o,a,s)}}function Ju(n,e){let t=si(n),o=si(e);return Yf(t,o)}function Qu(n,e,t){let o=Ju(e,t);if(!o){let a=si(e).getCode(),s=si(t).getCode();throw new Error(`No transform available between ${a} and ${s}`)}return o(n,void 0,n.length)}function rD(n,e,t,o){let a=Ju(e,t);return WN(n,a,void 0,o)}var Ul=null;function Kf(){return Ul}function gv(n,e){return Ul?Qu(n,e,Ul):n}function Gl(n,e){return Ul?Qu(n,Ul,e):(JS&&!Wf(n,[0,0])&&n[0]>=-180&&n[0]<=180&&n[1]>=-90&&n[1]<=90&&(JS=!1,Cw("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),n)}function ad(n,e){return Ul?rD(n,e,Ul):n}function rl(n,e){return Ul?rD(n,Ul,e):n}function vz(n,e){if(!Ul)return n;let t=si(e).getMetersPerUnit(),o=Ul.getMetersPerUnit();return t&&o?n*t/o:n}function xZ(){_z(ZS),_z(qS),vZ(qS,ZS,tz,nz)}xZ();var $fe=new Array(6);function Io(){return[1,0,0,1,0,0]}function xz(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n}function cr(n,e){let t=e[0],o=e[1];return e[0]=n[0]*t+n[2]*o+n[4],e[1]=n[1]*t+n[3]*o+n[5],e}function $o(n,e,t,o,a,s,f,v){let w=Math.sin(s),D=Math.cos(s);return n[0]=o*D,n[1]=a*w,n[2]=-o*w,n[3]=a*D,n[4]=f*o*D-v*o*w+e,n[5]=f*a*w+v*a*D+t,n}function Ow(n,e){let t=bZ(e);Cn(t!==0,"Transformation matrix cannot be inverted");let o=e[0],a=e[1],s=e[2],f=e[3],v=e[4],w=e[5];return n[0]=f/t,n[1]=-a/t,n[2]=-s/t,n[3]=o/t,n[4]=(s*w-f*v)/t,n[5]=-(o*w-a*v)/t,n}function bZ(n){return n[0]*n[3]-n[1]*n[2]}var wZ=[1e5,1e5,1e5,1e5,2,2];function bz(n){return"matrix("+n.join(", ")+")"}function Lw(n){return n.substring(7,n.length-1).split(",").map(parseFloat)}function wz(n,e){let t=Lw(n),o=Lw(e);for(let a=0;a<6;++a)if(Math.round((t[a]-o[a])*wZ[a])!==0)return!1;return!0}function Zs(n,e,t,o,a,s,f){s=s||[],f=f||2;let v=0;for(let w=e;w<t;w+=o){let D=n[w],A=n[w+1];s[v++]=a[0]*D+a[2]*A+a[4],s[v++]=a[1]*D+a[3]*A+a[5];for(let z=2;z<f;z++)s[v++]=n[w+z]}return s&&s.length!=v&&(s.length=v),s}function kw(n,e,t,o,a,s,f){f=f||[];let v=Math.cos(a),w=Math.sin(a),D=s[0],A=s[1],z=0;for(let H=e;H<t;H+=o){let q=n[H]-D,W=n[H+1]-A;f[z++]=D+q*v-W*w,f[z++]=A+q*w+W*v;for(let me=H+2;me<H+o;++me)f[z++]=n[me]}return f&&f.length!=z&&(f.length=z),f}function Ez(n,e,t,o,a,s,f,v){v=v||[];let w=f[0],D=f[1],A=0;for(let z=e;z<t;z+=o){let H=n[z]-w,q=n[z+1]-D;v[A++]=w+a*H,v[A++]=D+s*q;for(let W=z+2;W<z+o;++W)v[A++]=n[W]}return v&&v.length!=A&&(v.length=A),v}function Tz(n,e,t,o,a,s,f){f=f||[];let v=0;for(let w=e;w<t;w+=o){f[v++]=n[w]+a,f[v++]=n[w+1]+s;for(let D=w+2;D<w+o;++D)f[v++]=n[D]}return f&&f.length!=v&&(f.length=v),f}var Cz=Io(),EZ=[NaN,NaN],oD=class extends Ur{constructor(){super(),this.extent_=ar(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=hw((e,t,o)=>{if(!o)return this.getSimplifiedGeometry(t);let a=this.clone();return a.applyTransform(o),a.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return Xt()}closestPointXY(e,t,o,a){return Xt()}containsXY(e,t){return this.closestPointXY(e,t,EZ,Number.MIN_VALUE)===0}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return Xt()}getExtent(e){if(this.extentRevision_!=this.getRevision()){let t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&Wu(t),this.extentRevision_=this.getRevision()}return ZN(this.extent_,e)}rotate(e,t){Xt()}scale(e,t,o){Xt()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return Xt()}getType(){return Xt()}applyTransform(e){Xt()}intersectsExtent(e){return Xt()}translate(e,t){Xt()}transform(e,t){let o=si(e),a=o.getUnits()=="tile-pixels"?function(s,f,v){let w=o.getExtent(),D=o.getWorldExtent(),A=Hi(D)/Hi(w);$o(Cz,D[0],D[3],A,-A,0,0,0);let z=Zs(s,0,s.length,v,Cz,f),H=Ju(o,t);return H?H(z,z,v):z}:Ju(o,t);return this.applyTransform(a),this}},Fw=oD;var sD=class extends Fw{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return vg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return Xt()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;let t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=Iz(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){Xt()}setLayout(e,t,o){let a;if(e)a=Iz(e);else{for(let s=0;s<o;++s){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}a=t.length,e=ld(a)}this.layout=e,this.stride=a}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(e,t){let o=this.getFlatCoordinates();if(o){let a=this.getStride();kw(o,0,o.length,a,e,t,o),this.changed()}}scale(e,t,o){t===void 0&&(t=e),o||(o=Hs(this.getExtent()));let a=this.getFlatCoordinates();if(a){let s=this.getStride();Ez(a,0,a.length,s,e,t,o,a),this.changed()}}translate(e,t){let o=this.getFlatCoordinates();if(o){let a=this.getStride();Tz(o,0,o.length,a,e,t,o),this.changed()}}};function ld(n){let e;return n==2?e="XY":n==3?e="XYZ":n==4&&(e="XYZM"),e}function Iz(n){let e;return n=="XY"?e=2:n=="XYZ"||n=="XYM"?e=3:n=="XYZM"&&(e=4),e}function Sz(n,e,t){let o=n.getFlatCoordinates();if(!o)return null;let a=n.getStride();return Zs(o,0,o.length,a,e,t)}var qs=sD;function aD(n,e,t,o){let a=0,s=n[t-o],f=n[t-o+1],v=0,w=0;for(;e<t;e+=o){let D=n[e]-s,A=n[e+1]-f;a+=w*D-v*A,v=D,w=A}return a/2}function lD(n,e,t,o){let a=0;for(let s=0,f=t.length;s<f;++s){let v=t[s];a+=aD(n,e,v,o),e=v}return a}function Dz(n,e,t,o){let a=0;for(let s=0,f=t.length;s<f;++s){let v=t[s];a+=lD(n,e,v,o),e=v[v.length-1]}return a}function Mz(n,e,t,o,a,s,f){let v=n[e],w=n[e+1],D=n[t]-v,A=n[t+1]-w,z;if(D===0&&A===0)z=e;else{let H=((a-v)*D+(s-w)*A)/(D*D+A*A);if(H>1)z=t;else if(H>0){for(let q=0;q<o;++q)f[q]=Go(n[e+q],n[t+q],H);f.length=o;return}else z=e}for(let H=0;H<o;++H)f[H]=n[z+H];f.length=o}function _v(n,e,t,o,a){let s=n[e],f=n[e+1];for(e+=o;e<t;e+=o){let v=n[e],w=n[e+1],D=zl(s,f,v,w);D>a&&(a=D),s=v,f=w}return a}function yv(n,e,t,o,a){for(let s=0,f=t.length;s<f;++s){let v=t[s];a=_v(n,e,v,o,a),e=v}return a}function Pz(n,e,t,o,a){for(let s=0,f=t.length;s<f;++s){let v=t[s];a=yv(n,e,v,o,a),e=v[v.length-1]}return a}function vv(n,e,t,o,a,s,f,v,w,D,A){if(e==t)return D;let z,H;if(a===0){if(H=zl(f,v,n[e],n[e+1]),H<D){for(z=0;z<o;++z)w[z]=n[e+z];return w.length=o,H}return D}A=A||[NaN,NaN];let q=e+o;for(;q<t;)if(Mz(n,q-o,q,o,f,v,A),H=zl(f,v,A[0],A[1]),H<D){for(D=H,z=0;z<o;++z)w[z]=A[z];w.length=o,q+=o}else q+=o*Math.max((Math.sqrt(H)-Math.sqrt(D))/a|0,1);if(s&&(Mz(n,t-o,e,o,f,v,A),H=zl(f,v,A[0],A[1]),H<D)){for(D=H,z=0;z<o;++z)w[z]=A[z];w.length=o}return D}function xv(n,e,t,o,a,s,f,v,w,D,A){A=A||[NaN,NaN];for(let z=0,H=t.length;z<H;++z){let q=t[z];D=vv(n,e,q,o,a,s,f,v,w,D,A),e=q}return D}function Az(n,e,t,o,a,s,f,v,w,D,A){A=A||[NaN,NaN];for(let z=0,H=t.length;z<H;++z){let q=t[z];D=xv(n,e,q,o,a,s,f,v,w,D,A),e=q[q.length-1]}return D}function Rz(n,e,t,o){for(let a=0,s=t.length;a<s;++a)n[e++]=t[a];return e}function Jf(n,e,t,o){for(let a=0,s=t.length;a<s;++a){let f=t[a];for(let v=0;v<o;++v)n[e++]=f[v]}return e}function cd(n,e,t,o,a){a=a||[];let s=0;for(let f=0,v=t.length;f<v;++f){let w=Jf(n,e,t[f],o);a[s++]=w,e=w}return a.length=s,a}function Nw(n,e,t,o,a){a=a||[];let s=0;for(let f=0,v=t.length;f<v;++f){let w=cd(n,e,t[f],o,a[s]);w.length===0&&(w[0]=e),a[s++]=w,e=w[w.length-1]}return a.length=s,a}function ol(n,e,t,o,a){a=a!==void 0?a:[];let s=0;for(let f=e;f<t;f+=o)a[s++]=n.slice(f,f+o);return a.length=s,a}function ud(n,e,t,o,a){a=a!==void 0?a:[];let s=0;for(let f=0,v=t.length;f<v;++f){let w=t[f];a[s++]=ol(n,e,w,o,a[s]),e=w}return a.length=s,a}function bv(n,e,t,o,a){a=a!==void 0?a:[];let s=0;for(let f=0,v=t.length;f<v;++f){let w=t[f];a[s++]=w.length===1&&w[0]===e?[]:ud(n,e,w,o,a[s]),e=w[w.length-1]}return a.length=s,a}function Qf(n,e,t,o,a,s,f){let v=(t-e)/o;if(v<3){for(;e<t;e+=o)s[f++]=n[e],s[f++]=n[e+1];return f}let w=new Array(v);w[0]=1,w[v-1]=1;let D=[e,t-o],A=0;for(;D.length>0;){let z=D.pop(),H=D.pop(),q=0,W=n[H],me=n[H+1],ce=n[z],ue=n[z+1];for(let Me=H+o;Me<z;Me+=o){let Ue=n[Me],Pe=n[Me+1],ke=UN(Ue,Pe,W,me,ce,ue);ke>q&&(A=Me,q=ke)}q>a&&(w[(A-e)/o]=1,H+o<A&&D.push(H,A),A+o<z&&D.push(A,z))}for(let z=0;z<v;++z)w[z]&&(s[f++]=n[e+z*o],s[f++]=n[e+z*o+1]);return f}function zw(n,e,t,o,a,s,f,v){for(let w=0,D=t.length;w<D;++w){let A=t[w];f=Qf(n,e,A,o,a,s,f),v.push(f),e=A}return f}function hd(n,e){return e*Math.round(n/e)}function TZ(n,e,t,o,a,s,f){if(e==t)return f;let v=hd(n[e],a),w=hd(n[e+1],a);e+=o,s[f++]=v,s[f++]=w;let D,A;do if(D=hd(n[e],a),A=hd(n[e+1],a),e+=o,e==t)return s[f++]=D,s[f++]=A,f;while(D==v&&A==w);for(;e<t;){let z=hd(n[e],a),H=hd(n[e+1],a);if(e+=o,z==D&&H==A)continue;let q=D-v,W=A-w,me=z-v,ce=H-w;if(q*ce==W*me&&(q<0&&me<q||q==me||q>0&&me>q)&&(W<0&&ce<W||W==ce||W>0&&ce>W)){D=z,A=H;continue}s[f++]=D,s[f++]=A,v=D,w=A,D=z,A=H}return s[f++]=D,s[f++]=A,f}function wv(n,e,t,o,a,s,f,v){for(let w=0,D=t.length;w<D;++w){let A=t[w];f=TZ(n,e,A,o,a,s,f),v.push(f),e=A}return f}function Lz(n,e,t,o,a,s,f,v){for(let w=0,D=t.length;w<D;++w){let A=t[w],z=[];f=wv(n,e,A,o,a,s,f,z),v.push(z),e=A[A.length-1]}return f}var cD=class n extends qs{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new n(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,o,a){return a<$s(this.getExtent(),e,t)?a:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(_v(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),vv(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,o,a))}getArea(){return aD(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return ol(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){let t=[];return t.length=Qf(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new n(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Jf(this.flatCoordinates,0,e,this.stride),this.changed()}},uD=cD;var hD=class n extends qs{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){let e=new n(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,o,a){let s=this.flatCoordinates,f=zl(e,t,s[0],s[1]);if(f<a){let v=this.stride;for(let w=0;w<v;++w)o[w]=s[w];return o.length=v,f}return a}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return vw(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return fv(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Rz(this.flatCoordinates,0,e,this.stride),this.changed()}},dd=hD;function Oz(n,e,t,o,a){return!bw(a,function(f){return!fd(n,e,t,o,f[0],f[1])})}function fd(n,e,t,o,a,s){let f=0,v=n[t-o],w=n[t-o+1];for(;e<t;e+=o){let D=n[e],A=n[e+1];w<=s?A>s&&(D-v)*(s-w)-(a-v)*(A-w)>0&&f++:A<=s&&(D-v)*(s-w)-(a-v)*(A-w)<0&&f--,v=D,w=A}return f!==0}function Ev(n,e,t,o,a,s){if(t.length===0||!fd(n,e,t[0],o,a,s))return!1;for(let f=1,v=t.length;f<v;++f)if(fd(n,t[f-1],t[f],o,a,s))return!1;return!0}function kz(n,e,t,o,a,s){if(t.length===0)return!1;for(let f=0,v=t.length;f<v;++f){let w=t[f];if(Ev(n,e,w,o,a,s))return!0;e=w[w.length-1]}return!1}function Tv(n,e,t,o,a,s,f){let v,w,D,A,z,H,q,W=a[s+1],me=[];for(let Me=0,Ue=t.length;Me<Ue;++Me){let Pe=t[Me];for(A=n[Pe-o],H=n[Pe-o+1],v=e;v<Pe;v+=o)z=n[v],q=n[v+1],(W<=H&&q<=W||H<=W&&W<=q)&&(D=(W-H)/(q-H)*(z-A)+A,me.push(D)),A=z,H=q}let ce=NaN,ue=-1/0;for(me.sort(Gs),A=me[0],v=1,w=me.length;v<w;++v){z=me[v];let Me=Math.abs(z-A);Me>ue&&(D=(A+z)/2,Ev(n,e,t,o,D,W)&&(ce=D,ue=Me)),A=z}return isNaN(ce)&&(ce=a[s]),f?(f.push(ce,W,ue),f):[ce,W,ue]}function Bw(n,e,t,o,a){let s=[];for(let f=0,v=t.length;f<v;++f){let w=t[f];s=Tv(n,e,w,o,a,2*f,s),e=w[w.length-1]}return s}function jw(n,e,t,o,a){let s;for(e+=o;e<t;e+=o)if(s=a(n.slice(e-o,e),n.slice(e,e+o)),s)return s;return!1}function Cv(n,e,t,o,a,s){return s=s??jS(ar(),n,e,t,o),lr(a,s)?s[0]>=a[0]&&s[2]<=a[2]||s[1]>=a[1]&&s[3]<=a[3]?!0:jw(n,e,t,o,function(f,v){return qN(a,f,v)}):!1}function Fz(n,e,t,o,a){for(let s=0,f=t.length;s<f;++s){if(Cv(n,e,t[s],o,a))return!0;e=t[s]}return!1}function dD(n,e,t,o,a){return!!(Cv(n,e,t,o,a)||fd(n,e,t,o,a[0],a[1])||fd(n,e,t,o,a[0],a[3])||fd(n,e,t,o,a[2],a[1])||fd(n,e,t,o,a[2],a[3]))}function fD(n,e,t,o,a){if(!dD(n,e,t[0],o,a))return!1;if(t.length===1)return!0;for(let s=1,f=t.length;s<f;++s)if(Oz(n,t[s-1],t[s],o,a)&&!Cv(n,t[s-1],t[s],o,a))return!1;return!0}function Nz(n,e,t,o,a){for(let s=0,f=t.length;s<f;++s){let v=t[s];if(fD(n,e,v,o,a))return!0;e=v[v.length-1]}return!1}function zz(n,e,t,o){for(;e<t-o;){for(let a=0;a<o;++a){let s=n[e+a];n[e+a]=n[t-o+a],n[t-o+a]=s}e+=o,t-=o}}function pD(n,e,t,o){let a=0,s=n[t-o],f=n[t-o+1];for(;e<t;e+=o){let v=n[e],w=n[e+1];a+=(v-s)*(w+f),s=v,f=w}return a===0?void 0:a>0}function Iv(n,e,t,o,a){a=a!==void 0?a:!1;for(let s=0,f=t.length;s<f;++s){let v=t[s],w=pD(n,e,v,o);if(s===0){if(a&&w||!a&&!w)return!1}else if(a&&!w||!a&&w)return!1;e=v}return!0}function Vw(n,e,t,o,a){for(let s=0,f=t.length;s<f;++s){let v=t[s];if(!Iv(n,e,v,o,a))return!1;v.length&&(e=v[v.length-1])}return!0}function Pg(n,e,t,o,a){a=a!==void 0?a:!1;for(let s=0,f=t.length;s<f;++s){let v=t[s],w=pD(n,e,v,o);(s===0?a&&w||!a&&!w:a&&!w||!a&&w)&&zz(n,e,v,o),e=v}return e}function Sv(n,e,t,o,a){for(let s=0,f=t.length;s<f;++s)e=Pg(n,e,t[s],o,a);return e}function Bz(n,e){let t=[],o=0,a=0,s;for(let f=0,v=e.length;f<v;++f){let w=e[f],D=pD(n,o,w,2);if(s===void 0&&(s=D),D===s)t.push(e.slice(a,f+1));else{if(t.length===0)continue;t[t.length-1].push(e[a])}a=f+1,o=w}return t}var Uw=class n extends qs{constructor(e,t,o){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&o?(this.setFlatCoordinates(t,e),this.ends_=o):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?jo(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){let e=new n(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,o,a){return a<$s(this.getExtent(),e,t)?a:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(yv(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),xv(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,o,a))}containsXY(e,t){return Ev(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return lD(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),Pg(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,ud(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){let e=Hs(this.getExtent());this.flatInteriorPoint_=Tv(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new dd(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new uD(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){let e=this.layout,t=this.flatCoordinates,o=this.ends_,a=[],s=0;for(let f=0,v=o.length;f<v;++f){let w=o[f],D=new uD(t.slice(s,w),e);a.push(D),s=w}return a}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){let e=this.flatCoordinates;Iv(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=Pg(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){let t=[],o=[];return t.length=wv(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,o),new n(t,"XY",o)}getType(){return"Polygon"}intersectsExtent(e){return fD(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);let o=cd(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=o.length===0?0:o[o.length-1],this.changed()}},pd=Uw;function mD(n){if(rd(n))throw new Error("Cannot create polygon from empty extent");let e=n[0],t=n[1],o=n[2],a=n[3],s=[e,t,e,a,o,a,o,t,e,t];return new Uw(s,"XY",[s.length])}function gD(n,e,t,o){let a=In(e)/t[0],s=Hi(e)/t[1];return o?Math.min(n,Math.max(a,s)):Math.min(n,Math.min(a,s))}function _D(n,e,t){let o=Math.min(n,e),a=50;return o*=Math.log(1+a*Math.max(0,n/e-1))/a+1,t&&(o=Math.max(o,t),o/=Math.log(1+a*Math.max(0,t/n-1))/a+1),ci(o,t/2,e*2)}function jz(n,e,t,o){return e=e!==void 0?e:!0,(function(a,s,f,v){if(a!==void 0){let w=n[0],D=n[n.length-1],A=t?gD(w,t,f,o):w;if(v)return e?_D(a,A,D):ci(a,D,A);let z=Math.min(A,a),H=Math.floor(pg(n,z,s));return n[H]>A&&H<n.length-1?n[H+1]:n[H]}})}function Vz(n,e,t,o,a,s){return o=o!==void 0?o:!0,t=t!==void 0?t:0,(function(f,v,w,D){if(f!==void 0){let A=a?gD(e,a,w,s):e;if(D)return o?_D(f,A,t):ci(f,t,A);let z=1e-9,H=Math.ceil(Math.log(e/A)/Math.log(n)-z),q=-v*(.5-z)+.5,W=Math.min(A,f),me=Math.floor(Math.log(e/W)/Math.log(n)+q),ce=Math.max(H,me),ue=e/Math.pow(n,ce);return ci(ue,t,A)}})}function yD(n,e,t,o,a){return t=t!==void 0?t:!0,(function(s,f,v,w){if(s!==void 0){let D=o?gD(n,o,v,a):n;return!t||!w?ci(s,e,D):_D(s,D,e)}})}function Ag(n){if(n!==void 0)return 0}function vD(n){if(n!==void 0)return n}function Uz(n){let e=2*Math.PI/n;return(function(t,o){if(o)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t})}function Gz(n){let e=n===void 0?Bl(5):n;return(function(t,o){return o||t===void 0?t:Math.abs(t)<=e?0:t})}var xD=0,wD=class extends Ur{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Rw(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&eD(),e.center&&(e.center=Gl(e.center,this.projection_)),e.extent&&(e.extent=rl(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){let t=Object.assign({},e);for(let v in el)delete t[v];this.setProperties(t,!0);let o=IZ(e);this.maxResolution_=o.maxResolution,this.minResolution_=o.minResolution,this.zoomFactor_=o.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=o.minZoom;let a=CZ(e),s=o.constraint,f=SZ(e);this.constraints_={center:a,resolution:s,rotation:f},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;let o=this.getCenterInternal();if(o){let a=e||[0,0,0,0];t=t||[0,0,0,0];let s=this.getResolution(),f=s/2*(a[3]-t[3]+t[1]-a[1]),v=s/2*(a[0]-t[0]+t[2]-a[2]);this.setCenterInternal([o[0]+f,o[1]-v])}}getUpdatedOptions_(e){let t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);let t=new Array(arguments.length);for(let o=0;o<t.length;++o){let a=arguments[o];a.center&&(a=Object.assign({},a),a.center=Gl(a.center,this.getProjection())),a.anchor&&(a=Object.assign({},a),a.anchor=Gl(a.anchor,this.getProjection())),t[o]=a}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,o;t>1&&typeof arguments[t-1]=="function"&&(o=arguments[t-1],--t);let a=0;for(;a<t&&!this.isDef();++a){let A=arguments[a];A.center&&this.setCenterInternal(A.center),A.zoom!==void 0?this.setZoom(A.zoom):A.resolution&&this.setResolution(A.resolution),A.rotation!==void 0&&this.setRotation(A.rotation)}if(a===t){o&&Gw(o,!0);return}let s=Date.now(),f=this.targetCenter_.slice(),v=this.targetResolution_,w=this.targetRotation_,D=[];for(;a<t;++a){let A=arguments[a],z={start:s,complete:!1,anchor:A.anchor,duration:A.duration!==void 0?A.duration:1e3,easing:A.easing||JN,callback:o};if(A.center&&(z.sourceCenter=f,z.targetCenter=A.center.slice(),f=z.targetCenter),A.zoom!==void 0?(z.sourceResolution=v,z.targetResolution=this.getResolutionForZoom(A.zoom),v=z.targetResolution):A.resolution&&(z.sourceResolution=v,z.targetResolution=A.resolution,v=z.targetResolution),A.rotation!==void 0){z.sourceRotation=w;let H=jl(A.rotation-w+Math.PI,2*Math.PI)-Math.PI;z.targetRotation=w+H,w=z.targetRotation}DZ(z)?z.complete=!0:s+=z.duration,D.push(z)}this.animations_.push(D),this.setHint(no.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[no.ANIMATING]>0}getInteracting(){return this.hints_[no.INTERACTING]>0}cancelAnimations(){this.setHint(no.ANIMATING,-this.hints_[no.ANIMATING]);let e;for(let t=0,o=this.animations_.length;t<o;++t){let a=this.animations_[t];if(a[0].callback&&Gw(a[0].callback,!1),!e)for(let s=0,f=a.length;s<f;++s){let v=a[s];if(!v.complete){e=v.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;let e=Date.now(),t=!1;for(let o=this.animations_.length-1;o>=0;--o){let a=this.animations_[o],s=!0;for(let f=0,v=a.length;f<v;++f){let w=a[f];if(w.complete)continue;let D=e-w.start,A=w.duration>0?D/w.duration:1;A>=1?(w.complete=!0,A=1):s=!1;let z=w.easing(A);if(w.sourceCenter){let H=w.sourceCenter[0],q=w.sourceCenter[1],W=w.targetCenter[0],me=w.targetCenter[1];this.nextCenter_=w.targetCenter;let ce=H+z*(W-H),ue=q+z*(me-q);this.targetCenter_=[ce,ue]}if(w.sourceResolution&&w.targetResolution){let H=z===1?w.targetResolution:w.sourceResolution+z*(w.targetResolution-w.sourceResolution);if(w.anchor){let q=this.getViewportSize_(this.getRotation()),W=this.constraints_.resolution(H,0,q,!0);this.targetCenter_=this.calculateCenterZoom(W,w.anchor)}this.nextResolution_=w.targetResolution,this.targetResolution_=H,this.applyTargetState_(!0)}if(w.sourceRotation!==void 0&&w.targetRotation!==void 0){let H=z===1?jl(w.targetRotation+Math.PI,2*Math.PI)-Math.PI:w.sourceRotation+z*(w.targetRotation-w.sourceRotation);if(w.anchor){let q=this.constraints_.rotation(H,!0);this.targetCenter_=this.calculateCenterRotate(q,w.anchor)}this.nextRotation_=w.targetRotation,this.targetRotation_=H}if(this.applyTargetState_(!0),t=!0,!w.complete)break}if(s){this.animations_[o]=null,this.setHint(no.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;let f=a[0].callback;f&&Gw(f,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let o,a=this.getCenterInternal();return a!==void 0&&(o=[a[0]-t[0],a[1]-t[1]],Tg(o,e-this.getRotation()),XN(o,t)),o}calculateCenterZoom(e,t){let o,a=this.getCenterInternal(),s=this.getResolution();if(a!==void 0&&s!==void 0){let f=t[0]-e*(t[0]-a[0])/s,v=t[1]-e*(t[1]-a[1])/s;o=[f,v]}return o}getViewportSize_(e){let t=this.viewportSize_;if(e){let o=t[0],a=t[1];return[Math.abs(o*Math.cos(e))+Math.abs(a*Math.sin(e)),Math.abs(o*Math.sin(e))+Math.abs(a*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){let e=this.getCenterInternal();return e&&gv(e,this.getProjection())}getCenterInternal(){return this.get(el.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){let t=this.calculateExtentInternal(e);return ad(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();let t=this.getCenterInternal();Cn(t,"The view center is not defined");let o=this.getResolution();Cn(o!==void 0,"The view resolution is not defined");let a=this.getRotation();return Cn(a!==void 0,"The view rotation is not defined"),wg(t,o,a,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(el.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(rl(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();let o=In(e)/t[0],a=Hi(e)/t[1];return Math.max(o,a)}getResolutionForValueFunction(e){e=e||2;let t=this.getConstrainedResolution(this.maxResolution_),o=this.minResolution_,a=Math.log(t/o)/Math.log(e);return(function(s){return t/Math.pow(e,s*a)})}getRotation(){return this.get(el.ROTATION)}getValueForResolutionFunction(e){let t=Math.log(e||2),o=this.getConstrainedResolution(this.maxResolution_),a=this.minResolution_,s=Math.log(o/a)/t;return(function(f){return Math.log(o/f)/t/s})}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e),o=this.padding_;return o&&(t=[t[0]-o[1]-o[3],t[1]-o[0]-o[2]]),t}getState(){let e=this.getProjection(),t=this.getResolution(),o=this.getRotation(),a=this.getCenterInternal(),s=this.padding_;if(s){let f=this.getViewportSizeMinusPadding_();a=bD(a,this.getViewportSize_(),[f[0]/2+s[3],f[1]/2+s[0]],t,o)}return{center:a.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:o,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e,t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,o,a;if(this.resolutions_){let s=pg(this.resolutions_,e,1);t=s,o=this.resolutions_[s],s==this.resolutions_.length-1?a=2:a=o/this.resolutions_[s+1]}else o=this.maxResolution_,a=this.zoomFactor_;return t+Math.log(o/e)/Math.log(a)}getResolutionForZoom(e){if(this.resolutions_?.length){if(this.resolutions_.length===1)return this.resolutions_[0];let t=ci(Math.floor(e),0,this.resolutions_.length-2),o=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(o,ci(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let o;if(Cn(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){Cn(!rd(e),"Cannot fit empty extent provided as `geometry`");let a=rl(e,this.getProjection());o=mD(a)}else if(e.getType()==="Circle"){let a=rl(e.getExtent(),this.getProjection());o=mD(a),o.rotate(this.getRotation(),Hs(a))}else{let a=Kf();a?o=e.clone().transform(a,this.getProjection()):o=e}this.fitInternal(o,t)}rotatedExtentForGeometry(e){let t=this.getRotation(),o=Math.cos(t),a=Math.sin(-t),s=e.getFlatCoordinates(),f=e.getStride(),v=1/0,w=1/0,D=-1/0,A=-1/0;for(let z=0,H=s.length;z<H;z+=f){let q=s[z]*o-s[z+1]*a,W=s[z]*a+s[z+1]*o;v=Math.min(v,q),w=Math.min(w,W),D=Math.max(D,q),A=Math.max(A,W)}return[v,w,D,A]}fitInternal(e,t){t=t||{};let o=t.size;o||(o=this.getViewportSizeMinusPadding_());let a=t.padding!==void 0?t.padding:[0,0,0,0],s=t.nearest!==void 0?t.nearest:!1,f;t.minResolution!==void 0?f=t.minResolution:t.maxZoom!==void 0?f=this.getResolutionForZoom(t.maxZoom):f=0;let v=this.rotatedExtentForGeometry(e),w=this.getResolutionForExtentInternal(v,[o[0]-a[1]-a[3],o[1]-a[0]-a[2]]);w=isNaN(w)?f:Math.max(w,f),w=this.getConstrainedResolution(w,s?0:1);let D=this.getRotation(),A=Math.sin(D),z=Math.cos(D),H=Hs(v);H[0]+=(a[1]-a[3])/2*w,H[1]+=(a[0]-a[2])/2*w;let q=H[0]*z-H[1]*A,W=H[1]*z+H[0]*A,me=this.getConstrainedCenter([q,W],w),ce=t.callback?t.callback:Zu;t.duration!==void 0?this.animateInternal({resolution:w,center:me,duration:t.duration,easing:t.easing},ce):(this.targetResolution_=w,this.targetCenter_=me,this.applyTargetState_(!1,!0),Gw(ce,!0))}centerOn(e,t,o){this.centerOnInternal(Gl(e,this.getProjection()),t,o)}centerOnInternal(e,t,o){this.setCenterInternal(bD(e,t,o,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,o,a){let s,f=this.padding_;if(f&&e){let v=this.getViewportSizeMinusPadding_(-o),w=bD(e,a,[v[0]/2+f[3],v[1]/2+f[0]],t,o);s=[e[0]-w[0],e[1]-w[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){let t=gv(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){let t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&Gl(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){let o=this.getAnimating()||this.getInteracting(),a=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*e,0,a,o);t&&(this.targetCenter_=this.calculateCenterZoom(s,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=Gl(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){let o=this.getAnimating()||this.getInteracting(),a=this.constraints_.rotation(this.targetRotation_+e,o);t&&(this.targetCenter_=this.calculateCenterRotate(a,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&Gl(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){let o=this.getAnimating()||this.getInteracting()||t,a=this.constraints_.rotation(this.targetRotation_,o),s=this.getViewportSize_(a),f=this.constraints_.resolution(this.targetResolution_,0,s,o),v=this.constraints_.center(this.targetCenter_,f,s,o,this.calculateCenterShift(this.targetCenter_,f,a,s));this.get(el.ROTATION)!==a&&this.set(el.ROTATION,a),this.get(el.RESOLUTION)!==f&&(this.set(el.RESOLUTION,f),this.set("zoom",this.getZoom(),!0)),(!v||!this.get(el.CENTER)||!Wf(this.get(el.CENTER),v))&&this.set(el.CENTER,v),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,o){e=e!==void 0?e:200;let a=t||0,s=this.constraints_.rotation(this.targetRotation_),f=this.getViewportSize_(s),v=this.constraints_.resolution(this.targetResolution_,a,f),w=this.constraints_.center(this.targetCenter_,v,f,!1,this.calculateCenterShift(this.targetCenter_,v,s,f));if(e===0&&!this.cancelAnchor_){this.targetResolution_=v,this.targetRotation_=s,this.targetCenter_=w,this.applyTargetState_();return}o=o||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==v||this.getRotation()!==s||!this.getCenterInternal()||!Wf(this.getCenterInternal(),w))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:w,resolution:v,duration:e,easing:nl,anchor:o}))}beginInteraction(){this.resolveConstraints(0),this.setHint(no.INTERACTING,1)}endInteraction(e,t,o){o=o&&Gl(o,this.getProjection()),this.endInteractionInternal(e,t,o)}endInteractionInternal(e,t,o){this.getInteracting()&&(this.setHint(no.INTERACTING,-1),this.resolveConstraints(e,t,o))}getConstrainedCenter(e,t){let o=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),o)}getConstrainedZoom(e,t){let o=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(o,t))}getConstrainedResolution(e,t){t=t||0;let o=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,o)}};function Gw(n,e){setTimeout(function(){n(e)},0)}function CZ(n){if(n.extent!==void 0){let t=n.smoothExtentConstraint!==void 0?n.smoothExtentConstraint:!0;return zS(n.extent,n.constrainOnlyCenter,t)}let e=Rw(n.projection,"EPSG:3857");if(n.multiWorld!==!0&&e.isGlobal()){let t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,zS(t,!1,!1)}return $N}function IZ(n){let e,t,o,f=n.minZoom!==void 0?n.minZoom:xD,v=n.maxZoom!==void 0?n.maxZoom:28,w=n.zoomFactor!==void 0?n.zoomFactor:2,D=n.multiWorld!==void 0?n.multiWorld:!1,A=n.smoothResolutionConstraint!==void 0?n.smoothResolutionConstraint:!0,z=n.showFullExtent!==void 0?n.showFullExtent:!1,H=Rw(n.projection,"EPSG:3857"),q=H.getExtent(),W=n.constrainOnlyCenter,me=n.extent;if(!D&&!me&&H.isGlobal()&&(W=!1,me=q),n.resolutions!==void 0){let ce=n.resolutions;t=ce[f],o=ce[v]!==void 0?ce[v]:ce[ce.length-1],n.constrainResolution?e=jz(ce,A,!W&&me,z):e=yD(t,o,A,!W&&me,z)}else{let ue=(q?Math.max(In(q),Hi(q)):360*Yu.degrees/H.getMetersPerUnit())/256/Math.pow(2,xD),Me=ue/Math.pow(2,28-xD);t=n.maxResolution,t!==void 0?f=0:t=ue/Math.pow(w,f),o=n.minResolution,o===void 0&&(n.maxZoom!==void 0?n.maxResolution!==void 0?o=t/Math.pow(w,v):o=ue/Math.pow(w,v):o=Me),v=f+Math.floor(Math.log(t/o)/Math.log(w)),o=t/Math.pow(w,v-f),n.constrainResolution?e=Vz(w,t,o,A,!W&&me,z):e=yD(t,o,A,!W&&me,z)}return{constraint:e,maxResolution:t,minResolution:o,minZoom:f,zoomFactor:w}}function SZ(n){if(n.enableRotation!==void 0?n.enableRotation:!0){let t=n.constrainRotation;return t===void 0||t===!0?Gz():t===!1?vD:typeof t=="number"?Uz(t):vD}return Ag}function DZ(n){return!(n.sourceCenter&&n.targetCenter&&!Wf(n.sourceCenter,n.targetCenter)||n.sourceResolution!==n.targetResolution||n.sourceRotation!==n.targetRotation)}function bD(n,e,t,o,a){let s=Math.cos(-a),f=Math.sin(-a),v=n[0]*s-n[1]*f,w=n[1]*s+n[0]*f;v+=(e[0]/2-t[0])*o,w+=(t[1]-e[1]/2)*o,f=-f;let D=v*s-w*f,A=w*s+v*f;return[D,A]}var Pa=wD;var Dv="ol-hidden";var md="ol-unselectable";var Rg="ol-control",ED="ol-collapsed",MZ=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),Hz=["style","variant","weight","size","lineHeight","family"],$w={normal:400,bold:700},Hw=function(n){let e=n.match(MZ);if(!e)return null;let t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"400",variant:"normal"};for(let o=0,a=Hz.length;o<a;++o){let s=e[o+1];s!==void 0&&(t[Hz[o]]=typeof s=="string"?s.trim():s)}return isNaN(Number(t.weight))&&t.weight in $w&&(t.weight=$w[t.weight]),t.families=t.family.split(/,\s?/).map(o=>o.trim().replace(/^['"]|['"]$/g,"")),t};function xi(n,e,t,o){let a;return t&&t.length?a=t.shift():to?a=new class extends OffscreenCanvas{style={}}(n??300,e??150):a=document.createElement("canvas"),n&&(a.width=n),e&&(a.height=e),a.getContext("2d",o)}var TD;function Lg(){return TD||(TD=xi(1,1)),TD}function ep(n){let e=n.canvas;e.width=1,e.height=1,n.clearRect(0,0,1,1)}function CD(n,e){let t=e.parentNode;t&&t.replaceChild(n,e)}function Zz(n){for(;n.lastChild;)n.lastChild.remove()}function qz(n,e){let t=n.childNodes;for(let o=0;;++o){let a=t[o],s=e[o];if(!a&&!s)break;if(a!==s){if(!a){n.appendChild(s);continue}if(!s){n.removeChild(a),--o;continue}n.insertBefore(s,a)}}}function Zw(){return new Proxy({childNodes:[],appendChild:function(e){return this.childNodes.push(e),e},remove:function(){},removeChild:function(e){let t=this.childNodes.indexOf(e);if(t===-1)throw new Error("Node to remove was not found");return this.childNodes.splice(t,1),e},insertBefore:function(e,t){let o=this.childNodes.indexOf(t);if(o===-1)throw new Error("Reference node not found");return this.childNodes.splice(o,0,e),e},style:{}},{get(e,t,o){return t==="firstElementChild"?e.childNodes.length>0?e.childNodes[0]:null:Reflect.get(e,t,o)}})}function $l(n){return typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas}var ID=class extends Ur{constructor(e){super();let t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){this.element?.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&this.element?.remove();for(let t=0,o=this.listenerKeys.length;t<o;++t)Gn(this.listenerKeys[t]);if(this.listenerKeys.length=0,this.map_=e,e){let t=this.target_??e.getOverlayContainerStopEvent();this.element&&t.appendChild(this.element),this.render!==Zu&&this.listenerKeys.push(xn(e,Bc.POSTRENDER,this.render,this)),e.render()}}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}},Og=ID;var SD=class extends Og{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=e.attributions;let t=e.className!==void 0?e.className:"ol-attribution",o=e.tipLabel!==void 0?e.tipLabel:"Attributions",a=e.expandClassName!==void 0?e.expandClassName:t+"-expand",s=e.collapseLabel!==void 0?e.collapseLabel:"\u203A",f=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=f):this.collapseLabel_=s;let v=e.label!==void 0?e.label:"i";typeof v=="string"?(this.label_=document.createElement("span"),this.label_.textContent=v,this.label_.className=a):this.label_=v;let w=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=o,this.toggleButton_.appendChild(w),this.toggleButton_.addEventListener(Ft.CLICK,this.handleClick_.bind(this),!1);let D=t+" "+md+" "+Rg+(this.collapsed_&&this.collapsible_?" "+ED:"")+(this.collapsible_?"":" ol-uncollapsible"),A=this.element;A.className=D,A.appendChild(this.toggleButton_),A.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){let t=this.getMap().getAllLayers(),o=new Set(t.flatMap(a=>a.getAttributions(e)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(a=>o.add(a)):o.add(this.attributions_)),!this.overrideCollapsible_){let a=!t.some(s=>s.getSource()?.getAttributionsCollapsible()===!1);this.setCollapsible(a)}return Array.from(o)}updateElement_(e){return kr(this,null,function*(){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}let t=yield Promise.all(this.collectSourceAttributions_(e).map(a=>ON(()=>a))),o=t.length>0;if(this.renderedVisible_!=o&&(this.element.style.display=o?"":"none",this.renderedVisible_=o),!is(t,this.renderedAttributions_)){Zz(this.ulElement_);for(let a=0,s=t.length;a<s;++a){let f=document.createElement("li");f.innerHTML=t[a],this.ulElement_.appendChild(f)}this.renderedAttributions_=t}})}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(ED),this.collapsed_?CD(this.collapseLabel_,this.label_):CD(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}},Wz=SD;var DD=class extends Og{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});let t=e.className!==void 0?e.className:"ol-rotate",o=e.label!==void 0?e.label:"\u21E7",a=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof o=="string"?(this.label_=document.createElement("span"),this.label_.className=a,this.label_.textContent=o):(this.label_=o,this.label_.classList.add(a));let s=e.tipLabel?e.tipLabel:"Reset rotation",f=document.createElement("button");f.className=t+"-reset",f.setAttribute("type","button"),f.title=s,f.appendChild(this.label_),f.addEventListener(Ft.CLICK,this.handleClick_.bind(this),!1);let v=t+" "+md+" "+Rg,w=this.element;w.className=v,w.appendChild(f),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Dv)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){let t=this.getMap().getView();if(!t)return;let o=t.getRotation();o!==void 0&&(this.duration_>0&&o%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:nl}):t.setRotation(0))}render(e){let t=e.frameState;if(!t)return;let o=t.viewState.rotation;if(o!=this.rotation_){let a="rotate("+o+"rad)";if(this.autoHide_){let s=this.element.classList.contains(Dv);!s&&o===0?this.element.classList.add(Dv):s&&o!==0&&this.element.classList.remove(Dv)}this.label_.style.transform=a}this.rotation_=o}},Xz=DD;var MD=class extends Og{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});let t=e.className!==void 0?e.className:"ol-zoom",o=e.delta!==void 0?e.delta:1,a=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",s=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",f=e.zoomInLabel!==void 0?e.zoomInLabel:"+",v=e.zoomOutLabel!==void 0?e.zoomOutLabel:"\u2013",w=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",D=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",A=document.createElement("button");A.className=a,A.setAttribute("type","button"),A.title=w,A.appendChild(typeof f=="string"?document.createTextNode(f):f),A.addEventListener(Ft.CLICK,this.handleClick_.bind(this,o),!1);let z=document.createElement("button");z.className=s,z.setAttribute("type","button"),z.title=D,z.appendChild(typeof v=="string"?document.createTextNode(v):v),z.addEventListener(Ft.CLICK,this.handleClick_.bind(this,-o),!1);let H=t+" "+md+" "+Rg,q=this.element;q.className=H,q.appendChild(A),q.appendChild(z),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){let o=this.getMap().getView();if(!o)return;let a=o.getZoom();if(a!==void 0){let s=o.getConstrainedZoom(a+e);this.duration_>0?(o.getAnimating()&&o.cancelAnimations(),o.animate({zoom:s,duration:this.duration_,easing:nl})):o.setZoom(s)}}},Yz=MD;function Kz(n){n=n||{};let e=new Vo;return(n.zoom!==void 0?n.zoom:!0)&&e.push(new Yz(n.zoomOptions)),(n.rotate!==void 0?n.rotate:!0)&&e.push(new Xz(n.rotateOptions)),(n.attribution!==void 0?n.attribution:!0)&&e.push(new Wz(n.attributionOptions)),e}var PD=class{constructor(e,t,o){this.decay_=e,this.minVelocity_=t,this.delay_=o,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;let e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let o=t-3;for(;o>0&&this.points_[o+2]>e;)o-=3;let a=this.points_[t+2]-this.points_[o+2];if(a<1e3/60)return!1;let s=this.points_[t]-this.points_[o],f=this.points_[t+1]-this.points_[o+1];return this.angle_=Math.atan2(f,s),this.initialVelocity_=Math.sqrt(s*s+f*f)/a,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}},Jz=PD;var AD={ACTIVE:"active"};var RD=class extends Ur{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(AD.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(AD.ACTIVE,e)}setMap(e){this.map_=e}};function Qz(n,e,t){let o=n.getCenterInternal();if(o){let a=[o[0]+e[0],o[1]+e[1]];n.animateInternal({duration:t!==void 0?t:250,easing:QN,center:n.getConstrainedCenter(a)})}}function kg(n,e,t,o){let a=n.getZoom();if(a===void 0)return;let s=n.getConstrainedZoom(a+e),f=n.getResolutionForZoom(s);n.getAnimating()&&n.cancelAnimations(),n.animate({resolution:f,anchor:t,duration:o!==void 0?o:250,easing:nl})}var Vc=RD;var LD=class extends Vc{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==$i.DBLCLICK){let o=e.originalEvent,a=e.map,s=e.coordinate,f=o.shiftKey?-this.delta_:this.delta_,v=a.getView();kg(v,f,s,this.duration_),o.preventDefault(),t=!0}return!t}},eB=LD;function Mv(n){let e=arguments;return function(t){let o=!0;for(let a=0,s=e.length;a<s&&(o=o&&e[a](t),!!o);++a);return o}}var tB=function(n){let e=n.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},PZ=function(n){let e=n.map.getTargetElement(),t=e.getRootNode(),o=n.map.getOwnerDocument().activeElement;return t instanceof ShadowRoot?t.host.contains(o):e.contains(o)},qw=function(n){let e=n.map.getTargetElement(),t=e.getRootNode();return(t instanceof ShadowRoot?t.host:e).hasAttribute("tabindex")?PZ(n):!0},nB=$u;var Ww=function(n){let e=n.originalEvent;return"pointerId"in e&&e.button==0&&!(FN&&RS&&e.ctrlKey)};var Xw=function(n){let e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey};var iB=function(n){let e=n.originalEvent;return RS?e.metaKey:e.ctrlKey},rB=function(n){let e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Yw=function(n){let e=n.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},Kw=function(n){let e=n.originalEvent;return"pointerId"in e&&e.pointerType=="mouse"};var oB=function(n){let e=n.originalEvent;return"pointerId"in e&&e.isPrimary&&e.button===0};var OD=class extends Vc{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==$i.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==$i.POINTERUP){let o=this.handleUpEvent(e);this.handlingDownUpSequence=o&&this.targetPointers.length>0}}else if(e.type==$i.POINTERDOWN){let o=this.handleDownEvent(e);this.handlingDownUpSequence=o,t=this.stopDown(o)}else e.type==$i.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}};function Fg(n){let e=n.length,t=0,o=0;for(let a=0;a<e;a++)t+=n[a].clientX,o+=n[a].clientY;return{clientX:t/e,clientY:o/e}}var Uc=OD;var kD=class extends Uc{constructor(e){super({stopDown:Hu}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;let t=e.condition?e.condition:Mv(Xw,oB);this.condition_=e.onFocusOnly?Mv(qw,t):t,this.noKinetic_=!1}handleDragEvent(e){let t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());let o=this.targetPointers,a=t.getEventPixel(Fg(o));if(o.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(a[0],a[1]),this.lastCentroid){let s=[this.lastCentroid[0]-a[0],a[1]-this.lastCentroid[1]],v=e.map.getView();YN(s,v.getResolution()),Tg(s,v.getRotation()),v.adjustCenterInternal(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=a,this.lastPointersCount_=o.length,e.originalEvent.preventDefault()}handleUpEvent(e){let t=e.map,o=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){let a=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),f=o.getCenterInternal(),v=t.getPixelFromCoordinateInternal(f),w=t.getCoordinateFromPixelInternal([v[0]-a*Math.cos(s),v[1]-a*Math.sin(s)]);o.animateInternal({center:o.getConstrainedCenter(w),duration:500,easing:nl})}return this.panning_&&(this.panning_=!1,o.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){let o=e.map.getView();return this.lastCentroid=null,o.getAnimating()&&o.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},sB=kD;var FD=class extends Uc{constructor(e){e=e||{},super({stopDown:Hu}),this.condition_=e.condition?e.condition:tB,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!Kw(e))return;let t=e.map,o=t.getView();if(o.getConstraints().rotation===Ag)return;let a=t.getSize(),s=e.pixel,f=Math.atan2(a[1]/2-s[1],s[0]-a[0]/2);if(this.lastAngle_!==void 0){let v=f-this.lastAngle_;o.adjustRotationInternal(-v)}this.lastAngle_=f}handleUpEvent(e){return Kw(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return Kw(e)&&Ww(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}},aB=FD;var ND=class extends td{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){let e=this.startPixel_,t=this.endPixel_,o="px",a=this.element_.style;a.left=Math.min(e[0],t[0])+o,a.top=Math.min(e[1],t[1])+o,a.width=Math.abs(t[0]-e[0])+o,a.height=Math.abs(t[1]-e[1])+o}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);let t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;let e=this.startPixel_,t=this.endPixel_,a=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);a[4]=a[0].slice(),this.geometry_?this.geometry_.setCoordinates([a]):this.geometry_=new pd([a])}getGeometry(){return this.geometry_}},lB=ND;var Ng={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"},tp=class extends Co{constructor(e,t,o){super(e),this.coordinate=t,this.mapBrowserEvent=o}},zD=class extends Uc{constructor(e){super(),this.on,this.once,this.un,e=e??{},this.box_=new lB(e.className||"ol-dragbox"),this.minArea_=e.minArea??64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition??Ww,this.boxEndCondition_=e.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,o){let a=o[0]-t[0],s=o[1]-t[1];return a*a+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.startPixel_&&(this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new tp(Ng.BOXDRAG,e.coordinate,e)))}handleUpEvent(e){if(!this.startPixel_)return!1;let t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new tp(t?Ng.BOXEND:Ng.BOXCANCEL,e.coordinate,e)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new tp(Ng.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}setActive(e){e||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new tp(Ng.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(e)}setMap(e){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new tp(Ng.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(e)}},cB=zD;var BD=class extends cB{constructor(e){e=e||{};let t=e.condition?e.condition:rB;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){let o=this.getMap().getView(),a=this.getGeometry();if(this.out_){let s=o.rotatedExtentForGeometry(a),f=o.getResolutionForExtentInternal(s),v=o.getResolution()/f;a=a.clone(),a.scale(v*v)}o.fitInternal(a,{duration:this.duration_,easing:nl})}},uB=BD;var gd={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};var jD=class extends Vc{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return Xw(t)&&Yw(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==Ft.KEYDOWN){let o=e.originalEvent,a=o.key;if(this.condition_(e)&&(a==gd.DOWN||a==gd.LEFT||a==gd.RIGHT||a==gd.UP)){let f=e.map.getView(),v=f.getResolution()*this.pixelDelta_,w=0,D=0;a==gd.DOWN?D=-v:a==gd.LEFT?w=-v:a==gd.RIGHT?w=v:D=v;let A=[w,D];Tg(A,f.getRotation()),Qz(f,A,this.duration_),o.preventDefault(),t=!0}}return!t}},hB=jD;var VD=class extends Vc{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!iB(t)&&Yw(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==Ft.KEYDOWN||e.type==Ft.KEYPRESS){let o=e.originalEvent,a=o.key;if(this.condition_(e)&&(a==="+"||a==="-")){let s=e.map,f=a==="+"?this.delta_:-this.delta_,v=s.getView();kg(v,f,void 0,this.duration_),o.preventDefault(),t=!0}}return!t}},dB=VD;var AZ=40,RZ=300,UD=class extends Vc{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;let t=e.condition?e.condition:nB;this.condition_=e.onFocusOnly?Mv(qw,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;let e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(e){if(!this.condition_(e)||e.type!==Ft.WHEEL)return!0;let o=e.map,a=e.originalEvent;a.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.pixel);let s=a.deltaY;switch(a.deltaMode){case WheelEvent.DOM_DELTA_LINE:s*=AZ;break;case WheelEvent.DOM_DELTA_PAGE:s*=RZ;break;default:}if(s===0)return!1;this.lastDelta_=s;let f=Date.now();this.startTime_===void 0&&(this.startTime_=f),(!this.mode_||f-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel");let v=o.getView();if(this.mode_==="trackpad"&&!(v.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(v.getAnimating()&&v.cancelAnimations(),v.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),v.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_?o.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=f,!1;this.totalDelta_+=s;let w=Math.max(this.timeout_-(f-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,o),w),!1}handleWheelZoom_(e){let t=e.getView();t.getAnimating()&&t.cancelAnimations();let o=-ci(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(o=o?o>0?1:-1:0),kg(t,o,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}},fB=UD;var GD=class extends Uc{constructor(e){e=e||{};let t=e;t.stopDown||(t.stopDown=Hu),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0,o=this.targetPointers[0],a=this.targetPointers[1],s=Math.atan2(a.clientY-o.clientY,a.clientX-o.clientX);if(this.lastAngle_!==void 0){let w=s-this.lastAngle_;this.rotationDelta_+=w,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=w}this.lastAngle_=s;let f=e.map,v=f.getView();v.getConstraints().rotation!==Ag&&(this.anchor_=f.getCoordinateFromPixelInternal(f.getEventPixel(Fg(this.targetPointers))),this.rotating_&&(f.render(),v.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){let t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}},pB=GD;var $D=class extends Uc{constructor(e){e=e||{};let t=e;t.stopDown||(t.stopDown=Hu),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1,o=this.targetPointers[0],a=this.targetPointers[1],s=o.clientX-a.clientX,f=o.clientY-a.clientY,v=Math.sqrt(s*s+f*f);this.lastDistance_!==void 0&&(t=this.lastDistance_/v),this.lastDistance_=v;let w=e.map,D=w.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=w.getCoordinateFromPixelInternal(w.getEventPixel(Fg(this.targetPointers))),w.render(),D.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){let o=e.map.getView(),a=this.lastScaleDelta_>1?1:-1;return o.endInteraction(this.duration_,a),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){let t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}},mB=$D;function gB(n){n=n||{};let e=new Vo,t=new Jz(-.005,.05,100);return(n.altShiftDragRotate!==void 0?n.altShiftDragRotate:!0)&&e.push(new aB),(n.doubleClickZoom!==void 0?n.doubleClickZoom:!0)&&e.push(new eB({delta:n.zoomDelta,duration:n.zoomDuration})),(n.dragPan!==void 0?n.dragPan:!0)&&e.push(new sB({onFocusOnly:n.onFocusOnly,kinetic:t})),(n.pinchRotate!==void 0?n.pinchRotate:!0)&&e.push(new pB),(n.pinchZoom!==void 0?n.pinchZoom:!0)&&e.push(new mB({duration:n.zoomDuration})),(n.keyboard!==void 0?n.keyboard:!0)&&(e.push(new hB),e.push(new dB({delta:n.zoomDelta,duration:n.zoomDuration}))),(n.mouseWheelZoom!==void 0?n.mouseWheelZoom:!0)&&e.push(new fB({onFocusOnly:n.onFocusOnly,duration:n.zoomDuration})),(n.shiftDragZoom!==void 0?n.shiftDragZoom:!0)&&e.push(new uB({duration:n.zoomDuration})),e}var fi={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};var HD=class extends Ur{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;let t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[fi.OPACITY]=e.opacity!==void 0?e.opacity:1,Cn(typeof t[fi.OPACITY]=="number","Layer opacity must be a number"),t[fi.VISIBLE]=e.visible!==void 0?e.visible:!0,t[fi.Z_INDEX]=e.zIndex,t[fi.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[fi.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[fi.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[fi.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){let t=this.state_||{layer:this,managed:e===void 0?!0:e},o=this.getZIndex();return t.opacity=ci(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=o===void 0&&!t.managed?1/0:o,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return Xt()}getLayerStatesArray(e){return Xt()}getExtent(){return this.get(fi.EXTENT)}getMaxResolution(){return this.get(fi.MAX_RESOLUTION)}getMinResolution(){return this.get(fi.MIN_RESOLUTION)}getMinZoom(){return this.get(fi.MIN_ZOOM)}getMaxZoom(){return this.get(fi.MAX_ZOOM)}getOpacity(){return this.get(fi.OPACITY)}getSourceState(){return Xt()}getVisible(){return this.get(fi.VISIBLE)}getZIndex(){return this.get(fi.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(fi.EXTENT,e)}setMaxResolution(e){this.set(fi.MAX_RESOLUTION,e)}setMinResolution(e){this.set(fi.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(fi.MAX_ZOOM,e)}setMinZoom(e){this.set(fi.MIN_ZOOM,e)}setOpacity(e){Cn(typeof e=="number","Layer opacity must be a number"),this.set(fi.OPACITY,e)}setVisible(e){this.set(fi.VISIBLE,e)}setZIndex(e){this.set(fi.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}},Jw=HD;var _d={ADDLAYER:"addlayer",REMOVELAYER:"removelayer"},Hl=class extends Co{constructor(e,t){super(e),this.layer=t}},ZD={LAYERS:"layers"},qD=class n extends Jw{constructor(e){e=e||{};let t=Object.assign({},e);delete t.layers;let o=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(ZD.LAYERS,this.handleLayersChanged_),o?Array.isArray(o)?o=new Vo(o.slice(),{unique:!0}):Cn(typeof o.getArray=="function","Expected `layers` to be an array or a `Collection`"):o=new Vo(void 0,{unique:!0}),this.setLayers(o)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Gn),this.layersListenerKeys_.length=0;let e=this.getLayers();this.layersListenerKeys_.push(xn(e,To.ADD,this.handleLayersAdd_,this),xn(e,To.REMOVE,this.handleLayersRemove_,this));for(let o in this.listenerKeys_)this.listenerKeys_[o].forEach(Gn);Nc(this.listenerKeys_);let t=e.getArray();for(let o=0,a=t.length;o<a;o++){let s=t[o];this.registerLayerListeners_(s),this.dispatchEvent(new Hl(_d.ADDLAYER,s))}this.changed()}registerLayerListeners_(e){let t=[xn(e,Nl.PROPERTYCHANGE,this.handleLayerChange_,this),xn(e,Ft.CHANGE,this.handleLayerChange_,this)];e instanceof n&&t.push(xn(e,_d.ADDLAYER,this.handleLayerGroupAdd_,this),xn(e,_d.REMOVELAYER,this.handleLayerGroupRemove_,this)),this.listenerKeys_[dn(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new Hl(_d.ADDLAYER,e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new Hl(_d.REMOVELAYER,e.layer))}handleLayersAdd_(e){let t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new Hl(_d.ADDLAYER,t)),this.changed()}handleLayersRemove_(e){let t=e.element,o=dn(t);this.listenerKeys_[o].forEach(Gn),delete this.listenerKeys_[o],this.dispatchEvent(new Hl(_d.REMOVELAYER,t)),this.changed()}getLayers(){return this.get(ZD.LAYERS)}setLayers(e){let t=this.getLayers();if(t){let o=t.getArray();for(let a=0,s=o.length;a<s;++a)this.dispatchEvent(new Hl(_d.REMOVELAYER,o[a]))}this.set(ZD.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){let t=e!==void 0?e:[],o=t.length;this.getLayers().forEach(function(f){f.getLayerStatesArray(t)});let a=this.getLayerState(),s=a.zIndex;!e&&a.zIndex===void 0&&(s=0);for(let f=o,v=t.length;f<v;f++){let w=t[f];w.opacity*=a.opacity,w.visible=w.visible&&a.visible,w.maxResolution=Math.min(w.maxResolution,a.maxResolution),w.minResolution=Math.max(w.minResolution,a.minResolution),w.minZoom=Math.max(w.minZoom,a.minZoom),w.maxZoom=Math.min(w.maxZoom,a.maxZoom),a.extent!==void 0&&(w.extent!==void 0?w.extent=jc(w.extent,a.extent):w.extent=a.extent),w.zIndex===void 0&&(w.zIndex=s)}return t}getSourceState(){return"ready"}},Pv=qD;var Ho={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};var WD=class extends Jw{constructor(e){let t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(fi.SOURCE,this.handleSourcePropertyChange_);let o=e.source?e.source:null;this.setSource(o)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(fi.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){let e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Gn(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;let e=this.getSource();e&&(this.sourceChangeKey_=xn(e,Ft.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t,o=this.getMapInternal();!e&&o&&(e=o.getView()),e instanceof Pa?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&o&&(t.layerStatesArray=o.getLayerGroup().getLayerStatesArray());let a;if(t.layerStatesArray){if(a=t.layerStatesArray.find(f=>f.layer===this),!a)return!1}else a=this.getLayerState();let s=this.getExtent();return Av(a,t.viewState)&&(!s||lr(s,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];let t=this.getSource()?.getAttributions();if(!t)return[];let o=e instanceof Pa?e.getViewStateAndExtent():e,a=t(o);return Array.isArray(a)||(a=[a]),a}render(e,t){let o=this.getRenderer();return o.prepareFrame(e)?(this.rendered=!0,o.renderFrame(e,t)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(e,t){}renderDeferred(e){let t=this.getRenderer();t&&t.renderDeferred(e)}setMapInternal(e){e||this.unrender(),this.set(fi.MAP,e)}getMapInternal(){return this.get(fi.MAP)}setMap(e){this.mapPrecomposeKey_&&(Gn(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(Gn(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=xn(e,Ho.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=xn(this,Ft.CHANGE,e.render,e),this.changed())}handlePrecompose_(e){let t=e.frameState.layerStatesArray,o=this.getLayerState(!1);Cn(!t.some(a=>a.layer===o.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),t.push(o)}setSource(e){this.set(fi.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}};function Av(n,e){if(!n.visible)return!1;let t=e.resolution;if(t<n.minResolution||t>=n.maxResolution)return!1;let o=e.zoom;return o>n.minZoom&&o<=n.maxZoom}var np=WD;function Qw(n,e,t=0,o=n.length-1,a=LZ){for(;o>t;){if(o-t>600){let w=o-t+1,D=e-t+1,A=Math.log(w),z=.5*Math.exp(2*A/3),H=.5*Math.sqrt(A*z*(w-z)/w)*(D-w/2<0?-1:1),q=Math.max(t,Math.floor(e-D*z/w+H)),W=Math.min(o,Math.floor(e+(w-D)*z/w+H));Qw(n,e,q,W,a)}let s=n[e],f=t,v=o;for(Rv(n,t,e),a(n[o],s)>0&&Rv(n,t,o);f<v;){for(Rv(n,f,v),f++,v--;a(n[f],s)<0;)f++;for(;a(n[v],s)>0;)v--}a(n[t],s)===0?Rv(n,t,v):(v++,Rv(n,v,o)),v<=e&&(t=v+1),e<=v&&(o=v-1)}}function Rv(n,e,t){let o=n[e];n[e]=n[t],n[t]=o}function LZ(n,e){return n<e?-1:n>e?1:0}var jg=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data,o=[];if(!t1(e,t))return o;let a=this.toBBox,s=[];for(;t;){for(let f=0;f<t.children.length;f++){let v=t.children[f],w=t.leaf?a(v):v;t1(e,w)&&(t.leaf?o.push(v):YD(e,w)?this._all(v,o):s.push(v))}t=s.pop()}return o}collides(e){let t=this.data;if(!t1(e,t))return!1;let o=[];for(;t;){for(let a=0;a<t.children.length;a++){let s=t.children[a],f=t.leaf?this.toBBox(s):s;if(t1(e,f)){if(t.leaf||YD(e,f))return!0;o.push(s)}}t=o.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let o=0;o<e.length;o++)this.insert(e[o]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){let o=this.data;this.data=t,t=o}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=Bg([]),this}remove(e,t){if(!e)return this;let o=this.data,a=this.toBBox(e),s=[],f=[],v,w,D;for(;o||s.length;){if(o||(o=s.pop(),w=s[s.length-1],v=f.pop(),D=!0),o.leaf){let A=OZ(e,o.children,t);if(A!==-1)return o.children.splice(A,1),s.push(o),this._condense(s),this}!D&&!o.leaf&&YD(o,a)?(s.push(o),f.push(v),v=0,w=o,o=o.children[0]):w?(v++,o=w.children[v],D=!1):o=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){let o=[];for(;e;)e.leaf?t.push(...e.children):o.push(...e.children),e=o.pop();return t}_build(e,t,o,a){let s=o-t+1,f=this._maxEntries,v;if(s<=f)return v=Bg(e.slice(t,o+1)),zg(v,this.toBBox),v;a||(a=Math.ceil(Math.log(s)/Math.log(f)),f=Math.ceil(s/Math.pow(f,a-1))),v=Bg([]),v.leaf=!1,v.height=a;let w=Math.ceil(s/f),D=w*Math.ceil(Math.sqrt(f));_B(e,t,o,D,this.compareMinX);for(let A=t;A<=o;A+=D){let z=Math.min(A+D-1,o);_B(e,A,z,w,this.compareMinY);for(let H=A;H<=z;H+=w){let q=Math.min(H+w-1,z);v.children.push(this._build(e,H,q,a-1))}}return zg(v,this.toBBox),v}_chooseSubtree(e,t,o,a){for(;a.push(t),!(t.leaf||a.length-1===o);){let s=1/0,f=1/0,v;for(let w=0;w<t.children.length;w++){let D=t.children[w],A=XD(D),z=NZ(e,D)-A;z<f?(f=z,s=A<s?A:s,v=D):z===f&&A<s&&(s=A,v=D)}t=v||t.children[0]}return t}_insert(e,t,o){let a=o?e:this.toBBox(e),s=[],f=this._chooseSubtree(a,this.data,t,s);for(f.children.push(e),Ov(f,a);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(a,s,t)}_split(e,t){let o=e[t],a=o.children.length,s=this._minEntries;this._chooseSplitAxis(o,s,a);let f=this._chooseSplitIndex(o,s,a),v=Bg(o.children.splice(f,o.children.length-f));v.height=o.height,v.leaf=o.leaf,zg(o,this.toBBox),zg(v,this.toBBox),t?e[t-1].children.push(v):this._splitRoot(o,v)}_splitRoot(e,t){this.data=Bg([e,t]),this.data.height=e.height+1,this.data.leaf=!1,zg(this.data,this.toBBox)}_chooseSplitIndex(e,t,o){let a,s=1/0,f=1/0;for(let v=t;v<=o-t;v++){let w=Lv(e,0,v,this.toBBox),D=Lv(e,v,o,this.toBBox),A=zZ(w,D),z=XD(w)+XD(D);A<s?(s=A,a=v,f=z<f?z:f):A===s&&z<f&&(f=z,a=v)}return a||o-t}_chooseSplitAxis(e,t,o){let a=e.leaf?this.compareMinX:kZ,s=e.leaf?this.compareMinY:FZ,f=this._allDistMargin(e,t,o,a),v=this._allDistMargin(e,t,o,s);f<v&&e.children.sort(a)}_allDistMargin(e,t,o,a){e.children.sort(a);let s=this.toBBox,f=Lv(e,0,t,s),v=Lv(e,o-t,o,s),w=e1(f)+e1(v);for(let D=t;D<o-t;D++){let A=e.children[D];Ov(f,e.leaf?s(A):A),w+=e1(f)}for(let D=o-t-1;D>=t;D--){let A=e.children[D];Ov(v,e.leaf?s(A):A),w+=e1(v)}return w}_adjustParentBBoxes(e,t,o){for(let a=o;a>=0;a--)Ov(t[a],e)}_condense(e){for(let t=e.length-1,o;t>=0;t--)e[t].children.length===0?t>0?(o=e[t-1].children,o.splice(o.indexOf(e[t]),1)):this.clear():zg(e[t],this.toBBox)}};function OZ(n,e,t){if(!t)return e.indexOf(n);for(let o=0;o<e.length;o++)if(t(n,e[o]))return o;return-1}function zg(n,e){Lv(n,0,n.children.length,e,n)}function Lv(n,e,t,o,a){a||(a=Bg(null)),a.minX=1/0,a.minY=1/0,a.maxX=-1/0,a.maxY=-1/0;for(let s=e;s<t;s++){let f=n.children[s];Ov(a,n.leaf?o(f):f)}return a}function Ov(n,e){return n.minX=Math.min(n.minX,e.minX),n.minY=Math.min(n.minY,e.minY),n.maxX=Math.max(n.maxX,e.maxX),n.maxY=Math.max(n.maxY,e.maxY),n}function kZ(n,e){return n.minX-e.minX}function FZ(n,e){return n.minY-e.minY}function XD(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function e1(n){return n.maxX-n.minX+(n.maxY-n.minY)}function NZ(n,e){return(Math.max(e.maxX,n.maxX)-Math.min(e.minX,n.minX))*(Math.max(e.maxY,n.maxY)-Math.min(e.minY,n.minY))}function zZ(n,e){let t=Math.max(n.minX,e.minX),o=Math.max(n.minY,e.minY),a=Math.min(n.maxX,e.maxX),s=Math.min(n.maxY,e.maxY);return Math.max(0,a-t)*Math.max(0,s-o)}function YD(n,e){return n.minX<=e.minX&&n.minY<=e.minY&&e.maxX<=n.maxX&&e.maxY<=n.maxY}function t1(n,e){return e.minX<=n.maxX&&e.minY<=n.maxY&&e.maxX>=n.minX&&e.maxY>=n.minY}function Bg(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function _B(n,e,t,o,a){let s=[e,t];for(;s.length;){if(t=s.pop(),e=s.pop(),t-e<=o)continue;let f=e+Math.ceil((t-e)/o/2)*o;Qw(n,f,e,t,a),s.push(e,f,f,t)}}var i1=[NaN,NaN,NaN,0],KD;function BZ(){return KD||(KD=xi(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),KD}var jZ=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,VZ=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,UZ=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,GZ=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function n1(n,e){return n.endsWith("%")?Number(n.substring(0,n.length-1))/e:Number(n)}function Fv(n){throw new Error('failed to parse "'+n+'" as color')}function yB(n){if(n.toLowerCase().startsWith("rgb")){let s=n.match(VZ)||n.match(jZ)||n.match(UZ);if(s){let f=s[4],v=100/255;return[ci(n1(s[1],v)+.5|0,0,255),ci(n1(s[2],v)+.5|0,0,255),ci(n1(s[3],v)+.5|0,0,255),f!==void 0?ci(n1(f,100),0,1):1]}Fv(n)}if(n.startsWith("#")){if(GZ.test(n)){let s=n.substring(1),f=s.length<=4?1:2,v=[0,0,0,255];for(let w=0,D=s.length;w<D;w+=f){let A=parseInt(s.substring(w,w+f),16);f===1&&(A+=A<<4),v[w/f]=A}return v[3]=v[3]/255,v}Fv(n)}let e=BZ();e.fillStyle="#abcdef";let t=e.fillStyle;e.fillStyle=n,e.fillStyle===t&&(e.fillStyle="#fedcba",t=e.fillStyle,e.fillStyle=n,e.fillStyle===t&&Fv(n));let o=e.fillStyle;if(o.startsWith("#")||o.startsWith("rgba"))return yB(o);e.clearRect(0,0,1,1),e.fillRect(0,0,1,1);let a=Array.from(e.getImageData(0,0,1,1).data);return a[3]=Hf(a[3]/255,3),a}function vB(n){return typeof n=="string"?n:zv(n)}var $Z=1024,kv={},JD=0;function xB(n){if(n.length===4)return n;let e=n.slice();return e[3]=1,e}function QD(n){return n>.0031308?Math.pow(n,1/2.4)*269.025-14.025:n*3294.6}function eM(n){return n>.2068965?Math.pow(n,3):(n-4/29)*(108/841)}function tM(n){return n>10.314724?Math.pow((n+14.025)/269.025,2.4):n/3294.6}function nM(n){return n>.0088564?Math.pow(n,1/3):n/(108/841)+4/29}function iM(n){let e=tM(n[0]),t=tM(n[1]),o=tM(n[2]),a=nM(e*.222488403+t*.716873169+o*.06060791),s=500*(nM(e*.452247074+t*.399439023+o*.148375274)-a),f=200*(a-nM(e*.016863605+t*.117638439+o*.865350722)),v=Math.atan2(f,s)*(180/Math.PI);return[116*a-16,Math.sqrt(s*s+f*f),v<0?v+360:v,n[3]]}function bB(n){let e=(n[0]+16)/116,t=n[1],o=n[2]*Math.PI/180,a=eM(e),s=eM(e+t/500*Math.cos(o)),f=eM(e-t/200*Math.sin(o)),v=QD(s*3.021973625-a*1.617392459-f*.404875592),w=QD(s*-.943766287+a*1.916279586+f*.027607165),D=QD(s*.069407491-a*.22898585+f*1.159737864);return[ci(v+.5|0,0,255),ci(w+.5|0,0,255),ci(D+.5|0,0,255),n[3]]}function Nv(n){if(n==="none")return i1;if(kv.hasOwnProperty(n))return kv[n];if(JD>=$Z){let t=0;for(let o in kv)(t++&3)===0&&(delete kv[o],--JD)}let e=yB(n);e.length!==4&&Fv(n);for(let t of e)isNaN(t)&&Fv(n);return kv[n]=e,++JD,e}function Zl(n){return Array.isArray(n)?n:Nv(n)}function zv(n){let e=n[0];e!=(e|0)&&(e=e+.5|0);let t=n[1];t!=(t|0)&&(t=t+.5|0);let o=n[2];o!=(o|0)&&(o=o+.5|0);let a=n[3]===void 0?1:Math.round(n[3]*1e3)/1e3;return"rgba("+e+","+t+","+o+","+a+")"}function rM(n){return n[0]>0&&n[1]>0}function wB(n,e,t){return t===void 0&&(t=[0,0]),t[0]=n[0]*e+.5|0,t[1]=n[1]*e+.5|0,t}function gr(n,e){return Array.isArray(n)?n:(e===void 0?e=[n,n]:(e[0]=n,e[1]=n),e)}var ip=0;var rs=1<<ip++,qn=1<<ip++,vs=1<<ip++,Aa=1<<ip++,vd=1<<ip++,Bv=1<<ip++,r1=Math.pow(2,ip)-1,aM={[rs]:"boolean",[qn]:"number",[vs]:"string",[Aa]:"color",[vd]:"number[]",[Bv]:"size"},HZ=Object.keys(aM).map(Number).sort(Gs);function ZZ(n){return n in aM}function jv(n){let e=[];for(let t of HZ)Vv(n,t)&&e.push(aM[t]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function Vv(n,e){return(n&e)===e}function yd(n,e){return n===e}var _r=class{constructor(e,t){if(!ZZ(e))throw new Error(`literal expressions must have a specific type, got ${jv(e)}`);this.type=e,this.value=t}},sM=class{constructor(e,t,...o){this.type=e,this.operator=t,this.args=o}};function lM(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function So(n,e,t){switch(typeof n){case"boolean":{if(yd(e,vs))return new _r(vs,n?"true":"false");if(!Vv(e,rs))throw new Error(`got a boolean, but expected ${jv(e)}`);return new _r(rs,n)}case"number":{if(yd(e,Bv))return new _r(Bv,gr(n));if(yd(e,rs))return new _r(rs,!!n);if(yd(e,vs))return new _r(vs,n.toString());if(!Vv(e,qn))throw new Error(`got a number, but expected ${jv(e)}`);return new _r(qn,n)}case"string":{if(yd(e,Aa))return new _r(Aa,Nv(n));if(yd(e,rs))return new _r(rs,!!n);if(!Vv(e,vs))throw new Error(`got a string, but expected ${jv(e)}`);return new _r(vs,n)}default:}if(!Array.isArray(n))throw new Error("expression must be an array or a primitive value");if(n.length===0)throw new Error("empty expression");if(typeof n[0]=="string")return iq(n,e,t);for(let o of n)if(typeof o!="number")throw new Error("expected an array of numbers");if(yd(e,Bv)){if(n.length!==2)throw new Error(`expected an array of two values for a size, got ${n.length}`);return new _r(Bv,n)}if(yd(e,Aa)){if(n.length===3)return new _r(Aa,[...n,1]);if(n.length===4)return new _r(Aa,n);throw new Error(`expected an array of 3 or 4 values for a color, got ${n.length}`)}if(!Vv(e,vd))throw new Error(`got an array of numbers, but expected ${jv(e)}`);return new _r(vd,n)}var Je={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},qZ={[Je.Get]:fn(On(1,1/0),EB),[Je.Var]:fn(On(1,1),WZ),[Je.Has]:fn(On(1,1/0),EB),[Je.Id]:fn(XZ,Vg),[Je.Concat]:fn(On(2,1/0),pi(vs)),[Je.GeometryType]:fn(YZ,Vg),[Je.LineMetric]:fn(Vg),[Je.Resolution]:fn(oM,Vg),[Je.Zoom]:fn(oM,Vg),[Je.Time]:fn(oM,Vg),[Je.Any]:fn(On(2,1/0),pi(rs)),[Je.All]:fn(On(2,1/0),pi(rs)),[Je.Not]:fn(On(1,1),pi(rs)),[Je.Equal]:fn(On(2,2),pi(r1)),[Je.NotEqual]:fn(On(2,2),pi(r1)),[Je.GreaterThan]:fn(On(2,2),pi(qn)),[Je.GreaterThanOrEqualTo]:fn(On(2,2),pi(qn)),[Je.LessThan]:fn(On(2,2),pi(qn)),[Je.LessThanOrEqualTo]:fn(On(2,2),pi(qn)),[Je.Multiply]:fn(On(2,1/0),TB),[Je.Coalesce]:fn(On(2,1/0),TB),[Je.Divide]:fn(On(2,2),pi(qn)),[Je.Add]:fn(On(2,1/0),pi(qn)),[Je.Subtract]:fn(On(2,2),pi(qn)),[Je.Clamp]:fn(On(3,3),pi(qn)),[Je.Mod]:fn(On(2,2),pi(qn)),[Je.Pow]:fn(On(2,2),pi(qn)),[Je.Abs]:fn(On(1,1),pi(qn)),[Je.Floor]:fn(On(1,1),pi(qn)),[Je.Ceil]:fn(On(1,1),pi(qn)),[Je.Round]:fn(On(1,1),pi(qn)),[Je.Sin]:fn(On(1,1),pi(qn)),[Je.Cos]:fn(On(1,1),pi(qn)),[Je.Atan]:fn(On(1,2),pi(qn)),[Je.Sqrt]:fn(On(1,1),pi(qn)),[Je.Match]:fn(On(4,1/0),CB,JZ),[Je.Between]:fn(On(3,3),pi(qn)),[Je.Interpolate]:fn(On(6,1/0),CB,QZ),[Je.Case]:fn(On(3,1/0),KZ,eq),[Je.In]:fn(On(2,2),tq),[Je.Number]:fn(On(1,1/0),pi(r1)),[Je.String]:fn(On(1,1/0),pi(r1)),[Je.Array]:fn(On(1,1/0),pi(qn)),[Je.Color]:fn(On(1,4),pi(qn)),[Je.Band]:fn(On(1,3),pi(qn)),[Je.Palette]:fn(On(2,2),nq),[Je.ToString]:fn(On(1,1),pi(rs|qn|vs|Aa))};function EB(n,e,t){let o=n.length-1,a=new Array(o);for(let s=0;s<o;++s){let f=n[s+1];switch(typeof f){case"number":{a[s]=new _r(qn,f);break}case"string":{a[s]=new _r(vs,f);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${f}`)}s===0&&t.properties.add(String(f))}return a}function WZ(n,e,t){let o=n[1];if(typeof o!="string")throw new Error("expected a string argument for var operation");return t.variables.add(o),[new _r(vs,o)]}function XZ(n,e,t){t.featureId=!0}function YZ(n,e,t){t.geometryType=!0}function oM(n,e,t){t.mapState=!0}function Vg(n,e,t){let o=n[0];if(n.length!==1)throw new Error(`expected no arguments for ${o} operation`);return[]}function On(n,e){return function(t,o,a){let s=t[0],f=t.length-1;if(n===e){if(f!==n){let v=n===1?"":"s";throw new Error(`expected ${n} argument${v} for ${s}, got ${f}`)}}else if(f<n||f>e){let v=e===1/0?`${n} or more`:`${n} to ${e}`;throw new Error(`expected ${v} arguments for ${s}, got ${f}`)}}}function TB(n,e,t){let o=n.length-1,a=new Array(o);for(let s=0;s<o;++s){let f=So(n[s+1],e,t);a[s]=f}return a}function pi(n){return function(e,t,o){let a=e.length-1,s=new Array(a);for(let f=0;f<a;++f){let v=So(e[f+1],n,o);s[f]=v}return s}}function KZ(n,e,t){let o=n[0],a=n.length-1;if(a%2===0)throw new Error(`expected an odd number of arguments for ${o}, got ${a} instead`)}function CB(n,e,t){let o=n[0],a=n.length-1;if(a%2===1)throw new Error(`expected an even number of arguments for operation ${o}, got ${a} instead`)}function JZ(n,e,t){let o=n.length-1,a=vs|qn|rs,s=So(n[1],a,t),f=So(n[n.length-1],e,t),v=new Array(o-2);for(let w=0;w<o-2;w+=2){try{let D=So(n[w+2],s.type,t);v[w]=D}catch(D){throw new Error(`failed to parse argument ${w+1} of match expression: ${D.message}`)}try{let D=So(n[w+3],f.type,t);v[w+1]=D}catch(D){throw new Error(`failed to parse argument ${w+2} of match expression: ${D.message}`)}}return[s,...v,f]}function QZ(n,e,t){let o=n[1],a;switch(o[0]){case"linear":a=1;break;case"exponential":let w=o[1];if(typeof w!="number"||w<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(w)} instead`);a=w;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(o)}`)}let s=new _r(qn,a),f;try{f=So(n[2],qn,t)}catch(w){throw new Error(`failed to parse argument 1 in interpolate expression: ${w.message}`)}let v=new Array(n.length-3);for(let w=0;w<v.length;w+=2){try{let D=So(n[w+3],qn,t);v[w]=D}catch(D){throw new Error(`failed to parse argument ${w+2} for interpolate expression: ${D.message}`)}try{let D=So(n[w+4],e,t);v[w+1]=D}catch(D){throw new Error(`failed to parse argument ${w+3} for interpolate expression: ${D.message}`)}}return[s,f,...v]}function eq(n,e,t){let o=So(n[n.length-1],e,t),a=new Array(n.length-1);for(let s=0;s<a.length-1;s+=2){try{let f=So(n[s+1],rs,t);a[s]=f}catch(f){throw new Error(`failed to parse argument ${s} of case expression: ${f.message}`)}try{let f=So(n[s+2],o.type,t);a[s+1]=f}catch(f){throw new Error(`failed to parse argument ${s+1} of case expression: ${f.message}`)}}return a[a.length-1]=o,a}function tq(n,e,t){let o=n[2];if(!Array.isArray(o))throw new Error('the second argument for the "in" operator must be an array');let a;if(typeof o[0]=="string"){if(o[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(o[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');o=o[1],a=vs}else a=qn;let s=new Array(o.length);for(let v=0;v<s.length;v++)try{let w=So(o[v],a,t);s[v]=w}catch(w){throw new Error(`failed to parse haystack item ${v} for "in" expression: ${w.message}`)}return[So(n[1],a,t),...s]}function nq(n,e,t){let o;try{o=So(n[1],qn,t)}catch(f){throw new Error(`failed to parse first argument in palette expression: ${f.message}`)}let a=n[2];if(!Array.isArray(a))throw new Error("the second argument of palette must be an array");let s=new Array(a.length);for(let f=0;f<s.length;f++){let v;try{v=So(a[f],Aa,t)}catch(w){throw new Error(`failed to parse color at index ${f} in palette expression: ${w.message}`)}if(!(v instanceof _r))throw new Error(`the palette color at index ${f} must be a literal value`);s[f]=v}return[o,...s]}function fn(...n){return function(e,t,o){let a=e[0],s;for(let f=0;f<n.length;f++){let v=n[f](e,t,o);if(f==n.length-1){if(!v)throw new Error("expected last argument validator to return the parsed args");s=v}}return new sM(t,a,...s)}}function iq(n,e,t){let o=n[0],a=qZ[o];if(!a)throw new Error(`unknown operator: ${o}`);return a(n,e,t)}function cM(n){if(!n)return"";let e=n.getType();switch(e){case"Point":case"LineString":case"Polygon":return e;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return e.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return cM(n.getGeometries()[0]);default:return""}}function uM(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function Gc(n,e,t){let o=So(n,e,t);return ql(o,t)}function ql(n,e){if(n instanceof _r){if(n.type===Aa&&typeof n.value=="string"){let o=Nv(n.value);return function(){return o}}return function(){return n.value}}let t=n.operator;switch(t){case Je.Number:case Je.String:case Je.Coalesce:return rq(n,e);case Je.Get:case Je.Var:case Je.Has:return oq(n,e);case Je.Id:return o=>o.featureId;case Je.GeometryType:return o=>o.geometryType;case Je.Concat:{let o=n.args.map(a=>ql(a,e));return a=>"".concat(...o.map(s=>s(a).toString()))}case Je.Resolution:return o=>o.resolution;case Je.Any:case Je.All:case Je.Between:case Je.In:case Je.Not:return aq(n,e);case Je.Equal:case Je.NotEqual:case Je.LessThan:case Je.LessThanOrEqualTo:case Je.GreaterThan:case Je.GreaterThanOrEqualTo:return sq(n,e);case Je.Multiply:case Je.Divide:case Je.Add:case Je.Subtract:case Je.Clamp:case Je.Mod:case Je.Pow:case Je.Abs:case Je.Floor:case Je.Ceil:case Je.Round:case Je.Sin:case Je.Cos:case Je.Atan:case Je.Sqrt:return lq(n,e);case Je.Case:return cq(n,e);case Je.Match:return uq(n,e);case Je.Interpolate:return hq(n,e);case Je.ToString:return dq(n,e);default:throw new Error(`Unsupported operator ${t}`)}}function rq(n,e){let t=n.operator,o=n.args.length,a=new Array(o);for(let s=0;s<o;++s)a[s]=ql(n.args[s],e);switch(t){case Je.Coalesce:return s=>{for(let f=0;f<o;++f){let v=a[f](s);if(typeof v<"u"&&v!==null)return v}throw new Error("Expected one of the values to be non-null")};case Je.Number:case Je.String:return s=>{for(let f=0;f<o;++f){let v=a[f](s);if(typeof v===t)return v}throw new Error(`Expected one of the values to be a ${t}`)};default:throw new Error(`Unsupported assertion operator ${t}`)}}function oq(n,e){let o=n.args[0].value;switch(n.operator){case Je.Get:return a=>{let s=n.args,f=a.properties[o];for(let v=1,w=s.length;v<w;++v){let A=s[v].value;f=f[A]}return f};case Je.Var:return a=>a.variables[o];case Je.Has:return a=>{let s=n.args;if(!(o in a.properties))return!1;let f=a.properties[o];for(let v=1,w=s.length;v<w;++v){let A=s[v].value;if(!f||!Object.hasOwn(f,A))return!1;f=f[A]}return!0};default:throw new Error(`Unsupported accessor operator ${n.operator}`)}}function sq(n,e){let t=n.operator,o=ql(n.args[0],e),a=ql(n.args[1],e);switch(t){case Je.Equal:return s=>o(s)===a(s);case Je.NotEqual:return s=>o(s)!==a(s);case Je.LessThan:return s=>o(s)<a(s);case Je.LessThanOrEqualTo:return s=>o(s)<=a(s);case Je.GreaterThan:return s=>o(s)>a(s);case Je.GreaterThanOrEqualTo:return s=>o(s)>=a(s);default:throw new Error(`Unsupported comparison operator ${t}`)}}function aq(n,e){let t=n.operator,o=n.args.length,a=new Array(o);for(let s=0;s<o;++s)a[s]=ql(n.args[s],e);switch(t){case Je.Any:return s=>{for(let f=0;f<o;++f)if(a[f](s))return!0;return!1};case Je.All:return s=>{for(let f=0;f<o;++f)if(!a[f](s))return!1;return!0};case Je.Between:return s=>{let f=a[0](s),v=a[1](s),w=a[2](s);return f>=v&&f<=w};case Je.In:return s=>{let f=a[0](s);for(let v=1;v<o;++v)if(f===a[v](s))return!0;return!1};case Je.Not:return s=>!a[0](s);default:throw new Error(`Unsupported logical operator ${t}`)}}function lq(n,e){let t=n.operator,o=n.args.length,a=new Array(o);for(let s=0;s<o;++s)a[s]=ql(n.args[s],e);switch(t){case Je.Multiply:return s=>{let f=1;for(let v=0;v<o;++v)f*=a[v](s);return f};case Je.Divide:return s=>a[0](s)/a[1](s);case Je.Add:return s=>{let f=0;for(let v=0;v<o;++v)f+=a[v](s);return f};case Je.Subtract:return s=>a[0](s)-a[1](s);case Je.Clamp:return s=>{let f=a[0](s),v=a[1](s);if(f<v)return v;let w=a[2](s);return f>w?w:f};case Je.Mod:return s=>a[0](s)%a[1](s);case Je.Pow:return s=>Math.pow(a[0](s),a[1](s));case Je.Abs:return s=>Math.abs(a[0](s));case Je.Floor:return s=>Math.floor(a[0](s));case Je.Ceil:return s=>Math.ceil(a[0](s));case Je.Round:return s=>Math.round(a[0](s));case Je.Sin:return s=>Math.sin(a[0](s));case Je.Cos:return s=>Math.cos(a[0](s));case Je.Atan:return o===2?s=>Math.atan2(a[0](s),a[1](s)):s=>Math.atan(a[0](s));case Je.Sqrt:return s=>Math.sqrt(a[0](s));default:throw new Error(`Unsupported numeric operator ${t}`)}}function cq(n,e){let t=n.args.length,o=new Array(t);for(let a=0;a<t;++a)o[a]=ql(n.args[a],e);return a=>{for(let s=0;s<t-1;s+=2)if(o[s](a))return o[s+1](a);return o[t-1](a)}}function uq(n,e){let t=n.args.length,o=new Array(t);for(let a=0;a<t;++a)o[a]=ql(n.args[a],e);return a=>{let s=o[0](a);for(let f=1;f<t-1;f+=2)if(s===o[f](a))return o[f+1](a);return o[t-1](a)}}function hq(n,e){let t=n.args.length,o=new Array(t);for(let a=0;a<t;++a)o[a]=ql(n.args[a],e);return a=>{let s=o[0](a),f=o[1](a),v,w;for(let D=2;D<t;D+=2){let A=o[D](a),z=o[D+1](a),H=Array.isArray(z);if(H&&(z=xB(z)),A>=f)return D===2?z:H?fq(s,f,v,w,A,z):Uv(s,f,v,w,A,z);v=A,w=z}return w}}function dq(n,e){let t=n.operator,o=n.args.length,a=new Array(o);for(let s=0;s<o;++s)a[s]=ql(n.args[s],e);switch(t){case Je.ToString:return s=>{let f=a[0](s);return n.args[0].type===Aa?zv(f):f.toString()};default:throw new Error(`Unsupported convert operator ${t}`)}}function Uv(n,e,t,o,a,s){let f=a-t;if(f===0)return o;let v=e-t,w=n===1?v/f:(Math.pow(n,v)-1)/(Math.pow(n,f)-1);return o+w*(s-o)}function fq(n,e,t,o,a,s){if(a-t===0)return o;let v=iM(o),w=iM(s),D=w[2]-v[2];D>180?D-=360:D<-180&&(D+=360);let A=[Uv(n,e,t,v[0],a,w[0]),Uv(n,e,t,v[1],a,w[1]),v[2]+Uv(n,e,t,0,a,D),Uv(n,e,t,o[3],a,s[3])];return bB(A)}var ln={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function IB(n,e,t){let o=n,a=!0,s=!1,f=!1,v=[mg(o,Ft.LOAD,function(){f=!0,s||e()})];return o.src&&LS?(s=!0,o.decode().then(function(){a&&e()}).catch(function(w){a&&(f?e():t())})):v.push(mg(o,Ft.ERROR,t)),function(){a=!1,v.forEach(Gn)}}function pq(n,e){return new Promise((t,o)=>{function a(){f(),t(n)}function s(){f(),o(new Error("Image load error"))}function f(){n.removeEventListener("load",a),n.removeEventListener("error",s)}n.addEventListener("load",a),n.addEventListener("error",s),e&&(n.src=e)})}function SB(n,e){return e&&(n.src=e),n.src&&LS?new Promise((t,o)=>n.decode().then(()=>t(n)).catch(a=>n.complete&&n.width?t(n):o(a))):pq(n)}var dM=class{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(let t in this.cache_){let o=this.cache_[t];(e++&3)===0&&!o.hasListener()&&(delete this.cache_[t],delete this.patternCache_[t],--this.cacheSize_)}}}get(e,t,o){let a=hM(e,t,o);return a in this.cache_?this.cache_[a]:null}getPattern(e,t,o){let a=hM(e,t,o);return a in this.patternCache_?this.patternCache_[a]:null}set(e,t,o,a,s){let f=hM(e,t,o),v=f in this.cache_;this.cache_[f]=a,s&&(a.getImageState()===ln.IDLE&&a.load(),a.getImageState()===ln.LOADING?a.ready().then(()=>{this.patternCache_[f]=Lg().createPattern(a.getImage(1),"repeat")}):this.patternCache_[f]=Lg().createPattern(a.getImage(1),"repeat")),v||++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}};function hM(n,e,t){let o=t?Zl(t):"null";return e+":"+n+":"+o}var os=new dM;var Gv=null,o1=class extends nd{constructor(e,t,o,a,s){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=o,this.canvas_={},this.color_=s,this.imageState_=a===void 0?ln.IDLE:a,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=t,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===ln.LOADED){Gv||(Gv=xi(1,1,void 0,{willReadFrequently:!0})),Gv.drawImage(this.image_,0,0);try{Gv.getImageData(0,0,1,1),this.tainted_=!1}catch{Gv=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(Ft.CHANGE)}handleImageError_(){this.imageState_=ln.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=ln.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){let e=this.size_[0],t=this.size_[1],o=xi(e,t);o.fillRect(0,0,e,t),this.hitDetectionImage_=o.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===ln.IDLE){this.image_||this.initializeImage_(),this.imageState_=ln.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&SB(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==ln.LOADED)return;let t=this.image_,o=xi(Math.ceil(t.width*e),Math.ceil(t.height*e)),a=o.canvas;o.scale(e,e),o.drawImage(t,0,0),o.globalCompositeOperation="multiply",o.fillStyle=vB(this.color_),o.fillRect(0,0,a.width/e,a.height/e),o.globalCompositeOperation="destination-in",o.drawImage(t,0,0),this.canvas_[e]=a}ready(){return this.ready_||(this.ready_=new Promise(e=>{if(this.imageState_===ln.LOADED||this.imageState_===ln.ERROR)e();else{let t=()=>{(this.imageState_===ln.LOADED||this.imageState_===ln.ERROR)&&(this.removeEventListener(Ft.CHANGE,t),e())};this.addEventListener(Ft.CHANGE,t)}})),this.ready_}};function rp(n,e,t,o,a,s){let f=e===void 0?void 0:os.get(e,t,a);return f||(f=new o1(n,n&&"src"in n?n.src||void 0:e,t,o,a),os.set(e,t,a,f,s)),s&&f&&!os.getPattern(e,t,a)&&os.set(e,t,a,f,s),f}var DB=o1;function Ws(n){return n?Array.isArray(n)?zv(n):typeof n=="object"&&"src"in n?mq(n):n:null}function mq(n){if(!n.offset||!n.size)return os.getPattern(n.src,"anonymous",n.color);let e=n.src+":"+n.offset,t=os.getPattern(e,void 0,n.color);if(t)return t;let o=os.get(n.src,"anonymous",null);if(o.getImageState()!==ln.LOADED)return null;let a=xi(n.size[0],n.size[1]);return a.drawImage(o.getImage(1),n.offset[0],n.offset[1],n.size[0],n.size[1],0,0,n.size[0],n.size[1]),rp(a.canvas,e,void 0,ln.LOADED,n.color,!0),os.getPattern(e,void 0,n.color)}var s1="10px sans-serif",io="#000",$c="round",Xs=[],Ys=0,Hc="round",eh=10,th="#000",xd="center",sp="middle",nh=[0,0,0,0],ih=1,op=new Ur,$v=null,MB,fM={},gq=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","emoji","math","fangsong"]);function _q(n,e,t){return`${n} ${e} 16px "${t}"`}var PB=(function(){let e,t;function o(s){return kr(this,null,function*(){yield t.ready;let f=yield t.load(s);if(f.length===0)return!1;let v=Hw(s),w=v.families[0].toLowerCase(),D=v.weight;return f.some(A=>{let z=A.family.replace(/^['"]|['"]$/g,"").toLowerCase(),H=$w[A.weight]||A.weight;return z===w&&A.style===v.style&&H==D})})}function a(){return kr(this,null,function*(){yield t.ready;let s=!0,f=op.getProperties(),v=Object.keys(f).filter(w=>f[w]<100);for(let w=v.length-1;w>=0;--w){let D=v[w],A=f[D];A<100&&((yield o(D))?(Nc(fM),op.set(D,100)):(A+=10,op.set(D,A,!0),A<100&&(s=!1)))}e=void 0,s||(e=setTimeout(a,100))})}return function(s){return kr(this,null,function*(){t||(t=to?self.fonts:document.fonts);let f=Hw(s);if(!f)return;let v=f.families,w=!1;for(let D of v){if(gq.has(D))continue;let A=_q(f.style,f.weight,D);op.get(A)===void 0&&(op.set(A,0,!0),w=!0)}w&&(clearTimeout(e),e=setTimeout(a,100))})}})(),yq=(function(){let n;return function(e){let t=fM[e];if(t==null){if(to){let o=Hw(e),a=AB(e,"\u017Dg");t=(isNaN(Number(o.lineHeight))?1.2:Number(o.lineHeight))*(a.actualBoundingBoxAscent+a.actualBoundingBoxDescent)}else n||(n=document.createElement("div"),n.innerHTML="M",n.style.minHeight="0",n.style.maxHeight="none",n.style.height="auto",n.style.padding="0",n.style.border="none",n.style.position="absolute",n.style.display="block",n.style.left="-99999px"),n.style.font=e,document.body.appendChild(n),t=n.offsetHeight,document.body.removeChild(n);fM[e]=t}return t}})();function AB(n,e){return $v||($v=xi(1,1)),n!=MB&&($v.font=n,MB=$v.font),$v.measureText(e)}function RB(n,e){return AB(n,e).width}function pM(n,e,t){if(e in t)return t[e];let o=e.split(`
`).reduce((a,s)=>Math.max(a,RB(n,s)),0);return t[e]=o,o}function LB(n,e){let t=[],o=[],a=[],s=0,f=0,v=0,w=0;for(let D=0,A=e.length;D<=A;D+=2){let z=e[D];if(z===`
`||D===A){s=Math.max(s,f),a.push(f),f=0,v+=w,w=0;continue}let H=e[D+1]||n.font,q=RB(H,z);t.push(q),f+=q;let W=yq(H);o.push(W),w=Math.max(w,W)}return{width:s,height:v,widths:t,heights:o,lineWidths:a}}function OB(n,e,t,o,a,s,f,v,w,D,A){n.save(),t!==1&&(n.globalAlpha===void 0?n.globalAlpha=z=>z.globalAlpha*=t:n.globalAlpha*=t),e&&n.transform.apply(n,e),o.contextInstructions?(n.translate(w,D),n.scale(A[0],A[1]),vq(o,n)):A[0]<0||A[1]<0?(n.translate(w,D),n.scale(A[0],A[1]),n.drawImage(o,a,s,f,v,0,0,f,v)):n.drawImage(o,a,s,f,v,w,D,f*A[0],v*A[1]),n.restore()}function vq(n,e){let t=n.contextInstructions;for(let o=0,a=t.length;o<a;o+=2)Array.isArray(t[o+1])?e[t[o]].apply(e,t[o+1]):e[t[o]]=t[o+1]}var mM=class n{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=gr(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){let e=this.getScale();return new n({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return Xt()}getImage(e){return Xt()}getHitDetectionImage(){return Xt()}getPixelRatio(e){return 1}getImageState(){return Xt()}getImageSize(){return Xt()}getOrigin(){return Xt()}getSize(){return Xt()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=gr(e)}listenImageChange(e){Xt()}load(){Xt()}unlistenImageChange(e){Xt()}ready(){return Promise.resolve()}},a1=mM;var gM=class n extends a1{constructor(e){super({opacity:1,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius=e.radius,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?ln.LOADING:ln.LOADED,this.imageState_===ln.LOADING&&this.ready().then(()=>this.imageState_=ln.LOADED),this.render()}clone(){let e=this.getScale(),t=new n({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){let e=this.size_,t=this.getDisplacement(),o=this.getScaleArray();return[e[0]/2-t[0]/o[0],e[1]/2+t[1]/o[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(e){let t=this.fill_?.getKey(),o=`${e},${this.angle_},${this.radius},${this.radius2_},${this.points_},${t}`+Object.values(this.renderOptions_).join(","),a=os.get(o,null,null)?.getImage(1);if(!a){let s=this.renderOptions_,f=Math.ceil(s.size*e),v=xi(f,f);this.draw_(s,v,e),a=v.canvas,os.set(o,null,null,new DB(a,void 0,null,ln.LOADED,null))}return a}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,o){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let a=this.radius,s=this.radius2_===void 0?a:this.radius2_;if(a<s){let Qe=a;a=s,s=Qe}let f=this.radius2_===void 0?this.points_:this.points_*2,v=2*Math.PI/f,w=s*Math.sin(v),D=Math.sqrt(s*s-w*w),A=a-D,z=Math.sqrt(w*w+A*A),H=z/w;if(e==="miter"&&H<=o)return H*t;let q=t/2/H,W=t/2*(A/z),ce=Math.sqrt((a+q)*(a+q)+W*W)-a;if(this.radius2_===void 0||e==="bevel")return ce*2;let ue=a*Math.sin(v),Me=Math.sqrt(a*a-ue*ue),Ue=s-Me,ke=Math.sqrt(ue*ue+Ue*Ue)/ue;if(ke<=o){let Qe=ke*t/2-s-a;return 2*Math.max(ce,Qe)}return ce*2}createRenderOptions(){let e=$c,t=Hc,o=0,a=null,s=0,f,v=0;this.stroke_&&(f=Ws(this.stroke_.getColor()??th),v=this.stroke_.getWidth()??ih,a=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset()??0,t=this.stroke_.getLineJoin()??Hc,e=this.stroke_.getLineCap()??$c,o=this.stroke_.getMiterLimit()??eh);let w=this.calculateLineJoinSize_(t,v,o),D=Math.max(this.radius,this.radius2_||0),A=Math.ceil(2*D+w);return{strokeStyle:f,strokeWidth:v,size:A,lineCap:e,lineDash:a,lineDashOffset:s,lineJoin:t,miterLimit:o}}render(){this.renderOptions_=this.createRenderOptions();let e=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[e,e]}draw_(e,t,o){if(t.scale(o,o),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let a=this.fill_.getColor();a===null&&(a=io),t.fillStyle=Ws(a),t.fill()}e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){let t;if(this.fill_){let o=this.fill_.getColor(),a=0;typeof o=="string"&&(o=Zl(o)),o===null?a=1:Array.isArray(o)&&(a=o.length===4?o[3]:1),a===0&&(t=xi(e.size,e.size),this.drawHitDetectionCanvas_(e,t))}return t?t.canvas:this.getImage(1)}createPath_(e){let t=this.points_,o=this.radius;if(t===1/0)e.arc(0,0,o,0,2*Math.PI);else{let a=this.radius2_===void 0?o:this.radius2_;this.radius2_!==void 0&&(t*=2);let s=this.angle_-Math.PI/2,f=2*Math.PI/t;for(let v=0;v<t;v++){let w=s+v*f,D=v%2===0?o:a;e.lineTo(D*Math.cos(w),D*Math.sin(w))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=io,t.fill(),e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}},l1=gM;var _M=class n extends l1{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){let e=this.getScale(),t=new n({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius=e,this.render()}},c1=_M;var yM=class n{constructor(e){e=e||{},this.patternImage_=null,this.color_=null,e.color!==void 0&&this.setColor(e.color)}clone(){let e=this.getColor();return new n({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){if(e!==null&&typeof e=="object"&&"src"in e){let t=rp(null,e.src,"anonymous",void 0,e.offset?null:e.color?e.color:null,!(e.offset&&e.size));t.ready().then(()=>{this.patternImage_=null}),t.getImageState()===ln.IDLE&&t.load(),t.getImageState()===ln.LOADING&&(this.patternImage_=t)}this.color_=e}getKey(){let e=this.getColor();return e?e instanceof CanvasPattern||e instanceof CanvasGradient?dn(e):typeof e=="object"&&"src"in e?e.src+":"+e.offset:Zl(e).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}},Zc=yM;function kB(n,e,t,o){return t!==void 0&&o!==void 0?[t/n,o/e]:t!==void 0?t/n:o!==void 0?o/e:1}var vM=class n extends a1{constructor(e){e=e||{};let t=e.opacity!==void 0?e.opacity:1,o=e.rotation!==void 0?e.rotation:0,a=e.scale!==void 0?e.scale:1,s=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:o,scale:a,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:s,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;let f=e.img!==void 0?e.img:null,v=e.src;Cn(!(v!==void 0&&f),"`image` and `src` cannot be provided at the same time"),(v===void 0||v.length===0)&&f&&(v=f.src||dn(f)),Cn(v!==void 0&&v.length>0,"A defined and non-empty `src` or `image` must be provided"),Cn(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let w;if(e.src!==void 0?w=ln.IDLE:f!==void 0&&("complete"in f?f.complete?w=f.src?ln.LOADED:ln.IDLE:w=ln.LOADING:w=ln.LOADED),this.color_=e.color!==void 0?Zl(e.color):null,this.iconImage_=rp(f,v,this.crossOrigin_,w,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,this.initialOptions_,e.width!==void 0||e.height!==void 0){let D,A;if(e.size)[D,A]=e.size;else{let z=this.getImage(1);if(z.width&&z.height)D=z.width,A=z.height;else if(z instanceof HTMLImageElement){this.initialOptions_=e;let H=()=>{if(this.unlistenImageChange(H),!this.initialOptions_)return;let q=this.iconImage_.getSize();this.setScale(kB(q[0],q[1],e.width,e.height))};this.listenImageChange(H);return}}D!==void 0&&this.setScale(kB(D,A,e.width,e.height))}}clone(){let e,t,o;return this.initialOptions_?(t=this.initialOptions_.width,o=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new n({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:o,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;let a=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!a)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=a[0]),this.anchorYUnits_=="fraction"&&(e[1]*=a[1])}if(this.anchorOrigin_!="top-left"){if(!a)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+a[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+a[1])}this.normalizedAnchor_=e}let t=this.getDisplacement(),o=this.getScaleArray();return[e[0]-t[0]/o[0],e[1]+t[1]/o[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){let t=this.getSize(),o=this.iconImage_.getSize();if(!t||!o)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=o[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=o[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}setSrc(e){this.iconImage_=rp(null,e,this.crossOrigin_,ln.IDLE,this.color_)}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){let e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==ln.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){let e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==ln.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(Ft.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(Ft.CHANGE,e)}ready(){return this.iconImage_.ready()}},Hv=vM;var xM=class n{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){let e=this.getColor();return new n({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}},ap=xM;var u1=class n{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=FB,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new n({geometry:e??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=FB,this.geometry_=e}setZIndex(e){this.zIndex_=e}};function NB(n){let e;if(typeof n=="function")e=n;else{let t;Array.isArray(n)?t=n:(Cn(typeof n.getZIndex=="function","Expected an `Style` or an array of `Style`"),t=[n]),e=function(){return t}}return e}var bM=null;function wM(n,e){if(!bM){let t=new Zc({color:"rgba(255,255,255,0.4)"}),o=new ap({color:"#3399CC",width:1.25});bM=[new u1({image:new c1({fill:t,stroke:o,radius:5}),fill:t,stroke:o})]}return bM}function FB(n){return n.getGeometry()}var rh=u1;var xq="#333",EM=class n{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.keepUpright_=e.keepUpright,this.scale_=e.scale,this.scaleArray_=gr(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new Zc({color:xq}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding,this.declutterMode_=e.declutterMode}clone(){let e=this.getScale();return new n({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()instanceof Zc?this.getFill().clone():this.getFill(),stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setKeepUpright(e){this.keepUpright_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=gr(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}},zB=EM;function bq(n){return!0}function UB(n){let e=lM(),t=wq(n,e),o=uM();return function(a,s){if(o.properties=a.getPropertiesInternal(),o.resolution=s,e.featureId){let f=a.getId();f!==void 0?o.featureId=f:o.featureId=null}return e.geometryType&&(o.geometryType=cM(a.getGeometry())),t(o)}}function IM(n){let e=lM(),t=n.length,o=new Array(t);for(let f=0;f<t;++f)o[f]=TM(n[f],e);let a=uM(),s=new Array(t);return function(f,v){if(a.properties=f.getPropertiesInternal(),a.resolution=v,e.featureId){let D=f.getId();D!==void 0?a.featureId=D:a.featureId=null}let w=0;for(let D=0;D<t;++D){let A=o[D](a);A&&(s[w]=A,w+=1)}return s.length=w,s}}function wq(n,e){let t=n.length,o=new Array(t);for(let a=0;a<t;++a){let s=n[a],f="filter"in s?Gc(s.filter,rs,e):bq,v;if(Array.isArray(s.style)){let w=s.style.length;v=new Array(w);for(let D=0;D<w;++D)v[D]=TM(s.style[D],e)}else v=[TM(s.style,e)];o[a]={filter:f,styles:v}}return function(a){let s=[],f=!1;for(let v=0;v<t;++v){let w=o[v].filter;if(w(a)&&!(n[v].else&&f)){f=!0;for(let D of o[v].styles){let A=D(a);A&&s.push(A)}}}return s}}function TM(n,e){let t=Zv(n,"",e),o=qv(n,"",e),a=Eq(n,e),s=Tq(n,e),f=Ks(n,"z-index",e);if(!t&&!o&&!a&&!s&&!Da(n))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(n));let v=new rh;return function(w){let D=!0;if(t){let A=t(w);A&&(D=!1),v.setFill(A)}if(o){let A=o(w);A&&(D=!1),v.setStroke(A)}if(a){let A=a(w);A&&(D=!1),v.setText(A)}if(s){let A=s(w);A&&(D=!1),v.setImage(A)}return f&&v.setZIndex(f(w)),D?null:v}}function Zv(n,e,t){let o;if(e+"fill-pattern-src"in n)o=Dq(n,e+"fill-",t);else{if(n[e+"fill-color"]==="none")return s=>null;o=SM(n,e+"fill-color",t)}if(!o)return null;let a=new Zc;return function(s){let f=o(s);return f===i1?null:(a.setColor(f),a)}}function qv(n,e,t){let o=Ks(n,e+"stroke-width",t),a=SM(n,e+"stroke-color",t);if(!o&&!a)return null;let s=oh(n,e+"stroke-line-cap",t),f=oh(n,e+"stroke-line-join",t),v=GB(n,e+"stroke-line-dash",t),w=Ks(n,e+"stroke-line-dash-offset",t),D=Ks(n,e+"stroke-miter-limit",t),A=new ap;return function(z){if(a){let H=a(z);if(H===i1)return null;A.setColor(H)}if(o&&A.setWidth(o(z)),s){let H=s(z);if(H!=="butt"&&H!=="round"&&H!=="square")throw new Error("Expected butt, round, or square line cap");A.setLineCap(H)}if(f){let H=f(z);if(H!=="bevel"&&H!=="round"&&H!=="miter")throw new Error("Expected bevel, round, or miter line join");A.setLineJoin(H)}return v&&A.setLineDash(v(z)),w&&A.setLineDashOffset(w(z)),D&&A.setMiterLimit(D(z)),A}}function Eq(n,e){let t="text-",o=oh(n,t+"value",e);if(!o)return null;let a=Zv(n,t,e),s=Zv(n,t+"background-",e),f=qv(n,t,e),v=qv(n,t+"background-",e),w=oh(n,t+"font",e),D=Ks(n,t+"max-angle",e),A=Ks(n,t+"offset-x",e),z=Ks(n,t+"offset-y",e),H=Ug(n,t+"overflow",e),q=oh(n,t+"placement",e),W=Ks(n,t+"repeat",e),me=f1(n,t+"scale",e),ce=Ug(n,t+"rotate-with-view",e),ue=Ks(n,t+"rotation",e),Me=oh(n,t+"align",e),Ue=oh(n,t+"justify",e),Pe=oh(n,t+"baseline",e),ke=Ug(n,t+"keep-upright",e),Qe=GB(n,t+"padding",e),ot=p1(n,t+"declutter-mode"),st=new zB({declutterMode:ot});return function(it){if(st.setText(o(it)),a&&st.setFill(a(it)),s&&st.setBackgroundFill(s(it)),f&&st.setStroke(f(it)),v&&st.setBackgroundStroke(v(it)),w&&st.setFont(w(it)),D&&st.setMaxAngle(D(it)),A&&st.setOffsetX(A(it)),z&&st.setOffsetY(z(it)),H&&st.setOverflow(H(it)),q){let pt=q(it);if(pt!=="point"&&pt!=="line")throw new Error("Expected point or line for text-placement");st.setPlacement(pt)}if(W&&st.setRepeat(W(it)),me&&st.setScale(me(it)),ce&&st.setRotateWithView(ce(it)),ue&&st.setRotation(ue(it)),Me){let pt=Me(it);if(pt!=="left"&&pt!=="center"&&pt!=="right"&&pt!=="end"&&pt!=="start")throw new Error("Expected left, right, center, start, or end for text-align");st.setTextAlign(pt)}if(Ue){let pt=Ue(it);if(pt!=="left"&&pt!=="right"&&pt!=="center")throw new Error("Expected left, right, or center for text-justify");st.setJustify(pt)}if(Pe){let pt=Pe(it);if(pt!=="bottom"&&pt!=="top"&&pt!=="middle"&&pt!=="alphabetic"&&pt!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");st.setTextBaseline(pt)}return Qe&&st.setPadding(Qe(it)),ke&&st.setKeepUpright(ke(it)),st}}function Tq(n,e){return"icon-src"in n?Cq(n,e):"shape-points"in n?Iq(n,e):"circle-radius"in n?Sq(n,e):null}function Cq(n,e){let t="icon-",o=t+"src",a=$B(n[o],o),s=h1(n,t+"anchor",e),f=f1(n,t+"scale",e),v=Ks(n,t+"opacity",e),w=h1(n,t+"displacement",e),D=Ks(n,t+"rotation",e),A=Ug(n,t+"rotate-with-view",e),z=jB(n,t+"anchor-origin"),H=VB(n,t+"anchor-x-units"),q=VB(n,t+"anchor-y-units"),W=Rq(n,t+"color"),me=Pq(n,t+"cross-origin"),ce=Aq(n,t+"offset"),ue=jB(n,t+"offset-origin"),Me=d1(n,t+"width"),Ue=d1(n,t+"height"),Pe=Mq(n,t+"size"),ke=p1(n,t+"declutter-mode"),Qe=new Hv({src:a,anchorOrigin:z,anchorXUnits:H,anchorYUnits:q,color:W,crossOrigin:me,offset:ce,offsetOrigin:ue,height:Ue,width:Me,size:Pe,declutterMode:ke});return function(ot){return v&&Qe.setOpacity(v(ot)),w&&Qe.setDisplacement(w(ot)),D&&Qe.setRotation(D(ot)),A&&Qe.setRotateWithView(A(ot)),f&&Qe.setScale(f(ot)),s&&Qe.setAnchor(s(ot)),Qe}}function Iq(n,e){let t="shape-",o=t+"points",a=t+"radius",s=CM(n[o],o),f=CM(n[a],a),v=Zv(n,t,e),w=qv(n,t,e),D=f1(n,t+"scale",e),A=h1(n,t+"displacement",e),z=Ks(n,t+"rotation",e),H=Ug(n,t+"rotate-with-view",e),q=d1(n,t+"radius2"),W=d1(n,t+"angle"),me=p1(n,t+"declutter-mode"),ce=new l1({points:s,radius:f,radius2:q,angle:W,declutterMode:me});return function(ue){return v&&ce.setFill(v(ue)),w&&ce.setStroke(w(ue)),A&&ce.setDisplacement(A(ue)),z&&ce.setRotation(z(ue)),H&&ce.setRotateWithView(H(ue)),D&&ce.setScale(D(ue)),ce}}function Sq(n,e){let t="circle-",o=Zv(n,t,e),a=qv(n,t,e),s=Ks(n,t+"radius",e),f=f1(n,t+"scale",e),v=h1(n,t+"displacement",e),w=Ks(n,t+"rotation",e),D=Ug(n,t+"rotate-with-view",e),A=p1(n,t+"declutter-mode"),z=new c1({radius:5,declutterMode:A});return function(H){return s&&z.setRadius(s(H)),o&&z.setFill(o(H)),a&&z.setStroke(a(H)),v&&z.setDisplacement(v(H)),w&&z.setRotation(w(H)),D&&z.setRotateWithView(D(H)),f&&z.setScale(f(H)),z}}function Ks(n,e,t){if(!(e in n))return;let o=Gc(n[e],qn,t);return function(a){return CM(o(a),e)}}function oh(n,e,t){if(!(e in n))return null;let o=Gc(n[e],vs,t);return function(a){return $B(o(a),e)}}function Dq(n,e,t){let o=oh(n,e+"pattern-src",t),a=BB(n,e+"pattern-offset",t),s=BB(n,e+"pattern-size",t),f=SM(n,e+"color",t);return function(v){return{src:o(v),offset:a&&a(v),size:s&&s(v),color:f&&f(v)}}}function Ug(n,e,t){if(!(e in n))return null;let o=Gc(n[e],rs,t);return function(a){let s=o(a);if(typeof s!="boolean")throw new Error(`Expected a boolean for ${e}`);return s}}function SM(n,e,t){if(!(e in n))return null;let o=Gc(n[e],Aa,t);return function(a){return HB(o(a),e)}}function GB(n,e,t){if(!(e in n))return null;let o=Gc(n[e],vd,t);return function(a){return Wv(o(a),e)}}function h1(n,e,t){if(!(e in n))return null;let o=Gc(n[e],vd,t);return function(a){let s=Wv(o(a),e);if(s.length!==2)throw new Error(`Expected two numbers for ${e}`);return s}}function BB(n,e,t){if(!(e in n))return null;let o=Gc(n[e],vd,t);return function(a){return ZB(o(a),e)}}function f1(n,e,t){if(!(e in n))return null;let o=Gc(n[e],vd|qn,t);return function(a){return Lq(o(a),e)}}function d1(n,e){let t=n[e];if(t!==void 0){if(typeof t!="number")throw new Error(`Expected a number for ${e}`);return t}}function Mq(n,e){let t=n[e];if(t!==void 0){if(typeof t=="number")return gr(t);if(!Array.isArray(t))throw new Error(`Expected a number or size array for ${e}`);if(t.length!==2||typeof t[0]!="number"||typeof t[1]!="number")throw new Error(`Expected a number or size array for ${e}`);return t}}function Pq(n,e){let t=n[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);return t}}function jB(n,e){let t=n[e];if(t!==void 0){if(t!=="bottom-left"&&t!=="bottom-right"&&t!=="top-left"&&t!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${e}`);return t}}function VB(n,e){let t=n[e];if(t!==void 0){if(t!=="pixels"&&t!=="fraction")throw new Error(`Expected pixels or fraction for ${e}`);return t}}function Aq(n,e){let t=n[e];if(t!==void 0)return Wv(t,e)}function p1(n,e){let t=n[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);if(t!=="declutter"&&t!=="obstacle"&&t!=="none")throw new Error(`Expected declutter, obstacle, or none for ${e}`);return t}}function Rq(n,e){let t=n[e];if(t!==void 0)return HB(t,e)}function Wv(n,e){if(!Array.isArray(n))throw new Error(`Expected an array for ${e}`);let t=n.length;for(let o=0;o<t;++o)if(typeof n[o]!="number")throw new Error(`Expected an array of numbers for ${e}`);return n}function $B(n,e){if(typeof n!="string")throw new Error(`Expected a string for ${e}`);return n}function CM(n,e){if(typeof n!="number")throw new Error(`Expected a number for ${e}`);return n}function HB(n,e){if(typeof n=="string")return n;let t=Wv(n,e),o=t.length;if(o<3||o>4)throw new Error(`Expected a color with 3 or 4 values for ${e}`);return t}function ZB(n,e){let t=Wv(n,e);if(t.length!==2)throw new Error(`Expected an array of two numbers for ${e}`);return t}function Lq(n,e){return typeof n=="number"?n:ZB(n,e)}var qB={RENDER_ORDER:"renderOrder"},DM=class extends np{constructor(e){e=e||{};let t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter?String(e.declutter):void 0,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(qB.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e,t){let o=this.getDeclutter();o in e.declutter||(e.declutter[o]=new jg(9)),this.getRenderer().renderDeclutter(e,t)}setRenderOrder(e){this.set(qB.RENDER_ORDER,e)}setStyle(e){this.style_=e===void 0?wM:e;let t=Oq(e);this.styleFunction_=e===null?void 0:NB(t),this.changed()}setDeclutter(e){this.declutter_=e?String(e):void 0,this.changed()}};function Oq(n){if(n===void 0)return wM;if(!n)return null;if(typeof n=="function"||n instanceof rh)return n;if(!Array.isArray(n))return IM([n]);if(n.length===0)return[];let e=n.length,t=n[0];if(t instanceof rh){let a=new Array(e);for(let s=0;s<e;++s){let f=n[s];if(!(f instanceof rh))throw new Error("Expected a list of style instances");a[s]=f}return a}if("style"in t){let a=new Array(e);for(let s=0;s<e;++s){let f=n[s];if(!("style"in f))throw new Error("Expected a list of rules with a style property");a[s]=f}return UB(a)}return IM(n)}var m1=DM;var MM=class extends Co{constructor(e,t,o,a){super(e),this.inversePixelTransform=t,this.frameState=o,this.context=a}},g1=MM;var PM=class extends td{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){Xt()}calculateMatrices2D(e){let t=e.viewState,o=e.coordinateToPixelTransform,a=e.pixelToCoordinateTransform;$o(o,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),Ow(a,o)}forEachFeatureAtCoordinate(e,t,o,a,s,f,v,w){let D,A=t.viewState;function z(Pe,ke,Qe,ot){return s.call(f,ke,Pe?Qe:null,ot)}let H=A.projection,q=Tw(e.slice(),H),W=[[0,0]];if(H.canWrapX()&&a){let Pe=H.getExtent(),ke=In(Pe);W.push([-ke,0],[ke,0])}let me=t.layerStatesArray,ce=me.length,ue=[],Me=[];for(let Pe=0;Pe<W.length;Pe++)for(let ke=ce-1;ke>=0;--ke){let Qe=me[ke],ot=Qe.layer;if(ot.hasRenderer()&&Av(Qe,A)&&v.call(w,ot)){let st=ot.getRenderer(),it=ot.getSource();if(st&&it){let pt=it.getWrapX()?q:e,Vt=z.bind(null,Qe.managed);Me[0]=pt[0]+W[Pe][0],Me[1]=pt[1]+W[Pe][1],D=st.forEachFeatureAtCoordinate(Me,t,o,Vt,ue)}if(D)return D}}if(ue.length===0)return;let Ue=1/ue.length;return ue.forEach((Pe,ke)=>Pe.distanceSq+=ke*Ue),ue.sort((Pe,ke)=>Pe.distanceSq-ke.distanceSq),ue.some(Pe=>D=Pe.callback(Pe.feature,Pe.layer,Pe.geometry)),D}hasFeatureAtCoordinate(e,t,o,a,s,f){return this.forEachFeatureAtCoordinate(e,t,o,a,$u,this,s,f)!==void 0}getMap(){return this.map_}renderFrame(e){Xt()}scheduleExpireIconCache(e){os.canExpireCache()&&e.postRenderFunctions.push(kq)}};function kq(n,e){os.expire()}var WB=PM;var AM=class extends WB{constructor(e){super(e),this.fontChangeListenerKey_=xn(op,Nl.PROPERTYCHANGE,e.redrawText,e),this.element_=to?Zw():document.createElement("div");let t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=md+" ol-layers";let o=e.getViewport();o&&o.insertBefore(this.element_,o.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){let o=this.getMap();if(o.hasListener(e)){let a=new g1(e,void 0,t);o.dispatchEvent(a)}}disposeInternal(){Gn(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(Ho.PRECOMPOSE,e);let t=e.layerStatesArray.sort((D,A)=>D.zIndex-A.zIndex);t.some(D=>D.layer instanceof m1&&D.layer.getDeclutter())&&(e.declutter={});let a=e.viewState;this.children_.length=0;let s=[],f=null;for(let D=0,A=t.length;D<A;++D){let z=t[D];e.layerIndex=D;let H=z.layer,q=H.getSourceState();if(!Av(z,a)||q!="ready"&&q!="undefined"){H.unrender();continue}let W=H.render(e,f);W&&(W!==f&&(this.children_.push(W),f=W),s.push(z))}this.declutter(e,s),qz(this.element_,this.children_);let w=this.getMap().getTargetElement();if($l(w)){let D=w.getContext("2d");for(let A of this.children_){let z=A.firstElementChild||A,H=A.style.backgroundColor;if(H&&(!$l(z)||z.width>0)&&(D.fillStyle=H,D.fillRect(0,0,w.width,w.height)),$l(z)&&z.width>0){let q=A.style.opacity||z.style.opacity;D.globalAlpha=q===""?1:Number(q);let W=z.style.transform;if(W)D.setTransform(...Lw(W));else{let me=parseFloat(z.style.width)/z.width,ce=parseFloat(z.style.height)/z.height;D.setTransform(me,0,0,ce,0,0)}D.drawImage(z,0,0)}}D.globalAlpha=1,D.setTransform(1,0,0,1,0,0)}this.dispatchRenderEvent(Ho.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}declutter(e,t){if(e.declutter){for(let o=t.length-1;o>=0;--o){let a=t[o],s=a.layer;s.getDeclutter()&&s.renderDeclutter(e,a)}t.forEach(o=>o.layer.renderDeferred(e))}}},XB=AM;function YB(n){if(n instanceof np){n.setMapInternal(null);return}n instanceof Pv&&n.getLayers().forEach(YB)}function KB(n,e){if(n instanceof np){n.setMapInternal(e);return}if(n instanceof Pv){let t=n.getLayers().getArray();for(let o=0,a=t.length;o<a;++o)KB(t[o],e)}}var RM=class extends Ur{constructor(e){super(),e=e||{},this.on,this.once,this.un;let t=Fq(e);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:NN,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Io(),this.pixelToCoordinateTransform_=Io(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,to||(this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_)),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,to||(this.resizeObserver_=new ResizeObserver(()=>this.updateSize())),this.controls=t.controls||(to?new Vo:Kz()),this.interactions=t.interactions||(to?new Vo:gB({onFocusOnly:!0})),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new jN(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Uo.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Uo.VIEW,this.handleViewChanged_),this.addChangeListener(Uo.SIZE,this.handleSizeChanged_),this.addChangeListener(Uo.TARGET,this.handleTargetChanged_),this.setProperties(t.values);let o=this;e.view&&!(e.view instanceof Pa)&&e.view.then(function(a){o.setView(new Pa(a))}),this.controls.addEventListener(To.ADD,a=>{a.element.setMap(this)}),this.controls.addEventListener(To.REMOVE,a=>{a.element.setMap(null)}),this.interactions.addEventListener(To.ADD,a=>{a.element.setMap(this)}),this.interactions.addEventListener(To.REMOVE,a=>{a.element.setMap(null)}),this.overlays_.addEventListener(To.ADD,a=>{this.addOverlayInternal_(a.element)}),this.overlays_.addEventListener(To.REMOVE,a=>{let s=a.element.getId();s!==void 0&&delete this.overlayIdIndex_[s.toString()],a.element.setMap(null)}),this.controls.forEach(a=>{a.setMap(this)}),this.interactions.forEach(a=>{a.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){KB(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){let t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_?.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,o){if(!this.frameState_||!this.renderer_)return;let a=this.getCoordinateFromPixelInternal(e);o=o!==void 0?o:{};let s=o.hitTolerance!==void 0?o.hitTolerance:0,f=o.layerFilter!==void 0?o.layerFilter:$u,v=o.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(a,this.frameState_,s,v,t,null,f,null)}getFeaturesAtPixel(e,t){let o=[];return this.forEachFeatureAtPixel(e,function(a){o.push(a)},t),o}getAllLayers(){let e=[];function t(o){o.forEach(function(a){a instanceof Pv?t(a.getLayers()):e.push(a)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;let o=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};let a=t.layerFilter!==void 0?t.layerFilter:$u,s=t.hitTolerance!==void 0?t.hitTolerance:0,f=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(o,this.frameState_,s,f,a,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){let o=this.viewport_.getBoundingClientRect(),a=this.getSize(),s=o.width/a[0],f=o.height/a[1],v="changedTouches"in e?e.changedTouches[0]:e;return[(v.clientX-o.left)/s,(v.clientY-o.top)/f]}getTarget(){return this.get(Uo.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return gv(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){let t=this.frameState_;return t?cr(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){let t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Uo.LAYERGROUP)}setLayers(e){let t=this.getLayerGroup();if(e instanceof Vo){t.setLayers(e);return}let o=t.getLayers();o.clear(),o.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){let e=this.getLayerGroup().getLayerStatesArray();for(let t=0,o=e.length;t<o;++t){let a=e[t];if(!a.visible)continue;let s=a.layer.getRenderer();if(s&&!s.ready)return!0;let f=a.layer.getSource();if(f&&f.loading)return!0}return!1}getPixelFromCoordinate(e){let t=Gl(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){let t=this.frameState_;return t?cr(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Uo.SIZE)}getView(){return this.get(Uo.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){let e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,o,a){return VN(this.frameState_,e,t,o,a)}handleBrowserEvent(e,t){t=t||e.type;let o=new zc(t,this,e);this.handleMapBrowserEvent(o)}handleMapBrowserEvent(e){if(!this.frameState_)return;let t=e.originalEvent,o=t.type;if(o===uv.POINTERDOWN||o===Ft.WHEEL||o===Ft.KEYDOWN){let a=this.getOwnerDocument(),s=this.viewport_.getRootNode?this.viewport_.getRootNode():a,f=t.target,v=s instanceof ShadowRoot?s.host===f?s.host.ownerDocument:s:s===a?a.documentElement:s;if(this.overlayContainerStopEvent_.contains(f)||!v.contains(f))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){let a=this.getInteractions().getArray().slice();for(let s=a.length-1;s>=0;s--){let f=a[s];if(f.getMap()!==this||!f.getActive()||!this.getTargetElement())continue;if(!f.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){let e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let a=this.maxTilesLoading_,s=a;if(e){let f=e.viewHints;if(f[no.ANIMATING]||f[no.INTERACTING]){let v=Date.now()-e.time>8;a=v?0:8,s=v?0:2}}t.getTilesLoading()<a&&(t.reprioritize(),t.loadMoreTiles(a,s))}e&&this.renderer_&&!e.animate&&(this.renderComplete_?(this.hasListener(Ho.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Ho.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new id(Bc.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new id(Bc.LOADSTART,this,e))));let o=this.postRenderFunctions_;if(e)for(let a=0,s=o.length;a<s;++a)o[a](this,e);o.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let o=0,a=this.targetChangeHandlerKeys_.length;o<a;++o)Gn(this.targetChangeHandlerKeys_[o]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(Ft.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(Ft.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_&&!$l(this.targetElement_)){this.resizeObserver_?.unobserve(this.targetElement_);let o=this.targetElement_.getRootNode();o instanceof ShadowRoot&&this.resizeObserver_.unobserve(o.host),this.setSize(void 0)}let e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{if($l(t)||t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new XB(this)),!$l(t)){this.mapBrowserEventHandler_=new zN(this,this.moveTolerance_);for(let a in $i)this.mapBrowserEventHandler_.addEventListener($i[a],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(Ft.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(Ft.WHEEL,this.boundHandleBrowserEvent_,pw?{passive:!1}:!1);let o;if(this.keyboardEventTarget_)o=this.keyboardEventTarget_;else{let a=t.getRootNode();o=a instanceof ShadowRoot?a.host:t}if(this.targetChangeHandlerKeys_=[xn(o,Ft.KEYDOWN,this.handleBrowserEvent,this),xn(o,Ft.KEYPRESS,this.handleBrowserEvent,this)],t instanceof HTMLElement){let a=t.getRootNode();a instanceof ShadowRoot&&this.resizeObserver_.observe(a.host),this.resizeObserver_?.observe(t)}}this.updateSize()}}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Gn(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Gn(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);let e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=xn(e,Nl.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=xn(e,Ft.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Gn),this.layerGroupPropertyListenerKeys_=null);let e=this.getLayerGroup();e&&(this.handleLayerAdd_(new Hl("addlayer",e)),this.layerGroupPropertyListenerKeys_=[xn(e,Nl.PROPERTYCHANGE,this.render,this),xn(e,Ft.CHANGE,this.render,this),xn(e,"addlayer",this.handleLayerAdd_,this),xn(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){if(!this.frameState_)return;let e=this.frameState_.layerStatesArray;for(let t=0,o=e.length;t<o;++t){let a=e[t].layer;a.hasRenderer()&&a.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){YB(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){let t=this.getSize(),o=this.getView(),a=this.frameState_,s=null;if(t!==void 0&&rM(t)&&o&&o.isDef()){let f=o.getHints(this.frameState_?this.frameState_.viewHints:void 0),v=o.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:wg(v.center,v.resolution,v.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:v,viewHints:f,wantedTiles:{},mapId:dn(this),renderTargets:{}},v.nextCenter&&v.nextResolution){let w=isNaN(v.nextRotation)?v.rotation:v.nextRotation;s.nextExtent=wg(v.nextCenter,v.nextResolution,w,t)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),a&&(!this.previousExtent_||!rd(this.previousExtent_)&&!Xu(s.extent,this.previousExtent_))&&(this.dispatchEvent(new id(Bc.MOVESTART,this,a)),this.previousExtent_=Wu(this.previousExtent_)),this.previousExtent_&&!s.viewHints[no.ANIMATING]&&!s.viewHints[no.INTERACTING]&&!Xu(s.extent,this.previousExtent_)&&(this.dispatchEvent(new id(Bc.MOVEEND,this,s)),yw(s.extent,this.previousExtent_))),this.dispatchEvent(new id(Bc.POSTRENDER,this,s)),this.renderComplete_=(this.hasListener(Bc.LOADSTART)||this.hasListener(Bc.LOADEND)||this.hasListener(Ho.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){let t=this.getLayerGroup();t&&this.handleLayerRemove_(new Hl("removelayer",t)),this.set(Uo.LAYERGROUP,e)}setSize(e){this.set(Uo.SIZE,e)}setTarget(e){this.set(Uo.TARGET,e)}setView(e){if(!e||e instanceof Pa){this.set(Uo.VIEW,e);return}this.set(Uo.VIEW,new Pa);let t=this;e.then(function(o){t.setView(new Pa(o))})}updateSize(){let e=this.getTargetElement(),t;if(e){let a,s;if($l(e))a=e.width,s=e.height;else{let f=getComputedStyle(e);a=e.offsetWidth-parseFloat(f.borderLeftWidth)-parseFloat(f.paddingLeft)-parseFloat(f.paddingRight)-parseFloat(f.borderRightWidth),s=e.offsetHeight-parseFloat(f.borderTopWidth)-parseFloat(f.paddingTop)-parseFloat(f.paddingBottom)-parseFloat(f.borderBottomWidth)}!isNaN(a)&&!isNaN(s)&&(t=[Math.max(0,a),Math.max(0,s)],!rM(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&Cw("No map visible because the map container's width or height are 0."))}let o=this.getSize();t&&(!o||!is(t,o))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){let t=this.getView();t&&t.setViewportSize(e)}};function Fq(n){let e=null;n.keyboardEventTarget!==void 0&&(e=typeof n.keyboardEventTarget=="string"?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);let t={},o=n.layers&&typeof n.layers.getLayers=="function"?n.layers:new Pv({layers:n.layers});t[Uo.LAYERGROUP]=o,t[Uo.TARGET]=n.target,t[Uo.VIEW]=n.view instanceof Pa?n.view:new Pa;let a;n.controls!==void 0&&(Array.isArray(n.controls)?a=new Vo(n.controls.slice()):(Cn(typeof n.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),a=n.controls));let s;n.interactions!==void 0&&(Array.isArray(n.interactions)?s=new Vo(n.interactions.slice()):(Cn(typeof n.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),s=n.interactions));let f;return n.overlays!==void 0?Array.isArray(n.overlays)?f=new Vo(n.overlays.slice()):(Cn(typeof n.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),f=n.overlays):f=new Vo,{controls:a,interactions:s,keyboardEventTarget:e,overlays:f,values:t}}var JB=RM;var LM=class n extends Ur{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){let t=e;this.setGeometry(t)}else{let t=e;this.setProperties(t)}}clone(){let e=new n(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());let t=this.getGeometry();t&&e.setGeometry(t.clone());let o=this.getStyle();return o&&e.setStyle(o),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Gn(this.geometryChangeKey_),this.geometryChangeKey_=null);let e=this.getGeometry();e&&(this.geometryChangeKey_=xn(e,Ft.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?Nq(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}};function Nq(n){if(typeof n=="function")return n;let e;return Array.isArray(n)?e=n:(Cn(typeof n.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),e=[n]),function(){return e}}var _1=LM;function lp(n,e,t,o,a,s,f){let v,w,D=(t-e)/o;if(D===1)v=e;else if(D===2)v=e,w=a;else if(D!==0){let A=n[e],z=n[e+1],H=0,q=[0];for(let ce=e+o;ce<t;ce+=o){let ue=n[ce],Me=n[ce+1];H+=Math.sqrt((ue-A)*(ue-A)+(Me-z)*(Me-z)),q.push(H),A=ue,z=Me}let W=a*H,me=PN(q,W);me<0?(w=(W-q[-me-2])/(q[-me-1]-q[-me-2]),v=e+(-me-2)*o):v=e+me*o}f=f>1?f:2,s=s||new Array(f);for(let A=0;A<f;++A)s[A]=v===void 0?NaN:w===void 0?n[v+A]:Go(n[v+A],n[v+o+A],w);return s}function y1(n,e,t,o,a,s){if(t==e)return null;let f;if(a<n[e+o-1])return s?(f=n.slice(e,e+o),f[o-1]=a,f):null;if(n[t-1]<a)return s?(f=n.slice(t-o,t),f[o-1]=a,f):null;if(a==n[e+o-1])return n.slice(e,e+o);let v=e/o,w=t/o;for(;v<w;){let H=v+w>>1;a<n[(H+1)*o-1]?w=H:v=H+1}let D=n[v*o-1];if(a==D)return n.slice((v-1)*o,(v-1)*o+o);let A=n[(v+1)*o-1],z=(a-D)/(A-D);f=[];for(let H=0;H<o-1;++H)f.push(Go(n[(v-1)*o+H],n[v*o+H],z));return f.push(a),f}function QB(n,e,t,o,a,s,f){if(f)return y1(n,e,t[t.length-1],o,a,s);let v;if(a<n[o-1])return s?(v=n.slice(0,o),v[o-1]=a,v):null;if(n[n.length-1]<a)return s?(v=n.slice(n.length-o),v[o-1]=a,v):null;for(let w=0,D=t.length;w<D;++w){let A=t[w];if(e!=A){if(a<n[e+o-1])return null;if(a<=n[A-1])return y1(n,e,A,o,a,!1);e=A}}return null}function Gg(n,e,t,o){let a=n[e],s=n[e+1],f=0;for(let v=e+o;v<t;v+=o){let w=n[v],D=n[v+1];f+=Math.sqrt((w-a)*(w-a)+(D-s)*(D-s)),a=w,s=D}return f}var OM=class n extends qs{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendCoordinate(e){jo(this.flatCoordinates,e),this.changed()}clone(){let e=new n(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,o,a){return a<$s(this.getExtent(),e,t)?a:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(_v(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),vv(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,o,a))}forEachSegment(e){return jw(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return this.layout!="XYM"&&this.layout!="XYZM"?null:(t=t!==void 0?t:!1,y1(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return ol(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return lp(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return Gg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){let t=[];return t.length=Qf(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new n(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return Cv(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,this.getExtent())}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Jf(this.flatCoordinates,0,e,this.stride),this.changed()}},$g=OM;var kM=class n extends qs{constructor(e,t,o){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(t!==void 0&&o)this.setFlatCoordinates(t,e),this.ends_=o;else{let a=e,s=[],f=[];for(let w=0,D=a.length;w<D;++w){let A=a[w];jo(s,A.getFlatCoordinates()),f.push(s.length)}let v=a.length===0?this.getLayout():a[0].getLayout();this.setFlatCoordinates(v,s),this.ends_=f}}appendLineString(e){jo(this.flatCoordinates,e.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){let e=new n(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,o,a){return a<$s(this.getExtent(),e,t)?a:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(yv(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),xv(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,o,a))}getCoordinateAtM(e,t,o){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(t=t!==void 0?t:!1,o=o!==void 0?o:!1,QB(this.flatCoordinates,0,this.ends_,this.stride,e,t,o))}getCoordinates(){return ud(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new $g(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){let e=this.flatCoordinates,t=this.ends_,o=this.layout,a=[],s=0;for(let f=0,v=t.length;f<v;++f){let w=t[f],D=new $g(e.slice(s,w),o);a.push(D),s=w}return a}getLength(){let e=this.ends_,t=0,o=0;for(let a=0,s=e.length;a<s;++a)o+=Gg(this.flatCoordinates,t,e[a],this.stride),t=e[a];return o}getFlatMidpoints(){let e=[],t=this.flatCoordinates,o=0,a=this.ends_,s=this.stride;for(let f=0,v=a.length;f<v;++f){let w=a[f],D=lp(t,o,w,s,.5);jo(e,D),o=w}return e}getSimplifiedGeometryInternal(e){let t=[],o=[];return t.length=zw(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,o),new n(t,"XY",o)}getType(){return"MultiLineString"}intersectsExtent(e){return Fz(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);let o=cd(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=o.length===0?0:o[o.length-1],this.changed()}},FM=kM;var NM=class n extends qs{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){jo(this.flatCoordinates,e.getFlatCoordinates()),this.changed()}clone(){let e=new n(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,o,a){if(a<$s(this.getExtent(),e,t))return a;let s=this.flatCoordinates,f=this.stride;for(let v=0,w=s.length;v<w;v+=f){let D=zl(e,t,s[v],s[v+1]);if(D<a){a=D;for(let A=0;A<f;++A)o[A]=s[v+A];o.length=f}}return a}getCoordinates(){return ol(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){let t=this.flatCoordinates.length/this.stride;return e<0||t<=e?null:new dd(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){let e=this.flatCoordinates,t=this.layout,o=this.stride,a=[];for(let s=0,f=e.length;s<f;s+=o){let v=new dd(e.slice(s,s+o),t);a.push(v)}return a}getType(){return"MultiPoint"}intersectsExtent(e){let t=this.flatCoordinates,o=this.stride;for(let a=0,s=t.length;a<s;a+=o){let f=t[a],v=t[a+1];if(fv(e,f,v))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Jf(this.flatCoordinates,0,e,this.stride),this.changed()}},Xv=NM;function v1(n,e,t,o){let a=[],s=ar();for(let f=0,v=t.length;f<v;++f){let w=t[f];s=vg(n,e,w[0],o),a.push((s[0]+s[2])/2,(s[1]+s[3])/2),e=w[w.length-1]}return a}var zM=class n extends qs{constructor(e,t,o){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!o&&!Array.isArray(e[0])){let a=e,s=[],f=[];for(let v=0,w=a.length;v<w;++v){let D=a[v],A=s.length,z=D.getEnds();for(let H=0,q=z.length;H<q;++H)z[H]+=A;jo(s,D.getFlatCoordinates()),f.push(z)}t=a.length===0?this.getLayout():a[0].getLayout(),e=s,o=f}t!==void 0&&o?(this.setFlatCoordinates(t,e),this.endss_=o):this.setCoordinates(e,t)}appendPolygon(e){let t;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();else{let o=this.flatCoordinates.length;jo(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let a=0,s=t.length;a<s;++a)t[a]+=o}this.endss_.push(t),this.changed()}clone(){let e=this.endss_.length,t=new Array(e);for(let a=0;a<e;++a)t[a]=this.endss_[a].slice();let o=new n(this.flatCoordinates.slice(),this.layout,t);return o.applyProperties(this),o}closestPointXY(e,t,o,a){return a<$s(this.getExtent(),e,t)?a:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Pz(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Az(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,o,a))}containsXY(e,t){return kz(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return Dz(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),Sv(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,bv(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){let e=v1(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Bw(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Xv(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){let e=this.flatCoordinates;Vw(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=Sv(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){let t=[],o=[];return t.length=Lz(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,o),new n(t,"XY",o)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(e===0)t=0;else{let s=this.endss_[e-1];t=s[s.length-1]}let o=this.endss_[e].slice(),a=o[o.length-1];if(t!==0)for(let s=0,f=o.length;s<f;++s)o[s]-=t;return new pd(this.flatCoordinates.slice(t,a),this.layout,o)}getPolygons(){let e=this.layout,t=this.flatCoordinates,o=this.endss_,a=[],s=0;for(let f=0,v=o.length;f<v;++f){let w=o[f].slice(),D=w[w.length-1];if(s!==0)for(let z=0,H=w.length;z<H;++z)w[z]-=s;let A=new pd(t.slice(s,D),e,w);a.push(A),s=D}return a}getType(){return"MultiPolygon"}intersectsExtent(e){return Nz(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);let o=Nw(this.flatCoordinates,0,e,this.stride,this.endss_);if(o.length===0)this.flatCoordinates.length=0;else{let a=o[o.length-1];this.flatCoordinates.length=a.length===0?0:a[a.length-1]}this.changed()}},BM=zM;var VM=class n extends Fw{constructor(e){super(),this.geometries_=e,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(Gn),this.changeEventsKeys_.length=0}listenGeometriesChange_(){let e=this.geometries_;for(let t=0,o=e.length;t<o;++t)this.changeEventsKeys_.push(xn(e[t],Ft.CHANGE,this.changed,this))}clone(){let e=new n(jM(this.geometries_));return e.applyProperties(this),e}closestPointXY(e,t,o,a){if(a<$s(this.getExtent(),e,t))return a;let s=this.geometries_;for(let f=0,v=s.length;f<v;++f)a=s[f].closestPointXY(e,t,o,a);return a}containsXY(e,t){let o=this.geometries_;for(let a=0,s=o.length;a<s;++a)if(o[a].containsXY(e,t))return!0;return!1}computeExtent(e){Wu(e);let t=this.geometries_;for(let o=0,a=t.length;o<a;++o)xw(e,t[o].getExtent());return e}getGeometries(){return jM(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[],t=this.geometries_;for(let o=0,a=t.length;o<a;++o)t[o].getType()===this.getType()?e=e.concat(t[o].getGeometriesArrayRecursive()):e.push(t[o]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;let t=[],o=this.geometries_,a=!1;for(let s=0,f=o.length;s<f;++s){let v=o[s],w=v.getSimplifiedGeometry(e);t.push(w),w!==v&&(a=!0)}return a?new n(t):(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getType(){return"GeometryCollection"}intersectsExtent(e){let t=this.geometries_;for(let o=0,a=t.length;o<a;++o)if(t[o].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,t){let o=this.geometries_;for(let a=0,s=o.length;a<s;++a)o[a].rotate(e,t);this.changed()}scale(e,t,o){o||(o=Hs(this.getExtent()));let a=this.geometries_;for(let s=0,f=a.length;s<f;++s)a[s].scale(e,t,o);this.changed()}setGeometries(e){this.setGeometriesArray(jM(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){let t=this.geometries_;for(let o=0,a=t.length;o<a;++o)t[o].applyTransform(e);this.changed()}translate(e,t){let o=this.geometries_;for(let a=0,s=o.length;a<s;++a)o[a].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}};function jM(n){return n.map(e=>e.clone())}var UM=VM;var ej=Io(),Yv=class n{constructor(e,t,o,a,s,f){this.styleFunction,this.extent_,this.id_=f,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=o||null,this.properties_=s,this.squaredTolerance_,this.stride_=a,this.simplifiedGeometry_}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?vw(this.flatCoordinates_):vg(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){let e=Hs(this.getExtent());this.flatInteriorPoints_=Tv(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){let e=Bz(this.flatCoordinates_,this.ends_),t=v1(this.flatCoordinates_,0,e,2);this.flatInteriorPoints_=Bw(this.flatCoordinates_,0,e,2,t)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=lp(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];let e=this.flatCoordinates_,t=0,o=this.ends_;for(let a=0,s=o.length;a<s;++a){let f=o[a],v=lp(e,t,f,2,.5);jo(this.flatMidpoints_,v),t=f}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,t){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=si(e);let t=e.getExtent(),o=e.getWorldExtent();if(t&&o){let a=Hi(o)/Hi(t);$o(ej,o[0],o[3],a,-a,0,0,0),Zs(this.flatCoordinates_,0,this.flatCoordinates_.length,2,ej,this.flatCoordinates_)}}applyTransform(e){e(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new n(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=hw((e,t)=>{if(e===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),t&&this.simplifiedGeometry_.applyTransform(t);let o=this.simplifiedGeometry_.getFlatCoordinates(),a;switch(this.type_){case"LineString":o.length=Qf(o,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,e,o,0),a=[o.length];break;case"MultiLineString":a=[],o.length=zw(o,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,e,o,0,a);break;case"Polygon":a=[],o.length=wv(o,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(e),o,0,a);break;default:}return a&&(this.simplifiedGeometry_=new n(this.type_,o,a,2,this.properties_,this.id_)),this.squaredTolerance_=e,this.simplifiedGeometry_}),this}};Yv.prototype.getFlatCoordinates=Yv.prototype.getOrientedFlatCoordinates;var Wl=Yv;var GM=class{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=_1,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let o=t.dataProjection?si(t.dataProjection):this.readProjection(e);t.extent&&o&&o.getUnits()==="tile-pixels"&&(o=si(o),o.setWorldExtent(t.extent)),t={dataProjection:o,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return Xt()}readFeature(e,t){return Xt()}readFeatures(e,t){return Xt()}readGeometry(e,t){return Xt()}readProjection(e){return Xt()}writeFeature(e,t){return Xt()}writeFeatures(e,t){return Xt()}writeGeometry(e,t){return Xt()}},tj=GM;function x1(n,e,t){let o=t?si(t.featureProjection):null,a=t?si(t.dataProjection):null,s=n;if(o&&a&&!sd(o,a)){e&&(s=n.clone());let f=e?o:a,v=e?a:o;f.getUnits()==="tile-pixels"?s.transform(f,v):s.applyTransform(Ju(f,v))}if(e&&t&&t.decimals!==void 0){let f=Math.pow(10,t.decimals),v=function(w){for(let D=0,A=w.length;D<A;++D)w[D]=Math.round(w[D]*f)/f;return w};s===n&&(s=n.clone()),s.applyTransform(v)}return s}var zq={Point:dd,LineString:$g,Polygon:pd,MultiPoint:Xv,MultiLineString:FM,MultiPolygon:BM};function Bq(n,e,t){return Array.isArray(e[0])?(Vw(n,0,e,t)||(n=n.slice(),Sv(n,0,e,t)),n):(Iv(n,0,e,t)||(n=n.slice(),Pg(n,0,e,t)),n)}function $M(n,e){let t=n.geometry;if(!t)return[];if(Array.isArray(t))return t.map(s=>$M(Xn(St({},n),{geometry:s}))).flat();let o=t.type==="MultiPolygon"?"Polygon":t.type;if(o==="GeometryCollection"||o==="Circle")throw new Error("Unsupported geometry type: "+o);let a=t.layout.length;return x1(new Wl(o,o==="Polygon"?Bq(t.flatCoordinates,t.ends,a):t.flatCoordinates,t.ends?.flat(),a,n.properties||{},n.id).enableSimplifyTransformed(),!1,e)}function b1(n,e){if(!n)return null;if(Array.isArray(n)){let o=n.map(a=>b1(a,e));return new UM(o)}let t=zq[n.type];return x1(new t(n.flatCoordinates,n.layout||"XY",n.ends),!1,e)}var HM=class extends tj{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(w1(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(w1(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return Xt()}readFeaturesFromObject(e,t){return Xt()}readGeometry(e,t){return this.readGeometryFromObject(w1(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return Xt()}readProjection(e){return this.readProjectionFromObject(w1(e))}readProjectionFromObject(e){return Xt()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return Xt()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return Xt()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return Xt()}};function w1(n){if(typeof n=="string"){let e=JSON.parse(n);return e||null}return n!==null?n:null}var nj=HM;var ZM=class extends nj{constructor(e){e=e||{},super(),this.dataProjection=si(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=si(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let o=null;e.type==="Feature"?o=e:o={type:"Feature",geometry:e,properties:null};let a=WM(o.geometry,t);if(this.featureClass===Wl)return $M({geometry:a,id:o.id,properties:o.properties},t);let s=new _1;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&o.geometry_name&&s.setGeometryName(o.geometry_name),s.setGeometry(b1(a,t)),"id"in o&&s.setId(o.id),o.properties&&s.setProperties(o.properties,!0),s}readFeaturesFromObject(e,t){let o=e,a=null;if(o.type==="FeatureCollection"){let s=e;a=[];let f=s.features;for(let v=0,w=f.length;v<w;++v){let D=this.readFeatureFromObject(f[v],t);D&&a.push(D)}}else a=[this.readFeatureFromObject(e,t)];return a.flat()}readGeometryFromObject(e,t){return jq(e,t)}readProjectionFromObject(e){let t=e.crs,o;if(t)if(t.type=="name")o=si(t.properties.name);else if(t.type==="EPSG")o=si("EPSG:"+t.properties.code);else throw new Error("Unknown SRS type");else o=this.dataProjection;return o}writeFeatureObject(e,t){t=this.adaptOptions(t);let o={type:"Feature",geometry:null,properties:null},a=e.getId();if(a!==void 0&&(o.id=a),!e.hasProperties())return o;let s=e.getProperties(),f=e.getGeometry();return f&&(o.geometry=qM(f,t),delete s[e.getGeometryName()]),Da(s)||(o.properties=s),o}writeFeaturesObject(e,t){t=this.adaptOptions(t);let o=[];for(let a=0,s=e.length;a<s;++a)o.push(this.writeFeatureObject(e[a],t));return{type:"FeatureCollection",features:o}}writeGeometryObject(e,t){return qM(e,this.adaptOptions(t))}};function WM(n,e){if(!n)return null;let t;switch(n.type){case"Point":{t=Uq(n);break}case"LineString":{t=Gq(n);break}case"Polygon":{t=qq(n);break}case"MultiPoint":{t=Hq(n);break}case"MultiLineString":{t=$q(n);break}case"MultiPolygon":{t=Zq(n);break}case"GeometryCollection":{t=Vq(n);break}default:throw new Error("Unsupported GeoJSON type: "+n.type)}return t}function jq(n,e){let t=WM(n,e);return b1(t,e)}function Vq(n,e){return n.geometries.map(function(o){return WM(o,e)})}function Uq(n){let e=n.coordinates;return{type:"Point",flatCoordinates:e,layout:ld(e.length)}}function Gq(n){let e=n.coordinates,t=e.flat();return{type:"LineString",flatCoordinates:t,ends:[t.length],layout:ld(e[0]?.length||2)}}function $q(n){let e=n.coordinates,t=e[0]?.[0]?.length||2,o=[],a=cd(o,0,e,t);return{type:"MultiLineString",flatCoordinates:o,ends:a,layout:ld(t)}}function Hq(n){let e=n.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:ld(e[0]?.length||2)}}function Zq(n){let e=n.coordinates,t=[],o=e[0]?.[0]?.[0].length||2,a=Nw(t,0,e,o);return{type:"MultiPolygon",flatCoordinates:t,ends:a,layout:ld(o)}}function qq(n){let e=n.coordinates,t=[],o=e[0]?.[0]?.length,a=cd(t,0,e,o);return{type:"Polygon",flatCoordinates:t,ends:a,layout:ld(o)}}function qM(n,e){n=x1(n,!0,e);let t=n.getType(),o;switch(t){case"Point":{o=Qq(n,e);break}case"LineString":{o=Xq(n,e);break}case"Polygon":{o=eW(n,e);break}case"MultiPoint":{o=Kq(n,e);break}case"MultiLineString":{o=Yq(n,e);break}case"MultiPolygon":{o=Jq(n,e);break}case"GeometryCollection":{o=Wq(n,e);break}case"Circle":{o={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return o}function Wq(n,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:n.getGeometriesArray().map(function(o){return qM(o,e)})}}function Xq(n,e){return{type:"LineString",coordinates:n.getCoordinates()}}function Yq(n,e){return{type:"MultiLineString",coordinates:n.getCoordinates()}}function Kq(n,e){return{type:"MultiPoint",coordinates:n.getCoordinates()}}function Jq(n,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:n.getCoordinates(t)}}function Qq(n,e){return{type:"Point",coordinates:n.getCoordinates()}}function eW(n,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:n.getCoordinates(t)}}var XM=ZM;var YM=class extends nd{constructor(e,t,o){super(),o=o||{},this.tileCoord=e,this.state=t,this.key="",this.transition_=o.transition===void 0?250:o.transition,this.transitionStarts_={},this.interpolate=!!o.interpolate}changed(){this.dispatchEvent(Ft.CHANGE)}release(){this.setState(jt.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==jt.EMPTY){if(this.state!==jt.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}}load(){Xt()}getAlpha(e,t){if(!this.transition_)return 1;let o=this.transitionStarts_[e];if(!o)o=t,this.transitionStarts_[e]=o;else if(o===-1)return 1;let a=t-o+1e3/60;return a>=this.transition_?1:GS(a/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}disposeInternal(){this.release(),super.disposeInternal()}},Hg=YM;function E1(n){return n instanceof Image||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageBitmap?n:null}var tW=new Error("disposed");var nW=[256,256],KM=class extends Hg{constructor(e){let t=jt.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;let e=E1(this.data_);return e?[e.width,e.height]:nW}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==jt.IDLE&&this.state!==jt.ERROR)return;this.state=jt.LOADING,this.changed();let e=this;this.loader_().then(function(t){e.data_=t,e.state=jt.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=jt.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(tW),this.controller_=null),super.disposeInternal()}},JM=KM;var QM=class extends Hg{constructor(e,t,o,a,s,f){super(e,t,f),this.crossOrigin_=a,this.src_=o,this.key=o,this.image_,to?this.image_=new OffscreenCanvas(1,1):(this.image_=new Image,a!==null&&(this.image_.crossOrigin=a)),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(e){this.image_=e,this.state=jt.LOADED,this.unlistenImage_(),this.changed()}getCrossOrigin(){return this.crossOrigin_}handleImageError_(){this.state=jt.ERROR,this.unlistenImage_(),this.image_=iW(),this.changed()}handleImageLoad_(){if(to)this.state=jt.LOADED;else{let e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=jt.LOADED:this.state=jt.EMPTY}this.unlistenImage_(),this.changed()}load(){this.state==jt.ERROR&&(this.state=jt.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==jt.IDLE&&(this.state=jt.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=IB(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}};function iW(){let n=xi(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}var T1=QM;var C1=class{constructor(e,t,o,a){this.minX=e,this.maxX=t,this.minY=o,this.maxY=a}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}};function cp(n,e,t,o,a){return a!==void 0?(a.minX=n,a.maxX=e,a.minY=t,a.maxY=o,a):new C1(n,e,t,o)}var I1=C1;var eP,up=[];function ij(n,e,t,o,a){n.beginPath(),n.moveTo(0,0),n.lineTo(e,t),n.lineTo(o,a),n.closePath(),n.save(),n.clip(),n.fillRect(0,0,Math.max(e,o)+1,Math.max(t,a)),n.restore()}function tP(n,e){return Math.abs(n[e*4]-210)>2||Math.abs(n[e*4+3]-.75*255)>2}function rW(){if(eP===void 0){let n=xi(6,6,up);n.globalCompositeOperation="lighter",n.fillStyle="rgba(210, 0, 0, 0.75)",ij(n,4,5,4,0),ij(n,4,5,0,5);let e=n.getImageData(0,0,3,3).data;eP=tP(e,0)||tP(e,4)||tP(e,8),ep(n),up.push(n.canvas)}return eP}function S1(n,e,t,o){let a=Qu(t,e,n),s=nD(e,o,t),f=e.getMetersPerUnit();f!==void 0&&(s*=f);let v=n.getMetersPerUnit();v!==void 0&&(s/=v);let w=n.getExtent();if(!w||Vl(w,a)){let D=nD(n,s,a)/s;isFinite(D)&&D>0&&(s/=D)}return s}function rj(n,e,t,o){let a=Hs(t),s=S1(n,e,a,o);return(!isFinite(s)||s<=0)&&bw(t,function(f){return s=S1(n,e,f,o),isFinite(s)&&s>0}),s}function oj(n,e,t,o,a,s,f,v,w,D,A,z,H,q){let W=xi(Math.round(t*n),Math.round(t*e),up);if(z||(W.imageSmoothingEnabled=!1),w.length===0)return W.canvas;W.scale(t,t);function me(ke){return Math.round(ke*t)/t}W.globalCompositeOperation="lighter";let ce=ar();w.forEach(function(ke,Qe,ot){xw(ce,ke.extent)});let ue,Me=t/o,Ue=(z?1:1+Math.pow(2,-24))/Me;if(!H||w.length!==1||D!==0){if(ue=xi(Math.round(In(ce)*Me),Math.round(Hi(ce)*Me),up),z||(ue.imageSmoothingEnabled=!1),a&&q){let ke=(a[0]-ce[0])*Me,Qe=-(a[3]-ce[3])*Me,ot=In(a)*Me,st=Hi(a)*Me;ue.rect(ke,Qe,ot,st),ue.clip()}w.forEach(function(ke,Qe,ot){if(ke.image.width>0&&ke.image.height>0){if(ke.clipExtent){ue.save();let Pt=(ke.clipExtent[0]-ce[0])*Me,At=-(ke.clipExtent[3]-ce[3])*Me,Gt=In(ke.clipExtent)*Me,yt=Hi(ke.clipExtent)*Me;ue.rect(z?Pt:Math.round(Pt),z?At:Math.round(At),z?Gt:Math.round(Pt+Gt)-Math.round(Pt),z?yt:Math.round(At+yt)-Math.round(At)),ue.clip()}let st=(ke.extent[0]-ce[0])*Me,it=-(ke.extent[3]-ce[3])*Me,pt=In(ke.extent)*Me,Vt=Hi(ke.extent)*Me;ue.drawImage(ke.image,D,D,ke.image.width-2*D,ke.image.height-2*D,z?st:Math.round(st),z?it:Math.round(it),z?pt:Math.round(st+pt)-Math.round(st),z?Vt:Math.round(it+Vt)-Math.round(it)),ke.clipExtent&&ue.restore()}})}let Pe=tl(f);return v.getTriangles().forEach(function(ke,Qe,ot){let st=ke.source,it=ke.target,pt=st[0][0],Vt=st[0][1],Pt=st[1][0],At=st[1][1],Gt=st[2][0],yt=st[2][1],dt=me((it[0][0]-Pe[0])/s),ft=me(-(it[0][1]-Pe[1])/s),rt=me((it[1][0]-Pe[0])/s),Dt=me(-(it[1][1]-Pe[1])/s),$t=me((it[2][0]-Pe[0])/s),Qt=me(-(it[2][1]-Pe[1])/s),et=pt,Zt=Vt;pt=0,Vt=0,Pt-=et,At-=Zt,Gt-=et,yt-=Zt;let Rt=[[Pt,At,0,0,rt-dt],[Gt,yt,0,0,$t-dt],[0,0,Pt,At,Dt-ft],[0,0,Gt,yt,Qt-ft]],Sn=GN(Rt);if(!Sn)return;if(W.save(),W.beginPath(),rW()||!z){W.moveTo(rt,Dt);let Ei=4,Zi=dt-rt,Ti=ft-Dt;for(let ti=0;ti<Ei;ti++)W.lineTo(rt+me((ti+1)*Zi/Ei),Dt+me(ti*Ti/(Ei-1))),ti!=Ei-1&&W.lineTo(rt+me((ti+1)*Zi/Ei),Dt+me((ti+1)*Ti/(Ei-1)));W.lineTo($t,Qt)}else W.moveTo(rt,Dt),W.lineTo(dt,ft),W.lineTo($t,Qt);W.clip(),W.transform(Sn[0],Sn[2],Sn[1],Sn[3],dt,ft),W.translate(ce[0]-et,ce[3]-Zt);let kn;if(ue)kn=ue.canvas,W.scale(Ue,-Ue);else{let Ei=w[0],Zi=Ei.extent;kn=Ei.image,W.scale(In(Zi)/kn.width,-Hi(Zi)/kn.height)}W.drawImage(kn,0,0),W.restore()}),ue&&(ep(ue),up.push(ue.canvas)),A&&(W.save(),W.globalCompositeOperation="source-over",W.strokeStyle="black",W.lineWidth=1,v.getTriangles().forEach(function(ke,Qe,ot){let st=ke.target,it=(st[0][0]-Pe[0])/s,pt=-(st[0][1]-Pe[1])/s,Vt=(st[1][0]-Pe[0])/s,Pt=-(st[1][1]-Pe[1])/s,At=(st[2][0]-Pe[0])/s,Gt=-(st[2][1]-Pe[1])/s;W.beginPath(),W.moveTo(Vt,Pt),W.lineTo(it,pt),W.lineTo(At,Gt),W.closePath(),W.stroke()}),W.restore()),W.canvas}var oW=10,sj=.25,nP=class{constructor(e,t,o,a,s,f,v){this.sourceProj_=e,this.targetProj_=t;let w={},D=v?yz(Ue=>cr(v,Qu(Ue,this.targetProj_,this.sourceProj_))):Ju(this.targetProj_,this.sourceProj_);this.transformInv_=function(Ue){let Pe=Ue[0]+"/"+Ue[1];return w[Pe]||(w[Pe]=D(Ue)),w[Pe]},this.maxSourceExtent_=a,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!a&&!!this.sourceProj_.getExtent()&&In(a)>=In(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?In(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?In(this.targetProj_.getExtent()):null;let A=tl(o),z=Eg(o),H=bg(o),q=xg(o),W=this.transformInv_(A),me=this.transformInv_(z),ce=this.transformInv_(H),ue=this.transformInv_(q),Me=oW+(f?Math.max(0,Math.ceil(Math.log2(pv(o)/(f*f*256*256)))):0);if(this.addQuad_(A,z,H,q,W,me,ce,ue,Me),this.wrapsXInSource_){let Ue=1/0;this.triangles_.forEach(function(Pe,ke,Qe){Ue=Math.min(Ue,Pe.source[0][0],Pe.source[1][0],Pe.source[2][0])}),this.triangles_.forEach(Pe=>{if(Math.max(Pe.source[0][0],Pe.source[1][0],Pe.source[2][0])-Ue>this.sourceWorldWidth_/2){let ke=[[Pe.source[0][0],Pe.source[0][1]],[Pe.source[1][0],Pe.source[1][1]],[Pe.source[2][0],Pe.source[2][1]]];ke[0][0]-Ue>this.sourceWorldWidth_/2&&(ke[0][0]-=this.sourceWorldWidth_),ke[1][0]-Ue>this.sourceWorldWidth_/2&&(ke[1][0]-=this.sourceWorldWidth_),ke[2][0]-Ue>this.sourceWorldWidth_/2&&(ke[2][0]-=this.sourceWorldWidth_);let Qe=Math.min(ke[0][0],ke[1][0],ke[2][0]);Math.max(ke[0][0],ke[1][0],ke[2][0])-Qe<this.sourceWorldWidth_/2&&(Pe.source=ke)}})}w={}}addTriangle_(e,t,o,a,s,f){this.triangles_.push({source:[a,s,f],target:[e,t,o]})}addQuad_(e,t,o,a,s,f,v,w,D){let A=BS([s,f,v,w]),z=this.sourceWorldWidth_?In(A)/this.sourceWorldWidth_:null,H=this.sourceWorldWidth_,q=this.sourceProj_.canWrapX()&&z>.5&&z<1,W=!1;if(D>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){let ce=BS([e,t,o,a]);W=In(ce)/this.targetWorldWidth_>sj||W}!q&&this.sourceProj_.isGlobal()&&z&&(W=z>sj||W)}if(!W&&this.maxSourceExtent_&&isFinite(A[0])&&isFinite(A[1])&&isFinite(A[2])&&isFinite(A[3])&&!lr(A,this.maxSourceExtent_))return;let me=0;if(!W&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(f[0])||!isFinite(f[1])||!isFinite(v[0])||!isFinite(v[1])||!isFinite(w[0])||!isFinite(w[1]))){if(D>0)W=!0;else if(me=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(f[0])||!isFinite(f[1])?4:0)+(!isFinite(v[0])||!isFinite(v[1])?2:0)+(!isFinite(w[0])||!isFinite(w[1])?1:0),me!=1&&me!=2&&me!=4&&me!=8)return}if(D>0){if(!W){let ce=[(e[0]+o[0])/2,(e[1]+o[1])/2],ue=this.transformInv_(ce),Me;q?Me=(jl(s[0],H)+jl(v[0],H))/2-jl(ue[0],H):Me=(s[0]+v[0])/2-ue[0];let Ue=(s[1]+v[1])/2-ue[1];W=Me*Me+Ue*Ue>this.errorThresholdSquared_}if(W){if(Math.abs(e[0]-o[0])<=Math.abs(e[1]-o[1])){let ce=[(t[0]+o[0])/2,(t[1]+o[1])/2],ue=this.transformInv_(ce),Me=[(a[0]+e[0])/2,(a[1]+e[1])/2],Ue=this.transformInv_(Me);this.addQuad_(e,t,ce,Me,s,f,ue,Ue,D-1),this.addQuad_(Me,ce,o,a,Ue,ue,v,w,D-1)}else{let ce=[(e[0]+t[0])/2,(e[1]+t[1])/2],ue=this.transformInv_(ce),Me=[(o[0]+a[0])/2,(o[1]+a[1])/2],Ue=this.transformInv_(Me);this.addQuad_(e,ce,Me,a,s,ue,Ue,w,D-1),this.addQuad_(ce,t,o,Me,ue,f,v,Ue,D-1)}return}}if(q){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(me&11)==0&&this.addTriangle_(e,o,a,s,v,w),(me&14)==0&&this.addTriangle_(e,o,t,s,v,f),me&&((me&13)==0&&this.addTriangle_(t,a,e,f,w,s),(me&7)==0&&this.addTriangle_(t,a,o,f,w,v))}calculateSourceExtent(){let e=ar();return this.triangles_.forEach(function(t,o,a){let s=t.source;qf(e,s[0]),qf(e,s[1]),qf(e,s[2])}),e}getTriangles(){return this.triangles_}},aj=nP;var iP=class extends Hg{constructor(e,t,o,a,s,f,v,w,D,A,z,H){super(s,jt.IDLE,H),this.renderEdges_=z!==void 0?z:!1,this.pixelRatio_=v,this.gutter_=w,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=a,this.wrappedTileCoord_=f||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;let q=a.getTileCoordExtent(this.wrappedTileCoord_),W=this.targetTileGrid_.getExtent(),me=this.sourceTileGrid_.getExtent(),ce=W?jc(q,W):q;if(pv(ce)===0){this.state=jt.EMPTY;return}let ue=e.getExtent();ue&&(me?me=jc(me,ue):me=ue);let Me=a.getResolution(this.wrappedTileCoord_[0]),Ue=rj(e,o,ce,Me);if(!isFinite(Ue)||Ue<=0){this.state=jt.EMPTY;return}let Pe=A!==void 0?A:.5;if(this.triangulation_=new aj(e,o,ce,me,Ue*Pe,Me),this.triangulation_.getTriangles().length===0){this.state=jt.EMPTY;return}this.sourceZ_=t.getZForResolution(Ue);let ke=this.triangulation_.calculateSourceExtent();if(me&&(e.canWrapX()?(ke[1]=ci(ke[1],me[1],me[3]),ke[3]=ci(ke[3],me[1],me[3])):ke=jc(ke,me)),!pv(ke))this.state=jt.EMPTY;else{let Qe=0,ot=0;e.canWrapX()&&(Qe=In(ue),ot=Math.floor((ke[0]-ue[0])/Qe)),ww(ke.slice(),e,!0).forEach(it=>{let pt=t.getTileRangeForExtentAndZ(it,this.sourceZ_);for(let Vt=pt.minX;Vt<=pt.maxX;Vt++)for(let Pt=pt.minY;Pt<=pt.maxY;Pt++){let At=D(this.sourceZ_,Vt,Pt,v);if(At){let Gt=ot*Qe;this.sourceTiles_.push({tile:At,offset:Gt})}}++ot}),this.sourceTiles_.length===0&&(this.state=jt.EMPTY)}}getImage(){return this.canvas_}reproject_(){let e=[];if(this.sourceTiles_.forEach(t=>{let o=t.tile;if(o&&o.getState()==jt.LOADED){let a=this.sourceTileGrid_.getTileCoordExtent(o.tileCoord);a[0]+=t.offset,a[2]+=t.offset;let s=this.clipExtent_?.slice();s&&(s[0]+=t.offset,s[2]+=t.offset),e.push({extent:a,clipExtent:s,image:o.getImage()})}}),this.sourceTiles_.length=0,e.length===0)this.state=jt.ERROR;else{let t=this.wrappedTileCoord_[0],o=this.targetTileGrid_.getTileSize(t),a=typeof o=="number"?o:o[0],s=typeof o=="number"?o:o[1],f=this.targetTileGrid_.getResolution(t),v=this.sourceTileGrid_.getResolution(this.sourceZ_),w=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=oj(a,s,this.pixelRatio_,v,this.sourceTileGrid_.getExtent(),f,w,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=jt.LOADED}this.changed()}load(){if(this.state==jt.IDLE){this.state=jt.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{let o=t.getState();if(o==jt.IDLE||o==jt.LOADING){e++;let a=xn(t,Ft.CHANGE,s=>{let f=t.getState();(f==jt.LOADED||f==jt.ERROR||f==jt.EMPTY)&&(Gn(a),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(a)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t},o,a){t.getState()==jt.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Gn),this.sourcesListenerKeys_=null}release(){this.canvas_&&(ep(this.canvas_.getContext("2d")),up.push(this.canvas_),this.canvas_=null),super.release()}},D1=iP;var rP=class{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){let e=this.pop();e instanceof td&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){let o=this.entries_[e];return Cn(o!==void 0,"Tried to get a value for a key that does not exist in the cache"),o===this.newest_||(o===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(o.newer.older=o.older,o.older.newer=o.newer),o.newer=null,o.older=this.newest_,this.newest_.newer=o,this.newest_=o),o.value_}remove(e){let t=this.entries_[e];return Cn(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){let e=new Array(this.count_),t=0,o;for(o=this.newest_;o;o=o.older)e[t++]=o.key_;return e}getValues(){let e=new Array(this.count_),t=0,o;for(o=this.newest_;o;o=o.older)e[t++]=o.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){let e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){Cn(!(e in this.entries_),"Tried to set a value for a key that is used already");let o={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=o:this.oldest_=o,this.newest_=o,this.entries_[e]=o,++this.count_}setSize(e){this.highWaterMark=e}},oP=rP;function Zg(n,e,t,o){return o!==void 0?(o[0]=n,o[1]=e,o[2]=t,o):[n,e,t]}function sW(n,e,t){return n+"/"+e+"/"+t}function qg(n,e,t,o,a){return`${dn(n)},${e},${sW(t,o,a)}`}function M1(n){return aW(n[0],n[1],n[2])}function aW(n,e,t){return(e<<n)+t}function lj(n,e){let t=n[0],o=n[1],a=n[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;let s=e.getFullTileRange(t);return s?s.containsXY(o,a):!0}var sP=class{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(Lg(),{get:(e,t)=>{if(typeof Lg()[t]=="function")return this.push_(t),this.pushMethodArgs_},set:(e,t,o)=>(this.push_(t,o),!0)})}push_(...e){let t=this.instructions_,o=this.zIndex+this.offset_;t[o]||(t[o]=[]),t[o].push(...e)}pushMethodArgs_=(...e)=>(this.push_(e),this);pushFunction(e){this.push_(e)}getContext(){return this.context_}draw(e){this.instructions_.forEach(t=>{for(let o=0,a=t.length;o<a;++o){let s=t[o];if(typeof s=="function"){s(e);continue}let f=t[++o];if(typeof e[s]=="function")e[s](...f);else{if(typeof f=="function"){e[s]=f(e);continue}e[s]=f}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}},P1=sP;var lW=5,aP=class extends dw{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.staleKeys_=new Array,this.maxStaleKeys=lW}getStaleKeys(){return this.staleKeys_}prependStaleKey(e){this.staleKeys_.unshift(e),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(e){return Xt()}getData(e){return null}prepareFrame(e){return Xt()}renderFrame(e,t){return Xt()}forEachFeatureAtCoordinate(e,t,o,a,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){let t=e.target;(t.getState()===ln.LOADED||t.getState()===ln.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=ln.LOADED&&t!=ln.ERROR&&e.addEventListener(Ft.CHANGE,this.boundHandleImageChange_),t==ln.IDLE&&(e.load(),t=e.getState()),t==ln.LOADED}renderIfReadyAndVisible(){let e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}renderDeferred(e){}disposeInternal(){delete this.layer_,super.disposeInternal()}},cj=aP;var cP=[],Wg=null;function cW(){Wg=xi(1,1,void 0,{willReadFrequently:!0})}var lP=class extends cj{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=Io(),this.pixelTransform=Io(),this.inversePixelTransform=Io(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(e,t,o){Wg||cW(),Wg.clearRect(0,0,1,1);let a;try{Wg.drawImage(e,t,o,1,1,0,0,1,1),a=Wg.getImageData(0,0,1,1).data}catch{return Wg=null,null}return a}getBackground(e){let o=this.getLayer().getBackground();return typeof o=="function"&&(o=o(e.viewState.resolution)),o||void 0}useContainer(e,t,o){let a=this.getLayer().getClassName(),s,f;if(e&&e.className===a&&(!o||e&&e.style.backgroundColor&&is(Zl(e.style.backgroundColor),Zl(o)))){let v=e.firstElementChild;$l(v)&&(f=v.getContext("2d"))}if(f&&wz(f.canvas.style.transform,t)?(this.container=e,this.context=f,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=to?Zw():document.createElement("div"),s.className=a;let v=s.style;v.position="absolute",v.width="100%",v.height="100%",f=xi();let w=f.canvas;s.appendChild(w),v=w.style,v.position="absolute",v.left="0",v.transformOrigin="top left",this.container=s,this.context=f}!this.containerReused&&o&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=o)}clipUnrotated(e,t,o){let a=tl(o),s=Eg(o),f=bg(o),v=xg(o);cr(t.coordinateToPixelTransform,a),cr(t.coordinateToPixelTransform,s),cr(t.coordinateToPixelTransform,f),cr(t.coordinateToPixelTransform,v);let w=this.inversePixelTransform;cr(w,a),cr(w,s),cr(w,f),cr(w,v),e.save(),e.beginPath(),e.moveTo(Math.round(a[0]),Math.round(a[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(f[0]),Math.round(f[1])),e.lineTo(Math.round(v[0]),Math.round(v[1])),e.clip()}prepareContainer(e,t){let o=e.extent,a=e.viewState.resolution,s=e.viewState.rotation,f=e.pixelRatio,v=Math.round(In(o)/a*f),w=Math.round(Hi(o)/a*f);$o(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/f,1/f,s,-v/2,-w/2),Ow(this.inversePixelTransform,this.pixelTransform);let D=bz(this.pixelTransform);if(this.useContainer(t,D,this.getBackground(e)),!this.containerReused){let A=this.context.canvas;A.width!=v||A.height!=w?(A.width=v,A.height=w):this.context.clearRect(0,0,v,w),D!==A.style.transform&&(A.style.transform=D)}}dispatchRenderEvent_(e,t,o){let a=this.getLayer();if(a.hasListener(e)){let s=new g1(e,this.inversePixelTransform,o,t);a.dispatchEvent(s)}}preRender(e,t){this.frameState=t,!t.declutter&&this.dispatchRenderEvent_(Ho.PRERENDER,e,t)}postRender(e,t){t.declutter||this.dispatchRenderEvent_(Ho.POSTRENDER,e,t)}renderDeferredInternal(e){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new P1),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){e.declutter&&(this.dispatchRenderEvent_(Ho.PRERENDER,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(Ho.POSTRENDER,this.context,e))}getRenderTransform(e,t,o,a,s,f,v){let w=s/2,D=f/2,A=a/t,z=-A,H=-e[0]+v,q=-e[1];return $o(this.tempTransform,w,D,A,z,-o,H,q)}disposeInternal(){delete this.frameState,super.disposeInternal()}},A1=lP;function uP(n,e,t){if(!(t in n))return n[t]=new Set([e]),!0;let o=n[t],a=o.has(e);return a||o.add(e),!a}function uW(n,e,t){let o=n[t];return o?o.delete(e):!1}function uj(n,e){let t=n.layerStatesArray[n.layerIndex];t.extent&&(e=jc(e,rl(t.extent,n.viewState.projection)));let o=t.layer.getRenderSource();if(!o.getWrapX()){let a=o.getTileGridForProjection(n.viewState.projection).getExtent();a&&(e=jc(e,a))}return e}var hP=class extends A1{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=ar(),this.tempTileRange_=new I1(0,0,0,0),this.tempTileCoord_=Zg(0,0,0);let o=t.cacheSize!==void 0?t.cacheSize:512;this.tileCache_=new oP(o),this.sourceTileCache_=null,this.maxStaleKeys=o*.5}getTileCache(){return this.tileCache_}getSourceTileCache(){return this.sourceTileCache_||(this.sourceTileCache_=new oP(512)),this.sourceTileCache_}getOrCreateTile(e,t,o,a){let s=this.tileCache_,v=this.getLayer().getSource(),w=qg(v,v.getKey(),e,t,o),D;if(s.containsKey(w))D=s.get(w);else{let A=a.viewState.projection,z=v.getProjection();if(D=v.getTile(e,t,o,a.pixelRatio,A,!z||sd(z,A)?void 0:this.getSourceTileCache()),!D)return null;s.set(w,D)}return D}getTile(e,t,o,a){let s=this.getOrCreateTile(e,t,o,a);return s||null}getData(e){let t=this.frameState;if(!t)return null;let o=this.getLayer(),a=cr(t.pixelToCoordinateTransform,e.slice()),s=o.getExtent();if(s&&!Vl(s,a))return null;let f=t.viewState,v=o.getRenderSource(),w=v.getTileGridForProjection(f.projection),D=v.getTilePixelRatio(t.pixelRatio);for(let A=w.getZForResolution(f.resolution);A>=w.getMinZoom();--A){let z=w.getTileCoordForCoordAndZ(a,A),H=this.getTile(A,z[1],z[2],t);if(!H||H.getState()!==jt.LOADED)continue;let q=w.getOrigin(A),W=gr(w.getTileSize(A)),me=w.getResolution(A),ce;if(H instanceof T1||H instanceof D1)ce=H.getImage();else if(H instanceof JM){if(ce=E1(H.getData()),!ce)continue}else continue;let ue=Math.floor(D*((a[0]-q[0])/me-z[1]*W[0])),Me=Math.floor(D*((q[1]-a[1])/me-z[2]*W[1])),Ue=Math.round(D*v.getGutterForProjection(f.projection));return this.getImageData(ce,ue+Ue,Me+Ue)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;let t=this.getLayer().getSource();if(!t)return!1;let o=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==o&&(this.renderedSourceRevision_=o,this.renderedSourceKey_===t.getKey()&&(this.tileCache_.clear(),this.sourceTileCache_?.clear())):this.renderedSourceRevision_=o,!0}enqueueTilesForNextExtent(){return!0}enqueueTiles(e,t,o,a,s){let f=e.viewState,v=this.getLayer(),w=v.getRenderSource(),D=w.getTileGridForProjection(f.projection),A=dn(w);A in e.wantedTiles||(e.wantedTiles[A]={});let z=e.wantedTiles[A],H=v.getMapInternal(),q=Math.max(o-s,D.getMinZoom(),D.getZForResolution(Math.min(v.getMaxResolution(),H?H.getView().getResolutionForZoom(Math.max(v.getMinZoom(),0)):D.getResolution(0)),w.zDirection)),W=f.rotation,me=W?VS(f.center,f.resolution,W,e.size):void 0;for(let ce=o;ce>=q;--ce){let ue=D.getTileRangeForExtentAndZ(t,ce,this.tempTileRange_),Me=D.getResolution(ce);for(let Ue=ue.minX;Ue<=ue.maxX;++Ue)for(let Pe=ue.minY;Pe<=ue.maxY;++Pe){if(W&&!D.tileCoordIntersectsViewport([ce,Ue,Pe],me))continue;let ke=this.getTile(ce,Ue,Pe,e);if(!ke||!uP(a,ke,ce))continue;let ot=ke.getKey();if(z[ot]=!0,ke.getState()===jt.IDLE&&!e.tileQueue.isKeyQueued(ot)){let st=Zg(ce,Ue,Pe,this.tempTileCoord_);e.tileQueue.enqueue([ke,A,D.getTileCoordCenter(st),Me])}}}}findStaleTile_(e,t){let o=this.tileCache_,a=e[0],s=e[1],f=e[2],v=this.getStaleKeys();for(let w=0;w<v.length;++w){let D=qg(this.getLayer().getSource(),v[w],a,s,f);if(o.containsKey(D)){let A=o.peek(D);if(A.getState()===jt.LOADED)return A.endTransition(dn(this)),uP(t,A,a),!0}}return!1}findAltTiles_(e,t,o,a){let s=e.getTileRangeForTileCoordAndZ(t,o,this.tempTileRange_);if(!s)return!1;let f=!0,v=this.tileCache_,w=this.getLayer().getRenderSource(),D=w.getKey();for(let A=s.minX;A<=s.maxX;++A)for(let z=s.minY;z<=s.maxY;++z){let H=qg(w,D,o,A,z),q=!1;if(v.containsKey(H)){let W=v.peek(H);W.getState()===jt.LOADED&&(uP(a,W,o),q=!0)}q||(f=!1)}return f}renderFrame(e,t){this.renderComplete=!0;let o=e.layerStatesArray[e.layerIndex],a=e.viewState,s=a.projection,f=a.resolution,v=a.center,w=e.pixelRatio,D=this.getLayer(),A=D.getSource(),z=A.getTileGridForProjection(s),H=z.getZForResolution(f,A.zDirection),q=z.getResolution(H),W=A.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==W&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=W):this.renderedSourceKey_=W;let me=e.extent,ce=A.getTilePixelRatio(w);this.prepareContainer(e,t);let ue=this.context.canvas.width,Me=this.context.canvas.height,Ue=o.extent&&rl(o.extent,s);Ue&&(me=jc(me,rl(o.extent,s)));let Pe=q*ue/2/ce,ke=q*Me/2/ce,Qe=[v[0]-Pe,v[1]-ke,v[0]+Pe,v[1]+ke],ot={};this.renderedTiles.length=0;let st=D.getPreload();if(e.nextExtent&&this.enqueueTilesForNextExtent()){let rt=z.getZForResolution(a.nextResolution,A.zDirection),Dt=uj(e,e.nextExtent);this.enqueueTiles(e,Dt,rt,ot,st)}let it=uj(e,me);if(this.enqueueTiles(e,it,H,ot,0),st>0&&setTimeout(()=>{this.enqueueTiles(e,it,H-1,ot,st-1)},0),!(H in ot))return this.container;let pt=dn(this),Vt=e.time;for(let rt of ot[H]){let Dt=rt.getState();if(Dt===jt.EMPTY)continue;let $t=rt.tileCoord;if(Dt===jt.LOADED&&rt.getAlpha(pt,Vt)===1){rt.endTransition(pt);continue}if(Dt!==jt.ERROR&&(this.renderComplete=!1),this.findStaleTile_($t,ot)){uW(ot,rt,H),e.animate=!0;continue}if(this.findAltTiles_(z,$t,H+1,ot))continue;let Zt=z.getMinZoom();for(let Rt=H-1;Rt>=Zt&&!this.findAltTiles_(z,$t,Rt,ot);--Rt);}let Pt=q/f*w/ce,At=this.getRenderContext(e);$o(this.tempTransform,ue/2,Me/2,Pt,Pt,0,-ue/2,-Me/2),o.extent&&this.clipUnrotated(At,e,Ue),A.getInterpolate()||(At.imageSmoothingEnabled=!1),this.preRender(At,e);let Gt=Object.keys(ot).map(Number);Gt.sort(Gs);let yt,dt=[],ft=[];for(let rt=Gt.length-1;rt>=0;--rt){let Dt=Gt[rt],$t=A.getTilePixelSize(Dt,w,s),et=z.getResolution(Dt)/q,Zt=$t[0]*et*Pt,Rt=$t[1]*et*Pt,Sn=z.getTileCoordForCoordAndZ(tl(Qe),Dt),kn=z.getTileCoordExtent(Sn),Ei=cr(this.tempTransform,[ce*(kn[0]-Qe[0])/q,ce*(Qe[3]-kn[3])/q]),Zi=ce*A.getGutterForProjection(s);for(let Ti of ot[Dt]){if(Ti.getState()!==jt.LOADED)continue;let ti=Ti.tileCoord,ss=Sn[1]-ti[1],zi=Math.round(Ei[0]-(ss-1)*Zt),ir=Sn[2]-ti[2],Qi=Math.round(Ei[1]-(ir-1)*Rt),bn=Math.round(Ei[0]-ss*Zt),Di=Math.round(Ei[1]-ir*Rt),Do=zi-bn,ro=Qi-Di,ur=Gt.length===1,hr=!1;yt=[bn,Di,bn+Do,Di,bn+Do,Di+ro,bn,Di+ro];for(let $r=0,Mo=dt.length;$r<Mo;++$r)if(!ur&&Dt<ft[$r]){let $n=dt[$r];lr([bn,Di,bn+Do,Di+ro],[$n[0],$n[3],$n[4],$n[7]])&&(hr||(At.save(),hr=!0),At.beginPath(),At.moveTo(yt[0],yt[1]),At.lineTo(yt[2],yt[3]),At.lineTo(yt[4],yt[5]),At.lineTo(yt[6],yt[7]),At.moveTo($n[6],$n[7]),At.lineTo($n[4],$n[5]),At.lineTo($n[2],$n[3]),At.lineTo($n[0],$n[1]),At.clip())}dt.push(yt),ft.push(Dt),this.drawTile(Ti,e,bn,Di,Do,ro,Zi,ur),hr&&At.restore(),this.renderedTiles.unshift(Ti),this.updateUsedTiles(e.usedTiles,A,Ti)}}if(this.renderedResolution=q,this.extentChanged=!this.renderedExtent_||!Xu(this.renderedExtent_,Qe),this.renderedExtent_=Qe,this.renderedPixelRatio=w,this.postRender(this.context,e),o.extent&&At.restore(),At.imageSmoothingEnabled=!0,this.renderComplete){let rt=(Dt,$t)=>{let Qt=dn(A),et=$t.wantedTiles[Qt],Zt=et?Object.keys(et).length:0;this.updateCacheSize(Zt),this.tileCache_.expireCache(),this.sourceTileCache_?.expireCache()};e.postRenderFunctions.push(rt)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,e*2)}drawTile(e,t,o,a,s,f,v,w){let D;if(e instanceof JM){if(D=E1(e.getData()),!D)throw new Error("Rendering array data is not yet supported")}else D=this.getTileImage(e);if(!D)return;let A=this.getRenderContext(t),z=dn(this),H=t.layerStatesArray[t.layerIndex],q=H.opacity*(w?e.getAlpha(z,t.time):1),W=q!==A.globalAlpha;W&&(A.save(),A.globalAlpha=q),A.drawImage(D,v,v,D.width-2*v,D.height-2*v,o,a,s,f),W&&A.restore(),q!==H.opacity?t.animate=!0:w&&e.endTransition(z)}getImage(){let e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,o){let a=dn(t);a in e||(e[a]={}),e[a][o.getKey()]=!0}},hj=hP;var Kv={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};var dP=class extends np{constructor(e){e=e||{};let t=Object.assign({},e),o=e.cacheSize;delete e.cacheSize,delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=o,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(Kv.PRELOAD)}setPreload(e){this.set(Kv.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(Kv.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(Kv.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}},dj=dP;var fP=class extends dj{constructor(e){super(e)}createRenderer(){return new hj(this,{cacheSize:this.getCacheSize()})}},pP=fP;var mP=class{drawCustom(e,t,o,a,s){}drawGeometry(e){}setStyle(e){}drawCircle(e,t,o){}drawFeature(e,t,o){}drawGeometryCollection(e,t,o){}drawLineString(e,t,o){}drawMultiLineString(e,t,o){}drawMultiPoint(e,t,o){}drawMultiPolygon(e,t,o){}drawPoint(e,t,o){}drawPolygon(e,t,o){}drawText(e,t,o){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}},R1=mP;var Jv={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Qv=[Jv.FILL],qc=[Jv.STROKE],sh=[Jv.BEGIN_PATH],gP=[Jv.CLOSE_PATH],Kt=Jv;var _P=class extends R1{constructor(e,t,o,a){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=a,this.maxLineWidth=0,this.resolution=o,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){let t=this.pixelRatio;return t==1?e:e.map(function(o){return o*t})}appendFlatPointCoordinates(e,t){let o=this.getBufferedMaxExtent(),a=this.tmpCoordinate_,s=this.coordinates,f=s.length;for(let v=0,w=e.length;v<w;v+=t)a[0]=e[v],a[1]=e[v+1],Vl(o,a)&&(s[f++]=a[0],s[f++]=a[1]);return f}appendFlatLineCoordinates(e,t,o,a,s,f){let v=this.coordinates,w=v.length,D=this.getBufferedMaxExtent();f&&(t+=a);let A=e[t],z=e[t+1],H=this.tmpCoordinate_,q=!0,W,me,ce;for(W=t+a;W<o;W+=a)H[0]=e[W],H[1]=e[W+1],ce=_w(D,H),ce!==me?(q&&(v[w++]=A,v[w++]=z,q=!1),v[w++]=H[0],v[w++]=H[1]):ce===Gr.INTERSECTING?(v[w++]=H[0],v[w++]=H[1],q=!1):q=!0,A=H[0],z=H[1],me=ce;return(s&&q||W===t+a)&&(v[w++]=A,v[w++]=z),w}drawCustomCoordinates_(e,t,o,a,s){for(let f=0,v=o.length;f<v;++f){let w=o[f],D=this.appendFlatLineCoordinates(e,t,w,a,!1,!1);s.push(D),t=w}return t}drawCustom(e,t,o,a,s){this.beginGeometry(e,t,s);let f=e.getType(),v=e.getStride(),w=this.coordinates.length,D,A,z,H,q;switch(f){case"MultiPolygon":D=e.getOrientedFlatCoordinates(),H=[];let W=e.getEndss();q=0;for(let me=0,ce=W.length;me<ce;++me){let ue=[];q=this.drawCustomCoordinates_(D,q,W[me],v,ue),H.push(ue)}this.instructions.push([Kt.CUSTOM,w,H,e,o,bv,s]),this.hitDetectionInstructions.push([Kt.CUSTOM,w,H,e,a||o,bv,s]);break;case"Polygon":case"MultiLineString":z=[],D=f=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),q=this.drawCustomCoordinates_(D,0,e.getEnds(),v,z),this.instructions.push([Kt.CUSTOM,w,z,e,o,ud,s]),this.hitDetectionInstructions.push([Kt.CUSTOM,w,z,e,a||o,ud,s]);break;case"LineString":case"Circle":D=e.getFlatCoordinates(),A=this.appendFlatLineCoordinates(D,0,D.length,v,!1,!1),this.instructions.push([Kt.CUSTOM,w,A,e,o,ol,s]),this.hitDetectionInstructions.push([Kt.CUSTOM,w,A,e,a||o,ol,s]);break;case"MultiPoint":D=e.getFlatCoordinates(),A=this.appendFlatPointCoordinates(D,v),A>w&&(this.instructions.push([Kt.CUSTOM,w,A,e,o,ol,s]),this.hitDetectionInstructions.push([Kt.CUSTOM,w,A,e,a||o,ol,s]));break;case"Point":D=e.getFlatCoordinates(),this.coordinates.push(D[0],D[1]),A=this.coordinates.length,this.instructions.push([Kt.CUSTOM,w,A,e,o,void 0,s]),this.hitDetectionInstructions.push([Kt.CUSTOM,w,A,e,a||o,void 0,s]);break;default:}this.endGeometry(t)}beginGeometry(e,t,o){this.beginGeometryInstruction1_=[Kt.BEGIN_GEOMETRY,t,0,e,o],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Kt.BEGIN_GEOMETRY,t,0,e,o],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){let e=this.hitDetectionInstructions;e.reverse();let t,o=e.length,a,s,f=-1;for(t=0;t<o;++t)a=e[t],s=a[0],s==Kt.END_GEOMETRY?f=t:s==Kt.BEGIN_GEOMETRY&&(a[2]=t,RN(this.hitDetectionInstructions,f,t),f=-1)}fillStyleToState(e,t={}){if(e){let o=e.getColor();t.fillPatternScale=o&&typeof o=="object"&&"src"in o?this.pixelRatio:1,t.fillStyle=Ws(o||io)}else t.fillStyle=void 0;return t}strokeStyleToState(e,t={}){if(e){let o=e.getColor();t.strokeStyle=Ws(o||th);let a=e.getLineCap();t.lineCap=a!==void 0?a:$c;let s=e.getLineDash();t.lineDash=s?s.slice():Xs;let f=e.getLineDashOffset();t.lineDashOffset=f||Ys;let v=e.getLineJoin();t.lineJoin=v!==void 0?v:Hc;let w=e.getWidth();t.lineWidth=w!==void 0?w:ih;let D=e.getMiterLimit();t.miterLimit=D!==void 0?D:eh,t.lineWidth>this.maxLineWidth&&(this.maxLineWidth=t.lineWidth,this.bufferedMaxExtent_=null)}else t.strokeStyle=void 0,t.lineCap=void 0,t.lineDash=null,t.lineDashOffset=void 0,t.lineJoin=void 0,t.lineWidth=void 0,t.miterLimit=void 0;return t}setFillStrokeStyle(e,t){let o=this.state;this.fillStyleToState(e,o),this.strokeStyleToState(t,o)}createFill(e){let t=e.fillStyle,o=[Kt.SET_FILL_STYLE,t];return typeof t!="string"&&o.push(e.fillPatternScale),o}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[Kt.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,e.lineDash?this.applyPixelRatio(e.lineDash):null,e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){let o=e.fillStyle;(typeof o!="string"||e.currentFillStyle!=o)&&(this.instructions.push(t.call(this,e)),e.currentFillStyle=o)}updateStrokeStyle(e,t){let o=e.strokeStyle,a=e.lineCap,s=e.lineDash,f=e.lineDashOffset,v=e.lineJoin,w=e.lineWidth,D=e.miterLimit;(e.currentStrokeStyle!=o||e.currentLineCap!=a||s!=e.currentLineDash&&!is(e.currentLineDash,s)||e.currentLineDashOffset!=f||e.currentLineJoin!=v||e.currentLineWidth!=w||e.currentMiterLimit!=D)&&(t.call(this,e),e.currentStrokeStyle=o,e.currentLineCap=a,e.currentLineDash=s,e.currentLineDashOffset=f,e.currentLineJoin=v,e.currentLineWidth=w,e.currentMiterLimit=D)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;let t=[Kt.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=yw(this.maxExtent),this.maxLineWidth>0)){let e=this.resolution*(this.maxLineWidth+1)/2;qu(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}},Wc=_P;var yP=class extends Wc{constructor(e,t,o,a){super(e,t,o,a),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t,o){if(!this.image_||this.maxExtent&&!Vl(this.maxExtent,e.getFlatCoordinates()))return;this.beginGeometry(e,t,o);let a=e.getFlatCoordinates(),s=e.getStride(),f=this.coordinates.length,v=this.appendFlatPointCoordinates(a,s);this.instructions.push([Kt.DRAW_IMAGE,f,v,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Kt.DRAW_IMAGE,f,v,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t,o){if(!this.image_)return;this.beginGeometry(e,t,o);let a=e.getFlatCoordinates(),s=[];for(let w=0,D=a.length;w<D;w+=e.getStride())(!this.maxExtent||Vl(this.maxExtent,a.slice(w,w+2)))&&s.push(a[w],a[w+1]);let f=this.coordinates.length,v=this.appendFlatPointCoordinates(s,2);this.instructions.push([Kt.DRAW_IMAGE,f,v,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Kt.DRAW_IMAGE,f,v,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){let o=e.getAnchor(),a=e.getSize(),s=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=o[0],this.anchorY_=o[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=a[1],this.opacity_=e.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=a[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}},fj=yP;var vP=class extends Wc{constructor(e,t,o,a){super(e,t,o,a)}drawFlatCoordinates_(e,t,o,a){let s=this.coordinates.length,f=this.appendFlatLineCoordinates(e,t,o,a,!1,!1),v=[Kt.MOVE_TO_LINE_TO,s,f];return this.instructions.push(v),this.hitDetectionInstructions.push(v),o}drawLineString(e,t,o){let a=this.state,s=a.strokeStyle,f=a.lineWidth;if(s===void 0||f===void 0)return;this.updateStrokeStyle(a,this.applyStroke),this.beginGeometry(e,t,o),this.hitDetectionInstructions.push([Kt.SET_STROKE_STYLE,a.strokeStyle,a.lineWidth,a.lineCap,a.lineJoin,a.miterLimit,Xs,Ys],sh);let v=e.getFlatCoordinates(),w=e.getStride();this.drawFlatCoordinates_(v,0,v.length,w),this.hitDetectionInstructions.push(qc),this.endGeometry(t)}drawMultiLineString(e,t,o){let a=this.state,s=a.strokeStyle,f=a.lineWidth;if(s===void 0||f===void 0)return;this.updateStrokeStyle(a,this.applyStroke),this.beginGeometry(e,t,o),this.hitDetectionInstructions.push([Kt.SET_STROKE_STYLE,a.strokeStyle,a.lineWidth,a.lineCap,a.lineJoin,a.miterLimit,Xs,Ys],sh);let v=e.getEnds(),w=e.getFlatCoordinates(),D=e.getStride(),A=0;for(let z=0,H=v.length;z<H;++z)A=this.drawFlatCoordinates_(w,A,v[z],D);this.hitDetectionInstructions.push(qc),this.endGeometry(t)}finish(){let e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(qc),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(qc),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(sh)}},pj=vP;var xP=class extends Wc{constructor(e,t,o,a){super(e,t,o,a)}drawFlatCoordinatess_(e,t,o,a){let s=this.state,f=s.fillStyle!==void 0,v=s.strokeStyle!==void 0,w=o.length;this.instructions.push(sh),this.hitDetectionInstructions.push(sh);for(let D=0;D<w;++D){let A=o[D],z=this.coordinates.length,H=this.appendFlatLineCoordinates(e,t,A,a,!0,!v),q=[Kt.MOVE_TO_LINE_TO,z,H];this.instructions.push(q),this.hitDetectionInstructions.push(q),v&&(this.instructions.push(gP),this.hitDetectionInstructions.push(gP)),t=A}return f&&(this.instructions.push(Qv),this.hitDetectionInstructions.push(Qv)),v&&(this.instructions.push(qc),this.hitDetectionInstructions.push(qc)),t}drawCircle(e,t,o){let a=this.state,s=a.fillStyle,f=a.strokeStyle;if(s===void 0&&f===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,o),a.fillStyle!==void 0&&this.hitDetectionInstructions.push([Kt.SET_FILL_STYLE,io]),a.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Kt.SET_STROKE_STYLE,a.strokeStyle,a.lineWidth,a.lineCap,a.lineJoin,a.miterLimit,Xs,Ys]);let v=e.getFlatCoordinates(),w=e.getStride(),D=this.coordinates.length;this.appendFlatLineCoordinates(v,0,v.length,w,!1,!1);let A=[Kt.CIRCLE,D];this.instructions.push(sh,A),this.hitDetectionInstructions.push(sh,A),a.fillStyle!==void 0&&(this.instructions.push(Qv),this.hitDetectionInstructions.push(Qv)),a.strokeStyle!==void 0&&(this.instructions.push(qc),this.hitDetectionInstructions.push(qc)),this.endGeometry(t)}drawPolygon(e,t,o){let a=this.state,s=a.fillStyle,f=a.strokeStyle;if(s===void 0&&f===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,o),a.fillStyle!==void 0&&this.hitDetectionInstructions.push([Kt.SET_FILL_STYLE,io]),a.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Kt.SET_STROKE_STYLE,a.strokeStyle,a.lineWidth,a.lineCap,a.lineJoin,a.miterLimit,Xs,Ys]);let v=e.getEnds(),w=e.getOrientedFlatCoordinates(),D=e.getStride();this.drawFlatCoordinatess_(w,0,v,D),this.endGeometry(t)}drawMultiPolygon(e,t,o){let a=this.state,s=a.fillStyle,f=a.strokeStyle;if(s===void 0&&f===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,o),a.fillStyle!==void 0&&this.hitDetectionInstructions.push([Kt.SET_FILL_STYLE,io]),a.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Kt.SET_STROKE_STYLE,a.strokeStyle,a.lineWidth,a.lineCap,a.lineJoin,a.miterLimit,Xs,Ys]);let v=e.getEndss(),w=e.getOrientedFlatCoordinates(),D=e.getStride(),A=0;for(let z=0,H=v.length;z<H;++z)A=this.drawFlatCoordinatess_(w,A,v[z],D);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;let e=this.tolerance;if(e!==0){let t=this.coordinates;for(let o=0,a=t.length;o<a;++o)t[o]=hd(t[o],e)}return super.finish()}setFillStrokeStyles_(){let e=this.state;this.updateFillStyle(e,this.createFill),this.updateStrokeStyle(e,this.applyStroke)}},bP=xP;function mj(n,e,t,o,a){let s=[],f=t,v=0,w=e.slice(t,2);for(;v<n&&f+a<o;){let[D,A]=w.slice(-2),z=e[f+a],H=e[f+a+1],q=Math.sqrt((z-D)*(z-D)+(H-A)*(H-A));if(v+=q,v>=n){let W=(n-v+q)/q,me=Go(D,z,W),ce=Go(A,H,W);w.push(me,ce),s.push(w),w=[me,ce],v==n&&(f+=a),v=0}else if(v<n)w.push(e[f+a],e[f+a+1]),f+=a;else{let W=q-v,me=Go(D,z,W/q),ce=Go(A,H,W/q);w.push(me,ce),s.push(w),w=[me,ce],v=0,f+=a}}return v>0&&s.push(w),s}function gj(n,e,t,o,a){let s=t,f=t,v=0,w=0,D=t,A,z,H,q,W,me,ce,ue,Me,Ue;for(z=t;z<o;z+=a){let Pe=e[z],ke=e[z+1];W!==void 0&&(Me=Pe-W,Ue=ke-me,q=Math.sqrt(Me*Me+Ue*Ue),ce!==void 0&&(w+=H,A=Math.acos((ce*Me+ue*Ue)/(H*q)),A>n&&(w>v&&(v=w,s=D,f=z),w=0,D=z-a)),H=q,ce=Me,ue=Ue),W=Pe,me=ke}return w+=q,w>v?[D,z]:[s,f]}var e0={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},wP=class extends Wc{constructor(e,t,o,a){super(e,t,o,a),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[io]={fillStyle:io},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){let e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t,o){let a=this.textFillState_,s=this.textStrokeState_,f=this.textState_;if(this.text_===""||!f||!a&&!s)return;let v=this.coordinates,w=v.length,D=e.getType(),A=null,z=e.getStride();if(f.placement==="line"&&(D=="LineString"||D=="MultiLineString"||D=="Polygon"||D=="MultiPolygon")){if(!lr(this.maxExtent,e.getExtent()))return;let H;if(A=e.getFlatCoordinates(),D=="LineString")H=[A.length];else if(D=="MultiLineString")H=e.getEnds();else if(D=="Polygon")H=e.getEnds().slice(0,1);else if(D=="MultiPolygon"){let ce=e.getEndss();H=[];for(let ue=0,Me=ce.length;ue<Me;++ue)H.push(ce[ue][0])}this.beginGeometry(e,t,o);let q=f.repeat,W=q?void 0:f.textAlign,me=0;for(let ce=0,ue=H.length;ce<ue;++ce){let Me;q?Me=mj(q*this.resolution,A,me,H[ce],z):Me=[A.slice(me,H[ce])];for(let Ue=0,Pe=Me.length;Ue<Pe;++Ue){let ke=Me[Ue],Qe=0,ot=ke.length;if(W==null){let it=gj(f.maxAngle,ke,0,ke.length,2);Qe=it[0],ot=it[1]}for(let it=Qe;it<ot;it+=z)v.push(ke[it],ke[it+1]);let st=v.length;me=H[ce],this.drawChars_(w,st),w=st}}this.endGeometry(t)}else{let H=f.overflow?null:[];switch(D){case"Point":case"MultiPoint":A=e.getFlatCoordinates();break;case"LineString":A=e.getFlatMidpoint();break;case"Circle":A=e.getCenter();break;case"MultiLineString":A=e.getFlatMidpoints(),z=2;break;case"Polygon":A=e.getFlatInteriorPoint(),f.overflow||H.push(A[2]/this.resolution),z=3;break;case"MultiPolygon":let Pe=e.getFlatInteriorPoints();A=[];for(let ke=0,Qe=Pe.length;ke<Qe;ke+=3)f.overflow||H.push(Pe[ke+2]/this.resolution),A.push(Pe[ke],Pe[ke+1]);if(A.length===0)return;z=2;break;default:}let q=this.appendFlatPointCoordinates(A,z);if(q===w)return;if(H&&(q-w)/2!==A.length/z){let Pe=w/2;H=H.filter((ke,Qe)=>{let ot=v[(Pe+Qe)*2]===A[Qe*z]&&v[(Pe+Qe)*2+1]===A[Qe*z+1];return ot||--Pe,ot})}this.saveTextStates_();let W=f.backgroundFill?this.createFill(this.fillStyleToState(f.backgroundFill)):null,me=f.backgroundStroke?this.createStroke(this.strokeStyleToState(f.backgroundStroke)):null;this.beginGeometry(e,t,o);let ce=f.padding;if(ce!=nh&&(f.scale[0]<0||f.scale[1]<0)){let Pe=f.padding[0],ke=f.padding[1],Qe=f.padding[2],ot=f.padding[3];f.scale[0]<0&&(ke=-ke,ot=-ot),f.scale[1]<0&&(Pe=-Pe,Qe=-Qe),ce=[Pe,ke,Qe,ot]}let ue=this.pixelRatio;this.instructions.push([Kt.DRAW_IMAGE,w,q,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,ce==nh?nh:ce.map(function(Pe){return Pe*ue}),W,me,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,H]);let Me=1/ue,Ue=W?W.slice(0):null;Ue&&(Ue[1]=io),this.hitDetectionInstructions.push([Kt.DRAW_IMAGE,w,q,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[Me,Me],NaN,this.declutterMode_,this.declutterImageWithText_,ce,Ue,me,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?io:this.fillKey_,this.textOffsetX_,this.textOffsetY_,H]),this.endGeometry(t)}}saveTextStates_(){let e=this.textStrokeState_,t=this.textState_,o=this.textFillState_,a=this.strokeKey_;e&&(a in this.strokeStates||(this.strokeStates[a]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));let s=this.textKey_;s in this.textStates||(this.textStates[s]={font:t.font,textAlign:t.textAlign||xd,justify:t.justify,textBaseline:t.textBaseline||sp,scale:t.scale});let f=this.fillKey_;o&&(f in this.fillStates||(this.fillStates[f]={fillStyle:o.fillStyle}))}drawChars_(e,t){let o=this.textStrokeState_,a=this.textState_,s=this.strokeKey_,f=this.textKey_,v=this.fillKey_;this.saveTextStates_();let w=this.pixelRatio,D=e0[a.textBaseline],A=this.textOffsetY_*w,z=this.text_,H=o?o.lineWidth*Math.abs(a.scale[0])/2:0;this.instructions.push([Kt.DRAW_CHARS,e,t,D,a.overflow,v,a.maxAngle,w,A,s,H*w,z,f,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([Kt.DRAW_CHARS,e,t,D,a.overflow,v&&io,a.maxAngle,w,A,s,H*w,z,f,1/w,this.declutterMode_,this.textKeepUpright_])}setTextStyle(e,t){let o,a,s;if(!e)this.text_="";else{let f=e.getFill();f?(a=this.textFillState_,a||(a={},this.textFillState_=a),a.fillStyle=Ws(f.getColor()||io)):(a=null,this.textFillState_=a);let v=e.getStroke();if(!v)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);let me=v.getLineDash(),ce=v.getLineDashOffset(),ue=v.getWidth(),Me=v.getMiterLimit();s.lineCap=v.getLineCap()||$c,s.lineDash=me?me.slice():Xs,s.lineDashOffset=ce===void 0?Ys:ce,s.lineJoin=v.getLineJoin()||Hc,s.lineWidth=ue===void 0?ih:ue,s.miterLimit=Me===void 0?eh:Me,s.strokeStyle=Ws(v.getColor()||th)}o=this.textState_;let w=e.getFont()||s1;PB(w);let D=e.getScaleArray();o.overflow=e.getOverflow(),o.font=w,o.maxAngle=e.getMaxAngle(),o.placement=e.getPlacement(),o.textAlign=e.getTextAlign(),o.repeat=e.getRepeat(),o.justify=e.getJustify(),o.textBaseline=e.getTextBaseline()||sp,o.backgroundFill=e.getBackgroundFill(),o.backgroundStroke=e.getBackgroundStroke(),o.padding=e.getPadding()||nh,o.scale=D===void 0?[1,1]:D;let A=e.getOffsetX(),z=e.getOffsetY(),H=e.getRotateWithView(),q=e.getKeepUpright(),W=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=A===void 0?0:A,this.textOffsetY_=z===void 0?0:z,this.textRotateWithView_=H===void 0?!1:H,this.textKeepUpright_=q===void 0?!0:q,this.textRotation_=W===void 0?0:W,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:dn(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=o.font+o.scale+(o.textAlign||"?")+(o.repeat||"?")+(o.justify||"?")+(o.textBaseline||"?"),this.fillKey_=a&&a.fillStyle?typeof a.fillStyle=="string"?a.fillStyle:"|"+dn(a.fillStyle):""}this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}},_j=wP;var hW={Circle:bP,Default:Wc,Image:fj,LineString:pj,Polygon:bP,Text:_j},EP=class{constructor(e,t,o,a){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=a,this.resolution_=o,this.buildersByZIndex_={}}finish(){let e={};for(let t in this.buildersByZIndex_){e[t]=e[t]||{};let o=this.buildersByZIndex_[t];for(let a in o){let s=o[a].finish();e[t][a]=s}}return e}getBuilder(e,t){let o=e!==void 0?e.toString():"0",a=this.buildersByZIndex_[o];a===void 0&&(a={},this.buildersByZIndex_[o]=a);let s=a[t];if(s===void 0){let f=hW[t];s=new f(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),a[t]=s}return s}},yj=EP;function vj(n,e,t,o,a,s,f,v,w,D,A,z,H=!0){let q=n[e],W=n[e+1],me=0,ce=0,ue=0,Me=0;function Ue(){me=q,ce=W,e+=o,q=n[e],W=n[e+1],Me+=ue,ue=Math.sqrt((q-me)*(q-me)+(W-ce)*(W-ce))}do Ue();while(e<t-o&&Me+ue<s);let Pe=ue===0?0:(s-Me)/ue,ke=Go(me,q,Pe),Qe=Go(ce,W,Pe),ot=e-o,st=Me,it=s+v*w(D,a,A);for(;e<t-o&&Me+ue<it;)Ue();Pe=ue===0?0:(it-Me)/ue;let pt=Go(me,q,Pe),Vt=Go(ce,W,Pe),Pt=!1;if(H)if(z){let ft=[ke,Qe,pt,Vt];kw(ft,0,4,2,z,ft,ft),Pt=ft[0]>ft[2]}else Pt=ke>pt;let At=Math.PI,Gt=[],yt=ot+o===e;e=ot,ue=0,Me=st,q=n[e],W=n[e+1];let dt;if(yt){Ue(),dt=Math.atan2(W-ce,q-me),Pt&&(dt+=dt>0?-At:At);let ft=(pt+ke)/2,rt=(Vt+Qe)/2;return Gt[0]=[ft,rt,(it-s)/2,dt,a],Gt}a=a.replace(/\n/g," ");for(let ft=0,rt=a.length;ft<rt;){Ue();let Dt=Math.atan2(W-ce,q-me);if(Pt&&(Dt+=Dt>0?-At:At),dt!==void 0){let Sn=Dt-dt;if(Sn+=Sn>At?-2*At:Sn<-At?2*At:0,Math.abs(Sn)>f)return null}dt=Dt;let $t=ft,Qt=0;for(;ft<rt;++ft){let Sn=Pt?rt-ft-1:ft,kn=v*w(D,a[Sn],A);if(e+o<t&&Me+ue<s+Qt+kn/2)break;Qt+=kn}if(ft===$t)continue;let et=Pt?a.substring(rt-$t,rt-ft):a.substring($t,ft);Pe=ue===0?0:(s+Qt/2-Me)/ue;let Zt=Go(me,q,Pe),Rt=Go(ce,W,Pe);Gt.push([Zt,Rt,Qt/2,Dt,et]),s+=Qt}return Gt}var Xg=ar(),bd=[],ah=[],lh=[],wd=[];function xj(n){return n[3].declutterBox}var bj=new RegExp("[\u0591-\u08FF\uFB1D-\uFDFF\uFE70-\uFEFC\u0800-\u0FFF\uE800-\uEFFF]");function TP(n,e){return e==="start"?e=bj.test(n)?"right":"left":e==="end"&&(e=bj.test(n)?"left":"right"),e0[e]}function dW(n,e,t){return t>0&&n.push(`
`,""),n.push(e,""),n}function fW(n,e,t){return t%2===0&&(n+=e),n}var CP=class{constructor(e,t,o,a,s){this.overlaps=o,this.pixelRatio=t,this.resolution=e,this.alignAndScaleFill_,this.instructions=a.instructions,this.coordinates=a.coordinates,this.coordinateCache_={},this.renderedTransform_=Io(),this.hitDetectionInstructions=a.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=a.fillStates||{},this.strokeStates=a.strokeStates||{},this.textStates=a.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=s?new P1:null}getZIndexContext(){return this.zIndexContext_}createLabel(e,t,o,a){let s=e+t+o+a;if(this.labels_[s])return this.labels_[s];let f=a?this.strokeStates[a]:null,v=o?this.fillStates[o]:null,w=this.textStates[t],D=this.pixelRatio,A=[w.scale[0]*D,w.scale[1]*D],z=w.justify?e0[w.justify]:TP(Array.isArray(e)?e[0]:e,w.textAlign||xd),H=a&&f.lineWidth?f.lineWidth:0,q=Array.isArray(e)?e:String(e).split(`
`).reduce(dW,[]),{width:W,height:me,widths:ce,heights:ue,lineWidths:Me}=LB(w,q),Ue=W+H,Pe=[],ke=(Ue+2)*A[0],Qe=(me+H)*A[1],ot={width:ke<0?Math.floor(ke):Math.ceil(ke),height:Qe<0?Math.floor(Qe):Math.ceil(Qe),contextInstructions:Pe};(A[0]!=1||A[1]!=1)&&Pe.push("scale",A),a&&(Pe.push("strokeStyle",f.strokeStyle),Pe.push("lineWidth",H),Pe.push("lineCap",f.lineCap),Pe.push("lineJoin",f.lineJoin),Pe.push("miterLimit",f.miterLimit),Pe.push("setLineDash",[f.lineDash]),Pe.push("lineDashOffset",f.lineDashOffset)),o&&Pe.push("fillStyle",v.fillStyle),Pe.push("textBaseline","middle"),Pe.push("textAlign","center");let st=.5-z,it=z*Ue+st*H,pt=[],Vt=[],Pt=0,At=0,Gt=0,yt=0,dt;for(let ft=0,rt=q.length;ft<rt;ft+=2){let Dt=q[ft];if(Dt===`
`){At+=Pt,Pt=0,it=z*Ue+st*H,++yt;continue}let $t=q[ft+1]||w.font;$t!==dt&&(a&&pt.push("font",$t),o&&Vt.push("font",$t),dt=$t),Pt=Math.max(Pt,ue[Gt]);let Qt=[Dt,it+st*ce[Gt]+z*(ce[Gt]-Me[yt]),.5*(H+Pt)+At];it+=ce[Gt],a&&pt.push("strokeText",Qt),o&&Vt.push("fillText",Qt),++Gt}return Array.prototype.push.apply(Pe,pt),Array.prototype.push.apply(Pe,Vt),this.labels_[s]=ot,ot}replayTextBackground_(e,t,o,a,s,f,v){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,o),e.lineTo.apply(e,a),e.lineTo.apply(e,s),e.lineTo.apply(e,t),f&&(this.alignAndScaleFill_=f[2],e.fillStyle=f[1],this.fill_(e)),v&&(this.setStrokeStyle_(e,v),e.stroke())}calculateImageOrLabelDimensions_(e,t,o,a,s,f,v,w,D,A,z,H,q,W,me,ce){v*=H[0],w*=H[1];let ue=o-v,Me=a-w,Ue=s+D>e?e-D:s,Pe=f+A>t?t-A:f,ke=W[3]+Ue*H[0]+W[1],Qe=W[0]+Pe*H[1]+W[2],ot=ue-W[3],st=Me-W[0];(me||z!==0)&&(bd[0]=ot,wd[0]=ot,bd[1]=st,ah[1]=st,ah[0]=ot+ke,lh[0]=ah[0],lh[1]=st+Qe,wd[1]=lh[1]);let it;return z!==0?(it=$o(Io(),o,a,1,1,z,-o,-a),cr(it,bd),cr(it,ah),cr(it,lh),cr(it,wd),Ma(Math.min(bd[0],ah[0],lh[0],wd[0]),Math.min(bd[1],ah[1],lh[1],wd[1]),Math.max(bd[0],ah[0],lh[0],wd[0]),Math.max(bd[1],ah[1],lh[1],wd[1]),Xg)):Ma(Math.min(ot,ot+ke),Math.min(st,st+Qe),Math.max(ot,ot+ke),Math.max(st,st+Qe),Xg),q&&(ue=Math.round(ue),Me=Math.round(Me)),{drawImageX:ue,drawImageY:Me,drawImageW:Ue,drawImageH:Pe,originX:D,originY:A,declutterBox:{minX:Xg[0],minY:Xg[1],maxX:Xg[2],maxY:Xg[3],value:ce},canvasTransform:it,scale:H}}replayImageOrLabel_(e,t,o,a,s,f,v){let w=!!(f||v),D=a.declutterBox,A=v?v[2]*a.scale[0]/2:0;return D.minX-A<=t[0]&&D.maxX+A>=0&&D.minY-A<=t[1]&&D.maxY+A>=0&&(w&&this.replayTextBackground_(e,bd,ah,lh,wd,f,v),OB(e,a.canvasTransform,s,o,a.originX,a.originY,a.drawImageW,a.drawImageH,a.drawImageX,a.drawImageY,a.scale)),!0}fill_(e){let t=this.alignAndScaleFill_;if(t){let o=cr(this.renderedTransform_,[0,0]),a=512*this.pixelRatio;e.save(),e.translate(o[0]%a,o[1]%a),t!==1&&e.scale(t,t),e.rotate(this.viewRotation_)}e.fill(),t&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],t[1]&&(e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6]))}drawLabelWithPointPlacement_(e,t,o,a){let s=this.textStates[t],f=this.createLabel(e,t,a,o),v=this.strokeStates[o],w=this.pixelRatio,D=TP(Array.isArray(e)?e[0]:e,s.textAlign||xd),A=e0[s.textBaseline||sp],z=v&&v.lineWidth?v.lineWidth:0,H=f.width/w-2*s.scale[0],q=D*H+2*(.5-D)*z,W=A*f.height/w+2*(.5-A)*z;return{label:f,anchorX:q,anchorY:W}}execute_(e,t,o,a,s,f,v,w){let D=this.zIndexContext_,A;this.pixelCoordinates_&&is(o,this.renderedTransform_)?A=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),A=Zs(this.coordinates,0,this.coordinates.length,2,o,this.pixelCoordinates_),xz(this.renderedTransform_,o));let z=0,H=a.length,q=0,W,me,ce,ue,Me,Ue,Pe,ke,Qe,ot,st,it,pt,Vt=0,Pt=0,At=this.coordinateCache_,Gt=this.viewRotation_,yt=Math.round(Math.atan2(-o[1],o[0])*1e12)/1e12,dt={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:Gt},ft=this.instructions!=a||this.overlaps?0:200,rt,Dt,$t,Qt;for(;z<H;){let et=a[z];switch(et[0]){case Kt.BEGIN_GEOMETRY:rt=et[1],Qt=et[3],rt.getGeometry()?v!==void 0&&!lr(v,Qt.getExtent())?z=et[2]+1:++z:z=et[2],D&&(D.zIndex=et[4]);break;case Kt.BEGIN_PATH:Vt>ft&&(this.fill_(e),Vt=0),Pt>ft&&(e.stroke(),Pt=0),!Vt&&!Pt&&(e.beginPath(),Me=NaN,Ue=NaN),++z;break;case Kt.CIRCLE:q=et[1];let Rt=A[q],Sn=A[q+1],kn=A[q+2],Ei=A[q+3],Zi=kn-Rt,Ti=Ei-Sn,ti=Math.sqrt(Zi*Zi+Ti*Ti);e.moveTo(Rt+ti,Sn),e.arc(Rt,Sn,ti,0,2*Math.PI,!0),++z;break;case Kt.CLOSE_PATH:e.closePath(),++z;break;case Kt.CUSTOM:q=et[1],W=et[2];let ss=et[3],zi=et[4],ir=et[5];dt.geometry=ss,dt.feature=rt,z in At||(At[z]=[]);let Qi=At[z];ir?ir(A,q,W,2,Qi):(Qi[0]=A[q],Qi[1]=A[q+1],Qi.length=2),D&&(D.zIndex=et[6]),zi(Qi,dt),++z;break;case Kt.DRAW_IMAGE:q=et[1],W=et[2],Qe=et[3],me=et[4],ce=et[5];let bn=et[6],Di=et[7],Do=et[8],ro=et[9],ur=et[10],hr=et[11],$r=et[12],Mo=et[13];ue=et[14]||"declutter";let $n=et[15];if(!Qe&&et.length>=20){ot=et[19],st=et[20],it=et[21],pt=et[22];let xt=this.drawLabelWithPointPlacement_(ot,st,it,pt);Qe=xt.label,et[3]=Qe;let qt=et[23];me=(xt.anchorX-qt)*this.pixelRatio,et[4]=me;let Dn=et[24];ce=(xt.anchorY-Dn)*this.pixelRatio,et[5]=ce,bn=Qe.height,et[6]=bn,Mo=Qe.width,et[13]=Mo}let oo;et.length>25&&(oo=et[25]);let xs,Zo,as;et.length>17?(xs=et[16],Zo=et[17],as=et[18]):(xs=nh,Zo=null,as=null),ur&&yt?hr+=Gt:!ur&&!yt&&(hr-=Gt);let Ie=0;for(;q<W;q+=2){if(oo&&oo[Ie++]<Mo/this.pixelRatio)continue;let xt=this.calculateImageOrLabelDimensions_(Qe.width,Qe.height,A[q],A[q+1],Mo,bn,me,ce,Do,ro,hr,$r,s,xs,!!Zo||!!as,rt),qt=[e,t,Qe,xt,Di,Zo,as];if(w){let Dn,Mn,Hn;if($n){let Yt=W-q;if(!$n[Yt]){$n[Yt]={args:qt,declutterMode:ue};continue}let De=$n[Yt];Dn=De.args,Mn=De.declutterMode,delete $n[Yt],Hn=xj(Dn)}let ni,Bn;if(Dn&&(Mn!=="declutter"||!w.collides(Hn))&&(ni=!0),(ue!=="declutter"||!w.collides(xt.declutterBox))&&(Bn=!0),Mn==="declutter"&&ue==="declutter"){let Yt=ni&&Bn;ni=Yt,Bn=Yt}ni&&(Mn!=="none"&&w.insert(Hn),this.replayImageOrLabel_.apply(this,Dn)),Bn&&(ue!=="none"&&w.insert(xt.declutterBox),this.replayImageOrLabel_.apply(this,qt))}else this.replayImageOrLabel_.apply(this,qt)}++z;break;case Kt.DRAW_CHARS:let J=et[1],Q=et[2],te=et[3],ge=et[4];pt=et[5];let be=et[6],Le=et[7],Ae=et[8];it=et[9];let Se=et[10];ot=et[11],Array.isArray(ot)&&(ot=ot.reduce(fW,"")),st=et[12];let Re=[et[13],et[13]];ue=et[14]||"declutter";let Xe=et[15],Ge=this.textStates[st],Ke=Ge.font,Te=[Ge.scale[0]*Le,Ge.scale[1]*Le],Ut;Ke in this.widths_?Ut=this.widths_[Ke]:(Ut={},this.widths_[Ke]=Ut);let Wn=Gg(A,J,Q,2),Et=Math.abs(Te[0])*pM(Ke,ot,Ut);if(ge||Et<=Wn){let xt=this.textStates[st].textAlign,qt=(Wn-Et)*TP(ot,xt),Dn=vj(A,J,Q,2,ot,qt,be,Math.abs(Te[0]),pM,Ke,Ut,yt?0:this.viewRotation_,Xe);e:if(Dn){let Mn=[],Hn,ni,Bn,Yt,De;if(it)for(Hn=0,ni=Dn.length;Hn<ni;++Hn){De=Dn[Hn],Bn=De[4],Yt=this.createLabel(Bn,st,"",it),me=De[2]+(Te[0]<0?-Se:Se),ce=te*Yt.height+(.5-te)*2*Se*Te[1]/Te[0]-Ae;let Zn=this.calculateImageOrLabelDimensions_(Yt.width,Yt.height,De[0],De[1],Yt.width,Yt.height,me,ce,0,0,De[3],Re,!1,nh,!1,rt);if(w&&ue==="declutter"&&w.collides(Zn.declutterBox))break e;Mn.push([e,t,Yt,Zn,1,null,null])}if(pt)for(Hn=0,ni=Dn.length;Hn<ni;++Hn){De=Dn[Hn],Bn=De[4],Yt=this.createLabel(Bn,st,pt,""),me=De[2],ce=te*Yt.height-Ae;let Zn=this.calculateImageOrLabelDimensions_(Yt.width,Yt.height,De[0],De[1],Yt.width,Yt.height,me,ce,0,0,De[3],Re,!1,nh,!1,rt);if(w&&ue==="declutter"&&w.collides(Zn.declutterBox))break e;Mn.push([e,t,Yt,Zn,1,null,null])}w&&ue!=="none"&&w.load(Mn.map(xj));for(let Zn=0,yr=Mn.length;Zn<yr;++Zn)this.replayImageOrLabel_.apply(this,Mn[Zn])}}++z;break;case Kt.END_GEOMETRY:if(f!==void 0){rt=et[1];let xt=f(rt,Qt,ue);if(xt)return xt}++z;break;case Kt.FILL:ft?Vt++:this.fill_(e),++z;break;case Kt.MOVE_TO_LINE_TO:for(q=et[1],W=et[2],Dt=A[q],$t=A[q+1],e.moveTo(Dt,$t),Me=Dt+.5|0,Ue=$t+.5|0,q+=2;q<W;q+=2)Dt=A[q],$t=A[q+1],Pe=Dt+.5|0,ke=$t+.5|0,(q==W-2||Pe!==Me||ke!==Ue)&&(e.lineTo(Dt,$t),Me=Pe,Ue=ke);++z;break;case Kt.SET_FILL_STYLE:this.alignAndScaleFill_=et[2],Vt&&(this.fill_(e),Vt=0,Pt&&(e.stroke(),Pt=0)),e.fillStyle=et[1],++z;break;case Kt.SET_STROKE_STYLE:Pt&&(e.stroke(),Pt=0),this.setStrokeStyle_(e,et),++z;break;case Kt.STROKE:ft?Pt++:e.stroke(),++z;break;default:++z;break}}Vt&&this.fill_(e),Pt&&e.stroke()}execute(e,t,o,a,s,f){this.viewRotation_=a,this.execute_(e,t,o,this.instructions,s,void 0,void 0,f)}executeHitDetection(e,t,o,a,s){return this.viewRotation_=o,this.execute_(e,[e.canvas.width,e.canvas.height],t,this.hitDetectionInstructions,!0,a,s)}},wj=CP;var Ed=["Polygon","Circle","LineString","Image","Text","Default"],DP=["Image","Text"],Ej=Ed.filter(n=>!DP.includes(n)),SP=class{constructor(e,t,o,a,s,f,v){this.maxExtent_=e,this.overlaps_=a,this.pixelRatio_=o,this.resolution_=t,this.renderBuffer_=f,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Io(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(s,v)}clip(e,t){let o=this.getClipCoords(t);e.beginPath(),e.moveTo(o[0],o[1]),e.lineTo(o[2],o[3]),e.lineTo(o[4],o[5]),e.lineTo(o[6],o[7]),e.clip()}createExecutors_(e,t){for(let o in e){let a=this.executorsByZIndex_[o];a===void 0&&(a={},this.executorsByZIndex_[o]=a);let s=e[o];for(let f in s){let v=s[f];a[f]=new wj(this.resolution_,this.pixelRatio_,this.overlaps_,v,t)}}}hasExecutors(e){for(let t in this.executorsByZIndex_){let o=this.executorsByZIndex_[t];for(let a=0,s=e.length;a<s;++a)if(e[a]in o)return!0}return!1}forEachFeatureAtCoordinate(e,t,o,a,s,f){a=Math.round(a);let v=a*2+1,w=$o(this.hitDetectionTransform_,a+.5,a+.5,1/t,-1/t,-o,-e[0],-e[1]),D=!this.hitDetectionContext_;D&&(this.hitDetectionContext_=xi(v,v));let A=this.hitDetectionContext_;A.canvas.width!==v||A.canvas.height!==v?(A.canvas.width=v,A.canvas.height=v):D||A.clearRect(0,0,v,v);let z;this.renderBuffer_!==void 0&&(z=ar(),qf(z,e),qu(z,t*(this.renderBuffer_+a),z));let H=pW(a),q;function W(ke,Qe,ot){let st=A.getImageData(0,0,v,v).data;for(let it=0,pt=H.length;it<pt;it++)if(st[H[it]]>0){if(!f||ot==="none"||q!=="Image"&&q!=="Text"||f.includes(ke)){let Vt=(H[it]-3)/4,Pt=a-Vt%v,At=a-(Vt/v|0),Gt=s(ke,Qe,Pt*Pt+At*At);if(Gt)return Gt}A.clearRect(0,0,v,v);break}}let me=Object.keys(this.executorsByZIndex_).map(Number);me.sort(Gs);let ce,ue,Me,Ue,Pe;for(ce=me.length-1;ce>=0;--ce){let ke=me[ce].toString();for(Me=this.executorsByZIndex_[ke],ue=Ed.length-1;ue>=0;--ue)if(q=Ed[ue],Ue=Me[q],Ue!==void 0&&(Pe=Ue.executeHitDetection(A,w,o,W,z),Pe))return Pe}}getClipCoords(e){let t=this.maxExtent_;if(!t)return null;let o=t[0],a=t[1],s=t[2],f=t[3],v=[o,a,o,f,s,f,s,a];return Zs(v,0,8,2,e,v),v}isEmpty(){return Da(this.executorsByZIndex_)}execute(e,t,o,a,s,f,v){let w=Object.keys(this.executorsByZIndex_).map(Number);w.sort(v?AN:Gs),f=f||Ed;let D=Ed.length;for(let A=0,z=w.length;A<z;++A){let H=w[A].toString(),q=this.executorsByZIndex_[H];for(let W=0,me=f.length;W<me;++W){let ce=f[W],ue=q[ce];if(ue!==void 0){let Me=v===null?void 0:ue.getZIndexContext(),Ue=Me?Me.getContext():e,Pe=this.maxExtent_&&ce!=="Image"&&ce!=="Text";if(Pe&&(Ue.save(),this.clip(Ue,o)),!Me||ce==="Text"||ce==="Image"?ue.execute(Ue,t,o,a,s,v):Me.pushFunction(ke=>ue.execute(ke,t,o,a,s,v)),Pe&&Ue.restore(),Me){Me.offset();let ke=w[A]*D+Ed.indexOf(ce);this.deferredZIndexContexts_[ke]||(this.deferredZIndexContexts_[ke]=[]),this.deferredZIndexContexts_[ke].push(Me)}}}}this.renderedContext_=e}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){let e=this.deferredZIndexContexts_,t=Object.keys(e).map(Number).sort(Gs);for(let o=0,a=t.length;o<a;++o)e[t[o]].forEach(s=>{s.draw(this.renderedContext_),s.clear()}),e[t[o]].length=0}},IP={};function pW(n){if(IP[n]!==void 0)return IP[n];let e=n*2+1,t=n*n,o=new Array(t+1);for(let s=0;s<=n;++s)for(let f=0;f<=n;++f){let v=s*s+f*f;if(v>t)break;let w=o[v];w||(w=[],o[v]=w),w.push(((n+s)*e+(n+f))*4+3),s>0&&w.push(((n-s)*e+(n+f))*4+3),f>0&&(w.push(((n+s)*e+(n-f))*4+3),s>0&&w.push(((n-s)*e+(n-f))*4+3))}let a=[];for(let s=0,f=o.length;s<f;++s)o[s]&&a.push(...o[s]);return IP[n]=a,a}var Tj=SP;var MP=class extends R1{constructor(e,t,o,a,s,f,v){super(),this.context_=e,this.pixelRatio_=t,this.extent_=o,this.transform_=a,this.transformRotation_=a?Hf(Math.atan2(a[1],a[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=f,this.userTransform_=v,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Io()}drawImages_(e,t,o,a){if(!this.image_)return;let s=Zs(e,t,o,a,this.transform_,this.pixelCoordinates_),f=this.context_,v=this.tmpLocalTransform_,w=f.globalAlpha;this.imageOpacity_!=1&&(f.globalAlpha=w*this.imageOpacity_);let D=this.imageRotation_;this.transformRotation_===0&&(D-=this.viewRotation_),this.imageRotateWithView_&&(D+=this.viewRotation_);for(let A=0,z=s.length;A<z;A+=2){let H=s[A]-this.imageAnchorX_,q=s[A+1]-this.imageAnchorY_;if(D!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){let W=H+this.imageAnchorX_,me=q+this.imageAnchorY_;$o(v,W,me,1,1,D,-W,-me),f.save(),f.transform.apply(f,v),f.translate(W,me),f.scale(this.imageScale_[0],this.imageScale_[1]),f.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),f.restore()}else f.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,H,q,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(f.globalAlpha=w)}drawText_(e,t,o,a){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);let s=Zs(e,t,o,a,this.transform_,this.pixelCoordinates_),f=this.context_,v=this.textRotation_;for(this.transformRotation_===0&&(v-=this.viewRotation_),this.textRotateWithView_&&(v+=this.viewRotation_);t<o;t+=a){let w=s[t]+this.textOffsetX_,D=s[t+1]+this.textOffsetY_;v!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(f.save(),f.translate(w-this.textOffsetX_,D-this.textOffsetY_),f.rotate(v),f.translate(this.textOffsetX_,this.textOffsetY_),f.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&f.strokeText(this.text_,0,0),this.textFillState_&&f.fillText(this.text_,0,0),f.restore()):(this.textStrokeState_&&f.strokeText(this.text_,w,D),this.textFillState_&&f.fillText(this.text_,w,D))}}moveToLineTo_(e,t,o,a,s){let f=this.context_,v=Zs(e,t,o,a,this.transform_,this.pixelCoordinates_);f.moveTo(v[0],v[1]);let w=v.length;s&&(w-=2);for(let D=2;D<w;D+=2)f.lineTo(v[D],v[D+1]);return s&&f.closePath(),o}drawRings_(e,t,o,a){for(let s=0,f=o.length;s<f;++s)t=this.moveToLineTo_(e,t,o[s],a,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!lr(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let t=Sz(e,this.transform_,this.pixelCoordinates_),o=t[2]-t[0],a=t[3]-t[1],s=Math.sqrt(o*o+a*a),f=this.context_;f.beginPath(),f.arc(t[0],t[1],s,0,2*Math.PI),this.fillState_&&f.fill(),this.strokeState_&&f.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break;default:}}drawFeature(e,t){let o=t.getGeometryFunction()(e);o&&(this.setStyle(t),this.drawGeometry(o))}drawGeometryCollection(e){let t=e.getGeometriesArray();for(let o=0,a=t.length;o<a;++o)this.drawGeometry(t[o])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let t=e.getFlatCoordinates(),o=e.getStride();this.image_&&this.drawImages_(t,0,t.length,o),this.text_!==""&&this.drawText_(t,0,t.length,o)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let t=e.getFlatCoordinates(),o=e.getStride();this.image_&&this.drawImages_(t,0,t.length,o),this.text_!==""&&this.drawText_(t,0,t.length,o)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!lr(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);let t=this.context_,o=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(o,0,o.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){let t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let t=e.getExtent();if(lr(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);let o=this.context_,a=e.getFlatCoordinates(),s=0,f=e.getEnds(),v=e.getStride();o.beginPath();for(let w=0,D=f.length;w<D;++w)s=this.moveToLineTo_(a,s,f[w],v,!1);o.stroke()}if(this.text_!==""){let o=e.getFlatMidpoints();this.drawText_(o,0,o.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!lr(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){let t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!lr(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let t=this.context_,o=e.getOrientedFlatCoordinates(),a=0,s=e.getEndss(),f=e.getStride();t.beginPath();for(let v=0,w=s.length;v<w;++v){let D=s[v];a=this.drawRings_(o,a,D,f)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){let t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){let t=this.context_,o=this.contextFillState_;o?o.fillStyle!=e.fillStyle&&(o.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){let t=this.context_,o=this.contextStrokeState_;o?(o.lineCap!=e.lineCap&&(o.lineCap=e.lineCap,t.lineCap=e.lineCap),is(o.lineDash,e.lineDash)||t.setLineDash(o.lineDash=e.lineDash),o.lineDashOffset!=e.lineDashOffset&&(o.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),o.lineJoin!=e.lineJoin&&(o.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),o.lineWidth!=e.lineWidth&&(o.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),o.miterLimit!=e.miterLimit&&(o.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),o.strokeStyle!=e.strokeStyle&&(o.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){let t=this.context_,o=this.contextTextState_,a=e.textAlign?e.textAlign:xd;o?(o.font!=e.font&&(o.font=e.font,t.font=e.font),o.textAlign!=a&&(o.textAlign=a,t.textAlign=a),o.textBaseline!=e.textBaseline&&(o.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=a,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:a,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{let o=e.getColor();this.fillState_={fillStyle:Ws(o||io)}}if(!t)this.strokeState_=null;else{let o=t.getColor(),a=t.getLineCap(),s=t.getLineDash(),f=t.getLineDashOffset(),v=t.getLineJoin(),w=t.getWidth(),D=t.getMiterLimit(),A=s||Xs;this.strokeState_={lineCap:a!==void 0?a:$c,lineDash:this.pixelRatio_===1?A:A.map(z=>z*this.pixelRatio_),lineDashOffset:(f||Ys)*this.pixelRatio_,lineJoin:v!==void 0?v:Hc,lineWidth:(w!==void 0?w:ih)*this.pixelRatio_,miterLimit:D!==void 0?D:eh,strokeStyle:Ws(o||th)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}let o=e.getPixelRatio(this.pixelRatio_),a=e.getAnchor(),s=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=a[0]*o,this.imageAnchorY_=a[1]*o,this.imageHeight_=t[1]*o,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();let f=e.getScaleArray();this.imageScale_=[f[0]*this.pixelRatio_/o,f[1]*this.pixelRatio_/o],this.imageWidth_=t[0]*o}setTextStyle(e){if(!e)this.text_="";else{let t=e.getFill();if(!t)this.textFillState_=null;else{let q=t.getColor();this.textFillState_={fillStyle:Ws(q||io)}}let o=e.getStroke();if(!o)this.textStrokeState_=null;else{let q=o.getColor(),W=o.getLineCap(),me=o.getLineDash(),ce=o.getLineDashOffset(),ue=o.getLineJoin(),Me=o.getWidth(),Ue=o.getMiterLimit();this.textStrokeState_={lineCap:W!==void 0?W:$c,lineDash:me||Xs,lineDashOffset:ce||Ys,lineJoin:ue!==void 0?ue:Hc,lineWidth:Me!==void 0?Me:ih,miterLimit:Ue!==void 0?Ue:eh,strokeStyle:Ws(q||th)}}let a=e.getFont(),s=e.getOffsetX(),f=e.getOffsetY(),v=e.getRotateWithView(),w=e.getRotation(),D=e.getScaleArray(),A=e.getText(),z=e.getTextAlign(),H=e.getTextBaseline();this.textState_={font:a!==void 0?a:s1,textAlign:z!==void 0?z:xd,textBaseline:H!==void 0?H:sp},this.text_=A!==void 0?Array.isArray(A)?A.reduce((q,W,me)=>q+=me%2?" ":W,""):A:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=f!==void 0?this.pixelRatio_*f:0,this.textRotateWithView_=v!==void 0?v:!1,this.textRotation_=w!==void 0?w:0,this.textScale_=[this.pixelRatio_*D[0],this.pixelRatio_*D[1]]}}},Cj=MP;var Xl=.5;function Ij(n,e,t,o,a,s,f,v,w){let D=w?ad(a,w):a,A=n[0]*Xl,z=n[1]*Xl,H=xi(A,z);H.imageSmoothingEnabled=!1;let q=H.canvas,W=new Cj(H,Xl,a,null,f,v,w?Yf(Kf(),w):null),me=t.length,ce=Math.floor((256*256*256-1)/me),ue={};for(let Ue=1;Ue<=me;++Ue){let Pe=t[Ue-1],ke=Pe.getStyleFunction()||o;if(!ke)continue;let Qe=ke(Pe,s);if(!Qe)continue;Array.isArray(Qe)||(Qe=[Qe]);let st=(Ue*ce).toString(16).padStart(7,"#00000");for(let it=0,pt=Qe.length;it<pt;++it){let Vt=Qe[it],Pt=Vt.getGeometryFunction()(Pe);if(!Pt||!lr(D,Pt.getExtent()))continue;let At=Vt.clone(),Gt=At.getFill();Gt&&Gt.setColor(st);let yt=At.getStroke();yt&&(yt.setColor(st),yt.setLineDash(null)),At.setText(void 0);let dt=Vt.getImage();if(dt){let $t=dt.getImageSize();if(!$t)continue;let Qt=xi($t[0],$t[1],void 0,{alpha:!1}),et=Qt.canvas;Qt.fillStyle=st,Qt.fillRect(0,0,et.width,et.height),At.setImage(new Hv({img:et,anchor:dt.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:dt.getOrigin(),opacity:1,size:dt.getSize(),scale:dt.getScale(),rotation:dt.getRotation(),rotateWithView:dt.getRotateWithView()}))}let ft=At.getZIndex()||0,rt=ue[ft];rt||(rt={},ue[ft]=rt,rt.Polygon=[],rt.Circle=[],rt.LineString=[],rt.Point=[]);let Dt=Pt.getType();if(Dt==="GeometryCollection"){let $t=Pt.getGeometriesArrayRecursive();for(let Qt=0,et=$t.length;Qt<et;++Qt){let Zt=$t[Qt];rt[Zt.getType().replace("Multi","")].push(Zt,At)}}else rt[Dt.replace("Multi","")].push(Pt,At)}}let Me=Object.keys(ue).map(Number).sort(Gs);for(let Ue=0,Pe=Me.length;Ue<Pe;++Ue){let ke=ue[Me[Ue]];for(let Qe in ke){let ot=ke[Qe];for(let st=0,it=ot.length;st<it;st+=2){W.setStyle(ot[st+1]);for(let pt=0,Vt=e.length;pt<Vt;++pt)W.setTransform(e[pt]),W.drawGeometry(ot[st])}}}return H.getImageData(0,0,q.width,q.height)}function Sj(n,e,t){let o=[];if(t){let a=Math.floor(Math.round(n[0])*Xl),s=Math.floor(Math.round(n[1])*Xl),f=(ci(a,0,t.width-1)+ci(s,0,t.height-1)*t.width)*4,v=t.data[f],w=t.data[f+1],A=t.data[f+2]+256*(w+256*v),z=Math.floor((256*256*256-1)/e.length);A&&A%z===0&&o.push(e[A/z-1])}return o}var mW=.5,Dj={Point:wW,LineString:vW,Polygon:TW,MultiPoint:EW,MultiLineString:xW,MultiPolygon:bW,GeometryCollection:yW,Circle:gW};function Mj(n,e){return parseInt(dn(n),10)-parseInt(dn(e),10)}function PP(n,e){let t=AP(n,e);return t*t}function AP(n,e){return mW*n/e}function gW(n,e,t,o,a){let s=t.getFill(),f=t.getStroke();if(s||f){let w=n.getBuilder(t.getZIndex(),"Circle");w.setFillStrokeStyle(s,f),w.drawCircle(e,o,a)}let v=t.getText();if(v&&v.getText()){let w=n.getBuilder(t.getZIndex(),"Text");w.setTextStyle(v),w.drawText(e,o)}}function RP(n,e,t,o,a,s,f,v){let w=[],D=t.getImage();if(D){let H=!0,q=D.getImageState();q==ln.LOADED||q==ln.ERROR?H=!1:q==ln.IDLE&&D.load(),H&&w.push(D.ready())}let A=t.getFill();A&&A.loading()&&w.push(A.ready());let z=w.length>0;return z&&Promise.all(w).then(()=>a(null)),_W(n,e,t,o,s,f,v),z}function _W(n,e,t,o,a,s,f){let v=t.getGeometryFunction()(e);if(!v)return;let w=v.simplifyTransformed(o,a);if(t.getRenderer())Pj(n,w,t,e,f);else{let A=Dj[w.getType()];A(n,w,t,e,f,s)}}function Pj(n,e,t,o,a){if(e.getType()=="GeometryCollection"){let f=e.getGeometries();for(let v=0,w=f.length;v<w;++v)Pj(n,f[v],t,o,a);return}n.getBuilder(t.getZIndex(),"Default").drawCustom(e,o,t.getRenderer(),t.getHitDetectionRenderer(),a)}function yW(n,e,t,o,a,s){let f=e.getGeometriesArray(),v,w;for(v=0,w=f.length;v<w;++v){let D=Dj[f[v].getType()];D(n,f[v],t,o,a,s)}}function vW(n,e,t,o,a){let s=t.getStroke();if(s){let v=n.getBuilder(t.getZIndex(),"LineString");v.setFillStrokeStyle(null,s),v.drawLineString(e,o,a)}let f=t.getText();if(f&&f.getText()){let v=n.getBuilder(t.getZIndex(),"Text");v.setTextStyle(f),v.drawText(e,o,a)}}function xW(n,e,t,o,a){let s=t.getStroke();if(s){let v=n.getBuilder(t.getZIndex(),"LineString");v.setFillStrokeStyle(null,s),v.drawMultiLineString(e,o,a)}let f=t.getText();if(f&&f.getText()){let v=n.getBuilder(t.getZIndex(),"Text");v.setTextStyle(f),v.drawText(e,o,a)}}function bW(n,e,t,o,a){let s=t.getFill(),f=t.getStroke();if(f||s){let w=n.getBuilder(t.getZIndex(),"Polygon");w.setFillStrokeStyle(s,f),w.drawMultiPolygon(e,o,a)}let v=t.getText();if(v&&v.getText()){let w=n.getBuilder(t.getZIndex(),"Text");w.setTextStyle(v),w.drawText(e,o,a)}}function wW(n,e,t,o,a,s){let f=t.getImage(),v=t.getText(),w=v&&v.getText(),D=s&&f&&w?{}:void 0;if(f){if(f.getImageState()!=ln.LOADED)return;let A=n.getBuilder(t.getZIndex(),"Image");A.setImageStyle(f,D),A.drawPoint(e,o,a)}if(w){let A=n.getBuilder(t.getZIndex(),"Text");A.setTextStyle(v,D),A.drawText(e,o,a)}}function EW(n,e,t,o,a,s){let f=t.getImage(),v=f&&f.getOpacity()!==0,w=t.getText(),D=w&&w.getText(),A=s&&v&&D?{}:void 0;if(v){if(f.getImageState()!=ln.LOADED)return;let z=n.getBuilder(t.getZIndex(),"Image");z.setImageStyle(f,A),z.drawMultiPoint(e,o,a)}if(D){let z=n.getBuilder(t.getZIndex(),"Text");z.setTextStyle(w,A),z.drawText(e,o,a)}}function TW(n,e,t,o,a){let s=t.getFill(),f=t.getStroke();if(s||f){let w=n.getBuilder(t.getZIndex(),"Polygon");w.setFillStrokeStyle(s,f),w.drawPolygon(e,o,a)}let v=t.getText();if(v&&v.getText()){let w=n.getBuilder(t.getZIndex(),"Text");w.setTextStyle(v),w.drawText(e,o,a)}}var LP=class extends A1{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=ar(),this.wrappedRenderedExtent_=ar(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,t,o){let a=t.extent,s=t.viewState,f=s.center,v=s.resolution,w=s.projection,D=s.rotation,A=w.getExtent(),z=this.getLayer().getSource(),H=this.getLayer().getDeclutter(),q=t.pixelRatio,W=t.viewHints,me=!(W[no.ANIMATING]||W[no.INTERACTING]),ce=this.context,ue=Math.round(In(a)/v*q),Me=Math.round(Hi(a)/v*q),Ue=z.getWrapX()&&w.canWrapX(),Pe=Ue?In(A):null,ke=Ue?Math.ceil((a[2]-A[2])/Pe)+1:1,Qe=Ue?Math.floor((a[0]-A[0])/Pe):0;do{let ot=this.getRenderTransform(f,v,0,q,ue,Me,Qe*Pe);t.declutter&&(ot=ot.slice(0)),e.execute(ce,[ce.canvas.width,ce.canvas.height],ot,D,me,o===void 0?Ed:o?DP:Ej,o?H&&t.declutter[H]:void 0)}while(++Qe<ke)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=xi(this.context.canvas.width,this.context.canvas.height,cP))}resetDrawContext_(){if(this.opacity_!==1&&this.targetContext_){let e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,ep(this.context),cP.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(e){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(e,t){let o=e.layerStatesArray[e.layerIndex];this.opacity_=o.opacity;let a=e.viewState;this.prepareContainer(e,t);let s=this.context,f=this.replayGroup_,v=f&&!f.isEmpty();if(!v&&!(this.getLayer().hasListener(Ho.PRERENDER)||this.getLayer().hasListener(Ho.POSTRENDER)))return this.container;this.setDrawContext_(),this.preRender(s,e);let w=a.projection;if(this.clipped_=!1,v&&o.extent&&this.clipping){let D=rl(o.extent,w);v=lr(D,e.extent),this.clipped_=v&&!Zf(D,e.extent),this.clipped_&&this.clipUnrotated(s,e,D)}return v&&this.renderWorlds(f,e,this.getLayer().getDeclutter()?!1:void 0),!e.declutter&&this.clipped_&&s.restore(),this.postRender(s,e),this.renderedRotation_!==a.rotation&&(this.renderedRotation_=a.rotation,this.hitDetectionImageData_=null),e.declutter||this.resetDrawContext_(),this.container}getFeatures(e){return new Promise(t=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){let o=this.frameState.size.slice(),a=this.renderedCenter_,s=this.renderedResolution_,f=this.renderedRotation_,v=this.renderedProjection_,w=this.wrappedRenderedExtent_,D=this.getLayer(),A=[],z=o[0]*Xl,H=o[1]*Xl;A.push(this.getRenderTransform(a,s,f,Xl,z,H,0).slice());let q=D.getSource(),W=v.getExtent();if(q.getWrapX()&&v.canWrapX()&&!Zf(W,w)){let ce=w[0],ue=In(W),Me=0,Ue;for(;ce<W[0];)--Me,Ue=ue*Me,A.push(this.getRenderTransform(a,s,f,Xl,z,H,Ue).slice()),ce+=ue;for(Me=0,ce=w[2];ce>W[2];)++Me,Ue=ue*Me,A.push(this.getRenderTransform(a,s,f,Xl,z,H,Ue).slice()),ce-=ue}let me=Kf();this.hitDetectionImageData_=Ij(o,A,this.renderedFeatures_,D.getStyleFunction(),w,s,f,PP(s,this.renderedPixelRatio_),me?v:null)}t(Sj(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,o,a,s){if(!this.replayGroup_)return;let f=t.viewState.resolution,v=t.viewState.rotation,w=this.getLayer(),D={},A=function(H,q,W){let me=dn(H),ce=D[me];if(ce){if(ce!==!0&&W<ce.distanceSq){if(W===0)return D[me]=!0,s.splice(s.lastIndexOf(ce),1),a(H,w,q);ce.geometry=q,ce.distanceSq=W}}else{if(W===0)return D[me]=!0,a(H,w,q);s.push(D[me]={feature:H,layer:w,geometry:q,distanceSq:W,callback:a})}},z=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(e,f,v,o,A,z?t.declutter?.[z]?.all().map(H=>H.value):null)}handleFontsChanged(){let e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){let t=this.getLayer(),o=t.getSource();if(!o)return!1;let a=e.viewHints[no.ANIMATING],s=e.viewHints[no.INTERACTING],f=t.getUpdateWhileAnimating(),v=t.getUpdateWhileInteracting();if(this.ready&&!f&&a||!v&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;let w=e.extent,D=e.viewState,A=D.projection,z=D.resolution,H=e.pixelRatio,q=t.getRevision(),W=t.getRenderBuffer(),me=t.getRenderOrder();me===void 0&&(me=Mj);let ce=D.center.slice(),ue=qu(w,W*z),Me=ue.slice(),Ue=[ue.slice()],Pe=A.getExtent();if(o.getWrapX()&&A.canWrapX()&&!Zf(Pe,e.extent)){let yt=In(Pe),dt=Math.max(In(ue)/2,yt);ue[0]=Pe[0]-dt,ue[2]=Pe[2]+dt,Tw(ce,A);let ft=US(Ue[0],A);ft[0]<Pe[0]&&ft[2]<Pe[2]?Ue.push([ft[0]+yt,ft[1],ft[2]+yt,ft[3]]):ft[0]>Pe[0]&&ft[2]>Pe[2]&&Ue.push([ft[0]-yt,ft[1],ft[2]-yt,ft[3]])}if(this.ready&&this.renderedResolution_==z&&this.renderedRevision_==q&&this.renderedRenderOrder_==me&&this.renderedFrameDeclutter_===!!e.declutter&&Zf(this.wrappedRenderedExtent_,ue))return is(this.renderedExtent_,Me)||(this.hitDetectionImageData_=null,this.renderedExtent_=Me),this.renderedCenter_=ce,this.replayGroupChanged=!1,!0;this.replayGroup_=null;let ke=new yj(AP(z,H),ue,z,H),Qe=Kf(),ot;if(Qe){for(let yt=0,dt=Ue.length;yt<dt;++yt){let ft=Ue[yt],rt=ad(ft,A);o.loadFeatures(rt,vz(z,A),Qe)}ot=Yf(Qe,A)}else for(let yt=0,dt=Ue.length;yt<dt;++yt)o.loadFeatures(Ue[yt],z,A);let st=PP(z,H),it=!0,pt=(yt,dt)=>{let ft,rt=yt.getStyleFunction()||t.getStyleFunction();if(rt&&(ft=rt(yt,z)),ft){let Dt=this.renderFeature(yt,st,ft,ke,ot,this.getLayer().getDeclutter(),dt);it=it&&!Dt}},Vt=ad(ue,A),Pt=o.getFeaturesInExtent(Vt);me&&Pt.sort(me);for(let yt=0,dt=Pt.length;yt<dt;++yt)pt(Pt[yt],yt);this.renderedFeatures_=Pt,this.ready=it;let At=ke.finish(),Gt=new Tj(ue,z,H,o.getOverlaps(),At,t.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=z,this.renderedRevision_=q,this.renderedRenderOrder_=me,this.renderedFrameDeclutter_=!!e.declutter,this.renderedExtent_=Me,this.wrappedRenderedExtent_=ue,this.renderedCenter_=ce,this.renderedProjection_=A,this.renderedPixelRatio_=H,this.replayGroup_=Gt,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,o,a,s,f,v){if(!o)return!1;let w=!1;if(Array.isArray(o))for(let D=0,A=o.length;D<A;++D)w=RP(a,e,o[D],t,this.boundHandleStyleImageChange_,s,f,v)||w;else w=RP(a,e,o,t,this.boundHandleStyleImageChange_,s,f,v);return w}},Aj=LP;var OP=class extends m1{constructor(e){super(e)}createRenderer(){return new Aj(this)}},Rj=OP;var Yg=[0,0,0],Td=5,kP=class{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,Cn(LN(this.resolutions_,(a,s)=>s-a,!0),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let a=0,s=this.resolutions_.length-1;a<s;++a)if(!t)t=this.resolutions_[a]/this.resolutions_[a+1];else if(this.resolutions_[a]/this.resolutions_[a+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,Cn(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));let o=e.extent;o!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=tl(o)),Cn(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,Cn(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:256,Cn(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=o!==void 0?o:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((a,s)=>{let f=new I1(Math.min(0,a[0]),Math.max(a[0]-1,-1),Math.min(0,a[1]),Math.max(a[1]-1,-1));if(o){let v=this.getTileRangeForExtentAndZ(o,s);f.minX=Math.max(v.minX,f.minX),f.maxX=Math.min(v.maxX,f.maxX),f.minY=Math.max(v.minY,f.minY),f.maxY=Math.min(v.maxY,f.maxY)}return f}):o&&this.calculateTileRanges_(o)}forEachTileCoord(e,t,o){let a=this.getTileRangeForExtentAndZ(e,t);for(let s=a.minX,f=a.maxX;s<=f;++s)for(let v=a.minY,w=a.maxY;v<=w;++v)o([t,s,v])}forEachTileCoordParentTileRange(e,t,o,a){let s,f,v,w=null,D=e[0]-1;for(this.zoomFactor_===2?(f=e[1],v=e[2]):w=this.getTileCoordExtent(e,a);D>=this.minZoom;){if(f!==void 0&&v!==void 0?(f=Math.floor(f/2),v=Math.floor(v/2),s=cp(f,f,v,v,o)):s=this.getTileRangeForExtentAndZ(w,D,o),t(D,s))return!0;--D}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,o){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){let s=e[1]*2,f=e[2]*2;return cp(s,s+1,f,f+1,t)}let a=this.getTileCoordExtent(e,o||this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,o){if(t>this.maxZoom||t<this.minZoom)return null;let a=e[0],s=e[1],f=e[2];if(t===a)return cp(s,f,s,f,o);if(this.zoomFactor_){let w=Math.pow(this.zoomFactor_,t-a),D=Math.floor(s*w),A=Math.floor(f*w);if(t<a)return cp(D,D,A,A,o);let z=Math.floor(w*(s+1))-1,H=Math.floor(w*(f+1))-1;return cp(D,z,A,H,o)}let v=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(v,t,o)}getTileRangeForExtentAndZ(e,t,o){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,Yg);let a=Yg[1],s=Yg[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,Yg);let f=Yg[1],v=Yg[2];return cp(a,f,s,v,o)}getTileCoordCenter(e){let t=this.getOrigin(e[0]),o=this.getResolution(e[0]),a=gr(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*a[0]*o,t[1]-(e[2]+.5)*a[1]*o]}getTileCoordExtent(e,t){let o=this.getOrigin(e[0]),a=this.getResolution(e[0]),s=gr(this.getTileSize(e[0]),this.tmpSize_),f=o[0]+e[1]*s[0]*a,v=o[1]-(e[2]+1)*s[1]*a,w=f+s[0]*a,D=v+s[1]*a;return Ma(f,v,w,D,t)}getTileCoordForCoordAndResolution(e,t,o){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,o)}getTileCoordForXYAndResolution_(e,t,o,a,s){let f=this.getZForResolution(o),v=o/this.getResolution(f),w=this.getOrigin(f),D=gr(this.getTileSize(f),this.tmpSize_),A=v*(e-w[0])/o/D[0],z=v*(w[1]-t)/o/D[1];return a?(A=dv(A,Td)-1,z=dv(z,Td)-1):(A=yg(A,Td),z=yg(z,Td)),Zg(f,A,z,s)}getTileCoordForXYAndZ_(e,t,o,a,s){let f=this.getOrigin(o),v=this.getResolution(o),w=gr(this.getTileSize(o),this.tmpSize_),D=(e-f[0])/v/w[0],A=(f[1]-t)/v/w[1];return a?(D=dv(D,Td)-1,A=dv(A,Td)-1):(D=yg(D,Td),A=yg(A,Td)),Zg(o,D,A,s)}getTileCoordForCoordAndZ(e,t,o){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,o)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){let o=pg(this.resolutions_,e,t||0);return ci(o,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return dD(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){let t=this.resolutions_.length,o=new Array(t);for(let a=this.minZoom;a<t;++a)o[a]=this.getTileRangeForExtentAndZ(e,a);this.fullTileRanges_=o}},FP=kP;function L1(n){let e=n.getDefaultTileGrid();return e||(e=IW(n),n.setDefaultTileGrid(e)),e}function Lj(n,e,t){let o=e[0],a=n.getTileCoordCenter(e),s=O1(t);if(!Vl(s,a)){let f=In(s),v=Math.ceil((s[0]-a[0])/f);return a[0]+=f*v,n.getTileCoordForCoordAndZ(a,o)}return e}function CW(n,e,t,o){o=o!==void 0?o:"top-left";let a=kj(n,e,t);return new FP({extent:n,origin:HN(n,o),resolutions:a,tileSize:t})}function Oj(n){let e=n||{},t=e.extent||si("EPSG:3857").getExtent(),o={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:kj(t,e.maxZoom,e.tileSize,e.maxResolution)};return new FP(o)}function kj(n,e,t,o){e=e!==void 0?e:42,t=gr(t!==void 0?t:256);let a=Hi(n),s=In(n);o=o>0?o:Math.max(s/t[0],a/t[1]);let f=e+1,v=new Array(f);for(let w=0;w<f;++w)v[w]=o/Math.pow(2,w);return v}function IW(n,e,t,o){let a=O1(n);return CW(a,e,t,o)}function O1(n){n=si(n);let e=n.getExtent();if(!e){let t=180*Yu.degrees/n.getMetersPerUnit();e=Ma(-t,-t,t,t)}return e}function k1(n,e){let t=[];Object.keys(e).forEach(function(a){e[a]!==null&&e[a]!==void 0&&t.push(a+"="+encodeURIComponent(e[a]))});let o=t.join("&");return n=n.replace(/[?&]$/,""),n+=n.includes("?")?"&":"?",n+o}var SW=/\{z\}/g,DW=/\{x\}/g,MW=/\{y\}/g,PW=/\{-y\}/g;function Fj(n,e,t,o,a){return n.replace(SW,e.toString()).replace(DW,t.toString()).replace(MW,o.toString()).replace(PW,function(){if(a===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(a-o).toString()})}function Nj(n){let e=[],t=/\{([a-z])-([a-z])\}/.exec(n);if(t){let o=t[1].charCodeAt(0),a=t[2].charCodeAt(0),s;for(s=o;s<=a;++s)e.push(n.replace(t[0],String.fromCharCode(s)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(n),t){let o=parseInt(t[2],10);for(let a=parseInt(t[1],10);a<=o;a++)e.push(n.replace(t[0],a.toString()));return e}return e.push(n),e}function AW(n,e){return(function(t,o,a){if(!t)return;let s,f=t[0];if(e){let v=e.getFullTileRange(f);v&&(s=v.getHeight()-1)}return Fj(n,f,t[1],t[2],s)})}function zj(n,e){let t=n.length,o=new Array(t);for(let a=0;a<t;++a)o[a]=AW(n[a],e);return RW(o)}function RW(n){return n.length===1?n[0]:(function(e,t,o){if(!e)return;let a=M1(e),s=jl(a,n.length);return n[s](e,t,o)})}var NP=class extends Ur{constructor(e){super(),this.projection=si(e.projection),this.attributions_=Bj(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible??!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;let t=this;this.viewPromise_=new Promise(function(o,a){t.viewResolver=o,t.viewRejector=a})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=Bj(e),this.changed()}setState(e){this.state_=e,this.changed()}};function Bj(n){return n?typeof n=="function"?n:(Array.isArray(n)||(n=[n]),e=>n):null}var F1=NP;var zP=class extends F1{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;let t=[256,256];this.tileGrid&&gr(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tmpSize=[0,0],this.key_=e.key||dn(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){let t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,o,a,s,f){return Xt()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:L1(e)}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,o){let a=this.getTileGridForProjection(o),s=this.getTilePixelRatio(t),f=gr(a.getTileSize(e),this.tmpSize);return s==1?f:wB(f,s,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){let o=t!==void 0?t:this.getProjection(),a=t!==void 0?this.getTileGridForProjection(o):this.tileGrid||this.getTileGridForProjection(o);return this.getWrapX()&&o.isGlobal()&&(e=Lj(a,e,o)),lj(e,a)?e:null}clear(){}refresh(){this.clear(),super.refresh()}},N1=class extends Co{constructor(e,t){super(e),this.tile=t}},jj=zP;var z1={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};var BP=class n extends jj{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===n.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){let t=e.target,o=dn(t),a=t.getState(),s;a==jt.LOADING?(this.tileLoadingKeys_[o]=!0,s=z1.TILELOADSTART):o in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[o],s=a==jt.ERROR?z1.TILELOADERROR:a==jt.LOADED?z1.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new N1(s,t))}setTileLoadFunction(e){this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){let t=Nj(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;let t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(zj(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,o){}},Vj=BP;var jP=class extends Vj{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:LW,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:T1,this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(e){return this.getProjection()&&e&&!sd(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getTileGridForProjection(e){let t=this.getProjection();if(this.tileGrid&&(!t||sd(t,e)))return this.tileGrid;let o=dn(e);return o in this.tileGridForProjection||(this.tileGridForProjection[o]=L1(e)),this.tileGridForProjection[o]}createTile_(e,t,o,a,s,f){let v=[e,t,o],w=this.getTileCoordForTileUrlFunction(v,s),D=w?this.tileUrlFunction(w,a,s):void 0,A=new this.tileClass(v,D!==void 0?jt.IDLE:jt.EMPTY,D!==void 0?D:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return A.key=f,A.addEventListener(Ft.CHANGE,this.handleTileChange.bind(this)),A}getTile(e,t,o,a,s,f){let v=this.getProjection();if(!v||!s||sd(v,s))return this.getTileInternal(e,t,o,a,v||s);let w=[e,t,o],D=this.getKey(),A=this.getTileGridForProjection(v),z=this.getTileGridForProjection(s),H=this.getTileCoordForTileUrlFunction(w,s),q=new D1(v,A,s,z,w,H,this.getTilePixelRatio(a),this.getGutter(),(W,me,ce,ue)=>this.getTileInternal(W,me,ce,ue,v,f),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return q.key=D,q}getTileInternal(e,t,o,a,s,f){let v=this.getKey(),w=qg(this,v,e,t,o);if(f&&f.containsKey(w))return f.get(w);let D=this.createTile_(e,t,o,a,s,v);return f?.set(w,D),D}setRenderReprojectionEdges(e){this.renderReprojectionEdges_!=e&&(this.renderReprojectionEdges_=e,this.changed())}setTileGridForProjection(e,t){let o=si(e);if(o){let a=dn(o);a in this.tileGridForProjection||(this.tileGridForProjection[a]=t)}}};function LW(n,e){if(to){let t=n.getCrossOrigin(),o="same-origin",a="same-origin";t==="anonymous"||t===""?(o="cors",a="omit"):t==="use-credentials"&&(o="cors",a="include"),fetch(e,{mode:o,credentials:a}).then(s=>{if(!s.ok)throw new Error(`HTTP ${s.status}`);return s.blob()}).then(s=>createImageBitmap(s)).then(s=>{let f=n.getImage();f.width=s.width,f.height=s.height,f.getContext("2d").drawImage(s,0,0),s.close?.(),f.dispatchEvent(new Event("load"))}).catch(()=>{n.getImage().dispatchEvent(new Event("error"))});return}n.getImage().src=e}var B1=jP;var VP=class extends B1{constructor(e){e=e||{};let t=e.projection!==void 0?e.projection:"EPSG:3857",o=e.tileGrid!==void 0?e.tileGrid:Oj({extent:O1(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:o,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}},UP=VP;var OW=!1;function kW(n,e,t,o,a,s,f){let v=new XMLHttpRequest;v.open("GET",typeof n=="function"?n(t,o,a):n,!0),e.getType()=="arraybuffer"&&(v.responseType="arraybuffer"),v.withCredentials=OW,v.onload=function(w){if(!v.status||v.status>=200&&v.status<300){let D=e.getType();try{let A;D=="text"||D=="json"?A=v.responseText:D=="xml"?A=v.responseXML||v.responseText:D=="arraybuffer"&&(A=v.response),A?s(e.readFeatures(A,{extent:t,featureProjection:a}),e.readProjection(A)):f()}catch{f()}}else f()},v.onerror=f,v.send()}function GP(n,e){return function(t,o,a,s,f){kW(n,e,t,o,a,(v,w)=>{this.addFeatures(v),s!==void 0&&s(v)},()=>{this.changed(),f!==void 0&&f()})}}function Uj(n,e){return[[-1/0,-1/0,1/0,1/0]]}var $P=class{constructor(e){this.rbush_=new jg(e),this.items_={}}insert(e,t){let o={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(o),this.items_[dn(t)]=o}load(e,t){let o=new Array(t.length);for(let a=0,s=t.length;a<s;a++){let f=e[a],v=t[a],w={minX:f[0],minY:f[1],maxX:f[2],maxY:f[3],value:v};o[a]=w,this.items_[dn(v)]=w}this.rbush_.load(o)}remove(e){let t=dn(e),o=this.items_[t];return delete this.items_[t],this.rbush_.remove(o)!==null}update(e,t){let o=this.items_[dn(t)],a=[o.minX,o.minY,o.maxX,o.maxY];Xu(a,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){let t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(a){return a.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let o;for(let a=0,s=e.length;a<s;a++)if(o=t(e[a]),o)return o;return o}isEmpty(){return Da(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){let t=this.rbush_.toJSON();return Ma(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(let t in e.items_)this.items_[t]=e.items_[t]}},HP=$P;var Ra={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};var Xc=class extends Co{constructor(e,t,o){super(e),this.feature=t,this.features=o}},ZP=class extends F1{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=Zu,this.format_=e.format||null,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(Cn(this.format_,"`format` must be set when `url` is set"),this.loader_=GP(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:Uj;let t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new HP:null,this.loadedExtentsRtree_=new HP,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let o,a;Array.isArray(e.features)?a=e.features:e.features&&(o=e.features,a=o.getArray()),!t&&o===void 0&&(o=new Vo(a)),a!==void 0&&this.addFeaturesInternal(a),o!==void 0&&this.bindFeaturesCollection_(o)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){let t=dn(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);let o=e.getGeometry();if(o){let a=o.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(a,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new Xc(Ra.ADDFEATURE,e))}setupChangeEvents_(e,t){t instanceof Wl||(this.featureChangeKeys_[e]=[xn(t,Ft.CHANGE,this.handleFeatureChange_,this),xn(t,Nl.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(e,t){let o=!0;if(t.getId()!==void 0){let a=String(t.getId());if(!(a in this.idIndex_))this.idIndex_[a]=t;else if(t instanceof Wl){let s=this.idIndex_[a];s instanceof Wl?Array.isArray(s)?s.push(t):this.idIndex_[a]=[s,t]:o=!1}else o=!1}return o&&(Cn(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=t),o}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){let t=[],o=[],a=[];for(let s=0,f=e.length;s<f;s++){let v=e[s],w=dn(v);this.addToIndex_(w,v)&&o.push(v)}for(let s=0,f=o.length;s<f;s++){let v=o[s],w=dn(v);this.setupChangeEvents_(w,v);let D=v.getGeometry();if(D){let A=D.getExtent();t.push(A),a.push(v)}else this.nullGeometryFeatures_[w]=v}if(this.featuresRtree_&&this.featuresRtree_.load(t,a),this.hasListener(Ra.ADDFEATURE))for(let s=0,f=o.length;s<f;s++)this.dispatchEvent(new Xc(Ra.ADDFEATURE,o[s]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(Ra.ADDFEATURE,function(o){t||(t=!0,e.push(o.feature),t=!1)}),this.addEventListener(Ra.REMOVEFEATURE,function(o){t||(t=!0,e.remove(o.feature),t=!1)}),e.addEventListener(To.ADD,o=>{t||(t=!0,this.addFeature(o.element),t=!1)}),e.addEventListener(To.REMOVE,o=>{t||(t=!0,this.removeFeature(o.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(let o in this.featureChangeKeys_)this.featureChangeKeys_[o].forEach(Gn);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(o=>{this.removeFeatureInternal(o)});for(let o in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[o])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};let t=new Xc(Ra.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){let o=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(o,function(a){let s=a.getGeometry();if(s instanceof Wl||s.intersectsCoordinate(e))return t(a)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(o){let a=o.getGeometry();if(a instanceof Wl||a.intersectsExtent(e)){let s=t(o);if(s)return s}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),Da(this.nullGeometryFeatures_)||jo(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){let t=[];return this.forEachFeatureAtCoordinateDirect(e,function(o){t.push(o)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);let a=ww(e,t);return[].concat(...a.map(s=>this.featuresRtree_.getInExtent(s)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){let o=e[0],a=e[1],s=null,f=[NaN,NaN],v=1/0,w=[-1/0,-1/0,1/0,1/0];return t=t||$u,this.featuresRtree_.forEachInExtent(w,function(D){if(t(D)){let A=D.getGeometry(),z=v;if(v=A instanceof Wl?0:A.closestPointXY(o,a,f,v),v<z){s=D;let H=Math.sqrt(v);w[0]=o-H,w[1]=a-H,w[2]=o+H,w[3]=a+H}}}),s}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){let t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){let t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){let t=e.target,o=dn(t),a=t.getGeometry();if(!a)o in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[o]=t);else{let f=a.getExtent();o in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[o],this.featuresRtree_&&this.featuresRtree_.insert(f,t)):this.featuresRtree_&&this.featuresRtree_.update(f,t)}let s=t.getId();if(s!==void 0){let f=s.toString();this.idIndex_[f]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[f]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[o]=t;this.changed(),this.dispatchEvent(new Xc(Ra.CHANGEFEATURE,t))}hasFeature(e){let t=e.getId();return t!==void 0?t in this.idIndex_:dn(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Da(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,o){let a=this.loadedExtentsRtree_,s=this.strategy_(e,t,o);for(let f=0,v=s.length;f<v;++f){let w=s[f];a.forEachInExtent(w,function(A){return Zf(A.extent,w)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Xc(Ra.FEATURESLOADSTART)),this.loader_.call(this,w,t,o,A=>{--this.loadingExtentsCount_,this.dispatchEvent(new Xc(Ra.FEATURESLOADEND,void 0,A))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Xc(Ra.FEATURESLOADERROR))}),a.insert(w,{extent:w.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){let t=this.loadedExtentsRtree_,o=t.forEachInExtent(e,function(a){if(Xu(a.extent,e))return a});o&&t.remove(o)}removeFeatures(e){let t=!1;for(let o=0,a=e.length;o<a;++o)t=this.removeFeatureInternal(e[o])||t;t&&this.changed()}removeFeature(e){if(!e)return;this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){let t=dn(e);if(!(t in this.uidIndex_))return!1;t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.featureChangeKeys_[t]?.forEach(Gn),delete this.featureChangeKeys_[t];let a=e.getId();if(a!==void 0){let s=a.toString(),f=this.idIndex_[s];f===e?delete this.idIndex_[s]:Array.isArray(f)&&(f.splice(f.indexOf(e),1),f.length===1&&(this.idIndex_[s]=f[0]))}return delete this.uidIndex_[t],this.hasListener(Ra.REMOVEFEATURE)&&this.dispatchEvent(new Xc(Ra.REMOVEFEATURE,e)),!0}removeFromIdIndex_(e){for(let t in this.idIndex_)if(this.idIndex_[t]===e){delete this.idIndex_[t];break}}setLoader(e){this.loader_=e}setUrl(e){Cn(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(GP(e,this.format_))}setOverlaps(e){this.overlaps_=e,this.changed()}},Gj=ZP;var j1="1.3.0";function NW(n,e,t,o,a){a.WIDTH=t[0],a.HEIGHT=t[1];let s=o.getAxisOrientation(),f=Ew(a.VERSION,"1.3")>=0;a[f?"CRS":"SRS"]=o.getCode();let v=f&&s.startsWith("ne")?[e[1],e[0],e[3],e[2]]:e;return a.BBOX=v.join(","),k1(n,a)}function $j(n,e,t,o,a,s,f){s=Object.assign({REQUEST:"GetMap"},s);let v=e/t,w=[NS(In(n)/v,4),NS(Hi(n)/v,4)];if(t!=1)switch(f){case"geoserver":let A=90*t+.5|0;"FORMAT_OPTIONS"in s?s.FORMAT_OPTIONS+=";dpi:"+A:s.FORMAT_OPTIONS="dpi:"+A;break;case"mapserver":s.MAP_RESOLUTION=90*t;break;case"carmentaserver":case"qgis":s.DPI=90*t;break;default:throw new Error("Unknown `serverType` configured")}return NW(a,n,w,o,s)}function qP(n,e){return Object.assign({REQUEST:e,SERVICE:"WMS",VERSION:j1,FORMAT:"image/png",STYLES:"",TRANSPARENT:"TRUE"},n)}var WP=class extends B1{constructor(e){e=e||{};let t=Object.assign({},e.params);super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.params_=t,this.v13_=!0,this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=ar(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(e,t,o,a){let s=si(o),f=this.getProjection()||s,v=this.getTileGrid();v||(v=this.getTileGridForProjection(f));let w=Qu(e,s,f),D=S1(f,s,e,t),A=v.getZForResolution(D,this.zDirection),z=v.getResolution(A),H=v.getTileCoordForCoordAndZ(w,A);if(v.getResolutions().length<=H[0])return;let q=v.getTileCoordExtent(H,this.tmpExtent_),W=this.gutter_;W!==0&&(q=qu(q,z*W,q));let me={QUERY_LAYERS:this.params_.LAYERS};Object.assign(me,qP(this.params_,"GetFeatureInfo"),a);let ce=Math.floor((w[0]-q[0])/z),ue=Math.floor((q[3]-w[1])/z);return me[this.v13_?"I":"X"]=ce,me[this.v13_?"J":"Y"]=ue,this.getRequestUrl_(H,q,1,f||s,me)}getLegendUrl(e,t){if(this.urls[0]===void 0)return;let o={SERVICE:"WMS",VERSION:j1,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(t===void 0||t.LAYER===void 0){let a=this.params_.LAYERS;if(!(!Array.isArray(a)||a.length===1))return;o.LAYER=a}if(e!==void 0){let a=this.getProjection()?this.getProjection().getMetersPerUnit():1,s=28e-5;o.SCALE=e*a/s}return Object.assign(o,t),k1(this.urls[0],o)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(e,t,o,a,s){let f=this.urls;if(!f)return;let v;if(f.length==1)v=f[0];else{let w=jl(M1(e),f.length);v=f[w]}return $j(t,(this.tileGrid||this.getTileGridForProjection(a)).getResolution(e[0]),o,a,v,s,this.serverType_)}getTilePixelRatio(e){return!this.hidpi_||this.serverType_===void 0?1:e}getKeyForParams_(){let e=0,t=[];for(let o in this.params_)t[e++]=o+"-"+this.params_[o];return t.join("/")}setParams_(e){this.params_=e,this.updateV13_(),this.setKey(this.getKeyForParams_())}setParams(e){this.setParams_(Object.assign({},e))}updateParams(e){this.setParams_(Object.assign(this.params_,e))}updateV13_(){let e=this.params_.VERSION||j1;this.v13_=Ew(e,"1.3")>=0}tileUrlFunction(e,t,o){let a=this.getTileGrid();if(a||(a=this.getTileGridForProjection(o)),a.getResolutions().length<=e[0])return;t!=1&&(!this.hidpi_||this.serverType_===void 0)&&(t=1);let s=a.getResolution(e[0]),f=a.getTileCoordExtent(e,this.tmpExtent_),v=this.gutter_;v!==0&&(f=qu(f,s*v,f));let w=Object.assign({},qP(this.params_,"GetMap"));return this.getRequestUrl_(e,f,t,o,w)}},XP=WP;var Kg=class{map;layers=new Map;initialize(e,t,o){this.map=new JB({target:e,layers:[new pP({source:new UP({url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attributions:"Tiles \xA9 Esri \u2014 Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan"})})],view:new Pa({center:iD([t[1],t[0]]),zoom:o})})}destroy(){this.map&&(this.map.setTarget(void 0),this.map=void 0),this.layers.clear()}addWMSLayer(e,t){if(!this.map)return;let o=new XP({url:t.url,params:{LAYERS:t.layers,FORMAT:t.format||"image/png",TRANSPARENT:t.transparent!==!1,VERSION:t.version||"1.3.0"},serverType:"geoserver"}),a=new pP({source:o});this.map.addLayer(a),this.layers.set(e,a)}removeWMSLayer(e){let t=this.layers.get(e);t&&this.map&&(this.map.removeLayer(t),this.layers.delete(e))}addGeoJSONLayer(e,t,o){if(!this.map)return;let a=new Gj({features:new XM().readFeatures(t,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})}),s=new Rj({source:a,style:new rh({stroke:new ap({color:"#3388ff",width:2}),fill:new Zc({color:"rgba(51, 136, 255, 0.4)"})})});this.map.addLayer(s),this.layers.set(e,s),o?.onEachFeature&&a.getFeatures().forEach(f=>{o.onEachFeature(f,s)})}removeGeoJSONLayer(e){let t=this.layers.get(e);t&&this.map&&(this.map.removeLayer(t),this.layers.delete(e))}setView(e,t){this.map&&(this.map.getView().setCenter(iD([e[1],e[0]])),this.map.getView().setZoom(t))}getMapInstance(){return this.map}};var Yc=class n{router=tt(dg);route=tt(Fc);currentTechnology=Fi("leaflet-osm");constructor(){this.route.queryParams.subscribe(e=>{let t=e.map;t&&this.isValidTechnology(t)&&this.currentTechnology.set(t)})}setTechnology(e){this.currentTechnology.set(e),this.router.navigate([],{queryParams:{map:e},queryParamsHandling:"merge"})}getTechnology(){return this.currentTechnology()}isValidTechnology(e){return["leaflet-osm","openlayers","maplibre"].includes(e)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Ht({token:n,factory:n.\u0275fac,providedIn:"root"})};var V1=class n{mapStateService=tt(Yc);createMapProvider(){let e=this.mapStateService.currentTechnology();switch(e){case"leaflet-osm":return new Gf;case"openlayers":return new Kg;case"maplibre":return new fg;default:return console.warn(`Unknown technology: ${e}, defaulting to Leaflet`),new Gf}}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Ht({token:n,factory:n.\u0275fac,providedIn:"root"})};var U1=class n{mapProvider;layerService=tt(Qa);mapFactory=tt(V1);mapStateService=tt(Yc);constructor(){Ry(()=>{let e=this.mapStateService.currentTechnology();console.log("Technology changed to:",e),this.mapProvider&&this.reinitializeMap()})}ngAfterViewInit(){this.initMap()}ngOnDestroy(){this.mapProvider&&this.mapProvider.destroy()}initMap(){this.mapProvider=this.mapFactory.createMapProvider(),this.mapProvider.initialize("map",[46.28315,7.5385],17),this.layerService.setMapProvider(this.mapProvider)}reinitializeMap(){this.mapProvider&&this.mapProvider.destroy(),setTimeout(()=>{this.initMap()},100)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=eo({type:n,selectors:[["app-map"]],decls:1,vars:0,consts:[["id","map"]],template:function(t,o){t&1&&Eb(0,"div",0)},dependencies:[wo],styles:["#map[_ngcontent-%COMP%]{height:100%;width:100%}"]})};var G1=class n{layerService=tt(Qa);buildingsEnabled=Fi(!1);osmBuildings;get provider(){let e=this.layerService.getMapProvider();return e instanceof Gf?e:void 0}get map(){return this.provider?.getMapInstance()}onToggleBuildings(){this.buildingsEnabled()?(this.disable3DBuildings(),this.buildingsEnabled.set(!1)):(this.enable3DBuildings(),this.buildingsEnabled.set(!0))}initOSMBuildings(){if(this.map)try{typeof OSMBuildings<"u"?(this.osmBuildings=new OSMBuildings(this.map),console.log("OSM Buildings initialized successfully for Leaflet")):console.warn("OSMBuildings library not loaded yet")}catch(e){console.error("Error initializing OSM Buildings:",e)}}enable3DBuildings(){if(this.osmBuildings||this.initOSMBuildings(),!this.osmBuildings){console.error("OSM Buildings library not available");return}try{fetch("/data/buildings.geojson").then(e=>e.json()).then(e=>{this.osmBuildings&&(this.osmBuildings.set(e),console.log("Buildings loaded from GeoJSON file"))}).catch(e=>{console.error("Error loading buildings GeoJSON:",e)})}catch(e){console.error("Error enabling 3D buildings:",e)}}disable3DBuildings(){if(this.osmBuildings)try{this.osmBuildings.set({type:"FeatureCollection",features:[]}),console.log("3D buildings disabled")}catch(e){console.error("Error disabling 3D buildings:",e)}}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=eo({type:n,selectors:[["app-leaflet-3d-panel"]],decls:9,vars:4,consts:[[1,"layer-item"],[1,"layer-info"],[1,"layer-title-row"],[1,"layer-description"],[1,"toggle-btn",3,"click"]],template:function(t,o){t&1&&(Cr(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4"),Ct(4,"OSM Buildings (Leaflet)"),mr()(),Cr(5,"p",3),Ct(6,"Display 3D buildings from buildings.geojson"),mr()(),Cr(7,"button",4),Yh("click",function(){return o.onToggleBuildings()}),Ct(8),mr()()),t&2&&(Ln(7),ns("active",o.buildingsEnabled()),ts("aria-label","Toggle 3D Buildings"),Ln(),Vr(" ",o.buildingsEnabled()?"ON":"OFF"," "))},dependencies:[wo],styles:[".layer-item[_ngcontent-%COMP%]{padding:12px;border:1px solid #ddd;border-radius:4px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center;background-color:#f9f9f9}.layer-info[_ngcontent-%COMP%]{flex:1}.layer-title-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:4px}.layer-title-row[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:14px;font-weight:600}.layer-description[_ngcontent-%COMP%]{margin:0;font-size:12px;color:#666}.toggle-btn[_ngcontent-%COMP%]{padding:6px 16px;border:1px solid #ccc;border-radius:4px;background-color:#fff;cursor:pointer;font-size:12px;font-weight:600;transition:all .2s;min-width:50px}.toggle-btn[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.toggle-btn.active[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;border-color:#4caf50}"]})};function zW(n,e){if(n&1){let t=Lf();Mt(0,"div",23)(1,"div",24)(2,"label",25),Ct(3),Ot(),Mt(4,"input",26),jr("input",function(a){Ta(t);let s=Us();return Ca(s.onPitchChange(a))}),Ot()(),Mt(5,"div",24)(6,"label",27),Ct(7),Ot(),Mt(8,"input",28),jr("input",function(a){Ta(t);let s=Us();return Ca(s.onBearingChange(a))}),Ot()(),Mt(9,"div",29)(10,"button",30),jr("click",function(){Ta(t);let a=Us();return Ca(a.onResetCamera())}),Ct(11,"Reset View"),Ot(),Mt(12,"button",31),jr("click",function(){Ta(t);let a=Us();return Ca(a.onCinematicView())}),Ct(13," Cinematic View "),Ot()()()}if(n&2){let t=Us();Ln(3),Vr("Pitch (Tilt): ",t.currentPitch(),"\xB0"),Ln(),Nu("value",t.currentPitch()),Ln(3),Vr("Bearing (Rotation): ",t.currentBearing(),"\xB0"),Ln(),Nu("value",t.currentBearing())}}var $1=class n{layerService=tt(Qa);mapTilerBuildingsEnabled=Fi(!1);localBuildingsEnabled=Fi(!1);terrainEnabled=Fi(!1);modelEnabled=Fi(!1);cameraControlsEnabled=Fi(!1);deckGlEnabled=Fi(!1);globeEnabled=Fi(!1);currentPitch=Fi(0);currentBearing=Fi(0);deckOverlay=null;get provider(){let e=this.layerService.getMapProvider();return e instanceof fg?e:void 0}get map(){return this.provider?.getMapInstance()}onToggleMapTilerBuildings(){return kr(this,null,function*(){this.mapTilerBuildingsEnabled()?(this.disableMapTilerBuildings(),this.mapTilerBuildingsEnabled.set(!1)):(this.enableMapTilerBuildings(),this.mapTilerBuildingsEnabled.set(!0))})}onToggleLocalBuildings(){return kr(this,null,function*(){this.localBuildingsEnabled()?(this.disableLocalBuildings(),this.localBuildingsEnabled.set(!1)):(yield this.enableLocalBuildings(),this.localBuildingsEnabled.set(!0))})}onToggleTerrain(){this.terrainEnabled()?(this.disableTerrain(),this.terrainEnabled.set(!1)):(this.enableTerrain(),this.terrainEnabled.set(!0))}onToggleModel(){return kr(this,null,function*(){this.modelEnabled()?(this.disable3DModel(),this.modelEnabled.set(!1)):(yield this.enable3DModel(),this.modelEnabled.set(!0))})}onToggleDeckGl(){return kr(this,null,function*(){this.deckGlEnabled()?(this.disableDeckGl(),this.deckGlEnabled.set(!1)):(yield this.enableDeckGl(),this.deckGlEnabled.set(!0))})}onToggleGlobe(){this.globeEnabled()?(this.disableGlobe(),this.globeEnabled.set(!1)):(this.enableGlobe(),this.globeEnabled.set(!0))}onToggleCameraControls(){this.cameraControlsEnabled()?(this.disableCameraControls(),this.cameraControlsEnabled.set(!1)):(this.enableCameraControls(),this.cameraControlsEnabled.set(!0))}onPitchChange(e){let t=+e.target.value;this.currentPitch.set(t),this.map&&this.map.setPitch(t)}onBearingChange(e){let t=+e.target.value;this.currentBearing.set(t),this.map&&this.map.setBearing(t)}onResetCamera(){this.map&&(this.map.easeTo({pitch:0,bearing:0,duration:1e3}),this.currentPitch.set(0),this.currentBearing.set(0))}onCinematicView(){this.map&&(this.map.easeTo({pitch:60,bearing:-45,duration:1500}),this.currentPitch.set(60),this.currentBearing.set(-45))}enableMapTilerBuildings(){if(!this.map)return;let t=this.map.getStyle().layers?.find(o=>o.type==="symbol")?.id;this.map.getSource("openmaptiles")||this.map.addSource("openmaptiles",{type:"vector",url:`https://api.maptiler.com/tiles/v3/tiles.json?key=${Vf.mapTilerApiKey}`}),this.map.getLayer("3d-buildings")||this.map.addLayer({id:"3d-buildings",source:"openmaptiles","source-layer":"building",type:"fill-extrusion",minzoom:15,paint:{"fill-extrusion-color":"#aaa","fill-extrusion-height":["interpolate",["linear"],["zoom"],15,0,15.05,["get","render_height"]],"fill-extrusion-base":["interpolate",["linear"],["zoom"],15,0,15.05,["get","render_min_height"]],"fill-extrusion-opacity":.6}},t),console.log("3D buildings enabled (MapLibre)")}disableMapTilerBuildings(){this.map&&this.map.getLayer("3d-buildings")&&(this.map.removeLayer("3d-buildings"),console.log("3D buildings disabled (MapLibre)"))}enableLocalBuildings(){return kr(this,null,function*(){if(this.map)try{let t=yield(yield fetch("/data/buildings.geojson")).json();this.map.getSource("local-buildings")||this.map.addSource("local-buildings",{type:"geojson",data:t}),this.map.getLayer("local-buildings-3d")||this.map.addLayer({id:"local-buildings-3d",type:"fill-extrusion",source:"local-buildings",paint:{"fill-extrusion-color":["get","wallColor"],"fill-extrusion-height":["get","height"],"fill-extrusion-base":["get","minHeight"],"fill-extrusion-opacity":.8}}),console.log("Local 3D buildings enabled (MapLibre)")}catch(e){console.error("Error loading local buildings:",e)}})}disableLocalBuildings(){this.map&&(this.map.getLayer("local-buildings-3d")&&this.map.removeLayer("local-buildings-3d"),this.map.getSource("local-buildings")&&this.map.removeSource("local-buildings"),console.log("Local 3D buildings disabled (MapLibre)"))}enableCameraControls(){this.map&&(this.map.dragRotate.enable(),this.map.touchZoomRotate.enableRotation(),this.map.setMaxPitch(85),console.log("3D camera controls enabled (MapLibre)"))}disableCameraControls(){this.map&&(this.map.easeTo({pitch:0,bearing:0,duration:500}),this.map.dragRotate.disable(),this.map.touchZoomRotate.disableRotation(),this.map.setMaxPitch(0),this.currentPitch.set(0),this.currentBearing.set(0),console.log("3D camera controls disabled (MapLibre)"))}enableTerrain(){this.map&&(this.map.getSource("terrain-source")||this.map.addSource("terrain-source",{type:"raster-dem",url:`https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json?key=${Vf.mapTilerApiKey}`,tileSize:256}),this.map.setTerrain({source:"terrain-source",exaggeration:1.5}),this.cameraControlsEnabled()||(this.enableCameraControls(),this.cameraControlsEnabled.set(!0)),console.log("3D terrain enabled (MapLibre)"))}disableTerrain(){this.map&&(this.map.setTerrain(null),console.log("3D terrain disabled (MapLibre)"))}enable3DModel(){return kr(this,null,function*(){if(!this.map)return;let e=[7.538361,46.283111],t=0,o=3;this.cameraControlsEnabled()||(this.enableCameraControls(),this.cameraControlsEnabled.set(!0)),this.map.flyTo({center:e,pitch:60,bearing:0,duration:2e3});let a={id:"3d-model",type:"custom",renderingMode:"3d",onAdd:function(s,f){return kr(this,null,function*(){let[v,{OBJLoader:w}]=yield Promise.all([import("./chunk-NJUQLZXF.js"),import("./chunk-O7OJFNLH.js")]);this.THREE=v,this.camera=new v.Camera,this.scene=new v.Scene,this.scene.add(new v.DirectionalLight(16777215,1).position.set(0,-70,100).normalize()),this.scene.add(new v.DirectionalLight(16777215,1).position.set(0,70,100).normalize()),this.scene.add(new v.AmbientLight(16777215,.8)),new w().load("/data/pingpongtable.obj",D=>{D.traverse(A=>{A instanceof v.Mesh&&(A.material=new v.MeshPhongMaterial({color:16711680,shininess:30}))}),this.scene.add(D),this.model=D,console.log("3D model loaded"),s.triggerRepaint()},void 0,D=>console.error("Error loading model:",D)),this.renderer=new v.WebGLRenderer({canvas:s.getCanvas(),context:f,antialias:!0}),this.renderer.autoClear=!1,this.map=s})},render:function(s,f){if(!this.THREE||!this.camera||!this.model)return;let v=this.map.transform.getMatrixForModel(e,t),w=new this.THREE.Matrix4().fromArray(f.defaultProjectionData.mainMatrix),D=new this.THREE.Matrix4().fromArray(v).scale(new this.THREE.Vector3(o,o,o));this.camera.projectionMatrix=w.multiply(D),this.renderer.resetState(),this.renderer.render(this.scene,this.camera),this.map.triggerRepaint()}};this.map.addLayer(a),console.log(`3D model layer added at 46\xB016'59.2"N 7\xB032'18.1"E`)})}disable3DModel(){this.map&&(this.map.getLayer("3d-model")&&this.map.removeLayer("3d-model"),console.log("3D model disabled"))}enableDeckGl(){return kr(this,null,function*(){if(this.map){this.cameraControlsEnabled()||(this.enableCameraControls(),this.cameraControlsEnabled.set(!0));try{let[{Deck:e},{MapboxOverlay:t},{HexagonLayer:o}]=yield Promise.all([import("./chunk-2UX52YDE.js"),import("./chunk-3DCLLU5Q.js"),import("./chunk-XJVKOK3G.js")]),f=(yield(yield fetch("/data/buildings.geojson")).json()).features.map(w=>{let D=w.geometry.coordinates[0],A=D.reduce((H,q)=>H+q[0],0)/D.length,z=D.reduce((H,q)=>H+q[1],0)/D.length;return{coordinates:[A,z],height:w.properties.height||10}}),v=new o({id:"hexagon-layer",data:f,getPosition:w=>w.coordinates,getElevationWeight:w=>w.height,elevationScale:2,extruded:!0,radius:50,coverage:.9,opacity:.8,pickable:!0,autoHighlight:!0,colorRange:[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]]});this.deckOverlay=new t({layers:[v]}),this.map.addControl(this.deckOverlay),console.log("deck.gl hexagon layer enabled (MapLibre + deck.gl)")}catch(e){console.error("Error enabling deck.gl:",e)}}})}disableDeckGl(){!this.map||!this.deckOverlay||(this.map.removeControl(this.deckOverlay),this.deckOverlay=null,console.log("deck.gl layer disabled"))}enableGlobe(){this.map&&(this.map.setProjection({type:"globe"}),this.map.flyTo({zoom:1.5,pitch:0,bearing:0,duration:2e3}),console.log("Globe projection enabled"))}disableGlobe(){this.map&&(this.map.setProjection({type:"mercator"}),console.log("Globe projection disabled, back to Mercator"))}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=eo({type:n,selectors:[["app-maplibre-3d-panel"]],decls:102,vars:29,consts:[[1,"examples-header"],[1,"examples-subtitle"],[1,"layer-item"],[1,"layer-info"],[1,"layer-title-row"],[1,"badge","badge-local"],[1,"layer-description"],[1,"toggle-btn",3,"click"],[1,"badge","badge-model"],[2,"opacity","0.7"],["href","https://skfb.ly/pFuUX","target","_blank","rel","noopener"],[1,"badge","badge-deckgl"],[1,"badge","badge-globe"],[1,"badge","badge-camera"],["class","camera-controls",4,"ngIf"],[1,"api-key-section"],[1,"api-key-header"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"],[1,"api-key-description"],[1,"badge"],[1,"badge","badge-terrain"],[1,"info-note"],[1,"camera-controls"],[1,"control-group"],["for","pitch-slider"],["id","pitch-slider","type","range","min","0","max","85",1,"slider",3,"input","value"],["for","bearing-slider"],["id","bearing-slider","type","range","min","-180","max","180",1,"slider",3,"input","value"],[1,"preset-buttons"],[1,"preset-btn",3,"click"],[1,"preset-btn","preset-cinematic",3,"click"]],template:function(t,o){t&1&&(Mt(0,"div",0)(1,"h3"),Ct(2,"3D Examples for MapLibre GL"),Ot(),Mt(3,"p",1),Ct(4,"Explore different 3D visualization techniques"),Ot()(),Mt(5,"div",2)(6,"div",3)(7,"div",4)(8,"h4"),Ct(9,"Local GeoJSON Buildings"),Ot(),Mt(10,"span",5),Ct(11,"Local Data"),Ot()(),Mt(12,"p",6),Ct(13," Extruded buildings from buildings.geojson with custom heights "),Ot()(),Mt(14,"button",7),jr("click",function(){return o.onToggleLocalBuildings()}),Ct(15),Ot()(),Mt(16,"div",2)(17,"div",3)(18,"div",4)(19,"h4"),Ct(20,"3D Model (.obj)"),Ot(),Mt(21,"span",8),Ct(22,"Custom Layer"),Ot()(),Mt(23,"p",6),Ct(24,` Ping pong table model at 46\xB016'59.2"N 7\xB032'18.1"E`),xo(25,"br"),Mt(26,"small",9),Ct(27,"Model by "),Mt(28,"a",10),Ct(29,"tonielpro520"),Ot(),Ct(30," (CC BY 4.0)"),Ot()()(),Mt(31,"button",7),jr("click",function(){return o.onToggleModel()}),Ct(32),Ot()(),Mt(33,"div",2)(34,"div",3)(35,"div",4)(36,"h4"),Ct(37,"deck.gl Hexagon Layer"),Ot(),Mt(38,"span",11),Ct(39,"GPU Accelerated"),Ot()(),Mt(40,"p",6),Ct(41," 3D hexagonal binning showing building density with deck.gl "),Ot()(),Mt(42,"button",7),jr("click",function(){return o.onToggleDeckGl()}),Ct(43),Ot()(),Mt(44,"div",2)(45,"div",3)(46,"div",4)(47,"h4"),Ct(48,"Globe Projection"),Ot(),Mt(49,"span",12),Ct(50,"3D Earth"),Ot()(),Mt(51,"p",6),Ct(52," Switch between flat Mercator and 3D globe view "),Ot()(),Mt(53,"button",7),jr("click",function(){return o.onToggleGlobe()}),Ct(54),Ot()(),Mt(55,"div",2)(56,"div",3)(57,"div",4)(58,"h4"),Ct(59,"3D Camera Controls"),Ot(),Mt(60,"span",13),Ct(61,"Interactive"),Ot()(),Mt(62,"p",6),Ct(63," Enable pitch (tilt) and bearing (rotation) for cinematic views "),Ot()(),Mt(64,"button",7),jr("click",function(){return o.onToggleCameraControls()}),Ct(65),Ot()(),Hm(66,zW,14,4,"div",14),Mt(67,"div",15)(68,"div",16),Fm(),Mt(69,"svg",17),xo(70,"path",18),Ot(),Nm(),Mt(71,"span"),Ct(72,"\u{1F511} API Key Required"),Ot()(),Mt(73,"p",19),Ct(74," The following features require a free MapTiler API key configured in "),Mt(75,"code"),Ct(76,"src/environments/environment.ts"),Ot()(),Mt(77,"div",2)(78,"div",3)(79,"div",4)(80,"h4"),Ct(81,"MapTiler 3D Buildings"),Ot(),Mt(82,"span",20),Ct(83,"Vector Tiles"),Ot()(),Mt(84,"p",6),Ct(85," Global 3D building data from MapTiler using vector tiles "),Ot()(),Mt(86,"button",7),jr("click",function(){return o.onToggleMapTilerBuildings()}),Ct(87),Ot()(),Mt(88,"div",2)(89,"div",3)(90,"div",4)(91,"h4"),Ct(92,"3D Terrain"),Ot(),Mt(93,"span",21),Ct(94,"Elevation"),Ot()(),Mt(95,"p",6),Ct(96," Real elevation data with exaggerated height for dramatic effect "),Ot()(),Mt(97,"button",7),jr("click",function(){return o.onToggleTerrain()}),Ct(98),Ot()()(),Mt(99,"div",22)(100,"small"),Ct(101,"\u{1F4A1} MapLibre provides native 3D rendering, deck.gl adds GPU-accelerated advanced visualizations"),Ot()()),t&2&&(Ln(14),ns("active",o.localBuildingsEnabled()),ts("aria-label","Toggle Local 3D Buildings"),Ln(),Vr(" ",o.localBuildingsEnabled()?"ON":"OFF"," "),Ln(16),ns("active",o.modelEnabled()),ts("aria-label","Toggle 3D Model"),Ln(),Vr(" ",o.modelEnabled()?"ON":"OFF"," "),Ln(10),ns("active",o.deckGlEnabled()),ts("aria-label","Toggle deck.gl Layer"),Ln(),Vr(" ",o.deckGlEnabled()?"ON":"OFF"," "),Ln(10),ns("active",o.globeEnabled()),ts("aria-label","Toggle Globe Projection"),Ln(),Vr(" ",o.globeEnabled()?"ON":"OFF"," "),Ln(10),ns("active",o.cameraControlsEnabled()),ts("aria-label","Toggle 3D Camera Controls"),Ln(),Vr(" ",o.cameraControlsEnabled()?"ON":"OFF"," "),Ln(),Nu("ngIf",o.cameraControlsEnabled()),Ln(20),ns("active",o.mapTilerBuildingsEnabled()),ts("aria-label","Toggle MapTiler 3D Buildings"),Ln(),Vr(" ",o.mapTilerBuildingsEnabled()?"ON":"OFF"," "),Ln(10),ns("active",o.terrainEnabled()),ts("aria-label","Toggle 3D Terrain"),Ln(),Vr(" ",o.terrainEnabled()?"ON":"OFF"," "))},dependencies:[wo,ky],styles:[".examples-header[_ngcontent-%COMP%]{margin-bottom:16px;padding-bottom:12px;border-bottom:2px solid #e0e0e0}.examples-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 4px;font-size:16px;font-weight:700;color:#333}.examples-subtitle[_ngcontent-%COMP%]{margin:0;font-size:12px;color:#666}.badge[_ngcontent-%COMP%]{display:inline-block;padding:2px 8px;background-color:#e3f2fd;color:#1976d2;border-radius:12px;font-size:10px;font-weight:600;text-transform:uppercase}.badge-local[_ngcontent-%COMP%]{background-color:#f3e5f5;color:#7b1fa2}.badge-terrain[_ngcontent-%COMP%]{background-color:#fff3e0;color:#e65100}.badge-model[_ngcontent-%COMP%]{background-color:#fce4ec;color:#c2185b}.badge-camera[_ngcontent-%COMP%]{background-color:#e8f5e9;color:#2e7d32}.badge-deckgl[_ngcontent-%COMP%]{background-color:#e1f5fe;color:#0277bd}.badge-globe[_ngcontent-%COMP%]{background-color:#e8eaf6;color:#3f51b5}.layer-item[_ngcontent-%COMP%]{padding:12px;border:1px solid #ddd;border-radius:4px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center;background-color:#f9f9f9}.layer-info[_ngcontent-%COMP%]{flex:1}.layer-title-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:4px}.layer-title-row[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:14px;font-weight:600}.layer-description[_ngcontent-%COMP%]{margin:0;font-size:12px;color:#666}.toggle-btn[_ngcontent-%COMP%]{padding:6px 16px;border:1px solid #ccc;border-radius:4px;background-color:#fff;cursor:pointer;font-size:12px;font-weight:600;transition:all .2s;min-width:50px}.toggle-btn[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.toggle-btn.active[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;border-color:#4caf50}.info-note[_ngcontent-%COMP%]{margin-top:8px;padding:8px;background-color:#e3f2fd;border-radius:4px;color:#1976d2}.info-note[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:11px}.camera-controls[_ngcontent-%COMP%]{padding:16px;background-color:#f5f5f5;border:1px solid #ddd;border-radius:4px;margin-bottom:8px}.control-group[_ngcontent-%COMP%]{margin-bottom:16px}.control-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:12px;font-weight:600;color:#333;margin-bottom:8px}.slider[_ngcontent-%COMP%]{width:100%;height:6px;border-radius:3px;background:#d3d3d3;outline:none;-webkit-appearance:none}.slider[_ngcontent-%COMP%]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:18px;height:18px;border-radius:50%;background:#2e7d32;cursor:pointer;transition:background .2s}.slider[_ngcontent-%COMP%]::-webkit-slider-thumb:hover{background:#1b5e20}.slider[_ngcontent-%COMP%]::-moz-range-thumb{width:18px;height:18px;border-radius:50%;background:#2e7d32;cursor:pointer;border:none;transition:background .2s}.slider[_ngcontent-%COMP%]::-moz-range-thumb:hover{background:#1b5e20}.preset-buttons[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:12px}.preset-btn[_ngcontent-%COMP%]{flex:1;padding:8px 12px;border:1px solid #ccc;border-radius:4px;background-color:#fff;cursor:pointer;font-size:12px;font-weight:600;transition:all .2s}.preset-btn[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.preset-cinematic[_ngcontent-%COMP%]{background-color:#e8f5e9;border-color:#2e7d32;color:#2e7d32}.preset-cinematic[_ngcontent-%COMP%]:hover{background-color:#c8e6c9}.api-key-section[_ngcontent-%COMP%]{margin-top:20px;padding:12px;background-color:#fff3e0;border:2px solid #ff9800;border-radius:6px}.api-key-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:13px;font-weight:700;color:#e65100;margin-bottom:8px}.api-key-header[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{flex-shrink:0}.api-key-description[_ngcontent-%COMP%]{margin:0 0 12px;font-size:11px;color:#ef6c00;line-height:1.4}.api-key-description[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background-color:#0000001a;padding:2px 6px;border-radius:3px;font-size:10px;font-family:Courier New,monospace}.api-key-section[_ngcontent-%COMP%]   .layer-item[_ngcontent-%COMP%]{background-color:#fff;border-color:#ffb74d}"]})};var H1=class n{layerService=tt(Qa);buildingsEnabled=Fi(!1);deckOverlay;deckContainer;get provider(){let e=this.layerService.getMapProvider();return e instanceof Kg?e:void 0}get map(){return this.provider?.getMapInstance()}onToggleBuildings(){this.buildingsEnabled()?(this.disable3DBuildings(),this.buildingsEnabled.set(!1)):(this.enable3DBuildings(),this.buildingsEnabled.set(!0))}enable3DBuildings(){if(!this.map)return;let e=this.map.getTargetElement();e&&(this.deckContainer=document.createElement("div"),this.deckContainer.id="deck-overlay-"+Date.now(),this.deckContainer.style.position="absolute",this.deckContainer.style.top="0",this.deckContainer.style.left="0",this.deckContainer.style.width="100%",this.deckContainer.style.height="100%",this.deckContainer.style.pointerEvents="none",e.appendChild(this.deckContainer),fetch("/data/buildings.geojson").then(t=>t.json()).then(t=>{if(!this.map||!this.deckContainer)return;let o=this.map.getView();this.deckOverlay=new c2({parent:this.deckContainer,width:"100%",height:"100%",initialViewState:{longitude:o.getCenter()[0]/2003750834e-2*180,latitude:Math.atan(Math.exp(o.getCenter()[1]/2003750834e-2*Math.PI))*360/Math.PI-90,zoom:o.getZoom()-1,pitch:45,bearing:0},controller:!1,layers:[new u2({id:"buildings-3d",data:t,extruded:!0,wireframe:!0,getElevation:s=>s.properties.height||10,getFillColor:s=>{let f=s.properties.wallColor||"gray";return this.colorToRgb(f)},getLineColor:[80,80,80],lineWidthMinPixels:1})]});let a=()=>{if(!this.deckOverlay||!this.map)return;let s=this.map.getView(),f=s.getCenter(),v=s.getZoom(),w=s.getRotation(),D=f[0]/2003750834e-2*180,A=Math.atan(Math.exp(f[1]/2003750834e-2*Math.PI))*360/Math.PI-90;this.deckOverlay.setProps({viewState:{longitude:D,latitude:A,zoom:v-1,pitch:45,bearing:-(w*180)/Math.PI}})};this.map.on("moveend",a),this.map.getView().on("change:rotation",a),console.log("3D extruded buildings loaded with deck.gl (OpenLayers)")}).catch(t=>{console.error("Error loading buildings GeoJSON:",t)}))}disable3DBuildings(){this.deckOverlay&&(this.deckOverlay.finalize(),this.deckOverlay=void 0),this.deckContainer&&(this.deckContainer.remove(),this.deckContainer=void 0),console.log("3D extruded buildings disabled (OpenLayers + deck.gl)")}colorToRgb(e){return{red:[255,0,0,200],black:[40,40,40,200],white:[255,255,255,200],gray:[136,136,136,200],grey:[136,136,136,200],blue:[0,0,255,200],green:[0,255,0,200]}[e.toLowerCase()]||[136,136,136,200]}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=eo({type:n,selectors:[["app-openlayers-3d-panel"]],decls:12,vars:4,consts:[[1,"layer-item"],[1,"layer-info"],[1,"layer-title-row"],[1,"layer-description"],[1,"toggle-btn",3,"click"],[1,"info-note"]],template:function(t,o){t&1&&(Cr(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4"),Ct(4,"3D Extruded Buildings (OpenLayers + deck.gl)"),mr()(),Cr(5,"p",3),Ct(6," WebGL-powered true 3D extrusion from buildings.geojson "),mr()(),Cr(7,"button",4),Yh("click",function(){return o.onToggleBuildings()}),Ct(8),mr()(),Cr(9,"div",5)(10,"small"),Ct(11,"\u{1F4A1} Using deck.gl WebGL overlay for true polygon extrusion with 45\xB0 pitch"),mr()()),t&2&&(Ln(7),ns("active",o.buildingsEnabled()),ts("aria-label","Toggle 3D Extruded Buildings"),Ln(),Vr(" ",o.buildingsEnabled()?"ON":"OFF"," "))},dependencies:[wo],styles:[".layer-item[_ngcontent-%COMP%]{padding:12px;border:1px solid #ddd;border-radius:4px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center;background-color:#f9f9f9}.layer-info[_ngcontent-%COMP%]{flex:1}.layer-title-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:4px}.layer-title-row[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:14px;font-weight:600}.layer-description[_ngcontent-%COMP%]{margin:0;font-size:12px;color:#666}.toggle-btn[_ngcontent-%COMP%]{padding:6px 16px;border:1px solid #ccc;border-radius:4px;background-color:#fff;cursor:pointer;font-size:12px;font-weight:600;transition:all .2s;min-width:50px}.toggle-btn[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.toggle-btn.active[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;border-color:#4caf50}.info-note[_ngcontent-%COMP%]{margin-top:8px;padding:8px;background-color:#e3f2fd;border:1px solid #2196f3;border-radius:4px;color:#1565c0}.info-note[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:11px}"]})};function BW(n,e){n&1&&xo(0,"app-leaflet-3d-panel")}function jW(n,e){n&1&&xo(0,"app-openlayers-3d-panel")}function VW(n,e){n&1&&xo(0,"app-maplibre-3d-panel")}var Z1=class n{mapStateService=tt(Yc);currentTech=this.mapStateService.currentTechnology;static \u0275fac=function(t){return new(t||n)};static \u0275cmp=eo({type:n,selectors:[["app-3d-layer-panel"]],decls:7,vars:1,consts:[[1,"layer-panel-container"],[1,"panel-content"]],template:function(t,o){if(t&1&&(Mt(0,"div",0)(1,"h2"),Ct(2,"3D Capabilities"),Ot(),Mt(3,"div",1),qm(4,BW,1,0,"app-leaflet-3d-panel")(5,jW,1,0,"app-openlayers-3d-panel")(6,VW,1,0,"app-maplibre-3d-panel"),Ot()()),t&2){let a;Ln(4),Wm((a=o.currentTech())==="leaflet-osm"?4:a==="openlayers"?5:a==="maplibre"?6:-1)}},dependencies:[wo,G1,H1,$1],styles:[".layer-panel-container[_ngcontent-%COMP%]{padding:20px;background-color:#f5f5f5}h2[_ngcontent-%COMP%]{margin-top:0;color:#333;font-size:18px}.panel-content[_ngcontent-%COMP%]{margin-top:20px}"]})};var UW=(n,e)=>e.name;function GW(n,e){n&1&&(Cr(0,"p",2),Ct(1,"Loading layers..."),mr())}function $W(n,e){if(n&1&&(Cr(0,"p",8),Ct(1),mr()),n&2){let t=Us().$implicit;Ln(),Ay(t.abstract)}}function HW(n,e){if(n&1){let t=Lf();Cr(0,"div",4)(1,"div",5)(2,"div",6)(3,"h4"),Ct(4),mr(),Cr(5,"span",7),Ct(6),mr()(),qm(7,$W,2,1,"p",8),mr(),Cr(8,"button",9),Yh("click",function(){let a=Ta(t).$index,s=Us(2);return Ca(s.onToggleLayer(a))}),Ct(9),mr()()}if(n&2){let t=e.$implicit;Ln(4),Ay(t.title),Ln(),AI("badge-"+t.type),Ln(),Vr(" ",t.type," "),Ln(),Wm(t.abstract?7:-1),Ln(),ns("active",t.enabled),ts("aria-label","Toggle "+t.title),Ln(),Vr(" ",t.enabled?"ON":"OFF"," ")}}function ZW(n,e){if(n&1&&(Cr(0,"div",3),MI(1,HW,10,9,"div",4,UW),mr()),n&2){let t=Us();Ln(),PI(t.layerService.layers())}}var q1=class n{layerService=tt(Qa);ngOnInit(){this.layerService.fetchLayers()}onToggleLayer(e){this.layerService.toggleLayer(e)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=eo({type:n,selectors:[["app-geoserver-panel"]],decls:6,vars:1,consts:[[1,"geoserver-panel-container"],[1,"panel-content"],[1,"loading"],[1,"layers-list"],[1,"layer-item"],[1,"layer-info"],[1,"layer-title-row"],[1,"layer-type-badge"],[1,"layer-description"],[1,"toggle-btn",3,"click"]],template:function(t,o){t&1&&(Cr(0,"div",0)(1,"h2"),Ct(2,"GeoServer Layers"),mr(),Cr(3,"div",1),qm(4,GW,2,0,"p",2)(5,ZW,3,0,"div",3),mr()()),t&2&&(Ln(4),Wm(o.layerService.layers().length===0?4:5))},dependencies:[wo],styles:[".geoserver-panel-container[_ngcontent-%COMP%]{padding:20px;background-color:#f5f5f5}h2[_ngcontent-%COMP%]{margin-top:0;color:#333}.panel-content[_ngcontent-%COMP%]{margin-top:20px}.loading[_ngcontent-%COMP%]{color:#666;font-style:italic}.layers-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.layer-item[_ngcontent-%COMP%]{background:#fff;border:1px solid #ddd;border-radius:6px;padding:12px;display:flex;justify-content:space-between;align-items:center;transition:box-shadow .2s}.layer-item[_ngcontent-%COMP%]:hover{box-shadow:0 2px 8px #0000001a}.layer-info[_ngcontent-%COMP%]{flex:1;margin-right:12px}.layer-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 4px;color:#2c3e50;font-size:14px;font-weight:600}.layer-title-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:4px}.layer-title-row[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0}.layer-type-badge[_ngcontent-%COMP%]{padding:2px 8px;border-radius:4px;font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.badge-vector[_ngcontent-%COMP%]{background-color:#3498db;color:#fff}.badge-raster[_ngcontent-%COMP%]{background-color:#e67e22;color:#fff}.badge-unknown[_ngcontent-%COMP%]{background-color:#95a5a6;color:#fff}.layer-description[_ngcontent-%COMP%]{margin:0;font-size:12px;color:#666;line-height:1.4}.toggle-btn[_ngcontent-%COMP%]{min-width:60px;padding:8px 16px;border:2px solid #ccc;background-color:#fff;color:#666;border-radius:4px;cursor:pointer;font-weight:600;font-size:12px;transition:all .3s}.toggle-btn[_ngcontent-%COMP%]:hover{border-color:#999}.toggle-btn.active[_ngcontent-%COMP%]{background-color:#27ae60;border-color:#27ae60;color:#fff}.toggle-btn.active[_ngcontent-%COMP%]:hover{background-color:#229954;border-color:#229954}"]})};var W1=class n{title="Control Panel";static \u0275fac=function(t){return new(t||n)};static \u0275cmp=eo({type:n,selectors:[["app-panel"]],decls:3,vars:0,consts:[[1,"panel-container"]],template:function(t,o){t&1&&(Mt(0,"div",0),xo(1,"app-3d-layer-panel")(2,"app-geoserver-panel"),Ot())},dependencies:[wo,q1,Z1],styles:[".panel-container[_ngcontent-%COMP%]{height:100%;background-color:#f5f5f5;box-shadow:2px 0 5px #0000001a;overflow-y:auto;display:flex;flex-direction:column;gap:20px}"]})};function qW(n,e){if(n&1){let t=Lf();Mt(0,"div",18),jr("click",function(){Ta(t);let a=Us();return Ca(a.closeInfoModal())}),Mt(1,"div",19),jr("click",function(a){return Ta(t),Ca(a.stopPropagation())}),Mt(2,"button",20),jr("click",function(){Ta(t);let a=Us();return Ca(a.closeInfoModal())}),Ct(3," \xD7 "),Ot(),Mt(4,"h2"),Ct(5,"\u26A0\uFE0F Important Notice"),Ot(),Mt(6,"p")(7,"strong"),Ct(8,"This is a demonstration project only."),Ot(),Ct(9," The data and layers shown in this POC are for testing and visualization purposes and should "),Mt(10,"strong"),Ct(11,"not be used for any production, research, or decision-making purposes."),Ot()(),Mt(12,"div",21)(13,"h3"),Ct(14,"About Citiwatts"),Ot(),Mt(15,"p"),Ct(16," If you are interested in energy planning data and tools for heating and cooling planning across Europe, please visit: "),Ot(),Mt(17,"ul")(18,"li")(19,"a",22),Ct(20,"Citiwatts Platform"),Ot(),Ct(21," - Access real energy planning tools and data "),Ot(),Mt(22,"li")(23,"a",23),Ct(24,"Citiwatts Project"),Ot(),Ct(25," - Learn more about the initiative "),Ot()()(),Mt(26,"div",21)(27,"h3"),Ct(28,"API Key Information"),Ot(),Mt(29,"p"),Ct(30," Some 3D features require a free MapTiler API key. Features that work without an API key include: all base maps, local 3D buildings, 3D models, deck.gl visualizations, and camera controls. "),Ot()()()()}}var X1=class n{title=Fi("3d-map-poc");mapStateService=tt(Yc);currentTech=this.mapStateService.currentTechnology;showInfoModal=Fi(!1);onTechChange(e){let o=e.target.value;this.mapStateService.setTechnology(o)}openInfoModal(){this.showInfoModal.set(!0)}closeInfoModal(){this.showInfoModal.set(!1)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=eo({type:n,selectors:[["app-root"]],decls:27,vars:2,consts:[[1,"app-container"],[1,"header"],[1,"header-controls"],[1,"tech-selector"],["for","tech-select"],["id","tech-select",3,"change","value"],["value","leaflet-osm"],["value","openlayers"],["value","maplibre"],["title","About this project",1,"info-button",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["cx","12","cy","12","r","10"],["x1","12","y1","16","x2","12","y2","12"],["x1","12","y1","8","x2","12.01","y2","8"],[1,"content"],[1,"panel-section"],[1,"map-section"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],["aria-label","Close modal",1,"modal-close",3,"click"],[1,"modal-section"],["href","https://citiwatts.eu/","target","_blank","rel","noopener"],["href","https://project.citiwatts.eu/","target","_blank","rel","noopener"]],template:function(t,o){t&1&&(Mt(0,"div",0)(1,"div",1)(2,"h1"),Ct(3,"3D Map POC - Multi-Library Demo"),Ot(),Mt(4,"div",2)(5,"div",3)(6,"label",4),Ct(7,"Map Library:"),Ot(),Mt(8,"select",5),jr("change",function(s){return o.onTechChange(s)}),Mt(9,"option",6),Ct(10,"Leaflet + OSM Buildings"),Ot(),Mt(11,"option",7),Ct(12,"OpenLayers + Deck.gl"),Ot(),Mt(13,"option",8),Ct(14,"MapLibre GL"),Ot()()(),Mt(15,"button",9),jr("click",function(){return o.openInfoModal()}),Fm(),Mt(16,"svg",10),xo(17,"circle",11)(18,"line",12)(19,"line",13),Ot()()()(),Nm(),Mt(20,"div",14)(21,"div",15),xo(22,"app-panel"),Ot(),Mt(23,"div",16),xo(24,"app-map"),Ot()()(),Hm(25,qW,31,0,"div",17),xo(26,"router-outlet")),t&2&&(Ln(8),Nu("value",o.currentTech()),Ln(17),Nu("ngIf",o.showInfoModal()))},dependencies:[wo,ky,sv,W1,U1],styles:[".app-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh;overflow:hidden}.header[_ngcontent-%COMP%]{padding:10px 20px;background-color:#2c3e50;color:#fff;box-shadow:0 2px 4px #0000001a;display:flex;justify-content:space-between;align-items:center}.header-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:15px}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:24px}.tech-selector[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.tech-selector[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:14px;font-weight:500}.tech-selector[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 12px;border-radius:4px;border:1px solid #34495e;background-color:#34495e;color:#fff;font-size:14px;cursor:pointer;outline:none}.tech-selector[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:hover{background-color:#455a64}.tech-selector[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{border-color:#3498db}.info-button[_ngcontent-%COMP%]{background:none;border:2px solid rgba(255,255,255,.5);border-radius:50%;width:36px;height:36px;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s ease;padding:0}.info-button[_ngcontent-%COMP%]:hover{background-color:#ffffff1a;border-color:#fff;transform:scale(1.05)}.info-button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{pointer-events:none}.content[_ngcontent-%COMP%]{display:flex;flex:1;overflow:hidden}.panel-section[_ngcontent-%COMP%]{width:25%;height:100%;overflow:hidden}.map-section[_ngcontent-%COMP%]{width:75%;height:100%;overflow:hidden}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#000000b3;display:flex;align-items:center;justify-content:center;z-index:1000;animation:_ngcontent-%COMP%_fadeIn .2s ease}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.modal-content[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:30px;max-width:600px;max-height:80vh;overflow-y:auto;position:relative;box-shadow:0 10px 40px #0000004d;animation:_ngcontent-%COMP%_slideIn .3s ease}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translateY(-20px);opacity:0}to{transform:translateY(0);opacity:1}}.modal-close[_ngcontent-%COMP%]{position:absolute;top:15px;right:15px;background:none;border:none;font-size:32px;color:#666;cursor:pointer;line-height:1;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;transition:color .2s ease}.modal-close[_ngcontent-%COMP%]:hover{color:#000}.modal-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 15px;color:#2c3e50;font-size:24px}.modal-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:20px 0 10px;color:#34495e;font-size:18px}.modal-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{line-height:1.6;color:#555;margin:10px 0}.modal-section[_ngcontent-%COMP%]{margin-top:20px;padding-top:20px;border-top:1px solid #eee}.modal-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:15px 0}.modal-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:10px 0}.modal-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#3498db;text-decoration:none;font-weight:500;transition:color .2s ease}.modal-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#2980b9;text-decoration:underline}"]})};XI(X1,TN).catch(n=>console.error(n));
